# Consolidated Test Plan for Plan Net

## Generated on: 2025-06-16 08:50:27

## API Type: gemini

## Table of Contents

- [Plan-Net Network](#plan-net-network)
  - [REQ-37: Search for active practitioners and organizations](#req-37)
- [Plan-Net Organization](#plan-net-organization)
  - [REQ-34: Organization search by name](#req-34)
  - [REQ-38: Network contact handling for departments](#req-38)
- [Plan-Net OrganizationAffiliation](#plan-net-organizationaffiliation)
  - [REQ-36: Organization search by specialty](#req-36)
- [Plan-Net PractitionerRole](#plan-net-practitionerrole)
  - [REQ-35: Provider search by specialty](#req-35)

## Test Specifications

<a id='plan-net-network'></a>

## Plan-Net Network

<a id='req-37'></a>

### REQ-37: Search for active practitioners and organizations

**Description**: "Sample query to search for currently active Practitioners (replace date in query with current date): http://davinci-plan-net-ri.logicahealth.org/fhir/PractitionerRole?_include=PractitionerRole:date=ge2021-10-25. Sample query to search for currently active Organizations (replace date in query with current date): http://davinci-plan-net-ri.logicahealth.org/fhir/OrganizationAffiliation?_include=OrganizationAffiliation:date=ge2021-10-25."

**Actor**: Health Plan API

**Conformance**: None (Implementation example)

Okay, let's break down REQ-37 and create a comprehensive test specification.

First, a critical observation: The sample queries in REQ-37 have a non-standard syntax for `_include`.
The part `_include=PractitionerRole:date=ge2021-10-25` is problematic.
Standard FHIR `_include` syntax is `_include=[SourceResourceType]:[searchParameterNameOnSourceResourcePointingToTarget]`.
The `date=ge...` part is a search parameter for the *primary* resource being queried (e.g., `PractitionerRole` or `OrganizationAffiliation`).

So, the *intended* queries are likely:
1.  For active Practitioners: `GET [base]/PractitionerRole?date=ge[current_date]&_include=PractitionerRole:practitioner`
    *   This searches for `PractitionerRole` resources active on or after `[current_date]`.
    *   It then includes the `Practitioner` resources referenced by the `practitioner` element of these `PractitionerRole`s.
2.  For active Organizations: `GET [base]/OrganizationAffiliation?date=ge[current_date]&_include=OrganizationAffiliation:participating-organization&_include=OrganizationAffiliation:primary-organization` (or one of them, depending on which organization is desired).
    *   This searches for `OrganizationAffiliation` resources active on or after `[current_date]`.
    *   It then includes the `Organization` resources referenced by `participating-organization` (and/or `primary-organization`) of these `OrganizationAffiliation`s.

A second critical observation from the Capability Statement:
*   The `date` search parameter is **NOT listed** as supported for `PractitionerRole`.
*   The `date` search parameter is **NOT listed** as supported for `OrganizationAffiliation`.

This means that REQ-37, as described with its sample queries (even if corrected syntactically), **cannot be fulfilled if the provided Capability Statement snippet is strictly and completely accurate for these resources.** The test specification will proceed under the assumption that either:
a) The Capability Statement snippet is incomplete and `date` *is* intended to be supported for these resources to meet this "Implementation example."
b) The requirement implies that servers *should* support the `date` parameter on `PractitionerRole` and `OrganizationAffiliation` for this use case, even if not universally mandated.

The test specification will highlight this discrepancy.

---

## Test Specification

### 1. Requirement ID

REQ-37

### 2. Requirement Analysis

*   **Summary**: Search for active practitioners and organizations.
*   **Detailed Interpretation**: The requirement intends for clients to be able to find Practitioners and Organizations that are currently "active." Activeness is determined by the period of their roles or affiliations, specifically using `PractitionerRole.period` and `OrganizationAffiliation.period`. The sample queries suggest using the `date` search parameter on `PractitionerRole` and `OrganizationAffiliation` with a `ge` (greater than or equal to current date) prefix, which typically maps to `period.end >= [date]` OR (`period.start <= [date]` AND `period.end` is null). The `_include` parameter is then used to retrieve the associated Practitioner or Organization resources.
*   **Discrepancy Note**: The provided Capability Statement snippets for `PractitionerRole` and `OrganizationAffiliation` do **not** list `date` as a supported search parameter. This test specification assumes that for REQ-37 (an "Implementation example") to be demonstrable, the `date` search parameter *must* be supported on `PractitionerRole` and `OrganizationAffiliation` by the Health Plan API, or the requirement is untestable as described. The tests will proceed assuming `date` is supported.
*   **Corrected Sample Query Intent**:
    *   For Practitioners: `GET [base]/PractitionerRole?date=ge[current_date]&_include=PractitionerRole:practitioner`
    *   For Organizations: `GET [base]/OrganizationAffiliation?date=ge[current_date]&_include=OrganizationAffiliation:participating-organization` (and/or `_include=OrganizationAffiliation:primary-organization`)

*   **Testability Assessment**: Automatically Testable (with the strong caveat regarding the `date` search parameter support, as noted above). If `date` is not supported, this requirement is "Not Testable as Described."
*   **Complexity**: Moderate. Requires careful setup of multiple linked resources with specific date periods and understanding of `_include` and date search logic.
*   **Prerequisites**:
    1.  A FHIR server endpoint for the Health Plan API that is operational and accessible.
    2.  The server SHOULD support the `date` search parameter on `PractitionerRole` and `OrganizationAffiliation` resources.
    3.  The server SHALL support the `_include` search parameter.
    4.  The server SHALL support the search parameters listed in the Capability Statement for `Practitioner`, `Organization`, `PractitionerRole`, and `OrganizationAffiliation` that are used by `_include` (e.g., `PractitionerRole:practitioner`, `OrganizationAffiliation:participating-organization`).
    5.  Pre-loaded test data:
        *   At least one `Practitioner` resource.
        *   At least one `Organization` resource.
        *   Multiple `PractitionerRole` resources:
            *   One linked to a Practitioner, with a `period` that is currently active (e.g., `start` in the past, `end` in the future or no `end`).
            *   One linked to a Practitioner, with a `period` that has ended in the past (inactive).
            *   One linked to a Practitioner, with a `period` that starts in the future (not yet active).
        *   Multiple `OrganizationAffiliation` resources:
            *   One linked to an Organization (as primary or participating), with a `period` that is currently active.
            *   One linked to an Organization, with a `period` that has ended in the past (inactive).
            *   One linked to an Organization, with a `period` that starts in the future (not yet active).

### 3. Test Implementation Strategy

Two main test scenarios will be defined, one for active practitioners and one for active organizations. The `[current_date]` should be dynamically set to the actual current date at the time of test execution in `YYYY-MM-DD` format.

---

**Test Case 37.1: Search for Active Practitioners**

*   **Objective**: Verify that a search for `PractitionerRole` using the `date` parameter (with `ge[current_date]`) correctly returns active roles and includes the associated `Practitioner` resources.
*   **Required Inputs**:
    *   `Practitioner/practitioner-1`: A sample Practitioner.
    *   `Organization/org-for-role`: An organization where the practitioner has a role.
    *   `PractitionerRole/pr-active`:
        *   `practitioner`: Reference to `Practitioner/practitioner-1`
        *   `organization`: Reference to `Organization/org-for-role`
        *   `period.start`: A date in the past (e.g., `[current_date] - 1 year`)
        *   `period.end`: A date in the future (e.g., `[current_date] + 1 year`)
    *   `PractitionerRole/pr-active-no-end`:
        *   `practitioner`: Reference to `Practitioner/practitioner-1` (or a different active one)
        *   `organization`: Reference to `Organization/org-for-role`
        *   `period.start`: A date in the past (e.g., `[current_date] - 6 months`)
        *   `period.end`: (null)
    *   `Practitioner/practitioner-2`: Another sample Practitioner.
    *   `PractitionerRole/pr-inactive-past`:
        *   `practitioner`: Reference to `Practitioner/practitioner-2`
        *   `organization`: Reference to `Organization/org-for-role`
        *   `period.start`: A date far in the past (e.g., `[current_date] - 2 years`)
        *   `period.end`: A date in the past (e.g., `[current_date] - 1 year`)
    *   `PractitionerRole/pr-inactive-future`:
        *   `practitioner`: Reference to `Practitioner/practitioner-1`
        *   `organization`: Reference to `Organization/org-for-role`
        *   `period.start`: A date in the future (e.g., `[current_date] + 6 months`)
        *   `period.end`: A date further in the future (e.g., `[current_date] + 1 year`)
*   **Required FHIR Operations**:
    *   `POST` or `PUT` the above FHIR resources to the server to set up the test data.
    *   `GET [base]/PractitionerRole?date=ge[current_date]&_include=PractitionerRole:practitioner`
        *   Replace `[base]` with the FHIR server base URL.
        *   Replace `[current_date]` with the current date in `YYYY-MM-DD` format.
*   **Expected Outputs**:
    *   HTTP Status Code: 200 OK.
    *   Response Body: A FHIR `Bundle` resource.
    *   The `Bundle` should contain:
        *   `PractitionerRole/pr-active` resource.
        *   `PractitionerRole/pr-active-no-end` resource.
        *   `Practitioner/practitioner-1` resource (included because it's referenced by `pr-active` and `pr-active-no-end`).
    *   The `Bundle` should NOT contain:
        *   `PractitionerRole/pr-inactive-past`.
        *   `PractitionerRole/pr-inactive-future`.
        *   `Practitioner/practitioner-2` (unless it's also referenced by another active role not explicitly excluded here, which for this test setup, it is not).
*   **Validation Criteria**:
    1.  Verify the HTTP response status code is 200.
    2.  Verify the response body is a valid FHIR `Bundle`.
    3.  Verify `Bundle.type` is `searchset`.
    4.  Verify that the `Bundle.entry` array contains entries for `PractitionerRole/pr-active` and `PractitionerRole/pr-active-no-end`.
        *   For each of these `PractitionerRole` entries, `search.mode` should be `match`.
    5.  Verify that the `Bundle.entry` array contains an entry for `Practitioner/practitioner-1`.
        *   For this `Practitioner` entry, `search.mode` should be `include`.
    6.  Verify that the `Bundle.entry` array does NOT contain entries for `PractitionerRole/pr-inactive-past` or `PractitionerRole/pr-inactive-future`.
    7.  Verify that the `Bundle.entry` array does NOT contain an entry for `Practitioner/practitioner-2` (assuming it's only linked to the inactive role).
    8.  If the server does not support the `date` search parameter on `PractitionerRole`, this test may fail with a 400 Bad Request or return all PractitionerRoles. This failure should be noted as due to the discrepancy with the Capability Statement.

---

**Test Case 37.2: Search for Active Organizations**

*   **Objective**: Verify that a search for `OrganizationAffiliation` using the `date` parameter (with `ge[current_date]`) correctly returns active affiliations and includes the associated `Organization` resources.
*   **Required Inputs**:
    *   `Organization/org-1-primary`: A sample primary Organization.
    *   `Organization/org-2-participating-active`: A sample participating Organization.
    *   `OrganizationAffiliation/oa-active`:
        *   `primaryOrganization`: Reference to `Organization/org-1-primary`
        *   `participatingOrganization`: Reference to `Organization/org-2-participating-active`
        *   `period.start`: A date in the past (e.g., `[current_date] - 1 year`)
        *   `period.end`: A date in the future (e.g., `[current_date] + 1 year`)
    *   `OrganizationAffiliation/oa-active-no-end`:
        *   `primaryOrganization`: Reference to `Organization/org-1-primary`
        *   `participatingOrganization`: Reference to `Organization/org-2-participating-active` (or a different active one)
        *   `period.start`: A date in the past (e.g., `[current_date] - 6 months`)
        *   `period.end`: (null)
    *   `Organization/org-3-participating-inactive`: Another sample participating Organization.
    *   `OrganizationAffiliation/oa-inactive-past`:
        *   `primaryOrganization`: Reference to `Organization/org-1-primary`
        *   `participatingOrganization`: Reference to `Organization/org-3-participating-inactive`
        *   `period.start`: A date far in the past (e.g., `[current_date] - 2 years`)
        *   `period.end`: A date in the past (e.g., `[current_date] - 1 year`)
    *   `OrganizationAffiliation/oa-inactive-future`:
        *   `primaryOrganization`: Reference to `Organization/org-1-primary`
        *   `participatingOrganization`: Reference to `Organization/org-2-participating-active`
        *   `period.start`: A date in the future (e.g., `[current_date] + 6 months`)
        *   `period.end`: A date further in the future (e.g., `[current_date] + 1 year`)
*   **Required FHIR Operations**:
    *   `POST` or `PUT` the above FHIR resources to the server to set up the test data.
    *   `GET [base]/OrganizationAffiliation?date=ge[current_date]&_include=OrganizationAffiliation:participating-organization&_include=OrganizationAffiliation:primary-organization`
        *   Replace `[base]` with the FHIR server base URL.
        *   Replace `[current_date]` with the current date in `YYYY-MM-DD` format.
*   **Expected Outputs**:
    *   HTTP Status Code: 200 OK.
    *   Response Body: A FHIR `Bundle` resource.
    *   The `Bundle` should contain:
        *   `OrganizationAffiliation/oa-active` resource.
        *   `OrganizationAffiliation/oa-active-no-end` resource.
        *   `Organization/org-1-primary` resource (included).
        *   `Organization/org-2-participating-active` resource (included).
    *   The `Bundle` should NOT contain:
        *   `OrganizationAffiliation/oa-inactive-past`.
        *   `OrganizationAffiliation/oa-inactive-future`.
        *   `Organization/org-3-participating-inactive` (unless it's also referenced by another active affiliation not explicitly excluded here).
*   **Validation Criteria**:
    1.  Verify the HTTP response status code is 200.
    2.  Verify the response body is a valid FHIR `Bundle`.
    3.  Verify `Bundle.type` is `searchset`.
    4.  Verify that the `Bundle.entry` array contains entries for `OrganizationAffiliation/oa-active` and `OrganizationAffiliation/oa-active-no-end`.
        *   For each of these `OrganizationAffiliation` entries, `search.mode` should be `match`.
    5.  Verify that the `Bundle.entry` array contains entries for `Organization/org-1-primary` and `Organization/org-2-participating-active`.
        *   For these `Organization` entries, `search.mode` should be `include`.
    6.  Verify that the `Bundle.entry` array does NOT contain entries for `OrganizationAffiliation/oa-inactive-past` or `OrganizationAffiliation/oa-inactive-future`.
    7.  Verify that the `Bundle.entry` array does NOT contain an entry for `Organization/org-3-participating-inactive` (assuming it's only linked to the inactive affiliation).
    8.  If the server does not support the `date` search parameter on `OrganizationAffiliation`, this test may fail with a 400 Bad Request or return all OrganizationAffiliations. This failure should be noted as due to the discrepancy with the Capability Statement.

---

This test specification provides a structured approach to verifying REQ-37, while also acknowledging and addressing the potential inconsistencies between the requirement's example and the provided Capability Statement information.

---



<a id='plan-net-organization'></a>

## Plan-Net Organization

<a id='req-34'></a>

### REQ-34: Organization search by name

**Description**: "The Plan-Net design is based around the following types of searches: Organization by Name - Example: Montgomery Cardiology or CVS - Focal Resource and Field: Organization.name - Qualifications of Search: Location, network, specialty."

**Actor**: Health Plan API

**Conformance**: None (Design requirement)

Okay, here's a comprehensive test specification for REQ-34, taking into account the provided Capability Statement information.

## FHIR Implementation Guide Test Specification

---

**1. Requirement ID**

REQ-34

---

**2. Requirement Analysis**

*   **Summary**: Organization search by name.
*   **Description**: "The Plan-Net design is based around the following types of searches: Organization by Name - Example: Montgomery Cardiology or CVS - Focal Resource and Field: Organization.name - Qualifications of Search: Location, network, specialty."
*   **Actor**: Health Plan API
*   **Focal Resource**: Organization
*   **Primary Search Field**: `Organization.name`

*   **Testability Assessment**: Automatically testable. The requirement involves API interactions (searches) that can be automated and whose responses can be programmatically verified.
*   **Complexity**: Moderate. While the base search by name is simple, the "qualifications" (Location, network, specialty) require combining multiple search parameters and understanding how these concepts map to FHIR Organization attributes and supported search parameters.
*   **Prerequisites**:
    *   A running instance of the Health Plan API FHIR server.
    *   The FHIR server must be populated with a diverse set of `Organization` resources that allow for testing various name searches and qualification combinations. This includes:
        *   Organizations with different names (exact, partial, case variations).
        *   Organizations with varying `address` details (for location qualification).
        *   Organizations linked via `partof` to represent networks.
        *   Organizations with different `type` codes (representing specialties and potentially network types).
        *   At least one `Location` resource that can be referenced by `Organization.coverage-area` if testing that specific qualification path.
    *   Knowledge of specific codes used for `Organization.type` (e.g., for "Cardiology," "Pharmacy," "Hospital Network").
    *   If `partof` is used for network qualification, the IDs of parent "network" Organizations must be known.

---

**3. Test Implementation Strategy**

The strategy involves constructing various GET requests to the `Organization` endpoint, using the `name` search parameter, and progressively adding other supported search parameters to test the "qualifications."

*   **Required Inputs (Example Data Setup)**:
    Assume the following FHIR `Organization` resources are pre-loaded on the server. (Note: `id` values are illustrative).

    *   **Org1 (Montgomery Cardiology Anytown)**
        *   `id`: `org-montgomery-cardiology-anytown`
        *   `name`: "Montgomery Cardiology"
        *   `alias`: ["Monty Cardio"]
        *   `type`: `[{ "coding": [{ "system": "http://example.org/fhir/organization-type", "code": "prov", "display": "Healthcare Provider" }] }, { "coding": [{ "system": "http://nucc.org/provider-taxonomy", "code": "207RC0000X", "display": "Cardiology" }] }]` (Specialty)
        *   `address`: `[{ "city": "Anytown", "state": "TX", "postalCode": "75001", "text": "123 Heart Lane, Anytown, TX 75001" }]` (Location)
        *   `partOf`: `{ "reference": "Organization/org-healthnet-alpha" }` (Network)

    *   **Org2 (CVS Pharmacy Anytown)**
        *   `id`: `org-cvs-anytown`
        *   `name`: "CVS Pharmacy"
        *   `type`: `[{ "coding": [{ "system": "http://example.org/fhir/organization-type", "code": "prov", "display": "Healthcare Provider" }] }, { "coding": [{ "system": "http://nucc.org/provider-taxonomy", "code": "3336C0003X", "display": "Community/Retail Pharmacy" }] }]` (Specialty)
        *   `address`: `[{ "city": "Anytown", "state": "TX", "postalCode": "75002", "text": "456 Health St, Anytown, TX 75002" }]`

    *   **Org3 (Montgomery General Hospital)**
        *   `id`: `org-montgomery-general`
        *   `name`: "Montgomery General Hospital"
        *   `type`: `[{ "coding": [{ "system": "http://example.org/fhir/organization-type", "code": "prov", "display": "Healthcare Provider" }] }, { "coding": [{ "system": "http://nucc.org/provider-taxonomy", "code": "282N00000X", "display": "General Acute Care Hospital" }] }]`
        *   `address`: `[{ "city": "Otherville", "state": "TX", "postalCode": "75010", "text": "789 Wellness Blvd, Otherville, TX 75010" }]`
        *   `partOf`: `{ "reference": "Organization/org-healthnet-alpha" }` (Network)

    *   **Org4 (HealthNet Alpha - Network Org)**
        *   `id`: `org-healthnet-alpha`
        *   `name`: "HealthNet Alpha"
        *   `type`: `[{ "coding": [{ "system": "http://example.org/fhir/organization-type", "code": "ntwk", "display": "Healthcare Network" }] }]`

    *   **Org5 (Cardiology Associates of Otherville)**
        *   `id`: `org-cardiology-otherville`
        *   `name`: "Cardiology Associates of Otherville"
        *   `type`: `[{ "coding": [{ "system": "http://example.org/fhir/organization-type", "code": "prov", "display": "Healthcare Provider" }] }, { "coding": [{ "system": "http://nucc.org/provider-taxonomy", "code": "207RC0000X", "display": "Cardiology" }] }]` (Specialty)
        *   `address`: `[{ "city": "Otherville", "state": "TX", "postalCode": "75011", "text": "321 Pulse Ave, Otherville, TX 75011" }]`
        *   `partOf`: `{ "reference": "Organization/org-healthnet-beta" }` (Network)

*   **Required FHIR Operations**:
    *   `Search`: `GET [base]/Organization?...`
    This operation is implicitly supported as the Capability Statement lists supported search parameters for the Organization resource.

*   **Validation Criteria (General for all test cases)**:
    1.  The HTTP response status code MUST be `200 OK`.
    2.  The response body MUST be a valid FHIR `Bundle` resource.
    3.  The `Bundle.type` MUST be `searchset`.
    4.  Each entry in the `Bundle.entry` array, if present, MUST contain an `Organization` resource that matches the search criteria.
    5.  The `Bundle.total` SHOULD accurately reflect the number of matching resources on the server.
    6.  Resources not matching the criteria MUST NOT be present in the `Bundle.entry`.

---

**Test Cases**

**Test Case 34.1: Search by Exact Name**
*   **Description**: Verifies basic search by an exact organization name.
*   **Inputs**:
    *   Search Parameter: `name=Montgomery Cardiology`
*   **FHIR Operation**: `GET [base]/Organization?name=Montgomery%20Cardiology`
*   **Expected Output**:
    *   A FHIR Bundle containing `Org1 (Montgomery Cardiology Anytown)`.
    *   `Bundle.total` should be 1 (assuming no other exact matches).
*   **Validation Specifics**:
    *   Verify `Org1` is present.
    *   Verify other organizations (e.g., `Org2`, `Org3`) are not present.

**Test Case 34.2: Search by Partial Name (Prefix)**
*   **Description**: Verifies search by a partial organization name (assuming prefix matching is default for string search).
*   **Inputs**:
    *   Search Parameter: `name=Montgomery`
*   **FHIR Operation**: `GET [base]/Organization?name=Montgomery`
*   **Expected Output**:
    *   A FHIR Bundle containing `Org1 (Montgomery Cardiology Anytown)` and `Org3 (Montgomery General Hospital)`.
    *   `Bundle.total` should be 2.
*   **Validation Specifics**:
    *   Verify `Org1` and `Org3` are present.
    *   Verify other organizations (e.g., `Org2`) are not present.

**Test Case 34.3: Search by Name (Case Insensitive)**
*   **Description**: Verifies that name search is case-insensitive (common FHIR server behavior for string parameters).
*   **Inputs**:
    *   Search Parameter: `name=montgomery cardiology`
*   **FHIR Operation**: `GET [base]/Organization?name=montgomery%20cardiology`
*   **Expected Output**:
    *   A FHIR Bundle containing `Org1 (Montgomery Cardiology Anytown)`.
    *   `Bundle.total` should be 1.
*   **Validation Specifics**:
    *   Verify `Org1` is present.

**Test Case 34.4: Search by Name with Location Qualification (Address String)**
*   **Description**: Verifies search by name qualified by a part of the address (e.g., city). The `address` search parameter matches any part of the address string.
*   **Inputs**:
    *   Search Parameters: `name=Montgomery`, `address=Anytown`
*   **FHIR Operation**: `GET [base]/Organization?name=Montgomery&address=Anytown`
*   **Expected Output**:
    *   A FHIR Bundle containing `Org1 (Montgomery Cardiology Anytown)`.
    *   `Org3 (Montgomery General Hospital)` should NOT be present as its address is "Otherville".
    *   `Bundle.total` should be 1.
*   **Validation Specifics**:
    *   Verify `Org1` is present.
    *   Verify `Org3` is not present.

**Test Case 34.5: Search by Name with Network Qualification (partOf)**
*   **Description**: Verifies search by name qualified by network affiliation using `partof`.
*   **Inputs**:
    *   Search Parameters: `name=Montgomery`, `partof=Organization/org-healthnet-alpha`
*   **FHIR Operation**: `GET [base]/Organization?name=Montgomery&partof=Organization/org-healthnet-alpha`
*   **Expected Output**:
    *   A FHIR Bundle containing `Org1 (Montgomery Cardiology Anytown)` and `Org3 (Montgomery General Hospital)`.
    *   `Bundle.total` should be 2.
*   **Validation Specifics**:
    *   Verify `Org1` and `Org3` are present.

**Test Case 34.6: Search by Name with Specialty Qualification (type)**
*   **Description**: Verifies search by name qualified by specialty using `type`.
*   **Inputs**:
    *   Search Parameters: `name=Cardiology`, `type=http://nucc.org/provider-taxonomy|207RC0000X` (NUCC code for Cardiology)
*   **FHIR Operation**: `GET [base]/Organization?name=Cardiology&type=http%3A%2F%2Fnucc.org%2Fprovider-taxonomy%7C207RC0000X`
*   **Expected Output**:
    *   A FHIR Bundle containing `Org1 (Montgomery Cardiology Anytown)` and `Org5 (Cardiology Associates of Otherville)`.
    *   `Bundle.total` should be 2.
*   **Validation Specifics**:
    *   Verify `Org1` and `Org5` are present.
    *   Ensure organizations with other specialties are not returned if their name matched "Cardiology".

**Test Case 34.7: Search by Name with Multiple Qualifications (Location, Specialty)**
*   **Description**: Verifies search by name with combined qualifications for location (address) and specialty (type).
*   **Inputs**:
    *   Search Parameters: `name=Cardiology`, `address=Anytown`, `type=http://nucc.org/provider-taxonomy|207RC0000X`
*   **FHIR Operation**: `GET [base]/Organization?name=Cardiology&address=Anytown&type=http%3A%2F%2Fnucc.org%2Fprovider-taxonomy%7C207RC0000X`
*   **Expected Output**:
    *   A FHIR Bundle containing `Org1 (Montgomery Cardiology Anytown)`.
    *   `Org5 (Cardiology Associates of Otherville)` should not be present (wrong city).
    *   `Bundle.total` should be 1.
*   **Validation Specifics**:
    *   Verify `Org1` is present.
    *   Verify `Org5` is not present.

**Test Case 34.8: Search by Name with Network Qualification (type for network)**
*   **Description**: Verifies search for organizations that are part of a network, where the network itself is identified by a `type` (if networks are also modeled with specific types). This tests finding members of a network type, not a specific parent network.
    *Note: This interpretation of "network qualification" might be secondary to `partOf`. The primary way to find organizations *in* a network is `partOf`. This test case explores if `type` can be used to find organizations that *are* networks or belong to a certain *category* of network/provider.*
    If the intent is to find organizations *of type* "Network", the search would be `type=[network_type_code]`. If the intent is to find organizations *within* a network, `partOf` is more direct.
    Let's assume the qualification means finding organizations *of a certain type* (e.g. "Healthcare Provider") that also match a name.
*   **Inputs**:
    *   Search Parameters: `name=HealthNet Alpha`, `type=http://example.org/fhir/organization-type|ntwk`
*   **FHIR Operation**: `GET [base]/Organization?name=HealthNet%20Alpha&type=http%3A%2F%2Fexample.org%2Ffhir%2Forganization-type%7Cntwk`
*   **Expected Output**:
    *   A FHIR Bundle containing `Org4 (HealthNet Alpha)`.
    *   `Bundle.total` should be 1.
*   **Validation Specifics**:
    *   Verify `Org4` is present.

**Test Case 34.9: Search by Name - No Matching Results**
*   **Description**: Verifies behavior when no organizations match the name criteria.
*   **Inputs**:
    *   Search Parameter: `name=NonExistentMedicalGroupXYZ`
*   **FHIR Operation**: `GET [base]/Organization?name=NonExistentMedicalGroupXYZ`
*   **Expected Output**:
    *   A FHIR Bundle.
    *   `Bundle.total` MUST be 0.
    *   `Bundle.entry` SHOULD be empty or absent.
*   **Validation Specifics**:
    *   Verify `Bundle.total` is 0.

**Test Case 34.10: Search by Name using Alias**
*   **Description**: Verifies if the `name` search parameter also considers `Organization.alias`. (Standard FHIR `name` search parameter typically searches `Organization.name` and `Organization.alias`).
*   **Inputs**:
    *   Search Parameter: `name=Monty Cardio`
*   **FHIR Operation**: `GET [base]/Organization?name=Monty%20Cardio`
*   **Expected Output**:
    *   A FHIR Bundle containing `Org1 (Montgomery Cardiology Anytown)`.
    *   `Bundle.total` should be 1.
*   **Validation Specifics**:
    *   Verify `Org1` is present.

**Test Case 34.11: Search by Name with `coverage-area` Qualification (if applicable data exists)**
*   **Description**: Verifies search by name qualified by `coverage-area` if an Organization references a Location via this parameter.
    *Prerequisite: Org1 has `coverageArea: { reference: "Location/loc-anytown-region" }` and `Location/loc-anytown-region` exists.*
*   **Inputs**:
    *   Search Parameters: `name=Montgomery Cardiology`, `coverage-area=Location/loc-anytown-region`
*   **FHIR Operation**: `GET [base]/Organization?name=Montgomery%20Cardiology&coverage-area=Location/loc-anytown-region`
*   **Expected Output**:
    *   A FHIR Bundle containing `Org1 (Montgomery Cardiology Anytown)`.
    *   `Bundle.total` should be 1.
*   **Validation Specifics**:
    *   Verify `Org1` is present. This test case depends heavily on specific data setup for `coverage-area`.

---

This test specification provides a good range of scenarios to verify REQ-34 against the Health Plan API's declared capabilities. Each test case focuses on a specific aspect of the requirement or a combination of qualifications.

---

<a id='req-38'></a>

### REQ-38: Network contact handling for departments

**Description**: "When the contact is a department name, rather than a human (e.g., patient help line), include a blank family and given name, and provide the department name in contact.name.text."

**Actor**: Health Plan API

**Conformance**: None (Implementation guidance)

Okay, here's a structured test specification for REQ-38.

---

## FHIR Implementation Guide Test Specification

### 1. Requirement ID

REQ-38

### 2. Requirement Analysis

*   **Summary**: Network contact handling for departments
*   **Description**: "When the contact is a department name, rather than a human (e.g., patient help line), include a blank family and given name, and provide the department name in contact.name.text."
*   **Verification**: Inspection
*   **Actor**: Health Plan API
*   **Conformance**: None (Implementation guidance)
*   **Conditional**: True (Applies when the contact is a department)

---

*   **Testability Assessment**:
    *   **Manual Inspection / Attestation**.
    *   **Reasoning**:
        *   The condition "When the contact is a department name" is semantic and cannot be automatically determined by a validator without external knowledge.
        *   While a validator *could* check for the presence of blank `family` and `given` names and a populated `text` field, it cannot verify that the `text` field *correctly represents* the department name.
        *   The "Verification: Inspection" and "Conformance: None (Implementation guidance)" further support that this is not a strict, automatically enforceable rule but a best practice to be checked manually or attested to.

*   **Complexity**:
    *   **Simple**.
    *   **Reasoning**: The requirement involves checking specific fields within a standard FHIR data type (`HumanName`) for specific content (blank or populated). No complex logic or interactions are involved.

*   **Prerequisites**:
    1.  The Health Plan API endpoint must be accessible.
    2.  Authentication/Authorization: The test client must be authenticated and authorized to access the relevant FHIR resources (e.g., `Organization`, `HealthcareService`, or whichever resource type contains the contact information in question).
    3.  Test Data: At least one resource instance (e.g., an `Organization`) must exist on the Health Plan API server that:
        *   Is intended to represent an entity with a department contact (e.g., "Patient Help Line," "Billing Department").
        *   The tester must know the identifier or be able to search for this specific resource.
        *   The tester must know the expected department name for this contact.
    4.  The specific FHIR resource type and path to the `contact.name` element being tested must be identified (e.g., `Organization.contact.name`, `HealthcareService.contactPoint` if it uses `HumanName` for organization contacts, though `contactPoint` typically uses `string` for name). Given `contact.name.text`, `Organization.contact.name` is the most likely candidate.

### 3. Test Implementation Strategy

*   **Test Case ID**: TC-REQ-38-001
*   **Test Case Title**: Verify Department Contact Name Handling

*   **Required inputs including required FHIR resources and expected outputs for the test**:

    *   **Input**:
        *   Identifier (e.g., logical ID, business identifier) of a FHIR resource (e.g., `Organization`) on the Health Plan API that is known to have a contact point representing a department.
        *   The expected department name string (e.g., "Patient Help Line").

    *   **Example FHIR Resource Snippet (Illustrative - for an `Organization` resource)**:
        If an `Organization` resource with ID `org-example-dept` has a "Patient Help Line" contact, the relevant part of the resource fetched from the API should look like this:

        ```json
        {
          "resourceType": "Organization",
          "id": "org-example-dept",
          // ... other Organization elements
          "contact": [
            {
              // ... other contact elements like purpose, telecom, address
              "name": {
                "text": "Patient Help Line", // Department name
                "family": "",               // Blank family name
                "given": [""]               // Blank given name (or empty array [])
                // "given": [] // Also acceptable for blank
              }
            }
            // ... other contacts if any
          ]
          // ... other Organization elements
        }
        ```

    *   **Expected Output**:
        *   The FHIR resource is successfully retrieved from the Health Plan API.
        *   The relevant `contact.name` element for the department contact within the retrieved resource:
            *   Contains a `text` sub-element populated with the correct department name.
            *   Contains a `family` sub-element that is present and holds an empty string.
            *   Contains a `given` sub-element that is present and holds an array containing a single empty string, or an empty array.

*   **Required FHIR Operations**:
    *   The Capability Statement mentions "General Capabilities." Assuming this implies support for standard RESTful interactions for the relevant resource (e.g., `Organization`).
    *   **`read`**: `GET [BaseURL]/[ResourceType]/[id]`
        *   Example: `GET https://api.healthplan.example.com/fhir/Organization/org-example-dept`
    *   **`search`**: `GET [BaseURL]/[ResourceType]?[search_parameter]=[value]` (if the ID is not known beforehand, to locate a suitable resource for inspection).
        *   Example: `GET https://api.healthplan.example.com/fhir/Organization?name=Example%20Clinic` (then inspect contacts)

*   **Validation Criteria (to be performed via Inspection)**:

    1.  **Pre-condition**: Identify a resource (e.g., `Organization`) on the Health Plan API that is documented or known to have a contact point representing a department (e.g., "Patient Help Line", "Billing Department"). Note the expected department name.
    2.  **Action**: Retrieve this specific resource instance from the Health Plan API using a `read` or `search` operation.
    3.  **Inspect**: Locate the `contact` array within the retrieved resource. For the element in the `contact` array that represents the department:
        *   **VC1 (Department Name in Text)**: Verify that the `contact.name.text` element exists and its value is a string matching the expected department name (e.g., "Patient Help Line").
            *   *Pass*: `contact.name.text` is present and matches the known department name.
            *   *Fail*: `contact.name.text` is absent, empty, or does not match the known department name.
        *   **VC2 (Blank Family Name)**: Verify that the `contact.name.family` element exists and its value is an empty string (`""`).
            *   *Pass*: `contact.name.family` is present and is `""`.
            *   *Fail*: `contact.name.family` is absent or contains a non-empty string.
        *   **VC3 (Blank Given Name)**: Verify that the `contact.name.given` element exists and its value is an array containing a single empty string (`[""]`) or an empty array (`[]`).
            *   *Pass*: `contact.name.given` is present and is `[""]` or `[]`.
            *   *Fail*: `contact.name.given` is absent or contains any non-empty strings or is structured differently.

    *   **Overall Test Result**:
        *   **Pass**: All Validation Criteria (VC1, VC2, VC3) pass for the identified department contact.
        *   **Fail**: Any Validation Criterion fails.
        *   **Not Applicable**: No suitable resource with a department contact could be identified or retrieved for testing.

---

---



<a id='plan-net-organizationaffiliation'></a>

## Plan-Net OrganizationAffiliation

<a id='req-36'></a>

### REQ-36: Organization search by specialty

**Description**: "The Plan-Net design is based around the following types of searches: Organization by specialty - Example: Compounding Pharmacy - Focal Resource and Field: OrganizationAffiliation.specialty - Qualifications of Search: Location, network, name."

**Actor**: Health Plan API

**Conformance**: None (Design requirement)

Okay, let's break down REQ-36 and create a comprehensive test specification based on the provided information.

## FHIR Implementation Guide Test Specification

### 1. Requirement ID
REQ-36

### 2. Requirement Analysis

*   **Summary**: Organization search by specialty.
*   **Description**: The core of this requirement is to find `Organization` resources based on their `specialty`. The description explicitly states "Focal Resource and Field: OrganizationAffiliation.specialty". This means the search will primarily target the `OrganizationAffiliation` resource, and from there, we will derive the associated `Organization`(s).
*   **Qualifications**: The search can be further qualified by:
    *   Location (likely attributes of the `Location` resource associated with the `OrganizationAffiliation` or `Organization`).
    *   Network (the `network` field in `OrganizationAffiliation`).
    *   Name (the `name` field of the `Organization` resource itself).

*   **Testability Assessment**: Automatically testable.
    *   The requirement involves API search operations which can be automated. The presence of `specialty` on `OrganizationAffiliation` and various search parameters on `OrganizationAffiliation`, `Organization`, and `Location` in the Capability Statement confirms this.

*   **Complexity**: Moderate.
    *   The search involves interactions between multiple resource types (`Organization`, `OrganizationAffiliation`, `Location`, and potentially `Organization` for network).
    *   Combining multiple qualification criteria will require careful test data setup and query construction.
    *   The "focal resource" being `OrganizationAffiliation` means that to get the `Organization` details, we'll likely need to use `_include` or make subsequent calls.

*   **Prerequisites**:
    1.  **FHIR Server Setup**: A FHIR server compliant with the Health Plan API IG, supporting the specified search parameters on `Organization`, `Location`, and `OrganizationAffiliation` resources as per the Capability Statement.
    2.  **Test Data**:
        *   At least one `Organization` resource (OrgA) that will be the target of the search (e.g., "Happy Valley Clinic").
        *   At least one `Organization` resource (OrgB - NetworkOrg) acting as a healthcare network (e.g., "United Health Network").
        *   At least one `Location` resource (Loc1) associated with OrgA, with specific address details (city, state, postal code).
        *   At least one `OrganizationAffiliation` resource (OrgAff1) that:
            *   Links OrgA (e.g., via `participatingOrganization` or `primaryOrganization` - let's assume `participatingOrganization` refers to the provider OrgA).
            *   Specifies a `specialty` (e.g., `specialty=[system]|[code]` for "Compounding Pharmacy").
            *   Optionally links to Loc1 via the `location` field.
            *   Optionally links to OrgB (NetworkOrg) via the `network` field.
        *   Test data should also include resources that *do not* match the search criteria to ensure precision of search results. For example:
            *   An `OrganizationAffiliation` (OrgAff2) with a *different* specialty for OrgA.
            *   An `OrganizationAffiliation` (OrgAff3) with the *same* specialty but for a *different* organization (OrgC).
            *   An `OrganizationAffiliation` (OrgAff4) with the same specialty and organization, but linked to a different network or location.
    3.  **Terminology**: Defined codes and systems for `specialty` (e.g., NUCC, or a custom system). For the example "Compounding Pharmacy", a specific code from a recognized system should be used.

### 3. Test Implementation Strategy

The strategy will involve constructing GET requests to the FHIR server, targeting the `OrganizationAffiliation` resource primarily, and then verifying the returned bundle. We will use `_include` to fetch related `Organization` resources where appropriate.

*   **Required FHIR Operations**:
    *   `GET /OrganizationAffiliation?...` (Search)
    *   `GET /Organization?...` (Search, for name qualification if done in two steps)
    *   `GET /Location?...` (Search, for location qualification if done in two steps)
    *   Implicitly, the server must support `_include` for `OrganizationAffiliation:participating-organization` (or `primary-organization`) and potentially `OrganizationAffiliation:location` to make tests more efficient and reflect common usage. If `_include` is not supported for these, tests will require additional `GET` requests for referenced resources. We will assume `_include` is generally available for referenced resources.

*   **Validation Criteria**:
    *   HTTP Status Code: 200 OK for successful searches.
    *   Bundle Structure: Response is a valid FHIR searchset Bundle.
    *   Resource Count: `Bundle.total` reflects the number of matching resources.
    *   Content Validation:
        *   Returned `OrganizationAffiliation` resources match all specified search criteria.
        *   If `_include` is used, the Bundle contains the correct included `Organization` and/or `Location` resources.
        *   No resources that *do not* meet the criteria are returned.

---

**Test Cases:**

**Test Case 36.1: Search OrganizationAffiliation by Specialty**

*   **Objective**: Verify that organizations can be found based on their specialty via `OrganizationAffiliation`.
*   **Required Inputs**:
    *   `OrganizationAffiliation` (OrgAff1) with `specialty = S_CompoundingPharmacySystem|C_CompoundingPharmacyCode`.
    *   OrgAff1 references `participatingOrganization = OrgA`.
*   **FHIR Operation**:
    `GET [FHIR_BASE_URL]/OrganizationAffiliation?specialty=S_CompoundingPharmacySystem|C_CompoundingPharmacyCode&_include=OrganizationAffiliation:participating-organization`
*   **Expected Output**:
    *   HTTP 200 OK.
    *   A Bundle containing OrgAff1.
    *   The Bundle also contains OrgA (due to `_include`).
*   **Validation Criteria**:
    1.  Response is HTTP 200 OK.
    2.  Response is a valid FHIR Bundle.
    3.  The Bundle contains at least one `OrganizationAffiliation` resource.
    4.  Each returned `OrganizationAffiliation` resource has `specialty` matching `S_CompoundingPharmacySystem|C_CompoundingPharmacyCode`.
    5.  For each matching `OrganizationAffiliation`, its referenced `participatingOrganization` (OrgA) is present in the Bundle.

**Test Case 36.2: Search OrganizationAffiliation by Specialty and Network**

*   **Objective**: Verify search by specialty qualified by network.
*   **Required Inputs**:
    *   OrgAff1 with `specialty = S_CompoundingPharmacySystem|C_CompoundingPharmacyCode` and `network = Reference(Organization/OrgB_NetworkID)`.
    *   OrgAff1 references `participatingOrganization = OrgA`.
    *   OrgAff_OtherNetwork with `specialty = S_CompoundingPharmacySystem|C_CompoundingPharmacyCode` but `network = Reference(Organization/OtherNetworkID)`.
*   **FHIR Operation**:
    `GET [FHIR_BASE_URL]/OrganizationAffiliation?specialty=S_CompoundingPharmacySystem|C_CompoundingPharmacyCode&network=Organization/OrgB_NetworkID&_include=OrganizationAffiliation:participating-organization`
*   **Expected Output**:
    *   HTTP 200 OK.
    *   A Bundle containing OrgAff1.
    *   The Bundle also contains OrgA.
    *   OrgAff_OtherNetwork is NOT in the Bundle.
*   **Validation Criteria**:
    1.  Response is HTTP 200 OK.
    2.  Response is a valid FHIR Bundle.
    3.  The Bundle contains at least one `OrganizationAffiliation` resource.
    4.  Each returned `OrganizationAffiliation` resource has `specialty` matching `S_CompoundingPharmacySystem|C_CompoundingPharmacyCode` AND `network` referencing `Organization/OrgB_NetworkID`.
    5.  For each matching `OrganizationAffiliation`, its referenced `participatingOrganization` (OrgA) is present in the Bundle.

**Test Case 36.3: Search OrganizationAffiliation by Specialty and Location (referenced Location ID)**

*   **Objective**: Verify search by specialty qualified by a specific Location ID.
*   **Required Inputs**:
    *   OrgAff1 with `specialty = S_CompoundingPharmacySystem|C_CompoundingPharmacyCode` and `location = Reference(Location/Loc1_ID)`.
    *   OrgAff1 references `participatingOrganization = OrgA`.
    *   OrgAff_OtherLocation with `specialty = S_CompoundingPharmacySystem|C_CompoundingPharmacyCode` but `location = Reference(Location/OtherLocID)`.
*   **FHIR Operation**:
    `GET [FHIR_BASE_URL]/OrganizationAffiliation?specialty=S_CompoundingPharmacySystem|C_CompoundingPharmacyCode&location=Location/Loc1_ID&_include=OrganizationAffiliation:participating-organization&_include=OrganizationAffiliation:location`
*   **Expected Output**:
    *   HTTP 200 OK.
    *   A Bundle containing OrgAff1.
    *   The Bundle also contains OrgA and Loc1.
    *   OrgAff_OtherLocation is NOT in the Bundle.
*   **Validation Criteria**:
    1.  Response is HTTP 200 OK.
    2.  Response is a valid FHIR Bundle.
    3.  The Bundle contains at least one `OrganizationAffiliation` resource.
    4.  Each returned `OrganizationAffiliation` resource has `specialty` matching `S_CompoundingPharmacySystem|C_CompoundingPharmacyCode` AND `location` referencing `Location/Loc1_ID`.
    5.  For each matching `OrganizationAffiliation`, its referenced `participatingOrganization` (OrgA) and `location` (Loc1) are present in the Bundle.

**Test Case 36.4: Search OrganizationAffiliation by Specialty and Location (attributes like city/postalcode) - Chained Search (if supported) or Two-Step**

*   **Objective**: Verify search by specialty qualified by location attributes (e.g., city).
    *   *Assumption*: The CapabilityStatement for `OrganizationAffiliation` does not explicitly list chained search parameters like `location.address-city`. Therefore, a two-step approach is more robustly testable based *only* on the provided CS. If chained search `location:Location.address-city` were supported on `OrganizationAffiliation`, it would be a single call.

*   **Required Inputs**:
    *   Loc1 with `address.city = "HappyVille"`.
    *   OrgAff1 with `specialty = S_CompoundingPharmacySystem|C_CompoundingPharmacyCode` and `location = Reference(Location/Loc1_ID)`.
    *   OrgAff1 references `participatingOrganization = OrgA`.
    *   Loc2 with `address.city = "SadTown"`.
    *   OrgAff_OtherCity with `specialty = S_CompoundingPharmacySystem|C_CompoundingPharmacyCode` and `location = Reference(Location/Loc2_ID)`.
*   **FHIR Operations (Two-Step)**:
    1.  `GET [FHIR_BASE_URL]/Location?address-city=HappyVille`
        *   *Expected*: Returns a Bundle containing Loc1. Extract `Loc1_ID`.
    2.  `GET [FHIR_BASE_URL]/OrganizationAffiliation?specialty=S_CompoundingPharmacySystem|C_CompoundingPharmacyCode&location=Location/[Extracted_Loc1_ID]&_include=OrganizationAffiliation:participating-organization&_include=OrganizationAffiliation:location`
*   **Expected Output (for step 2)**:
    *   HTTP 200 OK.
    *   A Bundle containing OrgAff1.
    *   The Bundle also contains OrgA and Loc1.
    *   OrgAff_OtherCity is NOT in the Bundle.
*   **Validation Criteria**:
    1.  Response for step 1 is HTTP 200 OK and returns Loc1.
    2.  Response for step 2 is HTTP 200 OK.
    3.  Response for step 2 is a valid FHIR Bundle.
    4.  The Bundle (step 2) contains at least one `OrganizationAffiliation` resource.
    5.  Each returned `OrganizationAffiliation` resource (step 2) has `specialty` matching `S_CompoundingPharmacySystem|C_CompoundingPharmacyCode` AND `location` referencing `Location/[Extracted_Loc1_ID]`.
    6.  For each matching `OrganizationAffiliation`, its referenced `participatingOrganization` (OrgA) and `location` (Loc1) are present in the Bundle.

**Test Case 36.5: Search OrganizationAffiliation by Specialty and Organization Name**

*   **Objective**: Verify search by specialty qualified by the name of the participating organization.
    *   *Strategy*: Search `Organization` by name first, then use its ID to filter `OrganizationAffiliation`.

*   **Required Inputs**:
    *   OrgA with `name = "Happy Valley Clinic"`. (ID: OrgA_ID)
    *   OrgAff1 with `specialty = S_CompoundingPharmacySystem|C_CompoundingPharmacyCode` and `participatingOrganization = Reference(Organization/OrgA_ID)`.
    *   OrgC with `name = "Other Clinic"`. (ID: OrgC_ID)
    *   OrgAff_OtherOrg with `specialty = S_CompoundingPharmacySystem|C_CompoundingPharmacyCode` but `participatingOrganization = Reference(Organization/OrgC_ID)`.
*   **FHIR Operations (Two-Step)**:
    1.  `GET [FHIR_BASE_URL]/Organization?name=Happy Valley Clinic`
        *   *Expected*: Returns a Bundle containing OrgA. Extract `OrgA_ID`.
    2.  `GET [FHIR_BASE_URL]/OrganizationAffiliation?specialty=S_CompoundingPharmacySystem|C_CompoundingPharmacyCode&participating-organization=Organization/[Extracted_OrgA_ID]&_include=OrganizationAffiliation:participating-organization`
*   **Expected Output (for step 2)**:
    *   HTTP 200 OK.
    *   A Bundle containing OrgAff1.
    *   The Bundle also contains OrgA.
    *   OrgAff_OtherOrg is NOT in the Bundle.
*   **Validation Criteria**:
    1.  Response for step 1 is HTTP 200 OK and returns OrgA.
    2.  Response for step 2 is HTTP 200 OK.
    3.  Response for step 2 is a valid FHIR Bundle.
    4.  The Bundle (step 2) contains at least one `OrganizationAffiliation` resource.
    5.  Each returned `OrganizationAffiliation` resource (step 2) has `specialty` matching `S_CompoundingPharmacySystem|C_CompoundingPharmacyCode` AND `participatingOrganization` referencing `Organization/[Extracted_OrgA_ID]`.
    6.  The referenced `participatingOrganization` (OrgA) is present in the Bundle.

**Test Case 36.6: Search OrganizationAffiliation by Specialty, Network, Location (ID), and Organization Name (Combined)**

*   **Objective**: Verify search by specialty qualified by all criteria: network, location, and organization name.
*   **Required Inputs**:
    *   OrgA with `name = "Happy Valley Clinic"`. (ID: OrgA_ID)
    *   Loc1 with `address.city = "HappyVille"`. (ID: Loc1_ID)
    *   OrgB_Network with `name = "United Health Network"`. (ID: OrgB_NetworkID)
    *   OrgAff_Target:
        *   `specialty = S_CompoundingPharmacySystem|C_CompoundingPharmacyCode`
        *   `participatingOrganization = Reference(Organization/OrgA_ID)`
        *   `network = Reference(Organization/OrgB_NetworkID)`
        *   `location = Reference(Location/Loc1_ID)`
    *   Other `OrganizationAffiliation` resources that miss one or more of these criteria.
*   **FHIR Operations (Two-Step, assuming name search is separate)**:
    1.  `GET [FHIR_BASE_URL]/Organization?name=Happy Valley Clinic`
        *   *Expected*: Returns a Bundle containing OrgA. Extract `OrgA_ID`.
    2.  `GET [FHIR_BASE_URL]/OrganizationAffiliation?specialty=S_CompoundingPharmacySystem|C_CompoundingPharmacyCode&participating-organization=Organization/[Extracted_OrgA_ID]&network=Organization/OrgB_NetworkID&location=Location/Loc1_ID&_include=OrganizationAffiliation:participating-organization&_include=OrganizationAffiliation:location&_include=OrganizationAffiliation:network`
*   **Expected Output (for step 2)**:
    *   HTTP 200 OK.
    *   A Bundle containing OrgAff_Target.
    *   The Bundle also contains OrgA, Loc1, and OrgB_Network.
*   **Validation Criteria**:
    1.  Response for step 1 is HTTP 200 OK and returns OrgA.
    2.  Response for step 2 is

---



<a id='plan-net-practitionerrole'></a>

## Plan-Net PractitionerRole

<a id='req-35'></a>

### REQ-35: Provider search by specialty

**Description**: "The Plan-Net design is based around the following types of searches: Provider by Specialty - Example: Cardiologist - Focal Resource and Field: PractitionerRole.specialty - Qualifications of Search: Location, network, name."

**Actor**: Health Plan API

**Conformance**: None (Design requirement)

Okay, here's a comprehensive test specification for REQ-35, taking into account the provided Capability Statement information.

---

## FHIR Implementation Guide Test Specification

**1. Requirement ID**

REQ-35

**2. Requirement Analysis**

*   **Summary**: Provider search by specialty.
*   **Description**: "The Plan-Net design is based around the following types of searches: Provider by Specialty - Example: Cardiologist - Focal Resource and Field: PractitionerRole.specialty - Qualifications of Search: Location, network, name."
*   **Interpretation**: The Health Plan API must allow clients to search for providers (represented by `PractitionerRole` resources) based on their specialty. This search can be further qualified/filtered by the provider's location, the network they participate in, and the provider's name.

*   **Testability Assessment**: Automatically Testable.
    *   The requirement involves specific FHIR search operations on the `PractitionerRole` resource using defined search parameters. The Capability Statement confirms support for these parameters.

*   **Complexity**: Moderate.
    *   The core search by specialty is simple. However, the combination of multiple qualifying parameters (`location`, `network`, `name`) increases the number of test permutations and the complexity of test data setup. Chained searches (e.g., for name or location attributes) add a layer of complexity.

*   **Prerequisites**:
    1.  **FHIR Server**: A running instance of the Health Plan API FHIR server, accessible for API calls.
    2.  **Authorization**: If the API requires authorization, valid access tokens with appropriate scopes to search and read `PractitionerRole`, `Practitioner`, `Location`, and `Organization` (for network) resources.
    3.  **Test Data**: A pre-populated set of FHIR resources on the server, including:
        *   Multiple `Practitioner` resources with varying names.
        *   Multiple `Location` resources with different addresses (city, state, postal code).
        *   Multiple `Organization` resources representing different networks.
        *   Multiple `PractitionerRole` resources that link `Practitioner`s to `Location`s and `Organization`s (networks), each having one or more `specialty` codes.
        *   Test data should be designed to allow for:
            *   Positive matches for each search criterion and their combinations.
            *   Negative matches (e.g., a specialty that exists but not at a specific location or in a specific network).
            *   Edge cases (e.g., practitioners with multiple specialties, roles in multiple locations/networks).
            *   Specialty codes should use a known and consistent system (e.g., NUCC Health Care Provider Taxonomy).

**3. Test Implementation Strategy**

*   **Required Inputs including required FHIR resources and expected outputs for the test**:
    *   **Input FHIR Resources (Examples for Setup)**:
        *   **Practitioner 1 (Dr. Alice Wonderland)**:
            ```json
            {
              "resourceType": "Practitioner",
              "id": "practitioner-alice",
              "name": [{ "family": "Wonderland", "given": ["Alice"], "text": "Alice Wonderland" }]
            }
            ```
        *   **Practitioner 2 (Dr. Bob Thebuilder)**:
            ```json
            {
              "resourceType": "Practitioner",
              "id": "practitioner-bob",
              "name": [{ "family": "Thebuilder", "given": ["Bob"], "text": "Bob Thebuilder" }]
            }
            ```
        *   **Location 1 (General Hospital)**:
            ```json
            {
              "resourceType": "Location",
              "id": "location-gh",
              "address": { "city": "Anytown", "state": "CA", "postalCode": "90210", "text": "123 Main St, Anytown, CA 90210" }
            }
            ```
        *   **Location 2 (Community Clinic)**:
            ```json
            {
              "resourceType": "Location",
              "id": "location-cc",
              "address": { "city": "Otherville", "state": "NY", "postalCode": "10001", "text": "456 Oak Ave, Otherville, NY 10001" }
            }
            ```
        *   **Network 1 (BlueNet PPO)**:
            ```json
            {
              "resourceType": "Organization",
              "id": "network-blue",
              "type": [{"coding": [{"system": "http://hl7.org/fhir/organization-type", "code": "ntwk", "display": "Network"}]}],
              "name": "BlueNet PPO"
            }
            ```
        *   **Network 2 (GreenChoice HMO)**:
            ```json
            {
              "resourceType": "Organization",
              "id": "network-green",
              "type": [{"coding": [{"system": "http://hl7.org/fhir/organization-type", "code": "ntwk", "display": "Network"}]}],
              "name": "GreenChoice HMO"
            }
            ```
        *   **PractitionerRole 1 (Alice - Cardiologist at GH, BlueNet)**:
            ```json
            {
              "resourceType": "PractitionerRole",
              "id": "practitionerrole-alice-cardio-gh-blue",
              "practitioner": { "reference": "Practitioner/practitioner-alice" },
              "organization": { "reference": "Organization/some-org-gh-belongs-to" }, // Assuming GH is part of an org
              "location": [{ "reference": "Location/location-gh" }],
              "specialty": [{
                "coding": [{ "system": "http://nucc.org/provider-taxonomy", "code": "207RC0000X", "display": "Cardiology" }]
              }],
              "network": [{ "reference": "Organization/network-blue" }]
            }
            ```
        *   **PractitionerRole 2 (Alice - Internist at CC, GreenChoice)**:
            ```json
            {
              "resourceType": "PractitionerRole",
              "id": "practitionerrole-alice-im-cc-green",
              "practitioner": { "reference": "Practitioner/practitioner-alice" },
              "organization": { "reference": "Organization/some-org-cc-belongs-to" },
              "location": [{ "reference": "Location/location-cc" }],
              "specialty": [{
                "coding": [{ "system": "http://nucc.org/provider-taxonomy", "code": "207R00000X", "display": "Internal Medicine" }]
              }],
              "network": [{ "reference": "Organization/network-green" }]
            }
            ```
        *   **PractitionerRole 3 (Bob - Cardiologist at CC, BlueNet)**:
            ```json
            {
              "resourceType": "PractitionerRole",
              "id": "practitionerrole-bob-cardio-cc-blue",
              "practitioner": { "reference": "Practitioner/practitioner-bob" },
              "organization": { "reference": "Organization/some-org-cc-belongs-to" },
              "location": [{ "reference": "Location/location-cc" }],
              "specialty": [{
                "coding": [{ "system": "http://nucc.org/provider-taxonomy", "code": "207RC0000X", "display": "Cardiology" }]
              }],
              "network": [{ "reference": "Organization/network-blue" }]
            }
            ```
    *   **Expected Outputs**: FHIR Bundle resource containing `PractitionerRole` resources that match the search criteria. The `Bundle.total` should reflect the count of matching resources.

*   **Required FHIR Operations**:
    *   `GET [base]/PractitionerRole?{search_parameters}`
    *   The Capability Statement confirms the Health Plan API `SHALL` support the following search parameters on `PractitionerRole`: `specialty`, `location`, `network`, `practitioner`.
    *   It also confirms support for `Practitioner.name` and `Location.address-{city|state|postalcode}` which are necessary for chained searches.

*   **Validation Criteria**:
    *   **General (for all tests)**:
        1.  The server responds with an HTTP `200 OK` status code.
        2.  The response body is a valid FHIR `Bundle` resource.
        3.  If matches are expected, `Bundle.entry` is populated, and `Bundle.total` is greater than 0.
        4.  If no matches are expected, `Bundle.total` is 0, and `Bundle.entry` may be absent or empty.
        5.  Each `PractitionerRole` resource in the `Bundle.entry` array must conform to the relevant profiles (if defined in the IG, though not specified here).

    *   **Specific Test Cases**:

        **Test Case 35.1: Search by Specialty Only**
        *   **Description**: Verify search by specialty code.
        *   **API Call**: `GET [base]/PractitionerRole?specialty=207RC0000X` (Cardiology)
        *   **Expected Result**: Bundle containing `practitionerrole-alice-cardio-gh-blue` and `practitionerrole-bob-cardio-cc-blue`.
        *   **Validation**:
            *   All returned `PractitionerRole` resources have `specialty` coding matching `207RC0000X`.

        **Test Case 35.2: Search by Specialty and Location (Direct Reference)**
        *   **Description**: Verify search by specialty and a specific location ID.
        *   **API Call**: `GET [base]/PractitionerRole?specialty=207RC0000X&location=Location/location-gh`
        *   **Expected Result**: Bundle containing `practitionerrole-alice-cardio-gh-blue`.
        *   **Validation**:
            *   All returned `PractitionerRole` resources have `specialty` coding matching `207RC0000X`.
            *   All returned `PractitionerRole` resources have a `location` reference to `Location/location-gh`.

        **Test Case 35.3: Search by Specialty and Location (Chained by City)**
        *   **Description**: Verify search by specialty and location's city.
        *   **API Call**: `GET [base]/PractitionerRole?specialty=207RC0000X&location:Location.address-city=Anytown`
        *   **Expected Result**: Bundle containing `practitionerrole-alice-cardio-gh-blue`.
        *   **Validation**:
            *   All returned `PractitionerRole` resources have `specialty` coding matching `207RC0000X`.
            *   The `location` referenced by each returned `PractitionerRole` has `address.city` as "Anytown". (This might require an additional fetch of the Location resource or use of `_include` if supported, or rely on pre-knowledge of test data).

        **Test Case 35.4: Search by Specialty and Network**
        *   **Description**: Verify search by specialty and network.
        *   **API Call**: `GET [base]/PractitionerRole?specialty=207RC0000X&network=Organization/network-blue`
        *   **Expected Result**: Bundle containing `practitionerrole-alice-cardio-gh-blue` and `practitionerrole-bob-cardio-cc-blue`.
        *   **Validation**:
            *   All returned `PractitionerRole` resources have `specialty` coding matching `207RC0000X`.
            *   All returned `PractitionerRole` resources have a `network` reference to `Organization/network-blue`.

        **Test Case 35.5: Search by Specialty and Practitioner Name (Chained)**
        *   **Description**: Verify search by specialty and practitioner's family name.
        *   **API Call**: `GET [base]/PractitionerRole?specialty=207RC0000X&practitioner:Practitioner.name=Wonderland`
        *   **Expected Result**: Bundle containing `practitionerrole-alice-cardio-gh-blue`.
        *   **Validation**:
            *   All returned `PractitionerRole` resources have `specialty` coding matching `207RC0000X`.
            *   The `practitioner` referenced by each returned `PractitionerRole` has a name containing "Wonderland". (This might require an additional fetch of the Practitioner resource or use of `_include` if supported, or rely on pre-knowledge of test data).

        **Test Case 35.6: Search by Specialty, Location (Chained by Postal Code), and Network**
        *   **Description**: Verify search by specialty, location's postal code, and network.
        *   **API Call**: `GET [base]/PractitionerRole?specialty=207RC0000X&location:Location.address-postalcode=90210&network=Organization/network-blue`
        *   **Expected Result**: Bundle containing `practitionerrole-alice-cardio-gh-blue`.
        *   **Validation**:
            *   All returned `PractitionerRole` resources have `specialty` coding matching `207RC0000X`.
            *   The `location` referenced has `address.postalCode` as "90210".
            *   All returned `PractitionerRole` resources have a `network` reference to `Organization/network-blue`.

        **Test Case 35.7: Search by Specialty, Location (Direct Reference), Network, and Practitioner Name (Chained)**
        *   **Description**: Verify search by all four qualification criteria.
        *   **API Call**: `GET [base]/PractitionerRole?specialty=207RC0000X&location=Location/location-gh&network=Organization/network-blue&practitioner:Practitioner.name=Alice`
        *   **Expected Result**: Bundle containing `practitionerrole-alice-cardio-gh-blue`.
        *   **Validation**:
            *   Returned `PractitionerRole` has `specialty` coding `207RC0000X`.
            *   Returned `PractitionerRole` has `location` reference to `Location/location-gh`.
            *   Returned `PractitionerRole` has `network` reference to `Organization/network-blue`.
            *   The `practitioner` referenced has a name containing "Alice".

        **Test Case 35.8: Search by Specialty - No Results**
        *   **Description**: Verify behavior when searching for a specialty that has no associated PractitionerRoles.
        *   **API Call**: `GET [base]/PractitionerRole?specialty=999XX0000X` (a non-existent or unassigned specialty code)
        *   **Expected Result**: Bundle with `Bundle.total` = 0.
        *   **Validation**:
            *   HTTP 200 OK.
            *   `Bundle.total` is 0.

        **Test Case 35.9: Search by Specialty and Non-Matching Qualifier**
        *   **Description**: Verify behavior when a valid specialty is combined with a qualifier that yields no matches.
        *   **API Call**: `GET [base]/PractitionerRole?specialty=207RC0000X&network=Organization/network-green` (Cardiologists are only in BlueNet in test data)
        *   **Expected Result**: Bundle with `Bundle.total` = 0.
        *   **Validation**:
            *   HTTP 200 OK.
            *   `Bundle.total` is 0.

        **Test Case 35.10: Search by Specialty using Text**
        *   **Description**: Verify search by specialty text if supported by the server (token search can match on text).
        *   **API Call**: `GET [base]/PractitionerRole?specialty:text=Cardiology`
        *   **Expected Result**: Bundle containing `practitionerrole-alice-cardio-gh-blue` and `practitionerrole-bob-cardio-cc-blue`.
        *   **Validation**:
            *   All returned `PractitionerRole` resources have `specialty.text` or `specialty.coding.display` containing "Cardiology".
            *   *Note: The exact behavior of `:text` on a token parameter can vary. The primary test should be by code.*

        *(Additional test cases can be added for other combinations, different parts of names (given), different address components (state), and use of multiple values for a parameter, e.g., `specialty=CODE1,CODE2`)*

---

---



