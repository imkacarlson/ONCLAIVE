# Consolidated Test Plan for Plan Net

## Generated on: 2025-06-25 13:38:55

## API Type: gemini

## Table of Contents

- [Plan-Net Network](#plan-net-network)
  - [REQ-37: Search for active practitioners and organizations](#req-37)
- [Plan-Net Organization](#plan-net-organization)
  - [REQ-34: Organization search by name](#req-34)
  - [REQ-38: Network contact handling for departments](#req-38)
- [Plan-Net OrganizationAffiliation](#plan-net-organizationaffiliation)
  - [REQ-36: Organization search by specialty](#req-36)
- [Plan-Net PractitionerRole](#plan-net-practitionerrole)
  - [REQ-35: Provider search by specialty](#req-35)

## Test Specifications

<a id='plan-net-network'></a>

## Plan-Net Network

<a id='req-37'></a>

### REQ-37: Search for active practitioners and organizations

**Description**: "Sample query to search for currently active Practitioners (replace date in query with current date): http://davinci-plan-net-ri.logicahealth.org/fhir/PractitionerRole?_include=PractitionerRole:date=ge2021-10-25. Sample query to search for currently active Organizations (replace date in query with current date): http://davinci-plan-net-ri.logicahealth.org/fhir/OrganizationAffiliation?_include=OrganizationAffiliation:date=ge2021-10-25."

**Actor**: Health Plan API

**Conformance**: None (Implementation example)

## FHIR Test Specification

### 1. Requirement ID
REQ-37

### 2. Requirement Analysis

*   **Testability Assessment**: Automatically testable, but with significant caveats regarding the provided sample queries.
    *   The requirement's sample queries (`PractitionerRole?_include=PractitionerRole:date=ge...` and `OrganizationAffiliation?_include=OrganizationAffiliation:date=ge...`) use a `date` search parameter that is *not* listed as supported for `PractitionerRole` or `OrganizationAffiliation` in the provided Capability Statement.
    *   Furthermore, the syntax `_include=ResourceTypeName:searchParameter=value` is incorrect for the `_include` parameter. `_include` is used to request referenced resources (e.g., `_include=PractitionerRole:practitioner`), not to apply search criteria to the primary resource or to the included resource within the `_include` clause itself.
    *   The intent of "search for active practitioners and organizations" implies filtering by an active status or period. However, `active` (boolean) or `period` (date range) are not listed as supported search parameters for `PractitionerRole` or `OrganizationAffiliation` in the Capability Statement.
    *   The closest supported date-related search parameter is `_lastUpdated`.
    *   Given these discrepancies, the test specification will include tests for:
        1.  The literal (and problematic) sample queries to assess server handling of malformed/unsupported requests.
        2.  Queries that align with the *intent* of finding "active" entities by using the *closest supported* search parameter (`_lastUpdated`) and correct `_include` syntax for related resources, ensuring interoperability with supported features.

*   **Complexity**: Moderate (due to the need to interpret the requirement's intent, address the flawed sample queries, and devise alternative tests using supported capabilities).

*   **Prerequisites**:
    *   A FHIR server endpoint that implements the DaVinci Plan Net IG.
    *   The server must contain `PractitionerRole` and `OrganizationAffiliation` resources.
    *   These resources should include `Practitioner` and `Organization` resources referenced by `PractitionerRole` and `OrganizationAffiliation` respectively, to test `_include`.
    *   Some `PractitionerRole` and `OrganizationAffiliation` resources should have recent `meta.lastUpdated` timestamps to allow for testing with `_lastUpdated`.

### 3. Test Implementation Strategy

**Objective**: Verify the server's ability to search for `PractitionerRole` and `OrganizationAffiliation` resources, specifically addressing the requirement's intent for "active" entities and handling of the provided sample queries.

**Required Inputs**:
*   `[base]`: The base URL of the FHIR server (e.g., `http://davinci-plan-net-ri.logicahealth.org/fhir`).
*   `[current_date]`: A date string in `YYYY-MM-DD` format representing the current date or a recent date (e.g., `2023-10-26`).
*   `[date_N_days_ago]`: A date string in `YYYY-MM-DD` format representing a date N days in the past (e.g., `2023-09-01`), chosen to capture a reasonable set of recently updated "active" resources.

**Required FHIR Operations**:
*   `GET [base]/PractitionerRole`
*   `GET [base]/OrganizationAffiliation`

**Validation Criteria**:

---

**Test Case 1: Attempting the literal sample query for PractitionerRole (Problematic)**

*   **Purpose**: To verify how the server handles the exact query provided in the IG, which contains an unsupported search parameter (`date`) and syntactically incorrect `_include` usage. This tests server robustness and error handling for non-conformant requests.
*   **Query**: `GET [base]/PractitionerRole?_include=PractitionerRole:date=ge[current_date]`
*   **Expected Output**:
    *   **HTTP Status Code**: `400 Bad Request` (preferred, indicating an unsupported search parameter or malformed query).
    *   **Response Body**: A FHIR `OperationOutcome` resource detailing the error (e.g., "Unknown search parameter 'date'", "Invalid _include syntax").
    *   **Rationale**: The Capability Statement does not list `date` as a supported search parameter for `PractitionerRole`, and the `_include` syntax is incorrect. A conformant server should reject such a request. If a `200 OK` is returned, it implies custom server behavior that deviates from standard FHIR search parameter handling and the provided Capability Statement.

---

**Test Case 2: Attempting the literal sample query for OrganizationAffiliation (Problematic)**

*   **Purpose**: Similar to Test Case 1, but for `OrganizationAffiliation`.
*   **Query**: `GET [base]/OrganizationAffiliation?_include=OrganizationAffiliation:date=ge[current_date]`
*   **Expected Output**:
    *   **HTTP Status Code**: `400 Bad Request` (preferred).
    *   **Response Body**: A FHIR `OperationOutcome` resource detailing the error.
    *   **Rationale**: Same as Test Case 1; `date` is not a supported search parameter for `OrganizationAffiliation`, and the `_include` syntax is incorrect.

---

**Test Case 3: Search for PractitionerRole using `_lastUpdated` and standard `_include` for referenced Practitioner**

*   **Purpose**: To test the server's ability to search `PractitionerRole` resources using a *supported* date parameter (`_lastUpdated`) and correctly include referenced `Practitioner` resources. This aligns with the *intent* of finding "active practitioners" using available capabilities.
*   **Query**: `GET [base]/PractitionerRole?_lastUpdated=ge[date_N_days_ago]&_include=PractitionerRole:practitioner`
*   **Expected Output**:
    *   **HTTP Status Code**: `200 OK`.
    *   **Response Body**: A FHIR `Bundle` of type `searchset`.
    *   **Bundle Content**:
        *   The Bundle SHALL contain `PractitionerRole` resources as the primary entries.
        *   Each returned `PractitionerRole` resource SHALL have its `meta.lastUpdated` timestamp greater than or equal to `[date_N_days_ago]`.
        *   The Bundle SHALL contain `Practitioner` resources that are referenced by the `PractitionerRole` resources in the Bundle (via `PractitionerRole.practitioner`).
        *   Each referenced `Practitioner` resource SHALL be correctly linked to its referencing `PractitionerRole` resource (e.g., `PractitionerRole.practitioner.reference` matches `Practitioner.id`).
        *   No `OperationOutcome` indicating an error.

---

**Test Case 4: Search for OrganizationAffiliation using `_lastUpdated` and standard `_include` for referenced Organization**

*   **Purpose**: To test the server's ability to search `OrganizationAffiliation` resources using a *supported* date parameter (`_lastUpdated`) and correctly include referenced `Organization` resources. This aligns with the *intent* of finding "active organizations" using available capabilities.
*   **Query**: `GET [base]/OrganizationAffiliation?_lastUpdated=ge[date_N_days_ago]&_include=OrganizationAffiliation:primary-organization`
*   **Expected Output**:
    *   **HTTP Status Code**: `200 OK`.
    *   **Response Body**: A FHIR `Bundle` of type `searchset`.
    *   **Bundle Content**:
        *   The Bundle SHALL contain `OrganizationAffiliation` resources as the primary entries.
        *   Each returned `OrganizationAffiliation` resource SHALL have its `meta.lastUpdated` timestamp greater than or equal to `[date_N_days_ago]`.
        *   The Bundle SHALL contain `Organization` resources that are referenced by the `OrganizationAffiliation` resources in the Bundle (via `OrganizationAffiliation.primaryOrganization`).
        *   Each referenced `Organization` resource SHALL be correctly linked to its referencing `OrganizationAffiliation` resource (e.g., `OrganizationAffiliation.primaryOrganization.reference` matches `Organization.id`).
        *   No `OperationOutcome` indicating an error.

---



<a id='plan-net-organization'></a>

## Plan-Net Organization

<a id='req-34'></a>

### REQ-34: Organization search by name

**Description**: "The Plan-Net design is based around the following types of searches: Organization by Name - Example: Montgomery Cardiology or CVS - Focal Resource and Field: Organization.name - Qualifications of Search: Location, network, specialty."

**Actor**: Health Plan API

**Conformance**: None (Design requirement)

# Test Specification for REQ-34

## 1. Requirement ID
REQ-34: Organization search by name

## 2. Requirement Analysis

### Testability Assessment
*   **Classification**: Automatically Testable
*   **Rationale**: This requirement specifies a standard FHIR search operation (`GET [base]/Organization`) with `name` as the focal search parameter, further qualified by `Location`, `network`, and `specialty`. The Capability Statement confirms support for `Organization.name` and other relevant parameters (`address`, `type`, `coverage-area`). The expected output is a FHIR Bundle of `Organization` resources, which can be programmatically queried and validated against the specified criteria.

### Complexity
*   **Classification**: Moderate
*   **Rationale**: While the core search by `Organization.name` is simple, the requirement introduces "qualifications" by Location, network, and specialty. This necessitates testing combinations of `name` with other search parameters (`address`, `type`, `coverage-area`). This requires multiple test cases to cover the various combinations and interpretations of "network" and "specialty" (likely mapped to `Organization.type` in the absence of more specific parameters).

### Prerequisites
*   **System Under Test (SUT)**: A FHIR server implementing the Health Plan API, capable of processing FHIR R4 search requests for `Organization` resources.
*   **Data Setup**: The SUT must be pre-populated with a diverse and representative set of `Organization` and `Location` resources. This data should include:
    *   `Organization` resources with varied `name` values (e.g., "Montgomery Cardiology", "CVS Pharmacy", "Acme Health System").
    *   `Organization` resources with populated `address` fields (e.g., `address.city`, `address.state`, `address.postalCode`).
    *   `Organization` resources with `type` codes that represent different organizational categories, which can be interpreted as "network" affiliations (e.g., `http://terminology.hl7.org/CodeSystem/organization-type|payer`, `http://terminology.hl7.org/CodeSystem/organization-type|prov`) or "specialties" (e.g., specific provider types or service categories, if mapped to `type`).
    *   `Organization` resources with `coverage-area` references pointing to `Location` resources.
    *   `Location` resources with populated `address` fields (city, state, postal code).
    *   The data should include:
        *   Organizations with unique names.
        *   Organizations with similar names but differing in location, network, or specialty.
        *   Organizations that match specific combinations of name, location, network, and specialty.
        *   Organizations that *do not* match specific combinations, to verify negative search results.

## 3. Test Implementation Strategy

### Required Inputs and Expected Outputs

*   **Required Inputs**:
    *   FHIR Base URL of the SUT (e.g., `http://example.com/fhir`).
    *   Specific search parameter values for `name`, `address` (or its components), `type`, and `coverage-area` that correspond to the pre-populated data on the SUT. These values should be chosen to represent positive matches, negative matches, and various combinations.
    *   For `coverage-area` searches, the logical ID of a pre-existing `Location` resource on the SUT.

*   **Expected Outputs**:
    *   HTTP Status Code: `200 OK` for successful searches.
    *   Resource Type: A FHIR `Bundle` resource.
    *   Bundle Type: `searchset`.
    *   Bundle Entry Resources: All entries in the bundle should be `Organization` resources.
    *   Content Matching: The returned `Organization` resources should precisely match *all* specified search criteria (e.g., `name`, `address`, `type`, `coverage-area`).

### Required FHIR Operations

The primary FHIR operation for this requirement is `GET` on the `Organization` endpoint, utilizing various search parameters.

1.  **Search by Name (Basic)**
    *   **Operation**: `GET [base]/Organization?name=[organization-name-string]`
    *   **Example**: `GET [base]/Organization?name=Montgomery%20Cardiology`
    *   **Test Data Consideration**: Use a name that is expected to have one or more matches.

2.  **Search by Name and Location (using Organization.address)**
    *   **Operation**: `GET [base]/Organization?name=[organization-name-string]&address=[address-string]`
    *   **Example**: `GET [base]/Organization?name=CVS&address=Springfield`
    *   **Operation**: `GET [base]/Organization?name=[organization-name-string]&address-city=[city-string]`
    *   **Example**: `GET [base]/Organization?name=CVS&address-city=Springfield`
    *   **Operation**: `GET [base]/Organization?name=[organization-name-string]&address-state=[state-string]`
    *   **Example**: `GET [base]/Organization?name=CVS&address-state=IL`
    *   **Operation**: `GET [base]/Organization?name=[organization-name-string]&address-postalcode=[postalcode-string]`
    *   **Example**: `GET [base]/Organization?name=CVS&address-postalcode=62704`
    *   **Test Data Consideration**: Use combinations where the name matches multiple organizations, but the address narrows down the results.

3.  **Search by Name and Location (using Organization.coverage-area)**
    *   **Operation**: `GET [base]/Organization?name=[organization-name-string]&coverage-area=[location-id]`
    *   **Example**: `GET [base]/Organization?name=Montgomery%20Cardiology&coverage-area=Location/location-123` (where `location-123` is the ID of a relevant `Location` resource)
    *   **Test Data Consideration**: Ensure `location-123` is an ID of a `Location` resource that is referenced by an `Organization` matching the name.

4.  **Search by Name and Network/Specialty (using Organization.type)**
    *   **Operation**: `GET [base]/Organization?name=[organization-name-string]&type=[type-code]`
    *   **Example (Network)**: `GET [base]/Organization?name=Acme%20Health&type=http://terminology.hl7.org/CodeSystem/organization-type|payer`
    *   **Example (Specialty)**: `GET [base]/Organization?name=Montgomery%20Cardiology&type=http://terminology.hl7.org/CodeSystem/organization-type|prov` (or a more specific code from a relevant terminology if defined for specialty)
    *   **Test Data Consideration**: Use `type` codes that represent network affiliations or specialties as present in the pre-populated data.

5.  **Combined Searches (Name + Location + Network/Specialty)**
    *   **Operation**: `GET [base]/Organization?name=[organization-name-string]&address-city=[city-string]&type=[type-code]`
    *   **Example**: `GET [base]/Organization?name=CVS&address-city=Springfield&type=http://terminology.hl7.org/CodeSystem/organization-type|pharm`
    *   **Operation**: `GET [base]/Organization?name=[organization-name-string]&coverage-area=[location-id]&type=[type-code]`
    *   **Example**: `GET [base]/Organization?name=Montgomery%20Cardiology&coverage-area=Location/location-123&type=http://terminology.hl7.org/CodeSystem/organization-type|prov`
    *   **Test Data Consideration**: These tests are critical for verifying the "qualifications of search". Use data where all three criteria must be met for a match.

6.  **Negative Test Cases**
    *   **Operation**: `GET [base]/Organization?name=[non-existent-name]`
    *   **Example**: `GET [base]/Organization?name=NonExistentOrg`
    *   **Operation**: `GET [base]/Organization?name=[valid-name]&address-city=[non-matching-city]`
    *   **Example**: `GET [base]/Organization?name=CVS&address-city=Gotham`
    *   **Test Data Consideration**: Use search parameters that are known not to exist or known not to yield any matches when combined.

### Validation Criteria

For each executed test case:

1.  **HTTP Status Code**: Assert that the HTTP response status code is `200 OK`.
2.  **Response Type**: Assert that the response body is a valid FHIR `Bundle` resource.
3.  **Bundle Type**: Assert that the `Bundle.type` field is `searchset`.
4.  **Resource Type in Bundle**: For every entry in `Bundle.entry`, assert that `entry.resource` is an `Organization` resource.
5.  **Positive Match Verification**:
    *   If the search is expected to return results (positive test case):
        *   Assert that `Bundle.total` is greater than 0.
        *   For each `Organization` resource in the bundle, assert that its `name` field contains or matches the `name` search parameter value (considering FHIR string search rules like case-insensitivity or partial matching as per the server's implementation).
        *   For each `Organization` resource, assert that it matches *all* other specified search parameters (e.g., `address` components, `type` code, `coverage-area` reference).
        *   (Data-driven verification): Based on the pre-populated data, confirm that all `Organization` resources that *should* match the given criteria are present in the returned bundle.
6.  **Negative Match Verification**:
    *   If the search is expected to return no results (negative test case):
        *   Assert that `Bundle.total` is `0`.
        *   Assert that `Bundle.entry` is empty or not present.
7.  **No Unintended Results**: For all test cases, assert that no `Organization` resources are returned that *do not* match the specified search criteria. This ensures accurate filtering and adherence to the search parameters.

---

<a id='req-38'></a>

### REQ-38: Network contact handling for departments

**Description**: "When the contact is a department name, rather than a human (e.g., patient help line), include a blank family and given name, and provide the department name in contact.name.text."

**Actor**: Health Plan API

**Conformance**: None (Implementation guidance)

# FHIR Test Specification

## 1. Requirement ID
REQ-38

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable**. The requirement specifies precise structural and content constraints on FHIR data elements (`HumanName.family`, `HumanName.given`, `HumanName.text`) within a contact context. These constraints can be programmatically verified by retrieving the relevant FHIR resource and asserting against its structure. While the requirement's "Verification" is listed as "Inspection," the specific data points are amenable to automated checks, which can either support or replace manual inspection for these structural aspects.

### Complexity
**Simple**. The test involves straightforward checks for the presence, absence, or content of specific, well-defined fields within a nested FHIR data structure.

### Prerequisites
*   The Health Plan API must expose FHIR resources that contain contact information where a department name might be used (e.g., `Organization` resources with `contact` information).
*   There must be at least one instance of such a resource available via the API that is intended to represent a departmental contact (e.g., a "patient help line" or "billing department"). The tester is responsible for identifying or providing the specific resource ID or search parameters to retrieve such a conforming instance.

## 3. Test Implementation Strategy

### Required Inputs
*   **FHIR Resource**: An `Organization` resource (or another relevant resource type, such as `Location` or `HealthcareService`, if the Implementation Guide explicitly specifies it for departmental contacts) provided by the Health Plan API. This resource must contain a `contact` entry that represents a department (e.g., "patient help line", "billing department").
*   **Resource Identifier**: The logical ID of the `Organization` resource (e.g., `Organization/example-dept-contact`) or a search query (e.g., `Organization?type=dept&name=Patient%20Help%20Line`) that can reliably retrieve such a resource. The tester will need to provide this based on their test data.

### Expected Outputs
The retrieved `Organization` resource (or relevant resource) should contain at least one `contact` entry where:
*   The `contact.name` element is present and is of type `HumanName`.
*   The `contact.name.family` element is absent or an empty array.
*   The `contact.name.given` element is absent or an empty array.
*   The `contact.name.text` element is present and contains a non-empty string that represents the department name (e.g., "Patient Help Line", "Billing Department").

### Required FHIR Operations
*   **Read Operation**: `GET [base]/Organization/[id]`
    *   *Purpose*: To retrieve a specific `Organization` resource known to contain a departmental contact.
*   **Search Operation (Alternative)**: `GET [base]/Organization?[search-parameters]`
    *   *Purpose*: To discover and retrieve an `Organization` resource that matches criteria for a departmental contact (e.g., `Organization?type=dept&_count=1`). The specific search parameters will depend on the Health Plan API's capabilities and the available test data.

### Validation Criteria
1.  **Retrieve Conforming Resource**:
    *   Execute a `GET` request (Read or Search) to retrieve an `Organization` resource (or other relevant resource type) that is expected to contain a departmental contact.
        *   *Example*: `GET [FHIR_BASE_URL]/Organization/example-department-contact-id`
    *   **Assertion 1.1**: Verify that the API returns a `200 OK` status code and a valid FHIR `Organization` resource in the response body.

2.  **Identify Departmental Contact**:
    *   From the retrieved `Organization` resource, iterate through its `contact` array.
    *   Identify at least one `contact` entry that is intended to represent a department (as per the test data context). This might be identified by its `contact.purpose` code, `contact.type` code, or simply by the content of `contact.name.text` itself. The tester should select the appropriate contact for evaluation.
    *   **Assertion 2.1**: Verify that the identified `contact` entry contains a `name` element.

3.  **Validate HumanName Structure for Department Contact**:
    *   For the identified departmental `contact` entry and its `name` element (which is of type `HumanName`):
    *   **Assertion 3.1**: Verify that the `contact.name.family` element is **absent** or an **empty array**.
        *   *Example Check (pseudo-code)*: `assert(contact.name.family === undefined || contact.name.family.length === 0)`
    *   **Assertion 3.2**: Verify that the `contact.name.given` element is **absent** or an **empty array**.
        *   *Example Check (pseudo-code)*: `assert(contact.name.given === undefined || contact.name.given.length === 0)`
    *   **Assertion 3.3**: Verify that the `contact.name.text` element is **present** and contains a **non-empty string**.
        *   *Example Check (pseudo-code)*: `assert(typeof contact.name.text === 'string' && contact.name.text.length > 0)`
        *   *Further Check (Optional but Recommended for thoroughness)*: If possible, verify that the content of `contact.name.text` is consistent with a department name (e.g., "Patient Help Line", "Billing Department"). This helps confirm the correct type of contact is being evaluated.

---



<a id='plan-net-organizationaffiliation'></a>

## Plan-Net OrganizationAffiliation

<a id='req-36'></a>

### REQ-36: Organization search by specialty

**Description**: "The Plan-Net design is based around the following types of searches: Organization by specialty - Example: Compounding Pharmacy - Focal Resource and Field: OrganizationAffiliation.specialty - Qualifications of Search: Location, network, name."

**Actor**: Health Plan API

**Conformance**: None (Design requirement)

## FHIR Test Specification

### 1. Requirement ID
REQ-36

### 2. Requirement Analysis

*   **Testability Assessment**: Automatically Testable. The requirement specifies a search operation on a specific FHIR resource (`OrganizationAffiliation`) using defined search parameters (`specialty`, `location`, `network`, and implicitly `participating-organization.name`). These operations can be directly invoked via FHIR REST API calls and their responses programmatically validated.
*   **Complexity**: Moderate. While a basic search by `specialty` is simple, the "Qualifications of Search" (Location, network, name) imply combining multiple search parameters, including a chained search (`participating-organization.name`), which adds complexity.
*   **Prerequisites**:
    *   The System Under Test (SUT) (Health Plan API) must be accessible and operational.
    *   The SUT must contain `OrganizationAffiliation` resources.
    *   These `OrganizationAffiliation` resources must have `specialty` codes populated.
    *   To test the "qualifications of search", `OrganizationAffiliation` resources should also be linked to `Location` resources, `Network` resources, and `Organization` resources (via `participating-organization`) with relevant data (e.g., `Location` IDs, `Network` IDs, `Organization` names) to allow for targeted searches.

### 3. Test Implementation Strategy

*   **Required Inputs**:
    *   A valid `specialty` code (e.g., "333600000X" for "Compounding Pharmacy" from NUCC Health Care Provider Taxonomy, or a relevant code from the IG's specified ValueSet).
    *   Optional:
        *   A valid `Location` resource ID that is referenced by at least one `OrganizationAffiliation` resource.
        *   A valid `Network` resource ID that is referenced by at least one `OrganizationAffiliation` resource.
        *   A valid `Organization` name that is associated with an `Organization` resource referenced by at least one `OrganizationAffiliation` resource.

*   **Required FHIR Operations**:
    The primary operation is `GET [base]/OrganizationAffiliation`. The Capability Statement confirms support for `OrganizationAffiliation` and its `specialty`, `location`, `network`, and `participating-organization` search parameters, as well as `Organization.name`.

*   **Validation Criteria**:

    **Test Case 1: Search OrganizationAffiliation by Specialty**
    *   **Description**: Verify that the API can successfully search for `OrganizationAffiliation` resources based on a specific `specialty` code.
    *   **Request**: `GET [base]/OrganizationAffiliation?specialty=[specialty-code]`
    *   **Expected Output**:
        1.  HTTP Status Code: `200 OK`.
        2.  Response Body: A FHIR `Bundle` of type `searchset`.
        3.  Bundle Content: Each entry in the `Bundle` is an `OrganizationAffiliation` resource.
        4.  Resource Conformance: Each `OrganizationAffiliation` resource in the `Bundle` SHALL conform to the relevant `OrganizationAffiliation` profile defined in the Implementation Guide.
        5.  Search Parameter Match: For every `OrganizationAffiliation` resource in the `Bundle`, its `specialty` element SHALL contain the `[specialty-code]` used in the search query.
        6.  Completeness (Best Effort): The `Bundle` SHOULD contain all `OrganizationAffiliation` resources that match the `[specialty-code]` in the server's dataset. (Note: Full completeness is difficult to test without prior knowledge of the entire dataset, focus on correctness of returned resources).

    **Test Case 2: Search OrganizationAffiliation by Specialty and Location**
    *   **Description**: Verify that the API can successfully search for `OrganizationAffiliation` resources by combining `specialty` and `location` search parameters.
    *   **Request**: `GET [base]/OrganizationAffiliation?specialty=[specialty-code]&location=[location-id]`
    *   **Expected Output**:
        1.  HTTP Status Code: `200 OK`.
        2.  Response Body: A FHIR `Bundle` of type `searchset`.
        3.  Bundle Content: Each entry in the `Bundle` is an `OrganizationAffiliation` resource.
        4.  Resource Conformance: Each `OrganizationAffiliation` resource in the `Bundle` SHALL conform to the relevant `OrganizationAffiliation` profile.
        5.  Search Parameter Match: For every `OrganizationAffiliation` resource in the `Bundle`:
            *   Its `specialty` element SHALL contain the `[specialty-code]`.
            *   Its `location` element SHALL reference the `[location-id]`.
        6.  No Mismatches: The `Bundle` SHALL NOT contain any `OrganizationAffiliation` resources that do not match both criteria.

    **Test Case 3: Search OrganizationAffiliation by Specialty and Network**
    *   **Description**: Verify that the API can successfully search for `OrganizationAffiliation` resources by combining `specialty` and `network` search parameters.
    *   **Request**: `GET [base]/OrganizationAffiliation?specialty=[specialty-code]&network=[network-id]`
    *   **Expected Output**:
        1.  HTTP Status Code: `200 OK`.
        2.  Response Body: A FHIR `Bundle` of type `searchset`.
        3.  Bundle Content: Each entry in the `Bundle` is an `OrganizationAffiliation` resource.
        4.  Resource Conformance: Each `OrganizationAffiliation` resource in the `Bundle` SHALL conform to the relevant `OrganizationAffiliation` profile.
        5.  Search Parameter Match: For every `OrganizationAffiliation` resource in the `Bundle`:
            *   Its `specialty` element SHALL contain the `[specialty-code]`.
            *   Its `network` element SHALL reference the `[network-id]`.
        6.  No Mismatches: The `Bundle` SHALL NOT contain any `OrganizationAffiliation` resources that do not match both criteria.

    **Test Case 4: Search OrganizationAffiliation by Specialty and Organization Name (Chained Search)**
    *   **Description**: Verify that the API can successfully search for `OrganizationAffiliation` resources by combining `specialty` and the `name` of the `participating-organization` using a chained search.
    *   **Request**: `GET [base]/OrganizationAffiliation?specialty=[specialty-code]&participating-organization.name=[organization-name]`
    *   **Expected Output**:
        1.  HTTP Status Code: `200 OK`.
        2.  Response Body: A FHIR `Bundle` of type `searchset`.
        3.  Bundle Content: Each entry in the `Bundle` is an `OrganizationAffiliation` resource.
        4.  Resource Conformance: Each `OrganizationAffiliation` resource in the `Bundle` SHALL conform to the relevant `OrganizationAffiliation` profile.
        5.  Search Parameter Match: For every `OrganizationAffiliation` resource in the `Bundle`:
            *   Its `specialty` element SHALL contain the `[specialty-code]`.
            *   The `Organization` resource referenced by its `participating-organization` element SHALL have a `name` that matches `[organization-name]` (case-insensitive, as per FHIR string search rules).
        6.  No Mismatches: The `Bundle` SHALL NOT contain any `OrganizationAffiliation` resources that do not match both criteria.
        *   **Note**: This test case relies on the server's support for chained search (`participating-organization.name`). If the server does not support chained search, this test case may fail or return an error indicating unsupported parameter. In such a scenario, an alternative approach would be to first search `Organization` by `name`, then use the returned `Organization` IDs to search `OrganizationAffiliation` by `participating-organization`.

    **Test Case 5: Search OrganizationAffiliation with No Matching Data**
    *   **Description**: Verify that the API returns an empty bundle when no `OrganizationAffiliation` resources match the specified criteria.
    *   **Request**: `GET [base]/OrganizationAffiliation?specialty=[non-existent-specialty-code]` (or a combination of parameters that is known not to exist in the dataset).
    *   **Expected Output**:
        1.  HTTP Status Code: `200 OK`.
        2.  Response Body: A FHIR `Bundle` of type `searchset`.
        3.  Bundle Content: The `Bundle` SHALL contain `total: 0` and no entries.

---



<a id='plan-net-practitionerrole'></a>

## Plan-Net PractitionerRole

<a id='req-35'></a>

### REQ-35: Provider search by specialty

**Description**: "The Plan-Net design is based around the following types of searches: Provider by Specialty - Example: Cardiologist - Focal Resource and Field: PractitionerRole.specialty - Qualifications of Search: Location, network, name."

**Actor**: Health Plan API

**Conformance**: None (Design requirement)

As a specialized FHIR testing engineer, I have analyzed REQ-35 and the provided Capability Statement information to generate the following comprehensive test specification.

---

### 1. Requirement ID

REQ-35

### 2. Requirement Analysis

*   **Testability Assessment:** Automatically Testable. This requirement specifies a clear search operation on a specific FHIR resource with defined parameters, allowing for automated API calls and response validation.
*   **Complexity:** Moderate. While the core search by `specialty` is simple, the requirement includes qualifications by `Location`, `network`, and `name`, which necessitate chained searches (`practitioner.name`, `location.address-city`, etc.) and multi-parameter queries, increasing complexity.
*   **Prerequisites:**
    *   A FHIR server (Health Plan API) that exposes a FHIR R4 endpoint and implements the `PractitionerRole` resource with `specialty`, `practitioner`, `location`, and `network` search parameters as indicated in the Capability Statement.
    *   Test data on the server must include:
        *   At least one `PractitionerRole` resource with a populated `specialty` element (e.g., using a SNOMED CT code for a specific specialty).
        *   `Practitioner` resources linked to `PractitionerRole` resources, with populated `name` elements.
        *   `Location` resources linked to `PractitionerRole` resources, with populated address elements (city, state, postal code).
        *   `Organization` resources representing networks, linked to `PractitionerRole` resources via the `network` element.
        *   A mix of data to allow for both positive matches and no-match scenarios (e.g., PractitionerRoles with different specialties, locations, networks, and names).

### 3. Test Implementation Strategy

*   **Required Inputs:**
    *   **FHIR Resources:** `PractitionerRole`, `Practitioner`, `Location`, `Organization`.
    *   **Search Parameters:**
        *   `specialty`: A valid `Coding` or `code` from a recognized terminology (e.g., SNOMED CT) representing a medical specialty. Example: `http://snomed.info/sct|408443003` (Cardiology).
        *   `practitioner.name`: A string representing part or all of a practitioner's name. Example: `John` or `Doe`.
        *   `location.address-city`: A string representing a city name. Example: `Springfield`.
        *   `location.address-state`: A string representing a state abbreviation. Example: `MA`.
        *   `location.address-postalcode`: A string representing a postal code. Example: `90210`.
        *   `network`: A `Reference` to an `Organization` resource representing a network. Example: `Organization/example-ppo-network-id`.

*   **Required FHIR Operations:**
    *   `GET [base]/PractitionerRole` (FHIR Search Operation)

*   **Validation Criteria:**

    **General Criteria for all Test Cases:**
    *   The HTTP status code of the response MUST be `200 OK`.
    *   The response body MUST be a FHIR `Bundle` resource of type `searchset`.
    *   The `Bundle.total` element SHOULD accurately reflect the number of entries in the bundle.

    **Specific Test Cases and Validation:**

    **Test Case 3.1: Search by `specialty` only**
    *   **Description:** Verify that the API can return `PractitionerRole` resources filtered solely by their `specialty`.
    *   **Query Example:** `GET [base]/PractitionerRole?specialty=http://snomed.info/sct|408443003` (Cardiology)
    *   **Validation:**
        *   Each `PractitionerRole` resource in the `Bundle.entry` array MUST have a `specialty` element that matches the queried specialty code/system.
        *   The bundle SHOULD contain all `PractitionerRole` resources matching the criteria and no others.

    **Test Case 3.2: Search by `specialty` combined with `practitioner.name`**
    *   **Description:** Verify that the API can filter `PractitionerRole` resources by `specialty` and by the `name` of the linked `Practitioner`.
    *   **Query Example:** `GET [base]/PractitionerRole?specialty=http://snomed.info/sct|408443003&practitioner.name=John`
    *   **Validation:**
        *   Each `PractitionerRole` resource in the `Bundle.entry` array MUST have a `specialty` element matching the queried specialty.
        *   For each `PractitionerRole`, the referenced `Practitioner` resource (resolved either by `_include` or a separate lookup) MUST have a `name` element that matches the queried name (e.g., contains "John").

    **Test Case 3.3: Search by `specialty` combined with `location` (e.g., `address-city`)**
    *   **Description:** Verify that the API can filter `PractitionerRole` resources by `specialty` and by the `address-city` of the linked `Location`.
    *   **Query Example:** `GET [base]/PractitionerRole?specialty=http://snomed.info/sct|408443003&location.address-city=Springfield`
    *   **Validation:**
        *   Each `PractitionerRole` resource in the `Bundle.entry` array MUST have a `specialty` element matching the queried specialty.
        *   For each `PractitionerRole`, the referenced `Location` resource (resolved either by `_include` or a separate lookup) MUST have an `address.city` element that matches the queried city.

    **Test Case 3.4: Search by `specialty` combined with `network`**
    *   **Description:** Verify that the API can filter `PractitionerRole` resources by `specialty` and by the `network` they are associated with.
    *   **Query Example:** `GET [base]/PractitionerRole?specialty=http://snomed.info/sct|408443003&network=Organization/example-ppo-network-id` (Replace `example-ppo-network-id` with an actual Organization ID from test data)
    *   **Validation:**
        *   Each `PractitionerRole` resource in the `Bundle.entry` array MUST have a `specialty` element matching the queried specialty.
        *   For each `PractitionerRole`, the `network` element MUST reference the queried `Organization` resource.

    **Test Case 3.5: Search by `specialty` combined with multiple qualifications (e.g., `practitioner.name` AND `location.address-state`)**
    *   **Description:** Verify that the API correctly applies multiple search qualifications simultaneously.
    *   **Query Example:** `GET [base]/PractitionerRole?specialty=http://snomed.info/sct|408443003&practitioner.name=Jane&location.address-state=NY`
    *   **Validation:**
        *   Each `PractitionerRole` resource in the `Bundle.entry` array MUST satisfy ALL specified criteria:
            *   `specialty` matches.
            *   Linked `Practitioner`'s `name` matches.
            *   Linked `Location`'s `address.state` matches.

    **Test Case 3.6: No Matching Results**
    *   **Description:** Verify that the API returns an empty bundle when no `PractitionerRole` resources match the specified criteria.
    *   **Query Example:** `GET [base]/PractitionerRole?specialty=http://snomed.info/sct|999999999` (Use a specialty code known not to exist in the test data)
    *   **Validation:**
        *   The `Bundle.entry` array MUST be empty.
        *   The `Bundle.total` element MUST be `0`.

---

---



