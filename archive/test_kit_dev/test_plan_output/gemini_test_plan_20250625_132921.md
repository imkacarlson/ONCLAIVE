# Consolidated Test Plan for Plan Net

## Generated on: 2025-06-25 13:30:36

## API Type: gemini

## Table of Contents

- [Organization](#organization)
  - [REQ-06: Client handling of Must Support data elements](#req-06)
  - [REQ-09: Client processing of missing information indicators](#req-09)
- [Plan-Net Endpoint](#plan-net-endpoint)
  - [REQ-02: No PII sending by clients](#req-02)
  - [REQ-10: JSON format support](#req-10)
- [Plan-Net InsurancePlan](#plan-net-insuranceplan)
  - [REQ-03: Population of Must Support data elements](#req-03)

## Test Specifications

<a id='organization'></a>

## Organization

<a id='req-06'></a>

### REQ-06: Client handling of Must Support data elements

**Description**: "Application actors SHALL be capable of processing resource instances containing the Must Support data elements without generating an error or causing the application to fail."

**Actor**: Application Actor

**Conformance**: SHALL

## FHIR Test Specification

### 1. Requirement ID
REQ-06

### 2. Requirement Analysis

*   **Testability Assessment:** Automatically Testable. This requirement describes observable behavior of the "Application Actor" (client application) when processing FHIR resources.
*   **Complexity:** Moderate. While the concept is straightforward, implementing and verifying this test requires providing specific FHIR resources to the client and then observing the client's internal behavior (e.g., UI, logs, application stability) rather than just validating an API response.
*   **Prerequisites:**
    *   An "Application Actor" (the client application under test) that is configured and capable of receiving and processing FHIR resources according to the specified Implementation Guide.
    *   Access to a mechanism (e.g., a FHIR server, a file system, a mock service) that can provide FHIR resources to the client application.
    *   Clear identification of all "Must Support" data elements for the FHIR resource profiles relevant to the client application's functionality, as defined by the Implementation Guide.

### 3. Test Implementation Strategy

*   **Required Inputs:**
    *   **FHIR Resources:** Provide one or more FHIR resource instances (e.g., `Patient`, `Observation`, `MedicationRequest`, etc.) that conform to the profiles defined in the Implementation Guide.
        *   Each provided resource **MUST** contain all "Must Support" data elements as defined by its respective profile in the IG.
        *   The values for these "Must Support" elements **MUST** be valid according to their FHIR data types and any specific binding constraints or value sets defined in the IG.
        *   Resources should represent realistic scenarios the client application is expected to handle.
        *   Consider providing resources with:
            *   Only required and "Must Support" elements.
            *   Required, "Must Support," and some optional elements.
            *   "Must Support" elements with various valid data types (e.g., different date formats, various code system values).
*   **Required FHIR Operations:**
    *   The client application needs to *receive* or *retrieve* the FHIR resources. Common operations for this include:
        *   `GET [base]/[Resource]/[id]` (FHIR Read operation) - To retrieve a specific resource.
        *   `GET [base]/[Resource]` (FHIR Search operation) - To retrieve a bundle of resources based on search criteria.
        *   `POST [base]/[Resource]/$validate` (if the client performs pre-processing validation, though the core of the test is about *processing* after receipt).
        *   `POST [base]/[Bundle]` (if the client receives resources as part of a transaction or batch).
        *   *Note:* The specific operation will depend on how the "Application Actor" typically acquires FHIR data. The focus is on the client's ability to *process* the received data, not necessarily the method of receipt itself.
*   **Validation Criteria:**
    *   **Application Stability:**
        *   The client application **MUST NOT** crash, freeze, or become unresponsive when processing the resource instance(s).
        *   No unhandled exceptions or critical errors should be observed in the application's logs or console output.
    *   **Error Handling:**
        *   The client application **MUST NOT** display any user-facing error messages related to the processing of "Must Support" elements.
        *   No errors should be logged that indicate a failure to parse, understand, or process the "Must Support" elements. Warnings for unknown or unexpected elements (non-"Must Support") are acceptable, but not for "Must Support" elements.
    *   **Data Processing/Display (Functional Verification):**
        *   If the "Application Actor" is expected to display or utilize the "Must Support" data elements (e.g., display a patient's name, birth date, or an observation value), verify that these elements are correctly parsed, displayed, and/or used within the application's functionality as intended by the IG.
        *   Ensure that the presence of "Must Support" elements does not lead to data corruption or incorrect interpretation within the application.
    *   **Graceful Handling of Optional Elements:** While not the primary focus of this requirement, implicitly, the client should also gracefully handle (i.e., ignore or process if needed) any *optional* elements present in the resource that are *not* "Must Support" elements, without causing errors or failures.

---

<a id='req-09'></a>

### REQ-09: Client processing of missing information indicators

**Description**: "Consumer App actors SHALL be able to process resource instances containing Must Support data elements asserting missing information."

**Actor**: Application Actor

**Conformance**: SHALL

Here is a comprehensive test specification for REQ-09:

---

## FHIR Test Specification

### 1. Requirement ID
REQ-09

### 2. Requirement Analysis

*   **Testability Assessment**:
    *   **Automatically Testable (Partially) / Attestation**: The ability of a Consumer App to successfully retrieve and parse a FHIR resource containing the `data-absent-reason` extension on a Must Support element can be automatically verified. However, the full "processing" (e.g., correct display in a UI, appropriate internal logic handling) often requires manual attestation or specific client-side testing frameworks beyond the scope of general FHIR interoperability testing. This specification focuses on the verifiable parsing and data access aspects.
*   **Complexity**: Moderate. Requires understanding of FHIR's "Must Support" concept and the `data-absent-reason` extension mechanism for representing missing information.
*   **Prerequisites**:
    *   A Consumer App actor (the system under test) capable of making FHIR API calls (e.g., `read`, `search`) and processing FHIR resource payloads.
    *   Access to a FHIR server that can serve FHIR resource instances containing `data-absent-reason` extensions on Must Support elements.
    *   Identification of at least one "Must Support" data element within the relevant FHIR profile/Implementation Guide that the Consumer App is expected to process.

### 3. Test Implementation Strategy

*   **Required Inputs**:
    *   A FHIR resource instance (e.g., Patient, Observation, MedicationRequest) where at least one "Must Support" element, as defined by the specific Implementation Guide being tested, is represented using the `http://hl7.org/fhir/StructureDefinition/data-absent-reason` extension.
    *   **Example Resource Characteristic**:
        *   A `Patient` resource where the `Patient.birthDate` element (a common Must Support element in many profiles) is omitted, and its primitive type's `_birthDate` extension contains a `data-absent-reason` extension.
        ```json
        {
          "resourceType": "Patient",
          "id": "test-patient-missing-birthdate",
          "meta": {
            "profile": [
              "http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient" // Example: Replace with actual profile
            ]
          },
          "name": [
            {
              "family": "Test",
              "given": [
                "Missing"
              ]
            }
          ],
          "gender": "female",
          "_birthDate": { // Note the underscore for the extension on the primitive
            "extension": [
              {
                "url": "http://hl7.org/fhir/StructureDefinition/data-absent-reason",
                "valueCode": "unknown" // or "not-asked", "masked", "unsupported", etc.
              }
            ]
          }
          // Include other mandatory elements as per the profile
        }
        ```
    *   **Expected Output**: The Consumer App successfully processes the resource without errors and can correctly identify that the specified Must Support element's value is absent due to the `data-absent-reason`.

*   **Required FHIR Operations**:
    *   `GET [base]/[ResourceType]/[id]` (FHIR Read operation)
    *   `GET [base]/[ResourceType]?_id=[id]` (FHIR Search operation by ID)
    *   `GET [base]/[ResourceType]` (FHIR Search operation to retrieve a list of resources, one of which contains the test data)
    *   *Rationale*: The Consumer App must be able to retrieve the resource instance from a FHIR server to process it. The specific operation depends on the client's workflow. The Capability Statement indicates "General Capabilities", implying standard RESTful operations are supported.

*   **Validation Criteria**:
    *   **Client Retrieval & Parsing**:
        *   The Consumer App successfully executes the chosen FHIR operation (e.g., `read` or `search`) to retrieve the test resource instance from the FHIR server.
        *   The Consumer App's FHIR parser successfully parses the retrieved resource instance, including the `data-absent-reason` extension on the Must Support element, without throwing any unhandled exceptions or parsing errors.
    *   **Internal Data Handling**:
        *   The Consumer App's internal data model or representation of the resource correctly identifies the absence of the value for the specified Must Support element and the presence of the `data-absent-reason` extension and its `valueCode`.
        *   The Consumer App does not treat the absence of the value (due to `data-absent-reason`) as an error or an unexpected state.
    *   **Application Behavior (Attestation)**:
        *   The Consumer App's user interface (if applicable) appropriately indicates that the information for the Must Support element is missing (e.g., displays "Unknown", "N/A", a specific icon, or a message indicating the reason for absence) rather than an empty field or an error message.
        *   The Consumer App's business logic (if applicable) correctly handles the missing information, for instance, by not attempting to use the absent value in calculations or displaying a default value where appropriate, based on the `data-absent-reason`.

---



<a id='plan-net-endpoint'></a>

## Plan-Net Endpoint

<a id='req-02'></a>

### REQ-02: No PII sending by clients

**Description**: "A directory mobile application SHALL NOT send consumer identifiable information when querying a Plan-Net service."

**Actor**: Application Actor

**Conformance**: SHALL NOT

## FHIR Test Specification

### 1. Requirement ID
REQ-02

### 2. Requirement Analysis

*   **Testability Assessment**: Manual Inspection / Attestation.
    *   This requirement dictates what the client *SHALL NOT send*. While automated tools could potentially intercept and analyze network traffic (e.g., a proxy), this is typically beyond the scope of standard FHIR conformance testing tools which primarily validate server responses or client-sent resources against profiles. The "Verification: Inspection" also points to a manual review process.
*   **Complexity**: Moderate.
    *   Conceptually simple, but verifying the absence of PII in outgoing requests requires specific tooling or manual inspection beyond basic API calls.
*   **Prerequisites**:
    *   A "directory mobile application" (the client under test) configured to query a Plan-Net service.
    *   A Plan-Net service endpoint accessible by the mobile application.
    *   A mechanism to observe and inspect the HTTP requests made by the mobile application (e.g., network proxy, sniffer, or developer tools).

### 3. Test Implementation Strategy

*   **Required Inputs**:
    *   The mobile application should be in a state where it can perform typical queries to the Plan-Net service (e.g., searching for providers, locations, or services).
    *   No specific FHIR resources are provided *as input to the client* by the test harness. The test focuses on observing the client's generated requests.
*   **Required FHIR Operations**:
    *   The client will primarily perform `GET` operations, specifically FHIR search queries (e.g., `GET [base]/Organization?name=...`, `GET [base]/Location?address-city=...`, `GET [base]/HealthcareService?type=...`).
    *   The "General Capabilities" in the Capability Statement indicate that standard FHIR search operations are supported.
*   **Validation Criteria**:
    *   **Test Case 1: Standard Plan-Net Query (No PII Expected)**
        1.  **Action**: Instruct the mobile application to perform a typical search query to the Plan-Net service (e.g., search for a provider by specialty, or a location by city).
        2.  **Observation**: Intercept and inspect the outgoing HTTP GET request(s) made by the mobile application to the Plan-Net service endpoint.
        3.  **Assertion**:
            *   The URL query parameters of the request MUST NOT contain any parameters commonly associated with consumer (patient) identifiable information. This includes, but is not limited to, the following FHIR search parameters if they refer to a `Patient` resource:
                *   `patient` (reference parameter)
                *   `patient.name`
                *   `patient.identifier`
                *   `patient.birthdate`
                *   `patient.gender`
                *   `patient.address`
                *   `patient.telecom`
                *   `_id` (if it refers to a Patient resource ID)
            *   The request body (if any, though unlikely for a GET search) MUST NOT contain any consumer identifiable information.
            *   The request headers MUST NOT contain any consumer identifiable information (e.g., in custom headers, though this is less common for PII).
            *   The Plan-Net service should return a successful response (e.g., HTTP 200 OK) containing a `Bundle` of relevant resources (e.g., `Organization`, `Location`, `HealthcareService`, `PractitionerRole`). (This is secondary to the PII check but confirms the query was valid).

    *   **Test Case 2: Attempted PII Query (If Applicable - for robustness)**
        *   *Note*: This test case is more about robustness or negative testing if the application *could* be coaxed into sending PII. Given "SHALL NOT send", the primary focus is on the client's default behavior. This case might be more relevant for a security audit than a pure conformance test.
        1.  **Action**: If the mobile application has any input fields that *could* potentially be misused to enter patient PII (e.g., a free-text search that might be interpreted as a patient name), attempt to enter such information and initiate a query.
        2.  **Observation**: Intercept and inspect the outgoing HTTP GET request(s).
        3.  **Assertion**:
            *   Even when provided with input that *could* be PII, the mobile application MUST still adhere to the "SHALL NOT send consumer identifiable information" rule. The URL query parameters and request body MUST NOT contain the forbidden PII parameters as defined in Test Case 1.
            *   The application should either filter out such input, or construct a query that does not include it as PII (e.g., if "John Doe" is entered, it should search for a provider named "John Doe", not a patient).

---

<a id='req-10'></a>

### REQ-10: JSON format support

**Description**: "Support json source formats for all Plan-Net interactions."

**Actor**: Health Plan API

**Conformance**: SHALL

## FHIR Test Specification: JSON Format Support

### 1. Requirement ID
REQ-10

### 2. Requirement Analysis

*   **Testability Assessment**: Automatically Testable. This requirement can be verified by making specific API calls and inspecting the HTTP response headers and body content. It is not too vague and focuses on a core interoperability aspect not solely covered by a FHIR validator (which checks content, not the server's acceptance of format requests).

*   **Complexity**: Moderate. While the concept of supporting JSON is simple, the requirement specifies "all Plan-Net interactions." This implies testing across multiple common FHIR operations (e.g., read, search) and potentially multiple resource types relevant to Plan-Net (e.g., Organization, Location, HealthcareService, Practitioner). The breadth makes it moderate rather than simple.

*   **Prerequisites**:
    *   An operational Health Plan API endpoint that implements the Plan-Net IG.
    *   Access to at least one existing FHIR resource (e.g., `Organization`, `Location`, `HealthcareService`) that can be retrieved via `read` or `search` operations. The specific IDs or search parameters for these resources will be provided by the tester ("bring your own data").
    *   The API must be accessible via HTTP(S).

### 3. Test Implementation Strategy

**Note on Capability Statement**: The provided Capability Statement information is empty. For this test specification, it is assumed that the "Health Plan API" supports standard FHIR RESTful interactions like `read` and `search` for Plan-Net relevant resources (e.g., `Organization`, `Location`, `HealthcareService`). A complete Capability Statement would explicitly list the supported interactions and resource types, allowing for more precise test case generation.

*   **Required Inputs**:
    *   **For Read Operations**: A valid FHIR resource ID (e.g., `[Organization_ID]`, `[Location_ID]`, `[HealthcareService_ID]`) for an existing resource on the Health Plan API.
    *   **For Search Operations**: Valid search parameters (e.g., `name=`, `organization=`, `address=`) that would yield at least one result for a given resource type (e.g., `Organization`, `Location`, `HealthcareService`).
    *   **HTTP Headers/Parameters**:
        *   `Accept: application/fhir+json` (preferred for FHIR JSON)
        *   `Accept: application/json` (as a fallback or alternative if `fhir+json` is not strictly enforced but `json` is accepted)
        *   `_format=json` (FHIR standard parameter for requesting format)
        *   `_format=application/fhir+json` (FHIR standard parameter for requesting specific FHIR JSON format)

*   **Expected Outputs**:
    *   HTTP Status Code: `200 OK`
    *   HTTP `Content-Type` header: `application/fhir+json` (or `application/json` if `fhir+json` is not supported but `json` is)
    *   Response Body: A valid JSON representation of the requested FHIR resource or a FHIR Bundle containing resources, conforming to the relevant Plan-Net profiles.

*   **Required FHIR Operations**:
    The following operations are commonly used in Plan-Net and should be tested for JSON support. The specific resource types to test should align with those listed in the full Plan-Net IG and the Health Plan API's Capability Statement.

    1.  **Read Operation (e.g., Organization)**
        *   **HTTP Method**: `GET`
        *   **Endpoint**: `[base]/Organization/[Organization_ID]`
        *   **Test Cases**:
            *   **Test Case 3.1.1: Read Organization with `Accept: application/fhir+json` header**
                *   Request Header: `Accept: application/fhir+json`
            *   **Test Case 3.1.2: Read Organization with `_format=json` parameter**
                *   Request URL Parameter: `_format=json`
            *   **Test Case 3.1.3: Read Organization with `_format=application/fhir+json` parameter**
                *   Request URL Parameter: `_format=application/fhir+json`

    2.  **Search Operation (e.g., Location)**
        *   **HTTP Method**: `GET`
        *   **Endpoint**: `[base]/Location?name=[Location_Name_Search_Param]` (or other relevant search parameters)
        *   **Test Cases**:
            *   **Test Case 3.2.1: Search Location with `Accept: application/fhir+json` header**
                *   Request Header: `Accept: application/fhir+json`
            *   **Test Case 3.2.2: Search Location with `_format=json` parameter**
                *   Request URL Parameter: `_format=json`
            *   **Test Case 3.2.3: Search Location with `_format=application/fhir+json` parameter**
                *   Request URL Parameter: `_format=application/fhir+json`

    3.  **Search Operation (e.g., HealthcareService)**
        *   **HTTP Method**: `GET`
        *   **Endpoint**: `[base]/HealthcareService?organization=[Organization_ID_Search_Param]` (or other relevant search parameters)
        *   **Test Cases**:
            *   **Test Case 3.3.1: Search HealthcareService with `Accept: application/fhir+json` header**
                *   Request Header: `Accept: application/fhir+json`
            *   **Test Case 3.3.2: Search HealthcareService with `_format=json` parameter**
                *   Request URL Parameter: `_format=json`
            *   **Test Case 3.3.3: Search HealthcareService with `_format=application/fhir+json` parameter**
                *   Request URL Parameter: `_format=application/fhir+json`

*   **Validation Criteria**:
    For each test case (3.1.1 through 3.3.3):

    1.  **HTTP Status Code**: Assert that the HTTP response status code is `200 OK`.
    2.  **Content-Type Header**: Assert that the `Content-Type` header in the response is `application/fhir+json`. If `application/fhir+json` is not returned but `application/json` is, and the content is valid FHIR JSON, this may indicate partial conformance, but `application/fhir+json` is the preferred and expected FHIR media type.
    3.  **JSON Validity**: Assert that the response body is valid JSON according to JSON parsing rules.
    4.  **FHIR Resource/Bundle Validity**: Assert that the JSON response body represents a valid FHIR resource (for read operations) or a valid FHIR Bundle (for search operations) according to the FHIR specification and the relevant Plan-Net profiles. This can be done using a FHIR validator.
    5.  **Data Consistency**: For read operations, assert that the retrieved resource matches the expected resource (e.g., by checking a key identifier or a few known fields). For search operations, assert that the returned Bundle contains resources relevant to the search criteria. (This is to ensure a meaningful response, not just an empty valid JSON).

---



<a id='plan-net-insuranceplan'></a>

## Plan-Net InsurancePlan

<a id='req-03'></a>

### REQ-03: Population of Must Support data elements

**Description**: "Health Plan API actors SHALL be capable of populating all Must Support data elements as part of the query results."

**Actor**: Health Plan API

**Conformance**: SHALL

## FHIR Test Specification

### 1. Requirement ID
REQ-03

### 2. Requirement Analysis

*   **Testability Assessment**: Automatically Testable. This requirement can be verified by programmatically querying the Health Plan API and inspecting the returned FHIR resources to ensure that all elements designated as "Must Support" in the relevant profiles are present and populated when data exists for them in the source system. This goes beyond basic structural validation and requires specific content checks.

*   **Complexity**: Moderate. Testing this requires:
    *   Identifying all "Must Support" elements across potentially multiple FHIR profiles defined by the Implementation Guide.
    *   Performing various queries to retrieve different resource instances.
    *   Programmatically iterating through returned resources and their elements to verify the presence and population of "Must Support" fields.
    *   Understanding that "population" implies that if the underlying data exists, it must be represented, not just that the element is structurally present.

*   **Prerequisites**:
    *   A deployed Health Plan API endpoint that implements the specified FHIR Implementation Guide.
    *   Access to the FHIR Implementation Guide's profiles to accurately identify all "Must Support" data elements for the resources expected in query results (e.g., Patient, Coverage, ExplanationOfBenefit, etc.).
    *   Test data within the Health Plan API's system that is known to contain values for the "Must Support" elements across various resource instances. The tester is responsible for providing or ensuring the existence of such data for effective validation.

### 3. Test Implementation Strategy

*   **Required Inputs and Expected Outputs**:
    *   **Required Inputs**:
        *   A comprehensive list of all FHIR profiles defined by the Implementation Guide that the Health Plan API is expected to return in query results.
        *   For each identified profile, a precise list of all data elements marked as "Must Support". This includes nested elements if they are also "Must Support".
        *   Valid FHIR search parameters (e.g., `_id`, `identifier`, `name`, `birthdate`, `patient`, `status`) to retrieve relevant resource instances from the Health Plan API.
        *   Knowledge of the test data residing within the Health Plan API's system, specifically which "Must Support" elements are expected to have values for particular resource instances.
    *   **Expected Outputs**:
        *   Successful HTTP 200 OK responses for all FHIR operations.
        *   Returned FHIR Bundles containing the requested resources (e.g., Patient, Coverage, ExplanationOfBenefit).
        *   For every resource instance returned, all "Must Support" data elements (as defined by the applicable profile) that *have corresponding data* in the Health Plan API's source system must be present and populated with valid values in the FHIR resource.

*   **Required FHIR Operations**:
    *   `GET [base]/[Resource]?_query_parameters` (FHIR Search Operation): This operation is essential for retrieving "query results" and testing the population of Must Support elements across multiple instances. Examples include `GET [base]/Patient?identifier=[system]|[value]`, `GET [base]/Coverage?patient=[id]`, `GET [base]/ExplanationOfBenefit?patient=[id]`.

*   **Validation Criteria**:
    *   **Successful API Response**: The API call must return an HTTP 200 OK status code, indicating a successful query.
    *   **Resource Retrieval**: The response body must contain a FHIR Bundle resource, and the Bundle must contain entries of the expected resource type(s) (e.g., Patient, Coverage, ExplanationOfBenefit).
    *   **Must Support Element Presence and Population**:
        *   For each resource instance (e.g., a specific Patient, Coverage, or EOB resource) returned within the Bundle:
            *   Identify the specific FHIR profile(s) that the resource claims conformance to (if applicable, via `meta.profile`).
            *   Based on the identified profile(s), retrieve the list of all "Must Support" data elements for that resource type.
            *   For each "Must Support" element:
                *   **If the underlying source system data for that specific resource instance contains a value for this element**, then the element *must be present* in the returned FHIR resource and *must be populated* with a valid value.
                *   If the "Must Support" element is a complex data type (e.g., `Address`, `HumanName`, `CodeableConcept`), then all its "Must Support" sub-elements must also adhere to the same population rule if data exists for them.
                *   Cardinality checks: If a "Must Support" element has a minimum cardinality of 1 (`1..*`), it must always be present. If it has a cardinality of `0..*` or `0..1`, it must be present *only if data exists* for it in the source system.
    *   **No Unexpected Errors**: The response should not contain an `OperationOutcome` resource indicating errors related to missing "Must Support" data elements or issues with data parsing/representation.

---



