# Consolidated Test Plan for Plan Net

## Generated on: 2025-04-09 12:28:50

## Capability Statement

This test plan incorporates constraints and requirements from the Plan Net Capability Statement.

## Table of Contents

- [Client](#client)
  - [REQ-02: No PII sending by clients](#req-02)
  - [REQ-06: Client handling of Must Support data elements](#req-06)
  - [REQ-07: Client display of data elements](#req-07)
  - [REQ-08: Client interpretation of missing Must Support data](#req-08)
  - [REQ-09: Client processing of missing information indicators](#req-09)
  - [REQ-31: Client tracking of directory content updates](#req-31)
- [Server](#server)
  - [REQ-01: No PII requirement for directory queries](#req-01)
  - [REQ-03: Population of Must Support data elements](#req-03)
  - [REQ-04: Not including absent data elements](#req-04)
  - [REQ-05: Using dataAbsentReason for missing required information](#req-05)
  - [REQ-10: JSON format support](#req-10)
  - [REQ-11: RESTful behavior implementation](#req-11)
  - [REQ-12: Support for all Implementation Guide profiles](#req-12)
  - [REQ-13: Unauthorized request response](#req-13)
  - [REQ-14: Insufficient scope response](#req-14)
  - [REQ-15: Invalid parameter response](#req-15)
  - [REQ-16: Unknown resource response](#req-16)
  - [REQ-17: Deleted resource response](#req-17)
  - [REQ-18: Profile identification in meta attribute](#req-18)
  - [REQ-19: Individual search parameter support](#req-19)
  - [REQ-20: Combination search parameter support](#req-20)
  - [REQ-21: Forward chaining support](#req-21)
  - [REQ-22: Reverse chaining support](#req-22)
  - [REQ-23: XML format support](#req-23)
  - [REQ-24: Rejection of unauthorized requests](#req-24)
  - [REQ-25: Support for read interaction](#req-25)
  - [REQ-26: Support for vread interaction](#req-26)
  - [REQ-27: Support for _includes](#req-27)
  - [REQ-28: Support for _revincludes](#req-28)
  - [REQ-29: Network profile NPI handling](#req-29)
  - [REQ-30: lastUpdate timestamp requirement](#req-30)
  - [REQ-32: General Search for Pharmacy](#req-32)
  - [REQ-33: Provider search by name](#req-33)
  - [REQ-34: Organization search by name](#req-34)
  - [REQ-35: Provider search by specialty](#req-35)
  - [REQ-36: Organization search by specialty](#req-36)
  - [REQ-37: Search for active practitioners and organizations](#req-37)
  - [REQ-38: Network contact handling for departments](#req-38)
  - [REQ-39: Organization contact handling for departments](#req-39)
  - [REQ-40: Practitioner qualification coding](#req-40)

## Test Specifications

<a id='client'></a>

## Client

<a id='req-02'></a>

### REQ-02: No PII sending by clients

**Description**: "A directory mobile application SHALL NOT send consumer identifiable information when querying a Plan-Net service."

**Actor**: Client

**Conformance**: SHALL NOT

## Test Specification for REQ-02: No PII Sending by Clients

**1. Requirement ID:** REQ-02

**2. Requirement Analysis:**

   - **Testability Assessment:** Hybrid (Automated network traffic analysis combined with manual inspection of client code/configuration)
   - **Complexity:** Moderate
   - **Prerequisites:** 
      - A deployed instance of the directory mobile application.
      - Access to network traffic analysis tools (e.g., Wireshark, Fiddler).
      - (Optional) Access to the mobile application's source code or configuration files.
      - A test environment configured to simulate interaction with the Plan-Net service.

**3. Test Implementation Strategy:**

   **3.1. Test Case 1: Network Traffic Analysis**

     - **Objective:** Verify that no PII is transmitted over the network when the mobile application queries the Plan-Net service.

     - **Inputs:**
       - A user action within the mobile application that triggers a query to the Plan-Net service.

     - **Expected Outputs:**
       - Network traffic capture showing the request and response data exchanged between the mobile application and the Plan-Net service.

     - **Required FHIR Operations:**  (Note: These should be identified from the Capability Statement and listed here.)
       - Example: `GET [base]/Patient`

     - **Test Data Requirements:**
       -  N/A for network traffic analysis, as we are looking for the absence of specific data.

     - **Validation Criteria:**
       - The captured network traffic MUST NOT contain any of the following PII elements within the request payload:
         - Patient Name
         - Patient Date of Birth
         - Patient Address
         - Patient Social Security Number
         - Any other information deemed as PII by the system's data governance policies.

   **3.2. Test Case 2: Client Code/Configuration Inspection (Optional)**

     - **Objective:**  (If access to code/configuration is available) Verify that the mobile application is not configured to send PII when querying the Plan-Net service.

     - **Inputs:**
       - Source code or configuration files of the mobile application.

     - **Expected Outputs:**
       - Identification of the code sections or configuration settings responsible for constructing the Plan-Net service queries.

     - **Required FHIR Operations:** N/A

     - **Test Data Requirements:** N/A

     - **Validation Criteria:**
       - The identified code sections or configuration settings MUST NOT include any logic or values that would result in PII being included in the Plan-Net service query requests. 

**Notes:**

* This test specification focuses on the client-side (mobile application) behavior. Server-side validation of incoming data is also crucial but falls outside the scope of this specific requirement.
* The specific PII elements to be checked should be explicitly defined based on the system's data governance policies and relevant regulations (e.g., HIPAA, GDPR).
* The Capability Statement should be consulted to determine the specific FHIR resources and operations used by the mobile application to interact with the Plan-Net service. This information is essential for defining the test data and validation criteria. 


---

<a id='req-06'></a>

### REQ-06: Client handling of Must Support data elements

**Description**: "Application actors SHALL be capable of processing resource instances containing the Must Support data elements without generating an error or causing the application to fail."

**Actor**: Client

**Conformance**: SHALL

## Test Specification for REQ-06: Client Handling of Must Support Data Elements

### 1. Requirement ID

REQ-06

### 2. Requirement Analysis

**Testability Assessment:** Hybrid (Combination of Automated and Manual)

**Complexity:** Moderate

**Prerequisites:**

* A running instance of the client application under test.
* Access to a FHIR server with capability to process the resources and data elements relevant to the Implementation Guide.
* Test data sets containing resources with "Must Support" data elements as defined in the Implementation Guide. This may include variations:
    * Resources with only the required "Must Support" elements.
    * Resources with additional optional elements alongside the "Must Support" elements.
    * Resources with edge-case values for the "Must Support" elements (e.g., valid but unusual data types, maximum lengths).

### 3. Test Implementation Strategy

#### 3.1 Required Inputs and Expected Outputs

**Inputs:**

* A FHIR resource instance containing one or more "Must Support" data elements as defined in the Implementation Guide.

**Expected Outputs:**

* Successful processing of the resource by the client application without generating errors or application failure.
* Depending on the specific resource and operation, this could involve:
    * Successful persistence of the resource if it's a create/update operation.
    * Retrieval and display of the resource data if it's a read operation.
    * Execution of the appropriate business logic associated with the resource.

#### 3.2 Required FHIR Operations

* The specific FHIR operations (e.g., `read`, `create`, `update`, `search`) will depend on the resources and functionalities covered by the Implementation Guide. 
* **Crucially, ensure that the Capability Statement of the system under test advertises support for these operations with the relevant resources and their "Must Support" data elements.**

#### 3.3 Test Data Requirements

* **Positive Test Cases:**
    * Well-formed resources containing all required "Must Support" data elements with typical values.
    * Resources with a mix of required "Must Support" and optional elements.
* **Negative Test Cases (Optional, to test robustness):**
    * Resources with edge-case values for "Must Support" elements (e.g., valid but unusual data types, maximum lengths) to assess how the client handles these. 
    * **Important:** Negative testing should not violate the FHIR specification or basic data type requirements.

#### 3.4 Validation Criteria

1. **Automated Checks:**
    * Monitor the client application logs for any error messages or exceptions during the test execution.
    * Verify successful HTTP status codes (e.g., 200 OK, 201 Created) for the FHIR API calls.
    * If applicable, validate the response payload from the server to ensure the data was processed as expected (e.g., resource created/updated successfully).

2. **Manual Checks (if necessary):**
    * For operations involving user interfaces, visually inspect that the application displays the resource data correctly and without errors.
    * Review application-specific logs or audit trails to confirm the successful processing of the "Must Support" data elements.

**Passing Criteria:**

The test is considered passed if **all** of the following conditions are met:

* No errors or exceptions are logged by the client application.
* Successful HTTP status codes are received for all FHIR API calls.
* Any automated response validation checks are successful.
* Manual checks (if applicable) confirm the correct processing of the data. 


---

<a id='req-07'></a>

### REQ-07: Client display of data elements

**Description**: "Application actors SHOULD be capable of displaying the data elements for human use or storing the information for other purposes."

**Actor**: Client

**Conformance**: SHOULD

## Test Specification for REQ-07: Client Display of Data Elements

**1. Requirement ID:** REQ-07

**2. Requirement Analysis:**

   - **Testability Assessment:** Hybrid (Combination of Automatic and Manual)
   - **Complexity:** Moderate
   - **Prerequisites:**
     - A running instance of the client application under test.
     - Access to test data in FHIR format, representative of the resources and data elements the client should handle.
     -  A test environment with the necessary FHIR server and resources available.

**3. Test Implementation Strategy:**

   **3.1. Test Case 1: Display of Data Elements for Human Use**

     - **Description:** Verify the client application can retrieve and display data elements from a FHIR resource in a human-readable format.

     - **Required Inputs:**
       - A FHIR resource identifier (e.g., Patient ID).

     - **Expected Outputs:**
       - The client application should display the requested FHIR resource data elements in a clear and understandable format for a human user. This could be in a web interface, a mobile application view, or a report.

     - **Required FHIR Operations:**
       - `read`: To retrieve the specified FHIR resource from the server. 
       - (Potentially) `search`: If the test case involves searching for resources based on specific criteria.

     - **Test Data Requirements:**
       - A FHIR resource instance populated with relevant data elements.

     - **Validation Criteria:**
       - **Manual Inspection:** Verify that the displayed data elements are:
         - Accurate and match the data in the FHIR resource.
         - Presented in a user-friendly and understandable way (e.g., appropriate labels, formatting, and organization).
         - Complete, including all the required data elements for the specific use case as defined by the Implementation Guide (if applicable).

   **3.2. Test Case 2: Storage of Data Elements for Other Purposes**

     - **Description:** Verify the client application can store retrieved data elements for purposes other than direct human consumption (e.g., local storage, analytics, etc.).

     - **Required Inputs:**
       - A FHIR resource identifier (e.g., Patient ID).

     - **Expected Outputs:**
       - Evidence that the client application has successfully stored the data elements from the retrieved FHIR resource. This could be in the form of log entries, database records, or other system-specific artifacts.

     - **Required FHIR Operations:**
       - `read`: To retrieve the specified FHIR resource from the server. 

     - **Test Data Requirements:**
       - A FHIR resource instance populated with relevant data elements.

     - **Validation Criteria:**
       - **Automated or Manual Verification:**
         - **Automated:** Implement automated checks to verify the data is stored correctly in the intended location (database, log file, etc.).
         - **Manual:** Inspect the storage location (if accessible) to confirm the data elements have been stored accurately and completely.


**Notes:**

* The specific data elements to be displayed or stored should be determined based on the context of the Implementation Guide and the intended use cases.
* The test cases above provide a general framework. You may need to create additional test cases to cover specific scenarios or data elements relevant to your implementation.
* The "SHOULD" conformance level indicates that while this capability is recommended, it is not strictly mandatory. Therefore, the test results should be interpreted accordingly, and any deviations from the expected behavior should be documented and assessed for potential impact on interoperability. 


---

<a id='req-08'></a>

### REQ-08: Client interpretation of missing Must Support data

**Description**: "When querying Health Plan API actors, Application actors SHALL interpret missing Must Support data elements within resource instances as data not present in the Health Plan API actors system."

**Actor**: Client

**Conformance**: SHALL

## Test Specification for REQ-08: Client Interpretation of Missing Must Support Data

**1. Requirement ID:** REQ-08

**2. Requirement Analysis:**

   - **Testability Assessment:** Hybrid (Combination of automated API calls and manual inspection of client logic)
   - **Complexity:** Moderate
   - **Prerequisites:** 
      - A running instance of the client application under test.
      - A running instance of a Health Plan API actor that is conformant to the FHIR Implementation Guide.
      - Test data pre-populated in the Health Plan API actor's system, including resources with intentionally missing "Must Support" data elements.

**3. Test Implementation Strategy:**

**3.1 Test Case 1: Missing Must Support Data Element**

   - **Objective:** Verify that the client application correctly interprets missing "Must Support" data elements as data not present in the Health Plan API actor's system.

   - **Required Inputs:**
      - A FHIR query that targets a resource type and search parameters known to potentially return resources with missing "Must Support" data elements. 
      - This query should be supported by the Health Plan API actor's Capability Statement.

   - **Required FHIR Operations:**
      - `GET /{resourceType}?{search parameters}` (Search operation on the target resource type)

   - **Test Data Requirements:**
      - At least one instance of the target resource type should exist in the Health Plan API actor's system with a missing "Must Support" data element.

   - **Expected Outputs:**
      - The client application should successfully receive the search results from the Health Plan API actor.
      - The client application should NOT throw an error or warning related to the missing "Must Support" data element.
      - **Manual Inspection:** Examine the client application's logic (e.g., code review, logs) or user interface to confirm that it handles the missing data element as "data not present" and does not incorrectly interpret it as an error condition.

**3.2 Test Case 2:  Present Must Support Data Element**

   - **Objective:** Verify that the client application correctly processes resources where the "Must Support" data element is present and populated.

   - **Required Inputs:**
      - A FHIR query that targets the same resource type as Test Case 1, but with search parameters likely to return resources with the "Must Support" data element present.

   - **Required FHIR Operations:**
      - `GET /{resourceType}?{search parameters}` (Search operation on the target resource type)

   - **Test Data Requirements:**
      - At least one instance of the target resource type should exist in the Health Plan API actor's system with the "Must Support" data element populated.

   - **Expected Outputs:**
      - The client application should successfully receive the search results from the Health Plan API actor.
      - The client application should correctly process and display the data from the "Must Support" element.
      - **Manual Inspection:** Examine the client application's user interface or data processing logic to ensure it correctly handles the present data element.

**4. Validation Criteria:**

- The test cases are considered successful if the client application:
    - Correctly retrieves search results from the Health Plan API actor in both scenarios (missing and present "Must Support" data).
    - Does not produce errors or warnings related to the missing "Must Support" data element.
    - Demonstrates through code review, logs, or UI behavior that it interprets missing "Must Support" data as "data not present."
    - Correctly processes and handles the "Must Support" data element when it is present in the resource. 


---

<a id='req-09'></a>

### REQ-09: Client processing of missing information indicators

**Description**: "Consumer App actors SHALL be able to process resource instances containing Must Support data elements asserting missing information."

**Actor**: Client

**Conformance**: SHALL

## Test Specification for REQ-09: Client Processing of Missing Information Indicators

### 1. Requirement ID

REQ-09

### 2. Requirement Analysis

* **Testability Assessment:**  Automatic
* **Complexity:** Moderate
* **Prerequisites:**
    * A FHIR server with the required resources and capabilities as defined in the Capability Statement.
    * Test client (e.g., automated testing framework) capable of:
        * Sending requests to the FHIR server.
        * Parsing and validating FHIR resources.
    * Pre-populated FHIR resources containing Must Support data elements with missing information indicators.

### 3. Test Implementation Strategy

#### 3.1 Required Inputs and Expected Outputs

**Inputs:**

* **FHIR Resource Type:** The specific FHIR resource type to be tested (e.g., Patient, Observation).
* **Must Support Data Elements:** A list of data elements within the chosen resource type that are marked as "Must Support" and can have missing information indicators.

**Expected Outputs:**

* **HTTP Status Code:** 200 OK, indicating successful retrieval of the resource.
* **FHIR Resource:** The returned resource instance should contain the specified Must Support data elements with the appropriate missing information indicators.
* **No Errors:** The client application should not encounter any errors or exceptions while processing the resource with missing information indicators.

#### 3.2 Required FHIR Operations

* **Read:**  Used to retrieve the FHIR resource instance containing the Must Support data elements with missing information indicators.

#### 3.3 Test Data Requirements

* **Test Data Set:** A set of FHIR resources (e.g., Patient, Observation) containing:
    * Must Support data elements with different types of missing information indicators (e.g., data-absent-reason extensions).
    * Variations in data types and cardinality for the Must Support elements.

#### 3.4 Validation Criteria

1. **Successful Resource Retrieval:** Verify the client can successfully retrieve the FHIR resource containing Must Support data elements with missing information indicators (HTTP 200 OK).
2. **Accurate Parsing of Missing Information:** Verify the client correctly parses and identifies the missing information indicators within the retrieved resource.
3. **Appropriate Handling of Missing Data:** Verify the client application handles the missing information appropriately based on the specific indicator and application logic. This could involve:
    * Displaying specific messages to the user about the missing data.
    * Disabling or modifying functionality dependent on the missing data.
    * Triggering workflows to collect the missing information.

**Note:** The specific validation criteria will depend on the application's requirements and how it is designed to handle missing information. 


---

<a id='req-31'></a>

### REQ-31: Client tracking of directory content updates

**Description**: "Clients that cache query results can track additions or modifications to directory content through queries that filter content using the _lastUpdated search parameter."

**Actor**: Client

**Conformance**: None (Implementation guidance)

## Test Specification for REQ-31: Client Tracking of Directory Content Updates

### 1. Requirement ID

REQ-31

### 2. Requirement Analysis

* **Testability Assessment:** Hybrid (Combination of automated API calls and manual inspection of client behavior)
* **Complexity:** Moderate
* **Prerequisites:**
    * A FHIR server with directory resources that supports the `_lastUpdated` search parameter.
    * A client application capable of caching query results and utilizing the `_lastUpdated` search parameter.
    * Pre-populated directory resources on the FHIR server.

### 3. Test Implementation Strategy

#### 3.1 Required Inputs and Expected Outputs

**Inputs:**

* **Initial Query:** A FHIR search operation on a directory resource type.
* **Update Action:** Modification or creation of a resource within the initially queried directory.
* **Subsequent Query:** A FHIR search operation on the same directory resource type using the `_lastUpdated` parameter with a value greater than the timestamp of the initial query.

**Expected Outputs:**

* **Initial Query Response:** A bundle of directory resources matching the initial query criteria.
* **Subsequent Query Response:** 
    * If modifications/additions were made: A bundle containing only the resources modified or created after the initial query timestamp.
    * If no modifications/additions were made: An empty bundle.

#### 3.2 Required FHIR Operations

* **Read:** Used for both the initial and subsequent queries on the directory resource.
* **Create/Update:** Used to modify existing or create new resources within the directory. 

**Note:** Ensure the Capability Statement confirms support for these operations on the specific directory resource being tested.

#### 3.3 Test Data Requirements

* **Directory Resources:** A set of pre-populated resources representing the directory content.
* **Timestamps:** Accurate timestamps for both the initial query and the resource modifications/creations.

#### 3.4 Validation Criteria

1. **Initial Query:** Verify the client successfully retrieves and caches the initial set of directory resources.
2. **Resource Update:** Confirm the server correctly processes the resource modification/creation and updates the `lastUpdated` timestamp accordingly.
3. **Subsequent Query:**
    * **Content Validation:** Assert that the response bundle contains only the resources modified or created after the initial query timestamp.
    * **_lastUpdated Parameter Validation:** Verify the client constructs the subsequent query correctly using the `_lastUpdated` parameter with the appropriate timestamp.

**Passing Criteria:** The test passes if all validation criteria are met, demonstrating the client can effectively track directory content updates using the `_lastUpdated` search parameter. 


---



<a id='server'></a>

## Server

<a id='req-01'></a>

### REQ-01: No PII requirement for directory queries

**Description**: "A conformant Plan-Net service SHALL NOT require a directory mobile application to send consumer identifying information in order to query content."

**Actor**: Server

**Conformance**: SHALL NOT

## Test Specification for REQ-01: No PII Requirement for Directory Queries

**1. Requirement ID:** REQ-01

**2. Requirement Analysis:**

   - **Testability Assessment:** Automatic
   - **Complexity:** Simple
   - **Prerequisites:** 
      - A running Plan-Net conformant server.
      - A test client capable of making directory queries.

**3. Test Implementation Strategy:**

   **3.1. Test Case 1: Query without PII**

      - **Description:** Verify that the server successfully responds to a directory query that does not contain any consumer identifying information.
      - **Required Inputs:**
         - A directory query request that does **not** include any of the following:
            - Patient name
            - Patient identifier
            - Other patient demographics
            - Any other information that could be used to identify a specific consumer
      - **Expected Outputs:**
         - **HTTP Status Code:** 200 (OK)
         - **Response Body:** A valid FHIR Bundle resource containing the results of the directory query. 
      - **Required FHIR Operations:**
         - `GET` request to the appropriate directory search endpoint (specific endpoint will vary based on the implementation guide and the resource being queried). 
      - **Test Data Requirements:**
         - The specific query parameters will depend on the directory search being tested. However, they should be designed to retrieve a non-empty result set without relying on any PII.
      - **Validation Criteria:**
         - Verify the HTTP status code is 200 (OK).
         - Verify the response body is a valid FHIR Bundle resource.
         - Optionally, verify the content of the Bundle to ensure it contains the expected results based on the query parameters used.

   **3.2. Test Case 2:  Attempt Query with PII (Negative Test)**

      - **Description:** Verify that the server rejects a directory query that includes consumer identifying information.
      - **Required Inputs:**
         - A directory query request that **does** include at least one piece of consumer identifying information (e.g., a mock patient name).
      - **Expected Outputs:**
         - **HTTP Status Code:** 400 (Bad Request) OR 422 (Unprocessable Entity) - The specific code may vary depending on the server's implementation.
         - **Response Body:** An OperationOutcome resource explaining the reason for the rejection, specifically mentioning that PII is not allowed in directory queries.
      - **Required FHIR Operations:**
         - `GET` request to the appropriate directory search endpoint.
      - **Test Data Requirements:**
         - The query parameters should include at least one element that would be considered PII.
      - **Validation Criteria:**
         - Verify the HTTP status code is in the 4xx range, indicating an error.
         - Verify the response body is an OperationOutcome resource.
         - Verify the OperationOutcome resource explicitly states that PII is not allowed in directory queries. 

**Note:** These test cases provide a starting point. Depending on the specific implementation details of the Plan-Net service and its directory capabilities, additional test cases might be necessary to ensure comprehensive coverage. 


---

<a id='req-03'></a>

### REQ-03: Population of Must Support data elements

**Description**: "Health Plan API actors SHALL be capable of populating all Must Support data elements as part of the query results."

**Actor**: Server

**Conformance**: SHALL

## Test Specification for REQ-03: Population of Must Support Data Elements

**1. Requirement ID:** REQ-03

**2. Requirement Analysis:**

   - **Testability Assessment:**  Hybrid (Automated test to execute the query and validate presence of elements, manual review potentially needed for edge cases or specific data values)
   - **Complexity:** Moderate (Requires understanding of Must Support elements and constructing appropriate queries)
   - **Prerequisites:**
     - A running FHIR server compliant with the Health Plan API implementation guide.
     - Access to test data containing resources with Must Support elements.
     - Knowledge of the specific Must Support data elements defined in the Implementation Guide.

**3. Test Implementation Strategy:**

   **3.1. Required Inputs:**

     - **FHIR Server Endpoint:**  URL of the FHIR server under test.
     - **Resource Type:** The type of FHIR resource to query (e.g., Patient, Coverage).
     - **List of Must Support Data Elements:** A comprehensive list of all Must Support data elements for the specified resource type as defined in the Implementation Guide.

   **3.2. Expected Outputs:**

     - **HTTP Status Code:** 200 (OK) indicating a successful query.
     - **FHIR Bundle:** A Bundle resource containing the query results.
     - **Presence of Must Support Elements:** All Must Support data elements should be populated with values (which may include empty arrays or literal "unknown" values where applicable) within the returned resources.

   **3.3. Required FHIR Operations:**

     - **Search Operation:** Execute a search operation (e.g., GET [base]/Patient?family=Smith) on the specified resource type. The Capability Statement should indicate support for the search operation on the chosen resource.

   **3.4. Test Data Requirements:**

     - **Test Data:**  Seed the FHIR server with test data that includes instances of the target resource type with populated Must Support elements. 
     - **Data Variation:** Include a variety of test data to cover different scenarios (e.g., different data types, optional elements, coded values).

   **3.5. Validation Criteria:**

     1. **HTTP Status Code Validation:** Verify that the server returns an HTTP status code of 200 (OK).
     2. **Resource Type Validation:** Confirm that the returned resource is a Bundle.
     3. **Must Support Element Presence:** For each resource in the Bundle:
        - Iterate through the list of Must Support data elements.
        - Assert that each element is present within the resource.
        - If the element is repeatable, verify that at least one entry exists (unless an empty array is a valid value).
        - **Note:**  The specific validation for the presence and value of an element will depend on the element's cardinality and data type as defined in the Implementation Guide.

**Example Test Case:**

**Test Case ID:** TC_REQ-03_Patient_MustSupport

**Description:** Verify that the server populates all Must Support data elements for the Patient resource.

**Steps:**

1. Execute a search operation for Patient resources (e.g., GET [base]/Patient).
2. Verify the HTTP status code is 200 (OK).
3. Verify the returned resource is a Bundle.
4. For each Patient resource in the Bundle:
   - Assert that the following Must Support elements are present:
     - `id`
     - `name`
     - `birthDate` 
     - ... (continue for all Must Support elements of the Patient resource)

**Expected Result:** All assertions pass, indicating that the server correctly populates Must Support data elements for the Patient resource. 


---

<a id='req-04'></a>

### REQ-04: Not including absent data elements

**Description**: "In situations where information on a particular Must Support data element is not present and the minimum cardinality is 0, the Health Plan API actors SHALL NOT include the data elements in the resource instance returned as part of the query results."

**Actor**: Server

**Conformance**: SHALL NOT

## Test Specification for REQ-04: Not Including Absent Data Elements

### 1. Requirement ID

REQ-04

### 2. Requirement Analysis

- **Testability Assessment:** Automatic
- **Complexity:** Simple
- **Prerequisites:**
    - A running FHIR server compliant with the Implementation Guide.
    - Test Patient resource instances with specific data elements intentionally missing where the minimum cardinality is 0.

### 3. Test Implementation Strategy

#### 3.1. Test Case 1: Missing Optional Data Element

**Objective:** Verify that the server does not return a data element with minimum cardinality 0 when the element is not present in the resource.

**Inputs:**

- **FHIR Operation:**  `GET [Base]/Patient/[id]`
- **Test Data:** A Patient resource with a known `id` where an optional data element (e.g., `telecom.email`, `address.line2`, `contact.relationship.text`) is intentionally missing.

**Expected Outputs:**

- **HTTP Status Code:** 200 OK
- **Response Body:** A Patient resource in JSON or XML format.
- **Validation Criteria:**
    - **Assertion:** The response body MUST NOT contain the specific data element that was intentionally left blank in the test data. For example, if `telecom.email` was missing in the test data, the response should not include any `telecom` element with an empty or null `email` field.

#### 3.2. Test Case 2: Multiple Missing Optional Data Elements

**Objective:** Verify that the server does not return multiple data elements with minimum cardinality 0 when these elements are not present in the resource.

**Inputs:**

- **FHIR Operation:**  `GET [Base]/Patient/[id]`
- **Test Data:** A Patient resource with a known `id` where multiple optional data elements (e.g., `telecom.email`, `address.line2`, `contact.relationship.text`) are intentionally missing.

**Expected Outputs:**

- **HTTP Status Code:** 200 OK
- **Response Body:** A Patient resource in JSON or XML format.
- **Validation Criteria:**
    - **Assertion:** The response body MUST NOT contain any of the specific data elements that were intentionally left blank in the test data. 

#### 3.3.  Test Automation Considerations:

- These tests can be automated using testing frameworks like Jest (JavaScript), pytest (Python), or Rest-Assured (Java) along with FHIR client libraries.
- The validation criteria can be implemented by parsing the returned JSON or XML response and asserting the absence of the specific data elements.

**Note:** 

- These test cases assume that the CapabilityStatement for the server confirms support for the `read` interaction on the `Patient` resource.
- The specific data elements used in the test cases should be replaced with actual data elements from the Implementation Guide that have a minimum cardinality of 0. 


---

<a id='req-05'></a>

### REQ-05: Using dataAbsentReason for missing required information

**Description**: "In situations where information on a particular data element is not present and the minimum cardinality is >0, SHALL send the reason for the missing information using values (such as nullFlavors) from the value set where they exist or use the dataAbsentReason extension."

**Actor**: Server

**Conformance**: SHALL

## Test Specification for REQ-05: Using dataAbsentReason for Missing Required Information

**1. Requirement ID:** REQ-05

**2. Requirement Analysis:**

   - **Testability Assessment:** Automatic
   - **Complexity:** Simple
   - **Prerequisites:**
     - A FHIR server that implements the target Implementation Guide.
     - Access to create and retrieve resources relevant to the requirement.
     - Knowledge of resources and data elements with minimum cardinality > 0.

**3. Test Implementation Strategy:**

   **3.1. Test Case 1: Valid dataAbsentReason Code**

     - **Description:** Verify that the server accepts and processes a resource with a missing required element when a valid `dataAbsentReason` extension is provided.

     - **Required Inputs:**
       - A FHIR resource with a missing required element.
       - A valid `dataAbsentReason` extension with a code from the appropriate value set (if applicable) or a generic code like "unknown" or "not-applicable."

     - **Expected Outputs:**
       - HTTP Status Code: 200 (OK) or 201 (Created) depending on the FHIR operation.
       - The server should successfully process the resource despite the missing required element.

     - **Required FHIR Operations:**
       - Create (POST) or Update (PUT) depending on the resource type.

     - **Test Data Requirements:**
       - A sample resource instance relevant to the implementation guide with a known required element omitted.
       - A valid `dataAbsentReason` extension. Example:

         ```json
         {
           "url": "http://hl7.org/fhir/StructureDefinition/data-absent-reason",
           "valueCodeableConcept": {
             "coding": [
               {
                 "system": "http://terminology.hl7.org/CodeSystem/data-absent-reason",
                 "code": "unknown"
               }
             ]
           }
         }
         ```

     - **Validation Criteria:**
       - Verify the HTTP status code indicates successful processing.
       - Optionally retrieve the created/updated resource and confirm the presence of the `dataAbsentReason` extension.

   **3.2. Test Case 2: Missing dataAbsentReason**

     - **Description:** Verify that the server rejects a resource with a missing required element and no `dataAbsentReason` provided.

     - **Required Inputs:**
       - A FHIR resource with a missing required element and no `dataAbsentReason` extension.

     - **Expected Outputs:**
       - HTTP Status Code: 400 (Bad Request) or similar error indicating a validation failure.
       - An OperationOutcome resource explaining the reason for rejection (missing required element).

     - **Required FHIR Operations:**
       - Create (POST) or Update (PUT) depending on the resource type.

     - **Test Data Requirements:**
       - A sample resource instance relevant to the implementation guide with a known required element omitted and no `dataAbsentReason` provided.

     - **Validation Criteria:**
       - Verify the HTTP status code indicates a failed request.
       - Verify the OperationOutcome resource contains an issue indicating the missing required element.

   **3.3. Test Case 3: Invalid dataAbsentReason Code (if applicable)**

     - **Description:** Verify that the server rejects a resource with a missing required element and an invalid `dataAbsentReason` code.

     - **Required Inputs:**
       - A FHIR resource with a missing required element.
       - A `dataAbsentReason` extension with an invalid or non-existent code.

     - **Expected Outputs:**
       - HTTP Status Code: 400 (Bad Request) or similar error indicating a validation failure.
       - An OperationOutcome resource explaining the reason for rejection (invalid `dataAbsentReason` code).

     - **Required FHIR Operations:**
       - Create (POST) or Update (PUT) depending on the resource type.

     - **Test Data Requirements:**
       - A sample resource instance relevant to the implementation guide with a known required element omitted.
       - A `dataAbsentReason` extension with an invalid code.

     - **Validation Criteria:**
       - Verify the HTTP status code indicates a failed request.
       - Verify the OperationOutcome resource contains an issue indicating the invalid `dataAbsentReason` code.

**Note:** These test cases provide a starting point. You may need to adapt them based on the specific resources and data elements relevant to your implementation guide and the specific value sets used for `dataAbsentReason`. 


---

<a id='req-10'></a>

### REQ-10: JSON format support

**Description**: "Support json source formats for all Plan-Net interactions."

**Actor**: Server

**Conformance**: SHALL

## Test Specification for REQ-10: JSON Format Support

**1. Requirement ID:** REQ-10

**2. Requirement Analysis:**

   - **Testability Assessment:** Automatic
   - **Complexity:** Simple
   - **Prerequisites:** 
     - A running FHIR server that implements the Plan-Net interactions.
     - Test client capable of sending requests with JSON body and interpreting JSON responses.

**3. Test Implementation Strategy:**

   **3.1. Test Case 1: Successful Plan-Net Interaction with JSON**

     - **Description:** Verify that the server successfully processes a Plan-Net interaction request submitted with a JSON body.
     - **Required Inputs:**
       - A valid FHIR resource instance relevant to a Plan-Net interaction (e.g., Coverage, Claim) in JSON format.
     - **Required FHIR Operations:**
       - **POST** (or relevant HTTP verb based on the specific Plan-Net interaction) to the appropriate resource endpoint.
     - **Test Data Requirements:**
       - Use realistic test data for the chosen Plan-Net interaction resource.
     - **Expected Outputs:**
       - HTTP Status Code: **200 OK** (or appropriate success code for the interaction).
       - Response Body: A valid FHIR resource instance in JSON format, representing the outcome of the interaction.
     - **Validation Criteria:**
       - Assert that the HTTP status code indicates success.
       - Assert that the response Content-Type header is "application/fhir+json".
       - Validate the response body conforms to the expected FHIR resource profile and contains the expected data.

   **3.2. Test Case 2:  Invalid JSON Request**

     - **Description:** Verify that the server gracefully handles and returns an error for an invalid JSON request body.
     - **Required Inputs:**
       - An invalid JSON document (e.g., missing quotes, incorrect syntax).
     - **Required FHIR Operations:**
       - **POST** (or relevant HTTP verb) to the appropriate resource endpoint.
     - **Test Data Requirements:**
       - Create a deliberately malformed JSON document.
     - **Expected Outputs:**
       - HTTP Status Code: **400 Bad Request** (or appropriate error code for invalid request).
       - Response Body: An OperationOutcome resource in JSON format, detailing the error encountered.
     - **Validation Criteria:**
       - Assert that the HTTP status code indicates a client error (4xx range).
       - Assert that the response Content-Type header is "application/fhir+json".
       - Validate the response body is a valid OperationOutcome resource and contains a relevant error message about the invalid JSON. 

**Notes:**

- This test specification provides a general framework. You'll need to adapt it based on the specific Plan-Net interactions your system supports.
- Refer to the FHIR specification and the Plan-Net implementation guide for details on resource profiles, interactions, and expected behaviors.
- Consider using a testing framework or tool that simplifies FHIR interaction testing and assertion validation. 


---

<a id='req-11'></a>

### REQ-11: RESTful behavior implementation

**Description**: "Implement the RESTful behavior according to the FHIR specification."

**Actor**: Server

**Conformance**: SHALL

## Test Specification for REQ-11: RESTful Behavior Implementation

### 1. Requirement ID

REQ-11

### 2. Requirement Analysis

* **Testability Assessment:** Hybrid (Combination of automated checks and manual inspection)
* **Complexity:** Moderate
* **Prerequisites:**
    * A running FHIR server that implements the target FHIR resources and interactions.
    * Access to the server's Capability Statement.
    * Tools for making HTTP requests and inspecting responses (e.g., Postman, curl).

### 3. Test Implementation Strategy

This requirement is broad and encompasses various aspects of RESTful behavior. Therefore, the test strategy is divided into sub-tests addressing specific aspects:

**3.1 Sub-test 1: HTTP Verb Support and Response Codes**

* **Objective:** Verify the server correctly implements HTTP verbs (GET, POST, PUT, DELETE) for supported resources and returns appropriate HTTP status codes.

* **Required Inputs:**
    *  List of resources supported by the server (from Capability Statement).
    *  Valid FHIR resources for testing create/update operations.

* **Expected Outputs:**
    *  HTTP status codes according to FHIR specification (e.g., 200 OK, 201 Created, 400 Bad Request, 404 Not Found).
    *  Appropriate response bodies (e.g., OperationOutcome for errors).

* **Required FHIR Operations:**
    *  GET, POST, PUT, DELETE on supported resources.

* **Test Data Requirements:**
    *  Valid FHIR resources conforming to the implemented profiles.

* **Validation Criteria:**
    *  **Automated:** Verify HTTP status codes returned for each operation on each supported resource.
    *  **Manual:** Inspect response bodies for correctness and adherence to FHIR specifications, especially for error scenarios.


**3.2 Sub-test 2: Resource Versioning and ETags**

* **Objective:** Verify the server correctly implements resource versioning using ETags and the If-Match/If-None-Match headers.

* **Required Inputs:**
    *  A previously created or fetched resource with an ETag.

* **Expected Outputs:**
    *  Appropriate HTTP status codes based on ETag comparison (e.g., 200 OK, 409 Conflict, 304 Not Modified).

* **Required FHIR Operations:**
    *  GET, PUT (update) on a versioned resource.

* **Test Data Requirements:**
    *  A resource on the server with a known ETag.

* **Validation Criteria:**
    *  **Automated:**
        *  Attempt to update a resource with a mismatched ETag and verify a 409 Conflict response.
        *  Attempt to update with a matching ETag and verify a successful update (200 OK or 201 Created).
        *  Fetch a resource with an If-None-Match header containing the current ETag and verify a 304 Not Modified response.
    *  **Manual:** Inspect response headers for correct ETag values.


**3.3 Sub-test 3: Conditional Create/Update/Delete**

* **Objective:** Verify the server supports conditional create, update, and delete operations based on search parameters.

* **Required Inputs:**
    *  Search parameters supported by the server for the target resources.

* **Expected Outputs:**
    *  HTTP status codes indicating success or failure of the conditional operation (e.g., 201 Created, 412 Precondition Failed).

* **Required FHIR Operations:**
    *  POST, PUT, DELETE with conditional parameters in the request URL.

* **Test Data Requirements:**
    *  Resources on the server that meet specific search criteria.

* **Validation Criteria:**
    *  **Automated:**
        *  Attempt conditional operations with matching and non-matching search criteria.
        *  Verify the server responds with appropriate status codes based on the resource state and conditional criteria.
    *  **Manual:** Inspect response bodies for correctness, especially for error scenarios.


**Note:** This test specification provides a starting point. The specific tests and their complexity will depend on the resources and interactions supported by the FHIR server, as advertised in its Capability Statement. 


---

<a id='req-12'></a>

### REQ-12: Support for all Implementation Guide profiles

**Description**: "Support all profiles defined in this Implementation Guide."

**Actor**: Server

**Conformance**: SHALL

## Test Specification for REQ-12: Support for all Implementation Guide profiles

### 1. Requirement ID

REQ-12

### 2. Requirement Analysis

* **Testability Assessment:** Hybrid (Automatic discovery, Manual validation)
* **Complexity:** Moderate
* **Prerequisites:**
    * Access to the target FHIR server's Capability Statement endpoint.
    * A list of all profiles defined within the Implementation Guide.

### 3. Test Implementation Strategy

#### 3.1. Test Procedure

This test will be conducted in two phases:

**Phase 1: Automatic Discovery**

1. **Retrieve the Capability Statement:** Send a GET request to the server's Capability Statement endpoint (e.g., `/metadata`).
2. **Extract Profile Information:** Parse the Capability Statement response and extract the following information for each resource type:
    * `rest.resource.supportedProfile`: This array lists all the supported profiles for each resource type.
3. **Compile Supported Profiles:** Create a list of all unique profile URLs found within the `supportedProfile` arrays across all resources.

**Phase 2: Manual Validation**

1. **Compare Profile Lists:** Manually compare the list of profiles extracted from the Capability Statement (Phase 1) against the complete list of profiles defined in the Implementation Guide.
2. **Verify Inclusion:** Ensure that every profile defined in the Implementation Guide is present in the list of profiles extracted from the Capability Statement.

#### 3.2. Required FHIR Operations

* **READ (GET):** Used to retrieve the Capability Statement from the server's `/metadata` endpoint.

#### 3.3. Test Data Requirements

* **Implementation Guide Profile List:** A complete and accurate list of all profile URLs defined within the Implementation Guide being tested.

#### 3.4. Validation Criteria

* **Pass:** The test passes if all profiles defined in the Implementation Guide are listed within the `supportedProfile` arrays of the relevant resources in the server's Capability Statement.
* **Fail:** The test fails if any profile defined in the Implementation Guide is missing from the server's Capability Statement.

#### 3.5. Additional Notes

* This test assumes that the Capability Statement accurately reflects the server's supported profiles.
* While the discovery phase can be automated, the validation phase requires manual comparison against the Implementation Guide, which can be time-consuming for large implementations.
* Consider using automated tools or scripts to assist with parsing the Capability Statement and comparing profile lists for improved efficiency. 


---

<a id='req-13'></a>

### REQ-13: Unauthorized request response

**Description**: "Return the following response classes: (Status 401/4xx): unauthorized request."

**Actor**: Server

**Conformance**: SHALL

## Test Specification for REQ-13: Unauthorized Request Response

**1. Requirement ID:** REQ-13

**2. Requirement Analysis:**

   - **Testability Assessment:** Automatic
   - **Complexity:** Simple
   - **Prerequisites:** 
      - A running FHIR server that implements the relevant resources and operations.
      - A test client capable of making authenticated and unauthenticated FHIR API requests.

**3. Test Implementation Strategy:**

   **3.1 Test Case 1: Unauthorized Read Request**

      - **Description:** Verify that an unauthorized (missing or invalid authentication token) read request returns a 401 Unauthorized response.
      - **Required Inputs:**
         - **FHIR Operation:** `read`
         - **Resource Type:** Any resource type supported by the server (as per Capability Statement)
         - **Resource ID:** A valid ID for the chosen resource type
         - **Authentication:** None or invalid token
      - **Expected Outputs:**
         - **HTTP Status Code:** 401 Unauthorized
         - **FHIR OperationOutcome:** (Optional) May include details about the authorization failure.
      - **Validation Criteria:**
         - Assert that the HTTP status code is 401 Unauthorized.
         - (Optional) Assert that the response body contains a valid FHIR OperationOutcome resource with relevant error details.

   **3.2 Test Case 2: Unauthorized Create Request**

      - **Description:** Verify that an unauthorized (missing or invalid authentication token) create request returns a 401 Unauthorized response.
      - **Required Inputs:**
         - **FHIR Operation:** `create`
         - **Resource Type:** Any resource type supported by the server (as per Capability Statement)
         - **Resource Data:** A valid FHIR resource of the chosen type
         - **Authentication:** None or invalid token
      - **Expected Outputs:**
         - **HTTP Status Code:** 401 Unauthorized
         - **FHIR OperationOutcome:** (Optional) May include details about the authorization failure.
      - **Validation Criteria:**
         - Assert that the HTTP status code is 401 Unauthorized.
         - (Optional) Assert that the response body contains a valid FHIR OperationOutcome resource with relevant error details.

   **3.3 Test Case 3: Unauthorized Update Request**

      - **Description:** Verify that an unauthorized (missing or invalid authentication token) update request returns a 401 Unauthorized response.
      - **Required Inputs:**
         - **FHIR Operation:** `update`
         - **Resource Type:** Any resource type supported by the server (as per Capability Statement)
         - **Resource ID:** A valid ID for the chosen resource type
         - **Resource Data:** Updated FHIR resource data
         - **Authentication:** None or invalid token
      - **Expected Outputs:**
         - **HTTP Status Code:** 401 Unauthorized
         - **FHIR OperationOutcome:** (Optional) May include details about the authorization failure.
      - **Validation Criteria:**
         - Assert that the HTTP status code is 401 Unauthorized.
         - (Optional) Assert that the response body contains a valid FHIR OperationOutcome resource with relevant error details.

   **3.4 Test Case 4: Unauthorized Delete Request**

      - **Description:** Verify that an unauthorized (missing or invalid authentication token) delete request returns a 401 Unauthorized response.
      - **Required Inputs:**
         - **FHIR Operation:** `delete`
         - **Resource Type:** Any resource type supported by the server (as per Capability Statement)
         - **Resource ID:** A valid ID for the chosen resource type
         - **Authentication:** None or invalid token
      - **Expected Outputs:**
         - **HTTP Status Code:** 401 Unauthorized
         - **FHIR OperationOutcome:** (Optional) May include details about the authorization failure.
      - **Validation Criteria:**
         - Assert that the HTTP status code is 401 Unauthorized.
         - (Optional) Assert that the response body contains a valid FHIR OperationOutcome resource with relevant error details.

**Note:** 

- These test cases can be automated using testing frameworks like Jest, Mocha, or RestAssured.
- The specific resource types and operations tested should be based on the server's Capability Statement.
- The test data used should be valid and conform to the FHIR profiles defined in the Implementation Guide. 
- Consider adding negative test cases with various invalid authentication scenarios (e.g., expired token, incorrect token format). 


---

<a id='req-14'></a>

### REQ-14: Insufficient scope response

**Description**: "Return the following response classes: (Status 403): insufficient scope."

**Actor**: Server

**Conformance**: SHALL

## Test Specification for REQ-14: Insufficient Scope Response

### 1. Requirement ID

REQ-14

### 2. Requirement Analysis

* **Testability Assessment:** Automatic
* **Complexity:** Simple
* **Prerequisites:** 
    * A running FHIR server that implements the Implementation Guide.
    * A valid access token with insufficient scope for the requested operation.

### 3. Test Implementation Strategy

#### 3.1 Test Case 1: Insufficient Scope on Resource Access

**Objective:** Verify that the server returns a 403 Forbidden response with "insufficient scope" message when an access token with insufficient scope is used for a restricted resource operation.

**Inputs:**

* **Valid FHIR Resource:** Any resource type where the Capability Statement indicates restricted access based on OAuth2 scopes.
* **HTTP Headers:**
    * **Authorization:** Bearer {access_token_with_insufficient_scope}
    * **Accept:** application/fhir+json

**Expected Outputs:**

* **HTTP Status Code:** 403 Forbidden
* **Response Body:** 
    * **ResourceType:** OperationOutcome
    * **Issue.severity:** error
    * **Issue.code:** security
    * **Issue.details.text:** insufficient scope

**FHIR Operations:**

* Any operation (e.g., READ, CREATE, UPDATE) on the chosen FHIR resource.

**Test Data Requirements:**

* An access token with insufficient scope for the chosen FHIR resource operation. This can be obtained by requesting a token from the authorization server with a scope that does not grant access to the desired operation.

**Validation Criteria:**

* **Assert:** The HTTP status code is 403 Forbidden.
* **Assert:** The response body is a valid OperationOutcome resource.
* **Assert:** The OperationOutcome resource contains an issue with severity "error", code "security", and details text "insufficient scope".

#### 3.2 Test Case 2: Insufficient Scope on Specific Operation

**Objective:** Verify that the server returns a 403 Forbidden response with "insufficient scope" message when an access token with insufficient scope is used for a specific restricted operation (e.g., search).

**Inputs:**

* **Valid FHIR Resource:** Any resource type where the Capability Statement indicates restricted search operation based on OAuth2 scopes.
* **HTTP Headers:**
    * **Authorization:** Bearer {access_token_with_insufficient_scope_for_search}
    * **Accept:** application/fhir+json

**Expected Outputs:**

* **HTTP Status Code:** 403 Forbidden
* **Response Body:** 
    * **ResourceType:** OperationOutcome
    * **Issue.severity:** error
    * **Issue.code:** security
    * **Issue.details.text:** insufficient scope

**FHIR Operations:**

* Search operation on the chosen FHIR resource.

**Test Data Requirements:**

* An access token with insufficient scope for the search operation on the chosen FHIR resource. This can be obtained by requesting a token from the authorization server with a scope that does not grant access to the search operation.

**Validation Criteria:**

* **Assert:** The HTTP status code is 403 Forbidden.
* **Assert:** The response body is a valid OperationOutcome resource.
* **Assert:** The OperationOutcome resource contains an issue with severity "error", code "security", and details text "insufficient scope".

**Note:** These test cases can be adapted for different resource types and operations based on the specific requirements outlined in the Capability Statement. 


---

<a id='req-15'></a>

### REQ-15: Invalid parameter response

**Description**: "Return the following response classes: (Status 400): invalid parameter."

**Actor**: Server

**Conformance**: SHALL

## Test Specification for REQ-15: Invalid Parameter Response

**1. Requirement ID:** REQ-15

**2. Requirement Analysis:**

   - **Testability Assessment:** Automatic
   - **Complexity:** Simple
   - **Prerequisites:** 
      - A running FHIR server that implements the relevant resources and operations.
      - The Capability Statement of the server should indicate support for the specific FHIR resource and operation being tested.

**3. Test Implementation Strategy:**

   **3.1. Test Case 1: Invalid Parameter Value**

      - **Description:** Send a request with an invalid value for a required parameter.
      - **Required Inputs:**
         - **FHIR Operation:**  (Replace with the specific operation from the Capability Statement, e.g., `GET /Patient/{id}`)
         - **Parameter:** (Replace with the specific parameter name from the operation definition)
         - **Invalid Value:**  (Provide an example of an invalid value for the chosen parameter)
      - **Expected Outputs:**
         - **HTTP Status Code:** 400 Bad Request
         - **FHIR OperationOutcome Resource:**
            - `issue.severity`:  "error"
            - `issue.code`: "invalid"
            - `issue.diagnostics`:  A human-readable explanation of the error, indicating the invalid parameter and reason for invalidity. 
      - **Validation Criteria:**
         - Verify the HTTP status code is 400.
         - Verify the response body contains a valid FHIR OperationOutcome resource.
         - Verify the OperationOutcome resource contains an issue with the expected severity, code, and a descriptive diagnostic message.

   **3.2. Test Case 2: Missing Required Parameter**

      - **Description:** Send a request missing a parameter marked as required in the operation definition.
      - **Required Inputs:**
         - **FHIR Operation:** (Replace with the specific operation from the Capability Statement)
         - **Parameter:** (Replace with the specific required parameter name from the operation definition)
      - **Expected Outputs:**
         - **HTTP Status Code:** 400 Bad Request
         - **FHIR OperationOutcome Resource:**
            - `issue.severity`:  "error"
            - `issue.code`: "required" 
            - `issue.diagnostics`: A human-readable explanation of the error, indicating the missing required parameter. 
      - **Validation Criteria:**
         - Verify the HTTP status code is 400.
         - Verify the response body contains a valid FHIR OperationOutcome resource.
         - Verify the OperationOutcome resource contains an issue with the expected severity, code, and a descriptive diagnostic message.

**Notes:**

- These test cases provide a starting point. You may need to add more test cases depending on the specific parameters and their validation rules defined in the FHIR Implementation Guide and the associated resource/operation definitions.
- The exact content of the `issue.diagnostics` message might vary depending on the server implementation, but it should be informative and helpful for debugging.
-  Ensure that the chosen FHIR operation and parameters are supported by the server, as indicated in the provided Capability Statement. 


---

<a id='req-16'></a>

### REQ-16: Unknown resource response

**Description**: "Return the following response classes: (Status 404): unknown resource."

**Actor**: Server

**Conformance**: SHALL

## Test Specification

### 1. Requirement ID

REQ-16: Unknown resource response

### 2. Requirement Analysis

* **Testability Assessment:** Automatic
* **Complexity:** Simple
* **Prerequisites:**
    * A running FHIR server that implements the target FHIR Implementation Guide.
    * The FHIR server's base URL.

### 3. Test Implementation Strategy

#### 3.1 Test Case 1: Request Unknown Resource

**Objective:** Verify that the server returns a 404 Not Found status code when an unknown resource is requested.

**Inputs:**

* **FHIR Server Base URL:**  The base URL of the FHIR server under test.
* **Unknown Resource Type:** A string representing a resource type not defined in the FHIR specification or the implemented IG. For example, "FakeResource".

**Expected Outputs:**

* **HTTP Status Code:** 404 Not Found
* **Response Body:**  The response body SHOULD contain an OperationOutcome resource with details about the error. This is not explicitly required by the requirement, but is good practice according to the FHIR specification.

**FHIR Operations:**

* HTTP GET request to `{FHIR Server Base URL}/{Unknown Resource Type}`

**Test Data Requirements:**

* No specific test data is required for this test case.

**Validation Criteria:**

1. **Status Code Assertion:** Assert that the HTTP status code of the response is 404 Not Found.
2. **Response Body Assertion (Optional):** Assert that the response body is an OperationOutcome resource with an appropriate error code and description indicating an unknown resource.


#### Example using Python and the `requests` library:

```python
import requests

def test_unknown_resource_response(fhir_server_base_url):
  """Tests that the server returns a 404 Not Found status code for an unknown resource."""

  unknown_resource_type = "FakeResource"
  url = f"{fhir_server_base_url}/{unknown_resource_type}"
  response = requests.get(url)

  assert response.status_code == 404, f"Expected 404 Not Found, but got {response.status_code}"

  # Optional: Check for OperationOutcome in the response body
  # try:
  #   operation_outcome = response.json()
  #   assert operation_outcome['resourceType'] == 'OperationOutcome'
  # except json.JSONDecodeError:
  #   # Handle cases where the response body is not valid JSON
  #   pass
```

**Note:** This test specification focuses on the core requirement of the 404 status code.  Additional assertions and test cases can be added to validate the content and structure of the OperationOutcome resource returned in the response body, if desired and if the IG provides more specific guidance on the error response. 


---

<a id='req-17'></a>

### REQ-17: Deleted resource response

**Description**: "Return the following response classes: (Status 410): deleted resource."

**Actor**: Server

**Conformance**: SHALL

## Test Specification for REQ-17: Deleted Resource Response

### 1. Requirement ID

REQ-17

### 2. Requirement Analysis

- **Testability Assessment:** Automatic
- **Complexity:** Simple
- **Prerequisites:**
    - A FHIR server instance capable of handling resource deletion.
    - At least one resource of a supported type must be created and then deleted before running the test.

### 3. Test Implementation Strategy

#### 3.1 Required Inputs and Expected Outputs

| Input                                       | Expected Output                                                                                                     |
| ------------------------------------------- | ------------------------------------------------------------------------------------------------------------------ |
| GET request to the URL of a deleted resource | HTTP Status Code: 410 (Gone)                                                                                      |
|                                             | Response Body: OperationOutcome resource with appropriate diagnostics indicating the resource has been deleted. |

#### 3.2 Required FHIR Operations

- **READ (HTTP GET)**:  To retrieve the resource that has been marked as deleted. 

**Note:** The Capability Statement should indicate support for the `delete` interaction for the relevant resource type. This ensures the server can properly manage deleted resources.

#### 3.3 Test Data Requirements

- **Resource Type:** Any resource type supported by the server and for which the Capability Statement indicates support for the `delete` interaction.
- **Resource ID:** The ID of a resource that has been previously created and then deleted.

#### 3.4 Validation Criteria

1. **HTTP Status Code:** Verify the response returns an HTTP status code of `410 (Gone)`.
2. **Response Body:** Verify the response body contains an `OperationOutcome` resource.
3. **OperationOutcome Content:** Verify the `OperationOutcome` resource includes a diagnostic message indicating the resource has been deleted. This could be a specific code or a human-readable message.

**Example Test Case (using JSON Placeholder for demonstration):**

1. **Create a resource:**
   - `POST https://jsonplaceholder.typicode.com/posts`
   - Body: `{ "title": "foo", "body": "bar", "userId": 1 }`
2. **Record the ID of the created resource (e.g., `101`)**
3. **Delete the resource:**
   - `DELETE https://jsonplaceholder.typicode.com/posts/101`
4. **Attempt to retrieve the deleted resource:**
   - `GET https://jsonplaceholder.typicode.com/posts/101`
5. **Validate:**
   - **Status Code:** 410 (Gone)
   - **Response Body:** (Empty, as this is a mock server, but a real FHIR server should return an OperationOutcome) 

**Note:** This test specification can be automated using testing frameworks like Jest, Mocha, or pytest along with FHIR client libraries. 


---

<a id='req-18'></a>

### REQ-18: Profile identification in meta attribute

**Description**: "Identify the Plan-Net profiles supported as part of the FHIR meta.profile attribute for each instance."

**Actor**: Server

**Conformance**: SHALL

## Test Specification for REQ-18: Profile Identification in Meta Attribute

**1. Requirement ID:** REQ-18

**2. Requirement Analysis:**

   - **Testability Assessment:** Automatic
   - **Complexity:** Simple
   - **Prerequisites:**
     - A running FHIR server that implements the target Implementation Guide.
     - Access to the server's Capability Statement.
     - Ability to make FHIR read operations against the server. 

**3. Test Implementation Strategy:**

   **3.1. Required Inputs:**
     - None (The test will target resources based on the Capability Statement)

   **3.2. Expected Outputs:**
     - HTTP Status Code 200 (OK) for successful resource retrieval.
     - FHIR Resource instance in JSON or XML format.

   **3.3. Required FHIR Operations:**
     - `read` operation on resources advertised as supporting the Plan-Net profiles.

   **3.4. Test Data Requirements:**
     - No specific test data is required. The test will use existing resources on the server.

   **3.5. Validation Criteria:**

     1. **Identify Target Resources:**
        - Parse the Capability Statement and identify all resources that list Plan-Net profiles in their `supportedProfile` element.
     2. **Retrieve Resources:**
        - For each identified resource type, perform a `read` operation to retrieve an instance.
     3. **Validate `meta.profile`:**
        - Assert that the `meta.profile` element in each retrieved resource instance:
           - **Exists:** Verify the `meta.profile` element is present.
           - **Contains Plan-Net Profile:** Verify that at least one entry within the `meta.profile` array matches the Plan-Net profile URL declared in the Capability Statement for that resource type.

   **3.6. Test Steps:**

     1. Retrieve the server's Capability Statement.
     2. Parse the Capability Statement to identify resources supporting Plan-Net profiles.
     3. For each identified resource type:
        - Retrieve an instance of the resource using the `read` operation.
        - Validate that the `meta.profile` element exists and contains the expected Plan-Net profile URL.
     4. If all validations pass, the test passes. Otherwise, the test fails.

**4. Additional Notes:**

- This test specification focuses on the automatic validation of the requirement. Manual inspection of the retrieved resources might be beneficial to ensure the profile content is correctly implemented beyond the URL presence.
- The specific Plan-Net profile URLs should be extracted from the Implementation Guide and used in the validation steps. 


---

<a id='req-19'></a>

### REQ-19: Individual search parameter support

**Description**: "Support the searchParameters on each profile individually."

**Actor**: Server

**Conformance**: SHALL

## Test Specification for REQ-19: Individual Search Parameter Support

**1. Requirement ID:** REQ-19

**2. Requirement Analysis:**

   - **Testability Assessment:** Automatic
   - **Complexity:** Moderate
   - **Prerequisites:** 
      - A running FHIR server that implements the target Implementation Guide.
      - Access to the server's Capability Statement.
      - Test data for resources conforming to the profiles defined in the Implementation Guide.

**3. Test Implementation Strategy:**

   **3.1. Required Inputs:**

     - FHIR Server base URL
     - List of resources with their respective profiles defined in the Implementation Guide.

   **3.2. Expected Outputs:**

     - HTTP Status Code 200 (OK) for successful searches.
     - A Bundle resource containing the search results.
     - The Bundle should only contain resources matching the specified search criteria and the resource profile.

   **3.3. Required FHIR Operations:**

     - **Read CapabilityStatement:** Retrieve the server's Capability Statement to identify supported search parameters for each resource and profile.
     - **Search Type:** Execute search operations on each resource type using the supported search parameters defined for each profile.

   **3.4. Test Data Requirements:**

     - A set of test data representing resources conforming to the profiles defined in the Implementation Guide.
     - This data should include variations in values for the search parameters defined for each profile.

   **3.5. Validation Criteria:**

     **3.5.1. Capability Statement Validation:**

       - Verify that the Capability Statement advertises support for the search operation on each resource type.
       - Confirm that the Capability Statement lists the expected search parameters for each resource profile.

     **3.5.2. Search Operation Validation:**

       - **Positive Testing:**
         - For each resource profile and its defined search parameters, construct search requests with valid search criteria.
         - Verify that the server returns HTTP Status Code 200 (OK).
         - Validate that the returned Bundle contains only resources matching the search criteria and belonging to the specified profile.
       - **Negative Testing:**
         - Construct search requests with invalid search criteria (e.g., incorrect data type, out-of-range values).
         - Verify that the server returns the appropriate error code (e.g., 400 Bad Request) and an OperationOutcome resource with details about the error.
       - **Parameter Combination Testing:**
         - Construct search requests using combinations of supported search parameters for each profile.
         - Verify that the server correctly handles parameter combinations and returns the expected results.

**4. Test Automation Considerations:**

   - This test can be fully automated using testing frameworks like Jest, Mocha, or pytest in conjunction with FHIR client libraries.
   - The test script can programmatically:
     - Retrieve the Capability Statement.
     - Parse the Capability Statement to extract supported resources, profiles, and search parameters.
     - Generate test data for each profile.
     - Execute search requests with various combinations of search parameters.
     - Validate the server responses against the defined criteria. 


---

<a id='req-20'></a>

### REQ-20: Combination search parameter support

**Description**: "Support the searchParameters on each profile in combination."

**Actor**: Server

**Conformance**: SHALL

## Test Specification for REQ-20: Combination Search Parameter Support

### 1. Requirement ID

REQ-20

### 2. Requirement Analysis

* **Testability Assessment:** Automatic 
* **Complexity:** Moderate
* **Prerequisites:**
    * A running FHIR server that conforms to the implementation guide.
    * The server must have data populated for the resources and search parameters being tested.
    * Knowledge of supported search parameters for each profile as defined in the Implementation Guide. 

### 3. Test Implementation Strategy

#### 3.1. Required Inputs and Expected Outputs

| Input                                           | Expected Output                                                                                                                                                                                          |
|-------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| A valid FHIR search request combining at least two search parameters for a specific resource profile. | **HTTP Status Code 200 (OK)** <br> A Bundle resource containing the resources matching **all** specified search criteria. <br> **Note:** An empty Bundle is acceptable if no matching resources exist, as long as the search is valid. |

#### 3.2. Required FHIR Operations

* **GET** request to the appropriate resource endpoint with search parameters appended to the URL.

#### 3.3. Test Data Requirements

* **Resource instances:**  The test data should include instances of resources conforming to the profiles defined in the Implementation Guide. These instances should be populated with diverse data to allow for testing various combinations of search parameters.
* **Search Parameter Combinations:** Define a set of test cases that cover a variety of combinations of search parameters for each resource profile.  This should include:
    * Combinations of two or more search parameters.
    * Combinations of search parameters with different data types (e.g., string, date, token).
    * Combinations of search parameters with different modifiers (e.g., `:exact`, `:contains`, `:above`).

#### 3.4. Validation Criteria

1. **HTTP Status Code:** Verify that the server returns an HTTP status code of 200 (OK) for valid search requests.
2. **Returned Resources:** Verify that the returned Bundle resource:
    * Contains only resources that match **all** the specified search criteria.
    * Conforms to the FHIR specification and any applicable profiles defined in the Implementation Guide.
3. **Resource Content:** For each returned resource, validate that the values in the relevant fields match the search criteria used in the request.

**Example Test Case:**

Let's assume the Implementation Guide defines a "Patient" profile and requires support for combining the "family" and "birthdate" search parameters.

**Test Case:** Search for patients with the family name "Smith" and born in the year 1980.

**Request:**

```
GET [base]/Patient?family=Smith&birthdate=1980
```

**Validation:**

1. **HTTP Status Code:** 200 (OK)
2. **Returned Resources:** 
    * Only resources representing patients with the family name "Smith" and born in 1980 are included.
    * All returned resources conform to the "Patient" profile.
3. **Resource Content:** For each returned resource, verify:
    * The `family` element contains the value "Smith".
    * The `birthdate` element contains a year value of 1980. 


---

<a id='req-21'></a>

### REQ-21: Forward chaining support

**Description**: "Support forward chaining on all search parameters that specify the 'chain' property."

**Actor**: Server

**Conformance**: SHALL

## Test Specification for REQ-21: Forward Chaining Support

### 1. Requirement ID

REQ-21

### 2. Requirement Analysis

* **Testability Assessment:** Automatic
* **Complexity:** Moderate
* **Prerequisites:**
    * A running FHIR server that conforms to the implementation guide.
    * The server's Capability Statement should advertise support for the search parameters with the `chain` property specified.
    * Test data consisting of resources with chained search parameters. For example, if the `Patient.general-practitioner` search parameter supports chaining, then test data should include `Patient` resources with linked `Practitioner` resources.

### 3. Test Implementation Strategy

#### 3.1 Required Inputs and Expected Outputs

| Input                                      | Expected Output                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     

---

<a id='req-22'></a>

### REQ-22: Reverse chaining support

**Description**: "Support reverse chaining on all search parameters that specify the 'chain' property."

**Actor**: Server

**Conformance**: SHALL

## Test Specification for REQ-22: Reverse Chaining Support

**1. Requirement ID:** REQ-22

**2. Requirement Analysis:**

   - **Testability Assessment:** Automatic
   - **Complexity:** Moderate
   - **Prerequisites:** 
     - A FHIR server instance under test.
     - Access to the server's Capability Statement.
     - At least one resource type with a search parameter that defines the `chain` property in the Capability Statement.
     - Test data populated on the server, including resources that link together through properties specified in `chain`.

**3. Test Implementation Strategy:**

   **3.1. Required Inputs:**

   - **Capability Statement:** Retrieved from the FHIR server under test.
   - **Search Parameter List:** Extracted from the Capability Statement, focusing on parameters with the `chain` property defined.
   - **Test Data:**  A set of resources on the server that are linked through properties specified in the `chain` attribute of relevant search parameters.

   **3.2. Expected Outputs:**

   - **Successful Reverse Chaining:** The server should return the correct resources when a search is performed using a search parameter with the `chain` property, traversing the resource graph in reverse as defined by the `chain`.

   **3.3. Required FHIR Operations:**

   - **GET [base]/metadata:** To retrieve the server's Capability Statement.
   - **GET [base]/[resourceType]?parameter=[value]**: To perform searches using the identified search parameters with `chain` property.

   **3.4. Test Data Requirements:**

   - **Resource Types:** At least one resource type with a search parameter that defines the `chain` property.
   - **Linked Resources:**  Multiple resources of the identified type(s) should be present on the server, linked together through properties specified in the `chain` attribute of the search parameter. 
     - Example: If `Patient.general-practitioner` has a `chain` to `Organization.name`, then test data should include Patients linked to Organizations, and the search should be performed on `Organization.name` to find the related Patients.

   **3.5. Validation Criteria:**

   1. **Capability Statement Validation:**
      - Verify that the Capability Statement correctly advertises the search parameters with the `chain` property for the relevant resource types.
   2. **Reverse Chaining Search:**
      - For each identified search parameter with `chain`:
        - Construct a search URL using the `parameter=[value]` syntax, targeting the resource type where the `chain` originates (e.g., `Organization` in the example above).
        - Execute the search request.
        - **Assert:** The response bundle SHOULD contain all resources that are linked through the reverse chain as defined by the `chain` property in the Capability Statement.
        - **Assert:** The response bundle SHOULD NOT contain resources that are not part of the reverse chain, even if they match the search criteria on the initial resource type.

**Example:**

Let's say the `Patient` resource has a search parameter `general-practitioner` with `chain` defined as `Organization.name`.

1. **Test Data:** Create a Patient (P1) linked to an Organization (O1) with a specific name.
2. **Search:** Perform a search on `Organization?name=[O1's name]`.
3. **Validation:** The response should include Patient P1, demonstrating successful reverse chaining. 


---

<a id='req-23'></a>

### REQ-23: XML format support

**Description**: "Support xml source formats for all Plan-Net interactions."

**Actor**: Server

**Conformance**: SHOULD

## Test Specification for REQ-23: XML Format Support

**1. Requirement ID:** REQ-23

**2. Requirement Analysis:**

   - **Testability Assessment:** Automatic
   - **Complexity:** Simple
   - **Prerequisites:** 
      - A running FHIR server that implements the Plan-Net interactions.
      - Test client capable of sending requests with XML payloads and verifying XML responses.

**3. Test Implementation Strategy:**

   **3.1. Test Case 1: Create PlanDefinition (XML)**

      - **Description:** Verify the server can successfully process a Create interaction for the PlanDefinition resource with an XML payload.
      - **Required Inputs:**
         - Valid FHIR PlanDefinition resource in XML format.
      - **Expected Outputs:**
         - HTTP Status Code: 201 Created
         - Location header containing the URL of the newly created resource.
         - Optional: Returned resource in XML format in the response body.
      - **Required FHIR Operations:** 
         - `POST [base]/PlanDefinition`
      - **Test Data Requirements:** 
         - A sample PlanDefinition resource conforming to the Plan-Net profile (if applicable).
      - **Validation Criteria:**
         - Verify the HTTP status code.
         - Verify the Location header.
         - Optionally, validate the returned XML resource against the FHIR schema and Plan-Net profile.

   **3.2. Test Case 2: Read PlanDefinition (XML)**

      - **Description:** Verify the server can return a PlanDefinition resource in XML format when requested.
      - **Required Inputs:**
         - The ID of an existing PlanDefinition resource.
      - **Expected Outputs:**
         - HTTP Status Code: 200 OK
         - PlanDefinition resource in XML format in the response body.
      - **Required FHIR Operations:** 
         - `GET [base]/PlanDefinition/{id}`
      - **Test Data Requirements:** 
         - An existing PlanDefinition resource on the server.
      - **Validation Criteria:**
         - Verify the HTTP status code.
         - Validate the returned XML resource against the FHIR schema and Plan-Net profile.

   **3.3. Test Case Template for Other Plan-Net Interactions:**

      - Repeat Test Cases 1 and 2 for all other relevant Plan-Net interactions (e.g., Update, Search, etc.) using appropriate resources and operations. 
      - Ensure the test data and validation criteria are adapted for each specific interaction and resource type.

**Note:**

- This test specification assumes the Capability Statement confirms support for the required Plan-Net interactions and the XML format.
- The specific Plan-Net interactions and resources to be tested should be determined based on the scope of the implementation guide.
- Consider adding negative test cases to verify the server gracefully handles invalid XML payloads and returns appropriate error responses. 


---

<a id='req-24'></a>

### REQ-24: Rejection of unauthorized requests

**Description**: "A server SHALL reject any unauthorized requests by returning an HTTP 401 unauthorized response code."

**Actor**: Server

**Conformance**: SHALL

## Test Specification for REQ-24: Rejection of Unauthorized Requests

**1. Requirement ID:** REQ-24

**2. Requirement Analysis:**

   - **Testability Assessment:** Automatic
   - **Complexity:** Simple
   - **Prerequisites:**
     - A running FHIR server that implements the relevant resources and operations.
     - A test client capable of making authenticated and unauthenticated requests.
     - Knowledge of valid and invalid authorization credentials for the server.

**3. Test Implementation Strategy:**

   **3.1. Test Case 1: Unauthorized Request**

     - **Description:** Verify that the server returns an HTTP 401 Unauthorized response code when an unauthorized request is made.
     - **Required Inputs:**
       - An invalid or missing authorization token.
       - A valid FHIR resource request (e.g., GET request to a resource endpoint).
     - **Expected Outputs:**
       - HTTP Response Code: 401 Unauthorized
       - Optional: Response body may contain an error message or details about the authentication failure.
     - **Required FHIR Operations:** Any supported read, write, or search operation.
     - **Test Data Requirements:**
       - No specific test data is required for this test case.
     - **Validation Criteria:**
       - Assert that the HTTP response code is **401 Unauthorized**.

   **3.2. Test Case 2: Authorized Request**

     - **Description:** Verify that the server processes the request successfully when a valid authorization token is provided.
     - **Required Inputs:**
       - A valid authorization token.
       - A valid FHIR resource request (e.g., GET request to a resource endpoint).
     - **Expected Outputs:**
       - HTTP Response Code: 200 OK (or other successful response code depending on the operation).
       - Response body containing the requested resource or operation result.
     - **Required FHIR Operations:** Any supported read, write, or search operation.
     - **Test Data Requirements:**
       - Valid test data may be required depending on the chosen FHIR operation.
     - **Validation Criteria:**
       - Assert that the HTTP response code indicates success (e.g., **200 OK**).
       - Optionally, validate the response body content against expected results.

**Note:**

* These test cases can be automated using testing frameworks like Jest, Mocha, or pytest along with HTTP client libraries.
* The specific FHIR operations used in the test cases should be chosen based on the capabilities declared in the server's CapabilityStatement.
*  Consider adding negative test cases with various invalid authorization scenarios (e.g., expired token, insufficient scopes) to ensure comprehensive coverage. 


---

<a id='req-25'></a>

### REQ-25: Support for read interaction

**Description**: "For each resource type and profile, a Plan Net server SHALL support the read interaction."

**Actor**: Server

**Conformance**: SHALL

## Test Specification for REQ-25: Support for Read Interaction

### 1. Requirement ID

REQ-25

### 2. Requirement Analysis

* **Testability Assessment:** Automatic
* **Complexity:** Simple
* **Prerequisites:**
    * A running FHIR server compliant with the Plan Net implementation guide.
    * At least one resource instance of each supported resource type and profile exists on the server.

### 3. Test Implementation Strategy

#### 3.1 Required Inputs and Expected Outputs

| Input                                      | Expected Output                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  

---

<a id='req-26'></a>

### REQ-26: Support for vread interaction

**Description**: "For each resource type and profile, a Plan Net server SHOULD support the vread interaction."

**Actor**: Server

**Conformance**: SHOULD

## Test Specification for REQ-26: Support for vread Interaction

### 1. Requirement ID

REQ-26

### 2. Requirement Analysis

**Testability Assessment:** Automatic
**Complexity:** Simple
**Prerequisites:**
* A running FHIR server under test that claims conformance to the Plan Net Implementation Guide.
* At least one resource instance of a type and profile supported by the server exists.
* The server's Capability Statement is available.

### 3. Test Implementation Strategy

**3.1 Required Inputs**

* **FHIR Server Base URL:** The base URL of the FHIR server under test.
* **Resource Type:** The type of resource to be retrieved (e.g., "Patient", "Observation").
* **Resource ID:** The logical ID of the resource to be retrieved.
* **Version ID:** The version ID of the resource to be retrieved.

**3.2 Expected Outputs**

* **HTTP Status Code:** 200 OK
* **Response Body:** A FHIR resource of the specified type and profile, representing the version identified by the Version ID.

**3.3 Required FHIR Operations**

* **vread:**  
    * **URL Structure:** `[Base]/[resourceType]/[id]/_history/[versionId]`
    * **HTTP Method:** GET

**3.4 Test Data Requirements**

* The test will utilize existing resources on the server. No specific test data creation is required. However, the test data selection should consider different resource types and profiles supported by the server as identified in the Capability Statement.

**3.5 Validation Criteria**

1. **Verify the HTTP status code is 200 (OK).**
2. **Verify the 'Content-Type' header of the response is 'application/fhir+json'.**
3. **Verify the response body is a valid FHIR resource.**
4. **Verify the resource type and profile in the response match the requested resource type and profile.**
5. **Verify the resource in the response represents the version identified by the provided Version ID.** This can be confirmed by checking the `meta.versionId` element of the returned resource.

**Test Steps:**

1. Retrieve the server's Capability Statement.
2. Identify a supported resource type and profile from the Capability Statement.
3. Identify an existing resource of the chosen type and profile on the server.
4. Retrieve the resource history using the `history` interaction.
5. Select a specific version from the history and note its version ID.
6. Perform a `vread` operation using the resource type, resource ID, and the selected version ID.
7. Validate the response against the criteria outlined in section 3.5. 

**Note:** This test should be repeated for a representative sample of resource types and profiles supported by the server to ensure comprehensive coverage. 


---

<a id='req-27'></a>

### REQ-27: Support for _includes

**Description**: "[For each resource] A Server SHALL be capable of supporting the following _includes [list]."

**Actor**: Server

**Conformance**: SHALL

## Test Specification for REQ-27: Support for _includes

### 1. Requirement ID

REQ-27

### 2. Requirement Analysis

**Testability Assessment:** Automatic 
**Complexity:** Simple
**Prerequisites:**
* A running FHIR server that implements the target Implementation Guide.
* Knowledge of the specific _includes supported by the server as declared in its Capability Statement.

### 3. Test Implementation Strategy

This test specification focuses on verifying that the server correctly handles _include requests for each resource type listed in the requirement.

**3.1 Required Inputs**

* **Resource Type:** The specific resource type to test (e.g., Patient, Observation).
* **_include Parameter:** The specific _include parameter to test for the given resource type (e.g., "Patient:general-practitioner"). This should be obtained from the list provided in REQ-27's description.

**3.2 Expected Outputs**

* **HTTP Status Code:** 200 (OK)
* **FHIR Bundle:** A FHIR Bundle resource containing:
    * The primary resource of the requested type.
    * Any included resources specified by the _include parameter, linked appropriately to the primary resource.

**3.3 Required FHIR Operations**

* **READ:** To retrieve the resource with the specified _include parameter. For example:
    ```
    GET [base]/[resourceType]/[id]?_include=[includeParameter]
    ```

**3.4 Test Data Requirements**

* **Test Resource:**  At least one instance of each resource type to be tested should be available on the server. This resource should have the necessary relationships for the _includes being tested.

**3.5 Validation Criteria**

1. **HTTP Status Code:** Verify that the server returns an HTTP status code of 200 (OK).
2. **Bundle Type:** Verify that the response is a FHIR Bundle with type 'searchset'.
3. **Primary Resource:** Verify that the Bundle contains the requested primary resource.
4. **Included Resources:** 
    * Verify that the Bundle contains the resources specified by the _include parameter.
    * Verify that the included resources are correctly linked to the primary resource through references.
    * Verify that the included resources are of the correct type as specified in the _include parameter.

**Example Test Case:**

**Resource Type:** Patient
**_include Parameter:** Patient:general-practitioner

**Test Steps:**

1. Send a READ request to the server for a Patient resource, including the "_include=Patient:general-practitioner" parameter.
2. Verify that the server returns an HTTP status code of 200 (OK).
3. Verify that the response is a FHIR Bundle with type 'searchset'.
4. Verify that the Bundle contains the requested Patient resource.
5. Verify that the Bundle contains the Patient's general practitioner resource (which should be a Practitioner resource).
6. Verify that the Practitioner resource is correctly linked to the Patient resource through a reference.

This test specification provides a framework for testing the server's support for _includes. By iterating through the resource types and their corresponding _include parameters listed in REQ-27, you can comprehensively test this requirement. 


---

<a id='req-28'></a>

### REQ-28: Support for _revincludes

**Description**: "[For each resource] A Server SHALL be capable of supporting the following _revincludes: [list]."

**Actor**: Server

**Conformance**: SHALL

## Test Specification for REQ-28: Support for _revincludes

### 1. Requirement ID

REQ-28

### 2. Requirement Analysis

* **Testability Assessment**: Automatic
* **Complexity**: Simple 
* **Prerequisites**: 
    * A running FHIR server that implements the target Implementation Guide.
    * Access to the server's Capability Statement.
    * Test data for resources that support the specified _revincludes.

### 3. Test Implementation Strategy

#### 3.1 Required Inputs and Expected Outputs

| Input | Expected Output |
|---|---|
| FHIR Server URL | HTTP Status Code 200 (OK) |
| Resource Type supporting the _revincludes | FHIR Bundle containing the requested resource and all referenced resources specified by the _revincludes parameter. |
| _revincludes parameter value (from the requirement) |  |


#### 3.2 Required FHIR Operations

* **READ Operation:**  
    * Send a GET request to the appropriate resource endpoint with the specified `_revincludes` parameter. 
    * Example: `GET [FHIR Server URL]/[ResourceType]?_revincludes=[revincludesValue]`

#### 3.3 Test Data Requirements

* **Resource Data:** At least one instance of the resource type that supports the specified _revincludes, with existing references to other resources that should be included in the response based on the _revincludes parameter.

#### 3.4 Validation Criteria

1. **HTTP Status Code:** Verify that the server returns an HTTP status code of 200 (OK), indicating a successful request.
2. **Resource Type:** Verify that the returned resource is a FHIR Bundle.
3. **_revincludes Content:** Verify that the Bundle contains:
    * The originally requested resource.
    * All referenced resources specified by the _revincludes parameter.
4. **Validate References:**  Ensure that all returned references within the resources are valid and resolvable. 

**Note:** This test specification assumes that the Capability Statement confirms the server's support for the required _revincludes. The specific _revincludes values from the requirement should be substituted into the test data and validation criteria. 


---

<a id='req-29'></a>

### REQ-29: Network profile NPI handling

**Description**: "The NPI and CLIA identifier types, which are Must-Support, are clearly intended for provider organizations only and are not expected to be populated for other organization types."

**Actor**: Server

**Conformance**: None (Clarification)

## Test Specification for REQ-29: Network profile NPI handling

**1. Requirement ID:** REQ-29

**2. Requirement Analysis:**

   - **Testability Assessment:** Hybrid (Combination of automated data retrieval and manual assertion)
   - **Complexity:** Moderate
   - **Prerequisites:** 
      - Access to the server's Capability Statement.
      - Ability to query the server for Organization resources.

**3. Test Implementation Strategy:**

   **3.1. Test Case 1: NPI/CLIA Absent for Non-Provider Organizations**

      - **Description:** Verify that Organization resources of types other than "provider" do not have NPI or CLIA identifiers populated.
      - **Required Inputs:** None
      - **Required FHIR Operations:** 
         - `GET [base]/Organization` (Search for all Organization resources)
      - **Test Data Requirements:** 
         - The server should contain Organization resources of various types, including some that are not "provider".
      - **Validation Criteria:**
         1. **Automated:** Retrieve all Organization resources from the server.
         2. **Manual:** For each Organization resource retrieved:
            - If the `Organization.type` is not "provider", assert that the `Organization.identifier` element does not contain any identifier with `system` values of:
               -  http://hl7.org/fhir/sid/us-npi (for NPI)
               -  urn:oid:2.16.840.1.113883.4.7 (for CLIA)

   **3.2. Test Case 2: NPI/CLIA Allowed for Provider Organizations**

      - **Description:** Verify that Organization resources of type "provider" can have NPI or CLIA identifiers populated.
      - **Required Inputs:** None
      - **Required FHIR Operations:** 
         - `GET [base]/Organization?type=provider` (Search for Organization resources of type "provider")
      - **Test Data Requirements:** 
         - The server should contain Organization resources of type "provider", some of which may have NPI or CLIA identifiers.
      - **Validation Criteria:**
         1. **Automated:** Retrieve all Organization resources of type "provider" from the server.
         2. **Manual:** For each Organization resource retrieved:
            -  Assert that the presence or absence of NPI/CLIA identifiers within the `Organization.identifier` element does not result in an error. This test case confirms that the server allows these identifiers for provider organizations, but does not mandate their presence. 

**Note:** 

- The Capability Statement confirms that NPI and CLIA are "Must-Support" identifier types. These test cases focus on verifying the conditional requirement based on the Organization resource's type.
- The specific URLs for NPI and CLIA systems should be confirmed against any terminology services used by the implementation. 
- These test cases can be automated further by using a FHIR client library or testing tool to programmatically perform the data retrieval and assertions. 


---

<a id='req-30'></a>

### REQ-30: lastUpdate timestamp requirement

**Description**: "Each profile in this guide requires that the lastUpdate timestamp be provided as part of the profile's data content."

**Actor**: Server

**Conformance**: None (Requirement)

## Test Specification for REQ-30: lastUpdate Timestamp Requirement

### 1. Requirement ID

REQ-30

### 2. Requirement Analysis

* **Testability Assessment:** Automatic
* **Complexity:** Simple
* **Prerequisites:** 
    * A running FHIR server that implements the profiles defined in the FHIR Implementation Guide.
    * Access to create and retrieve resources conforming to the profiles in the FHIR Implementation Guide.

### 3. Test Implementation Strategy

#### 3.1. Test Case 1: Verify `lastUpdate` Presence on Resource Creation

* **Test Objective:** Verify that the `lastUpdate` timestamp is populated when a resource conforming to a profile in the guide is created.

* **Required Inputs:** 
    * A valid FHIR resource instance conforming to one of the profiles defined in the guide, excluding the `lastUpdate` element.

* **Expected Outputs:** 
    * HTTP Status Code: 201 Created
    * Response Body: The created resource with a populated `lastUpdate` timestamp in the response body.

* **Required FHIR Operations:** 
    * `POST` request to the appropriate resource endpoint (e.g., `[base]/Patient`).

* **Test Data Requirements:** 
    * A sample resource instance for each profile defined in the guide.

* **Validation Criteria:** 
    * Assert that the HTTP status code is 201 Created.
    * Assert that the `lastUpdate` element is present in the returned resource.
    * Assert that the `lastUpdate` value is a valid timestamp format according to the FHIR specification.

#### 3.2. Test Case 2: Verify `lastUpdate` Update on Resource Update

* **Test Objective:** Verify that the `lastUpdate` timestamp is updated when a resource conforming to a profile in the guide is updated.

* **Required Inputs:** 
    * A valid FHIR resource instance conforming to one of the profiles defined in the guide, previously created and retrieved from the server.
    * A modification to the resource content (e.g., updating a patient's address).

* **Expected Outputs:** 
    * HTTP Status Code: 200 OK
    * Response Body: The updated resource with an updated `lastUpdate` timestamp in the response body.

* **Required FHIR Operations:** 
    * `PUT` request to the appropriate resource endpoint with the resource ID (e.g., `[base]/Patient/[id]`).

* **Test Data Requirements:** 
    * A sample resource instance for each profile defined in the guide.

* **Validation Criteria:** 
    * Assert that the HTTP status code is 200 OK.
    * Assert that the `lastUpdate` element in the returned resource is updated and reflects a later timestamp than the original resource retrieved before modification.


**Note:** These test cases can be automated using testing frameworks like Jest, Mocha, or pytest with FHIR client libraries. The specific implementation will depend on the chosen testing framework and programming language. 


---

<a id='req-32'></a>

### REQ-32: General Search for Pharmacy

**Description**: "The Plan-Net design is based around the following types of searches: General Search - Example: Pharmacy - Focal Resource and Field: HealthcareService.category, HealthcareService.specialty - Qualifications of Search: Location, network."

**Actor**: Server

**Conformance**: None (Design requirement)

## Test Specification

### 1. Requirement ID

REQ-32: General Search for Pharmacy

### 2. Requirement Analysis

**Testability Assessment:** Automatic

**Complexity:** Moderate

**Prerequisites:**

* A running FHIR server with the Plan-Net implementation.
* The FHIR server must have HealthcareService resources loaded, including some categorized as pharmacies.
* Test data should include HealthcareService resources with various combinations of `category` and `specialty` values, along with associated `Location` resources.

### 3. Test Implementation Strategy

#### 3.1 Required Inputs and Expected Outputs

**Inputs:**

* **Search URL:** This will be constructed based on the specific test case. It will target the HealthcareService resource and utilize search parameters like `service-category`, `specialty`, `location`, and potentially combinations thereof.
* **Location Parameters:**  Specific location-based search parameters will vary depending on the test case, including:
    * `location`: Reference to a Location resource.
    * `address-city`, `address-state`, `address-postalcode`: String values for location details.

**Expected Outputs:**

* **HTTP Status Code:** 200 (OK) indicating a successful search.
* **FHIR Bundle:** A Bundle resource containing a list of HealthcareService resources that match the search criteria. 
* **Resource Validation:** All returned resources must be valid FHIR resources according to the FHIR specification.

#### 3.2 Required FHIR Operations

* **Search (GET):**  `/HealthcareService?{search parameters}`

#### 3.3 Test Data Requirements

* **HealthcareService Resources:**
    * Resources representing pharmacies with different combinations of `category` and `specialty` values.
    * Resources with associated `Location` resources populated with relevant location data.
* **Location Resources:**
    * Resources representing various geographical locations.

#### 3.4 Validation Criteria

1. **Response Validation:**
   * Verify the HTTP status code is 200 (OK).
   * Verify the response Content-Type is `application/fhir+json` or `application/fhir+xml`.
   * Validate the response Bundle resource against the FHIR specification.

2. **Resource Validation:**
   * Validate all returned HealthcareService resources against the FHIR specification.
   * Ensure all returned resources have the required `category` and/or `specialty` values specified in the search criteria.

3. **Location-Based Search Validation:**
   * **Direct Location Search:** When searching with the `location` parameter, verify that only HealthcareService resources associated with the specified Location resource are returned.
   * **Location Detail Search:** When searching with parameters like `address-city`, `address-state`, or `address-postalcode`, verify that only HealthcareService resources associated with Location resources matching those details are returned.

4. **Combined Search Validation:**
   * Construct test cases that combine `service-category`, `specialty`, and location-based search parameters.
   * Verify that the returned results accurately reflect the combined search criteria.

**Example Test Case:**

**Test Case ID:** TC_REQ32_001

**Test Case Description:** Search for pharmacies in a specific city.

**Test Steps:**

1. Send a GET request to `/HealthcareService?service-category=http://terminology.hl7.org/CodeSystem/service-category|pharmacy&address-city=New York`
2. Verify the response status code is 200 (OK).
3. Validate the response Bundle resource.
4. Verify that all returned HealthcareService resources have `service-category` equal to `http://terminology.hl7.org/CodeSystem/service-category|pharmacy` and are associated with a Location resource where `address-city` is "New York". 


---

<a id='req-33'></a>

### REQ-33: Provider search by name

**Description**: "The Plan-Net design is based around the following types of searches: Provider by Name - Example: Joe Smith - Focal Resource and Field: Practitioner.name - Qualifications of Search: Location, network, specialty, role/privileges."

**Actor**: Server

**Conformance**: None (Design requirement)

## Test Specification

### 1. Requirement ID

REQ-33: Provider search by name

### 2. Requirement Analysis

**Testability Assessment:** Automatic

**Complexity:** Moderate

**Prerequisites:**

* A running FHIR server with the Plan-Net design implemented.
* The FHIR server must have Practitioner resources populated with realistic data, including names, locations, networks, specialties, and roles/privileges.
* The Capability Statement of the FHIR server should advertise support for the search parameters listed in the requirement.

### 3. Test Implementation Strategy

#### 3.1 Test Case 1: Search for Practitioner by Full Name (Exact Match)

**Objective:** Verify that the system can successfully search for a Practitioner resource using an exact match of their full name.

**Inputs:**

* **FHIR Operation:** GET /Practitioner?name=[full name]
* **Test Data:** 
    * `[full name]`:  A string representing the full name of an existing Practitioner resource in the system (e.g., "Joe Smith").

**Expected Outputs:**

* **HTTP Status Code:** 200 (OK)
* **Response Body:** A Bundle resource containing a single Practitioner resource matching the provided full name.

**Validation Criteria:**

* The returned Bundle should contain exactly one Practitioner resource.
* The `name` element of the returned Practitioner resource should exactly match the provided full name in the search parameter.

#### 3.2 Test Case 2: Search for Practitioner by Partial Name

**Objective:** Verify that the system can successfully search for a Practitioner resource using a partial name match.

**Inputs:**

* **FHIR Operation:** GET /Practitioner?name=[partial name]
* **Test Data:** 
    * `[partial name]`: A string representing part of the name of an existing Practitioner resource in the system (e.g., "Smith" or "Joe").

**Expected Outputs:**

* **HTTP Status Code:** 200 (OK)
* **Response Body:** A Bundle resource containing a list of Practitioner resources whose names contain the provided partial name.

**Validation Criteria:**

* The returned Bundle should contain one or more Practitioner resources.
* The `name` element of each returned Practitioner resource should contain the provided partial name in the search parameter.

#### 3.3 Test Case 3: Search for Practitioner by Name with Additional Search Parameters

**Objective:** Verify that the system can successfully search for a Practitioner resource using a name combined with other search parameters like location, network, specialty, or role.

**Inputs:**

* **FHIR Operation:** GET /Practitioner?name=[name]&[additional parameter]=[value]
* **Test Data:** 
    * `[name]`: A string representing the full or partial name of an existing Practitioner resource.
    * `[additional parameter]`: One or more additional search parameters supported by the Practitioner resource (e.g., `address`, `organization`, `specialty`).
    * `[value]`: The corresponding value for each additional search parameter.

**Expected Outputs:**

* **HTTP Status Code:** 200 (OK)
* **Response Body:** A Bundle resource containing a list of Practitioner resources that match both the provided name and the additional search criteria.

**Validation Criteria:**

* The returned Bundle should contain only Practitioner resources that match all provided search criteria (name and additional parameters).

#### 3.4 Test Case 4: Search for Practitioner by Name with No Matching Results

**Objective:** Verify that the system returns an empty result set when searching for a Practitioner by name that does not exist.

**Inputs:**

* **FHIR Operation:** GET /Practitioner?name=[non-existent name]
* **Test Data:** 
    * `[non-existent name]`: A string representing a name that does not match any existing Practitioner resource in the system.

**Expected Outputs:**

* **HTTP Status Code:** 200 (OK)
* **Response Body:** An empty Bundle resource.

**Validation Criteria:**

* The returned Bundle should be empty, indicating no matching resources were found.

**Note:** These test cases provide a starting point for testing REQ-33. You may need to add more test cases to cover different scenarios and edge cases specific to your implementation. For example, you could test searching for names with different character sets or names containing special characters. 


---

<a id='req-34'></a>

### REQ-34: Organization search by name

**Description**: "The Plan-Net design is based around the following types of searches: Organization by Name - Example: Montgomery Cardiology or CVS - Focal Resource and Field: Organization.name - Qualifications of Search: Location, network, specialty."

**Actor**: Server

**Conformance**: None (Design requirement)

## Test Specification

### 1. Requirement ID

REQ-34: Organization search by name

### 2. Requirement Analysis

* **Testability Assessment:** Automatic
* **Complexity:** Simple
* **Prerequisites:**
    * A running FHIR server with the Plan-Net implementation.
    * The FHIR server should be populated with Organization resources containing 'name' values.

### 3. Test Implementation Strategy

#### 3.1. Test Case 1: Search Organization by full name

* **Test Objective:** Verify that the system can successfully search for an Organization resource using the full name.

* **Required Inputs:**
    * **FHIR Operation:** GET /Organization?name=[organizationName]
    * **Test Data:** 
        * `[organizationName]`: The full name of an existing organization in the system (e.g., "Montgomery Cardiology").

* **Expected Outputs:**
    * **HTTP Status Code:** 200 (OK)
    * **Response Body:** A Bundle resource containing only Organization resources matching the provided `name` search parameter.

* **Validation Criteria:**
    * Verify the HTTP status code is 200 (OK).
    * Verify the response body is a Bundle resource with `type` set to 'searchset'.
    * Verify all returned Organization resources in the Bundle have a `name` element that exactly matches the provided `[organizationName]` value.

#### 3.2. Test Case 2: Search Organization by partial name

* **Test Objective:** Verify that the system can successfully search for an Organization resource using a partial name.

* **Required Inputs:**
    * **FHIR Operation:** GET /Organization?name=[partialOrganizationName]
    * **Test Data:** 
        * `[partialOrganizationName]`: A part of the name of an existing organization in the system (e.g., "Montgomery").

* **Expected Outputs:**
    * **HTTP Status Code:** 200 (OK)
    * **Response Body:** A Bundle resource containing only Organization resources with names that include the provided `[partialOrganizationName]` value.

* **Validation Criteria:**
    * Verify the HTTP status code is 200 (OK).
    * Verify the response body is a Bundle resource with `type` set to 'searchset'.
    * Verify all returned Organization resources in the Bundle have a `name` element that contains the provided `[partialOrganizationName]` value.

#### 3.3. Test Case 3: Search Organization by name with incorrect case

* **Test Objective:** Verify that the system performs a case-insensitive search for Organization resources by name.

* **Required Inputs:**
    * **FHIR Operation:** GET /Organization?name=[organizationNameWithDifferentCase]
    * **Test Data:** 
        * `[organizationNameWithDifferentCase]`: The name of an existing organization in the system, but with different uppercase and lowercase letters (e.g., "montgomery cardiology").

* **Expected Outputs:**
    * **HTTP Status Code:** 200 (OK)
    * **Response Body:** A Bundle resource containing only Organization resources with names that match the provided `[organizationNameWithDifferentCase]` value, regardless of case.

* **Validation Criteria:**
    * Verify the HTTP status code is 200 (OK).
    * Verify the response body is a Bundle resource with `type` set to 'searchset'.
    * Verify all returned Organization resources in the Bundle have a `name` element that matches the provided `[organizationNameWithDifferentCase]` value, regardless of case.

**Note:** These test cases cover the basic functionality of searching for Organizations by name. Additional test cases can be added to test other aspects of the requirement, such as searching with combined parameters (location, network, specialty) as mentioned in the description. 


---

<a id='req-35'></a>

### REQ-35: Provider search by specialty

**Description**: "The Plan-Net design is based around the following types of searches: Provider by Specialty - Example: Cardiologist - Focal Resource and Field: PractitionerRole.specialty - Qualifications of Search: Location, network, name."

**Actor**: Server

**Conformance**: None (Design requirement)

## Test Specification

### 1. Requirement ID

REQ-35: Provider search by specialty

### 2. Requirement Analysis

* **Testability Assessment:** Automatic
* **Complexity:** Moderate
* **Prerequisites:**
    * A FHIR server instance is running and accessible.
    * The server is populated with Practitioner, PractitionerRole, and Location resources with varying specialties, locations, and network affiliations.
    * Test client capable of making FHIR API requests.

### 3. Test Implementation Strategy

#### 3.1. Test Case 1: Search by Specialty Only

* **Objective:** Verify that the server can successfully return a list of PractitionerRole resources filtered by a given specialty.

* **Inputs:**
    * **FHIR Operation:** GET /PractitionerRole?specialty={system}|{code}
    * **Example:** GET /PractitionerRole?specialty=http://hl7.org/fhir/us/core/CodeSystem/provider-taxonomy|207RC0000X

* **Expected Outputs:**
    * **HTTP Status Code:** 200 (OK)
    * **Response Body:** A Bundle resource containing a list of PractitionerRole resources where each resource has a `specialty` element matching the search parameter.

* **Validation Criteria:**
    * Verify the HTTP status code is 200.
    * Verify the response Content-Type header is "application/fhir+json".
    * Verify the response body is a valid Bundle resource.
    * Verify all returned PractitionerRole resources have the specified `specialty`.

#### 3.2. Test Case 2: Search by Specialty with Location

* **Objective:** Verify that the server can successfully return a list of PractitionerRole resources filtered by a given specialty and location.

* **Inputs:**
    * **FHIR Operation:** GET /PractitionerRole?specialty={system}|{code}&location:reference=Location/{id}
    * **Example:** GET /PractitionerRole?specialty=http://hl7.org/fhir/us/core/CodeSystem/provider-taxonomy|207RC0000X&location:reference=Location/1234

* **Expected Outputs:**
    * **HTTP Status Code:** 200 (OK)
    * **Response Body:** A Bundle resource containing a list of PractitionerRole resources where each resource has a `specialty` element matching the search parameter and a `location` reference matching the provided Location ID.

* **Validation Criteria:**
    * Verify the HTTP status code is 200.
    * Verify the response Content-Type header is "application/fhir+json".
    * Verify the response body is a valid Bundle resource.
    * Verify all returned PractitionerRole resources have the specified `specialty` and `location`.

#### 3.3. Test Case 3: Search by Specialty with Network

* **Objective:** Verify that the server can successfully return a list of PractitionerRole resources filtered by a given specialty and network.

* **Inputs:**
    * **FHIR Operation:** GET /PractitionerRole?specialty={system}|{code}&network={system}|{code}
    * **Example:** GET /PractitionerRole?specialty=http://hl7.org/fhir/us/core/CodeSystem/provider-taxonomy|207RC0000X&network=http://example.org/networks|network1

* **Expected Outputs:**
    * **HTTP Status Code:** 200 (OK)
    * **Response Body:** A Bundle resource containing a list of PractitionerRole resources where each resource has a `specialty` element matching the search parameter and a `network` element matching the provided network code.

* **Validation Criteria:**
    * Verify the HTTP status code is 200.
    * Verify the response Content-Type header is "application/fhir+json".
    * Verify the response body is a valid Bundle resource.
    * Verify all returned PractitionerRole resources have the specified `specialty` and `network`.

#### 3.4. Test Case 4: Search by Specialty with Name

* **Objective:** Verify that the server can successfully return a list of PractitionerRole resources filtered by a given specialty and practitioner name.

* **Inputs:**
    * **FHIR Operation:** GET /PractitionerRole?specialty={system}|{code}&practitioner:name={name}
    * **Example:** GET /PractitionerRole?specialty=http://hl7.org/fhir/us/core/CodeSystem/provider-taxonomy|207RC0000X&practitioner:name=Smith

* **Expected Outputs:**
    * **HTTP Status Code:** 200 (OK)
    * **Response Body:** A Bundle resource containing a list of PractitionerRole resources where each resource has a `specialty` element matching the search parameter and the referenced `practitioner` has a name containing the provided search string.

* **Validation Criteria:**
    * Verify the HTTP status code is 200.
    * Verify the response Content-Type header is "application/fhir+json".
    * Verify the response body is a valid Bundle resource.
    * Verify all returned PractitionerRole resources have the specified `specialty` and the referenced `practitioner` has a name containing the provided search string.

#### 3.5. Test Data Requirements

* A set of Practitioner, PractitionerRole, and Location resources with varying specialties, locations, network affiliations, and names. This data can be created specifically for testing or derived from existing datasets.

#### 3.6. Additional Notes

* These test cases can be combined and modified to test various search combinations and edge cases.
* The specific codes and systems used in the examples may need to be adjusted based on the implementation.
* Consider using a testing framework or tool to automate the execution and validation of these tests. 


---

<a id='req-36'></a>

### REQ-36: Organization search by specialty

**Description**: "The Plan-Net design is based around the following types of searches: Organization by specialty - Example: Compounding Pharmacy - Focal Resource and Field: OrganizationAffiliation.specialty - Qualifications of Search: Location, network, name."

**Actor**: Server

**Conformance**: None (Design requirement)

## Test Specification

### 1. Requirement ID

REQ-36: Organization search by specialty

### 2. Requirement Analysis

**Testability Assessment:** Automatic

**Complexity:** Moderate

**Prerequisites:**

* A running FHIR server with the Plan-Net Implementation Guide.
* The FHIR server must have Organization, OrganizationAffiliation, and Location resources populated with data that includes specialties, networks, and locations.
* Test client capable of sending FHIR search requests.

### 3. Test Implementation Strategy

#### 3.1 Test Case 1: Search for Organizations by Specialty

**Objective:** Verify that the system can successfully search for organizations based on a given specialty.

**Inputs:**

* **FHIR Operation:** GET /OrganizationAffiliation?specialty={system|code}
    * Replace `{system|code}` with the desired specialty system and code.
* **Example:** GET /OrganizationAffiliation?specialty=http://hl7.org/fhir/us/npi|1619W00000X 

**Expected Outputs:**

* **HTTP Status Code:** 200 (OK)
* **Response Body:** A Bundle resource containing OrganizationAffiliation resources that match the specified specialty.
* **Validation:**
    * The `specialty` element in each returned OrganizationAffiliation resource should match the search parameter value.
    * The Bundle should include the total number of matching resources.

#### 3.2 Test Case 2: Search for Organizations by Specialty, Location, and Network

**Objective:** Verify that the system can successfully search for organizations based on a combination of specialty, location, and network.

**Inputs:**

* **FHIR Operation:** 
    * GET /OrganizationAffiliation?specialty={system|code}&organization.address-city={city}&network={network_id}
    * Replace `{system|code}` with the desired specialty system and code.
    * Replace `{city}` with the desired city.
    * Replace `{network_id}` with the desired network ID.
* **Example:** GET /OrganizationAffiliation?specialty=http://hl7.org/fhir/us/npi|1619W00000X&organization.address-city=London&network=12345

**Expected Outputs:**

* **HTTP Status Code:** 200 (OK)
* **Response Body:** A Bundle resource containing OrganizationAffiliation resources that match the specified specialty, location, and network.
* **Validation:**
    * The `specialty` element in each returned OrganizationAffiliation resource should match the search parameter value.
    * The `address-city` element of the Organization resource referenced by the `organization` element in each returned OrganizationAffiliation resource should match the search parameter value.
    * The `network` element in each returned OrganizationAffiliation resource should match the search parameter value.
    * The Bundle should include the total number of matching resources.

#### 3.3 Test Data Requirements:

* **Organization Resources:** At least two organizations with different specialties, locations, and network affiliations.
* **OrganizationAffiliation Resources:** At least one OrganizationAffiliation resource for each organization, linking them to their respective specialties, locations, and networks.
* **Location Resources:** At least one Location resource for each organization, representing their physical location.

#### 3.4 Validation Criteria:

* **Conformance to Search Parameter Definitions:** The server should correctly interpret and apply the search parameters as defined in the FHIR specification and the Plan-Net Implementation Guide.
* **Data Accuracy:** The returned resources should accurately reflect the data stored on the server and match the search criteria.
* **Response Structure:** The server should return a valid Bundle resource with the correct structure and content as defined in the FHIR specification.


This test specification provides a comprehensive approach to testing the "Organization search by specialty" requirement. By executing these test cases and verifying the expected outputs, you can ensure that your FHIR server implementation meets the requirements outlined in the Plan-Net Implementation Guide. 


---

<a id='req-37'></a>

### REQ-37: Search for active practitioners and organizations

**Description**: "Sample query to search for currently active Practitioners (replace date in query with current date): http://davinci-plan-net-ri.logicahealth.org/fhir/PractitionerRole?_include=PractitionerRole:date=ge2021-10-25. Sample query to search for currently active Organizations (replace date in query with current date): http://davinci-plan-net-ri.logicahealth.org/fhir/OrganizationAffiliation?_include=OrganizationAffiliation:date=ge2021-10-25."

**Actor**: Server

**Conformance**: None (Implementation example)

## Test Specification

### 1. Requirement ID

REQ-37: Search for active practitioners and organizations

### 2. Requirement Analysis

- **Testability Assessment**: Automatic
- **Complexity**: Moderate
- **Prerequisites**:
    - A running FHIR server with the relevant resources (Practitioner, Organization, PractitionerRole, OrganizationAffiliation).
    - At least one Practitioner and one Organization resource should have an associated PractitionerRole or OrganizationAffiliation resource with a `date` element set to a date in the past (representing active status).

### 3. Test Implementation Strategy

#### 3.1. Test Case 1: Search for Active Practitioners

**3.1.1. Inputs:**

- **FHIR Operation:** GET /PractitionerRole?_include=PractitionerRole:date=ge{currentDate}&_summary=count
- **Request Headers:** Accept: application/fhir+json

**3.1.2. Expected Outputs:**

- **HTTP Status Code:** 200 OK
- **Response Body:** A Bundle containing PractitionerRole resources where the `date` element is greater than or equal to the current date. The `_summary=count` parameter ensures only the count of matching resources is returned.

**3.1.3. Validation Criteria:**

- Verify the HTTP status code is 200 OK.
- Verify the `total` element in the Bundle resource represents a count greater than zero, indicating the presence of active PractitionerRole resources.

#### 3.2. Test Case 2: Search for Active Organizations

**3.2.1. Inputs:**

- **FHIR Operation:** GET /OrganizationAffiliation?_include=OrganizationAffiliation:date=ge{currentDate}&_summary=count
- **Request Headers:** Accept: application/fhir+json

**3.2.2. Expected Outputs:**

- **HTTP Status Code:** 200 OK
- **Response Body:** A Bundle containing OrganizationAffiliation resources where the `date` element is greater than or equal to the current date. The `_summary=count` parameter ensures only the count of matching resources is returned.

**3.2.3. Validation Criteria:**

- Verify the HTTP status code is 200 OK.
- Verify the `total` element in the Bundle resource represents a count greater than zero, indicating the presence of active OrganizationAffiliation resources.

#### 3.3. Test Data Requirements

- Test data should include at least one Practitioner and one Organization resource.
- Each resource should have an associated PractitionerRole or OrganizationAffiliation resource.
- The `date` element in the PractitionerRole and OrganizationAffiliation resources should be populated with values representing both active and inactive statuses.

#### 3.4. Additional Notes

- The `{currentDate}` placeholder in the search queries should be replaced with the actual current date during test execution.
- These test cases focus on verifying the server's ability to correctly interpret the search parameters and return the expected resources. Further testing may be required to validate the accuracy of the `date` element and its representation of active status within the specific implementation.
- The provided Capability Statement confirms the server supports the required search parameters for both PractitionerRole and OrganizationAffiliation resources. 


---

<a id='req-38'></a>

### REQ-38: Network contact handling for departments

**Description**: "When the contact is a department name, rather than a human (e.g., patient help line), include a blank family and given name, and provide the department name in contact.name.text."

**Actor**: Server

**Conformance**: None (Implementation guidance)

## Test Specification for REQ-38: Network Contact Handling for Departments

### 1. Requirement ID

REQ-38

### 2. Requirement Analysis

- **Testability Assessment:** Automatic
- **Complexity:** Simple
- **Prerequisites:**
    - A FHIR server instance capable of handling ContactPoint resources.
    - The server should support the `create` operation for ContactPoint resources as indicated in the Capability Statement.

### 3. Test Implementation Strategy

#### 3.1 Required Inputs and Expected Outputs

**Input:**

- A FHIR `ContactPoint` resource with:
    - `system`:  Appropriate contact system (e.g., "phone", "email")
    - `value`:  The contact value (e.g., phone number, email address)
    - `use`:  Intended use of the contact (e.g., "work", "home")
    - `period`: Optional time period when the contact is valid
    - **Blank `name.family` and `name.given` elements.**
    - **Populated `name.text` element with the department name.**

**Expected Output:**

- HTTP Status Code `201 Created` indicating successful creation of the resource.
- The returned `ContactPoint` resource should match the input data, including the blank `family` and `given` name elements and the populated `text` element with the department name.

#### 3.2 Required FHIR Operations

- `POST` request to the `/ContactPoint` endpoint to create a new ContactPoint resource.

#### 3.3 Test Data Requirements

- A set of valid contact details (e.g., phone number, email address).
- A list of department names to use as `name.text`.

#### 3.4 Validation Criteria

1. **HTTP Status Code Check:** Verify that the server returns an HTTP status code of `201 Created` upon successful creation of the `ContactPoint` resource.
2. **Resource Content Check:** Verify that the returned `ContactPoint` resource contains:
    - Blank `name.family` and `name.given` elements.
    - The department name accurately populated in the `name.text` element.
    - All other provided input values are accurately reflected in the corresponding resource elements. 

**Note:** This test specification focuses on the successful creation scenario. Additional tests can be developed to cover error handling, edge cases, and different contact systems. 


---

<a id='req-39'></a>

### REQ-39: Organization contact handling for departments

**Description**: "When the contact is a department name, rather than a human (e.g., patient help line), include a blank family and given name, and provide the department name in contact.name.text."

**Actor**: Server

**Conformance**: None (Implementation guidance)

## Test Specification

### 1. Requirement ID

REQ-39: Organization contact handling for departments

### 2. Requirement Analysis

**Testability Assessment**: Automatic
**Complexity**: Simple
**Prerequisites**:
* A FHIR server instance capable of handling Organization resources.
* The server should support the `name` search parameter for Organization resources (as per Capability Statement).

### 3. Test Implementation Strategy

**Test Case 1: Retrieve Organization with Department Contact**

**Required Inputs**:
* A search request to the `/Organization` endpoint.
* The search request should use the `name` search parameter to target an organization known to have a department contact.

**Expected Outputs**:
* HTTP Status Code: 200 (OK)
* A Bundle resource containing at least one Organization resource.

**Required FHIR Operations**:
* `GET /Organization?name={organizationName}`

**Test Data Requirements**:
* An Organization resource representing a department with the following characteristics:
    * `name`: Contains the department name.
    * `contact`:
        * `purpose`:  CodeableConcept indicating "department" or similar.
        * `name`: 
            * `family`: Empty.
            * `given`: Empty.
            * `text`: Contains the department name.

**Validation Criteria**:
* The returned Bundle should contain an Organization resource matching the search criteria.
* The `contact` element within the Organization resource should have:
    * Empty `family` and `given` elements within the `name` field.
    * The `text` element within the `name` field should match the department name provided in the search request.

**Example using `requests` library in Python:**

```python
import requests

base_url = "https://your-fhir-server/R4"
organization_name = "Test Department"

response = requests.get(f"{base_url}/Organization?name={organization_name}")

assert response.status_code == 200

bundle = response.json()
# Assert that the bundle contains an Organization resource with the correct contact information
# ...
```

**Note:** This test specification focuses on retrieving an existing Organization resource with a department contact. To ensure full coverage, additional test cases should be implemented to cover scenarios like creating and updating Organization resources with department contacts. 


---

<a id='req-40'></a>

### REQ-40: Practitioner qualification coding

**Description**: "When the value set for the coded concept in qualification is insufficient, the qualification can be provided in the text field of the codeableConcept."

**Actor**: Server

**Conformance**: None (Implementation guidance)

## Test Specification

### 1. Requirement ID

REQ-40: Practitioner qualification coding

### 2. Requirement Analysis

**Testability Assessment:** Hybrid (Automated API call with manual inspection of response)

**Complexity:** Moderate

**Prerequisites:**

* A running FHIR server with the implementation guide in question.
* At least one Practitioner resource with a qualification element where:
    * The `coding.code` field uses a value set defined in the implementation guide.
    * The `coding.text` field provides additional qualification information not captured in the coded concept.

### 3. Test Implementation Strategy

#### 3.1. Required Inputs and Expected Outputs

**Inputs:**

* **FHIR Operation:** `READ` on the Practitioner resource with the specific qualification.

**Expected Outputs:**

* **HTTP Status Code:** 200 (OK)
* **Response Body:** A valid Practitioner resource in JSON or XML format.

#### 3.2. Required FHIR Operations

* `READ` - To retrieve the Practitioner resource with the specific qualification. This operation is supported as indicated by the "_id" search parameter in the Capability Statement.

#### 3.3. Test Data Requirements

* **Practitioner Resource:**
    * Must include at least one `qualification` element.
    * The `qualification.code.coding.code` field should use a value from a value set defined in the implementation guide.
    * The `qualification.code.coding.text` field should contain additional information about the qualification not captured by the coded concept.

**Example:**

```json
{
  "resourceType": "Practitioner",
  // ... other Practitioner resource elements ...
  "qualification": [
    {
      "code": {
        "coding": [
          {
            "system": "http://terminology.hl7.org/CodeSystem/v2-0360",
            "code": "RN",
            "display": "Registered Nurse"
          }
        ],
        "text": "Registered Nurse with specialization in Pediatric Critical Care"
      },
      // ... other qualification elements ...
    }
  ]
}
```

#### 3.4. Validation Criteria

1. **Response Validation:**
   * Verify the HTTP status code is 200 (OK).
   * Verify the response body is a valid Practitioner resource according to the FHIR specification.
2. **Content Validation:**
   * Locate the `qualification` element within the Practitioner resource.
   * Verify that the `coding.text` field within the `qualification.code` element contains the additional qualification information.
   * Manually inspect the content of the `coding.text` field to ensure it accurately supplements the information provided in the `coding.code` field and adheres to any specified formatting or content guidelines from the implementation guide.

**Passing Criteria:**

The test passes if all validation criteria are met. This indicates the server can successfully store and return Practitioner resources where the `coding.text` field is used to provide additional qualification information not captured in the coded concept. 


---



