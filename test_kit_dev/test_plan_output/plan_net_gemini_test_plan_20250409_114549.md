# Consolidated Test Plan for Plan Net

## Generated on: 2025-04-09 11:46:09

## Capability Statement

This test plan incorporates constraints and requirements from the Plan Net Capability Statement.

## Table of Contents

- [Client](#client)
  - [REQ-02: No PII sending by clients](#req-02)
  - [REQ-06: Client handling of Must Support data elements](#req-06)
  - [REQ-07: Client display of data elements](#req-07)
  - [REQ-08: Client interpretation of missing Must Support data](#req-08)
  - [REQ-09: Client processing of missing information indicators](#req-09)
  - [REQ-31: Client tracking of directory content updates](#req-31)
- [Server](#server)
  - [REQ-01: No PII requirement for directory queries](#req-01)
  - [REQ-03: Population of Must Support data elements](#req-03)
  - [REQ-04: Not including absent data elements](#req-04)
  - [REQ-05: Using dataAbsentReason for missing required information](#req-05)
  - [REQ-10: JSON format support](#req-10)
  - [REQ-11: RESTful behavior implementation](#req-11)
  - [REQ-12: Support for all Implementation Guide profiles](#req-12)
  - [REQ-13: Unauthorized request response](#req-13)
  - [REQ-14: Insufficient scope response](#req-14)
  - [REQ-15: Invalid parameter response](#req-15)
  - [REQ-16: Unknown resource response](#req-16)
  - [REQ-17: Deleted resource response](#req-17)
  - [REQ-18: Profile identification in meta attribute](#req-18)
  - [REQ-19: Individual search parameter support](#req-19)
  - [REQ-20: Combination search parameter support](#req-20)
  - [REQ-21: Forward chaining support](#req-21)
  - [REQ-22: Reverse chaining support](#req-22)
  - [REQ-23: XML format support](#req-23)
  - [REQ-24: Rejection of unauthorized requests](#req-24)
  - [REQ-25: Support for read interaction](#req-25)
  - [REQ-26: Support for vread interaction](#req-26)
  - [REQ-27: Support for _includes](#req-27)
  - [REQ-28: Support for _revincludes](#req-28)
  - [REQ-29: Network profile NPI handling](#req-29)
  - [REQ-30: lastUpdate timestamp requirement](#req-30)
  - [REQ-32: General Search for Pharmacy](#req-32)
  - [REQ-33: Provider search by name](#req-33)
  - [REQ-34: Organization search by name](#req-34)
  - [REQ-35: Provider search by specialty](#req-35)
  - [REQ-36: Organization search by specialty](#req-36)
  - [REQ-37: Search for active practitioners and organizations](#req-37)
  - [REQ-38: Network contact handling for departments](#req-38)
  - [REQ-39: Organization contact handling for departments](#req-39)
  - [REQ-40: Practitioner qualification coding](#req-40)

## Test Specifications

<a id='client'></a>

## Client

<a id='req-02'></a>

### REQ-02: No PII sending by clients

**Description**: "A directory mobile application SHALL NOT send consumer identifiable information when querying a Plan-Net service."

**Actor**: Client

**Conformance**: SHALL NOT

## Test Specification for REQ-02: No PII Sending by Clients

**1. Requirement ID:** REQ-02

**2. Requirement Analysis:**

   - **Testability Assessment:** Hybrid (Automated API call analysis combined with manual inspection of data)
   - **Complexity:** Moderate
   - **Prerequisites:** 
     - A running instance of the directory mobile application (client).
     - Access to the client's network traffic or logs.
     - A running instance of the Plan-Net service.
     - Knowledge of what constitutes "consumer identifiable information" within the context of this implementation guide. This may include data elements like name, address, date of birth, social security number, etc.

**3. Test Implementation Strategy:**

   **3.1. Positive Test Case:**

     - **Test Case ID:** REQ-02-PT-001
     - **Description:** Verify that the client does not send PII when making valid queries to the Plan-Net service.
     - **Required Inputs:** 
       - A valid query that does not contain PII (e.g., a query for available health plans based on zip code).
     - **Expected Outputs:** 
       - The client successfully sends the query to the Plan-Net service.
       - The network traffic or logs of the client application do not show any PII being transmitted.
       - The Plan-Net service returns a successful response (assuming the query itself was valid).
     - **Required FHIR Operations:**
       - The specific FHIR operation will depend on the query being made (e.g., `GET [base]/Coverage` to search for coverage plans). Ensure the Capability Statement of the Plan-Net service advertises support for the chosen operation.
     - **Test Data Requirements:**
       - Prepare a set of valid queries that do not contain PII.
     - **Validation Criteria:**
       - Analyze the client's network traffic or logs to confirm the absence of PII in the request payload.
       - Verify the Plan-Net service responds successfully to the query.

   **3.2. Negative Test Case:**

     - **Test Case ID:** REQ-02-NT-001
     - **Description:** Verify that the client is prevented from sending PII even when included in the query.
     - **Required Inputs:** 
       - A query that intentionally includes PII (e.g., a query for available health plans using a patient's name and date of birth).
     - **Expected Outputs:** 
       - The client application prevents the query from being sent or sanitizes the query before sending, removing the PII.
       - The network traffic or logs of the client application do not show any PII being transmitted.
     - **Required FHIR Operations:**
       -  N/A - This test focuses on client-side validation before any FHIR operation is performed.
     - **Test Data Requirements:**
       - Prepare a set of queries that intentionally include PII.
     - **Validation Criteria:**
       - Analyze the client's network traffic or logs to confirm the absence of PII being transmitted.
       - Alternatively, if the client sanitizes the query, verify that the sent request does not contain PII.

**Note:** These test cases provide a starting point. Depending on the specific implementation and the types of queries supported, additional test cases might be necessary to ensure comprehensive coverage. 


---

<a id='req-06'></a>

### REQ-06: Client handling of Must Support data elements

**Description**: "Application actors SHALL be capable of processing resource instances containing the Must Support data elements without generating an error or causing the application to fail."

**Actor**: Client

**Conformance**: SHALL

## Test Specification for REQ-06: Client Handling of Must Support Data Elements

**1. Requirement ID:** REQ-06

**2. Requirement Analysis:**

   - **Testability Assessment:** Hybrid (Combination of automated data generation and manual inspection of client behavior)
   - **Complexity:** Moderate
   - **Prerequisites:** 
      - A running instance of the client application under test.
      - Access to the client's Capability Statement.
      - Test data consisting of FHIR resources relevant to the client's functionality, including "Must Support" data elements.

**3. Test Implementation Strategy:**

   **3.1. Test Procedure:**

     1. **Identify Must Support Data Elements:** From the applicable FHIR Implementation Guide, identify all data elements marked as "Must Support" for the resources the client interacts with.
     2. **Generate Test Data:** Create or obtain FHIR resources containing the identified "Must Support" data elements. Ensure the data is realistic and relevant to the client's expected use cases.
     3. **Execute Client Operations:** Using the prepared test data, perform relevant FHIR operations (e.g., read, create, update) against the client application. These operations should be supported according to the client's Capability Statement.
     4. **Observe Client Behavior:** Monitor the client application for any errors, failures, or unexpected behavior during the processing of resources containing "Must Support" data elements.

   **3.2. Required FHIR Operations:**

     - The specific FHIR operations will depend on the client's functionality as declared in its Capability Statement. Common examples include:
       - `read`: Retrieve a resource by ID.
       - `search`: Search for resources matching specific criteria.
       - `create`: Create a new resource.
       - `update`: Update an existing resource.

   **3.3. Test Data Requirements:**

     - FHIR resources relevant to the client's functionality.
     - Resources should include a representative sample of "Must Support" data elements.
     - Data should be realistic and align with expected use cases.

   **3.4. Validation Criteria:**

     - **Pass:** The client application successfully processes all FHIR resources containing "Must Support" data elements without generating errors or failures.
       - Verify that the client application can correctly parse, interpret, and persist the "Must Support" data elements.
       - Ensure that the client application's responses to FHIR operations are consistent with the provided data, including the "Must Support" elements.
     - **Fail:** The client application generates errors, fails to process, or exhibits unexpected behavior when handling resources containing "Must Support" data elements. 
       - Document specific errors, failures, or unexpected behaviors encountered.
       - Capture relevant logs, error messages, and client responses for further analysis. 

**Note:** This test specification provides a general framework. The specific test cases and data will need to be tailored based on the FHIR Implementation Guide, the client's functionality, and the resources it interacts with. 


---

<a id='req-07'></a>

### REQ-07: Client display of data elements

**Description**: "Application actors SHOULD be capable of displaying the data elements for human use or storing the information for other purposes."

**Actor**: Client

**Conformance**: SHOULD

## Test Specification for REQ-07: Client Display of Data Elements

**1. Requirement ID:** REQ-07

**2. Requirement Analysis:**

   - **Testability Assessment:** Hybrid (Combination of Automatic and Manual)
   - **Complexity:** Moderate
   - **Prerequisites:**
     - A running instance of the client application under test.
     - Access to test data in FHIR format.
     - Defined set of data elements relevant to the specific implementation.

**3. Test Implementation Strategy:**

   **3.1. Test Case 1: Display of Data Elements for Human Use**

     - **Description:** Verify the client application can retrieve and display specified data elements in a human-readable format.

     - **Required Inputs:**
       - List of FHIR resources and corresponding data elements to be displayed (e.g., Patient.name, Observation.valueQuantity).

     - **Required FHIR Operations:**
       - `read`: To retrieve the required FHIR resources from the server.
       - (Potentially) `search`: If retrieving a set of resources based on specific criteria.

     - **Test Data Requirements:**
       - Sample FHIR resources containing the specified data elements.

     - **Validation Criteria:**
       - **Automatic:** Verify successful execution of FHIR API calls (e.g., HTTP status code 200).
       - **Manual:** Visually inspect the client application to ensure:
         - The specified data elements are displayed.
         - The displayed format is human-readable and understandable.
         - The displayed information accurately reflects the data in the FHIR resources.

   **3.2. Test Case 2: Storage of Data Elements for Other Purposes**

     - **Description:** Verify the client application can store retrieved data elements for purposes other than direct display.

     - **Required Inputs:**
       - List of FHIR resources and corresponding data elements to be stored.
       - Definition of the storage mechanism used by the client application (e.g., local database, file system).

     - **Required FHIR Operations:**
       - `read`: To retrieve the required FHIR resources from the server.
       - (Potentially) `search`: If retrieving a set of resources based on specific criteria.

     - **Test Data Requirements:**
       - Sample FHIR resources containing the specified data elements.

     - **Validation Criteria:**
       - **Automatic:** Verify successful execution of FHIR API calls (e.g., HTTP status code 200).
       - **Manual/Automated (depending on storage mechanism):** 
         - Access the client application's storage mechanism.
         - Verify the specified data elements are stored correctly.
         - Verify the stored information accurately reflects the data in the FHIR resources.

**Notes:**

- The specific data elements to be tested should be determined based on the implementation guide's scope and the client application's functionality.
- The test cases above provide a general framework. Specific test steps and assertions may need to be adjusted based on the chosen testing tools and the client application's implementation details.
- The Capability Statement should be consulted to ensure the client application supports the required FHIR operations and data types. 
- Consider edge cases and potential error scenarios to ensure robust testing. 


---

<a id='req-08'></a>

### REQ-08: Client interpretation of missing Must Support data

**Description**: "When querying Health Plan API actors, Application actors SHALL interpret missing Must Support data elements within resource instances as data not present in the Health Plan API actors system."

**Actor**: Client

**Conformance**: SHALL

## Test Specification for REQ-08: Client Interpretation of Missing Must Support Data

### 1. Requirement ID

REQ-08

### 2. Requirement Analysis

* **Testability Assessment:** Hybrid (Combination of automated API calls and manual inspection of client logic)
* **Complexity:** Moderate
* **Prerequisites:** 
    * A running instance of the client application under test.
    * A running instance of the Health Plan API server, configured with resources that have some "Must Support" data elements intentionally missing.
    * Knowledge of the specific "Must Support" data elements within the resources being tested.

### 3. Test Implementation Strategy

#### 3.1. Test Case 1: Missing "Must Support" Data Element

* **Test Objective:** Verify that the client application correctly interprets missing "Must Support" data elements as data not present in the Health Plan API system.

* **Required Inputs:**
    * A valid query to the Health Plan API that should return resources with the specific "Must Support" data element missing.

* **Expected Outputs:**
    * The client application should not throw an error or exception.
    * The client application should not display the missing "Must Support" data element to the user.
    * **Manual Inspection:** Verify the client application's internal logic or logs to confirm that the missing data element is handled as "data not present" and not misinterpreted as an error.

* **Required FHIR Operations:**
    * `GET` request to the appropriate FHIR resource endpoint on the Health Plan API.

* **Test Data Requirements:**
    * Pre-populated FHIR resources on the Health Plan API server with specific "Must Support" data elements intentionally missing. 

* **Validation Criteria:**
    * **Pass:** The client application successfully retrieves the resource, does not display the missing data element, and handles the missing data gracefully without errors. Manual inspection confirms the correct interpretation of missing data.
    * **Fail:** The client application throws an error, displays incorrect data, or otherwise mishandles the missing "Must Support" data element.

#### 3.2. Test Case 2:  "Must Support" Data Element Present

* **Test Objective:** Verify that the client application correctly handles and displays "Must Support" data elements when they are present in the resource.

* **Required Inputs:**
    * A valid query to the Health Plan API that should return resources with the specific "Must Support" data element present.

* **Expected Outputs:**
    * The client application should successfully retrieve and display the resource with the "Must Support" data element.

* **Required FHIR Operations:**
    * `GET` request to the appropriate FHIR resource endpoint on the Health Plan API.

* **Test Data Requirements:**
    * Pre-populated FHIR resources on the Health Plan API server with the specific "Must Support" data elements populated.

* **Validation Criteria:**
    * **Pass:** The client application successfully retrieves and displays the resource with the "Must Support" data element present.
    * **Fail:** The client application fails to retrieve the resource, displays incorrect data, or otherwise mishandles the "Must Support" data element. 

**Note:** These test cases provide a starting point. You may need to develop additional test cases depending on the specific "Must Support" data elements and the complexity of your client application. 


---

<a id='req-09'></a>

### REQ-09: Client processing of missing information indicators

**Description**: "Consumer App actors SHALL be able to process resource instances containing Must Support data elements asserting missing information."

**Actor**: Client

**Conformance**: SHALL

## Test Specification for REQ-09: Client Processing of Missing Information Indicators

### 1. Requirement ID

REQ-09

### 2. Requirement Analysis

**Summary:** Consumer App actors SHALL be able to process resource instances containing Must Support data elements asserting missing information.

* **Testability Assessment:**  **Automatic** (assuming the client exposes an API for testing)
* **Complexity:** **Moderate**
* **Prerequisites:**
    * A running instance of the Consumer App under test.
    * Test FHIR resources containing Must Support data elements with missing information indicators (e.g., `dataAbsentReason` extension).
    * Access to the Consumer App's API for retrieving and processing resources.

### 3. Test Implementation Strategy

**3.1. Required Inputs**

* **Test FHIR Resource:** A FHIR resource instance containing at least one Must Support data element with a missing information indicator. 
    * Example: A `Patient` resource with the `birthDate` element marked as missing using the `dataAbsentReason` extension.
* **Request Details:** 
    * HTTP Method: `GET` (or relevant method for retrieving resources based on the Capability Statement)
    * Endpoint URL:  The appropriate endpoint for retrieving the test resource (e.g., `/Patient/{id}`).

**3.2. Expected Outputs**

* **HTTP Status Code:** `200 OK` (successful retrieval of the resource).
* **Response Body:** The requested FHIR resource containing the Must Support element with the missing information indicator.
* **Client Behavior:** The Consumer App should successfully process the resource without errors or unexpected behavior, specifically acknowledging the missing information indicator.

**3.3. Required FHIR Operations**

* **Read:**  Retrieve the test FHIR resource using the appropriate endpoint defined in the Capability Statement. 

**3.4. Test Data Requirements**

* **Realistic Data:**  Use realistic and representative test data for the chosen FHIR resource type. 
* **Data Absent Reason Variations:** Include test cases with different `dataAbsentReason` codes (if applicable) to ensure comprehensive coverage.

**3.5. Validation Criteria**

1. **Successful Resource Retrieval:** Verify the client successfully retrieves the FHIR resource with a `200 OK` status code.
2. **Presence of Missing Information Indicator:** Assert that the returned resource contains the Must Support element with the expected missing information indicator (e.g., `dataAbsentReason` extension with the correct code).
3. **Client Error Handling:**  Confirm that the client does not throw any errors or exceptions when processing the resource with the missing information indicator. This can be verified through logs or by observing the client's behavior.
4. **Appropriate User Feedback:**  (If applicable) If the client has a user interface, verify that it provides appropriate feedback to the user about the missing information, based on the `dataAbsentReason` code.

**Note:** This test specification assumes that the Capability Statement confirms the server supports the `dataAbsentReason` extension or other relevant mechanisms for indicating missing information. 


---

<a id='req-31'></a>

### REQ-31: Client tracking of directory content updates

**Description**: "Clients that cache query results can track additions or modifications to directory content through queries that filter content using the _lastUpdated search parameter."

**Actor**: Client

**Conformance**: None (Implementation guidance)

## Test Specification for REQ-31: Client Tracking of Directory Content Updates

### 1. Requirement ID

REQ-31

### 2. Requirement Analysis

* **Testability Assessment:** Hybrid (Combination of Automatic and Manual)
* **Complexity:** Moderate
* **Prerequisites:**
    * A running FHIR server with the directory resource(s) implemented.
    * The FHIR server should support the `_lastUpdated` search parameter on the relevant resources as indicated in the CapabilityStatement.
    * A test client capable of making FHIR API calls and parsing responses.
    * Pre-populated test data in the FHIR server, including resources with different `lastUpdated` timestamps.

### 3. Test Implementation Strategy

#### 3.1 Required Inputs

* **Initial Query Timestamp:** A timestamp (t1) representing the initial time of the test.
* **Resource Type:** The type of resource being queried (e.g., Patient, Practitioner).

#### 3.2 Expected Outputs

* **Initial Resource Set:** A list of resources returned from the initial query using `_lastUpdated` with a value less than t1.
* **Updated Resource Set:** A list of resources returned from a subsequent query using `_lastUpdated` with a value greater than t1 and less than t2 (a later timestamp).

#### 3.3 Required FHIR Operations

1. **Search (Initial):** 
    * **URL:** `[base]/[resourceType]?_lastUpdated=lt[t1]`
    * **Method:** GET
    * **Expected Response:** 200 OK with a Bundle containing resources with `lastUpdated` values less than t1.
2. **Create/Update:**
    * **URL:** `[base]/[resourceType]/[id]` (for update) or `[base]/[resourceType]` (for create)
    * **Method:** PUT (for update) or POST (for create)
    * **Request Body:** A valid FHIR resource of the specified type.
    * **Expected Response:** 200 OK (update) or 201 Created (create)
3. **Search (Subsequent):**
    * **URL:** `[base]/[resourceType]?_lastUpdated=gt[t1]& _lastUpdated=lt[t2]`
    * **Method:** GET
    * **Expected Response:** 200 OK with a Bundle containing resources with `lastUpdated` values greater than t1 and less than t2.

#### 3.4 Test Data Requirements

* **Existing Resources:** A set of resources of the chosen type with varying `lastUpdated` timestamps.
* **New/Updated Resource:**  Data for creating a new resource or updating an existing one, ensuring the `lastUpdated` timestamp is updated accordingly.

#### 3.5 Validation Criteria

1. **Initial Search Results:** Verify that all resources returned in the initial search have a `lastUpdated` value less than t1.
2. **Resource Creation/Update:** Ensure the server successfully creates or updates the resource and returns the updated `lastUpdated` timestamp in the response.
3. **Subsequent Search Results:**
    * Verify that the newly created/updated resource is included in the results of the subsequent search.
    * Verify that all resources returned in the subsequent search have a `lastUpdated` value greater than t1 and less than t2.

#### 3.6 Test Automation

* The FHIR API calls (Search, Create/Update) can be automated.
* Timestamp management (t1, t2) can be automated.
* Validation of the `lastUpdated` values in the responses can be automated.

#### 3.7 Manual Inspection

* Review the CapabilityStatement to confirm the server advertises support for the `_lastUpdated` search parameter on the relevant resource.

This test specification provides a comprehensive approach to testing REQ-31, ensuring that clients can effectively track directory content updates using the `_lastUpdated` search parameter. 


---



<a id='server'></a>

## Server

<a id='req-01'></a>

### REQ-01: No PII requirement for directory queries

**Description**: "A conformant Plan-Net service SHALL NOT require a directory mobile application to send consumer identifying information in order to query content."

**Actor**: Server

**Conformance**: SHALL NOT

## Test Specification for REQ-01: No PII Requirement for Directory Queries

### 1. Requirement ID

REQ-01

### 2. Requirement Analysis

* **Testability Assessment:** Automatic
* **Complexity:** Simple
* **Prerequisites:**
    * A running instance of the Plan-Net FHIR server.
    * A test client capable of sending FHIR requests.
    * No specific user authentication or authorization should be required for directory queries.

### 3. Test Implementation Strategy

#### 3.1 Required Inputs and Expected Outputs

| Input                                 | Expected Output                                                                                                                                                                                              |
|--------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Directory query without PII (e.g., search for practitioners by specialty) | HTTP Status Code 200 (OK) <br> A valid FHIR Bundle resource containing matching resources. <br> **Crucially, the server MUST NOT require any form of patient identifier, name, or other PII in the request.** |

#### 3.2 Required FHIR Operations

* **Search Operation:**  The test will execute a search operation on the relevant FHIR resource type (e.g., Practitioner) using the appropriate search parameters defined by the Plan-Net implementation guide.

#### 3.3 Test Data Requirements

* **Test Data:** The test will use synthetic or de-identified data for the directory query. For example, a search for practitioners with a specific specialty code but without specifying any patient-related information.

#### 3.4 Validation Criteria

1. **HTTP Status Code:** The server MUST respond with an HTTP status code 200 (OK) to indicate a successful query.
2. **Response Content:** The server MUST return a valid FHIR Bundle resource containing the matching resources based on the provided search criteria.
3. **Absence of PII Requirement:** The server MUST NOT require any form of patient identifier, name, date of birth, address, or other sensitive information within the request parameters to successfully process the directory query. This validation can be done by inspecting the request sent by the test client. 

**Note:** This test specification focuses on the core requirement of not requiring PII for directory queries. Depending on the specific search parameters and functionalities offered by the Plan-Net service, additional test cases might be needed to ensure comprehensive coverage. 


---

<a id='req-03'></a>

### REQ-03: Population of Must Support data elements

**Description**: "Health Plan API actors SHALL be capable of populating all Must Support data elements as part of the query results."

**Actor**: Server

**Conformance**: SHALL

## Test Specification for REQ-03: Population of Must Support Data Elements

**1. Requirement ID:** REQ-03

**2. Requirement Analysis:**

   - **Testability Assessment:** Automatic 
   - **Complexity:** Moderate
   - **Prerequisites:**
     - A running FHIR server compliant with the Health Plan API implementation guide.
     - Access to the server's Capability Statement.
     - A list of all "Must Support" data elements defined in the Health Plan API implementation guide.
     - Test data representing resources relevant to the Health Plan API.

**3. Test Implementation Strategy:**

   **3.1. Required Inputs:**

     - FHIR Server Base URL
     - List of "Must Support" data elements and their corresponding resource types.

   **3.2. Expected Outputs:**

     - HTTP Status Code 200 (OK) for all successful resource retrievals.
     - FHIR Resources (in JSON or XML format) returned in response to search queries.

   **3.3. Required FHIR Operations:**

     - **read:**  Retrieve individual resources by ID.
     - **search:** Search for resources based on specified criteria.
     - **Capabilities Interaction:** Retrieve the server's Capability Statement to verify support for required operations and search parameters.

   **3.4. Test Data Requirements:**

     - Create or obtain a set of test data representing resources relevant to the Health Plan API (e.g., Patient, Coverage, Claim).
     - Ensure that the test data includes values for all "Must Support" data elements within their respective resource types.

   **3.5. Validation Criteria:**

     **3.5.1. Capability Statement Validation:**

       - Verify that the Capability Statement indicates support for the "read" and "search" interactions for all relevant resource types.
       - Confirm that the Capability Statement lists all required search parameters for each resource type, as defined in the implementation guide.

     **3.5.2. Data Population Validation:**

       - Execute a series of "read" and "search" operations to retrieve resources from the server.
       - For each retrieved resource:
         - Iterate through the list of "Must Support" data elements for that resource type.
         - Assert that each "Must Support" data element is present and populated with a value in the returned resource.
         - If a "Must Support" element is missing or empty, flag it as a test failure.

**4. Test Procedure:**

   1. Retrieve the server's Capability Statement.
   2. Validate the Capability Statement against the criteria outlined in Section 3.5.1.
   3. For each resource type relevant to the Health Plan API:
      - Prepare test data that includes values for all "Must Support" data elements for that resource type.
      - Execute "read" and "search" operations to retrieve resources from the server.
      - For each retrieved resource, validate the presence and population of "Must Support" data elements as described in Section 3.5.2.

**5. Reporting:**

   The test report should clearly indicate:

   - The FHIR server being tested.
   - The version of the Health Plan API implementation guide used.
   - The result of each test case (pass/fail).
   - For failed test cases, provide details about the missing or empty "Must Support" data elements. 


---

<a id='req-04'></a>

### REQ-04: Not including absent data elements

**Description**: "In situations where information on a particular Must Support data element is not present and the minimum cardinality is 0, the Health Plan API actors SHALL NOT include the data elements in the resource instance returned as part of the query results."

**Actor**: Server

**Conformance**: SHALL NOT

## Test Specification for REQ-04: Not Including Absent Data Elements

**1. Requirement ID:** REQ-04

**2. Requirement Analysis:**

   - **Testability Assessment:** Automatic
   - **Complexity:** Simple
   - **Prerequisites:** 
      - A running FHIR server that implements the Health Plan API.
      - The server's Capability Statement must indicate support for the specific FHIR resources and search parameters used in the test.
      - Test data pre-populated in the FHIR server, including resources with both present and absent "Must Support" data elements with minimum cardinality of 0.

**3. Test Implementation Strategy:**

   **3.1. Required Inputs:**

   - **Resource Type:** The specific FHIR resource type to be tested (e.g., Patient, Observation).
   - **Must Support Data Element:** The specific data element within the resource that is marked as "Must Support" and has a minimum cardinality of 0.

   **3.2. Expected Outputs:**

   - **HTTP Status Code:** 200 (OK)
   - **FHIR Bundle:** A Bundle resource containing the search results.
   - **Absent Data Element:** The returned resources in the Bundle MUST NOT contain the specified "Must Support" data element if it is not present in the underlying data.

   **3.3. Required FHIR Operations:**

   - **Search:** A search operation will be performed on the specified FHIR resource type using appropriate search parameters to retrieve resources that may or may not contain the "Must Support" data element. 

   **3.4. Test Data Requirements:**

   - The test data should include a mix of resources:
      - Resources where the "Must Support" data element is present.
      - Resources where the "Must Support" data element is absent.

   **3.5. Validation Criteria:**

   1. **Response Validation:**
      - Verify that the HTTP status code of the search response is 200 (OK).
      - Verify that the response Content-Type is `application/fhir+json`.
   2. **Resource Validation:**
      - Parse the returned FHIR Bundle resource.
      - For each resource in the Bundle:
         - **If** the "Must Support" data element is present in the underlying data, **then** it SHOULD be present in the returned resource.
         - **If** the "Must Support" data element is absent in the underlying data, **then** it MUST NOT be present in the returned resource. 

**Example Test Case:**

Let's assume we are testing the `Observation` resource and the "Must Support" data element is `Observation.interpretation`.

1. **Send a search request:**
   ```
   GET [base]/Observation?patient=[patient-id]
   ```
2. **Validate the response:**
   - Check for HTTP status code 200.
   - Parse the Bundle and iterate through each returned `Observation` resource.
   - For each `Observation`:
     - If `Observation.interpretation` is absent in the underlying data, assert that the `interpretation` element is NOT present in the returned resource.

This test specification provides a structured approach to automatically test the requirement REQ-04. By using appropriate test data and validation criteria, we can ensure that the Health Plan API server correctly handles absent "Must Support" data elements. 


---

<a id='req-05'></a>

### REQ-05: Using dataAbsentReason for missing required information

**Description**: "In situations where information on a particular data element is not present and the minimum cardinality is >0, SHALL send the reason for the missing information using values (such as nullFlavors) from the value set where they exist or use the dataAbsentReason extension."

**Actor**: Server

**Conformance**: SHALL

## Test Specification for REQ-05: Using dataAbsentReason for Missing Required Information

**1. Requirement ID:** REQ-05

**2. Requirement Analysis:**

   - **Testability Assessment:** Automatic
   - **Complexity:** Moderate
   - **Prerequisites:** 
      - A FHIR server compliant with the implementation guide.
      - Access to create and retrieve resources relevant to the requirement.
      - Knowledge of resources and data elements with minimum cardinality > 0 within the implementation guide's scope.

**3. Test Implementation Strategy:**

   **3.1. Test Case 1: Valid dataAbsentReason Code**

      - **Description:** Verify the server correctly processes a resource where a required element is missing, and a valid `dataAbsentReason` extension is provided.

      - **Required Inputs:**
         - **Resource Type:**  (Specify the resource type relevant to the test, e.g., Patient, Observation)
         - **Request Method:** POST (Create)
         - **Request Body:** A FHIR resource instance with a required element missing. The missing element should have the `dataAbsentReason` extension with a valid code from a value set defined in the implementation guide (or the generic "unknown" code if no specific value set is provided).

      - **Expected Outputs:**
         - **HTTP Status Code:** 201 (Created) or 200 (OK) depending on the server's implementation.
         - **Response Body:** The created/updated resource, potentially containing an `OperationOutcome` with informational messages.

      - **Validation Criteria:**
         - Assert that the server successfully processes the request without errors.
         - Optionally, verify the presence and content of any `OperationOutcome` messages to confirm the server acknowledged the missing data and the provided reason.

   **3.2. Test Case 2: Invalid dataAbsentReason Code**

      - **Description:** Verify the server correctly handles a resource where a required element is missing, and an invalid `dataAbsentReason` code is provided.

      - **Required Inputs:**
         - **Resource Type:** (Same as Test Case 1)
         - **Request Method:** POST (Create)
         - **Request Body:** A FHIR resource instance with a required element missing. The missing element should have the `dataAbsentReason` extension with an **invalid** code (not from the specified value set or "unknown").

      - **Expected Outputs:**
         - **HTTP Status Code:** 400 (Bad Request) or similar error code.
         - **Response Body:** An `OperationOutcome` resource detailing the error, specifically mentioning the invalid `dataAbsentReason` code.

      - **Validation Criteria:**
         - Assert that the server rejects the request with an appropriate error code.
         - Verify the `OperationOutcome` resource contains a clear message indicating the invalid `dataAbsentReason` code.

   **3.3. Test Case 3: Missing dataAbsentReason**

      - **Description:** Verify the server correctly handles a resource where a required element is missing, and no `dataAbsentReason` is provided.

      - **Required Inputs:**
         - **Resource Type:** (Same as Test Case 1)
         - **Request Method:** POST (Create)
         - **Request Body:** A FHIR resource instance with a required element missing **without** any `dataAbsentReason` extension.

      - **Expected Outputs:**
         - **HTTP Status Code:** 400 (Bad Request) or similar error code.
         - **Response Body:** An `OperationOutcome` resource detailing the error, specifically mentioning the missing required element.

      - **Validation Criteria:**
         - Assert that the server rejects the request with an appropriate error code.
         - Verify the `OperationOutcome` resource contains a clear message indicating the missing required element.

**4. Test Data Requirements:**

   - Test data should include instances of resources relevant to the implementation guide, focusing on elements with minimum cardinality > 0.
   - Utilize valid and invalid `dataAbsentReason` codes based on the value sets defined in the implementation guide.

**5. Additional Notes:**

   - These test cases provide a starting point and can be further expanded to cover different scenarios and edge cases.
   - Consider using a testing framework like FHIR Validator or Inferno to automate the execution and validation of these tests. 
   - Ensure alignment with the specific resources and data elements within the scope of the implementation guide. 


---

<a id='req-10'></a>

### REQ-10: JSON format support

**Description**: "Support json source formats for all Plan-Net interactions."

**Actor**: Server

**Conformance**: SHALL

## Test Specification for REQ-10: JSON Format Support

### 1. Requirement ID

REQ-10

### 2. Requirement Analysis

- **Testability Assessment**: Automatic
- **Complexity**: Simple
- **Prerequisites**:
    - A running FHIR server that implements the Plan-Net interactions.
    - Test client capable of sending requests with JSON body and interpreting JSON responses. 

### 3. Test Implementation Strategy

#### 3.1 Required Inputs and Expected Outputs

| Input                                     | Expected Output                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               

---

<a id='req-11'></a>

### REQ-11: RESTful behavior implementation

**Description**: "Implement the RESTful behavior according to the FHIR specification."

**Actor**: Server

**Conformance**: SHALL

## Test Specification for REQ-11: RESTful Behavior Implementation

**1. Requirement ID:** REQ-11

**2. Requirement Analysis:**

   - **Testability Assessment:**  Hybrid (Combination of automated checks and manual inspection)
   - **Complexity:** Moderate
   - **Prerequisites:** 
      - A running FHIR server that implements the target FHIR specification.
      - Access to the server's Capability Statement.
      - A testing tool capable of making FHIR API calls (e.g., Postman, Insomnia, custom test scripts).

**3. Test Implementation Strategy:**

   **3.1. Test Case 1: Verify HTTP Verb Support for Resources**

      - **Objective:** Ensure the server correctly supports the HTTP verbs (GET, POST, PUT, DELETE) for resources declared in its Capability Statement. 
      - **Required Inputs:**
          - Resource type to test (e.g., Patient, Observation).
          - Valid FHIR resource instance for testing POST/PUT.
      - **Expected Outputs:**
          - Appropriate HTTP status codes based on the operation and resource state:
              - `200 OK` for successful GET, PUT (update), and DELETE.
              - `201 Created` for successful POST (create).
              - `404 Not Found` for requests on non-existent resources.
              - `405 Method Not Allowed` for unsupported HTTP verbs on a resource.
      - **Required FHIR Operations:**
          - GET /[resource type]
          - POST /[resource type]
          - PUT /[resource type]/[id]
          - DELETE /[resource type]/[id]
      - **Test Data Requirements:**
          - Use a mix of existing resources and newly created resources for testing.
      - **Validation Criteria:**
          - Verify the returned HTTP status code aligns with the FHIR specification for the performed operation.
          - For successful operations (200, 201), validate the response body content and format as per FHIR standards.

   **3.2. Test Case 2: Verify HTTP Headers and Content Negotiation**

      - **Objective:** Confirm the server correctly handles HTTP headers related to content negotiation and standard headers.
      - **Required Inputs:**
          - Various `Accept` header values (e.g., `application/fhir+json`, `application/fhir+xml`).
          - `Content-Type` header for POST/PUT requests.
      - **Expected Outputs:**
          - Responses with content type matching the `Accept` header request.
          - Appropriate handling of missing or invalid `Accept` headers (e.g., returning a default format or an error).
          - Correct use of standard headers like `ETag`, `Last-Modified`, `Location` (for newly created resources).
      - **Required FHIR Operations:**
          - Any FHIR operation (GET, POST, PUT, DELETE) can be used.
      - **Test Data Requirements:**
          - N/A
      - **Validation Criteria:**
          - Verify the `Content-Type` of the response matches the requested `Accept` header.
          - Check for the presence and correctness of standard headers based on the FHIR specification.

   **3.3. Test Case 3: Manual Inspection of RESTful Constraints**

      - **Objective:** Review the server's implementation for adherence to general RESTful principles.
      - **Required Inputs:**
          - Server documentation (if available).
          - Access to server logs or debugging tools (optional).
      - **Expected Outputs:**
          - Evidence of stateless interactions (each request is independent).
          - Proper use of HTTP status codes to indicate request outcomes.
          - Consistent and meaningful use of resource URLs.
          - No use of custom HTTP verbs beyond the standard FHIR verbs.
      - **Required FHIR Operations:**
          - N/A (this is an inspection of overall behavior)
      - **Test Data Requirements:**
          - N/A
      - **Validation Criteria:**
          - Manual review of server behavior and documentation to confirm alignment with REST principles.

**Note:** This test specification provides a starting point. You may need to add more test cases or modify existing ones based on the specific FHIR resources and interactions supported by the server under test, as indicated in its Capability Statement. 


---

<a id='req-12'></a>

### REQ-12: Support for all Implementation Guide profiles

**Description**: "Support all profiles defined in this Implementation Guide."

**Actor**: Server

**Conformance**: SHALL

## Test Specification for REQ-12: Support for all Implementation Guide profiles

### 1. Requirement ID

REQ-12

### 2. Requirement Analysis

**Testability Assessment:** Hybrid (Combination of Automated and Manual)

**Complexity:** Moderate

**Prerequisites:**

* A running FHIR server that implements the Implementation Guide.
* Access to the Capability Statement of the FHIR server.
* A list of all profiles defined in the Implementation Guide.
* Test data conforming to each profile defined in the Implementation Guide.

### 3. Test Implementation Strategy

#### 3.1 Required Inputs and Expected Outputs

**Inputs:**

* FHIR Server endpoint URL
* Capability Statement of the FHIR server
* List of profiles defined in the Implementation Guide
* Test data conforming to each profile

**Expected Outputs:**

* Successful HTTP status codes (e.g., 200, 201) for all supported operations on resources with the defined profiles.
* Successful validation of resources against their respective profiles.

#### 3.2 Required FHIR Operations

* **READ (`GET`)**: Retrieve resources with the defined profiles.
* **CREATE (`POST`)**: Create new resources conforming to the defined profiles.
* **UPDATE (`PUT`)**: Update existing resources conforming to the defined profiles.
* **VALIDATE (`POST` to `$validate` operation)**: Validate resources against their respective profiles.

**Note:**  The specific FHIR operations supported for each profile should be determined from the Implementation Guide and verified against the server's Capability Statement.

#### 3.3 Test Data Requirements

* **Positive Test Data:**  Valid resources conforming to each profile defined in the Implementation Guide. This data will be used to test successful creation, retrieval, and update operations.
* **Negative Test Data:** Invalid resources that violate constraints defined in the profiles. This data will be used to test the server's ability to reject invalid data.

#### 3.4 Validation Criteria

1. **Capability Statement Conformance:**
    * Verify that the Capability Statement advertises support for all the resources and operations required by the profiles defined in the Implementation Guide.
    * Check if the `profile` element within the corresponding resource definition in the Capability Statement includes all the required profiles.

2. **Resource Instance Validation:**
    * **Positive Test Cases:** All resources created or updated with valid data should return a successful HTTP status code (e.g., 200, 201) and pass validation against their respective profiles.
    * **Negative Test Cases:** All resources created or updated with invalid data should return an appropriate error code (e.g., 400 Bad Request) and fail validation against their respective profiles, providing specific error messages.

3. **Operation Support:**
    * Verify that all required FHIR operations (READ, CREATE, UPDATE, VALIDATE) are supported for each profile as defined in the Implementation Guide.

**Test Execution:**

This test can be partially automated using testing tools that can:

* Parse the Capability Statement and verify the declared support for resources and profiles.
* Execute FHIR API calls with test data and validate the HTTP response codes.
* Validate resources against their respective profiles using a FHIR validator.

Manual inspection might be required to:

* Analyze error messages for invalid data and ensure they are informative and accurate.
* Verify the completeness and correctness of the Capability Statement in relation to the Implementation Guide requirements. 


---

<a id='req-13'></a>

### REQ-13: Unauthorized request response

**Description**: "Return the following response classes: (Status 401/4xx): unauthorized request."

**Actor**: Server

**Conformance**: SHALL

## Test Specification for REQ-13: Unauthorized Request Response

**1. Requirement ID:** REQ-13

**2. Requirement Analysis:**

   - **Testability Assessment:** Automatic
   - **Complexity:** Simple
   - **Prerequisites:** 
     - A running FHIR server that implements the relevant resources and operations.
     - A test client capable of making authenticated and unauthenticated FHIR API requests.

**3. Test Implementation Strategy:**

   **3.1. Test Case 1: Unauthorized Access to Protected Resource**

     - **Test Objective:** Verify that the server returns a 401 Unauthorized response when an unauthenticated request is made for a protected resource.

     - **Required Inputs:**
       - **Request Type:** GET, POST, PUT, DELETE (any operation requiring authorization)
       - **Resource:** Any protected resource on the server (e.g., Patient, Observation)
       - **Authentication:** None (simulate an unauthenticated request)

     - **Expected Outputs:**
       - **HTTP Status Code:** 401 Unauthorized
       - **FHIR OperationOutcome Resource:** (Optional) The server MAY return an OperationOutcome resource providing more details about the authorization failure.

     - **Required FHIR Operations:**
       - Any operation on the chosen protected resource (GET, POST, PUT, DELETE) as supported by the Capability Statement.

     - **Test Data Requirements:**
       - No specific test data is required for this test case.

     - **Validation Criteria:**
       - **Assert:** The HTTP status code of the response is 401 (Unauthorized).
       - **Assert (Optional):** If an OperationOutcome resource is returned, verify its content for relevant error codes and messages related to unauthorized access.

   **3.2. Test Case 2: Unauthorized Access with Invalid Credentials**

     - **Test Objective:** Verify that the server returns a 401 Unauthorized response when a request is made with invalid credentials.

     - **Required Inputs:**
       - **Request Type:** GET, POST, PUT, DELETE (any operation requiring authorization)
       - **Resource:** Any protected resource on the server
       - **Authentication:** Provide invalid credentials (e.g., incorrect username/password, expired token)

     - **Expected Outputs:**
       - **HTTP Status Code:** 401 Unauthorized
       - **FHIR OperationOutcome Resource:** (Optional) The server MAY return an OperationOutcome resource providing more details about the authorization failure.

     - **Required FHIR Operations:**
       - Any operation on the chosen protected resource as supported by the Capability Statement.

     - **Test Data Requirements:**
       - No specific test data is required for this test case.

     - **Validation Criteria:**
       - **Assert:** The HTTP status code of the response is 401 (Unauthorized).
       - **Assert (Optional):** If an OperationOutcome resource is returned, verify its content for relevant error codes and messages related to invalid credentials. 

**Note:** 

- These test cases assume the server uses standard HTTP authentication mechanisms. 
- The specific error codes and messages within the OperationOutcome resource (if returned) may vary depending on the server's implementation. 
- Refer to the FHIR specification and the server's documentation for details on expected error handling and OperationOutcome content. 


---

<a id='req-14'></a>

### REQ-14: Insufficient scope response

**Description**: "Return the following response classes: (Status 403): insufficient scope."

**Actor**: Server

**Conformance**: SHALL

## Test Specification for REQ-14: Insufficient Scope Response

**1. Requirement ID:** REQ-14

**2. Requirement Analysis:**

   - **Testability Assessment:** Automatic
   - **Complexity:** Simple
   - **Prerequisites:** 
     - A running FHIR server that implements the relevant resources and operations.
     - A test client capable of making authenticated FHIR API requests with insufficient scopes.

**3. Test Implementation Strategy:**

   **3.1. Test Case 1: Insufficient Scope on Resource Access**

      - **Description:**  Attempt to access a protected resource with a token that has insufficient scopes.
      - **Required Inputs:**
          - Valid access token with insufficient scopes for the requested resource.
          - FHIR resource endpoint (e.g., `Patient/123`).
      - **Expected Outputs:**
          - HTTP Status Code: 403 Forbidden
          - FHIR OperationOutcome:
              - `OperationOutcome.issue.code`: security
              - `OperationOutcome.issue.severity`: error
              - `OperationOutcome.issue.details.text`: "Insufficient scope" (or a similar message indicating insufficient privileges).
      - **Required FHIR Operations:**  
          - GET (or other relevant operation based on the protected resource)
      - **Test Data Requirements:** 
          - N/A (using existing resource on the server)
      - **Validation Criteria:**
          - Verify the HTTP status code is 403 Forbidden.
          - Verify the response body contains a valid FHIR OperationOutcome resource.
          - Verify the OperationOutcome resource contains the expected error codes and message indicating insufficient scope.

   **3.2. Test Case 2: Insufficient Scope on Specific Operation**

      - **Description:** Attempt to perform an operation (e.g., create, update, delete) on a resource with a token that has insufficient scopes for that specific operation. 
      - **Required Inputs:**
          - Valid access token with insufficient scopes for the requested operation.
          - FHIR resource endpoint (e.g., `Patient`).
          - Request body (if applicable for the operation, e.g., a new Patient resource for a create operation).
      - **Expected Outputs:**
          - HTTP Status Code: 403 Forbidden
          - FHIR OperationOutcome:
              - `OperationOutcome.issue.code`: security
              - `OperationOutcome.issue.severity`: error
              - `OperationOutcome.issue.details.text`: "Insufficient scope" (or a similar message indicating insufficient privileges).
      - **Required FHIR Operations:**  
          - POST, PUT, DELETE (or other relevant operation based on the protected resource and the test case)
      - **Test Data Requirements:** 
          - Potentially a new resource instance to be used in the request body, depending on the operation being tested.
      - **Validation Criteria:**
          - Verify the HTTP status code is 403 Forbidden.
          - Verify the response body contains a valid FHIR OperationOutcome resource.
          - Verify the OperationOutcome resource contains the expected error codes and message indicating insufficient scope.

**Note:** 

- These test cases are examples, and you may need to create additional test cases depending on the specific resources and operations your FHIR server supports and the different scope levels you have defined.
- The Capability Statement should be consulted to determine which operations are supported for each resource and to ensure the test cases are valid. 
- Automated testing tools can be used to streamline the execution and validation of these test cases. 


---

<a id='req-15'></a>

### REQ-15: Invalid parameter response

**Description**: "Return the following response classes: (Status 400): invalid parameter."

**Actor**: Server

**Conformance**: SHALL

## Test Specification for REQ-15: Invalid Parameter Response

**1. Requirement ID:** REQ-15

**2. Requirement Analysis:**

   - **Testability Assessment:** Automatic
   - **Complexity:** Simple
   - **Prerequisites:**
     - A running FHIR server that implements the relevant resources and operations.
     - Capability Statement confirming support for the tested FHIR operation.

**3. Test Implementation Strategy:**

   **3.1. Test Case 1: Invalid Parameter Value**

     - **Description:** Send a valid FHIR operation request with an invalid value for a required parameter.
     - **Required Inputs:**
       - **FHIR Operation:**  (Specify the specific FHIR operation to be tested, e.g., `GET /Patient?name=123`)
       - **Invalid Parameter:**  (Specify the parameter and the invalid value used, e.g., `name` parameter with value `123`)
     - **Expected Outputs:**
       - **HTTP Status Code:** 400 (Bad Request)
       - **FHIR OperationOutcome Resource:**
         - `OperationOutcome.issue.severity`:  "error"
         - `OperationOutcome.issue.code`: "invalid"
         - `OperationOutcome.issue.diagnostics`: A human-readable explanation of the error, indicating the invalid parameter and reason for invalidity.
     - **Validation Criteria:**
       - Verify the HTTP status code is 400.
       - Verify the response body contains a valid FHIR OperationOutcome resource.
       - Verify the OperationOutcome resource contains an "error" severity issue with "invalid" code and a descriptive diagnostic message.

   **3.2. Test Case 2: Missing Required Parameter**

     - **Description:** Send a valid FHIR operation request with a required parameter missing.
     - **Required Inputs:**
       - **FHIR Operation:** (Specify the specific FHIR operation to be tested, e.g., `POST /Patient`)
       - **Missing Parameter:** (Specify the required parameter that will be omitted from the request, e.g., `name` in a `POST /Patient` request)
     - **Expected Outputs:**
       - **HTTP Status Code:** 400 (Bad Request)
       - **FHIR OperationOutcome Resource:**
         - `OperationOutcome.issue.severity`:  "error"
         - `OperationOutcome.issue.code`: "required" 
         - `OperationOutcome.issue.diagnostics`: A human-readable explanation of the error, indicating the missing required parameter.
     - **Validation Criteria:**
       - Verify the HTTP status code is 400.
       - Verify the response body contains a valid FHIR OperationOutcome resource.
       - Verify the OperationOutcome resource contains an "error" severity issue with "required" code and a descriptive diagnostic message.

   **3.3. Test Data Requirements:**

     - The specific test data will depend on the FHIR resource and operation being tested. 
     - Use realistic data that aligns with the Implementation Guide's requirements and any applicable profiles.

   **3.4.  Additional Notes:**

     - The Capability Statement should be consulted to identify the supported operations and parameters for the resource being tested.
     - These test cases can be automated using testing frameworks like Jest, Mocha, or pytest with FHIR client libraries. 
     - Consider adding more test cases to cover different invalid parameter scenarios and data types as needed. 


---

<a id='req-16'></a>

### REQ-16: Unknown resource response

**Description**: "Return the following response classes: (Status 404): unknown resource."

**Actor**: Server

**Conformance**: SHALL

## Test Specification

### 1. Requirement ID

REQ-16: Unknown resource response

### 2. Requirement Analysis

- **Testability Assessment:** Automatic
- **Complexity:** Simple
- **Prerequisites:** 
    - A running FHIR server conformant to the given implementation guide.
    - The Capability Statement of the FHIR server should indicate it does **not** support the resource being tested. This is implicit in the requirement, as we are testing for an unknown resource. 

### 3. Test Implementation Strategy

#### 3.1. Inputs and Expected Outputs

| Input                                  | Expected Output                               |
|---------------------------------------|-----------------------------------------------|
| HTTP Request to an unknown resource | HTTP Response with Status Code 404 (Not Found) |

#### 3.2. Required FHIR Operations

- HTTP GET request to a resource URL that is not defined in the FHIR specification or the implementation guide. 
    - Example: `/fhir/MyCustomResource`

#### 3.3. Test Data Requirements

- No specific test data is required for this test case. The focus is on the server's response to an unknown resource type.

#### 3.4. Validation Criteria

- **Status Code:** The HTTP response status code should be **404 (Not Found)**.
- **Response Body:** The response body can optionally include an `OperationOutcome` resource with details about the error, but this is not mandatory for this requirement. 

**Example using Python and the `requests` library:**

```python
import requests

base_url = "https://your-fhir-server/fhir"
unknown_resource_url = f"{base_url}/MyCustomResource"

response = requests.get(unknown_resource_url)

assert response.status_code == 404, f"Expected 404 Not Found, got {response.status_code}"

print("Test Passed: Server returned 404 Not Found for unknown resource.")
```

**Note:** This test specification focuses on the core requirement of returning a 404 status code for an unknown resource. Depending on the implementation guide's specific error handling guidelines, additional validation criteria might be necessary, such as checking for specific content in the response body or headers. 


---

<a id='req-17'></a>

### REQ-17: Deleted resource response

**Description**: "Return the following response classes: (Status 410): deleted resource."

**Actor**: Server

**Conformance**: SHALL

## Test Specification for REQ-17: Deleted Resource Response

### 1. Requirement ID

REQ-17

### 2. Requirement Analysis

* **Testability Assessment:** Automatic
* **Complexity:** Simple
* **Prerequisites:**
    * A FHIR server instance is running and accessible.
    * The server has resources that can be created and deleted.
    * The Capability Statement for the server indicates support for the `delete` interaction on the relevant resource type.

### 3. Test Implementation Strategy

#### 3.1. Required Inputs and Expected Outputs

| Input                                      | Expected Output                               |
|-------------------------------------------|-----------------------------------------------|
| DELETE request to a previously existing resource URL | HTTP Status Code 410 (Gone)                  |
|                                           | `OperationOutcome` resource with appropriate message indicating the resource was deleted |

#### 3.2. Required FHIR Operations

* **CREATE:**  A resource needs to be created first to be subsequently deleted.
* **DELETE:**  The primary operation under test, targeting the created resource's URL.

#### 3.3. Test Data Requirements

* **Resource Type:** Any resource type supported by the server that allows create and delete operations (as indicated in the Capability Statement).
* **Resource Data:**  Valid FHIR resource instance conforming to the chosen resource type's profile (if applicable).

#### 3.4. Validation Criteria

1. **HTTP Status Code:** Verify the response status code is **410 (Gone)**.
2. **Response Body:** Verify the response body contains an `OperationOutcome` resource.
3. **OperationOutcome Content:**  Verify the `OperationOutcome` resource:
    * Has a `severity` of "information".
    * Contains a human-readable `issue.diagnostics` message indicating the resource was deleted. 

**Example Test Scenario (using pseudocode):**

```
// 1. Create a resource
createResponse = client.create(resourceData)
assert createResponse.status_code == 201

// 2. Extract the resource URL from the create response
resourceURL = createResponse.headers.location

// 3. Delete the resource
deleteResponse = client.delete(resourceURL)

// 4. Assertions
assert deleteResponse.status_code == 410
assert deleteResponse.resourceType == 'OperationOutcome'
assert deleteResponse.severity == 'information'
assert "deleted" in deleteResponse.issue.diagnostics // Check for relevant message
``` 


---

<a id='req-18'></a>

### REQ-18: Profile identification in meta attribute

**Description**: "Identify the Plan-Net profiles supported as part of the FHIR meta.profile attribute for each instance."

**Actor**: Server

**Conformance**: SHALL

## Test Specification for REQ-18: Profile Identification in Meta Attribute

### 1. Requirement ID

REQ-18

### 2. Requirement Analysis

**Testability Assessment:** Automatic

**Complexity:** Simple

**Prerequisites:** 

* A running FHIR server that implements the target Implementation Guide.
* Access to the server's Capability Statement.

### 3. Test Implementation Strategy

**Test Case 1: Verify Plan-Net Profile in Meta Attribute**

**Objective:** Ensure that resources conforming to the Plan-Net profile declare the profile URL in the `meta.profile` attribute.

**Required Inputs:**

* None (The test will target resources known to be associated with the Plan-Net profile based on the Capability Statement).

**Expected Outputs:**

* HTTP Status Code: 200 OK
* Response Body: A FHIR resource conforming to the Plan-Net profile.

**Required FHIR Operations:**

* **read:**  Used to retrieve a resource instance. The specific resource type will depend on the resources identified in the Capability Statement as supporting the Plan-Net profile. 

**Test Data Requirements:**

* No specific test data is required. The test will utilize existing resources on the server.

**Validation Criteria:**

1. **Profile Declaration:** Verify that the returned resource includes the Plan-Net profile URL in the `meta.profile` array. 
   - **Assertion:** The `meta.profile` array MUST contain the URL of the Plan-Net profile as defined in the Implementation Guide.

**Example using pseudo-code:**

```
# Retrieve a resource instance known to use the Plan-Net profile (e.g., a CarePlan)
response = fhir_client.read('CarePlan', '<resource_id>')

# Assert 200 OK status code
assert response.status_code == 200

# Parse the response body
resource = response.json()

# Assert that the Plan-Net profile URL is present in meta.profile
assert 'http://hl7.org/fhir/us/plan-net/StructureDefinition/<profile-name>' in resource['meta']['profile'] 
```

**Notes:**

* This test specification provides a general framework. 
* The specific resource type, profile URL, and FHIR operations used in the test case will need to be adapted based on the information provided in the Capability Statement for the target implementation. 
* Multiple test cases may be necessary to cover all resource types that implement the Plan-Net profile. 


---

<a id='req-19'></a>

### REQ-19: Individual search parameter support

**Description**: "Support the searchParameters on each profile individually."

**Actor**: Server

**Conformance**: SHALL

## Test Specification for REQ-19: Individual Search Parameter Support

### 1. Requirement ID

REQ-19

### 2. Requirement Analysis

#### Testability Assessment: 
- **Automatic**:  This requirement can be largely automated.  We can programmatically construct and execute searches against each profile's defined search parameters.

#### Complexity: 
- **Moderate**: While the core concept is straightforward, testing across multiple profiles and potentially numerous search parameters adds complexity.

#### Prerequisites:
- **FHIR Server**: A running FHIR server that implements the target Implementation Guide.
- **Capability Statement**: Access to the server's Capability Statement to determine supported search parameters for each profile.
- **Test Data**: A populated FHIR server or the ability to create test resources conforming to the profiles under test.

### 3. Test Implementation Strategy

#### Required Inputs:
- **Base URL**: The base URL of the FHIR server.
- **List of Profiles**:  The specific FHIR profiles to be tested.

#### Expected Outputs:
- **HTTP Status Codes**: Primarily "200 OK" indicating successful searches.  Potentially "400 Bad Request" if an unsupported search parameter is used, which would signal a test failure.
- **Search Responses**:  FHIR Bundles containing resources matching the search criteria.

#### Required FHIR Operations:
- **Read (GET) on CapabilityStatement**: To retrieve the server's capabilities and identify supported search parameters for each profile.
- **Search (GET) on Resources**: To execute searches using the defined search parameters for each profile.

#### Test Data Requirements:
- **Representative Resources**:  The test data should include a variety of resources conforming to the profiles being tested. These resources should have diverse values for the searchable properties to ensure comprehensive coverage.

#### Validation Criteria:

1. **Capability Statement Validation**:
   - Verify that the Capability Statement advertises support for the expected search parameters for each profile defined in the Implementation Guide.

2. **Search Functionality**:
   - For each profile:
     - Iterate through the profile's defined search parameters.
     - Construct valid search URLs using each parameter.
     - Execute the search requests against the server.
     - **Assert**: The server returns an HTTP status code of 200 OK for supported search parameters.
     - **Assert**: The returned Bundle resources match the search criteria used in the request.

3. **Unsupported Search Parameter Handling (Negative Testing):**
   - Construct search URLs using parameters *not* defined for a specific profile.
   - **Assert**: The server returns an appropriate error response (e.g., HTTP status code 400 Bad Request) indicating that the search parameter is not supported for the given resource type. 


---

<a id='req-20'></a>

### REQ-20: Combination search parameter support

**Description**: "Support the searchParameters on each profile in combination."

**Actor**: Server

**Conformance**: SHALL

## Test Specification for REQ-20: Combination Search Parameter Support

### 1. Requirement ID

REQ-20

### 2. Requirement Analysis

* **Testability Assessment:** Automatic
* **Complexity:** Moderate
* **Prerequisites:**
    * A running FHIR server that implements the target Implementation Guide.
    * Access to the server's Capability Statement.
    * Test data available for resources and search parameters mentioned in the Implementation Guide profiles.

### 3. Test Implementation Strategy

This test specification focuses on automatically verifying combination search parameter support. It leverages the information provided in the Implementation Guide and the server's Capability Statement.

#### 3.1 Required Inputs

* **Implementation Guide:** The FHIR Implementation Guide containing REQ-20.
* **Capability Statement:** The Capability Statement of the FHIR server under test.

#### 3.2 Expected Outputs

* **Test Result:** Pass/Fail for each combination of search parameters tested.
* **Detailed Report:**  Listing each tested combination, the search URL used, and the outcome (success/failure reason).

#### 3.3 Required FHIR Operations

* **read (GET):** To retrieve the Capability Statement.
* **search (GET):** To execute searches using combinations of search parameters.

#### 3.4 Test Data Requirements

* **Resource Instances:**  A set of resources conforming to the profiles defined in the Implementation Guide. These resources should contain diverse data to enable testing various search parameter combinations.

#### 3.5 Validation Criteria

1. **Capability Statement Validation:**
   - Verify that the Capability Statement advertises support for all search parameters mentioned in the Implementation Guide profiles.
   - Ensure the `type` of each search parameter in the Capability Statement aligns with the Implementation Guide's expectations.

2. **Combination Search Parameter Testing:**
   - For each resource profile in the Implementation Guide:
     - Identify all possible combinations of two search parameters defined for that profile.
     - Construct a search URL using each combination. For example:
       ```
       GET [base]/[resourceType]?param1=[value1]&param2=[value2]
       ```
     - Execute the search against the server.
     - **Pass:** The server returns a successful response (HTTP status code 200) with results matching the combined search criteria.
     - **Fail:** 
       - The server returns an error response (e.g., HTTP status code 400 - Bad Request) indicating it doesn't support the combination.
       - The server returns a successful response, but the results do not accurately reflect the combined search criteria.

3. **Edge Case Testing:**
   - Include tests for combinations involving:
     - Search parameters with different data types (e.g., string, date, token).
     - Search parameters with modifiers (e.g., `:missing`, `:above`, `:below`).

#### 3.6 Test Automation Considerations

This test can be automated using testing frameworks like Jest, Mocha, or pytest along with FHIR client libraries. The automation script should:

1. Parse the Implementation Guide and Capability Statement.
2. Generate test cases for all identified search parameter combinations.
3. Execute the tests and log the results.
4. Provide a summary report indicating the overall pass/fail status and details of any failures. 


---

<a id='req-21'></a>

### REQ-21: Forward chaining support

**Description**: "Support forward chaining on all search parameters that specify the 'chain' property."

**Actor**: Server

**Conformance**: SHALL

## Test Specification for REQ-21: Forward Chaining Support

### 1. Requirement ID

REQ-21

### 2. Requirement Analysis

- **Testability Assessment:** Automatic
- **Complexity:** Moderate
- **Prerequisites:** 
    - A running FHIR server that conforms to the implementation guide.
    - At least one resource type with search parameters that define the 'chain' property in the implementation guide.
    - Test data populated on the server, including resources that are linked and should be discoverable through forward chaining.

### 3. Test Implementation Strategy

#### 3.1 Required Inputs and Expected Outputs

| Input | Expected Output |
|---|---|
| A search request using a search parameter with the 'chain' property defined. | A bundle of resources that includes both the resources matching the initial search parameter and the resources found by following the chain defined in the 'chain' property. |

#### 3.2 Required FHIR Operations

- **Search Type:** `GET [base]/[resource type]?parameter=[value]`
    - This operation is assumed to be supported based on the requirement targeting search parameters.

#### 3.3 Test Data Requirements

- **Resource Types:** At least two resource types with a defined relationship (e.g., Patient and Observation, where Observation references Patient).
- **Search Parameter with 'chain' Property:** At least one search parameter on one of the resource types must have the 'chain' property defined, specifying the path to the related resource (e.g., Observation.subject.reference chain to Patient).
- **Data Population:** 
    - Multiple instances of the related resources should be created.
    - Some resources should be linked through the defined relationship to enable forward chaining.

#### 3.4 Validation Criteria

1. **Response Status Code:** The server should respond with a `200 OK` status code, indicating a successful search operation.
2. **Resource Bundle:** The response should be a Bundle resource with type 'searchset'.
3. **Forward Chaining Results:** The Bundle should contain:
    - Resources that directly match the search parameter value.
    - Resources that are found by following the 'chain' property from the initial matching resources.
4. **Resource Content:** Verify that the returned resources are correct and match the expected relationships defined by the 'chain' property.

**Example:**

If searching for Observations with a specific `value-quantity` and the 'chain' property on `Observation.subject` is set to `Patient`, the response should include:

- All Observations matching the `value-quantity`.
- All Patient resources referenced by the matching Observations through the `subject` field. 


---

<a id='req-22'></a>

### REQ-22: Reverse chaining support

**Description**: "Support reverse chaining on all search parameters that specify the 'chain' property."

**Actor**: Server

**Conformance**: SHALL

## Test Specification for REQ-22: Reverse Chaining Support

**1. Requirement ID:** REQ-22

**2. Requirement Analysis:**

   - **Testability Assessment:** Automatic
   - **Complexity:** Moderate
   - **Prerequisites:**
     - A running FHIR server that conforms to the implementation guide.
     - Access to the server's CapabilityStatement.
     - Test data containing resources with chained search parameters.

**3. Test Implementation Strategy:**

   **3.1. Required Inputs:**

     - FHIR Server Base URL
     - List of resources and search parameters supporting reverse chaining (extracted from the CapabilityStatement)

   **3.2. Expected Outputs:**

     - HTTP Status Code 200 (OK) for successful searches.
     - Bundle of resources returned matching the search criteria, including resources found through reverse chaining.

   **3.3. Required FHIR Operations:**

     - `GET [Base]/[Resource]?[_has:{resource}:{parameter}:{value}]` 

   **3.4. Test Data Requirements:**

     - **Resource A:** A resource type that has a chained search parameter referencing another resource type (Resource B).
     - **Resource B:** A resource type referenced by Resource A's chained search parameter. 
     - At least one instance of Resource A and Resource B should exist with a relationship that satisfies the chained search parameter.

   **3.5. Validation Criteria:**

     1. **CapabilityStatement Validation:**
        - **Assert:** The CapabilityStatement MUST advertise the 'chain' property for all relevant search parameters.
     2. **Reverse Chaining Functionality:**
        - **Execute:** Perform a search on Resource A using the `_has` parameter with the chained search parameter and a value matching Resource B.
        - **Assert:** The response MUST include the instance of Resource A that is linked to the matching Resource B instance through the chained search parameter.
        - **Assert:** The HTTP status code MUST be 200 (OK).
     3. **Negative Testing:**
        - **Execute:** Perform a search using the `_has` parameter with an invalid or non-existent value for the chained search parameter.
        - **Assert:** The response MUST NOT include resources that do not match the search criteria.
        - **Assert:** The HTTP status code SHOULD be 200 (OK) with an empty Bundle returned, or 404 (Not Found) if no resources match the base criteria. 


**Note:** This test specification outlines a general approach. Specific test cases with concrete data examples and chained search parameter names should be developed based on the actual resources and search parameters defined in the implementation guide and advertised in the CapabilityStatement. 


---

<a id='req-23'></a>

### REQ-23: XML format support

**Description**: "Support xml source formats for all Plan-Net interactions."

**Actor**: Server

**Conformance**: SHOULD

## Test Specification for REQ-23: XML Format Support

**1. Requirement ID:** REQ-23

**2. Requirement Analysis:**

   - **Testability Assessment:** Automatic
   - **Complexity:** Simple
   - **Prerequisites:**
     - A running FHIR server that implements the Plan-Net interactions.
     - Test Plan-Net resources in XML format.

**3. Test Implementation Strategy:**

   **3.1. Test Case 1: Create a Plan-Net Resource (XML)**

     - **Description:** Verify the server can successfully process a create request for a Plan-Net resource with XML payload.
     - **Required Inputs:**
       - Valid XML representation of a Plan-Net resource.
     - **Required FHIR Operation:** `POST [base]/[Plan-Net Resource Type]`
     - **Test Data Requirements:**
       - A valid XML instance of a Plan-Net resource. This could be a minimal example or a more complex one depending on the specific resource type.
     - **Expected Outputs:**
       - HTTP Status Code: `201 Created`
       - `Location` header containing the URL of the newly created resource.
     - **Validation Criteria:**
       - Verify the returned HTTP status code.
       - Verify the `Location` header is present and contains a valid URL.
       - Optionally, retrieve the newly created resource using the provided URL and verify its content.

   **3.2. Test Case 2: Read a Plan-Net Resource (Accept: application/xml)**

     - **Description:** Verify the server can return a Plan-Net resource in XML format when requested.
     - **Required Inputs:**
       - The ID of an existing Plan-Net resource.
     - **Required FHIR Operation:** `GET [base]/[Plan-Net Resource Type]/[id]`
     - **Test Data Requirements:**
       - An existing Plan-Net resource on the server.
     - **Expected Outputs:**
       - HTTP Status Code: `200 OK`
       - Response body containing the requested resource in XML format.
     - **Validation Criteria:**
       - Verify the returned HTTP status code.
       - Verify the `Content-Type` header is set to `application/xml`.
       - Verify the response body contains a valid XML representation of the requested resource.

   **3.3. Test Case 3: Update a Plan-Net Resource (XML)**

     - **Description:** Verify the server can successfully process an update request for a Plan-Net resource with XML payload.
     - **Required Inputs:**
       - The ID of an existing Plan-Net resource.
       - Valid XML representation of the updated Plan-Net resource.
     - **Required FHIR Operation:** `PUT [base]/[Plan-Net Resource Type]/[id]`
     - **Test Data Requirements:**
       - An existing Plan-Net resource on the server.
       - A modified version of the resource in XML format.
     - **Expected Outputs:**
       - HTTP Status Code: `200 OK` or `204 No Content`
     - **Validation Criteria:**
       - Verify the returned HTTP status code.
       - Optionally, retrieve the updated resource and verify its content reflects the changes made.

   **3.4. Test Case 4: Search for a Plan-Net Resource (Accept: application/xml)**

     - **Description:** Verify the server can return search results for Plan-Net resources in XML format when requested.
     - **Required Inputs:**
       - Valid search parameters for the Plan-Net resource type.
     - **Required FHIR Operation:** `GET [base]/[Plan-Net Resource Type]?{search parameters}`
     - **Test Data Requirements:**
       - Existing Plan-Net resources on the server that match the search criteria.
     - **Expected Outputs:**
       - HTTP Status Code: `200 OK`
       - Response body containing a Bundle resource in XML format with the search results.
     - **Validation Criteria:**
       - Verify the returned HTTP status code.
       - Verify the `Content-Type` header is set to `application/xml`.
       - Verify the response body contains a valid Bundle resource in XML format.
       - Verify the Bundle resource contains the expected search results.

**Note:** These test cases cover the basic CRUD operations. Depending on the specific Plan-Net interactions and the level of testing required, additional test cases might be necessary. 

This test specification provides a comprehensive framework for testing the "XML format support" requirement. By implementing these test cases, you can ensure that your FHIR server correctly handles XML payloads for Plan-Net interactions as specified by the implementation guide. 


---

<a id='req-24'></a>

### REQ-24: Rejection of unauthorized requests

**Description**: "A server SHALL reject any unauthorized requests by returning an HTTP 401 unauthorized response code."

**Actor**: Server

**Conformance**: SHALL

## Test Specification for REQ-24: Rejection of Unauthorized Requests

**1. Requirement ID:** REQ-24

**2. Requirement Analysis:**

   - **Testability Assessment:** Automatic
   - **Complexity:** Simple
   - **Prerequisites:** 
     - A running FHIR server that implements the relevant resources and operations.
     - A test client capable of making authenticated and unauthenticated requests.
     - Knowledge of valid and invalid authorization credentials for the server.

**3. Test Implementation Strategy:**

   **3.1. Test Case 1: Unauthorized Request**

     - **Objective:** Verify that the server rejects unauthorized requests with an HTTP 401 Unauthorized response code.

     - **Inputs:**
       - An HTTP request to a protected resource (e.g., Patient read)
       - **No** valid authorization header or token provided in the request.

     - **Expected Outputs:**
       - HTTP Response Code: 401 Unauthorized
       - Optional: Response body may contain an OperationOutcome resource with details about the authorization failure.

     - **Required FHIR Operations:** Any read, write, or search operation on a protected resource.
     - **Test Data Requirements:**  N/A (No specific test data is required for this case)
     - **Validation Criteria:**
       - Assert that the HTTP response code is **401 Unauthorized**.

   **3.2. Test Case 2: Authorized Request**

     - **Objective:** Verify that the server processes authorized requests successfully.

     - **Inputs:**
       - An HTTP request to a protected resource (e.g., Patient read)
       - A valid authorization header or token provided in the request.

     - **Expected Outputs:**
       - HTTP Response Code: 200 OK (or other successful code depending on the operation)
       - Response body contains the requested resource or operation outcome as defined by the FHIR specification.

     - **Required FHIR Operations:** Any read, write, or search operation on a protected resource.
     - **Test Data Requirements:**  May require specific test data depending on the chosen FHIR operation.
     - **Validation Criteria:**
       - Assert that the HTTP response code indicates success (e.g., 200 OK).
       - Assert that the response body contains the expected content based on the FHIR operation and provided data.

**Notes:**

* These test cases should be executed against all relevant resources and operations that require authorization as defined by the FHIR Implementation Guide.
* The specific format and content of the authorization header or token will depend on the authentication mechanism implemented by the server (e.g., OAuth2, Basic Authentication).
* The Capability Statement should be consulted to determine which resources and operations require authorization and what authentication mechanisms are supported. 


---

<a id='req-25'></a>

### REQ-25: Support for read interaction

**Description**: "For each resource type and profile, a Plan Net server SHALL support the read interaction."

**Actor**: Server

**Conformance**: SHALL

## Test Specification for REQ-25: Support for Read Interaction

### 1. Requirement ID

REQ-25

### 2. Requirement Analysis

* **Testability Assessment:** Automatic
* **Complexity:** Simple
* **Prerequisites:** 
    * A running FHIR server that implements the Plan Net Implementation Guide.
    * Knowledge of at least one resource type and profile supported by the server. This information can be obtained from the server's Capability Statement.

### 3. Test Implementation Strategy

#### 3.1 Required Inputs and Expected Outputs

| Input                                     | Expected Output                                                                                                                                                                                                 |
|-------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Valid `GET` request to read a resource | HTTP Status Code `200 OK` <br> A FHIR resource of the requested type and profile in the response body.                                                                                                               |

#### 3.2 Required FHIR Operations

* `read` interaction on the target resource type. This should be verified against the `interaction` element within the `resource` array of the CapabilityStatement. Ensure the `code` value is `read`.

#### 3.3 Test Data Requirements

* A valid resource ID for a resource of the chosen type and profile. This can often be obtained by performing a search operation first.

#### 3.4 Validation Criteria

1. **Response Code:** Verify that the HTTP response code is `200 OK`. Any other response code indicates a failure to meet the requirement.
2. **Resource Type:** Verify that the returned resource in the response body matches the requested resource type.
3. **Resource Profile:** Verify that the returned resource conforms to the expected profile defined in the Plan Net Implementation Guide. This may involve schema validation or checking for the presence of specific profile-defined elements and extensions.

**Example using pseudo-code:**

```
function testReadInteraction(resourceType, profile) {
  resourceId = getValidResourceId(resourceType) // Implement logic to retrieve a valid resource ID
  response = sendFHIRRequest("GET", `/fhir/${resourceType}/${resourceId}`)

  assert response.statusCode == 200, "Expected HTTP 200 OK, but got ${response.statusCode}"
  assert response.body.resourceType == resourceType, "Resource type mismatch"
  assert validateResourceAgainstProfile(response.body, profile), "Resource does not conform to the expected profile"
}
```

This test specification provides a structured approach to testing REQ-25. By focusing on specific validation criteria and leveraging the Capability Statement, this test can be automated and reliably verify the server's compliance with the read interaction requirement. 


---

<a id='req-26'></a>

### REQ-26: Support for vread interaction

**Description**: "For each resource type and profile, a Plan Net server SHOULD support the vread interaction."

**Actor**: Server

**Conformance**: SHOULD

## Test Specification for REQ-26: Support for vread Interaction

### 1. Requirement ID

REQ-26

### 2. Requirement Analysis

* **Testability Assessment:** Automatic
* **Complexity:** Simple
* **Prerequisites:**
    * A running FHIR server under test that implements the Plan Net Implementation Guide.
    * At least one resource instance of a type and profile supported by the server exists. 
    * The ID and version ID of the existing resource instance are known.

### 3. Test Implementation Strategy

#### 3.1 Required Inputs

* **Base URL of the FHIR server**
* **Resource type** (e.g., "Patient", "Observation")
* **Resource ID**
* **Version ID**

#### 3.2 Expected Outputs

* **HTTP Status Code:** 200 (OK)
* **Response Body:** A FHIR resource of the specified type and profile, representing the version identified by the version ID.

#### 3.3 Required FHIR Operations

* **vread:**  
    * **URL Structure:** `[Base URL]/[Resource Type]/[Resource ID]/_history/[Version ID]`
    * **HTTP Method:** GET

#### 3.4 Test Data Requirements

* **Existing Resource:**  A resource instance of a supported type and profile must exist on the server. This resource should have at least one previous version.

#### 3.5 Validation Criteria

1. **HTTP Status Code Check:** Verify that the vread request returns an HTTP status code of 200 (OK).
2. **Response Body Check:** 
    * Verify that the response body is a valid FHIR resource.
    * Verify that the resource type and profile in the response match the requested resource type and profile.
    * Verify that the resource in the response body represents the correct version by comparing the `meta.versionId` element with the provided version ID.

**Note:** This test specification assumes that the Capability Statement confirms the server supports the "vread" interaction for the specific resource type and profile being tested. If the Capability Statement does not indicate support for "vread", this requirement should be marked as "Not Supported" or "Not Testable" depending on the context. 


---

<a id='req-27'></a>

### REQ-27: Support for _includes

**Description**: "[For each resource] A Server SHALL be capable of supporting the following _includes [list]."

**Actor**: Server

**Conformance**: SHALL

## Test Specification for REQ-27: Support for _includes

### 1. Requirement ID

REQ-27

### 2. Requirement Analysis

* **Testability Assessment:** Automatic
* **Complexity:** Simple
* **Prerequisites:** 
    * A running FHIR server that implements the target Implementation Guide.
    * Knowledge of the specific _includes listed in the requirement.
    * Access to test patients with related resources (if testing includes that require existing relationships).

### 3. Test Implementation Strategy

#### 3.1 Required Inputs and Expected Outputs

| Input                                     | Expected Output                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               

---

<a id='req-28'></a>

### REQ-28: Support for _revincludes

**Description**: "[For each resource] A Server SHALL be capable of supporting the following _revincludes: [list]."

**Actor**: Server

**Conformance**: SHALL

## Test Specification for REQ-28: Support for _revincludes

### 1. Requirement ID

REQ-28

### 2. Requirement Analysis

**Testability Assessment:** Automatic
**Complexity:** Moderate
**Prerequisites:**
* A running FHIR server that implements the target Implementation Guide.
* A test client capable of making FHIR API requests.
* Test data for resources that support the specified _revincludes.

### 3. Test Implementation Strategy

#### 3.1 Required Inputs and Expected Outputs

**Inputs:**
* **Resource Type:** The specific resource type to test (e.g., Patient, Observation).
* **_revincludes:** The list of _revincludes specified in the requirement.

**Expected Outputs:**
* **HTTP Status Code:** 200 (OK)
* **FHIR Bundle:** A valid FHIR Bundle containing the requested resource and any included resources based on the specified _revincludes.

#### 3.2 Required FHIR Operations

* **READ:** To retrieve the base resource.
* **SEARCH:**  Potentially required to retrieve a list of resources if testing _revincludes that operate on a search result set.

**Note:** Verify that the Capability Statement for the tested server advertises support for these operations on the relevant resource types.

#### 3.3 Test Data Requirements

* **Base Resource:** At least one instance of the resource type being tested.
* **Related Resources:**  Instances of resources that would be included based on the specified _revincludes (e.g., for a _revinclude=Provenance:target, there should be Provenance resources referencing the base resource).

#### 3.4 Validation Criteria

1. **HTTP Status Code:** Verify that the server returns an HTTP status code of 200 (OK).
2. **FHIR Bundle Validation:** Validate the returned response against the FHIR Bundle profile.
3. **Resource Presence:**  Assert that the Bundle contains the expected base resource.
4. **_revinclude Resolution:** For each specified _revincludes:
    * **Identify Target Resources:** Determine the resources that should be included based on the _revincludes criteria.
    * **Verify Inclusion:** Assert that all identified target resources are present within the returned Bundle.
    * **Validate References:** Ensure that references between the base resource and included resources are correctly populated and resolve to resources within the Bundle.

**Example Test Case:**

**Resource Type:** Observation
**_revincludes:** Provenance:target

1. Create an Observation resource with a reference to a Patient resource.
2. Create a Provenance resource that has the Observation resource as its `target`.
3. Perform a READ operation on the Observation resource, including the `_revinclude=Provenance:target` parameter.
4. Verify that the response includes both the Observation and the related Provenance resource.
5. Validate that the `target` reference in the Provenance resource correctly points to the included Observation resource. 


---

<a id='req-29'></a>

### REQ-29: Network profile NPI handling

**Description**: "The NPI and CLIA identifier types, which are Must-Support, are clearly intended for provider organizations only and are not expected to be populated for other organization types."

**Actor**: Server

**Conformance**: None (Clarification)

## Test Specification for REQ-29: Network profile NPI handling

### 1. Requirement ID

REQ-29

### 2. Requirement Analysis

**Testability Assessment:** Hybrid (Combination of automated data checks and manual review)

**Complexity:** Moderate

**Prerequisites:**

* Access to the target FHIR server.
* Ability to retrieve the server's CapabilityStatement.
* Ability to create and submit Organization resources to the server.

### 3. Test Implementation Strategy

This requirement necessitates a two-pronged testing approach:

**A. Automated Data Validation:**

* **Required Inputs:**
    * A set of Organization resources with varying `type` values.
    * Some Organizations with `type` indicating a provider organization (e.g., using US Core PractitionerRole profile) should include populated `identifier` elements with `system` values of "http://hl7.org/fhir/sid/us-npi" (NPI) and/or "urn:oid:2.16.840.1.113883.19.4" (CLIA).
    * Some Organizations with `type` **not** indicating a provider organization should **not** include `identifier` elements with the NPI or CLIA `system` values. 
* **Required FHIR Operations:**
    * `POST` (Create) on the `Organization` resource to submit test data.
* **Test Data Requirements:**
    * A diverse set of `Organization` resources representing various organization types, both provider and non-provider.
* **Validation Criteria:**
    * **Automated Check:**  For all created `Organization` resources, verify that:
        * If the `type` indicates a provider organization, the presence of NPI and/or CLIA identifiers does not raise an error.
        * If the `type` does not indicate a provider organization, the presence of NPI and/or CLIA identifiers results in an error response from the server (e.g., OperationOutcome with appropriate error code).

**B. Manual CapabilityStatement Review:**

* **Required Inputs:**
    * The server's CapabilityStatement.
* **Required FHIR Operations:**
    * `GET` on the `metadata` endpoint to retrieve the CapabilityStatement.
* **Validation Criteria:**
    * **Manual Check:** Within the CapabilityStatement, locate the `Organization` resource profile being used (as identified in the "Source" field of the requirement).  Verify that the profile's `identifier` element definition for both NPI and CLIA systems includes a `mustSupport` flag set to `true`.

**Passing Criteria:**

* The automated data validation checks pass successfully.
* The manual CapabilityStatement review confirms the `mustSupport` flag is set to `true` for NPI and CLIA identifiers within the relevant `Organization` profile. 

**Note:** This test specification assumes the server enforces the requirement through validation checks during resource creation. If the server implements the requirement differently (e.g., through guidance in its documentation), the test strategy may need adjustments. 


---

<a id='req-30'></a>

### REQ-30: lastUpdate timestamp requirement

**Description**: "Each profile in this guide requires that the lastUpdate timestamp be provided as part of the profile's data content."

**Actor**: Server

**Conformance**: None (Requirement)

## Test Specification for REQ-30: lastUpdate Timestamp Requirement

**1. Requirement ID:** REQ-30

**2. Requirement Analysis:**

   - **Testability Assessment:** Automatic
   - **Complexity:** Simple
   - **Prerequisites:**
      - A running FHIR server that implements the profiles defined in the FHIR Implementation Guide.
      - Access to create and read resources conforming to the profiles in the scope of this requirement.

**3. Test Implementation Strategy:**

   **3.1. Test Case 1: Verify lastUpdate Presence on Resource Creation**

     - **Description:** This test case verifies that the server populates the `lastUpdate` timestamp when a new resource conforming to a profile within the scope of this requirement is created.

     - **Required Inputs:**
       - A valid FHIR resource instance conforming to a profile within the scope of this requirement, excluding the `lastUpdate` element.

     - **Required FHIR Operations:**
       - `CREATE` operation on the appropriate resource endpoint.

     - **Expected Outputs:**
       - HTTP Status Code: `201 Created`
       - A response body containing the created resource with a populated `lastUpdate` timestamp.

     - **Validation Criteria:**
       - Assert that the `lastUpdate` element is present in the returned resource.
       - Assert that the value of the `lastUpdate` element is a valid timestamp format according to the FHIR specification.

   **3.2. Test Case 2: Verify lastUpdate Update on Resource Update**

     - **Description:** This test case verifies that the server updates the `lastUpdate` timestamp when an existing resource conforming to a profile within the scope of this requirement is updated.

     - **Required Inputs:**
       - A valid FHIR resource instance conforming to a profile within the scope of this requirement, pre-existing on the server.

     - **Required FHIR Operations:**
       - `READ` operation to retrieve the current resource and its `lastUpdate` timestamp.
       - `UPDATE` operation on the appropriate resource endpoint with modifications to the resource.

     - **Expected Outputs:**
       - HTTP Status Code: `200 OK` for both `READ` and `UPDATE` operations.
       - A response body from the `UPDATE` operation containing the updated resource with a modified `lastUpdate` timestamp.

     - **Validation Criteria:**
       - Assert that the `lastUpdate` timestamp in the updated resource response is different from the timestamp retrieved in the initial `READ` operation.
       - Assert that the value of the updated `lastUpdate` element is a valid timestamp format according to the FHIR specification.

**Note:** These test cases should be repeated for each profile defined in the FHIR Implementation Guide that falls under the scope of requirement REQ-30. 


---

<a id='req-32'></a>

### REQ-32: General Search for Pharmacy

**Description**: "The Plan-Net design is based around the following types of searches: General Search - Example: Pharmacy - Focal Resource and Field: HealthcareService.category, HealthcareService.specialty - Qualifications of Search: Location, network."

**Actor**: Server

**Conformance**: None (Design requirement)

## Test Specification

### 1. Requirement ID

REQ-32: General Search for Pharmacy

### 2. Requirement Analysis

- **Testability Assessment:** Automatic
- **Complexity:** Moderate
- **Prerequisites:**
    - A running FHIR server that conforms to the provided Capability Statement.
    - Test data containing HealthcareService resources with category and specialty information relevant to pharmacies.
    - Test data containing Location resources with address information and relationships to HealthcareService resources.

### 3. Test Implementation Strategy

#### 3.1. Test Case 1: Search by Service Category

**Objective:** Verify that the system can search for Pharmacy HealthcareServices using the `service-category` search parameter.

**Inputs:**

- FHIR Server endpoint
- Search parameter: `service-category`
- Search parameter value: A token representing "Pharmacy" (e.g., http://terminology.hl7.org/CodeSystem/service-category|3)

**Expected Outputs:**

- HTTP Status Code: 200 (OK)
- A Bundle resource containing HealthcareService resources where the `category` field matches the provided search parameter value.

**Required FHIR Operations:**

- `GET [FHIR Server endpoint]/HealthcareService?service-category=[search parameter value]`

**Test Data Requirements:**

- At least one HealthcareService resource with a `category` field containing the token representing "Pharmacy".

**Validation Criteria:**

- Verify the HTTP status code is 200 (OK).
- Verify the response Content-Type is `application/fhir+json`.
- Verify the response body is a valid Bundle resource.
- Verify all returned HealthcareService resources have a `category` field matching the provided search parameter value.

#### 3.2. Test Case 2: Search by Specialty and Location

**Objective:** Verify that the system can search for Pharmacy HealthcareServices using the `specialty` and location-related search parameters.

**Inputs:**

- FHIR Server endpoint
- Search parameters:
    - `specialty`: A token representing a pharmacy-related specialty (e.g., http://hl7.org/fhir/us/core/ValueSet/us-core-provider-specialty|390200000)
    - One or more location-related search parameters (e.g., `address-city`, `address-state`, `address-postalcode`) with corresponding values.

**Expected Outputs:**

- HTTP Status Code: 200 (OK)
- A Bundle resource containing HealthcareService resources that match both the `specialty` and location criteria.

**Required FHIR Operations:**

- `GET [FHIR Server endpoint]/HealthcareService?specialty=[specialty value]&[location parameter]=[location value]`

**Test Data Requirements:**

- At least one HealthcareService resource with a `specialty` field matching the provided search parameter value and a relationship to a Location resource with matching address information.

**Validation Criteria:**

- Verify the HTTP status code is 200 (OK).
- Verify the response Content-Type is `application/fhir+json`.
- Verify the response body is a valid Bundle resource.
- Verify all returned HealthcareService resources have a `specialty` field matching the provided search parameter value.
- Verify all returned HealthcareService resources are related to Location resources with address information matching the provided location search parameters.

**Note:** This test specification provides a starting point for testing REQ-32. Additional test cases may be needed to cover different combinations of search parameters and edge cases. 


---

<a id='req-33'></a>

### REQ-33: Provider search by name

**Description**: "The Plan-Net design is based around the following types of searches: Provider by Name - Example: Joe Smith - Focal Resource and Field: Practitioner.name - Qualifications of Search: Location, network, specialty, role/privileges."

**Actor**: Server

**Conformance**: None (Design requirement)

## Test Specification

### 1. Requirement ID

REQ-33: Provider search by name

### 2. Requirement Analysis

**Testability Assessment:** Automatic

**Complexity:** Moderate

**Prerequisites:**

* A running FHIR server conformant to the Plan-Net Implementation Guide.
* The FHIR server must be populated with Practitioner resources containing name information.
* Test data should include various combinations of first name, last name, and potential variations in name formatting (e.g., middle names, suffixes).

### 3. Test Implementation Strategy

#### 3.1 Required Inputs and Expected Outputs

**Inputs:**

* **Search Parameter:** `name`
* **Search Value:** Various string values representing provider names (e.g., "Joe Smith", "Smith, Joe", "John Jacob Jingleheimer Schmidt").

**Expected Outputs:**

* **HTTP Status Code:** 200 (OK)
* **Resource Type:** Bundle
* **Bundle Type:** searchset
* **Bundle Entries:**  A list of Practitioner resources matching the provided name search criteria.

#### 3.2 Required FHIR Operations

* **Search Operation:** `GET [base]/Practitioner?name={search-value}`

#### 3.3 Test Data Requirements

* **Practitioner Resources:**
    * A diverse set of Practitioner resources with varying name combinations (first, last, middle, suffixes) and potential variations in formatting.
    * Some Practitioners should share common names to test for accurate filtering.
* **Test Cases:**
    * Test cases should cover a range of scenarios, including:
        * Exact name matches.
        * Partial name matches (e.g., searching for "Smith" returns all practitioners with "Smith" in their name).
        * Case-insensitive searches (e.g., searching for "joe smith" returns "Joe Smith").
        * Searches with different name formatting (e.g., searching for "Smith, Joe" returns "Joe Smith").

#### 3.4 Validation Criteria

* **Response Validation:**
    * Verify the HTTP status code is 200 (OK).
    * Verify the response Content-Type is `application/fhir+json`.
    * Verify the response resource type is `Bundle`.
    * Verify the bundle type is `searchset`.
* **Resource Validation:**
    * Verify that all returned Practitioner resources in the bundle match the provided search criteria for `name`.
    * Verify that no Practitioner resources are returned that do not match the search criteria.

**Additional Considerations:**

* The test specification should include negative test cases to ensure the system handles invalid or unexpected inputs gracefully.
* Performance testing can be incorporated to assess the search functionality's efficiency with large datasets.
* Consider testing for additional qualifications mentioned in the requirement (location, network, specialty, role/privileges) by combining the `name` search parameter with other relevant search parameters supported by the Practitioner and Location resources. 


---

<a id='req-34'></a>

### REQ-34: Organization search by name

**Description**: "The Plan-Net design is based around the following types of searches: Organization by Name - Example: Montgomery Cardiology or CVS - Focal Resource and Field: Organization.name - Qualifications of Search: Location, network, specialty."

**Actor**: Server

**Conformance**: None (Design requirement)

## Test Specification

### 1. Requirement ID

REQ-34: Organization search by name

### 2. Requirement Analysis

* **Testability Assessment:** Automatic
* **Complexity:** Simple
* **Prerequisites:**
    * A running FHIR server with the Plan-Net implementation.
    * The Capability Statement indicates support for the required search parameter.
    * Test Organization resources loaded into the server, including organizations with names like "Montgomery Cardiology" and "CVS". 

### 3. Test Implementation Strategy

#### 3.1. Test Case 1: Search by full organization name

* **Test Input:**
    * **FHIR Operation:** GET /Organization?name=Montgomery Cardiology
* **Expected Output:**
    * **HTTP Status Code:** 200 (OK)
    * **Response Body:** A Bundle resource containing only Organization resources with the name "Montgomery Cardiology". 
* **Validation Criteria:**
    * Verify the HTTP status code is 200.
    * Verify the response body is a Bundle resource with type 'searchset'.
    * Verify all returned Organization resources have the name "Montgomery Cardiology".

#### 3.2. Test Case 2: Search by partial organization name

* **Test Input:**
    * **FHIR Operation:** GET /Organization?name:contains=Cardiology
* **Expected Output:**
    * **HTTP Status Code:** 200 (OK)
    * **Response Body:** A Bundle resource containing Organization resources whose name includes "Cardiology", such as "Montgomery Cardiology".
* **Validation Criteria:**
    * Verify the HTTP status code is 200.
    * Verify the response body is a Bundle resource with type 'searchset'.
    * Verify all returned Organization resources have a name containing the string "Cardiology".

#### 3.3. Test Case 3: Search with no matching organization

* **Test Input:**
    * **FHIR Operation:** GET /Organization?name=NonExistentOrganization
* **Expected Output:**
    * **HTTP Status Code:** 200 (OK)
    * **Response Body:** An empty Bundle resource (no matching resources).
* **Validation Criteria:**
    * Verify the HTTP status code is 200.
    * Verify the response body is an empty Bundle resource with type 'searchset'.

#### 3.4. Test Data Requirements

* A set of Organization resources with different names, including "Montgomery Cardiology", "CVS", and others to test various search scenarios.

#### 3.5. Additional Considerations

* The test cases above demonstrate basic functionality.  Consider adding more test cases to cover:
    * Different search modifiers (e.g., `name:exact`, `name:above`, etc.)
    * Combination of search parameters (e.g., `name=Montgomery&address-city=Montgomery`). This tests the "Qualifications of Search" aspect mentioned in the requirement.
    * Handling of special characters in organization names.
* These tests can be automated using testing frameworks like Jest, Mocha, or pytest with a FHIR client library. 


---

<a id='req-35'></a>

### REQ-35: Provider search by specialty

**Description**: "The Plan-Net design is based around the following types of searches: Provider by Specialty - Example: Cardiologist - Focal Resource and Field: PractitionerRole.specialty - Qualifications of Search: Location, network, name."

**Actor**: Server

**Conformance**: None (Design requirement)

## Test Specification

### 1. Requirement ID

REQ-35: Provider search by specialty

### 2. Requirement Analysis

**Testability Assessment**: Automatic

**Complexity**: Moderate

**Prerequisites**:

* A running FHIR server with the Plan-Net implementation.
* The FHIR server must have PractitionerRole resources loaded with at least one resource containing a 'specialty' element.
* Test data should include various specialties, locations, and network affiliations.

### 3. Test Implementation Strategy

#### 3.1. Test Case 1: Search by Specialty

**Objective**: Verify that the system can successfully search for PractitionerRole resources by specialty.

**Inputs**:

* FHIR Server endpoint
* Search Parameter: `specialty` with a valid specialty code (e.g., `http://hl7.org/fhir/us/core/ValueSet/us-core-provider-specialty|cardio`)

**Expected Outputs**:

* HTTP Status Code: 200 (OK)
* A Bundle resource containing a list of PractitionerRole resources that match the specified specialty.

**Required FHIR Operations**:

* `GET [FHIR Server endpoint]/PractitionerRole?specialty={specialty code}`

**Test Data Requirements**:

* At least one PractitionerRole resource with the specified specialty code.

**Validation Criteria**:

* Verify the HTTP status code is 200 (OK).
* Verify the response Content-Type is `application/fhir+json`.
* Verify the response resource type is a Bundle.
* Verify the Bundle contains only PractitionerRole resources.
* Verify all returned PractitionerRole resources have the specified specialty code in the `specialty` element.

#### 3.2. Test Case 2: Search by Specialty with Location and Network Filters

**Objective**: Verify that the system can successfully search for PractitionerRole resources by specialty, location, and network.

**Inputs**:

* FHIR Server endpoint
* Search Parameter: `specialty` with a valid specialty code.
* Search Parameter: `location` with a valid location reference (e.g., `Location/12345`).
* Search Parameter: `network` with a valid network reference (e.g., `Organization/67890`).

**Expected Outputs**:

* HTTP Status Code: 200 (OK)
* A Bundle resource containing a list of PractitionerRole resources that match the specified specialty, location, and network.

**Required FHIR Operations**:

* `GET [FHIR Server endpoint]/PractitionerRole?specialty={specialty code}&location={location reference}&network={network reference}`

**Test Data Requirements**:

* At least one PractitionerRole resource with the specified specialty code, location reference, and network reference.

**Validation Criteria**:

* Verify the HTTP status code is 200 (OK).
* Verify the response Content-Type is `application/fhir+json`.
* Verify the response resource type is a Bundle.
* Verify the Bundle contains only PractitionerRole resources.
* Verify all returned PractitionerRole resources have the specified specialty code, location reference, and network reference.


#### 3.3. Test Case 3: Search by Specialty with Partial Name Search

**Objective**: Verify that the system can successfully search for PractitionerRole resources by specialty and a partial practitioner name.

**Inputs**:

* FHIR Server endpoint
* Search Parameter: `specialty` with a valid specialty code.
* Search Parameter: `practitioner.name` with a partial practitioner name (e.g., `Smith`).

**Expected Outputs**:

* HTTP Status Code: 200 (OK)
* A Bundle resource containing a list of PractitionerRole resources that match the specified specialty and have a practitioner with a name containing the specified partial name.

**Required FHIR Operations**:

* `GET [FHIR Server endpoint]/PractitionerRole?specialty={specialty code}&practitioner.name={partial practitioner name}`

**Test Data Requirements**:

* At least one PractitionerRole resource with the specified specialty code and a practitioner whose name contains the specified partial name.

**Validation Criteria**:

* Verify the HTTP status code is 200 (OK).
* Verify the response Content-Type is `application/fhir+json`.
* Verify the response resource type is a Bundle.
* Verify the Bundle contains only PractitionerRole resources.
* Verify all returned PractitionerRole resources have the specified specialty code and a practitioner whose name contains the specified partial name.

**Note**: This test specification utilizes the Capability Statement information to identify supported search parameters and their types. It also outlines specific test cases to cover various search scenarios based on the requirement. Remember to adapt this template with specific specialty codes, location references, network references, and practitioner names relevant to your implementation. 


---

<a id='req-36'></a>

### REQ-36: Organization search by specialty

**Description**: "The Plan-Net design is based around the following types of searches: Organization by specialty - Example: Compounding Pharmacy - Focal Resource and Field: OrganizationAffiliation.specialty - Qualifications of Search: Location, network, name."

**Actor**: Server

**Conformance**: None (Design requirement)

## Test Specification

### 1. Requirement ID

REQ-36: Organization search by specialty

### 2. Requirement Analysis

**Testability Assessment:** Automatic

**Complexity:** Simple

**Prerequisites:**

* A running FHIR server with the Plan-Net Implementation Guide.
* The FHIR server must support the `OrganizationAffiliation` resource and its search parameters, specifically `specialty`, `location`, and `network`.
* Test data should include `OrganizationAffiliation` resources with various specialties, locations, and network affiliations. 

### 3. Test Implementation Strategy

**Test Case 1: Search for Organizations by Specialty**

**Required Inputs:**

* **FHIR Operation:** `GET /OrganizationAffiliation?specialty={system|}[code]`
* **Search Parameters:**
    * `specialty`: The code or system|code of the desired specialty (e.g., `http://hl7.org/fhir/us/core/ValueSet/us-core-provider-taxonomy|208000000X` for "Allopathic & Osteopathic Physicians")

**Expected Outputs:**

* **HTTP Status Code:** 200 (OK)
* **Response Body:** A Bundle containing `OrganizationAffiliation` resources that match the specified specialty.

**Validation Criteria:**

* Verify the returned Bundle contains only `OrganizationAffiliation` resources.
* Verify that all returned `OrganizationAffiliation` resources have the specified `specialty` in their `specialty` element.

**Test Case 2: Search for Organizations by Specialty and Location**

**Required Inputs:**

* **FHIR Operation:** `GET /OrganizationAffiliation?specialty={system|}[code]&location={Location URL}`
* **Search Parameters:**
    * `specialty`: The code or system|code of the desired specialty.
    * `location`: The URL of the desired location.

**Expected Outputs:**

* **HTTP Status Code:** 200 (OK)
* **Response Body:** A Bundle containing `OrganizationAffiliation` resources that match the specified specialty and location.

**Validation Criteria:**

* Verify the returned Bundle contains only `OrganizationAffiliation` resources.
* Verify that all returned `OrganizationAffiliation` resources have the specified `specialty` in their `specialty` element.
* Verify that all returned `OrganizationAffiliation` resources have the specified `location` in their `location` element.

**Test Case 3: Search for Organizations by Specialty and Network**

**Required Inputs:**

* **FHIR Operation:** `GET /OrganizationAffiliation?specialty={system|}[code]&network={Organization URL}`
* **Search Parameters:**
    * `specialty`: The code or system|code of the desired specialty.
    * `network`: The URL of the desired network organization.

**Expected Outputs:**

* **HTTP Status Code:** 200 (OK)
* **Response Body:** A Bundle containing `OrganizationAffiliation` resources that match the specified specialty and network.

**Validation Criteria:**

* Verify the returned Bundle contains only `OrganizationAffiliation` resources.
* Verify that all returned `OrganizationAffiliation` resources have the specified `specialty` in their `specialty` element.
* Verify that all returned `OrganizationAffiliation` resources have the specified `network` in their `network` element.

**Test Data Requirements:**

* Multiple `OrganizationAffiliation` resources with different combinations of:
    * `specialty` codes
    * `location` references
    * `network` references

**Note:** These test cases can be further expanded to include various combinations of search parameters and different search parameter modifiers (e.g., `:above`, `:below`, `:contains`, etc.) as supported by the server. 


---

<a id='req-37'></a>

### REQ-37: Search for active practitioners and organizations

**Description**: "Sample query to search for currently active Practitioners (replace date in query with current date): http://davinci-plan-net-ri.logicahealth.org/fhir/PractitionerRole?_include=PractitionerRole:date=ge2021-10-25. Sample query to search for currently active Organizations (replace date in query with current date): http://davinci-plan-net-ri.logicahealth.org/fhir/OrganizationAffiliation?_include=OrganizationAffiliation:date=ge2021-10-25."

**Actor**: Server

**Conformance**: None (Implementation example)

## Test Specification

### 1. Requirement ID

REQ-37: Search for active practitioners and organizations

### 2. Requirement Analysis

**Testability Assessment:** Automatic

**Complexity:** Moderate

**Prerequisites:**

* A running FHIR server with the capability to serve Practitioner, Organization, PractitionerRole, and OrganizationAffiliation resources.
* The FHIR server should have data populated for these resources, including resources with varying active/inactive statuses and dates.

### 3. Test Implementation Strategy

#### 3.1. Test Case 1: Search for Active Practitioners

**Objective:** Verify the ability to search for currently active practitioners using PractitionerRole resources and the `_include` parameter.

**Inputs:**

* **FHIR Operation:** GET
* **Endpoint:** `/PractitionerRole?_include=PractitionerRole:practitioner&_lastUpdated=ge${currentDate}` (Replace `${currentDate}` with the current date in YYYY-MM-DD format)

**Expected Outputs:**

* **HTTP Status Code:** 200 (OK)
* **Response Body:** A Bundle resource containing PractitionerRole resources where the `active` element is true OR not present, and the `period.end` element is either absent or has a date after the current date. The Bundle should also include the related Practitioner resources as specified by the `_include` parameter. 

**Validation Criteria:**

1. Verify the HTTP status code is 200 (OK).
2. Verify the response body is a valid Bundle resource.
3. Verify all returned PractitionerRole resources meet the following criteria:
    * The `active` element is true OR not present.
    * The `period.end` element is either absent or has a date after the current date.
4. Verify the Bundle includes all related Practitioner resources as specified by the `_include` parameter.

#### 3.2. Test Case 2: Search for Active Organizations

**Objective:** Verify the ability to search for currently active organizations using OrganizationAffiliation resources and the `_include` parameter.

**Inputs:**

* **FHIR Operation:** GET
* **Endpoint:** `/OrganizationAffiliation?_include=OrganizationAffiliation:participating-organization&_lastUpdated=ge${currentDate}` (Replace `${currentDate}` with the current date in YYYY-MM-DD format)

**Expected Outputs:**

* **HTTP Status Code:** 200 (OK)
* **Response Body:** A Bundle resource containing OrganizationAffiliation resources where the `active` element is true OR not present, and the `period.end` element is either absent or has a date after the current date. The Bundle should also include the related Organization resources as specified by the `_include` parameter.

**Validation Criteria:**

1. Verify the HTTP status code is 200 (OK).
2. Verify the response body is a valid Bundle resource.
3. Verify all returned OrganizationAffiliation resources meet the following criteria:
    * The `active` element is true OR not present.
    * The `period.end` element is either absent or has a date after the current date.
4. Verify the Bundle includes all related Organization resources as specified by the `_include` parameter.

**Note:** These test cases utilize the `_lastUpdated` search parameter to ensure that the server returns resources updated on or after the current date. This indirectly tests for "active" resources, as inactive resources are less likely to be updated recently. However, it's crucial to have test data that includes both active and inactive resources with varying dates to ensure comprehensive testing. 


---

<a id='req-38'></a>

### REQ-38: Network contact handling for departments

**Description**: "When the contact is a department name, rather than a human (e.g., patient help line), include a blank family and given name, and provide the department name in contact.name.text."

**Actor**: Server

**Conformance**: None (Implementation guidance)

## Test Specification for REQ-38: Network Contact Handling for Departments

### 1. Requirement ID

REQ-38

### 2. Requirement Analysis

- **Testability Assessment:** Automatic
- **Complexity:** Simple
- **Prerequisites:**
    - The system under test must support the creation and retrieval of `Organization` resources with `Contact` components.
    - The Capability Statement must indicate support for the `create` and `read` interactions on the `Organization` resource.

### 3. Test Implementation Strategy

#### 3.1. Required Inputs and Expected Outputs

**Input:**

- A FHIR `Organization` resource representing a department with a contact that is the department name itself (e.g., "Patient Help Line"). The `Contact` component should have:
    - `telecom`:  Appropriate contact information (e.g., phone number)
    - `name`: 
        - `family`: Empty
        - `given`: Empty
        - `text`: "Patient Help Line"

**Expected Output:**

- **HTTP Status Code:** 200 (OK) or 201 (Created) for successful creation/update.
- **Response Body:** The created/updated `Organization` resource in FHIR format, including the provided `Contact` information with blank `family` and `given` names and the department name in `name.text`.

#### 3.2. Required FHIR Operations

- **Create:**  `POST [base]/Organization` to create a new `Organization` resource with the test data.
- **Read:** `GET [base]/Organization/[id]` to retrieve the created `Organization` resource and verify its content.

#### 3.3. Test Data Requirements

- A valid FHIR `Organization` resource instance representing a department.
- The `Contact` component within the `Organization` resource should be populated as described in the "Input" section above.

#### 3.4. Validation Criteria

1. **Response Code Validation:** Verify that the server returns the expected HTTP status code (200 or 201) for both the create and read operations.
2. **Resource Content Validation:** 
    - Verify that the returned `Organization` resource contains the `Contact` component with:
        - Empty `family` and `given` name elements.
        - The department name accurately populated in the `name.text` element. 

**Note:** This test specification assumes that the Capability Statement confirms the server's ability to handle the `create` and `read` interactions on the `Organization` resource. 


---

<a id='req-39'></a>

### REQ-39: Organization contact handling for departments

**Description**: "When the contact is a department name, rather than a human (e.g., patient help line), include a blank family and given name, and provide the department name in contact.name.text."

**Actor**: Server

**Conformance**: None (Implementation guidance)

## Test Specification: Organization Contact Handling for Departments

**1. Requirement ID:** REQ-39

**2. Requirement Analysis:**

   - **Testability Assessment:** Automatic
   - **Complexity:** Simple
   - **Prerequisites:**
     - A FHIR server instance capable of handling Organization resources.
     - The server should support the `name` search parameter for Organization resources (confirmed by Capability Statement).

**3. Test Implementation Strategy:**

   **3.1. Test Case 1: Retrieve Organization with Department Contact**

     - **Description:** Verify that an Organization resource representing a department contact adheres to the requirement.

     - **Required Inputs:**
       - A search request for Organization resources.
       - The search request should use the `name` parameter to target an organization known to represent a department contact (e.g., "Patient Help Line").

     - **Required FHIR Operations:**
       - `GET [base]/Organization?name=[department name]`

     - **Test Data Requirements:**
       - The FHIR server should contain at least one Organization resource representing a department contact, with the following characteristics:
         - `name.text`: Contains the department name.
         - `contact.name.family`: Absent or empty.
         - `contact.name.given`: Absent or empty.

     - **Validation Criteria:**
       - **Response Status Code:** 200 (OK)
       - **Response Body:** The response bundle should contain at least one Organization resource matching the search criteria.
       - **Resource Validation:** The returned Organization resource representing the department contact should:
         - Have a `name.text` element containing the expected department name.
         - Not have a `contact.name.family` element, or the element should be empty.
         - Not have a `contact.name.given` element, or the element should be empty.

   **3.2. Test Case 2: Negative Testing - Retrieve Organization with Human Contact**

     - **Description:** Verify that the requirement does not impact the representation of human contacts within Organization resources.

     - **Required Inputs:**
       - A search request for Organization resources.
       - The search request should use the `name` parameter to target an organization known to represent a human contact (e.g., "Dr. Smith's Office").

     - **Required FHIR Operations:**
       - `GET [base]/Organization?name=[organization name]`

     - **Test Data Requirements:**
       - The FHIR server should contain at least one Organization resource representing a human contact, with the following characteristics:
         - `name.text`: Contains the organization name.
         - `contact.name.family`: Present and contains the expected family name.
         - `contact.name.given`: Present and contains the expected given name.

     - **Validation Criteria:**
       - **Response Status Code:** 200 (OK)
       - **Response Body:** The response bundle should contain at least one Organization resource matching the search criteria.
       - **Resource Validation:** The returned Organization resource representing the human contact should:
         - Have a `contact.name.family` element containing the expected family name.
         - Have a `contact.name.given` element containing the expected given name. 


---

<a id='req-40'></a>

### REQ-40: Practitioner qualification coding

**Description**: "When the value set for the coded concept in qualification is insufficient, the qualification can be provided in the text field of the codeableConcept."

**Actor**: Server

**Conformance**: None (Implementation guidance)

## Test Specification for REQ-40: Practitioner Qualification Coding

### 1. Requirement ID

REQ-40

### 2. Requirement Analysis

**Testability Assessment:** Hybrid (Combination of automated API calls and manual inspection)

**Complexity:** Moderate

**Prerequisites:**

* A running FHIR server with the Practitioner resource implemented.
* The Capability Statement for the server should indicate support for searching Practitioner resources by `_id`.
* Test Practitioner resources should be loaded into the server. These resources should include at least one Practitioner with:
    * A `qualification` element where the `coding.code` value is from a limited value set.
    * The same `qualification` element should also utilize the `text` field to provide additional qualification details not captured by the coded value. 

### 3. Test Implementation Strategy

#### 3.1 Required Inputs and Expected Outputs

**Inputs:**

* The `_id` of a Practitioner resource containing a `qualification` with both a coded value and a descriptive `text` field.

**Expected Outputs:**

* A successful response (HTTP 200 OK) with the requested Practitioner resource.
* The returned Practitioner resource should contain the `qualification` element with both the coded value and the descriptive `text` field as provided in the input data.

#### 3.2 Required FHIR Operations

* **Read:** Retrieve the Practitioner resource using its `_id` 
    * Example: `GET [base]/Practitioner/{id}`

#### 3.3 Test Data Requirements

* **Test Practitioner Resource:** A Practitioner resource should be created with the following characteristics:
    * **qualification:** 
        * **coding:**
            * **system:** [Appropriate code system URL]
            * **code:** [Code from a limited value set]
        * **text:** [Descriptive text providing additional qualification details not captured by the code]

#### 3.4 Validation Criteria

1. **API Response:** Verify that the FHIR server returns a successful response (HTTP 200 OK) when retrieving the Practitioner resource.
2. **Resource Content:** Verify that the returned Practitioner resource contains the `qualification` element with:
    * The correct `coding.system` and `coding.code` values as provided in the input data.
    * The correct descriptive text in the `text` field as provided in the input data.

**Manual Inspection:**

* Review the `text` field of the returned `qualification` element to ensure it provides meaningful additional information not captured by the coded value. This step requires human judgment to assess the quality and relevance of the provided text.

**Note:** This test specification focuses on verifying that the server can store and return both coded and textual representations of Practitioner qualifications. It does not explicitly test the "insufficiency" of the value set, as that would require subjective interpretation. 


---



