# Consolidated Test Plan for US Core IG

## Generated on: 2025-08-27 13:11:40

## API Type: claude

## Table of Contents

- [AllergyIntolerance](#allergyintolerance)
  - [REQ-451: US Core AllergyIntolerance Profile implementation](#req-451)
  - [REQ-566: Clinical status requirement for AllergyIntolerance](#req-566)
  - [REQ-567: Support for querying allergies by patient](#req-567)
  - [REQ-568: Support for querying allergies by patient and clinical status](#req-568)
  - [REQ-569: Code element requirement for AllergyIntolerance](#req-569)
  - [REQ-570: Patient reference requirement for AllergyIntolerance](#req-570)
  - [REQ-571: Verification status support requirement](#req-571)
  - [REQ-572: Reaction manifestation support requirement](#req-572)
- [Capability Statement](#capability-statement)
  - [REQ-484: Servers must include all applicable triggering event codes in notifications.](#req-484)
  - [REQ-488: Servers must adjust filter-criteria extensions to align with capabilities.](#req-488)
  - [REQ-489: Servers must process unadjusted Subscription requests as normal FHIR RESTful interactions.](#req-489)
  - [REQ-496: Servers must document supported resources, filters, and triggers.](#req-496)
  - [REQ-542: Return specific HTTP response classes](#req-542)
  - [REQ-543: Support JSON source formats](#req-543)
  - [REQ-544: Support XML source formats](#req-544)
  - [REQ-545: Identify supported US Core profiles in meta.profile](#req-545)
- [CarePlan](#careplan)
  - [REQ-452: US Core CarePlan Profile implementation](#req-452)
- [CareTeam](#careteam)
  - [REQ-453: US Core CareTeam Profile implementation](#req-453)
- [Condition](#condition)
  - [REQ-060: Condition SHALL have a category.](#req-060)
  - [REQ-061: Condition SHALL have a code.](#req-061)
  - [REQ-062: Condition SHALL have a recorded date.](#req-062)
  - [REQ-063: Condition SHALL have a recorder.](#req-063)
  - [REQ-316: Inclusion of SNOMED CT codes in the value set](#req-316)
  - [REQ-317: Inclusion of SNOMED CT codes for clinical findings](#req-317)
  - [REQ-318: Inclusion of SNOMED CT codes for context-dependent categories](#req-318)
  - [REQ-319: Inclusion of SNOMED CT codes for events](#req-319)
  - [REQ-321: Inclusion of ICD-9-CM codes in the value set](#req-321)
  - [REQ-349: The USCoreConditionEncounterDiagnosisProfile SHALL map the Condition.identifier to Event.identifier.](#req-349)
  - [REQ-350: The USCoreConditionEncounterDiagnosisProfile SHALL map the Condition.clinicalStatus to Event.status.](#req-350)
  - [REQ-351: The USCoreConditionEncounterDiagnosisProfile SHALL map the Condition.verificationStatus to Event.status.](#req-351)
  - [REQ-352: The USCoreConditionEncounterDiagnosisProfile SHALL map the Condition.code to Event.code.](#req-352)
  - [REQ-353: The USCoreConditionEncounterDiagnosisProfile SHALL map the Condition.subject to Event.subject.](#req-353)
  - [REQ-354: The USCoreConditionEncounterDiagnosisProfile SHALL map the Condition.encounter to Event.context.](#req-354)
  - [REQ-355: The USCoreConditionEncounterDiagnosisProfile SHALL map the Condition.onset[x] to Event.occurrence[x].](#req-355)
  - [REQ-356: The USCoreConditionEncounterDiagnosisProfile SHALL map the Condition.evidence.code to Event.reasonCode.](#req-356)
  - [REQ-357: The USCoreConditionEncounterDiagnosisProfile SHALL map the Condition.note to Event.note.](#req-357)
  - [REQ-398: The Condition resource SHALL map the identifier to Event.identifier.](#req-398)
  - [REQ-399: The Condition resource SHALL map clinicalStatus to Event.status.](#req-399)
  - [REQ-400: The Condition resource SHALL map verificationStatus to Event.status.](#req-400)
  - [REQ-401: The Condition resource SHALL map code to Event.code.](#req-401)
  - [REQ-402: The Condition resource SHALL map subject to Event.subject.](#req-402)
  - [REQ-403: The Condition resource SHALL map encounter to Event.context.](#req-403)
  - [REQ-404: The Condition resource SHALL map onset[x] to Event.occurrence[x].](#req-404)
  - [REQ-405: The Condition resource SHALL map evidence code to Event.reasonCode.](#req-405)
  - [REQ-406: The Condition resource SHALL map note to Event.note.](#req-406)
  - [REQ-454: US Core Condition Encounter Diagnosis Profile implementation](#req-454)
  - [REQ-455: US Core Condition Problems and Health Concerns Profile implementation](#req-455)
- [Coverage](#coverage)
  - [REQ-013: Coverage SHALL specify a payor.](#req-013)
  - [REQ-016: Coverage SHALL have a status of 'Active'.](#req-016)
  - [REQ-456: US Core Coverage Profile implementation](#req-456)
- [Device](#device)
  - [REQ-019: Device SHALL have a unique Device Identifier](#req-019)
  - [REQ-020: Device SHALL have a status of 'Active'](#req-020)
  - [REQ-021: Device SHALL have a manufacturer specified](#req-021)
  - [REQ-022: Device SHALL have an expiration date](#req-022)
  - [REQ-023: Device SHALL have a lot number](#req-023)
  - [REQ-024: Device SHALL have a serial number](#req-024)
  - [REQ-044: Device SHALL have a CarrierHRF for human-readable format.](#req-044)
  - [REQ-045: Device SHALL specify the EntryType.](#req-045)
  - [REQ-046: Device SHALL have a status.](#req-046)
  - [REQ-047: Device SHALL have a manufacturer.](#req-047)
  - [REQ-048: Device SHALL have a manufacture date.](#req-048)
  - [REQ-049: Device SHALL have an expiration date.](#req-049)
  - [REQ-050: Device SHALL have a lot number.](#req-050)
  - [REQ-051: Device SHALL have a serial number.](#req-051)
  - [REQ-052: Device SHALL have a model number.](#req-052)
  - [REQ-053: Device SHALL specify the type.](#req-053)
  - [REQ-457: US Core Implantable Device Profile implementation](#req-457)
- [DiagnosticReport](#diagnosticreport)
  - [REQ-186: The system shall ensure the DiagnosticReport status is set to "Final".](#req-186)
  - [REQ-207: DXA Bone density measurement report shall include specific measurement details.](#req-207)
  - [REQ-270: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport identifier to the Event.identifier.](#req-270)
  - [REQ-271: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport status to the Event.status.](#req-271)
  - [REQ-272: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport code to the Event.code.](#req-272)
  - [REQ-273: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport subject to the Event.subject.](#req-273)
  - [REQ-274: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport encounter to the Event.encounter.](#req-274)
  - [REQ-275: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport effective[x] to the Event.occurrence[x].](#req-275)
  - [REQ-276: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport performer to the Event.performer.actor.](#req-276)
  - [REQ-277: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport resultsInterpreter to the Event.performer.actor.](#req-277)
  - [REQ-278: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport identifier to OBR-51 for globally unique filler ID.](#req-278)
  - [REQ-279: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport identifier to a combination of OBR-2, OBR-3, and OBR-4 for non-globally unique filler-id.](#req-279)
  - [REQ-280: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport status to OBR-25.](#req-280)
  - [REQ-281: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport category to OBR-24.](#req-281)
  - [REQ-282: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport code to OBR-4.](#req-282)
  - [REQ-283: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport subject to PID-3.](#req-283)
  - [REQ-284: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport encounter to PV1-19.](#req-284)
  - [REQ-285: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport effective[x] to OBR-7.](#req-285)
  - [REQ-286: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport issued to OBR-22.](#req-286)
  - [REQ-287: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport performer to PRT-8 where PRT-4-Participation equals "PO".](#req-287)
  - [REQ-288: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport resultsInterpreter to OBR-32 and PRT-8 where PRT-4-Participation equals "PI".](#req-288)
  - [REQ-289: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport specimen to SPM.](#req-289)
  - [REQ-290: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport result to OBXs.](#req-290)
  - [REQ-291: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport media to OBX.](#req-291)
  - [REQ-292: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport conclusion to OBX.](#req-292)
  - [REQ-293: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport conclusionCode to OBX.](#req-293)
  - [REQ-294: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport presentedForm to OBX.](#req-294)
  - [REQ-295: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport identifier to FiveWs.identifier.](#req-295)
  - [REQ-296: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport status to FiveWs.status.](#req-296)
  - [REQ-297: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport category to FiveWs.class.](#req-297)
  - [REQ-298: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport code to FiveWs.what[x].](#req-298)
  - [REQ-299: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport subject to FiveWs.subject[x].](#req-299)
  - [REQ-300: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport encounter to FiveWs.context.](#req-300)
  - [REQ-301: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport effective[x] to FiveWs.done[x].](#req-301)
  - [REQ-302: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport issued to FiveWs.recorded.](#req-302)
  - [REQ-303: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport performer to FiveWs.actor.](#req-303)
  - [REQ-304: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport resultsInterpreter to FiveWs.actor.](#req-304)
  - [REQ-458: US Core DiagnosticReport Profile for Laboratory Results Reporting implementation](#req-458)
  - [REQ-459: US Core DiagnosticReport Profile for Report and Note Exchange implementation](#req-459)
- [DocumentReference](#documentreference)
  - [REQ-184: The system shall ensure the DocumentReference status is set to "Current".](#req-184)
  - [REQ-185: The system shall categorize the DocumentReference under "Clinical".](#req-185)
  - [REQ-460: US Core ADI DocumentReference Profile implementation](#req-460)
  - [REQ-461: US Core DocumentReference Profile implementation](#req-461)
- [Encounter](#encounter)
  - [REQ-041: Encounter status must be finished](#req-041)
  - [REQ-042: Encounter class must be ambulatory](#req-042)
  - [REQ-043: Encounter type must be office visit](#req-043)
  - [REQ-204: Search for encounters by discharge disposition code](#req-204)
  - [REQ-205: Support multiple OR conditions in discharge disposition search](#req-205)
  - [REQ-206: Support multiple AND conditions in discharge disposition search](#req-206)
  - [REQ-407: The Encounter resource SHALL map the identifier to Event.identifier.](#req-407)
  - [REQ-408: The Encounter resource SHALL map the status to Event.status.](#req-408)
  - [REQ-409: The Encounter resource SHALL map the type to Event.code.](#req-409)
  - [REQ-410: The Encounter resource SHALL map the serviceType to Event.code.](#req-410)
  - [REQ-411: The Encounter resource SHALL map the subject to Event.subject.](#req-411)
  - [REQ-412: The Encounter resource SHALL map the episodeOfCare to Event.context.](#req-412)
  - [REQ-413: The Encounter resource SHALL map the basedOn to Event.basedOn.](#req-413)
  - [REQ-414: The Encounter resource SHALL map the participant to Event.performer.](#req-414)
  - [REQ-415: The Encounter resource SHALL map the type to Event.performer.function.](#req-415)
  - [REQ-416: The Encounter resource SHALL map the individual to Event.performer.actor.](#req-416)
  - [REQ-417: The Encounter resource SHALL map the appointment to Event.basedOn.](#req-417)
  - [REQ-418: The Encounter resource SHALL map the period to Event.occurrence[x].](#req-418)
  - [REQ-419: The Encounter resource SHALL map the length to Event.occurrence[x].](#req-419)
  - [REQ-420: The Encounter resource SHALL map the reasonCode to Event.reasonCode.](#req-420)
  - [REQ-421: The Encounter resource SHALL map the reasonReference to Event.reasonCode.](#req-421)
  - [REQ-422: The Encounter resource SHALL map the condition to Event.reasonReference.](#req-422)
  - [REQ-462: US Core Encounter Profile implementation](#req-462)
  - [REQ-514: US Core Client SHALL fetch Encounter resources.](#req-514)
- [General/Cross-Resource](#general/cross-resource)
  - [REQ-208: The system should allow multiple OR conditions in search parameters.](#req-208)
  - [REQ-209: The system should allow multiple AND conditions in search parameters.](#req-209)
  - [REQ-213: The SearchParameter USCorePatientId SHALL NOT be used as a search parameter for search.](#req-213)
  - [REQ-214: Servers and Clients SHOULD use the standard FHIR SearchParameter instead of USCorePatientId.](#req-214)
  - [REQ-256: Include "problem-list-item" code in the value set](#req-256)
  - [REQ-257: Include "health-concern" code in the value set](#req-257)
  - [REQ-305: Inclusion of all CPT codes in the value set](#req-305)
  - [REQ-307: Inclusion of all HCPCS Level II codes in the value set](#req-307)
  - [REQ-309: Inclusion of all CDT codes in the value set](#req-309)
  - [REQ-310: Inclusion of all LOINC codes in the value set](#req-310)
  - [REQ-320: Inclusion of ICD-10-CM codes in the value set](#req-320)
  - [REQ-348: VSAC Code System Names must be mapped to FHIR Code System URIs.](#req-348)
  - [REQ-492: Servers must support at least one resource type from Table 1.](#req-492)
  - [REQ-493: Servers must support subscriptions for specified US Core profiles.](#req-493)
  - [REQ-494: Servers must support the `rest-hook` channel type for notifications.](#req-494)
  - [REQ-498: The USCDI Requirement Extension must have a URL with a specific value.](#req-498)
  - [REQ-499: The USCDI Requirement Extension must have a value of type boolean.](#req-499)
  - [REQ-501: Extension must have either extensions or value[x], not both.](#req-501)
  - [REQ-502: All FHIR elements must have a @value or children.](#req-502)
  - [REQ-503: Extension URL must be a URI for the Structure Definition.](#req-503)
  - [REQ-504: The extension value must be one of a constrained set of data types.](#req-504)
- [Goal](#goal)
  - [REQ-011: The Goal resource SHALL have a lifecycleStatus of "Active".](#req-011)
  - [REQ-463: US Core Goal Profile implementation](#req-463)
  - [REQ-515: US Core Client SHALL fetch Goal resources.](#req-515)
- [I cannot analyze this requirement because all the fields (Summary, Text, Context, Verification, Actor, Conformance, Conditional, and Source) are empty. Please provide the actual requirement content for me to categorize it appropriately.](#i-cannot-analyze-this-requirement-because-all-the-fields-(summary,-text,-context,-verification,-actor,-conformance,-conditional,-and-source)-are-empty.-please-provide-the-actual-requirement-content-for-me-to-categorize-it-appropriately.)
  - [R: No summary](#r)
- [Immunization](#immunization)
  - [REQ-368: The Immunization resource SHALL map the identifier to Event.identifier.](#req-368)
  - [REQ-369: The Immunization resource SHALL map the status to Event.status.](#req-369)
  - [REQ-370: The Immunization resource SHALL map the statusReason to Event.statusReason.](#req-370)
  - [REQ-371: The Immunization resource SHALL map the vaccineCode to Event.code.](#req-371)
  - [REQ-372: The Immunization resource SHALL map the patient to Event.subject.](#req-372)
  - [REQ-373: The Immunization resource SHALL map the encounter to Event.context.](#req-373)
  - [REQ-374: The Immunization resource SHALL map the occurrence[x] to Event.occurrence[x].](#req-374)
  - [REQ-375: The Immunization resource SHALL map the location to Event.location.](#req-375)
  - [REQ-376: The Immunization resource SHALL map the performer to Event.performer.](#req-376)
  - [REQ-377: The Immunization resource SHALL map the function to Event.performer.function.](#req-377)
  - [REQ-378: The Immunization resource SHALL map the actor to Event.performer.actor.](#req-378)
  - [REQ-379: The Immunization resource SHALL map the note to Event.note.](#req-379)
  - [REQ-380: The Immunization resource SHALL map the reasonCode to Event.reasonCode.](#req-380)
  - [REQ-381: The Immunization resource SHALL map the reasonReference to Event.reasonReference.](#req-381)
  - [REQ-382: The Immunization resource SHALL map the vaccineCode to RXA-5 in HL7 v2.](#req-382)
  - [REQ-383: The Immunization resource SHALL map the patient to PID-3 in HL7 v2.](#req-383)
  - [REQ-384: The Immunization resource SHALL map the encounter to PV1-19 in HL7 v2.](#req-384)
  - [REQ-385: The Immunization resource SHALL map the occurrence[x] to RXA-3 in HL7 v2.](#req-385)
  - [REQ-386: The Immunization resource SHALL map the primarySource to RXA-9 in HL7 v2.](#req-386)
  - [REQ-387: The Immunization resource SHALL map the reportOrigin to RXA-9 in HL7 v2.](#req-387)
  - [REQ-388: The Immunization resource SHALL map the location to RXA-27 or RXA-11 in HL7 v2.](#req-388)
  - [REQ-389: The Immunization resource SHALL map the manufacturer to RXA-17 in HL7 v2.](#req-389)
  - [REQ-390: The Immunization resource SHALL map the lotNumber to RXA-15 in HL7 v2.](#req-390)
  - [REQ-391: The Immunization resource SHALL map the expirationDate to RXA-16 in HL7 v2.](#req-391)
  - [REQ-392: The Immunization resource SHALL map the site to RXR-2 in HL7 v2.](#req-392)
  - [REQ-393: The Immunization resource SHALL map the route to RXR-1 in HL7 v2.](#req-393)
  - [REQ-394: The Immunization resource SHALL map the doseQuantity to RXA-6 or RXA-7 in HL7 v2.](#req-394)
  - [REQ-395: The Immunization resource SHALL map the performer to ORC-12 or RXA-10 in HL7 v2.](#req-395)
  - [REQ-396: The Immunization resource SHALL map the note to OBX-5 where OBX-3 equals 48767-8 in HL7 v2.](#req-396)
  - [REQ-397: The Immunization resource SHALL map isSubpotent to RXA-20 with value PA for partial administration in HL7 v2.](#req-397)
  - [REQ-464: US Core Immunization Profile implementation](#req-464)
  - [REQ-516: US Core Client SHALL fetch Immunization resources.](#req-516)
- [Location](#location)
  - [REQ-465: US Core Location Profile implementation](#req-465)
  - [REQ-517: US Core Client SHALL fetch Location resources.](#req-517)
- [Medication](#medication)
  - [REQ-001: The US Core Medication Profile SHALL support the medication code.](#req-001)
  - [REQ-018: The system SHALL support the USCoreMedicationAdherenceExtension.](#req-018)
  - [REQ-265: USCoreMedicationProfile SHALL map the medication code to the appropriate NCPDP SCRIPT 10.6 element.](#req-265)
  - [REQ-266: USCoreMedicationProfile SHALL map the medication form to the appropriate NCPDP SCRIPT 10.6 element.](#req-266)
  - [REQ-267: USCoreMedicationProfile SHALL map the medication strength to the appropriate NCPDP SCRIPT 10.6 element.](#req-267)
  - [REQ-466: US Core Medication Profile implementation](#req-466)
  - [REQ-518: US Core Client SHALL fetch Medication resources.](#req-518)
- [MedicationDispense](#medicationdispense)
  - [REQ-467: US Core MedicationDispense Profile implementation](#req-467)
  - [REQ-519: US Core Client SHALL fetch MedicationDispense resources.](#req-519)
- [MedicationRequest](#medicationrequest)
  - [REQ-107: MedicationRequest status must be set to "Active".](#req-107)
  - [REQ-108: MedicationRequest intent must be set to "Plan".](#req-108)
  - [REQ-109: MedicationRequest must include a medication.](#req-109)
  - [REQ-110: MedicationRequest must have a reason code.](#req-110)
  - [REQ-187: MedicationRequest SHALL specify the medication.](#req-187)
  - [REQ-188: MedicationRequest SHALL include dosage instructions.](#req-188)
  - [REQ-189: MedicationRequest SHALL specify the dispense request details.](#req-189)
  - [REQ-468: US Core MedicationRequest Profile implementation](#req-468)
  - [REQ-520: US Core Client SHALL fetch MedicationRequest resources.](#req-520)
- [Observation](#observation)
  - [REQ-003: Observation SHALL have a status of "Final"](#req-003)
  - [REQ-004: Observation SHALL include a category of "Social History" or "Physical Activity"](#req-004)
  - [REQ-005: Observation SHALL have a code of "Exercise Minutes Per Day"](#req-005)
  - [REQ-006: Observation SHALL include a category of "Social History"](#req-006)
  - [REQ-007: Observation SHALL have a code of "Pregnancy Intent"](#req-007)
  - [REQ-008: Observation SHALL have a code of "Pregnancy Status"](#req-008)
  - [REQ-009: Observation SHALL include a category of "Exam"](#req-009)
  - [REQ-010: Observation SHALL have a code of "Heart rate rhythm"](#req-010)
  - [REQ-012: Observation SHALL have an effective date.](#req-012)
  - [REQ-014: Observation SHALL include a performer.](#req-014)
  - [REQ-015: Observation SHALL include a value.](#req-015)
  - [REQ-017: Observation SHALL include a derivedFrom reference.](#req-017)
  - [REQ-025: Observation SHALL have a status of 'Final'](#req-025)
  - [REQ-026: Observation SHALL include a category of 'Vital Signs'](#req-026)
  - [REQ-027: Observation SHALL include a code for blood pressure](#req-027)
  - [REQ-028: Observation component SHALL include a code for systolic blood pressure](#req-028)
  - [REQ-029: Observation component SHALL include a value for systolic blood pressure](#req-029)
  - [REQ-030: Observation component SHALL include a code for diastolic blood pressure](#req-030)
  - [REQ-031: Observation SHALL include a category of 'Survey'](#req-031)
  - [REQ-032: Observation SHALL include a code for exercise engagement](#req-032)
  - [REQ-033: Observation SHALL include a value for exercise engagement](#req-033)
  - [REQ-034: Observation SHALL include a code for tobacco use](#req-034)
  - [REQ-035: Observation SHALL include a value for tobacco use](#req-035)
  - [REQ-036: Observation SHALL include a category of 'Laboratory'](#req-036)
  - [REQ-037: Observation SHALL include a code for Rapid Covid Antigen Test](#req-037)
  - [REQ-038: Observation SHALL include a value for Rapid Covid Antigen Test](#req-038)
  - [REQ-039: Observation SHALL include a code for alcohol consumption](#req-039)
  - [REQ-040: Observation SHALL include a value for alcohol consumption](#req-040)
  - [REQ-056: Observation SHALL have a status.](#req-056)
  - [REQ-057: Observation SHALL specify a category.](#req-057)
  - [REQ-058: Observation SHALL have a code.](#req-058)
  - [REQ-059: Observation SHALL have an effective date.](#req-059)
  - [REQ-064: Observation SHALL have a code.](#req-064)
  - [REQ-065: The system SHALL record the observation code as "Hispanic or Latino".](#req-065)
  - [REQ-066: The system SHALL record the performer of the observation.](#req-066)
  - [REQ-067: The system SHALL record the value of the observation.](#req-067)
  - [REQ-068: The system SHALL derive the observation from a specific questionnaire response.](#req-068)
  - [REQ-069: The system SHALL record the observation code as "Stress level".](#req-069)
  - [REQ-070: The system SHALL record the value of the observation as "Somewhat".](#req-070)
  - [REQ-071: The system SHALL record the observation code as "Patient Health Questionnaire 9 item (PHQ-9) total score [Reported]".](#req-071)
  - [REQ-072: The system SHALL record the value of the observation as "12".](#req-072)
  - [REQ-073: The system SHALL derive the observation from a specific PHQ-9 questionnaire response.](#req-073)
  - [REQ-074: The system SHALL record the observation code as "Poor appetite or overeating in last 2 weeks [Reported.PHQ]".](#req-074)
  - [REQ-075: The system SHALL record the value of the observation as "Several days".](#req-075)
  - [REQ-076: The system SHALL record the observation code as "Primary insurance".](#req-076)
  - [REQ-077: The system SHALL record the value of the observation as "Medicaid".](#req-077)
  - [REQ-078: The system shall record the value of an observation.](#req-078)
  - [REQ-079: The system shall categorize observations.](#req-079)
  - [REQ-080: The system shall record the value of an observation.](#req-080)
  - [REQ-081: Observation status must be set to "Final"](#req-081)
  - [REQ-082: Observation category must include "SDOH" and "Survey"](#req-082)
  - [REQ-083: Observation performer must match the subject](#req-083)
  - [REQ-084: Observation effective date must be specified](#req-084)
  - [REQ-085: Observation code must be specific to the context](#req-085)
  - [REQ-086: Observation must include a category of 'Survey' or 'Disability Status'](#req-086)
  - [REQ-087: Observation must include a code for the specific PHQ-9 question](#req-087)
  - [REQ-088: Observation must include a performer](#req-088)
  - [REQ-089: Observation must include a derivedFrom reference](#req-089)
  - [REQ-090: Observation must include a value for the PHQ-9 response](#req-090)
  - [REQ-091: Observation must include a code for the specific PHQ-9 question](#req-091)
  - [REQ-092: The system shall categorize observations.](#req-092)
  - [REQ-093: Observation must include a derivedFrom reference](#req-093)
  - [REQ-094: Observation status must be set to 'Final'](#req-094)
  - [REQ-095: Observation must include a category of 'SDOH' or 'Survey'](#req-095)
  - [REQ-096: Observation must include a code for the specific question being assessed](#req-096)
  - [REQ-097: Observation must have an effective date and time](#req-097)
  - [REQ-098: Observation must include a performer](#req-098)
  - [REQ-099: Observation must have a value indicating the response](#req-099)
  - [REQ-100: Observation must include a category of "Survey" or "Disability Status"](#req-100)
  - [REQ-101: Observation must include a category of "Survey"](#req-101)
  - [REQ-102: Observation must include a category of 'Vital Signs'](#req-102)
  - [REQ-103: Observation must include a code for average blood pressure](#req-103)
  - [REQ-104: Observation must include components for systolic and diastolic values](#req-104)
  - [REQ-105: Observation must include a component for the number of measurements](#req-105)
  - [REQ-106: Observation category must include "SDOH" and "Survey".](#req-106)
  - [REQ-111: Observation SHALL include a status of "Final".](#req-111)
  - [REQ-112: Observation SHALL specify the category as "SDOH, Survey".](#req-112)
  - [REQ-113: Observation SHALL specify the code as "Housing status".](#req-113)
  - [REQ-114: Observation SHALL include an effective date.](#req-114)
  - [REQ-115: Observation SHALL include a derivedFrom reference.](#req-115)
  - [REQ-116: Observation SHALL specify the category as "Survey, Disability Status".](#req-116)
  - [REQ-117: Observation SHALL specify the code as "Moving or speaking so slowly...".](#req-117)
  - [REQ-118: Observation SHALL include a category of "Laboratory"](#req-118)
  - [REQ-119: Observation category must be set to "Survey"](#req-119)
  - [REQ-120: Observation code must be "Exercise Vital Sign (EVS)"](#req-120)
  - [REQ-124: Observation status must be set to "Final"](#req-124)
  - [REQ-125: Observation category must be "Laboratory"](#req-125)
  - [REQ-126: Observation code must be "Hematocrit, Blood"](#req-126)
  - [REQ-127: Observation code must be "MCHC"](#req-127)
  - [REQ-128: Observation code must be "Glucose, Blood"](#req-128)
  - [REQ-129: Observation value must be expressed in mg/dL](#req-129)
  - [REQ-130: Observation category must be "Vital Signs"](#req-130)
  - [REQ-131: Observation code must be "Oxygen saturation in Arterial blood"](#req-131)
  - [REQ-132: Observation value must be expressed in percentage](#req-132)
  - [REQ-133: Observation code must be "Creatinine, Blood"](#req-133)
  - [REQ-134: Observation category must include "SDOH" and "Survey"](#req-134)
  - [REQ-135: Serum Sodium Observation SHALL have a code of "Sodium, Blood"](#req-135)
  - [REQ-136: MCV Observation SHALL have a code of "Mean Corpuscular Volume (MCV), Red blood cells"](#req-136)
  - [REQ-137: Hemoglobin Observation SHALL have a code of "Hemoglobin, Blood"](#req-137)
  - [REQ-138: MCH Observation SHALL have a status of "Final"](#req-138)
  - [REQ-139: MCH Observation SHALL have a category of "Laboratory"](#req-139)
  - [REQ-140: MCH Observation SHALL have a code of "Mean Corpuscular Hemoglobin (MCH), Red blood cells"](#req-140)
  - [REQ-141: MCH Observation SHALL have a value of 30 pg](#req-141)
  - [REQ-142: MCH Observation SHALL have an interpretation of "Normal"](#req-142)
  - [REQ-143: Serum Chloride Observation status requirement](#req-143)
  - [REQ-144: Serum Chloride Observation category requirement](#req-144)
  - [REQ-145: Serum Chloride Observation code requirement](#req-145)
  - [REQ-146: Serum Chloride Observation value requirement](#req-146)
  - [REQ-147: Serum CO2 Observation status requirement](#req-147)
  - [REQ-148: Serum CO2 Observation category requirement](#req-148)
  - [REQ-149: Serum CO2 Observation code requirement](#req-149)
  - [REQ-150: Serum CO2 Observation value requirement](#req-150)
  - [REQ-151: Serum Potassium Observation status requirement](#req-151)
  - [REQ-152: Serum Potassium Observation category requirement](#req-152)
  - [REQ-153: Serum Potassium Observation code requirement](#req-153)
  - [REQ-154: Serum Potassium Observation value requirement](#req-154)
  - [REQ-155: TAPS Item Observation status requirement](#req-155)
  - [REQ-156: TAPS Item Observation category requirement](#req-156)
  - [REQ-157: TAPS Item Observation code requirement](#req-157)
  - [REQ-158: TAPS Item Observation value requirement](#req-158)
  - [REQ-159: Observation SHALL have a status of "Final"](#req-159)
  - [REQ-160: Observation SHALL include a category of "Survey"](#req-160)
  - [REQ-161: Observation SHALL include a code for "10 minute Apgar Score"](#req-161)
  - [REQ-162: Observation SHALL have a performer](#req-162)
  - [REQ-163: Observation SHALL have a value with UCUM code](#req-163)
  - [REQ-164: Observation SHALL have a status of "Final"](#req-164)
  - [REQ-165: Observation SHALL include a category of "SDOH, Survey"](#req-165)
  - [REQ-166: Observation SHALL include a code for "Social and emotional health"](#req-166)
  - [REQ-167: Observation SHALL have a status of "Final"](#req-167)
  - [REQ-168: Observation SHALL include a category of "Laboratory"](#req-168)
  - [REQ-169: Observation SHALL include a code for "Platelet count, Blood"](#req-169)
  - [REQ-170: Observation SHALL have a performer](#req-170)
  - [REQ-171: Observation SHALL have a value with UCUM code](#req-171)
  - [REQ-172: Observation SHALL have a status of "Final"](#req-172)
  - [REQ-173: Observation SHALL include a category of "Laboratory"](#req-173)
  - [REQ-174: Observation SHALL include a code for "White blood cell (WBC) count, Blood"](#req-174)
  - [REQ-175: Observation SHALL have a performer](#req-175)
  - [REQ-176: Observation SHALL have a value with UCUM code](#req-176)
  - [REQ-177: The system shall ensure that the Observation status is set to "Final".](#req-177)
  - [REQ-178: The system shall categorize the Observation under "Laboratory".](#req-178)
  - [REQ-179: The system shall record the effective date of the Observation as 2005-07-05.](#req-179)
  - [REQ-180: The system shall ensure the Observation value is recorded as 4.58 10*6/uL.](#req-180)
  - [REQ-181: The system shall ensure the Observation interpretation is recorded as "Normal".](#req-181)
  - [REQ-182: The system shall ensure the Observation status for the Apgar Score Panel is set to "Final".](#req-182)
  - [REQ-183: The system shall categorize the Apgar Score Panel under "Survey".](#req-183)
  - [REQ-190: Observation SHALL specify the status.](#req-190)
  - [REQ-191: Observation SHALL include a category.](#req-191)
  - [REQ-193: The Observation resource SHALL include a status.](#req-193)
  - [REQ-194: The Observation resource SHALL include a category.](#req-194)
  - [REQ-195: The Observation resource SHALL include a code.](#req-195)
  - [REQ-196: The Observation resource SHALL include a subject.](#req-196)
  - [REQ-197: The Observation resource SHALL include an effective date/time.](#req-197)
  - [REQ-198: The Observation resource SHALL include a performer.](#req-198)
  - [REQ-268: The system SHALL support the 'final' status for smoking status observations.](#req-268)
  - [REQ-269: The system SHALL support the 'entered-in-error' status for smoking status observations.](#req-269)
  - [REQ-328: Conformant systems must support the minimum value set of category codes.](#req-328)
  - [REQ-423: The USCoreVitalSignsProfile SHALL map the Observation device to SNOMED CT concept < 49062001.](#req-423)
  - [REQ-424: The USCoreObservationPregnancyStatusProfile SHALL map the Observation identifier to Event.identifier.](#req-424)
  - [REQ-425: The USCoreObservationPregnancyStatusProfile SHALL map the Observation status to Event.status.](#req-425)
  - [REQ-426: The USCoreObservationPregnancyStatusProfile SHALL map the Observation code to Event.code.](#req-426)
  - [REQ-427: The USCoreObservationPregnancyStatusProfile SHALL map the Observation subject to Event.subject.](#req-427)
  - [REQ-428: The USCoreObservationPregnancyStatusProfile SHALL map the Observation effective[x] to Event.occurrence[x].](#req-428)
  - [REQ-429: The USCoreObservationPregnancyStatusProfile SHALL map the Observation performer to Event.performer.actor.](#req-429)
  - [REQ-430: The USCoreObservationPregnancyStatusProfile SHALL map the Observation status to OBX-11 in HL7 v2.](#req-430)
  - [REQ-431: The USCoreObservationPregnancyStatusProfile SHALL map the Observation code to OBX-3 in HL7 v2.](#req-431)
  - [REQ-432: The USCoreObservationPregnancyStatusProfile SHALL map the Observation subject to PID-3 in HL7 v2.](#req-432)
  - [REQ-433: The USCoreObservationPregnancyStatusProfile SHALL map the Observation effective[x] to OBX-14, and/or OBX-19 after v2.4 in HL7 v2.](#req-433)
  - [REQ-434: The USCoreObservationPregnancyStatusProfile SHALL map the Observation performer to OBX.15 / (Practitioner) OBX-16, PRT-5:PRT-4='RO' / (Device) OBX-18 , PRT-10:PRT-4='EQUIP' / (Organization) OBX-23, PRT-8:PRT-4='PO' in HL7 v2.](#req-434)
  - [REQ-435: The USCoreObservationPregnancyIntentProfile SHALL map the Observation.identifier to Event.identifier.](#req-435)
  - [REQ-436: The USCoreObservationPregnancyIntentProfile SHALL map the Observation.status to Event.status.](#req-436)
  - [REQ-437: The USCoreObservationPregnancyIntentProfile SHALL map the Observation.code to Event.code.](#req-437)
  - [REQ-438: The USCoreObservationPregnancyIntentProfile SHALL map the Observation.subject to Event.subject.](#req-438)
  - [REQ-439: The USCoreObservationPregnancyIntentProfile SHALL map the Observation.effective[x] to Event.occurrence[x].](#req-439)
  - [REQ-440: The USCoreObservationPregnancyIntentProfile SHALL map the Observation.performer to Event.performer.actor.](#req-440)
  - [REQ-441: The USCoreObservationPregnancyIntentProfile SHALL map the Observation.status to < 445584004 Report by finality status in SNOMED CT.](#req-441)
  - [REQ-442: The USCoreObservationPregnancyIntentProfile SHALL map the Observation.code to < 363787002 Observable entity OR < 386053000 Evaluation procedure in SNOMED CT.](#req-442)
  - [REQ-443: The USCoreObservationPregnancyIntentProfile SHALL map the Observation.value[x] to < 441742003 Evaluation finding in SNOMED CT.](#req-443)
  - [REQ-444: The USCoreObservationPregnancyIntentProfile SHALL map the Observation.interpretation to < 260245000 Findings values in SNOMED CT.](#req-444)
  - [REQ-445: The USCoreObservationPregnancyIntentProfile SHALL map the Observation.identifier to OBX.21 in HL7 v2.](#req-445)
  - [REQ-446: The USCoreObservationPregnancyIntentProfile SHALL map the Observation.status to OBX-11 in HL7 v2.](#req-446)
  - [REQ-447: The USCoreObservationPregnancyIntentProfile SHALL map the Observation.code to OBX-3 in HL7 v2.](#req-447)
  - [REQ-448: The USCoreObservationPregnancyIntentProfile SHALL map the Observation.subject to PID-3 in HL7 v2.](#req-448)
  - [REQ-449: The USCoreObservationPregnancyIntentProfile SHALL map the Observation.effective[x] to OBX-14, and/or OBX-19 after v2.4 in HL7 v2.](#req-449)
  - [REQ-450: The USCoreObservationPregnancyIntentProfile SHALL map the Observation.performer to OBX.15 in HL7 v2.](#req-450)
  - [REQ-469: US Core Average Blood Pressure Profile implementation](#req-469)
  - [REQ-470: US Core Care Experience Preference Profile implementation](#req-470)
  - [REQ-471: US Core Observation ADI Documentation Profile implementation](#req-471)
  - [REQ-472: US Core Observation Clinical Result Profile implementation](#req-472)
  - [REQ-473: US Core Laboratory Result Observation Profile implementation](#req-473)
  - [REQ-474: US Core Observation Occupation Profile implementation](#req-474)
  - [REQ-475: US Core Observation Pregnancy Intent Profile implementation](#req-475)
  - [REQ-476: The system SHALL map the Observation identifier to OBX.21 in HL7 v2.](#req-476)
  - [REQ-477: The system SHALL map the Observation status to OBX-11 in HL7 v2.](#req-477)
  - [REQ-478: The system SHALL map the Observation code to OBX-3 in HL7 v2.](#req-478)
  - [REQ-479: The system SHALL map the Observation subject to PID-3 in HL7 v2.](#req-479)
  - [REQ-480: The system SHALL map the Observation encounter to PV1 in HL7 v2.](#req-480)
  - [REQ-481: The system SHALL map the Observation effective[x] to OBX-14 in HL7 v2.](#req-481)
  - [REQ-482: The system SHALL map the Observation performer to OBX.15 in HL7 v2.](#req-482)
  - [REQ-483: Support for US Core Screening Assessment Observation Maximum Category](#req-483)
  - [REQ-510: Servers SHALL document support for writing Observation resources.](#req-510)
  - [REQ-521: US Core Client SHALL fetch Observation resources.](#req-521)
  - [REQ-533: Observation resource containment rules](#req-533)
  - [REQ-534: Observation resource reference rules](#req-534)
  - [REQ-535: Observation resource metadata rules](#req-535)
  - [REQ-536: Observation resource security label rules](#req-536)
  - [REQ-537: Observation narrative requirement](#req-537)
  - [REQ-538: Observation dataAbsentReason rules](#req-538)
  - [REQ-539: Observation code and component code rules](#req-539)
  - [REQ-540: Observation status binding requirement](#req-540)
  - [REQ-541: Observation category binding preference](#req-541)
  - [REQ-551: Observation resource SHALL NOT contain nested Resources if it is contained in another resource.](#req-551)
  - [REQ-552: Observation resource SHALL be referred to from elsewhere in the resource or refer to the containing resource if it is contained.](#req-552)
  - [REQ-553: Observation resource SHALL NOT have a meta.versionId or a meta.lastUpdated if it is contained.](#req-553)
  - [REQ-554: Observation resource SHALL NOT have a security label if it is contained.](#req-554)
  - [REQ-555: Observation resource should have narrative for robust management.](#req-555)
  - [REQ-556: dataAbsentReason SHALL only be present if Observation.value[x] is not present.](#req-556)
  - [REQ-557: If Observation.code is the same as an Observation.component.code, the value element associated with the code SHALL NOT be present.](#req-557)
  - [REQ-558: Observation.status codes SHALL be taken from ObservationStatus value set.](#req-558)
  - [REQ-559: Observation.category codes SHOULD be taken from ObservationCategoryCodes value set.](#req-559)
  - [REQ-560: Observation.code SHALL be supported and must use LOINC code 82810-3 for pregnancy status.](#req-560)
  - [REQ-561: Observation.subject SHALL reference a US Core Patient Profile.](#req-561)
  - [REQ-562: Observation.effective[x] SHALL be supported and use dateTime, Period, Timing, or instant data types.](#req-562)
  - [REQ-563: Observation.performer SHALL reference US Core Practitioner, Organization, Patient, PractitionerRole, CareTeam, or RelatedPerson profiles.](#req-563)
  - [REQ-564: Observation.value[x] SHALL be supported and use specified data types.](#req-564)
  - [REQ-565: Observation.value[x]:valueCodeableConcept codes SHOULD be taken from Pregnancy Status Observation value set.](#req-565)
  - [REQ-573: Observation resource containment rules](#req-573)
  - [REQ-574: Reference requirement for contained resources](#req-574)
  - [REQ-575: Meta data constraints for contained resources](#req-575)
  - [REQ-576: Security label constraints for contained resources](#req-576)
  - [REQ-577: Narrative requirement for resources](#req-577)
  - [REQ-578: Data absent reason constraint](#req-578)
  - [REQ-579: Observation code and component code constraint](#req-579)
  - [REQ-580: Component or hasMember element constraint](#req-580)
  - [REQ-581: Observation status codes requirement](#req-581)
  - [REQ-582: Observation category codes preference](#req-582)
  - [REQ-583: Observation code binding](#req-583)
  - [REQ-584: Observation effective time precision](#req-584)
  - [REQ-585: Observation value type requirement](#req-585)
  - [REQ-586: Observation value system requirement](#req-586)
  - [REQ-587: Observation value code requirement](#req-587)
  - [REQ-588: Observation data absent reason binding](#req-588)
  - [REQ-589: Observation interpretation codes binding](#req-589)
  - [REQ-590: Observation component value type requirement](#req-590)
  - [REQ-591: Observation component data absent reason binding](#req-591)
  - [REQ-592: Observation.component SHALL support at least one value or a dataAbsentReason.](#req-592)
- [Organization](#organization)
  - [REQ-121: Organization identifier must use NAIC Company Codes](#req-121)
  - [REQ-122: Organization must be active](#req-122)
  - [REQ-123: Organization type must be "Payer"](#req-123)
  - [REQ-210: The server must support a search on organization address fields.](#req-210)
  - [REQ-211: The server may support multipleOr search parameter.](#req-211)
  - [REQ-212: The server may support multipleAnd search parameter.](#req-212)
  - [REQ-522: US Core Client SHALL fetch Organization resources.](#req-522)
- [Patient](#patient)
  - [REQ-054: Patient SHALL have a medical record number.](#req-054)
  - [REQ-055: Patient SHALL have contact details.](#req-055)
  - [REQ-192: The system MAY support multiple AND conditions for the US Core Race search parameter.](#req-192)
  - [REQ-201: Search for patients by ethnicity extension code](#req-201)
  - [REQ-202: Support multiple OR conditions in ethnicity search](#req-202)
  - [REQ-203: Support multiple AND conditions in ethnicity search](#req-203)
  - [REQ-358: The USCorePatientProfile SHALL map the patient identifier to the HL7 v2 PID-3 field.](#req-358)
  - [REQ-359: The USCorePatientProfile SHALL map the patient name to the HL7 v2 PID-5 and PID-9 fields.](#req-359)
  - [REQ-360: The USCorePatientProfile SHALL map the patient gender to the HL7 v2 PID-8 field.](#req-360)
  - [REQ-361: The USCorePatientProfile SHALL map the patient birth date to the HL7 v2 PID-7 field.](#req-361)
  - [REQ-362: The USCorePatientProfile SHALL map the patient address to the HL7 v2 PID-11 field.](#req-362)
  - [REQ-363: The USCorePatientProfile SHALL map the patient marital status to the HL7 v2 PID-16 field.](#req-363)
  - [REQ-364: The USCorePatientProfile SHALL map the patient multiple birth indicator to the HL7 v2 PID-24 field.](#req-364)
  - [REQ-365: The USCorePatientProfile SHALL map the patient multiple birth order number to the HL7 v2 PID-25 field.](#req-365)
  - [REQ-366: The USCorePatientProfile SHALL map the patient communication language to the HL7 v2 PID-15 and LAN-2 fields.](#req-366)
  - [REQ-367: The USCorePatientProfile SHALL map the patient preferred language to the HL7 v2 PID-15 field.](#req-367)
  - [REQ-500: The extension must only be used on email contact points.](#req-500)
  - [REQ-505: The US Core Sex Extension URL requirement](#req-505)
  - [REQ-506: The US Core Sex Extension value requirement](#req-506)
  - [REQ-507: Extensible binding requirement for the US Core Sex Extension](#req-507)
  - [REQ-508: The value of the extension must be from a specified value set.](#req-508)
  - [REQ-513: Codes for the extension value must be taken from a specified value set.](#req-513)
  - [REQ-523: US Core Client SHALL fetch Patient resources.](#req-523)
- [Practitioner](#practitioner)
  - [REQ-329: The USCorePractitionerProfile SHALL map the identifier to PRD-7 or XCN.1 in HL7 v2.](#req-329)
  - [REQ-330: The USCorePractitionerProfile SHALL map the system to CX.4 or EI-2-4 in HL7 v2.](#req-330)
  - [REQ-331: The USCorePractitionerProfile SHALL map the value to CX.1 or EI.1 in HL7 v2.](#req-331)
  - [REQ-332: The USCorePractitionerProfile SHALL map the period to CX.7 + CX.8 in HL7 v2.](#req-332)
  - [REQ-333: The USCorePractitionerProfile SHALL map the assigner to CX.4 or (CX.4,CX.9,CX.10) in HL7 v2.](#req-333)
  - [REQ-334: The USCorePractitionerProfile SHALL map the name to XCN Components in HL7 v2.](#req-334)
  - [REQ-335: The USCorePractitionerProfile SHALL map the telecom system to XTN.3 in HL7 v2.](#req-335)
  - [REQ-336: The USCorePractitionerProfile SHALL map the telecom value to XTN.1 or XTN.12 in HL7 v2.](#req-336)
  - [REQ-337: The USCorePractitionerProfile SHALL map the address use to XAD.7 in HL7 v2.](#req-337)
  - [REQ-338: The USCorePractitionerProfile SHALL map the address type to XAD.18 in HL7 v2.](#req-338)
  - [REQ-339: The USCorePractitionerProfile SHALL map the address text to XAD.1 + XAD.2 + XAD.3 + XAD.4 + XAD.5 + XAD.6 in HL7 v2.](#req-339)
  - [REQ-340: The USCorePractitionerProfile SHALL map the address line to XAD.1 + XAD.2 in HL7 v2.](#req-340)
  - [REQ-341: The USCorePractitionerProfile SHALL map the address city to XAD.3 in HL7 v2.](#req-341)
  - [REQ-342: The USCorePractitionerProfile SHALL map the address state to XAD.4 in HL7 v2.](#req-342)
  - [REQ-343: The USCorePractitionerProfile SHALL map the address postalCode to XAD.5 in HL7 v2.](#req-343)
  - [REQ-344: The USCorePractitionerProfile SHALL map the address country to XAD.6 in HL7 v2.](#req-344)
  - [REQ-345: The USCorePractitionerProfile SHALL map the gender to STF-5 in HL7 v2.](#req-345)
  - [REQ-346: The USCorePractitionerProfile SHALL map the birthDate to STF-6 in HL7 v2.](#req-346)
  - [REQ-347: The USCorePractitionerProfile SHALL map the communication to PID-15, NK1-20, LAN-2 in HL7 v2.](#req-347)
  - [REQ-524: US Core Client SHALL fetch Practitioner resources.](#req-524)
- [PractitionerRole](#practitionerrole)
  - [REQ-215: The USCorePractitionerRoleProfile SHALL map the during to .effectiveTime in RIM Mapping.](#req-215)
  - [REQ-216: The USCorePractitionerRoleProfile SHALL map the availabilityExceptions to .effectiveTime in RIM Mapping.](#req-216)
  - [REQ-217: The USCorePractitionerRoleProfile SHALL map the identifier to ./Identifiers in ServD Mapping.](#req-217)
  - [REQ-218: The USCorePractitionerRoleProfile SHALL map the specialty to ./Specialty in ServD Mapping.](#req-218)
  - [REQ-219: The USCorePractitionerRoleProfile SHALL map the telecom system to ./ContactPointType in ServD Mapping.](#req-219)
  - [REQ-220: The USCorePractitionerRoleProfile SHALL map the telecom value to ./Value in ServD Mapping.](#req-220)
  - [REQ-221: The USCorePractitionerRoleProfile SHALL map the telecom use to ./ContactPointPurpose in ServD Mapping.](#req-221)
  - [REQ-222: The USCorePractitionerRoleProfile SHALL map the period to ./StartDate and ./EndDate in ServD Mapping.](#req-222)
  - [REQ-223: The USCorePractitionerRoleProfile SHALL map the identifier to FiveWs.identifier in FiveWs Pattern Mapping.](#req-223)
  - [REQ-224: The USCorePractitionerRoleProfile SHALL map the active status to FiveWs.status in FiveWs Pattern Mapping.](#req-224)
  - [REQ-225: The USCorePractitionerRoleProfile SHALL map the period to FiveWs.done[x] in FiveWs Pattern Mapping.](#req-225)
  - [REQ-226: The USCorePractitionerRoleProfile SHALL map the location to FiveWs.where[x] in FiveWs Pattern Mapping.](#req-226)
  - [REQ-525: US Core Client SHALL fetch PractitionerRole resources.](#req-525)
  - [REQ-547: PractitionerRole resource must have contact information or a reference to an Endpoint.](#req-547)
  - [REQ-548: PractitionerRole resource must have a practitioner, an organization, a healthcare service, or a location.](#req-548)
  - [REQ-549: Support searching practitioner role by specialty using the specialty search parameter.](#req-549)
  - [REQ-550: Support searching practitioner role by practitioner name and identifier using chained parameters.](#req-550)
- [Procedure](#procedure)
  - [REQ-002: The Procedure resource SHALL have a status of "Completed".](#req-002)
  - [REQ-306: Inclusion of SNOMED CT procedure codes](#req-306)
  - [REQ-308: Inclusion of all ICD-10-PCS codes in the value set](#req-308)
  - [REQ-526: US Core Client SHALL fetch Procedure resources.](#req-526)
- [Provenance](#provenance)
  - [REQ-527: US Core Client SHALL fetch Provenance resources.](#req-527)
- [Questionnaire](#questionnaire)
  - [REQ-227: Questionnaire item /88122-7 must allow specific answer options.](#req-227)
  - [REQ-228: Questionnaire item /88123-5 must allow specific answer options.](#req-228)
  - [REQ-229: Questionnaire item /88124-3 must allow specific answer options.](#req-229)
  - [REQ-259: The questionnaire SHALL include a question about the number of times a person has had X or more drinks in a day in the past year.](#req-259)
  - [REQ-260: The questionnaire SHALL display a help text specifying the value of X for men and women.](#req-260)
  - [REQ-261: The questionnaire SHALL include a question about the number of standard drinks containing alcohol consumed on a typical day.](#req-261)
  - [REQ-262: The questionnaire SHALL include a question about the frequency of consuming 6 or more drinks on one occasion.](#req-262)
  - [REQ-264: The questionnaire SHALL display a help text explaining the scoring system for AUDIT-C.](#req-264)
  - [REQ-509: The extension URL is fixed to a specific value.](#req-509)
  - [REQ-528: US Core Client SHALL fetch Questionnaire resources.](#req-528)
- [QuestionnaireResponse](#questionnaireresponse)
  - [REQ-199: The QuestionnaireResponse resource SHALL include a linkID.](#req-199)
  - [REQ-200: The QuestionnaireResponse resource SHALL include text for each item.](#req-200)
  - [REQ-263: The questionnaire SHALL calculate a total score for AUDIT-C.](#req-263)
  - [REQ-311: The system SHALL support the representation of personal characteristics in a QuestionnaireResponse.](#req-311)
  - [REQ-312: The system SHALL capture family and home information in a QuestionnaireResponse.](#req-312)
  - [REQ-313: The system SHALL record money and resources information in a QuestionnaireResponse.](#req-313)
  - [REQ-314: The system SHALL include social and emotional health data in a QuestionnaireResponse.](#req-314)
  - [REQ-315: The system SHALL support optional additional questions in a QuestionnaireResponse.](#req-315)
  - [REQ-529: US Core Client SHALL fetch QuestionnaireResponse resources.](#req-529)
  - [REQ-546: Nested items in QuestionnaireResponse](#req-546)
- [RelatedPerson](#relatedperson)
  - [REQ-530: US Core Client SHALL fetch RelatedPerson resources.](#req-530)
- [Security](#security)
  - [REQ-511: Servers SHALL support the registration and authorization of patient-facing apps with specific SMART scopes.](#req-511)
  - [REQ-512: Servers SHOULD support the registration and authorization of patient-facing apps with update capabilities.](#req-512)
- [ServiceRequest](#servicerequest)
  - [REQ-531: US Core Client SHALL fetch ServiceRequest resources.](#req-531)
- [Specimen](#specimen)
  - [REQ-230: The USCoreSpecimenProfile SHALL map the identifier to RIM Mapping.](#req-230)
  - [REQ-231: The USCoreSpecimenProfile SHALL map the accessionIdentifier to RIM Mapping.](#req-231)
  - [REQ-232: The USCoreSpecimenProfile SHALL map the status to RIM Mapping.](#req-232)
  - [REQ-233: The USCoreSpecimenProfile SHALL map the type to RIM Mapping.](#req-233)
  - [REQ-234: The USCoreSpecimenProfile SHALL map the subject to RIM Mapping.](#req-234)
  - [REQ-235: The USCoreSpecimenProfile SHALL map the receivedTime to RIM Mapping.](#req-235)
  - [REQ-236: The USCoreSpecimenProfile SHALL map the request to RIM Mapping.](#req-236)
  - [REQ-237: The USCoreSpecimenProfile SHALL map the collection to RIM Mapping.](#req-237)
  - [REQ-238: The USCoreSpecimenProfile SHALL map the collector to RIM Mapping.](#req-238)
  - [REQ-239: The USCoreSpecimenProfile SHALL map the collected[x] to RIM Mapping.](#req-239)
  - [REQ-240: The USCoreSpecimenProfile SHALL map the quantity to RIM Mapping.](#req-240)
  - [REQ-241: The USCoreSpecimenProfile SHALL map the method to RIM Mapping.](#req-241)
  - [REQ-242: The USCoreSpecimenProfile SHALL map the bodySite to RIM Mapping.](#req-242)
  - [REQ-243: The USCoreSpecimenProfile SHALL map the processing to RIM Mapping.](#req-243)
  - [REQ-244: The USCoreSpecimenProfile SHALL map the description to RIM Mapping.](#req-244)
  - [REQ-245: The USCoreSpecimenProfile SHALL map the procedure to RIM Mapping.](#req-245)
  - [REQ-246: The USCoreSpecimenProfile SHALL map the additive to RIM Mapping.](#req-246)
  - [REQ-247: The USCoreSpecimenProfile SHALL map the time[x] to RIM Mapping.](#req-247)
  - [REQ-248: The USCoreSpecimenProfile SHALL map the container to RIM Mapping.](#req-248)
  - [REQ-249: The USCoreSpecimenProfile SHALL map the container identifier to RIM Mapping.](#req-249)
  - [REQ-250: The USCoreSpecimenProfile SHALL map the container description to RIM Mapping.](#req-250)
  - [REQ-251: The USCoreSpecimenProfile SHALL map the container type to RIM Mapping.](#req-251)
  - [REQ-252: The USCoreSpecimenProfile SHALL map the container capacity to RIM Mapping.](#req-252)
  - [REQ-253: The USCoreSpecimenProfile SHALL map the specimenQuantity to RIM Mapping.](#req-253)
  - [REQ-254: The USCoreSpecimenProfile SHALL map the additive[x] to RIM Mapping.](#req-254)
  - [REQ-255: The USCoreSpecimenProfile SHALL map the note to RIM Mapping.](#req-255)
  - [REQ-326: Import codes from specified value sets](#req-326)
  - [REQ-327: Exclusion of specific codes](#req-327)
  - [REQ-532: US Core Client SHALL fetch Specimen resources.](#req-532)
- [Subscription](#subscription)
  - [REQ-485: Servers must allow clients to create Subscriptions with filter criteria.](#req-485)
  - [REQ-486: Servers must process all filter-criteria extensions provided by the client.](#req-486)
  - [REQ-487: Clients must not include filters for different patients in the same Subscription.](#req-487)
  - [REQ-490: Servers must persist adjusted Subscription resources with status "error".](#req-490)
  - [REQ-491: Clients must review persisted Subscription resources for status and filters.](#req-491)
- [Subscriptions](#subscriptions)
  - [REQ-497: Clients must review server documentation for `feed-event` notifications.](#req-497)
- [Subscriptions/Notifications](#subscriptions/notifications)
  - [REQ-495: Servers must support `empty` and `id-only` payload types.](#req-495)
- [Terminology/ValueSet](#terminology/valueset)
  - [REQ-322: Include all codes from US Core Category CodeSystem](#req-322)
  - [REQ-323: Include specific SNOMED CT codes](#req-323)
- [ValueSet](#valueset)
  - [REQ-258: Inclusion of specific LOINC codes in the value set](#req-258)
  - [REQ-325: Import codes from specified value sets](#req-325)
- [ValueSet/Terminology](#valueset/terminology)
  - [REQ-324: Import all codes from Service Request Category Codes ValueSet](#req-324)

## Test Specifications

<a id='allergyintolerance'></a>

## AllergyIntolerance

<a id='req-451'></a>

### REQ-451: US Core AllergyIntolerance Profile implementation

**Text**: 

**Context**: System conformance to US Core AllergyIntolerance Profile.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-451: US Core AllergyIntolerance Profile Implementation

## 1. Requirement ID
**REQ-451**

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be validated through automated testing by verifying profile conformance, supported operations, and search parameter functionality.

### Complexity
**Moderate** - The requirement involves testing multiple aspects including profile conformance, CRUD operations, search parameters, and _revinclude functionality.

### Prerequisites
- System must have a functional FHIR R4 server endpoint
- System must have AllergyIntolerance resources available for testing
- System must support the US Core AllergyIntolerance Profile
- Patient resources must be available to support patient-based searches
- Provenance resources should be available for _revinclude testing (optional but recommended)

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Server Base URL**: The base endpoint for the FHIR server
- **Test Patient ID**: A valid patient identifier with associated allergy/intolerance data
- **Test AllergyIntolerance ID**: A valid AllergyIntolerance resource identifier
- **Authentication Credentials**: If required by the system

### Expected Outputs
- Valid US Core AllergyIntolerance Profile-compliant resources
- Proper HTTP response codes (200, 404, etc.)
- Correctly formatted FHIR Bundle responses for searches
- Provenance resources when using _revinclude (if supported)

### Required FHIR Operations

#### Core Operations (SHALL Support)
1. **READ Operation**: `GET [base]/AllergyIntolerance/[id]`
2. **SEARCH-TYPE Operation**: `GET [base]/AllergyIntolerance?[parameters]`

#### Optional Operations (SHOULD/MAY Support)
3. **VREAD Operation**: `GET [base]/AllergyIntolerance/[id]/_history/[vid]`
4. **HISTORY-INSTANCE Operation**: `GET [base]/AllergyIntolerance/[id]/_history`

### Validation Criteria

#### 1. Profile Conformance Validation
**Test Case 1.1: US Core AllergyIntolerance Profile Compliance**
- **Action**: Retrieve AllergyIntolerance resources using READ and SEARCH operations
- **Assertions**:
  - All returned AllergyIntolerance resources SHALL conform to US Core AllergyIntolerance Profile
  - Resources SHALL contain all required elements per the profile
  - Resources SHALL use appropriate value sets and coding systems
  - Must Support elements SHALL be present when data is available

#### 2. Required Search Parameter Testing
**Test Case 2.1: Patient Search Parameter (SHALL)**
- **Action**: `GET [base]/AllergyIntolerance?patient=[patient-id]`
- **Assertions**:
  - Server SHALL support search by patient parameter
  - Server SHALL accept both id value alone and Type+id values
  - All returned resources SHALL be for the specified patient
  - Response SHALL be a valid Bundle with AllergyIntolerance resources

#### 3. Optional Search Parameter Combinations Testing
**Test Case 3.1: Patient + Clinical-Status Search (SHOULD)**
- **Action**: `GET [base]/AllergyIntolerance?patient=[patient-id]&clinical-status=[status-code]`
- **Assertions**:
  - If supported, server SHALL return only resources matching both criteria
  - Server SHALL support both system+code and code-only formats for clinical-status
  - All returned resources SHALL match the specified clinical status

#### 4. Required Operations Testing
**Test Case 4.1: READ Operation**
- **Action**: `GET [base]/AllergyIntolerance/[id]`
- **Assertions**:
  - Server SHALL support READ operation
  - SHALL return 200 OK with valid AllergyIntolerance resource when resource exists
  - SHALL return 404 Not Found when resource does not exist
  - Returned resource SHALL conform to US Core AllergyIntolerance Profile

**Test Case 4.2: SEARCH-TYPE Operation**
- **Action**: `GET [base]/AllergyIntolerance?patient=[patient-id]`
- **Assertions**:
  - Server SHALL support SEARCH-TYPE operation
  - SHALL return 200 OK with Bundle containing matching resources
  - Bundle SHALL contain only AllergyIntolerance resources matching search criteria
  - Each entry SHALL conform to US Core AllergyIntolerance Profile

#### 5. _revinclude Support Testing
**Test Case 5.1: Provenance _revinclude (SHALL)**
- **Action**: `GET [base]/AllergyIntolerance?patient=[patient-id]&_revinclude=Provenance:target`
- **Assertions**:
  - Server SHALL support _revinclude=Provenance:target
  - If Provenance resources exist targeting returned AllergyIntolerance resources, they SHALL be included in the Bundle
  - Included Provenance resources SHALL be valid FHIR Provenance resources
  - Bundle structure SHALL be valid with proper entry relationships

#### 6. Search Parameter Requirements Testing
**Test Case 6.1: Patient Reference Parameter Formats**
- **Action**: Test both formats:
  - `GET [base]/AllergyIntolerance?patient=[id]`
  - `GET [base]/AllergyIntolerance?patient=Patient/[id]`
- **Assertions**:
  - Server SHALL support both id-only and Type+id formats
  - Both searches SHALL return equivalent results for the same patient

**Test Case 6.2: Clinical-Status Token Parameter Formats**
- **Action**: Test both formats (if clinical-status search is supported):
  - `GET [base]/AllergyIntolerance?patient=[patient-id]&clinical-status=[code]`
  - `GET [base]/AllergyIntolerance?patient=[patient-id]&clinical-status=[system]|[code]`
- **Assertions**:
  - Server SHALL support both code-only and system|code formats
  - Results SHALL be consistent across both formats when using same logical code

#### 7. Error Handling Testing
**Test Case 7.1: Invalid Resource ID**
- **Action**: `GET [base]/AllergyIntolerance/invalid-id`
- **Assertions**:
  - Server SHALL return 404 Not Found
  - Response SHALL include appropriate OperationOutcome if provided

**Test Case 7.2: Invalid Search Parameters**
- **Action**: `GET [base]/AllergyIntolerance?invalid-param=value`
- **Assertions**:
  - Server behavior SHALL be consistent with FHIR specification for unsupported parameters
  - Server MAY ignore unknown parameters or return error as appropriate

#### 8. Optional Operations Testing (If Supported)
**Test Case 8.1: VREAD Operation (SHOULD)**
- **Action**: `GET [base]/AllergyIntolerance/[id]/_history/[vid]` (if supported)
- **Assertions**:
  - If supported, SHALL return specific version of resource
  - Returned resource SHALL conform to US Core AllergyIntolerance Profile

**Test Case 8.2: HISTORY-INSTANCE Operation (SHOULD)**
- **Action**: `GET [base]/AllergyIntolerance/[id]/_history` (if supported)
- **Assertions**:
  - If supported, SHALL return Bundle with history of the resource
  - All versions SHALL conform to US Core AllergyIntolerance Profile

### Pass/Fail Criteria
- **Pass**: System successfully demonstrates conformance to US Core AllergyIntolerance Profile requirements including required operations, search parameters, and profile compliance
- **Fail**: System fails to support required operations, search parameters, or returns non-conformant resources
- **Partial**: System supports core functionality but may lack some SHOULD-level features (document any limitations)

---

<a id='req-566'></a>

### REQ-566: Clinical status requirement for AllergyIntolerance

**Text**: 

**Context**: AllergyIntolerance profile-specific guidance for clinicalStatus presence

**Actor**: Implementing system

**Conformance**: SHALL

# Test Specification for REQ-566

## Requirement ID
REQ-566

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated through automated testing by examining AllergyIntolerance resources and their clinicalStatus field presence based on the conditional nature specified in the profile-specific guidance.

### Complexity
**Moderate** - The requirement involves understanding the conditional nature of clinicalStatus presence in AllergyIntolerance resources and validating against US Core profile requirements.

### Prerequisites
- Server must support US Core AllergyIntolerance Profile
- Server must have AllergyIntolerance resources available for testing
- Test system must be able to perform FHIR read and search operations
- Understanding of when clinicalStatus is required vs optional based on profile-specific guidance

## Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: AllergyIntolerance resources conforming to US Core AllergyIntolerance Profile
- **Test Data**: Mix of AllergyIntolerance resources that should have clinicalStatus present and those where it may be optional
- **Search Parameters**: Patient reference for retrieving AllergyIntolerance resources

### Expected Outputs
- AllergyIntolerance resources with appropriate clinicalStatus presence based on profile requirements
- Validation results confirming conformance to clinical status requirements
- Error responses for non-conformant resources (if applicable)

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required for testing:

1. **GET [base]/AllergyIntolerance/[id]** - Read operation (SHALL support)
2. **GET [base]/AllergyIntolerance?patient=[patient-id]** - Search by patient (SHALL support)
3. **GET [base]/AllergyIntolerance?patient=[patient-id]&clinical-status=[status]** - Search by patient and clinical status (SHOULD support)

### Validation Criteria

#### Test Case 1: Validate clinicalStatus Presence in Active Allergies
**Objective**: Verify that active AllergyIntolerance resources have clinicalStatus present when required by profile guidance

**Test Steps**:
1. Search for AllergyIntolerance resources using patient parameter
2. For each returned AllergyIntolerance resource:
   - Validate the resource conforms to US Core AllergyIntolerance Profile
   - Check if clinicalStatus is present when required by profile-specific guidance
   - Verify clinicalStatus values are from the required value set if present

**Pass Criteria**:
- All AllergyIntolerance resources that require clinicalStatus have the field present
- clinicalStatus values conform to the bound value set
- Resources validate against the US Core AllergyIntolerance Profile

#### Test Case 2: Search Functionality with Clinical Status
**Objective**: Verify server supports searching AllergyIntolerance by clinical status

**Test Steps**:
1. Perform search: `GET [base]/AllergyIntolerance?patient=[patient-id]&clinical-status=active`
2. Verify all returned resources have clinicalStatus = "active"
3. Perform search with different clinical status values (inactive, resolved)
4. Validate search results match the specified clinical status

**Pass Criteria**:
- Server returns appropriate AllergyIntolerance resources based on clinical status search
- Returned resources have the specified clinical status value
- Search functionality works as expected per capability statement (SHOULD support)

#### Test Case 3: Resource Validation Against Profile Requirements
**Objective**: Ensure AllergyIntolerance resources meet profile-specific guidance for clinicalStatus

**Test Steps**:
1. Read individual AllergyIntolerance resources using resource ID
2. Validate each resource against US Core AllergyIntolerance Profile
3. Check conditional requirements for clinicalStatus based on profile guidance
4. Verify resource structure and required elements

**Pass Criteria**:
- Resources validate successfully against US Core AllergyIntolerance Profile
- clinicalStatus field presence aligns with profile-specific conditional requirements
- All must-support elements are present as required
- Resource structure follows FHIR R4 specification

#### Test Case 4: Error Handling for Invalid Clinical Status
**Objective**: Verify appropriate error handling for invalid clinical status searches

**Test Steps**:
1. Attempt search with invalid clinical status value
2. Verify server returns appropriate error response
3. Test edge cases and boundary conditions

**Pass Criteria**:
- Server returns appropriate HTTP status codes for invalid requests
- Error messages are informative and follow FHIR standards
- Server handles malformed requests gracefully

### Additional Validation Points
- Verify that the clinical status search parameter supports both code-only and system+code value formats as specified in the capability statement
- Ensure _revinclude=Provenance:target functionality works when searching AllergyIntolerance resources
- Validate that search results include proper FHIR Bundle structure with appropriate metadata
- Confirm that the server supports the required conformance level (SHALL) for patient search parameter

---

<a id='req-567'></a>

### REQ-567: Support for querying allergies by patient

**Text**: 

**Context**: AllergyIntolerance mandatory server search capability by patient

**Actor**: Server

**Conformance**: SHALL

# Test Specification for REQ-567

## 1. Requirement ID
REQ-567

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified through automated API calls to test the mandatory search capability for AllergyIntolerance resources by patient parameter.

### Complexity
**Simple** - This is a straightforward search parameter validation that requires testing a single mandatory search capability.

### Prerequisites
- Server must implement US Core AllergyIntolerance Profile
- Server must have AllergyIntolerance resources with patient references available for testing
- Test client must have valid patient identifiers to use in search queries
- Server must support the `search-type` interaction for AllergyIntolerance resources (as specified in the Capability Statement)

## 3. Test Implementation Strategy

### Required Inputs
- **Patient Identifier**: Valid patient ID or reference that exists on the server
- **Expected AllergyIntolerance Resources**: Server should have at least one AllergyIntolerance resource associated with the test patient

### Required FHIR Operations
Based on the Capability Statement, the following operations are required:
- `GET [base]/AllergyIntolerance?patient=[patient-id]` - Search AllergyIntolerance by patient (SHALL support)
- `GET [base]/AllergyIntolerance?patient=Patient/[patient-id]` - Search with full Patient reference (SHALL support both id and Type+id values)

### Validation Criteria

#### Test Case 1: Basic Patient Search by ID
**Request**: `GET [base]/AllergyIntolerance?patient=[patient-id]`

**Assertions**:
1. Server returns HTTP 200 OK status
2. Response is a valid FHIR Bundle resource
3. Bundle.type is "searchset"
4. All returned AllergyIntolerance resources conform to US Core AllergyIntolerance Profile
5. All returned AllergyIntolerance resources have `patient` element referencing the searched patient
6. If no results exist, Bundle.total should be 0 with empty entry array

#### Test Case 2: Patient Search with Type and ID
**Request**: `GET [base]/AllergyIntolerance?patient=Patient/[patient-id]`

**Assertions**:
1. Server returns HTTP 200 OK status
2. Response is a valid FHIR Bundle resource
3. Bundle.type is "searchset"
4. All returned AllergyIntolerance resources conform to US Core AllergyIntolerance Profile
5. All returned AllergyIntolerance resources have `patient` element referencing the searched patient
6. Results should be identical to Test Case 1 (server SHALL support both formats)

#### Test Case 3: Invalid Patient Reference
**Request**: `GET [base]/AllergyIntolerance?patient=[non-existent-patient-id]`

**Assertions**:
1. Server returns HTTP 200 OK status
2. Response is a valid FHIR Bundle resource
3. Bundle.total is 0
4. Bundle.entry array is empty or not present

#### Test Case 4: Malformed Patient Parameter
**Request**: `GET [base]/AllergyIntolerance?patient=`

**Assertions**:
1. Server returns appropriate error response (400 Bad Request or similar)
2. Response includes OperationOutcome with meaningful error message

#### Additional Validation Requirements
1. **Profile Conformance**: All returned AllergyIntolerance resources must validate against the US Core AllergyIntolerance Profile
2. **Patient Reference Validation**: Each returned resource's `patient` element must contain either:
   - A logical id that matches the search parameter
   - A relative reference (e.g., "Patient/123") where the id portion matches the search parameter
   - An absolute reference where the patient id matches the search parameter
3. **Search Parameter Requirements**: Server must support both formats as specified in the Capability Statement:
   - Client provides at least an id value
   - Server supports both id-only and Type+id formats

#### Performance Considerations
- Test should verify that the search completes within reasonable time limits
- Large result sets should be handled appropriately (pagination support is recommended but not required for this basic test)

#### Data Requirements
- Test data should include patients with various allergy/intolerance scenarios
- At least one patient should have multiple AllergyIntolerance resources
- At least one patient should have no AllergyIntolerance resources
- Test should work with existing server data without requiring specific test fixtures

---

<a id='req-568'></a>

### REQ-568: Support for querying allergies by patient and clinical status

**Text**: 

**Context**: AllergyIntolerance optional server search capability combining parameters

**Actor**: Server

**Conformance**: SHOULD

# Test Specification for REQ-568

## 1. Requirement ID
REQ-568

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated through automated API testing by executing search queries with the specified parameter combination and verifying server responses.

### Complexity
**Simple** - The requirement involves testing a single search parameter combination (patient + clinical-status) against the AllergyIntolerance resource.

### Prerequisites
- Server must implement US Core AllergyIntolerance Profile
- Server must have AllergyIntolerance resources with populated patient and clinical-status fields
- Test system must have valid patient identifiers to use in search queries
- Server must support the search-type interaction for AllergyIntolerance resources (required by capability statement)

## 3. Test Implementation Strategy

### Required Inputs
- **Patient identifiers**: One or more valid patient IDs that exist in the server's AllergyIntolerance resources
- **Clinical status codes**: Valid clinical status values (e.g., "active", "inactive", "resolved") that exist in the server's data
- **Base FHIR server URL**: The server endpoint being tested

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required for testing:

1. **Search AllergyIntolerance by patient + clinical-status combination**:
   ```
   GET [base]/AllergyIntolerance?patient=[patient-id]&clinical-status=[status-code]
   ```

2. **Reference search variations** (as per search parameter requirements):
   - Patient by ID only: `patient=[id]`
   - Patient by Type and ID: `patient=Patient/[id]`

3. **Token search variations** (as per search parameter requirements):
   - Clinical status by code only: `clinical-status=[code]`
   - Clinical status by system and code: `clinical-status=[system]|[code]`

### Validation Criteria

#### Test Case 1: Basic Patient + Clinical Status Search
**Objective**: Verify server supports the SHOULD-level search parameter combination

**Test Steps**:
1. Execute search: `GET [base]/AllergyIntolerance?patient=[patient-id]&clinical-status=active`
2. Verify HTTP response status is 200 OK
3. Verify response is a valid FHIR Bundle
4. Verify all returned AllergyIntolerance resources match the search criteria:
   - Each resource's `subject` field references the specified patient
   - Each resource's `clinicalStatus` field contains the specified status value
5. Verify resources conform to US Core AllergyIntolerance Profile

#### Test Case 2: Patient Reference Variations
**Objective**: Verify server supports both patient reference formats as required

**Test Steps**:
1. Execute search with patient ID only: `GET [base]/AllergyIntolerance?patient=[id]&clinical-status=active`
2. Execute search with patient type and ID: `GET [base]/AllergyIntolerance?patient=Patient/[id]&clinical-status=active`
3. Verify both searches return equivalent results
4. Verify server accepts both reference formats without error

#### Test Case 3: Clinical Status Token Variations
**Objective**: Verify server supports both clinical status token formats as required

**Test Steps**:
1. Execute search with code only: `GET [base]/AllergyIntolerance?patient=[patient-id]&clinical-status=[code]`
2. Execute search with system and code: `GET [base]/AllergyIntolerance?patient=[patient-id]&clinical-status=http://terminology.hl7.org/CodeSystem/allergyintolerance-clinical|[code]`
3. Verify both searches return equivalent results
4. Verify server accepts both token formats without error

#### Test Case 4: Multiple Clinical Status Values
**Objective**: Verify server can handle multiple clinical status values in the same search

**Test Steps**:
1. Execute search: `GET [base]/AllergyIntolerance?patient=[patient-id]&clinical-status=active,inactive`
2. Verify response includes AllergyIntolerance resources with either clinical status
3. Verify all returned resources still match the specified patient

#### Test Case 5: Empty Result Set Handling
**Objective**: Verify server properly handles searches with no matching results

**Test Steps**:
1. Execute search with patient and clinical status combination that should return no results
2. Verify HTTP response status is 200 OK
3. Verify response is a valid FHIR Bundle with total count of 0
4. Verify Bundle.entry array is empty or absent

#### Pass/Fail Criteria
**Test passes if**:
- Server returns 200 OK for all valid search requests
- All returned AllergyIntolerance resources match the search criteria
- Server supports both patient reference formats (ID only and Type/ID)
- Server supports both clinical status token formats (code only and system/code)
- Response bundles are valid FHIR format
- Resources conform to US Core AllergyIntolerance Profile constraints
- Empty result sets are handled appropriately

**Test fails if**:
- Server returns 4xx or 5xx errors for properly formatted requests
- Server returns resources that don't match the search criteria
- Server doesn't support required reference or token format variations
- Response format is invalid or non-conformant
- Server claims to support the search but returns inconsistent results

#### Additional Considerations
- Since this is a SHOULD-level requirement, servers may choose not to implement this search combination, in which case they should return an appropriate error (e.g., 400 Bad Request with OperationOutcome explaining unsupported parameters)
- Test should verify that if the server does support this search combination, it implements it correctly according to the specification
- Testing should use the server's existing data rather than requiring specific test fixtures

---

<a id='req-569'></a>

### REQ-569: Code element requirement for AllergyIntolerance

**Text**: 

**Context**: AllergyIntolerance mandatory element presence

**Actor**: Implementing system

**Conformance**: Must

# Test Specification for REQ-569

## 1. Requirement ID
REQ-569

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified through automated validation of AllergyIntolerance resource structure and the presence of mandatory code elements.

### Complexity
**Simple** - The requirement focuses on the presence of mandatory code elements in AllergyIntolerance resources, which can be directly validated against the US Core AllergyIntolerance Profile structure.

### Prerequisites
- System must support the US Core AllergyIntolerance Profile
- System must have AllergyIntolerance resources available for testing
- System must support FHIR R4 specification
- Test client must have appropriate authentication/authorization to access AllergyIntolerance resources

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: AllergyIntolerance resources conforming to US Core AllergyIntolerance Profile
- **Patient Reference**: Valid patient identifier to search for AllergyIntolerance resources
- **System Endpoint**: Base FHIR server URL supporting US Core AllergyIntolerance Profile

### Expected Outputs
- AllergyIntolerance resources with all mandatory code elements present
- Proper structure validation against US Core AllergyIntolerance Profile
- Confirmation that code elements meet cardinality and binding requirements

### Required FHIR Operations

#### Primary Operations (SHALL Support - from Capability Statement)
1. **Search by Patient**
   ```
   GET [base]/AllergyIntolerance?patient=[patient-id]
   ```

2. **Read Individual Resource**
   ```
   GET [base]/AllergyIntolerance/[id]
   ```

#### Optional Operations (SHOULD/MAY Support)
3. **Search with Clinical Status** (SHOULD)
   ```
   GET [base]/AllergyIntolerance?patient=[patient-id]&clinical-status=[status]
   ```

4. **Version Read** (SHOULD)
   ```
   GET [base]/AllergyIntolerance/[id]/_history/[vid]
   ```

### Validation Criteria

#### Core Validation Checks

1. **Profile Conformance**
   - Verify each retrieved AllergyIntolerance resource conforms to US Core AllergyIntolerance Profile
   - Validate against StructureDefinition-us-core-allergyintolerance

2. **Mandatory Code Element Presence**
   - Verify `AllergyIntolerance.code` is present (cardinality 1..1)
   - Verify `AllergyIntolerance.clinicalStatus` is present (cardinality 1..1)
   - Verify `AllergyIntolerance.verificationStatus` is present (cardinality 1..1)
   - Verify `AllergyIntolerance.category` is present (cardinality 1..*)
   - Verify `AllergyIntolerance.criticality` is present if system supports it (cardinality 0..1)

3. **Code Element Value Validation**
   - Verify `AllergyIntolerance.code` uses appropriate value set binding (extensible)
   - Verify `AllergyIntolerance.clinicalStatus` uses required value set binding
   - Verify `AllergyIntolerance.verificationStatus` uses required value set binding
   - Verify `AllergyIntolerance.category` uses required value set binding
   - Verify `AllergyIntolerance.criticality` uses required value set binding (if present)

4. **Must Support Element Presence**
   - Verify all Must Support elements are present when data exists
   - Validate that systems can meaningfully process all Must Support elements

#### Search Operation Validation

5. **Patient Search Functionality**
   - Verify system returns AllergyIntolerance resources for valid patient references
   - Verify system handles both patient ID and Patient/[id] reference formats
   - Verify system returns appropriate HTTP status codes for valid/invalid searches

6. **Clinical Status Search Functionality** (SHOULD support)
   - Verify system can filter AllergyIntolerance resources by clinical-status parameter
   - Verify system handles both code-only and system+code token formats

#### Data Quality Validation

7. **Resource Completeness**
   - Verify returned resources contain all mandatory elements required by US Core profile
   - Verify no mandatory elements are missing or contain only null/empty values
   - Verify references to other resources (e.g., patient) are valid and resolvable

8. **Provenance Support**
   - Verify system supports `_revinclude=Provenance:target` parameter as specified in capability statement
   - Validate returned Provenance resources conform to US Core Provenance Profile

### Test Execution Flow

1. **Discovery Phase**
   - Query system capability statement to confirm AllergyIntolerance support
   - Identify available patients with AllergyIntolerance data

2. **Resource Retrieval**
   - Execute patient-based searches to retrieve AllergyIntolerance resources
   - Perform individual resource reads using returned resource IDs

3. **Validation Phase**
   - Validate each resource against US Core AllergyIntolerance Profile
   - Check presence and validity of all mandatory code elements
   - Verify Must Support element handling

4. **Conformance Assessment**
   - Aggregate validation results across all tested resources
   - Identify any non-conformant resources or missing mandatory elements
   - Generate conformance report with specific findings

### Success Criteria

**Test Passes When:**
- All retrieved AllergyIntolerance resources contain mandatory code elements
- All code elements use appropriate value sets and bindings
- Resources validate successfully against US Core AllergyIntolerance Profile
- Search operations return expected results with proper HTTP responses
- System demonstrates capability to process Must Support elements

**Test Fails When:**
- Any AllergyIntolerance resource is missing mandatory code elements
- Code elements use inappropriate values or incorrect value set bindings
- Resources fail validation against US Core AllergyIntolerance Profile
- Required search operations are not supported or return incorrect results
- System cannot process Must Support elements appropriately

---

<a id='req-570'></a>

### REQ-570: Patient reference requirement for AllergyIntolerance

**Text**: 

**Context**: AllergyIntolerance mandatory element presence

**Actor**: Implementing system

**Conformance**: Must

# Test Specification for REQ-570

## 1. Requirement ID
REQ-570

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated validation of AllergyIntolerance resources to ensure the patient reference element is present and properly formatted.

### Complexity
**Simple** - This is a straightforward validation of mandatory element presence in FHIR resources.

### Prerequisites
- System must support US Core AllergyIntolerance Profile
- System must have AllergyIntolerance resources available for testing
- System must support read operations for AllergyIntolerance resources
- System must support search operations by patient parameter

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: AllergyIntolerance resources conforming to US Core AllergyIntolerance Profile
- **Patient Resources**: Valid Patient resources that can be referenced by AllergyIntolerance resources
- **System Endpoint**: Base FHIR server URL supporting US Core profiles

### Expected Outputs
- AllergyIntolerance resources with mandatory patient reference element present
- Patient reference should be properly formatted as a FHIR reference
- Resources should validate against US Core AllergyIntolerance Profile

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required for testing:

1. **Search AllergyIntolerance by patient** (SHALL support):
   ```
   GET [base]/AllergyIntolerance?patient=[patient-id]
   ```

2. **Read specific AllergyIntolerance resource** (SHALL support):
   ```
   GET [base]/AllergyIntolerance/[id]
   ```

3. **Optional: Include Provenance** (SHALL support):
   ```
   GET [base]/AllergyIntolerance?patient=[patient-id]&_revinclude=Provenance:target
   ```

### Validation Criteria

#### Test Case 1: Search-based Patient Reference Validation
**Objective**: Verify that all AllergyIntolerance resources returned via patient search contain the mandatory patient reference.

**Test Steps**:
1. Execute search for AllergyIntolerance resources by patient: `GET [base]/AllergyIntolerance?patient=[patient-id]`
2. For each AllergyIntolerance resource in the response bundle:
   - Verify `AllergyIntolerance.patient` element is present
   - Verify `AllergyIntolerance.patient` contains a valid reference value
   - Verify the reference format follows FHIR reference patterns (e.g., `Patient/[id]` or relative/absolute URL)
   - Verify the referenced patient ID matches the search parameter used

**Pass Criteria**:
- All returned AllergyIntolerance resources contain the patient element
- All patient references are properly formatted FHIR references
- All patient references point to valid patient resources

#### Test Case 2: Direct Read Patient Reference Validation
**Objective**: Verify that individually retrieved AllergyIntolerance resources contain the mandatory patient reference.

**Test Steps**:
1. Obtain AllergyIntolerance resource IDs from previous searches or system data
2. Execute read operation for each AllergyIntolerance: `GET [base]/AllergyIntolerance/[id]`
3. For each retrieved AllergyIntolerance resource:
   - Verify `AllergyIntolerance.patient` element is present
   - Verify `AllergyIntolerance.patient` contains a valid reference value
   - Verify the reference format follows FHIR reference patterns

**Pass Criteria**:
- Each AllergyIntolerance resource contains the patient element
- Each patient reference is properly formatted as a FHIR reference
- Patient references are resolvable (if external references are used)

#### Test Case 3: Profile Validation Compliance
**Objective**: Verify that AllergyIntolerance resources with patient references conform to the US Core AllergyIntolerance Profile.

**Test Steps**:
1. Retrieve AllergyIntolerance resources using supported search operations
2. Validate each resource against the US Core AllergyIntolerance Profile
3. Specifically verify patient reference compliance within the profile context

**Pass Criteria**:
- All AllergyIntolerance resources pass US Core AllergyIntolerance Profile validation
- Patient reference element meets the profile's cardinality and constraints (1..1)
- Patient reference meets the profile's Must Support requirements

#### Test Case 4: Patient Reference Consistency Validation
**Objective**: Verify that patient references in AllergyIntolerance resources are consistent and point to valid patient resources.

**Test Steps**:
1. Search for AllergyIntolerance resources by patient parameter
2. Extract patient references from returned resources
3. Verify all patient references in the result set point to the same patient used in the search parameter
4. If possible, attempt to resolve patient references to verify they point to valid Patient resources

**Pass Criteria**:
- All patient references in search results are consistent with the search parameter
- Patient references resolve to valid Patient resources (if resolution is testable)
- No AllergyIntolerance resources are missing the patient reference element

### Failure Scenarios to Test
- AllergyIntolerance resources missing the patient element entirely
- AllergyIntolerance resources with empty or null patient references
- AllergyIntolerance resources with malformed patient references
- Patient references that don't match the search criteria used

### Implementation Notes
1. This test should be executed against the system's existing AllergyIntolerance data rather than requiring specific test fixtures
2. The test should accommodate different patient reference formats (relative, absolute, contained resources)
3. Testing should verify both the presence of the element and its proper formatting according to FHIR standards
4. Results should clearly indicate which specific AllergyIntolerance resources fail the patient reference requirement

---

<a id='req-571'></a>

### REQ-571: Verification status support requirement

**Text**: 

**Context**: AllergyIntolerance Must Support element

**Actor**: Implementing system

**Conformance**: Must Support

# Test Specification for REQ-571: Verification Status Support Requirement

## 1. Requirement ID
REQ-571

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be systematically verified through API calls and response validation to confirm that AllergyIntolerance resources include the verification status element as a Must Support field.

### Complexity
**Simple** - The test involves straightforward validation of a single Must Support element presence and proper implementation in AllergyIntolerance resources.

### Prerequisites
- System must implement US Core AllergyIntolerance Profile
- System must support AllergyIntolerance resource operations as defined in the Capability Statement (search-type, read)
- Test data must include at least one AllergyIntolerance resource with verification status populated
- System must be configured to return AllergyIntolerance resources for test patients

## 3. Test Implementation Strategy

### Required Inputs
- **Test Patient ID**: A valid patient identifier that exists in the system
- **Expected FHIR Resources**: 
  - AllergyIntolerance resources conforming to US Core AllergyIntolerance Profile
  - Patient resources for context

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required for testing:

1. **Search AllergyIntolerance by Patient** (SHALL support):
   ```
   GET [base]/AllergyIntolerance?patient=[patient-id]
   ```

2. **Read AllergyIntolerance by ID** (SHALL support):
   ```
   GET [base]/AllergyIntolerance/[id]
   ```

3. **Search with Provenance** (SHALL support):
   ```
   GET [base]/AllergyIntolerance?patient=[patient-id]&_revinclude=Provenance:target
   ```

### Validation Criteria

#### Test Case 1: Verification Status Presence in Search Results
**Objective**: Verify that AllergyIntolerance resources returned via search contain the verification status element

**Test Steps**:
1. Execute search for AllergyIntolerance resources by patient
2. Parse returned AllergyIntolerance resources
3. Validate each resource contains `verificationStatus` element
4. Verify `verificationStatus` is properly populated (not null/empty)

**Pass Criteria**:
- All returned AllergyIntolerance resources must include the `verificationStatus` element
- The `verificationStatus` element must contain a valid coded value
- Resources must conform to US Core AllergyIntolerance Profile constraints

#### Test Case 2: Verification Status Presence in Direct Resource Read
**Objective**: Verify that individually retrieved AllergyIntolerance resources contain the verification status element

**Test Steps**:
1. Obtain AllergyIntolerance resource ID from search results or known test data
2. Execute direct read operation for specific AllergyIntolerance resource
3. Parse returned AllergyIntolerance resource
4. Validate resource contains `verificationStatus` element
5. Verify `verificationStatus` is properly populated

**Pass Criteria**:
- The retrieved AllergyIntolerance resource must include the `verificationStatus` element
- The `verificationStatus` element must contain a valid coded value from the appropriate value set
- Resource must conform to US Core AllergyIntolerance Profile

#### Test Case 3: Verification Status Value Set Compliance
**Objective**: Verify that verification status values conform to the expected FHIR value set

**Test Steps**:
1. Retrieve AllergyIntolerance resources using supported search operations
2. Extract `verificationStatus` values from all returned resources
3. Validate each verification status code against the AllergyIntoleranceVerificationStatus value set
4. Confirm proper coding structure (system, code, display)

**Pass Criteria**:
- All `verificationStatus` values must be from the AllergyIntoleranceVerificationStatus value set
- Coding structure must be complete and valid
- Values must be one of: unconfirmed, confirmed, refuted, entered-in-error

#### Test Case 4: Must Support Compliance Verification
**Objective**: Confirm that the verification status element meets Must Support requirements

**Test Steps**:
1. Analyze system's CapabilityStatement to confirm AllergyIntolerance profile support
2. Retrieve multiple AllergyIntolerance resources across different patients (if available)
3. Verify consistent presence of `verificationStatus` across all resources
4. Validate that the system can process and return verification status without errors

**Pass Criteria**:
- System must consistently include `verificationStatus` in all AllergyIntolerance resources
- No AllergyIntolerance resources should be missing the `verificationStatus` element
- System must handle queries and responses involving verification status without errors
- Element must be accessible and processable by client applications

### Expected Outputs
- **Successful Test**: All AllergyIntolerance resources contain properly formatted verification status elements with valid codes from the appropriate value set
- **Failed Test**: Any AllergyIntolerance resource missing verification status, containing invalid codes, or failing to meet Must Support requirements

### Assertions for Test Validation
1. `verificationStatus` element is present in all retrieved AllergyIntolerance resources
2. `verificationStatus` contains valid coding with system and code values
3. Verification status codes are from the AllergyIntoleranceVerificationStatus value set
4. Resources validate successfully against US Core AllergyIntolerance Profile
5. System consistently provides verification status across all supported operations

---

<a id='req-572'></a>

### REQ-572: Reaction manifestation support requirement

**Text**: 

**Context**: AllergyIntolerance Must Support element

**Actor**: Implementing system

**Conformance**: Must Support

# Test Specification for REQ-572

## Requirement ID
REQ-572

## Requirement Analysis

### Testability Assessment
**Classification**: Not testable due to being too vague

**Rationale**: The requirement "Reaction manifestation support requirement" lacks specific details about what needs to be tested. It references AllergyIntolerance Must Support elements but doesn't specify which elements, what operations need to be supported, or what the expected behavior should be. The requirement is too generic to create actionable test cases.

### Complexity
**Not Applicable** - Cannot assess complexity due to insufficient requirement detail

### Prerequisites
**Not Applicable** - Cannot determine prerequisites without clear requirement specification

## Test Implementation Strategy

### Assessment
This requirement cannot be implemented as a test specification due to the following issues:

1. **Insufficient Detail**: The requirement text "Reaction manifestation support requirement" does not specify what needs to be tested
2. **Missing Context**: While it mentions "AllergyIntolerance Must Support element", it doesn't identify which specific elements or behaviors need validation
3. **No Clear Success Criteria**: There are no defined expectations for what constitutes compliance

### Recommendations for Requirement Clarification

To make this requirement testable, the following information would be needed:

1. **Specific Elements**: Which AllergyIntolerance profile elements related to reaction manifestations must be supported?
2. **Operations**: What FHIR operations (read, search, create, etc.) need to be tested?
3. **Validation Rules**: What specific validation criteria determine compliance?
4. **Expected Behavior**: How should systems handle reaction manifestation data?

### Relevant Capability Statement Context

Based on the provided Capability Statement, AllergyIntolerance resources have the following support requirements:
- **SHALL** support US Core AllergyIntolerance Profile
- **SHALL** support `search-type` and `read` operations  
- **SHALL** support search by `patient` parameter
- **SHOULD** support search by `patient+clinical-status` parameter combination

However, without specific details in REQ-572 about which reaction manifestation elements or behaviors need testing, these capability requirements cannot be mapped to specific test cases.

### Conclusion
**This requirement needs to be clarified and made more specific before a meaningful test specification can be developed.**

---



<a id='capability-statement'></a>

## Capability Statement

<a id='req-484'></a>

### REQ-484: Servers must include all applicable triggering event codes in notifications.

**Text**: 

**Context**: Subscriptions Backport IG – triggering event notifications content

**Actor**: Server

**Conformance**: SHALL

# Test Specification for REQ-484

## 1. Requirement ID
**REQ-484**: Servers must include all applicable triggering event codes in notifications.

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be tested through automated verification by examining subscription notification payloads to ensure all applicable triggering event codes are included.

### Complexity
**Complex** - Testing requires:
- Setting up subscription resources with various triggering event criteria
- Creating/modifying resources that would trigger notifications
- Analyzing notification payloads to verify all applicable event codes are present
- Understanding the relationship between resource changes and their corresponding event codes

### Prerequisites
- Server must support FHIR Subscriptions (Backport IG implementation)
- Server must support creation/modification of resources that can trigger subscription notifications
- Test client must be able to receive and process subscription notifications
- Server must support at least one of the US Core profiles that can be subject to subscriptions (based on capability statement: AllergyIntolerance, CarePlan, CareTeam, Condition, Coverage, Device, DiagnosticReport, DocumentReference, Encounter, Goal, Immunization, MedicationDispense, MedicationRequest, Observation, Patient, Procedure, QuestionnaireResponse, RelatedPerson, ServiceRequest)

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Any US Core profile resources supported by the server that can trigger subscription notifications (e.g., Patient, Condition, Observation, etc.)
- **Subscription Resources**: Valid Subscription resources with appropriate criteria for triggering events
- **Notification Endpoint**: A test endpoint capable of receiving subscription notifications

### Required FHIR Operations
Based on the capability statement, the following operations must be supported:

1. **POST** `/Subscription` - Create subscription resources (if server supports subscription creation)
2. **GET** `/[ResourceType]/[id]` - Read operations for supported resources
3. **POST** `/[ResourceType]` - Create operations for triggering events (where server supports create)
4. **PUT** `/[ResourceType]/[id]` - Update operations for triggering events (where server supports update)
5. **DELETE** `/[ResourceType]/[id]` - Delete operations for triggering events (where server supports delete)

### Validation Criteria

#### Test Case 1: Single Resource Creation Event
1. **Setup**: Create a subscription for a specific resource type (e.g., Patient) with criteria for creation events
2. **Action**: Create a new resource instance that matches the subscription criteria
3. **Validation**: 
   - Verify notification is received
   - Confirm notification includes the appropriate triggering event code for "create" operations
   - Verify all applicable event codes related to the resource creation are present

#### Test Case 2: Single Resource Update Event
1. **Setup**: Create a subscription for resource update events
2. **Action**: Update an existing resource that matches subscription criteria
3. **Validation**:
   - Verify notification is received
   - Confirm notification includes the appropriate triggering event code for "update" operations
   - Verify all applicable event codes related to the resource modification are present

#### Test Case 3: Single Resource Delete Event
1. **Setup**: Create a subscription for resource delete events (if supported)
2. **Action**: Delete a resource that matches subscription criteria
3. **Validation**:
   - Verify notification is received
   - Confirm notification includes the appropriate triggering event code for "delete" operations
   - Verify all applicable event codes related to the resource deletion are present

#### Test Case 4: Multiple Triggering Events
1. **Setup**: Create a subscription that covers multiple types of events (create, update, delete)
2. **Action**: Perform operations that trigger multiple different event types
3. **Validation**:
   - Verify notifications are received for each triggering event
   - Confirm each notification includes all applicable triggering event codes
   - Verify no event codes are missing or incorrectly included

#### Test Case 5: Complex Resource Updates
1. **Setup**: Create subscriptions for resources with complex structures (e.g., Observation with components, DiagnosticReport with results)
2. **Action**: Update specific elements within these complex resources
3. **Validation**:
   - Verify notifications include event codes that accurately reflect the specific nature of the changes
   - Confirm all applicable triggering event codes are included, not just generic update codes

#### Assertions for Passing Tests
- **Notification Reception**: All expected notifications are received within reasonable timeframe
- **Event Code Presence**: All notifications contain the appropriate triggering event codes as defined by the Subscriptions Backport IG
- **Event Code Completeness**: No applicable triggering event codes are missing from notifications
- **Event Code Accuracy**: Only applicable event codes are included (no extraneous codes)
- **Consistency**: Event codes are consistently applied across similar triggering events

#### Failure Conditions
- Missing notifications for triggering events
- Notifications missing required triggering event codes
- Notifications containing incorrect or inappropriate event codes
- Inconsistent application of event codes across similar events

### Additional Considerations
- Test should accommodate different subscription formats and criteria patterns
- Validation should account for server-specific implementation variations within the bounds of the IG requirements
- Test should work with any valid US Core profile data provided by the implementer
- Consider testing with both contained and referenced resources where applicable

---

<a id='req-488'></a>

### REQ-488: Servers must adjust filter-criteria extensions to align with capabilities.

**Text**: 

**Context**: Subscriptions Backport IG – server-side adjustment of unsupported filter criteria

**Actor**: Server

**Conformance**: SHALL

# Test Specification for REQ-488

## 1. Requirement ID
**REQ-488**: Servers must adjust filter-criteria extensions to align with capabilities.

## 2. Requirement Analysis

### Testability Assessment
**Not Testable** - This requirement is too vague to create a comprehensive test specification. The requirement lacks critical details needed for testing:

- No definition of what "filter-criteria extensions" refers to
- No specification of what constitutes proper "alignment with capabilities"
- No clear indication of which FHIR operations or resources this applies to
- The context mentions "Subscriptions Backport IG" but the provided Capability Statement is for US Core, creating a scope mismatch
- No examples or guidance on expected server behavior

### Complexity
**Cannot be determined** due to vagueness of the requirement.

### Prerequisites
**Cannot be determined** - The requirement does not specify:
- Which FHIR resources are involved
- What subscription capabilities must be supported
- What filter criteria extensions are relevant
- How to identify server capabilities for comparison

## 3. Test Implementation Strategy

### Current Limitations
This requirement cannot be properly tested as written because:

1. **Missing Context**: The requirement references "Subscriptions Backport IG" but the provided Capability Statement is for US Core Server capabilities, which do not include subscription-related functionality.

2. **Undefined Terms**: "Filter-criteria extensions" is not defined or specified, making it impossible to identify what should be tested.

3. **No Success Criteria**: There is no specification of what constitutes proper "adjustment" or "alignment."

### Recommendations for Requirement Clarification

To make this requirement testable, the following information would be needed:

1. **Specific Context**: Clear identification of which Implementation Guide and FHIR operations this applies to
2. **Extension Definition**: Specification of which filter-criteria extensions are relevant
3. **Capability Mapping**: Definition of how server capabilities should be determined and compared
4. **Expected Behavior**: Clear description of what server adjustment should look like
5. **Success Criteria**: Specific conditions that indicate conformant behavior

### Required FHIR Operations
**Cannot be determined** without requirement clarification.

### Validation Criteria
**Cannot be established** due to insufficient requirement specification.

---

**Note**: This requirement needs significant clarification before a meaningful test specification can be created. The test engineer should request additional details from the Implementation Guide authors or requirement stakeholders to define the specific behavior that needs to be tested.

---

<a id='req-489'></a>

### REQ-489: Servers must process unadjusted Subscription requests as normal FHIR RESTful interactions.

**Text**: 

**Context**: Subscriptions Backport IG – normal processing path for valid filter criteria

**Actor**: Server

**Conformance**: SHALL

# Test Specification for REQ-489

## Requirement ID
REQ-489

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be tested by sending Subscription requests to a server and verifying that they are processed according to standard FHIR RESTful interaction patterns.

### Complexity
**Simple** - The requirement focuses on ensuring servers handle Subscription requests using normal FHIR processing patterns, which can be validated through standard HTTP interactions and response analysis.

### Prerequisites
- Server must support FHIR R4 
- Server must implement Subscriptions Backport IG
- Server must be configured to accept Subscription resources
- Test client must have appropriate authorization to create/manage Subscription resources
- Server should have at least one resource type available that can be subscribed to (based on server's capability statement)

## Test Implementation Strategy

### Required Inputs
- **FHIR Resources Needed:**
  - Valid Subscription resource with unadjusted filter criteria
  - At least one resource type that the server supports for subscription (e.g., Patient, Observation, etc. based on server capabilities)

- **Test Data Requirements:**
  - Subscription resource with valid `criteria` element containing standard FHIR search parameters
  - Subscription resource with valid `channel` configuration
  - Subscription resource with `status` set to "requested" or "active"

### Required FHIR Operations
Based on the US Core Capability Statement, the following operations are supported and should be used:

1. **POST [base]/Subscription** - Create subscription request
2. **GET [base]/Subscription/[id]** - Read created subscription
3. **PUT [base]/Subscription/[id]** - Update subscription (if supported)
4. **DELETE [base]/Subscription/[id]** - Delete subscription (if supported)

### Validation Criteria

#### Test Case 1: Create Unadjusted Subscription Request
**Objective:** Verify server processes unadjusted Subscription creation as normal FHIR RESTful interaction

**Steps:**
1. Send POST request to create Subscription with valid, unadjusted filter criteria
2. Verify server responds with appropriate HTTP status codes per FHIR specification

**Expected Results:**
- **Success Response:** HTTP 201 Created with Location header pointing to created resource
- **Error Responses:** Standard FHIR HTTP error codes (400, 401, 403, 404) with appropriate OperationOutcome
- Response includes valid FHIR Subscription resource with server-assigned id
- Response follows standard FHIR RESTful interaction patterns (headers, content-type, etc.)

#### Test Case 2: Read Unadjusted Subscription
**Objective:** Verify server supports standard read operations on Subscription resources

**Steps:**
1. Create a Subscription resource (from Test Case 1)
2. Send GET request to read the created Subscription
3. Verify response follows standard FHIR patterns

**Expected Results:**
- HTTP 200 OK with valid Subscription resource in response body
- Resource contains the original filter criteria without modification
- Standard FHIR headers present (Content-Type: application/fhir+json, etc.)
- Resource includes proper FHIR metadata (resourceType, id, meta, etc.)

#### Test Case 3: Update Unadjusted Subscription (if supported)
**Objective:** Verify server handles updates to Subscription resources normally

**Steps:**
1. Create a Subscription resource
2. Send PUT request to update the Subscription
3. Verify server processes update according to FHIR RESTful patterns

**Expected Results:**
- HTTP 200 OK or 201 Created depending on server implementation
- Updated resource returned in response body
- Version number incremented in meta.versionId
- Standard FHIR interaction patterns followed

#### Test Case 4: Delete Unadjusted Subscription (if supported)
**Objective:** Verify server handles deletion of Subscription resources normally

**Steps:**
1. Create a Subscription resource
2. Send DELETE request for the Subscription
3. Verify server processes deletion according to FHIR RESTful patterns

**Expected Results:**
- HTTP 204 No Content or 200 OK (per FHIR specification)
- Subsequent GET requests return HTTP 410 Gone or 404 Not Found
- Standard FHIR interaction patterns followed

#### Test Case 5: Error Handling Validation
**Objective:** Verify server returns appropriate FHIR-compliant errors for invalid requests

**Steps:**
1. Send malformed Subscription requests (invalid JSON, missing required fields, etc.)
2. Verify server returns standard FHIR error responses

**Expected Results:**
- Appropriate HTTP error codes (400 for bad requests, 422 for unprocessable entity)
- OperationOutcome resource in response body with meaningful error messages
- Standard FHIR error handling patterns followed

### Pass/Fail Criteria
**Pass:** Server processes all Subscription requests using standard FHIR RESTful interaction patterns, including:
- Appropriate HTTP status codes
- Standard FHIR headers and content types
- Proper FHIR resource structure in responses
- Consistent error handling with OperationOutcome resources
- No special processing or modification of filter criteria beyond normal FHIR validation

**Fail:** Server uses non-standard processing, returns non-FHIR compliant responses, or fails to handle Subscription requests as normal FHIR RESTful interactions.

---

<a id='req-496'></a>

### REQ-496: Servers must document supported resources, filters, and triggers.

**Text**: 

**Context**: Subscriptions Backport IG – implementation documentation requirements

**Actor**: Server

**Conformance**: SHALL

# Test Specification for REQ-496

## 1. Requirement ID
**REQ-496**: Servers must document supported resources, filters, and triggers.

## 2. Requirement Analysis

### Testability Assessment
**Attestation** - This requirement focuses on documentation inspection rather than automated API testing. While the CapabilityStatement can be retrieved programmatically, the assessment of whether documentation adequately covers "supported resources, filters, and triggers" requires human judgment and interpretation.

### Complexity
**Moderate** - The test requires retrieving and analyzing the server's CapabilityStatement, cross-referencing with actual server behavior, and evaluating completeness of documentation against subscription-related functionality.

### Prerequisites
- Server must be operational and accessible
- Server must implement FHIR R4 or later
- Server must support the CapabilityStatement resource
- Access to server's implementation documentation (if available beyond CapabilityStatement)
- Understanding of the server's intended subscription capabilities

## 3. Test Implementation Strategy

### Required Inputs
- **Server Base URL**: The FHIR server endpoint under test
- **Authentication credentials** (if required)
- **Server's implementation documentation** (optional, for comprehensive evaluation)

### Required FHIR Operations
1. **GET [base]/metadata** - Retrieve server's CapabilityStatement (supported per FHIR specification)
2. **GET [base]/SubscriptionTopic** (if server supports Subscription R5 backport)
3. **GET [base]/Subscription** (if server supports subscriptions)

### Validation Criteria

#### Primary Validation Checks:

1. **CapabilityStatement Accessibility**
   - Server responds successfully to `GET [base]/metadata`
   - Response contains valid CapabilityStatement resource
   - CapabilityStatement includes required elements (status, date, kind, fhirVersion, format)

2. **Resource Documentation Assessment**
   - CapabilityStatement.rest.resource array documents all supported resources
   - Each supported resource entry includes:
     - Resource type
     - Supported interactions (read, create, update, delete, search, etc.)
     - Supported search parameters (if applicable)
     - Supported profiles (if applicable)

3. **Subscription-Specific Documentation** (if server supports subscriptions)
   - If Subscription resource is listed in supported resources:
     - Documented supported subscription channels (rest-hook, websocket, email, etc.)
     - Documented payload formats and types
     - Any subscription-specific search parameters or filters
   - If SubscriptionTopic is supported:
     - Documented available subscription topics
     - Documented trigger events and conditions
     - Resource-specific filters and criteria

4. **Filter Documentation Assessment**
   - For each resource supporting search:
     - Search parameters are documented in CapabilityStatement.rest.resource.searchParam
     - Filter capabilities are clearly specified
     - Any custom or implementation-specific filters are documented

5. **Trigger Documentation Assessment** (for subscription-capable servers)
   - Documented event triggers that initiate subscriptions
   - Clear specification of when notifications are sent
   - Documentation of supported notification payloads

#### Secondary Validation Checks:

6. **Documentation Completeness**
   - CapabilityStatement includes implementation-specific guidance
   - Contact information provided for implementation questions
   - Version information is current and accurate

7. **Consistency Verification**
   - Actual server behavior aligns with documented capabilities
   - Unsupported operations return appropriate HTTP status codes (405 Method Not Allowed, 501 Not Implemented)
   - Supported operations function as documented

#### Test Execution Steps:

1. **Retrieve CapabilityStatement**
   ```
   GET [base]/metadata
   Accept: application/fhir+json
   ```
   - Verify successful response (HTTP 200)
   - Validate CapabilityStatement structure and required elements

2. **Analyze Resource Documentation**
   - Extract and review CapabilityStatement.rest.resource entries
   - Verify completeness of resource interaction documentation
   - Check for presence of search parameter documentation

3. **Evaluate Subscription Documentation** (if applicable)
   - Review subscription-related resource documentation
   - Verify trigger and filter documentation completeness
   - Cross-reference with any available SubscriptionTopic resources

4. **Verify Documentation Accuracy**
   - Test a sample of documented capabilities to ensure they work as described
   - Verify that undocumented capabilities are not available
   - Confirm error responses align with documented behavior

#### Pass/Fail Criteria:

**PASS**: Server provides comprehensive documentation that:
- Accurately reflects all supported resources and their capabilities
- Clearly documents all supported filters and search parameters
- Adequately describes subscription triggers and notification mechanisms (if applicable)
- Enables implementers to understand and utilize server capabilities

**FAIL**: Server documentation is:
- Missing or inaccessible
- Incomplete regarding supported resources, filters, or triggers
- Inaccurate when compared to actual server behavior
- Insufficient for implementers to understand server capabilities

**Note**: Given the attestation nature of this requirement, the final determination may require manual review and judgment regarding the adequacy and completeness of the provided documentation.

---

<a id='req-542'></a>

### REQ-542: Return specific HTTP response classes

**Text**: 

**Context**: US Core Server error handling for system interactions

**Actor**: US Core Server

**Conformance**: SHALL

# Test Specification for REQ-542

## 1. Requirement ID
**REQ-542**: Return specific HTTP response classes

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement specifies concrete HTTP status codes that must be returned under specific conditions, making it fully testable through automated API calls.

### Complexity
**Moderate** - While the concept is straightforward, testing requires generating various error conditions and validating specific HTTP response codes across different scenarios.

### Prerequisites
- US Core Server endpoint accessible for testing
- Valid authentication credentials (for testing unauthorized scenarios)
- Test client capable of making HTTP requests and inspecting response codes
- Ability to construct invalid requests (malformed parameters, invalid resource IDs, etc.)
- Understanding of the server's authentication/authorization mechanism

## 3. Test Implementation Strategy

### Required Inputs
- **Server Base URL**: The FHIR server endpoint being tested
- **Valid Resource IDs**: Any existing resource IDs in the server (for constructing valid requests)
- **Invalid Resource IDs**: Non-existent resource IDs (e.g., "invalid-id-12345")
- **Authentication Tokens**: 
  - Valid tokens with appropriate scopes
  - Valid tokens with insufficient scopes
  - Invalid/expired tokens
- **Test Parameters**: Various invalid parameter combinations for testing status 400

### Required FHIR Operations
Based on the Capability Statement, the following operations will be used for testing:
- **read**: GET [base]/[resourceType]/[id]
- **search-type**: GET [base]/[resourceType]?[parameters]
- **search-system**: GET [base]?[parameters] (if supported)

### Validation Criteria

#### Test Case 1: Status 400 - Invalid Parameter
**Objective**: Verify server returns HTTP 400 for invalid parameters

**Test Steps**:
1. Make requests with malformed search parameters (e.g., invalid date formats, unsupported parameters)
2. Make requests with invalid syntax in query strings
3. Send requests with conflicting or logically invalid parameter combinations

**Expected Results**:
- HTTP Status Code: 400
- Response should include appropriate error information in the body
- Content-Type should be application/fhir+json (or application/fhir+xml if XML is supported)

**Assertions**:
- `response.status_code == 400`
- Response body contains valid FHIR OperationOutcome resource
- OperationOutcome.issue contains relevant error details

#### Test Case 2: Status 401/4xx - Unauthorized Request
**Objective**: Verify server returns HTTP 401 or other 4xx status for unauthorized requests

**Test Steps**:
1. Make requests without authentication credentials
2. Make requests with invalid/expired authentication tokens
3. Make requests with malformed authorization headers

**Expected Results**:
- HTTP Status Code: 401 or other appropriate 4xx code
- Server should reject the request without processing

**Assertions**:
- `response.status_code in [401, 403, 404]` (as per security requirements)
- Request is rejected without exposing sensitive information
- Response follows FHIR error handling patterns where applicable

#### Test Case 3: Status 403 - Insufficient Scopes
**Objective**: Verify server returns HTTP 403 when valid credentials lack sufficient scopes

**Test Steps**:
1. Authenticate with valid credentials that have limited scopes
2. Attempt to access resources or perform operations outside granted scopes
3. Test with tokens that have read-only access attempting write operations (if applicable)

**Expected Results**:
- HTTP Status Code: 403
- Clear indication that access is forbidden due to insufficient permissions

**Assertions**:
- `response.status_code == 403`
- Response indicates insufficient permissions/scopes
- Error message is informative but doesn't expose system details

#### Test Case 4: Status 404 - Unknown Resource
**Objective**: Verify server returns HTTP 404 for requests to non-existent resources

**Test Steps**:
1. Request specific resource instances with non-existent IDs
2. Request unsupported resource types
3. Request resources at invalid endpoints

**Expected Results**:
- HTTP Status Code: 404
- Appropriate error messaging indicating resource not found

**Assertions**:
- `response.status_code == 404`
- Response body contains valid FHIR OperationOutcome (when appropriate)
- Error message clearly indicates resource not found

#### Cross-Cutting Validation
**For all test cases**:
- Verify response includes appropriate FHIR-compliant error structures when applicable
- Ensure error responses don't expose sensitive system information
- Confirm that error responses are consistent with FHIR specification requirements
- Validate that Content-Type headers are appropriate for the response format

#### Test Execution Strategy
1. **Bring Your Own Data Approach**: Tests should work with any US Core compliant server by:
   - Using server's CapabilityStatement to identify supported resources
   - Generating test scenarios based on server's declared capabilities
   - Using existing data patterns rather than requiring specific test fixtures

2. **Error Condition Generation**: Create systematic error conditions by:
   - Modifying valid requests to introduce specific types of errors
   - Using server's own resource examples as basis for creating invalid variations
   - Testing boundary conditions based on server's documented capabilities

3. **Scope Testing**: Leverage the server's authentication mechanism to:
   - Test with credentials that have varying permission levels
   - Use server's own authorization patterns to create insufficient scope scenarios

---

<a id='req-543'></a>

### REQ-543: Support JSON source formats

**Text**: 

**Context**: US Core Server capability for data formats

**Actor**: US Core Server

**Conformance**: SHALL

# Test Specification for REQ-543

## 1. Requirement ID
REQ-543: Support JSON source formats

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be systematically verified by making FHIR API calls and examining response headers and content format.

### Complexity
**Simple** - The requirement involves straightforward verification of JSON format support through standard HTTP content negotiation and response validation.

### Prerequisites
- US Core Server implementation available for testing
- Test client capable of making HTTP requests with various Accept headers
- Basic authentication/authorization configured if required by the server
- At least one US Core resource available on the server (Patient required by capability statement)

## 3. Test Implementation Strategy

### Required Inputs
- **Server Base URL**: The FHIR server endpoint being tested
- **Authentication credentials**: If required by the server implementation
- **Existing Resource IDs**: At least one valid resource ID for each US Core profile the server supports (using "bring your own data" approach)

### Expected Outputs
- HTTP responses with `Content-Type: application/fhir+json` or `application/json`
- Valid JSON-formatted FHIR resources in response bodies
- Proper JSON structure conforming to FHIR specification

### Required FHIR Operations
Based on the Capability Statement, test the following supported operations:
1. **read** - GET requests for individual resources
2. **search-type** - GET requests with search parameters
3. **vread** - GET requests for specific versions (if versioning supported)
4. **history-instance** - GET requests for resource history (if supported)
5. **capabilities** - GET request to `/metadata` endpoint

### Validation Criteria

#### Test Case 1: JSON Format Support with Default Accept Header
**Objective**: Verify server returns JSON when no specific format is requested

**Test Steps**:
1. Send GET request to `[base]/Patient/[id]` without Accept header
2. Send GET request to `[base]/Patient?family=[value]` without Accept header

**Assertions**:
- Response status code is 200 OK
- Response `Content-Type` header contains `application/fhir+json` or `application/json`
- Response body is valid JSON format
- Response body conforms to FHIR JSON syntax rules

#### Test Case 2: Explicit JSON Format Request
**Objective**: Verify server honors explicit JSON format requests

**Test Steps**:
1. Send GET request to `[base]/Patient/[id]` with `Accept: application/fhir+json`
2. Send GET request to `[base]/Patient/[id]` with `Accept: application/json`
3. Send GET request to `[base]/Patient?family=[value]` with `Accept: application/fhir+json`

**Assertions**:
- Response status code is 200 OK
- Response `Content-Type` header matches requested format
- Response body is valid JSON format
- JSON structure follows FHIR specification (proper resourceType, id, meta elements where applicable)

#### Test Case 3: Multiple Format Preference with JSON Priority
**Objective**: Verify server correctly handles multiple Accept formats with JSON preference

**Test Steps**:
1. Send GET request with `Accept: application/fhir+json, application/xml;q=0.8`
2. Send GET request with `Accept: application/json, text/xml;q=0.5`

**Assertions**:
- Response status code is 200 OK
- Response `Content-Type` header indicates JSON format was selected
- Response body is valid JSON format

#### Test Case 4: JSON Format for All Supported US Core Interactions
**Objective**: Verify JSON support across all resource types server claims to support

**Test Steps**:
For each US Core profile supported by the server:
1. Send GET request to read endpoint with `Accept: application/fhir+json`
2. Send GET request to search endpoint with `Accept: application/fhir+json`

**Assertions**:
- All responses return with JSON Content-Type
- All response bodies are valid JSON
- JSON structure is appropriate for each resource type

#### Test Case 5: Capability Statement JSON Format
**Objective**: Verify server metadata is available in JSON format

**Test Steps**:
1. Send GET request to `[base]/metadata` with `Accept: application/fhir+json`
2. Send GET request to `[base]/metadata` without Accept header

**Assertions**:
- Response status code is 200 OK
- Response `Content-Type` header indicates JSON format
- Response body is valid JSON
- Response contains CapabilityStatement resource with proper US Core server declarations

#### Test Case 6: Error Responses in JSON Format
**Objective**: Verify error responses are also returned in JSON format

**Test Steps**:
1. Send GET request to non-existent resource with `Accept: application/fhir+json`
2. Send GET request with invalid search parameters with `Accept: application/fhir+json`

**Assertions**:
- Response status codes are appropriate (404, 400, etc.)
- Response `Content-Type` header indicates JSON format
- Error response body is valid JSON
- OperationOutcome (if returned) is properly formatted JSON

### Pass Criteria Summary
The test passes when:
- Server consistently returns JSON format for all US Core interactions
- Content-Type headers correctly indicate JSON format
- All JSON responses are syntactically valid
- JSON structure conforms to FHIR specification requirements
- Server handles various Accept header scenarios appropriately

### Failure Conditions
The test fails if:
- Server returns non-JSON formats when JSON is explicitly requested
- JSON responses are malformed or invalid
- Content-Type headers are incorrect or missing
- Server rejects requests asking for JSON format with appropriate error codes

---

<a id='req-544'></a>

### REQ-544: Support XML source formats

**Text**: 

**Context**: US Core Server capability for data formats

**Actor**: US Core Server

**Conformance**: SHOULD

# Test Specification for REQ-544

## 1. Requirement ID
**REQ-544**: Support XML source formats

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be tested by making FHIR API requests with XML Accept headers and verifying the server returns properly formatted XML responses.

### Complexity
**Simple** - The test involves straightforward HTTP requests with XML content-type headers and validation of XML response format.

### Prerequisites
- US Core Server implementation that supports at least the US Core Patient resource profile and one additional US Core Profile
- Server must be accessible via RESTful FHIR API endpoints
- Test client capable of making HTTP requests with XML Accept headers
- Access to test data (patient resources and related resources) on the server

## 3. Test Implementation Strategy

### Required Inputs
- **Server Base URL**: The FHIR server endpoint being tested
- **Test Resources**: Any existing patient resources and associated US Core Profile resources available on the server
- **Authentication credentials** (if required by the server implementation)

### Required FHIR Operations
Based on the Capability Statement, the following operations should be tested with XML format support:

1. **read** operations on US Core Profile resources
2. **search-type** operations on US Core Profile resources  
3. **vread** operations (if supported by server)
4. **history-instance** operations (if supported by server)
5. **batch** operations (if supported by server - marked as MAY in capability statement)
6. **transaction** operations (if supported by server - marked as MAY in capability statement)

### Validation Criteria

#### Test Case 1: XML Read Operation Support
**Test Steps:**
1. Identify an existing Patient resource on the server
2. Perform a GET request to `/Patient/{id}` with `Accept: application/fhir+xml` header
3. Verify response has `Content-Type: application/fhir+xml` header
4. Verify response body is valid XML format
5. Verify XML can be parsed as a valid FHIR Patient resource
6. Verify the resource conforms to US Core Patient profile

**Passing Criteria:**
- Server returns HTTP 200 status
- Response Content-Type header indicates XML format
- Response body contains valid XML
- XML parses successfully as FHIR Patient resource
- Resource validates against US Core Patient profile

#### Test Case 2: XML Search Operation Support  
**Test Steps:**
1. Perform a GET request to `/Patient` with `Accept: application/fhir+xml` header
2. Verify response has `Content-Type: application/fhir+xml` header
3. Verify response body is valid XML Bundle
4. Verify Bundle entries (if any) are valid XML FHIR resources
5. Verify Patient resources conform to US Core Patient profile

**Passing Criteria:**
- Server returns HTTP 200 status
- Response Content-Type header indicates XML format
- Response body contains valid XML Bundle
- All Bundle entries are valid XML FHIR resources
- Patient resources validate against US Core Patient profile

#### Test Case 3: XML Support for Additional US Core Profiles
**Test Steps:**
1. Identify other US Core Profile resources available on the server (e.g., Condition, Observation, etc.)
2. For each supported resource type:
   - Perform read operations with `Accept: application/fhir+xml` header
   - Perform search operations with `Accept: application/fhir+xml` header
3. Verify all responses return valid XML format
4. Verify resources conform to their respective US Core profiles

**Passing Criteria:**
- All supported US Core Profile resources can be retrieved in XML format
- XML responses are well-formed and valid
- Resources validate against their respective US Core profiles

#### Test Case 4: XML Content Negotiation
**Test Steps:**
1. Perform requests with various XML-related Accept headers:
   - `Accept: application/fhir+xml`
   - `Accept: application/xml`  
   - `Accept: text/xml`
   - `Accept: application/fhir+xml, application/fhir+json;q=0.9`
2. Verify server appropriately handles XML content negotiation

**Passing Criteria:**
- Server returns XML format when XML is requested and supported
- Server handles content negotiation appropriately
- Appropriate HTTP status codes returned for unsupported formats

#### Optional Test Case 5: XML Batch/Transaction Support (if server supports)
**Test Steps:**
1. Check server's CapabilityStatement to determine if batch/transaction operations are supported
2. If supported, create a batch/transaction Bundle in XML format
3. POST the XML Bundle to appropriate endpoint
4. Request response in XML format using Accept header
5. Verify response Bundle is in XML format

**Passing Criteria:**
- If batch/transaction is supported, XML format works for both request and response
- Response Bundle is valid XML
- Individual operation results within Bundle are valid XML

### Failure Scenarios to Handle
- **Server returns 406 Not Acceptable**: This is acceptable since XML support is SHOULD level
- **Server returns JSON despite XML Accept header**: This indicates non-conformance to the SHOULD requirement
- **Server returns malformed XML**: This indicates implementation issues
- **Server returns HTTP 404/500 errors**: May indicate server configuration issues unrelated to XML support

### Notes
- Since this is a SHOULD requirement, servers that don't support XML should return appropriate HTTP status codes (like 406 Not Acceptable) rather than ignoring the Accept header
- The test should be designed to work with whatever data exists on the server (bring your own data approach)
- Focus on interoperability conformance rather than exhaustive edge case testing

---

<a id='req-545'></a>

### REQ-545: Identify supported US Core profiles in meta.profile

**Text**: 

**Context**: US Core Server instance metadata population

**Actor**: US Core Server

**Conformance**: SHOULD

# REQ-545 Test Specification

## Requirement ID
REQ-545

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be programmatically verified by examining the `meta.profile` attribute in FHIR resource instances returned by the server and validating that they reference supported US Core profiles.

### Complexity
**Moderate** - The test requires:
- Retrieving multiple resource instances from the server
- Cross-referencing profile URLs against the server's CapabilityStatement
- Validating profile URL format and existence
- Understanding the relationship between supported profiles and resource instances

### Prerequisites
- US Core Server with implemented US Core profiles
- Server must have resource instances available for testing
- Server must support at least US Core Patient profile plus one additional US Core profile
- Access to the server's CapabilityStatement to determine supported profiles

## Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Server's CapabilityStatement (to identify supported US Core profiles)
- Multiple resource instances from different US Core profile types (Patient plus at least one other supported profile type)
- Access to US Core profile definitions for validation

**Expected Outputs:**
- Resource instances with populated `meta.profile` elements containing valid US Core profile URLs
- Confirmation that referenced profile URLs match profiles declared as supported in the CapabilityStatement

### Required FHIR Operations
1. **GET [base]/metadata** - Retrieve server's CapabilityStatement to identify supported US Core profiles
2. **GET [base]/Patient** - Retrieve Patient resources (required US Core profile)
3. **GET [base]/[ResourceType]** - Retrieve instances of other supported US Core resource types as declared in CapabilityStatement
4. **GET [base]/[ResourceType]/[id]** - Retrieve specific resource instances to examine meta.profile

### Validation Criteria

**Primary Assertions:**

1. **Profile Presence Validation:**
   - Verify that returned resource instances contain the `meta.profile` element
   - Confirm `meta.profile` is populated with at least one profile URL

2. **Profile URL Format Validation:**
   - Validate that profile URLs in `meta.profile` follow the expected format: `http://hl7.org/fhir/us/core/StructureDefinition/[profile-name]`
   - Ensure URLs are properly formatted and resolvable

3. **Profile Support Verification:**
   - Cross-reference profile URLs found in `meta.profile` against the list of supported profiles declared in the server's CapabilityStatement
   - Verify that referenced profiles are actually supported by the server

4. **US Core Profile Identification:**
   - Confirm that identified profiles are legitimate US Core profiles (not custom or other IG profiles)
   - Validate against known US Core profile canonical URLs

**Secondary Assertions:**

5. **Coverage Assessment:**
   - Evaluate the percentage of returned resources that include `meta.profile` (since this is a SHOULD requirement)
   - Document instances where `meta.profile` is missing or incomplete

6. **Consistency Validation:**
   - Verify that resources of the same type consistently reference the same US Core profile
   - Check that profile references are appropriate for the resource type

**Test Pass Criteria:**
- Server demonstrates the capability to populate `meta.profile` with valid US Core profile URLs
- Profile URLs referenced in resource instances are supported according to the server's CapabilityStatement
- At minimum, Patient resources and one additional US Core resource type include appropriate profile identification
- Profile URLs are correctly formatted and reference legitimate US Core profiles

**Test Failure Indicators:**
- `meta.profile` consistently missing from resource instances
- Profile URLs that are malformed or don't reference US Core profiles
- Profile URLs that reference profiles not declared as supported in the CapabilityStatement
- Complete absence of profile identification across all tested resource types

**Note:** Since this is a SHOULD requirement, the test should document compliance levels rather than strict pass/fail. A server that identifies profiles in some but not all instances would still demonstrate partial conformance.

---



<a id='careplan'></a>

## CarePlan

<a id='req-452'></a>

### REQ-452: US Core CarePlan Profile implementation

**Text**: 

**Context**: System conformance to US Core CarePlan Profile.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-452

## 1. Requirement ID
REQ-452: US Core CarePlan Profile Implementation

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be tested through automated validation of CarePlan resource instances against the US Core CarePlan profile, verification of profile conformance declarations, and testing of required FHIR operations.

### Complexity
**Moderate** - Testing requires validation of profile conformance, Must Support element verification, and potentially testing FHIR operations if CarePlan resources are exposed via API endpoints.

### Prerequisites
- System must have CarePlan resource instances available for testing
- System must declare support for US Core CarePlan profile in its CapabilityStatement
- Access to system's FHIR endpoints (if testing API operations)
- Understanding of US Core Must Support requirements for CarePlan profile

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: CarePlan resource instances from the system under test
- **CapabilityStatement**: System's CapabilityStatement resource to verify declared support
- **Profile Definition**: US Core CarePlan profile definition for validation
- **Test Data**: System's own CarePlan data (bring your own data approach)

### Expected Outputs
- Validation results confirming CarePlan resources conform to US Core CarePlan profile
- Confirmation that required elements are present and properly formatted
- Verification of profile declaration in resource metadata

### Required FHIR Operations
Based on the CapabilityStatement, if the system supports CarePlan resources via API:
- **GET** operations for CarePlan resource retrieval (if supported)
- **CapabilityStatement** read to verify declared profile support
- Standard FHIR validation operations against the US Core CarePlan profile

### Validation Criteria

#### Profile Conformance Validation
1. **Profile Declaration Check**
   - Verify `meta.profile` includes `http://hl7.org/fhir/us/core/StructureDefinition/us-core-careplan`
   - Assertion: CarePlan resources SHALL declare conformance to US Core CarePlan profile

2. **Structural Validation**
   - Validate all CarePlan resource instances against US Core CarePlan profile
   - Assertion: All CarePlan resources SHALL pass validation against the US Core profile without errors

3. **Must Support Elements Verification**
   - Verify presence and appropriate population of all Must Support elements as defined in US Core CarePlan profile
   - Check cardinality constraints are met for required elements
   - Assertion: All Must Support elements SHALL be present when data is available

#### Data Quality Validation
4. **Required Element Presence**
   - Verify required elements per US Core CarePlan profile are present
   - Validate data types match profile requirements
   - Assertion: All required elements SHALL be present and conform to specified data types

5. **Terminology Validation**
   - Verify coded elements use appropriate value sets as specified in US Core CarePlan profile
   - Check binding strength compliance (required vs. extensible)
   - Assertion: Coded elements SHALL use values from specified value sets where required

#### System Integration Validation
6. **CapabilityStatement Verification**
   - Verify system's CapabilityStatement declares support for US Core CarePlan profile
   - Check that CarePlan is listed in supported resources (if applicable)
   - Assertion: CapabilityStatement SHALL accurately reflect CarePlan profile support

7. **JSON Format Support**
   - Verify CarePlan resources can be represented in JSON format
   - Validate JSON structure conforms to FHIR R4 specification
   - Assertion: System SHALL support JSON format for CarePlan resources

#### Reference Integrity (if applicable)
8. **Resource References Validation**
   - Verify referenced resources in CarePlan conform to appropriate US Core profiles
   - Check reference resolution capability
   - Assertion: Referenced resources SHALL conform to US Core profiles where applicable

### Pass/Fail Criteria
- **PASS**: All CarePlan resources validate successfully against US Core CarePlan profile, all Must Support elements are appropriately handled, and profile support is correctly declared
- **FAIL**: Any CarePlan resource fails validation, required elements are missing, or profile support is not properly declared

### Test Execution Notes
- Test should accommodate various CarePlan types and statuses present in the system
- Focus on conformance validation rather than clinical content accuracy
- Utilize existing system data to ensure real-world applicability
- Document any profile deviations or validation warnings for review

---



<a id='careteam'></a>

## CareTeam

<a id='req-453'></a>

### REQ-453: US Core CareTeam Profile implementation

**Text**: 

**Context**: System conformance to US Core CareTeam Profile.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-453

## 1. Requirement ID
REQ-453: US Core CareTeam Profile implementation

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be tested through automated validation of CareTeam resources against the US Core CareTeam Profile, verification of profile support declarations, and testing of FHIR operations as defined in the capability statement.

### Complexity
**Moderate** - Requires validation of profile conformance, Must Support element verification, and testing of RESTful operations. The complexity is moderate because it involves multiple validation layers including structural conformance, Must Support requirements, and operational capabilities.

### Prerequisites
- System must be configured as a US Core Server
- System must have CareTeam resources available for testing
- System must support JSON format (required) and optionally XML format
- System must implement appropriate security measures (authentication/authorization)
- System must declare support for US Core CareTeam Profile in its CapabilityStatement

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: 
  - CareTeam resources that conform to US Core CareTeam Profile
  - Related Patient resources (referenced by CareTeam resources)
  - Any other resources referenced by Must Support elements in CareTeam instances
- **System Configuration**:
  - US Core Server implementation
  - Valid authentication credentials (if required)
  - Base FHIR server URL

### Expected Outputs
- **Profile Conformance**: All CareTeam resources validate successfully against US Core CareTeam Profile
- **CapabilityStatement Declaration**: Server declares support for US Core CareTeam Profile
- **Must Support Compliance**: All Must Support elements are properly implemented
- **RESTful Operation Support**: Successful execution of supported FHIR operations
- **Appropriate HTTP Response Codes**: Valid responses for various scenarios (200, 400, 401, 403, 404)

### Required FHIR Operations
Based on the capability statement, the following operations should be tested if supported by the server:
- `GET /metadata` - Retrieve CapabilityStatement
- `GET /CareTeam/[id]` - Read specific CareTeam resource
- `GET /CareTeam` - Search for CareTeam resources
- Additional search operations as declared in the server's CapabilityStatement

### Validation Criteria

#### 1. Profile Declaration Validation
**Test**: Verify CapabilityStatement declares US Core CareTeam Profile support
- **Operation**: `GET /metadata`
- **Assertion**: CapabilityStatement includes reference to US Core CareTeam Profile in supported profiles
- **Pass Criteria**: Profile URL `http://hl7.org/fhir/us/core/StructureDefinition/us-core-careteam` is declared

#### 2. Resource Profile Conformance
**Test**: Validate CareTeam resources conform to US Core CareTeam Profile
- **Operation**: Retrieve CareTeam resources using supported operations
- **Assertion**: Each CareTeam resource validates against US Core CareTeam Profile
- **Pass Criteria**: 
  - Resources pass FHIR validation against the profile
  - Resources include `meta.profile` element referencing US Core CareTeam Profile (SHOULD requirement)

#### 3. Must Support Element Validation
**Test**: Verify implementation of Must Support elements
- **Operation**: Examine CareTeam resource content
- **Assertion**: All Must Support elements defined in US Core CareTeam Profile are properly supported
- **Pass Criteria**: 
  - Must Support elements are present when data is available
  - Must Support elements follow the requirements documented in the Must Support page
  - Referenced resources (Patient, Practitioner, etc.) conform to their respective US Core profiles when present

#### 4. JSON Format Support
**Test**: Verify JSON format support (SHALL requirement)
- **Operation**: Request CareTeam resources with `Accept: application/fhir+json`
- **Assertion**: Server returns valid JSON formatted FHIR resources
- **Pass Criteria**: Response is valid JSON and conforms to FHIR JSON format requirements

#### 5. XML Format Support (Optional)
**Test**: Verify XML format support (SHOULD requirement)
- **Operation**: Request CareTeam resources with `Accept: application/fhir+xml`
- **Assertion**: Server returns valid XML formatted FHIR resources (if supported)
- **Pass Criteria**: If supported, response is valid XML and conforms to FHIR XML format requirements

#### 6. Error Response Validation
**Test**: Verify appropriate error responses
- **Operation**: Test invalid requests (invalid IDs, unauthorized access, etc.)
- **Assertion**: Server returns appropriate HTTP status codes
- **Pass Criteria**:
  - Status 400 for invalid parameters
  - Status 401/4xx for unauthorized requests
  - Status 403 for insufficient scopes
  - Status 404 for unknown resources

#### 7. Referenced Resource Validation
**Test**: Verify Must Support resource references are properly implemented
- **Operation**: Follow resource references from CareTeam resources
- **Assertion**: Referenced resources conform to appropriate US Core profiles
- **Pass Criteria**: 
  - Patient references resolve to US Core Patient Profile conformant resources
  - Other referenced resources conform to their respective US Core profiles when applicable
  - All Must Support references are properly maintained as per the Must Support - Resource References requirements

#### 8. Security Implementation
**Test**: Verify security requirements implementation
- **Operation**: Test unauthorized access scenarios
- **Assertion**: Server properly handles authentication and authorization
- **Pass Criteria**: Server rejects unauthorized requests with appropriate HTTP status codes (401, 403, or 404)

### Test Execution Notes
- Tests should be executed using the "bring your own data" approach, working with existing CareTeam resources in the system
- Focus on interoperability conformance rather than exhaustive edge case testing
- Validate that the implementation supports the core functionality required for US Core CareTeam Profile compliance
- Ensure all Must Support elements are tested when data is available in the system under test

---



<a id='condition'></a>

## Condition

<a id='req-060'></a>

### REQ-060: Condition SHALL have a category.

**Text**: 

**Context**: 

**Actor**: Healthcare Provider

**Conformance**: SHALL

# Test Specification for REQ-060

## 1. Requirement ID
**REQ-060**: Condition SHALL have a category

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified programmatically by checking for the presence of the `category` element in Condition resources.

### Complexity
**Simple** - This is a straightforward structural validation requiring the presence of a mandatory element.

### Prerequisites
- US Core Server implementation supporting Condition resources
- Test system capable of performing FHIR REST operations
- Access to Condition resources (either existing in the server or ability to create test data)
- Server must support at least one of the US Core Condition profiles:
  - US Core Condition Encounter Diagnosis Profile
  - US Core Condition Problems and Health Concerns Profile

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Condition resources that conform to US Core profiles
- **Server Endpoint**: Base FHIR server URL supporting US Core Server CapabilityStatement
- **Authentication**: Valid credentials if required by the server

### Expected Outputs
- Condition resources retrieved from the server must contain a `category` element
- All Condition resources must validate against the structural requirement

### Required FHIR Operations
Based on the Capability Statement, the following supported operations can be used:

1. **Search Operations**:
   - `GET [base]/Condition?patient={id}` - Search for Conditions by patient
   - `GET [base]/Condition?patient={id}&category={category}` - Search by patient and category
   - `GET [base]/Condition?category={category}` - Search by category only
   - Additional supported search combinations as per capability statement

2. **Read Operations**:
   - `GET [base]/Condition/{id}` - Read specific Condition resource

### Validation Criteria

#### Test Case 1: Search-Based Validation
**Objective**: Verify that all Condition resources returned by search operations contain the required `category` element.

**Steps**:
1. Execute patient-based Condition search: `GET [base]/Condition?patient={patient-id}`
2. For each Condition resource in the search results:
   - Verify the resource contains a `category` element
   - Verify the `category` element is not empty
   - Verify the `category` element contains at least one valid coding

**Pass Criteria**:
- All returned Condition resources have a populated `category` element
- Each `category` element contains at least one coding with system and code values

**Fail Criteria**:
- Any Condition resource lacks a `category` element
- Any `category` element is present but empty or null

#### Test Case 2: Direct Read Validation
**Objective**: Verify that individually retrieved Condition resources contain the required `category` element.

**Steps**:
1. Obtain Condition resource IDs (from previous searches or other means)
2. For each Condition ID, execute: `GET [base]/Condition/{id}`
3. Validate the retrieved resource contains the `category` element

**Pass Criteria**:
- Each retrieved Condition resource has a populated `category` element
- The `category` element structure conforms to FHIR specification requirements

**Fail Criteria**:
- Any retrieved Condition resource lacks a `category` element
- The `category` element is malformed or empty

#### Test Case 3: Category-Specific Search Validation
**Objective**: Verify that category-based searches return valid results with proper category elements.

**Steps**:
1. Execute category-based search: `GET [base]/Condition?category=encounter-diagnosis`
2. Execute category-based search: `GET [base]/Condition?category=problem-list-item`
3. For each result set, verify all returned resources contain appropriate `category` elements

**Pass Criteria**:
- Search results are returned (if applicable data exists)
- All returned Condition resources contain the searched-for category value
- All resources maintain the required `category` element structure

**Fail Criteria**:
- Returned resources lack the `category` element
- Returned resources contain incorrect or missing category values

#### Assertion Specifications
1. **Structural Assertion**: `assert exists(Condition.category)`
2. **Content Assertion**: `assert Condition.category.coding.exists()`
3. **Non-Empty Assertion**: `assert Condition.category.coding.count() > 0`
4. **Valid System Assertion**: `assert Condition.category.coding.system.exists()`
5. **Valid Code Assertion**: `assert Condition.category.coding.code.exists()`

#### Additional Validation Considerations
- Test should accommodate different category values as defined in US Core profiles
- Validation should work regardless of the specific patient data present in the system
- Test should handle both encounter diagnosis and problem list item condition types
- Results should be consistent across different search approaches (patient-based vs. category-based searches)

---

<a id='req-061'></a>

### REQ-061: Condition SHALL have a code.

**Text**: 

**Context**: 

**Actor**: Healthcare Provider

**Conformance**: SHALL

# Test Specification for REQ-061

## 1. Requirement ID
**REQ-061**: Condition SHALL have a code

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be programmatically verified by checking that all Condition resources contain a populated `code` element.

### Complexity
**Simple** - This is a straightforward structural validation that requires checking for the presence of a mandatory field.

### Prerequisites
- US Core Server implementation supporting Condition resources
- Access to Condition resources via FHIR API (either US Core Condition Encounter Diagnosis Profile or US Core Condition Problems and Health Concerns Profile)
- Test system capable of performing FHIR resource validation

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Condition resources conforming to either:
  - US Core Condition Encounter Diagnosis Profile
  - US Core Condition Problems and Health Concerns Profile
- **Data Requirements**: Any existing Condition resources in the system being tested

### Expected Outputs
- Validation results confirming all retrieved Condition resources contain a `code` element
- Clear pass/fail status for each Condition resource examined

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for Condition resources:

**Primary Operations:**
- `GET /Condition?patient={id}` - Retrieve Condition resources for a specific patient
- `GET /Condition?patient={id}&category={category}` - Retrieve Condition resources filtered by category
- `GET /Condition/{id}` - Retrieve specific Condition resource by ID

**Alternative Search Operations (as supported):**
- `GET /Condition?patient={id}&clinical-status={status}`
- `GET /Condition?patient={id}&code={code}`
- `GET /Condition?patient={id}&recorded-date={date}`

### Validation Criteria

#### Primary Assertions
1. **Code Presence Check**: Every Condition resource MUST contain a `code` element
   - `assert exists(Condition.code)`
   - The `code` element must not be null or empty

2. **Code Structure Validation**: The `code` element MUST be properly structured as a CodeableConcept
   - `assert Condition.code is CodeableConcept`
   - At minimum, the CodeableConcept should contain either:
     - At least one `coding` element with `system` and `code` values, OR
     - A `text` value

#### Test Execution Steps
1. **Resource Retrieval**: Execute one or more of the supported search operations to retrieve Condition resources
2. **Iterate Through Results**: For each Condition resource in the response bundle:
   - Verify the presence of the `code` element
   - Validate the structure of the `code` element as a CodeableConcept
   - Record any failures for reporting

#### Pass/Fail Criteria
- **PASS**: All retrieved Condition resources contain a properly structured `code` element
- **FAIL**: Any Condition resource lacks a `code` element or has a malformed `code` element

#### Error Handling
- If no Condition resources are found, the test should report "No data to test" rather than pass or fail
- Network errors or server errors should be reported separately from conformance failures
- Invalid FHIR responses should be reported as server conformance issues

#### Reporting Requirements
- Total number of Condition resources examined
- Number of resources that passed validation
- Number of resources that failed validation
- Specific details of any failures including resource ID and nature of the violation
- Summary pass/fail status for the overall requirement

---

<a id='req-062'></a>

### REQ-062: Condition SHALL have a recorded date.

**Text**: 

**Context**: 

**Actor**: Healthcare Provider

**Conformance**: SHALL

# Test Specification for REQ-062

## 1. Requirement ID
REQ-062

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified programmatically by examining Condition resources to confirm the presence of a recorded date field.

### Complexity
**Simple** - This is a straightforward validation of a mandatory field presence in FHIR Condition resources.

### Prerequisites
- System must support US Core Server CapabilityStatement
- System must implement US Core Condition profiles:
  - US Core Condition Encounter Diagnosis Profile
  - US Core Condition Problems and Health Concerns Profile
- Access to Condition resources with various data scenarios
- System must support Condition resource retrieval operations

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Condition resources conforming to US Core profiles
- Patient resources (referenced by Condition resources)
- Any existing Condition data in the system under test

**Expected Outputs:**
- Retrieved Condition resources must contain a recorded date
- Validation results confirming presence of recorded date field
- Error responses for non-conformant resources (if applicable)

### Required FHIR Operations
Based on the Capability Statement, the following supported operations will be used:

**Primary Operations:**
- `GET [base]/Condition?patient=[id]` - Retrieve Conditions for a specific patient
- `GET [base]/Condition?patient=[id]&recorded-date=[date]` - Search Conditions by patient and recorded date
- `GET [base]/Condition/[id]` - Retrieve specific Condition resource by ID

**Additional Supported Search Parameters:**
- `patient+recorded-date` (explicitly supported combination)
- `recorded-date` (standalone parameter)

### Validation Criteria

**Primary Validation:**
1. **Recorded Date Presence Check:**
   - Each retrieved Condition resource MUST contain the `recordedDate` element
   - The `recordedDate` field MUST NOT be null or empty
   - The `recordedDate` field MUST contain a valid FHIR date or dateTime value

**Secondary Validations:**
2. **Data Type Validation:**
   - Verify `recordedDate` conforms to FHIR date/dateTime format requirements
   - Ensure the date value is properly formatted (YYYY-MM-DD or full dateTime)

3. **Search Functionality Validation:**
   - Verify that searching by `recorded-date` parameter returns appropriate results
   - Confirm that `patient+recorded-date` combination searches work as specified in the Capability Statement

**Test Execution Steps:**
1. Query system for available Condition resources using patient-based searches
2. For each retrieved Condition resource:
   - Validate presence of `recordedDate` element
   - Verify the value is not null/empty
   - Confirm proper FHIR date/dateTime formatting
3. Test recorded-date search parameter functionality
4. Document any Condition resources that fail the recorded date requirement

**Pass Criteria:**
- All Condition resources contain a non-null `recordedDate` value
- All recorded dates conform to FHIR date/dateTime format specifications
- Search operations using `recorded-date` parameter function correctly

**Fail Criteria:**
- Any Condition resource is missing the `recordedDate` element
- Any Condition resource has a null or empty `recordedDate` value
- Any `recordedDate` value does not conform to FHIR date/dateTime format requirements

---

<a id='req-063'></a>

### REQ-063: Condition SHALL have a recorder.

**Text**: 

**Context**: 

**Actor**: Healthcare Provider

**Conformance**: SHALL

# Test Specification for REQ-063

## Requirement ID
REQ-063

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified programmatically by checking the presence of the `recorder` element in Condition resources.

### Complexity
**Simple** - The test involves a straightforward validation of a mandatory field presence in FHIR resources.

### Prerequisites
- FHIR server implementing US Core Server CapabilityStatement
- System must support Condition resource with US Core Condition profiles:
  - US Core Condition Encounter Diagnosis Profile
  - US Core Condition Problems and Health Concerns Profile
- Test data containing Condition resources associated with the Healthcare Provider actor

## Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: 
  - Condition resources conforming to US Core profiles
  - Associated Patient resources (referenced by Condition.subject)
  - Practitioner or PractitionerRole resources (potential recorder references)
- **Test Parameters**:
  - Patient identifier or reference for filtering Condition resources
  - Server base URL for FHIR endpoint

### Expected Outputs
- Validation results indicating whether all Condition resources contain the mandatory `recorder` element
- List of non-conformant Condition resources (if any)
- Detailed error messages for missing recorder elements

### Required FHIR Operations
Based on the Capability Statement, the following supported operations will be used:

1. **Condition Search Operations**:
   - `GET [base]/Condition?patient={patient_id}` - Search for Condition resources by patient
   - `GET [base]/Condition?patient={patient_id}&category={category}` - Search with category filter
   - `GET [base]/Condition/{id}` - Retrieve specific Condition resource

2. **Supporting Operations** (if needed for test context):
   - `GET [base]/Patient/{id}` - Retrieve patient information
   - `GET [base]/Practitioner/{id}` or `GET [base]/PractitionerRole/{id}` - Validate recorder references

### Validation Criteria

The test shall verify the following assertions for each Condition resource:

#### Primary Assertion
1. **Recorder Element Presence**: 
   - `Condition.recorder` element SHALL be present
   - `Condition.recorder` SHALL NOT be null or empty
   - `Condition.recorder` SHALL contain a valid Reference

#### Secondary Validations
2. **Reference Validity**:
   - If `Condition.recorder.reference` is provided, it SHALL reference a valid resource (Practitioner, PractitionerRole, Patient, or RelatedPerson)
   - Reference format SHALL conform to FHIR Reference requirements

#### Profile Conformance
3. **US Core Profile Compliance**:
   - Condition resources SHALL conform to either:
     - US Core Condition Encounter Diagnosis Profile, OR
     - US Core Condition Problems and Health Concerns Profile
   - Profile validation SHALL pass for the respective profile type

#### Test Pass Criteria
- **PASS**: All Condition resources in the test dataset contain a valid `recorder` element
- **FAIL**: Any Condition resource lacks the `recorder` element or contains an invalid recorder reference

#### Test Implementation Notes
- The test should accommodate "bring your own data" by testing all Condition resources available for the specified patient(s)
- The test should handle both profile types (encounter diagnosis and problems/health concerns) appropriately
- Error reporting should clearly identify which specific Condition resources fail the requirement
- The test should validate that the recorder reference points to an appropriate resource type (Practitioner, PractitionerRole, Patient, or RelatedPerson)

---

<a id='req-316'></a>

### REQ-316: Inclusion of SNOMED CT codes in the value set

**Text**: 

**Context**: 

**Actor**: Implementer

**Conformance**: SHALL

# Test Specification for REQ-316

## 1. Requirement ID
REQ-316

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated validation of ValueSet expansion and code verification against SNOMED CT terminology.

### Complexity
**Simple** - The test involves validating that a specific ValueSet includes SNOMED CT codes as required by the US Core specification.

### Prerequisites
- Access to a US Core compliant FHIR server
- Access to SNOMED CT terminology service or local SNOMED CT codes
- US Core Condition Codes ValueSet must be available on the server
- Server must support ValueSet expansion operations

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: 
  - ValueSet resource for US Core Condition Codes (canonical URL: `http://hl7.org/fhir/us/core/ValueSet/us-core-condition-codes`)
- **Test Data**: Tester's own condition data that should include conditions coded with SNOMED CT codes
- **Terminology Requirements**: Access to SNOMED CT code system

### Required FHIR Operations
Based on the Capability Statement, the following operations are needed:

1. **ValueSet Read Operation**: `GET [base]/ValueSet/us-core-condition-codes`
   - Supported by US Core Server capability for ValueSet resources
   
2. **ValueSet Expand Operation**: `GET [base]/ValueSet/us-core-condition-codes/$expand`
   - Required to retrieve the expanded list of codes in the ValueSet
   
3. **Terminology Validation** (if supported): `POST [base]/ValueSet/$validate-code`
   - To validate specific SNOMED CT codes against the ValueSet

### Validation Criteria

The following assertions must pass for the requirement to be considered conformant:

#### Primary Validation Criteria:

1. **ValueSet Structure Validation**:
   - The US Core Condition Codes ValueSet SHALL be retrievable from the server
   - The ValueSet SHALL include at least one compose element that references SNOMED CT code system
   - SNOMED CT code system URI (`http://snomed.info/sct`) SHALL be present in the ValueSet composition

2. **SNOMED CT Code Inclusion Validation**:
   - When expanded, the ValueSet SHALL contain codes from the SNOMED CT code system
   - At minimum, verify presence of core SNOMED CT codes that are expected in a condition codes value set
   - Each SNOMED CT code in the expansion SHALL have the correct system URI (`http://snomed.info/sct`)

3. **Code System Reference Validation**:
   - The ValueSet compose SHALL explicitly reference `http://snomed.info/sct` as a code system
   - If filters are applied, they SHALL be valid SNOMED CT filters
   - Any included SNOMED CT codes SHALL be active and valid codes

#### Test Execution Steps:

1. **Retrieve ValueSet Definition**:
   ```
   GET [base]/ValueSet/us-core-condition-codes
   ```
   - Verify response returns 200 OK
   - Verify ValueSet contains SNOMED CT system references

2. **Expand ValueSet**:
   ```
   GET [base]/ValueSet/us-core-condition-codes/$expand
   ```
   - Verify response returns 200 OK
   - Verify expansion contains codes with system = `http://snomed.info/sct`
   - Count and validate that SNOMED CT codes are present in meaningful numbers

3. **Validate Code Representation** (using tester's own data):
   - For any Condition resources in the tester's dataset that use SNOMED CT codes
   - Verify these codes are included in or can be validated against the US Core Condition Codes ValueSet
   - Confirm proper code system URI usage in actual condition data

#### Pass/Fail Criteria:

**PASS**: 
- ValueSet successfully retrieved and contains explicit SNOMED CT code system references
- ValueSet expansion includes SNOMED CT codes with correct system URI
- Tester's condition data using SNOMED CT codes validates against the ValueSet

**FAIL**:
- ValueSet cannot be retrieved (404 error)
- ValueSet does not reference SNOMED CT code system
- ValueSet expansion contains no SNOMED CT codes
- SNOMED CT codes in expansion have incorrect system URI
- Tester's SNOMED CT coded conditions fail validation against the ValueSet

### Additional Considerations

- **Error Handling**: Test should handle cases where ValueSet expansion is large and may require paging
- **Performance**: Expansion operations may be resource-intensive; implement appropriate timeouts
- **Version Sensitivity**: SNOMED CT codes may vary by version; test should account for version-specific variations where applicable

---

<a id='req-317'></a>

### REQ-317: Inclusion of SNOMED CT codes for clinical findings

**Text**: 

**Context**: 

**Actor**: Implementer

**Conformance**: SHALL

# Test Specification for REQ-317

## Requirement ID
REQ-317

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated through automated testing by examining Condition resources and verifying the presence and validity of SNOMED CT codes for clinical findings in the appropriate coding fields.

### Complexity
**Moderate** - The test requires:
- Retrieval of Condition resources from the server
- Validation of SNOMED CT code presence and format
- Cross-reference with US Core Condition Codes ValueSet
- Understanding of SNOMED CT clinical findings hierarchy

### Prerequisites
- FHIR server implementing US Core Server CapabilityStatement
- Server must support Condition resource queries as per US Core requirements
- Access to US Core Condition Codes ValueSet for validation
- SNOMED CT terminology server access or local terminology validation capability
- Test data containing Condition resources with clinical findings

## Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Condition resources that represent clinical findings
- **ValueSet**: US Core Condition Codes ValueSet (http://hl7.org/fhir/us/core/ValueSet/us-core-condition-code)
- **Terminology System**: SNOMED CT (http://snomed.info/sct)
- **Server Endpoint**: FHIR server base URL implementing US Core Server capabilities

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required:

1. **GET [base]/Condition** - Search for Condition resources
2. **GET [base]/Condition/[id]** - Read specific Condition resources
3. **GET [base]/ValueSet** - Access to US Core Condition Codes ValueSet (if server supports ValueSet operations)

### Validation Criteria

#### Primary Validation Checks

1. **SNOMED CT Code Presence Validation**
   - **Assertion**: All Condition resources representing clinical findings SHALL include at least one SNOMED CT code
   - **Implementation**: 
     - Retrieve Condition resources from server
     - Examine `Condition.code.coding` elements
     - Verify at least one coding element has `system = "http://snomed.info/sct"`

2. **Code System Validation**
   - **Assertion**: SNOMED CT codes SHALL use the correct system URI
   - **Implementation**:
     - For each SNOMED CT coding found, verify `system = "http://snomed.info/sct"`
     - Verify the `code` field contains a valid SNOMED CT concept identifier

3. **ValueSet Conformance Validation**
   - **Assertion**: SNOMED CT codes SHALL be valid members of the US Core Condition Codes ValueSet
   - **Implementation**:
     - Validate each SNOMED CT code against the US Core Condition Codes ValueSet
     - Use `$validate-code` operation or local ValueSet expansion for validation

4. **Clinical Findings Hierarchy Validation**
   - **Assertion**: SNOMED CT codes SHALL represent concepts that are clinical findings (descendants of 404684003 |Clinical finding|)
   - **Implementation**:
     - Verify each SNOMED CT code is a descendant of SCTID 404684003
     - Use SNOMED CT hierarchy validation or terminology services

#### Secondary Validation Checks

5. **Code Format Validation**
   - **Assertion**: SNOMED CT codes SHALL follow proper format requirements
   - **Implementation**:
     - Verify codes are numeric and follow SNOMED CT identifier rules
     - Check for proper length and checksum if applicable

6. **Display Value Validation**
   - **Assertion**: SNOMED CT codings SHOULD include accurate display values
   - **Implementation**:
     - When display values are present, verify they match the preferred term for the SNOMED CT concept
     - Use terminology server lookup for validation

#### Test Execution Steps

1. **Discovery Phase**
   - Query server for available Condition resources: `GET [base]/Condition`
   - Identify Condition resources that represent clinical findings (vs. non-clinical administrative conditions)

2. **Code Extraction Phase**
   - For each relevant Condition resource, extract all coding elements from `Condition.code.coding`
   - Filter for SNOMED CT codes (system = "http://snomed.info/sct")

3. **Validation Phase**
   - Execute primary validation checks 1-4
   - Execute secondary validation checks 5-6
   - Document any non-conformant resources

4. **Reporting Phase**
   - Generate conformance report indicating:
     - Total number of Condition resources tested
     - Number of resources with valid SNOMED CT codes
     - Number of resources failing validation
     - Specific validation failures and affected resources

#### Pass/Fail Criteria

**Test PASSES if**:
- 100% of Condition resources representing clinical findings contain at least one valid SNOMED CT code from the US Core Condition Codes ValueSet
- All SNOMED CT codes use the correct system URI and represent clinical findings

**Test FAILS if**:
- Any Condition resource representing a clinical finding lacks a SNOMED CT code
- Any SNOMED CT code uses an incorrect system URI
- Any SNOMED CT code is not a valid member of the US Core Condition Codes ValueSet
- Any SNOMED CT code does not represent a clinical finding concept

---

<a id='req-318'></a>

### REQ-318: Inclusion of SNOMED CT codes for context-dependent categories

**Text**: 

**Context**: 

**Actor**: Implementer

**Conformance**: SHALL

# Test Specification for REQ-318

## Requirement ID
REQ-318

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated inspection of ValueSet definitions and validation of FHIR resources that reference the US Core Condition Codes ValueSet.

### Complexity
**Simple** - The requirement involves validating that SNOMED CT codes are included in a specific ValueSet for context-dependent categories.

### Prerequisites
- Access to the US Core Condition Codes ValueSet definition
- FHIR server supporting US Core Implementation Guide
- Test system capable of ValueSet operations and validation
- Sample Condition resources using context-dependent categories

## Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: 
  - ValueSet resource for US Core Condition Codes
  - Sample Condition resources that reference context-dependent categories
- **Test Data**: Any existing Condition resources in the system that use category codes
- **Configuration**: FHIR server with US Core IG implementation

### Expected Outputs
- ValueSet expansion showing SNOMED CT codes for context-dependent categories
- Validation results confirming SNOMED CT code inclusion
- Successful validation of Condition resources using these codes

### Required FHIR Operations
Based on the Capability Statement analysis:

1. **ValueSet $expand operation** (SHOULD support per Capability Statement):
   ```
   GET [base]/ValueSet/$expand?url=http://hl7.org/fhir/us/core/ValueSet/us-core-condition-code
   ```

2. **Condition resource searches** (SHALL support per Capability Statement):
   ```
   GET [base]/Condition?patient=[patient-id]&category=[category-code]
   ```

3. **ValueSet read operation**:
   ```
   GET [base]/ValueSet/us-core-condition-code
   ```

### Validation Criteria

#### Primary Assertions
1. **ValueSet Content Validation**:
   - The US Core Condition Codes ValueSet SHALL include SNOMED CT codes appropriate for context-dependent categories
   - Verify the ValueSet contains concepts from SNOMED CT system (http://snomed.info/sct)
   - Confirm context-dependent category codes are properly represented

2. **ValueSet Expansion Validation**:
   - When expanded, the ValueSet SHALL return SNOMED CT codes that can be used for context-dependent categorization
   - Expansion results SHALL include proper system, code, and display values for SNOMED CT concepts

3. **Resource Validation**:
   - Condition resources using context-dependent categories SHALL validate against the US Core Condition profiles
   - Category codes used in Condition resources SHALL be present in the US Core Condition Codes ValueSet
   - SNOMED CT codes used for categorization SHALL conform to the ValueSet binding requirements

#### Test Cases

**Test Case 1: ValueSet Definition Validation**
- Retrieve the US Core Condition Codes ValueSet
- Verify it includes SNOMED CT system references
- Confirm it supports context-dependent category concepts

**Test Case 2: ValueSet Expansion Testing**
- Execute $expand operation on US Core Condition Codes ValueSet
- Verify expansion includes SNOMED CT codes for context-dependent categories
- Validate proper code system, code, and display values

**Test Case 3: Condition Resource Category Validation**
- Search for existing Condition resources with category codes
- Validate that category codes reference SNOMED CT concepts
- Confirm category codes are present in the US Core Condition Codes ValueSet

**Test Case 4: Cross-Profile Validation**
- Test Condition resources conforming to both US Core Condition profiles:
  - US Core Condition Encounter Diagnosis Profile
  - US Core Condition Problems and Health Concerns Profile
- Verify SNOMED CT category codes work across both profiles

#### Success Criteria
- All retrieved SNOMED CT codes for context-dependent categories validate successfully
- ValueSet expansion operations complete without errors
- Condition resources using SNOMED CT category codes pass validation
- No validation errors when using appropriate SNOMED CT codes for context-dependent categorization

#### Failure Scenarios
- ValueSet does not include required SNOMED CT codes for context-dependent categories
- $expand operation fails or returns incomplete results
- Condition resources fail validation when using SNOMED CT category codes
- Missing or incorrect SNOMED CT system references in ValueSet definition

---

<a id='req-319'></a>

### REQ-319: Inclusion of SNOMED CT codes for events

**Text**: 

**Context**: 

**Actor**: Implementer

**Conformance**: SHALL

# Test Specification for REQ-319

## 1. Requirement ID
REQ-319

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be programmatically verified by examining FHIR resources to confirm the presence and validity of SNOMED CT codes in relevant coding fields.

### Complexity
**Simple** - The test involves straightforward validation of code systems and value sets within FHIR resources.

### Prerequisites
- Access to a FHIR server implementing US Core profiles
- FHIR resources containing condition/event data with coding elements
- Access to the US Core Condition Codes ValueSet definition
- Ability to validate SNOMED CT code format and structure

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Any US Core resources that reference conditions or events with coding elements, primarily:
  - US Core Condition Profile resources
  - Other US Core resources that may contain condition codes (e.g., Encounter, Procedure, DiagnosticReport)
- **ValueSet**: US Core Condition Codes ValueSet (http://hl7.org/fhir/us/core/ValueSet/us-core-condition-code)

### Expected Outputs
- Test results indicating whether SNOMED CT codes are properly included where required
- Detailed validation report showing which resources contain valid SNOMED CT codes
- Any non-conformant instances with specific error descriptions

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations will be used:

1. **Resource Retrieval Operations**:
   - `GET [base]/Condition` - Retrieve Condition resources
   - `GET [base]/Condition/[id]` - Retrieve specific Condition instances
   - `GET [base]/Encounter` - Retrieve Encounter resources (if they contain condition codes)
   - `GET [base]/Procedure` - Retrieve Procedure resources (if they contain condition codes)

2. **Search Operations** (as supported by US Core Server):
   - Search parameters to filter resources that should contain condition codes
   - Use standard FHIR search parameters as specified in the CapabilityStatement

3. **Metadata Operations**:
   - `GET [base]/metadata` - Verify server capabilities and supported profiles

### Validation Criteria

The test SHALL verify the following assertions for each relevant resource:

#### Primary Validations:
1. **SNOMED CT Code System Presence**:
   - For any coding element that references the US Core Condition Codes ValueSet, verify that at least one Coding entry uses the SNOMED CT code system URI: `http://snomed.info/sct`

2. **Code Format Validation**:
   - SNOMED CT codes must follow the proper format (numeric identifier)
   - Codes must be valid SNOMED CT concept identifiers

3. **ValueSet Conformance**:
   - Any SNOMED CT codes used must be valid members of the US Core Condition Codes ValueSet
   - Verify codes are not deprecated or inactive in SNOMED CT

#### Secondary Validations:
4. **Coding Element Structure**:
   - Coding elements containing SNOMED CT codes must include:
     - `system`: "http://snomed.info/sct"
     - `code`: Valid SNOMED CT concept ID
     - `display`: Human-readable description (SHOULD be present)

5. **Profile Conformance**:
   - Resources must conform to their respective US Core profiles
   - Must Support elements must be properly populated when condition codes are present

#### Test Passing Criteria:
- **PASS**: All resources that are required to include condition codes contain at least one valid SNOMED CT code from the US Core Condition Codes ValueSet
- **FAIL**: Any resource that should contain condition codes either:
  - Lacks SNOMED CT codes entirely when required
  - Contains invalid SNOMED CT code format
  - Uses SNOMED CT codes not present in the US Core Condition Codes ValueSet
  - Has malformed coding structure for SNOMED CT entries

#### Test Execution Approach:
1. Retrieve all relevant resources from the test system
2. Filter resources that should contain condition/event codes based on US Core profile requirements
3. For each resource, examine all coding elements that reference conditions/events
4. Validate SNOMED CT code presence, format, and ValueSet membership
5. Generate detailed conformance report with specific findings for each non-conformant instance

This test specification ensures that the "bring your own data" approach is supported by testing against whatever condition/event data exists in the system under test, while maintaining focus on interoperability conformance rather than comprehensive edge case testing.

---

<a id='req-321'></a>

### REQ-321: Inclusion of ICD-9-CM codes in the value set

**Text**: 

**Context**: 

**Actor**: Implementer

**Conformance**: SHALL

# Test Specification for REQ-321

## 1. Requirement ID
**REQ-321**: Inclusion of ICD-9-CM codes in the value set

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified programmatically by examining the ValueSet resource and validating that ICD-9-CM codes are properly included and accessible.

### Complexity
**Simple** - The test involves straightforward validation of value set content and code system inclusion.

### Prerequisites
- US Core Server implementation with ValueSet support
- Access to the US Core Condition Codes ValueSet
- Server capability to respond to ValueSet expansion requests
- Test system capable of parsing ValueSet resources and validating code systems

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- ValueSet resource for US Core Condition Codes (canonical URL: `http://hl7.org/fhir/us/core/ValueSet/us-core-condition-code`)
- Any Condition resources that reference ICD-9-CM codes (if available in test data)

**Expected Outputs:**
- ValueSet resource containing ICD-9-CM code system references
- Successful ValueSet expansion including ICD-9-CM codes
- Validation confirmation that ICD-9-CM codes are accepted in Condition resources

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations should be supported:

1. **ValueSet Read Operation**
   ```
   GET [base]/ValueSet/us-core-condition-code
   ```

2. **ValueSet Expansion Operation**
   ```
   GET [base]/ValueSet/us-core-condition-code/$expand
   ```

3. **Condition Resource Validation** (if supported)
   - POST or PUT operations for Condition resources using ICD-9-CM codes

### Validation Criteria

The test SHALL verify the following assertions for conformance:

#### Primary Assertions:
1. **ValueSet Structure Validation**
   - The US Core Condition Codes ValueSet resource exists and is accessible
   - The ValueSet includes references to the ICD-9-CM code system (`http://hl7.org/fhir/sid/icd-9-cm`)
   - The ValueSet structure conforms to US Core ValueSet profile requirements

2. **Code System Inclusion Verification**
   - The ValueSet compose element includes ICD-9-CM as an allowed code system
   - ICD-9-CM codes appear in the ValueSet expansion (either through include statements or expansion results)

3. **Expansion Functionality**
   - ValueSet expansion operation completes successfully
   - Expanded ValueSet contains at least one ICD-9-CM code
   - ICD-9-CM codes in the expansion have the correct system identifier

#### Secondary Assertions (if test data available):
4. **Practical Usage Validation**
   - Condition resources using ICD-9-CM codes are accepted by the server
   - ICD-9-CM codes validate against the US Core Condition Codes ValueSet
   - Code validation responses correctly identify ICD-9-CM codes as valid

#### Test Pass Criteria:
- All primary assertions (1-3) MUST pass
- If Condition resources with ICD-9-CM codes are available in test data, secondary assertions (4) MUST also pass
- Server responses MUST be conformant FHIR resources
- No validation errors related to ICD-9-CM code exclusion

#### Test Fail Criteria:
- ValueSet does not include ICD-9-CM code system references
- ValueSet expansion excludes all ICD-9-CM codes
- Server rejects valid ICD-9-CM codes in Condition resources
- ValueSet structure is non-conformant to US Core requirements

**Note**: This test accommodates a "bring your own data" approach by focusing on ValueSet structure and expansion capabilities rather than requiring specific fixture data, while still allowing validation of actual usage patterns when relevant test data is available.

---

<a id='req-349'></a>

### REQ-349: The USCoreConditionEncounterDiagnosisProfile SHALL map the Condition.identifier to Event.identifier.

**Text**: 

**Context**: Workflow Pattern mappings for USCoreConditionEncounterDiagnosisProfile

**Actor**: USCoreConditionEncounterDiagnosisProfile

**Conformance**: SHALL

# Test Specification for REQ-349

## 1. Requirement ID
**REQ-349**: USCoreConditionEncounterDiagnosisProfile SHALL map Condition.identifier to Event.identifier

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified through automated testing by examining the structure and content of FHIR resources to validate the presence and mapping of identifier elements.

### Complexity
**Simple** - This is a straightforward structural mapping requirement that involves checking for the presence of identifier elements in specific locations within a Condition resource.

### Prerequisites
- System must support US Core Condition Encounter Diagnosis Profile
- System must be capable of creating/retrieving Condition resources that conform to the USCoreConditionEncounterDiagnosisProfile
- Test data must include Condition resources with populated identifier elements
- Understanding of the Workflow Pattern mapping context where Event.identifier corresponds to Condition.identifier

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Condition resources that conform to the US Core Condition Encounter Diagnosis Profile (http://hl7.org/fhir/us/core/StructureDefinition/us-core-condition-encounter-diagnosis)
- Resources should contain populated `Condition.identifier` elements with realistic healthcare identifiers

**Expected Outputs:**
- Validation confirmation that Condition.identifier elements are properly structured and accessible
- Verification that the mapping to Event.identifier is conceptually supported through the resource structure

### Required FHIR Operations
Based on the Capability Statement, the following supported operations will be used:
- **GET /Condition/{id}** - Retrieve specific Condition resources for validation
- **GET /Condition?patient={patient-id}&category={category}** - Search for encounter diagnosis conditions
- **GET /Condition?patient={patient-id}&encounter={encounter-id}** - Search for conditions associated with specific encounters

### Validation Criteria

#### Primary Validation Checks:
1. **Profile Conformance Validation**
   - Verify that Condition resources conform to the US Core Condition Encounter Diagnosis Profile
   - Confirm resource validates against the profile without errors

2. **Identifier Element Presence**
   - Assert that `Condition.identifier` element exists in the resource when identifiers are present
   - Verify identifier structure follows FHIR Identifier datatype requirements

3. **Identifier Structure Validation**
   - Validate that each identifier contains appropriate system and value components
   - Ensure identifier values are properly formatted and non-empty when present

4. **Workflow Pattern Mapping Support**
   - Confirm that Condition.identifier can serve as the Event.identifier in workflow pattern contexts
   - Verify identifier persistence and accessibility for workflow tracking purposes

#### Test Assertions for Passing:
- **PASS**: All retrieved Condition resources that claim conformance to USCoreConditionEncounterDiagnosisProfile contain well-formed identifier elements when identifiers are present
- **PASS**: Condition.identifier elements follow FHIR Identifier datatype specifications
- **PASS**: Resources successfully validate against the US Core Condition Encounter Diagnosis Profile
- **PASS**: Identifier mappings support workflow pattern requirements where Condition.identifier can function as Event.identifier

#### Test Execution Approach:
1. Retrieve Condition resources using supported search parameters from the Capability Statement
2. Filter results to only include resources conforming to USCoreConditionEncounterDiagnosisProfile
3. For each resource, validate the presence and structure of Condition.identifier elements
4. Verify that identifier elements can adequately serve the Event.identifier mapping purpose
5. Confirm overall profile conformance using FHIR validation tools

This test specification ensures that the mapping requirement is validated through practical resource examination while accommodating a "bring your own data" testing approach.

---

<a id='req-350'></a>

### REQ-350: The USCoreConditionEncounterDiagnosisProfile SHALL map the Condition.clinicalStatus to Event.status.

**Text**: 

**Context**: Workflow Pattern mappings for USCoreConditionEncounterDiagnosisProfile

**Actor**: USCoreConditionEncounterDiagnosisProfile

**Conformance**: SHALL

# Test Specification for REQ-350

## Requirement ID
REQ-350

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified programmatically by examining the mapping between `Condition.clinicalStatus` and `Event.status` values in USCoreConditionEncounterDiagnosisProfile instances.

### Complexity
**Simple** - The requirement involves a straightforward field mapping validation between two well-defined FHIR elements with established value sets.

### Prerequisites
- US Core Server implementing the US Core Condition Encounter Diagnosis Profile
- Test system capable of retrieving Condition resources via FHIR API
- Access to Condition resources that conform to the USCoreConditionEncounterDiagnosisProfile
- Understanding of FHIR Workflow Pattern mappings

## Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Condition resources conforming to USCoreConditionEncounterDiagnosisProfile
- **Test Data**: Any existing Condition resources in the system that:
  - Conform to the US Core Condition Encounter Diagnosis Profile
  - Have populated `clinicalStatus` values
  - Are associated with encounter diagnoses

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported:
- `GET /Condition?patient={id}` - Retrieve conditions for a patient
- `GET /Condition?patient={id}&category=encounter-diagnosis` - Retrieve encounter diagnosis conditions
- `GET /Condition/{id}` - Retrieve specific condition by ID

### Validation Criteria

The test SHALL verify that each USCoreConditionEncounterDiagnosisProfile instance properly maps `Condition.clinicalStatus` to the equivalent `Event.status` value according to the FHIR Workflow Pattern mapping rules:

#### Mapping Validation Rules:
1. **Active Clinical Status Mapping**:
   - `Condition.clinicalStatus` = "active" SHALL map to `Event.status` = "in-progress"
   
2. **Inactive Clinical Status Mapping**:
   - `Condition.clinicalStatus` = "inactive" SHALL map to `Event.status` = "completed"
   
3. **Resolved Clinical Status Mapping**:
   - `Condition.clinicalStatus` = "resolved" SHALL map to `Event.status` = "completed"
   
4. **Recurrence Clinical Status Mapping**:
   - `Condition.clinicalStatus` = "recurrence" SHALL map to `Event.status` = "in-progress"

#### Test Assertions:
For each Condition resource tested:

1. **Profile Conformance**: Verify the resource conforms to USCoreConditionEncounterDiagnosisProfile
2. **Clinical Status Presence**: Assert that `Condition.clinicalStatus` is present and populated
3. **Valid Clinical Status**: Verify `clinicalStatus` contains a valid value from the condition-clinical ValueSet
4. **Mapping Accuracy**: Assert that the conceptual mapping from `clinicalStatus` to `Event.status` follows the workflow pattern rules
5. **Encounter Context**: Verify the condition is appropriately associated with an encounter (supporting the encounter diagnosis context)

#### Success Criteria:
- All tested Condition resources demonstrate proper mapping alignment between `clinicalStatus` and the expected `Event.status` equivalent
- No USCoreConditionEncounterDiagnosisProfile instances violate the workflow pattern mapping requirements
- The mapping is consistent across all encounter diagnosis conditions in the system

#### Test Execution Approach:
1. Query for Condition resources using supported search parameters (patient, category=encounter-diagnosis, clinical-status)
2. For each retrieved Condition resource, validate profile conformance
3. Extract the `clinicalStatus` value
4. Apply the workflow pattern mapping rules to determine expected `Event.status` equivalent
5. Document any mapping violations or inconsistencies
6. Generate test results indicating conformance or non-conformance with the mapping requirement

---

<a id='req-351'></a>

### REQ-351: The USCoreConditionEncounterDiagnosisProfile SHALL map the Condition.verificationStatus to Event.status.

**Text**: 

**Context**: Workflow Pattern mappings for USCoreConditionEncounterDiagnosisProfile

**Actor**: USCoreConditionEncounterDiagnosisProfile

**Conformance**: SHALL

# Test Specification for REQ-351

## 1. Requirement ID
REQ-351

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Automatically testable

This requirement is automatically testable as it involves verifying a specific mapping between two FHIR elements (`Condition.verificationStatus` to `Event.status`) within the USCoreConditionEncounterDiagnosisProfile. The mapping can be validated programmatically by examining the profile definition and confirming the structural relationship exists.

### Complexity
**Level**: Simple

The requirement involves a straightforward one-to-one element mapping verification within a single profile. No complex business logic or multi-resource interactions are required.

### Prerequisites
- Access to the USCoreConditionEncounterDiagnosisProfile definition
- Understanding of FHIR Workflow Pattern mappings
- Access to FHIR structure definitions and mapping specifications
- Test system capable of validating FHIR profile mappings

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources Needed**:
- USCoreConditionEncounterDiagnosisProfile structure definition
- Any Condition resource instances conforming to USCoreConditionEncounterDiagnosisProfile (using "bring your own data" approach)

**Expected Outputs**:
- Confirmation that the profile mapping exists and is correctly defined
- Validation that `Condition.verificationStatus` maps to `Event.status` as specified

### Required FHIR Operations
Based on the US Core Server Capability Statement, the following operations are supported and may be utilized:

1. **GET** `/StructureDefinition/us-core-condition-encounter-diagnosis` - To retrieve the profile definition
2. **GET** `/Condition` - To retrieve Condition resources for testing (if available)
3. **GET** `/Condition/{id}` - To retrieve specific Condition instances

*Note: These operations align with the US Core Server's requirement to support RESTful capabilities and return appropriate response classes (400, 401/4xx, 403, 404).*

### Validation Criteria

**Primary Assertions**:

1. **Profile Mapping Verification**:
   - The USCoreConditionEncounterDiagnosisProfile SHALL contain a mapping definition
   - The mapping SHALL explicitly map `Condition.verificationStatus` to `Event.status`
   - The mapping SHALL be present in the profile's mapping section for the Workflow Pattern

2. **Structural Validation**:
   - Retrieve the USCoreConditionEncounterDiagnosisProfile structure definition
   - Verify that the profile includes mapping information for the Workflow Pattern
   - Confirm that within the Workflow Pattern mappings, there exists an entry mapping `Condition.verificationStatus` to `Event.status`

3. **Conformance Validation**:
   - The mapping SHALL be marked as required (not optional) given the "SHALL" conformance level
   - The mapping SHALL be present and correctly formatted according to FHIR mapping syntax

**Test Pass Criteria**:
- The profile definition contains the required mapping
- The mapping correctly identifies `Condition.verificationStatus` as the source element
- The mapping correctly identifies `Event.status` as the target element
- The mapping is associated with the Workflow Pattern context
- No validation errors occur when examining the mapping definition

**Test Fail Criteria**:
- The mapping is missing from the profile definition
- The mapping maps to an incorrect target element
- The mapping is not associated with the Workflow Pattern context
- The mapping is marked as optional when it should be required
- Structural validation errors occur in the profile definition

**Implementation Notes**:
- This test focuses on the profile definition itself rather than runtime behavior
- The test should validate the mapping at the profile level, ensuring interoperability conformance
- Since this uses a "bring your own data" approach, the test should work with any valid USCoreConditionEncounterDiagnosisProfile instances provided by the tester
- The test should verify that the mapping enables proper workflow pattern implementation across different systems

---

<a id='req-352'></a>

### REQ-352: The USCoreConditionEncounterDiagnosisProfile SHALL map the Condition.code to Event.code.

**Text**: 

**Context**: Workflow Pattern mappings for USCoreConditionEncounterDiagnosisProfile

**Actor**: USCoreConditionEncounterDiagnosisProfile

**Conformance**: SHALL

# Test Specification for REQ-352

## 1. Requirement ID
REQ-352

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Automatically testable

This requirement involves verifying that a specific FHIR profile (USCoreConditionEncounterDiagnosisProfile) correctly maps the `Condition.code` element to `Event.code` as part of Workflow Pattern mappings. This is a structural mapping requirement that can be validated programmatically by examining the profile definition and its mappings.

### Complexity
**Level**: Simple

The requirement focuses on a single, well-defined mapping between two specific elements within a known profile structure.

### Prerequisites
- Access to US Core Implementation Guide profile definitions
- USCoreConditionEncounterDiagnosisProfile structure definition
- Understanding of FHIR Workflow Pattern mappings
- System supporting US Core Server capabilities for Condition resources

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- StructureDefinition for USCoreConditionEncounterDiagnosisProfile
- Sample Condition resources conforming to USCoreConditionEncounterDiagnosisProfile with populated `code` elements

**Expected Outputs:**
- Verification that the profile mapping explicitly defines `Condition.code` → `Event.code`
- Confirmation that test data demonstrates proper mapping implementation

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required:

1. **GET /StructureDefinition/us-core-condition-encounter-diagnosis** 
   - Retrieve the profile definition to examine mappings
   
2. **GET /Condition?patient=[id]&category=encounter-diagnosis**
   - Retrieve Condition resources using supported search parameters from the capability statement
   
3. **GET /Condition?patient=[id]&code=[code]**
   - Validate code-based queries work as expected per capability statement

### Validation Criteria

**Primary Assertions:**

1. **Profile Mapping Verification:**
   - The USCoreConditionEncounterDiagnosisProfile StructureDefinition SHALL contain an explicit mapping for `Condition.code` to `Event.code`
   - The mapping SHALL be present in the profile's mapping section with identity matching the Workflow Pattern

2. **Implementation Verification:**
   - Test Condition resources conforming to USCoreConditionEncounterDiagnosisProfile SHALL have populated `Condition.code` elements
   - The `Condition.code` values SHALL be mappable to `Event.code` according to the Workflow Pattern specification
   - Validation against the profile SHALL pass for test resources

3. **Capability Statement Alignment:**
   - The system SHALL support the Condition resource operations as defined in the US Core Server Capability Statement
   - Search operations using `code` parameter SHALL function correctly for encounter diagnosis conditions

**Test Pass Criteria:**
- Profile definition contains the required mapping
- Test data validates successfully against the profile
- Code-based searches return expected results
- No validation errors when testing the mapping implementation

**Test Fail Criteria:**
- Missing or incorrect mapping definition in the profile
- Validation failures when testing conformant resources
- Inability to search or retrieve resources using code-based parameters
- Mapping implementation does not align with Workflow Pattern requirements

---

<a id='req-353'></a>

### REQ-353: The USCoreConditionEncounterDiagnosisProfile SHALL map the Condition.subject to Event.subject.

**Text**: 

**Context**: Workflow Pattern mappings for USCoreConditionEncounterDiagnosisProfile

**Actor**: USCoreConditionEncounterDiagnosisProfile

**Conformance**: SHALL

# REQ-353 Test Specification

## Requirement ID
REQ-353

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated validation by examining the structure and content of FHIR Condition resources that conform to the USCoreConditionEncounterDiagnosisProfile.

### Complexity
**Simple** - The requirement involves a straightforward mapping verification between two specific elements within a FHIR resource structure.

### Prerequisites
- System must support the US Core Condition Encounter Diagnosis Profile
- System must be capable of serving Condition resources via FHIR RESTful API
- Test data must include Condition resources that conform to the USCoreConditionEncounterDiagnosisProfile
- System must support the Condition resource operations as defined in the US Core Server CapabilityStatement

## Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: 
  - One or more Condition resources conforming to USCoreConditionEncounterDiagnosisProfile
  - Each Condition resource must have a populated `subject` element
- **System Configuration**: 
  - FHIR server implementing US Core Server CapabilityStatement
  - Support for Condition resource searches as specified in the capability statement

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are supported and may be used:

1. **GET /Condition/[id]** - Retrieve specific Condition resource by ID
2. **GET /Condition?patient=[patient-id]** - Search for Condition resources by patient
3. **GET /Condition?patient=[patient-id]&category=encounter-diagnosis** - Search for encounter diagnosis conditions for a specific patient

### Validation Criteria

**Primary Assertion:**
For each Condition resource that conforms to USCoreConditionEncounterDiagnosisProfile:
1. Verify that `Condition.subject` element is present and populated
2. Verify that the `Condition.subject` contains a valid reference to a Patient resource
3. Confirm that the mapping follows the Workflow Pattern specification where `Condition.subject` maps to `Event.subject`

**Specific Test Steps:**
1. **Resource Retrieval**: Retrieve Condition resources that claim conformance to USCoreConditionEncounterDiagnosisProfile
2. **Profile Validation**: Validate that the Condition resource conforms to the USCoreConditionEncounterDiagnosisProfile structure
3. **Subject Element Verification**: 
   - Assert that `Condition.subject` is present
   - Assert that `Condition.subject` is not null or empty
   - Assert that `Condition.subject.reference` contains a valid Patient resource reference
4. **Workflow Pattern Mapping Verification**: Confirm that the subject mapping aligns with the Event.subject pattern as specified in the Workflow Pattern mappings

**Expected Test Results:**
- **PASS**: All tested Condition resources have properly populated `subject` elements that correctly map to Event.subject according to the Workflow Pattern
- **FAIL**: Any Condition resource conforming to USCoreConditionEncounterDiagnosisProfile lacks a `subject` element or has an improperly formatted subject reference

**Additional Validation Points:**
- Verify that the subject reference format follows FHIR reference conventions (e.g., "Patient/[id]" or absolute URL)
- Ensure that the referenced Patient resource exists and is accessible (if testing in a connected environment)
- Confirm that the Condition resource passes FHIR validation against the USCoreConditionEncounterDiagnosisProfile

---

<a id='req-354'></a>

### REQ-354: The USCoreConditionEncounterDiagnosisProfile SHALL map the Condition.encounter to Event.context.

**Text**: 

**Context**: Workflow Pattern mappings for USCoreConditionEncounterDiagnosisProfile

**Actor**: USCoreConditionEncounterDiagnosisProfile

**Conformance**: SHALL

# Test Specification for REQ-354

## Requirement ID
REQ-354

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated inspection of FHIR resource structure and workflow pattern mappings.

### Complexity
**Simple** - The requirement involves a straightforward structural mapping validation between two specific elements in a FHIR profile.

### Prerequisites
- System must support the US Core Condition Encounter Diagnosis Profile
- System must have Condition resources with encounter-diagnosis category
- System must have associated Encounter resources
- Test data must include Condition resources that reference encounters

## Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: 
  - Condition resources conforming to US Core Condition Encounter Diagnosis Profile
  - Associated Encounter resources referenced by the Condition resources
- **Data Requirements**:
  - Condition resources with `category` containing "encounter-diagnosis"
  - Condition resources with populated `encounter` element
  - Valid Encounter resource references

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required:

1. **GET /Condition/[id]** - Retrieve individual Condition resources
2. **GET /Condition?patient=[patient-id]&category=encounter-diagnosis** - Search for encounter diagnosis conditions
3. **GET /Encounter/[id]** - Retrieve referenced Encounter resources to validate the mapping

### Validation Criteria

The test must verify the following assertions to demonstrate conformance:

#### Primary Validation
1. **Profile Conformance**: Each Condition resource must conform to the US Core Condition Encounter Diagnosis Profile
2. **Category Verification**: Condition resources must have `category` containing the "encounter-diagnosis" code
3. **Encounter Reference Mapping**: For each Condition resource with category "encounter-diagnosis":
   - The `Condition.encounter` element must be present
   - The `Condition.encounter` element must contain a valid reference to an Encounter resource
   - The referenced Encounter resource must exist and be accessible

#### Secondary Validation
1. **Workflow Pattern Compliance**: Verify that the Condition.encounter mapping aligns with the Event.context pattern as specified in the workflow pattern mappings
2. **Reference Integrity**: Ensure that all encounter references resolve to valid, accessible Encounter resources
3. **Data Consistency**: Confirm that the encounter context is appropriate for the diagnosis being recorded

#### Test Pass Criteria
- All Condition resources with encounter-diagnosis category have populated encounter references
- All encounter references resolve to valid Encounter resources
- The mapping demonstrates proper implementation of the Event.context workflow pattern
- No validation errors are found when validating against the US Core Condition Encounter Diagnosis Profile

#### Test Fail Criteria
- Any Condition resource with encounter-diagnosis category lacks an encounter reference
- Any encounter reference fails to resolve to a valid Encounter resource
- Profile validation errors occur
- The workflow pattern mapping is not properly implemented

### Test Execution Approach
1. Query for Condition resources with encounter-diagnosis category
2. For each returned Condition resource:
   - Validate profile conformance
   - Verify encounter element is present and populated
   - Resolve the encounter reference
   - Confirm the referenced Encounter exists
3. Document any failures or inconsistencies in the mapping implementation

---

<a id='req-355'></a>

### REQ-355: The USCoreConditionEncounterDiagnosisProfile SHALL map the Condition.onset[x] to Event.occurrence[x].

**Text**: 

**Context**: Workflow Pattern mappings for USCoreConditionEncounterDiagnosisProfile

**Actor**: USCoreConditionEncounterDiagnosisProfile

**Conformance**: SHALL

# Test Specification for REQ-355

## 1. Requirement ID
**REQ-355**: USCoreConditionEncounterDiagnosisProfile SHALL map Condition.onset[x] to Event.occurrence[x]

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Automatically testable

This requirement is automatically testable because it involves verifying the presence and correct mapping of specific FHIR data elements (Condition.onset[x] to Event.occurrence[x]) within the USCoreConditionEncounterDiagnosisProfile structure. The mapping can be validated programmatically by examining the resource structure and field mappings.

### Complexity
**Level**: Simple

The requirement involves a straightforward field mapping verification between two well-defined FHIR elements within a single profile.

### Prerequisites
- System must support US Core Server CapabilityStatement
- System must implement USCoreConditionEncounterDiagnosisProfile
- Test data must include Condition resources conforming to USCoreConditionEncounterDiagnosisProfile
- Condition resources should contain onset[x] data elements for meaningful testing

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Condition resources that conform to USCoreConditionEncounterDiagnosisProfile
- **Resource Requirements**: 
  - Condition resources must have populated onset[x] elements (onsetDateTime, onsetAge, onsetPeriod, onsetRange, or onsetString)
  - Resources should represent encounter diagnoses as specified in the profile
- **Data Scope**: Use existing Condition resources from the test system's data store

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required:

1. **GET /Condition** - Retrieve Condition resources
2. **GET /Condition?patient=[id]** - Search for patient-specific conditions
3. **GET /Condition?patient=[id]&category=encounter-diagnosis** - Search for encounter diagnosis conditions
4. **GET /Condition/{id}** - Retrieve specific Condition resource by ID

### Validation Criteria

#### Primary Validation Checks:
1. **Profile Conformance Verification**
   - Verify that retrieved Condition resources declare conformance to USCoreConditionEncounterDiagnosisProfile
   - Check that `Condition.meta.profile` contains `http://hl7.org/fhir/us/core/StructureDefinition/us-core-condition-encounter-diagnosis`

2. **Onset Mapping Validation**
   - For each Condition resource with populated onset[x] elements:
     - Verify that onset[x] data is present and properly formatted according to FHIR R4 specifications
     - Confirm that onset[x] values map appropriately to Event.occurrence[x] pattern as defined in the Workflow Pattern
     - Validate data type consistency (e.g., onsetDateTime maps to occurrence[x] dateTime patterns)

3. **Data Element Structure Checks**
   - Ensure onset[x] elements follow FHIR choice type conventions
   - Verify that only one onset[x] variant is populated per resource (onsetDateTime XOR onsetAge XOR onsetPeriod, etc.)
   - Confirm that onset[x] values are clinically appropriate for encounter diagnosis contexts

#### Test Pass Criteria:
- All retrieved USCoreConditionEncounterDiagnosisProfile resources with onset[x] data demonstrate proper mapping alignment with Event.occurrence[x] pattern
- No structural inconsistencies found in onset[x] to occurrence[x] mapping implementation
- Resources maintain semantic integrity between Condition.onset[x] and corresponding Event workflow pattern expectations

#### Test Fail Criteria:
- USCoreConditionEncounterDiagnosisProfile resources contain onset[x] elements that do not properly align with Event.occurrence[x] mapping requirements
- Missing or incorrectly formatted onset[x] elements in resources claiming profile conformance
- Structural violations of the Workflow Pattern mapping specifications

### Test Execution Approach:
1. Query for Condition resources using supported search parameters
2. Filter results to USCoreConditionEncounterDiagnosisProfile conformant resources
3. Extract and analyze onset[x] elements from each resource
4. Validate mapping compliance against Event.occurrence[x] pattern requirements
5. Generate conformance report with pass/fail status and detailed findings

---

<a id='req-356'></a>

### REQ-356: The USCoreConditionEncounterDiagnosisProfile SHALL map the Condition.evidence.code to Event.reasonCode.

**Text**: 

**Context**: Workflow Pattern mappings for USCoreConditionEncounterDiagnosisProfile

**Actor**: USCoreConditionEncounterDiagnosisProfile

**Conformance**: SHALL

# Test Specification for REQ-356

## Requirement ID
REQ-356

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified programmatically by examining the structural mapping between `Condition.evidence.code` and `Event.reasonCode` in USCoreConditionEncounterDiagnosisProfile instances.

### Complexity
**Moderate** - The test requires:
- Understanding of FHIR resource structure and workflow pattern mappings
- Validation of specific element mappings between different conceptual models
- Knowledge of US Core Condition profiles and their constraints

### Prerequisites
- FHIR server supporting US Core Implementation Guide
- Server must support US Core Condition Encounter Diagnosis Profile
- Test data containing Condition resources with evidence elements populated
- Server must support Condition resource read operations per Capability Statement

## Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Condition resources conforming to US Core Condition Encounter Diagnosis Profile
- Resources must contain `Condition.evidence.code` elements to test the mapping
- Patient resources to support the patient search requirements

**Expected Outputs:**
- Condition resources where `Condition.evidence.code` values are properly mapped to corresponding `Event.reasonCode` conceptual elements
- Validation that the workflow pattern mapping is correctly implemented

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required:

1. **Search Operations:**
   - `GET [base]/Condition?patient=[id]&category=encounter-diagnosis` (SHALL support)
   - `GET [base]/Condition?patient=[id]&category=encounter-diagnosis&encounter=[id]` (SHOULD support)

2. **Read Operations:**
   - `GET [base]/Condition/[id]` (SHALL support)

3. **Include Operations:**
   - `GET [base]/Condition?[parameters]&_revinclude=Provenance:target` (SHALL support)

### Validation Criteria

**Primary Assertions:**
1. **Profile Conformance Validation:**
   - Verify that retrieved Condition resources conform to US Core Condition Encounter Diagnosis Profile
   - Validate that `Condition.category` contains "encounter-diagnosis" code

2. **Evidence Code Mapping Validation:**
   - For each Condition resource with populated `Condition.evidence.code`:
     - Verify that the evidence code exists and is properly structured
     - Validate that the code follows the required coding system bindings
     - Ensure the evidence code represents clinical reasoning supporting the condition

3. **Workflow Pattern Mapping Verification:**
   - Confirm that `Condition.evidence.code` values align with the conceptual Event.reasonCode mapping
   - Validate that the evidence codes represent the clinical justification/reasoning for the encounter diagnosis
   - Verify that the semantic meaning of the evidence code corresponds to the "reason for the event" concept

4. **Data Integrity Checks:**
   - Ensure that when `Condition.evidence.code` is present, it contains valid coded values
   - Validate that evidence codes use appropriate terminology systems (e.g., SNOMED CT, ICD-10, LOINC)
   - Confirm that the evidence code provides meaningful clinical context for the condition

**Test Success Criteria:**
- All retrieved Condition resources with evidence elements demonstrate proper mapping between `Condition.evidence.code` and the Event.reasonCode conceptual model
- Evidence codes provide clinically meaningful justification for encounter diagnoses
- The workflow pattern mapping maintains semantic consistency between the condition's evidence and the reason for the clinical event
- No validation errors when processing the evidence code mappings according to US Core requirements

**Test Failure Indicators:**
- Condition resources contain `Condition.evidence.code` elements that do not align with Event.reasonCode semantics
- Missing or improperly formatted evidence codes when clinical reasoning should be documented
- Evidence codes that do not provide meaningful clinical justification for encounter diagnoses
- Workflow pattern mapping inconsistencies between condition evidence and event reasoning

---

<a id='req-357'></a>

### REQ-357: The USCoreConditionEncounterDiagnosisProfile SHALL map the Condition.note to Event.note.

**Text**: 

**Context**: Workflow Pattern mappings for USCoreConditionEncounterDiagnosisProfile

**Actor**: USCoreConditionEncounterDiagnosisProfile

**Conformance**: SHALL

# Test Specification for REQ-357

## Requirement ID
REQ-357

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified programmatically by examining the structure and content of USCoreConditionEncounterDiagnosisProfile instances to confirm that Condition.note elements are properly mapped to Event.note.

### Complexity
**Simple** - The requirement involves a straightforward field mapping verification between two specific elements within the same resource profile.

### Prerequisites
- System must support US Core Condition Encounter Diagnosis Profile
- System must have Condition resources that implement the USCoreConditionEncounterDiagnosisProfile
- Test data should include Condition resources with populated note elements to enable meaningful validation

## Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Condition resources conforming to US Core Condition Encounter Diagnosis Profile (http://hl7.org/fhir/us/core/StructureDefinition/us-core-condition-encounter-diagnosis)
- Resources should include populated `Condition.note` elements for testing the mapping requirement

**Expected Outputs:**
- Validation confirmation that Condition.note content is properly mapped to Event.note according to the Workflow Pattern mappings
- All note elements present in Condition.note should be accessible through the Event.note mapping

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for Condition resources:

**Primary Operations:**
- `GET /Condition/{id}` - Retrieve specific Condition resources that conform to US Core Condition Encounter Diagnosis Profile
- `GET /Condition?patient={patient_id}&category=encounter-diagnosis` - Search for encounter diagnosis conditions for validation

**Supporting Search Parameters:**
- `patient` (required for most searches)
- `category` (to filter for encounter-diagnosis conditions)
- `encounter` (if testing encounter-specific conditions)

### Validation Criteria

**Pass Criteria:**
1. **Profile Conformance**: Retrieved Condition resources must conform to the US Core Condition Encounter Diagnosis Profile
2. **Note Element Presence**: When `Condition.note` elements exist in the resource, they must be properly structured and accessible
3. **Mapping Verification**: All content present in `Condition.note` must be mappable to `Event.note` according to the Workflow Pattern specification
4. **Data Integrity**: Note content, including text, time, and author information, must be preserved in the mapping
5. **Cardinality Compliance**: The mapping must respect cardinality constraints for both source and target elements

**Validation Steps:**
1. Retrieve Condition resources using supported search parameters
2. Verify each resource conforms to US Core Condition Encounter Diagnosis Profile
3. For resources with populated `note` elements:
   - Validate note structure matches FHIR Annotation datatype requirements
   - Confirm all note attributes (text, authorReference, authorString, time) are present as expected
   - Verify the mapping to Event.note maintains semantic equivalence
4. Confirm that resources without note elements handle the mapping appropriately (no errors, proper null handling)

**Fail Criteria:**
- Condition resources do not conform to the US Core Condition Encounter Diagnosis Profile
- Note elements are present but not accessible through the Event.note mapping
- Data loss or corruption occurs during the mapping process
- Mapping violates cardinality constraints or data type requirements
- System errors when processing the note-to-note mapping

**Test Data Considerations:**
- Include Condition resources with various note configurations (single note, multiple notes, notes with different authors)
- Test with notes containing different data elements (text-only, with timestamps, with author references)
- Include resources without notes to verify proper handling of empty/null cases

---

<a id='req-398'></a>

### REQ-398: The Condition resource SHALL map the identifier to Event.identifier.

**Text**: 

**Context**: FHIR Workflow Pattern mapping for the USCoreConditionProblemsHealthConcernsProfile.

**Actor**: Implementer of the USCoreConditionProblemsHealthConcernsProfile

**Conformance**: SHALL

# Test Specification for REQ-398

## 1. Requirement ID
**REQ-398**

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified through automated inspection of FHIR Condition resource instances to validate that identifier elements are properly mapped according to the FHIR Workflow Pattern specification.

### Complexity
**Simple** - The test involves straightforward validation of data mapping between Condition.identifier and Event.identifier pattern, requiring basic FHIR resource structure inspection.

### Prerequisites
- Server implementing US Core Condition Problems and Health Concerns Profile
- Access to Condition resources with identifier elements
- Understanding of FHIR Workflow Pattern mapping requirements
- Test system capable of FHIR resource retrieval and validation

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Condition resources conforming to US Core Condition Problems and Health Concerns Profile that contain identifier elements
- **Test Data**: Any existing Condition resources in the system under test that have populated identifier fields
- **Profile Definition**: US Core Condition Problems and Health Concerns Profile structure definition

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for Condition resources:

1. **GET /Condition/{id}** - Retrieve specific Condition resource instances
2. **GET /Condition?patient={patient-id}** - Search for Condition resources by patient
3. **GET /Condition?patient={patient-id}&category={category}** - Search with additional category filtering

### Validation Criteria

The test SHALL verify the following assertions for each Condition resource instance:

#### Primary Validation
1. **Identifier Presence Check**: 
   - IF Condition.identifier is present, THEN validate that it conforms to the Event.identifier pattern mapping requirements

2. **Identifier Structure Validation**:
   - Verify that Condition.identifier follows the structure expected for Event.identifier mapping
   - Validate that identifier elements contain appropriate system and value components when present
   - Ensure identifier cardinality and data types match workflow pattern expectations

#### Secondary Validation
3. **Profile Conformance**:
   - Confirm the Condition resource declares conformance to US Core Condition Problems and Health Concerns Profile in meta.profile
   - Validate that the resource passes profile validation against the US Core Condition Problems and Health Concerns Profile

4. **Workflow Pattern Consistency**:
   - Verify that the identifier mapping is consistent with FHIR Workflow Pattern requirements
   - Ensure that identifier usage aligns with Event pattern specifications

### Test Execution Steps

1. **Resource Discovery**:
   - Query the server for Condition resources using supported search parameters
   - Focus on resources that contain identifier elements

2. **Resource Retrieval**:
   - Retrieve individual Condition resources for detailed validation
   - Ensure resources conform to US Core Condition Problems and Health Concerns Profile

3. **Identifier Mapping Validation**:
   - For each Condition resource with identifiers, validate mapping to Event.identifier pattern
   - Check identifier structure, format, and conformance to workflow pattern requirements

4. **Conformance Verification**:
   - Validate that identifier mappings meet the SHALL requirement specification
   - Document any non-conformant instances for remediation

### Success Criteria
- All Condition resources with identifiers properly map to Event.identifier pattern
- No validation errors related to identifier mapping requirements
- Resources maintain conformance to US Core Condition Problems and Health Concerns Profile
- Identifier usage aligns with FHIR Workflow Pattern specifications

### Failure Scenarios
- Condition.identifier elements that do not conform to Event.identifier mapping requirements
- Missing or malformed identifier structures
- Profile validation failures
- Inconsistent workflow pattern implementation

---

<a id='req-399'></a>

### REQ-399: The Condition resource SHALL map clinicalStatus to Event.status.

**Text**: 

**Context**: FHIR Workflow Pattern mapping for the USCoreConditionProblemsHealthConcernsProfile.

**Actor**: Implementer of the USCoreConditionProblemsHealthConcernsProfile

**Conformance**: SHALL

# Test Specification for REQ-399

## 1. Requirement ID
**REQ-399**: The Condition resource SHALL map clinicalStatus to Event.status

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified programmatically by inspecting Condition resources and validating that the clinicalStatus field properly maps to Event.status according to FHIR Workflow Pattern specifications.

### Complexity
**Simple** - This is a straightforward mapping verification that requires checking a single field mapping in Condition resources.

### Prerequisites
- System must implement the US Core Condition Problems and Health Concerns Profile
- System must support RESTful FHIR operations for Condition resources
- Test data must include Condition resources with various clinicalStatus values
- Access to retrieve Condition resources via supported search parameters

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Condition resources conforming to US Core Condition Problems and Health Concerns Profile
- Resources should contain various clinicalStatus values (active, recurrence, relapse, inactive, remission, resolved)

**Expected Outputs:**
- Retrieved Condition resources with populated clinicalStatus field
- Validation confirmation that clinicalStatus values conform to Event.status mapping requirements

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for Condition resources:

**Primary Operations:**
- `GET [base]/Condition?patient=[id]` - Retrieve patient's conditions
- `GET [base]/Condition?patient=[id]&clinical-status=[status]` - Search by clinical status
- `GET [base]/Condition/[id]` - Retrieve specific condition by ID

**Additional Supported Search Parameters:**
- `patient+category+clinical-status` - Combined search for comprehensive testing
- `patient+clinical-status` - Direct clinical status filtering

### Validation Criteria

**Test Case 1: Clinical Status Value Validation**
- **Action**: Retrieve Condition resources using patient-based searches
- **Assertion**: Verify that all Condition resources contain a valid clinicalStatus element
- **Pass Criteria**: clinicalStatus field is present and contains one of the valid values per FHIR specification: active, recurrence, relapse, inactive, remission, resolved, entered-in-error, unknown

**Test Case 2: Event.status Mapping Verification**
- **Action**: For each retrieved Condition resource, examine the clinicalStatus value
- **Assertion**: Verify clinicalStatus maps correctly to Event.status according to FHIR Workflow Pattern:
  - `active` → maps to Event.status `in-progress`
  - `recurrence` → maps to Event.status `in-progress` 
  - `relapse` → maps to Event.status `in-progress`
  - `inactive` → maps to Event.status `on-hold`
  - `remission` → maps to Event.status `on-hold`
  - `resolved` → maps to Event.status `completed`
  - `entered-in-error` → maps to Event.status `entered-in-error`
  - `unknown` → maps to Event.status `unknown`
- **Pass Criteria**: All clinicalStatus values can be appropriately mapped to valid Event.status values

**Test Case 3: Profile Conformance**
- **Action**: Validate retrieved Condition resources against US Core Condition Problems and Health Concerns Profile
- **Assertion**: Resources conform to profile requirements including proper clinicalStatus usage
- **Pass Criteria**: All resources pass profile validation with no errors related to clinicalStatus field

**Test Case 4: Search Parameter Functionality**
- **Action**: Execute searches using clinical-status parameter with various status values
- **Assertion**: Search results accurately filter based on clinicalStatus values
- **Pass Criteria**: 
  - Search with `clinical-status=active` returns only conditions with clinicalStatus=active
  - Search with `clinical-status=resolved` returns only conditions with clinicalStatus=resolved
  - Combined searches with patient+clinical-status return appropriate filtered results

**Overall Pass Criteria:**
- All Condition resources contain valid clinicalStatus values that properly map to Event.status
- No validation errors related to clinicalStatus field structure or values
- Search operations using clinical-status parameter function correctly
- Resources conform to US Core Condition Problems and Health Concerns Profile requirements

---

<a id='req-400'></a>

### REQ-400: The Condition resource SHALL map verificationStatus to Event.status.

**Text**: 

**Context**: FHIR Workflow Pattern mapping for the USCoreConditionProblemsHealthConcernsProfile.

**Actor**: Implementer of the USCoreConditionProblemsHealthConcernsProfile

**Conformance**: SHALL

# Test Specification for REQ-400

## 1. Requirement ID
REQ-400

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated through automated testing by inspecting the mapping between `Condition.verificationStatus` and the equivalent `Event.status` field in the FHIR Workflow Pattern.

### Complexity
**Simple** - The requirement involves a straightforward field mapping validation that can be checked through direct property inspection.

### Prerequisites
- Server implementing US Core Condition Problems and Health Concerns Profile
- Test system with access to Condition resources that contain verificationStatus elements
- Understanding of FHIR Workflow Pattern Event.status mapping requirements
- Server must support the Condition resource type per the Capability Statement

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- One or more `Condition` resources conforming to the US Core Condition Problems and Health Concerns Profile
- Resources must contain populated `verificationStatus` elements with valid values from the ConditionVerificationStatus value set

**Expected Outputs:**
- Validation that each `Condition.verificationStatus` value correctly maps to the corresponding `Event.status` value according to FHIR Workflow Pattern specifications

### Required FHIR Operations
Based on the Capability Statement, the following supported operations will be used:

1. **GET /Condition/{id}** - Retrieve specific Condition resources for testing
2. **GET /Condition?patient={patient_id}** - Search for Condition resources by patient (supported search parameter per Capability Statement)
3. **GET /Condition?patient={patient_id}&clinical-status={status}** - Search with clinical-status filter (supported combined search per Capability Statement)

### Validation Criteria

**Primary Assertions:**
1. **Mapping Validation**: For each Condition resource, verify that `verificationStatus` maps correctly to `Event.status` according to the following FHIR Workflow Pattern mappings:
   - `unconfirmed` → `preparation` 
   - `provisional` → `in-progress`
   - `differential` → `in-progress`
   - `confirmed` → `completed`
   - `refuted` → `not-done`
   - `entered-in-error` → `entered-in-error`

2. **Profile Conformance**: Verify that all tested Condition resources conform to the US Core Condition Problems and Health Concerns Profile

3. **Value Set Compliance**: Confirm that all `verificationStatus` values are from the required ConditionVerificationStatus value set

**Test Cases:**
- **TC-400-001**: Retrieve Condition resources and validate verificationStatus mapping
  - Given: Condition resources with various verificationStatus values
  - When: Resources are retrieved via supported REST operations
  - Then: Each verificationStatus value maps correctly to the expected Event.status value

- **TC-400-002**: Search-based validation of verificationStatus mapping
  - Given: Patient with multiple Condition resources
  - When: Searching for Conditions using supported search parameters
  - Then: All returned Conditions have correct verificationStatus to Event.status mappings

**Pass Criteria:**
- All Condition resources demonstrate correct verificationStatus to Event.status mapping
- No invalid or unmapped verificationStatus values are present
- All resources conform to the US Core Condition Problems and Health Concerns Profile

**Fail Criteria:**
- Any Condition resource contains verificationStatus values that do not map correctly to Event.status
- Resources fail to conform to the required US Core profile
- Invalid verificationStatus values are present that are not in the required value set

---

<a id='req-401'></a>

### REQ-401: The Condition resource SHALL map code to Event.code.

**Text**: 

**Context**: FHIR Workflow Pattern mapping for the USCoreConditionProblemsHealthConcernsProfile.

**Actor**: Implementer of the USCoreConditionProblemsHealthConcernsProfile

**Conformance**: SHALL

# Test Specification for REQ-401

## 1. Requirement ID
REQ-401

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be validated programmatically by examining the structure and content of Condition resources that conform to the USCoreConditionProblemsHealthConcernsProfile and verifying that the `code` element is properly mapped according to FHIR Workflow Pattern specifications.

### Complexity
**Simple** - The requirement involves a straightforward structural validation of a single element mapping within a FHIR resource profile.

### Prerequisites
- Server implementing US Core Condition Problems and Health Concerns Profile
- Test system capable of FHIR REST API interactions
- Access to Condition resources with populated code elements
- Understanding of FHIR Workflow Pattern Event.code mapping requirements

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- One or more Condition resources conforming to `us-core-condition-problems-health-concerns` profile
- Resources must contain populated `Condition.code` elements with valid coding values

**Expected Outputs:**
- Validation confirmation that `Condition.code` properly maps to `Event.code` as per Workflow Pattern
- Verification that code elements contain appropriate CodeableConcept structures
- Confirmation of proper terminology bindings and value constraints

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for Condition resources:

1. **GET /Condition/[id]** - Retrieve specific Condition resources for validation
2. **GET /Condition?patient=[patient-id]** - Search for Condition resources by patient
3. **GET /Condition?code=[code]** - Search for Condition resources by code (if testing specific code mappings)
4. **GET /Condition?patient=[patient-id]&code=[code]** - Combined search parameters

### Validation Criteria

**Primary Assertions:**
1. **Code Element Presence**: Verify that `Condition.code` element is present and populated in resources conforming to the US Core Condition Problems and Health Concerns Profile
2. **Code Structure Validation**: Confirm that `Condition.code` follows CodeableConcept structure with appropriate:
   - `coding` array with at least one Coding element
   - `system` and `code` values in each Coding
   - Optional `display` and `text` elements
3. **Workflow Pattern Compliance**: Validate that the `Condition.code` element can serve as the Event.code mapping by ensuring:
   - Code represents the condition/problem/health concern appropriately
   - Terminology binding aligns with US Core requirements
   - Code specificity is sufficient for workflow event identification

**Secondary Assertions:**
1. **Profile Conformance**: Verify resources declare conformance to `http://hl7.org/fhir/us/core/StructureDefinition/us-core-condition-problems-health-concerns` in `meta.profile`
2. **Must Support Compliance**: Ensure all Must Support elements required by the profile are present when data is available
3. **Terminology Validation**: Confirm codes use appropriate value sets as defined in the US Core profile

**Test Execution Steps:**
1. Retrieve Condition resources using supported search parameters
2. For each resource, validate profile conformance
3. Extract and examine `Condition.code` element
4. Verify code structure and content meet Workflow Pattern Event.code requirements
5. Confirm terminology bindings and constraints are satisfied
6. Document any non-conformant resources or mappings

**Pass Criteria:**
- All retrieved Condition resources contain properly structured `code` elements
- Code elements satisfy Event.code mapping requirements for Workflow Pattern
- No validation errors related to code structure or terminology constraints
- Resources successfully demonstrate the SHALL requirement for code mapping

**Fail Criteria:**
- Any Condition resource lacks the required `code` element
- Code elements fail to meet CodeableConcept structural requirements
- Terminology bindings do not align with US Core specifications
- Resources cannot satisfy Event.code mapping requirements as specified in Workflow Pattern

---

<a id='req-402'></a>

### REQ-402: The Condition resource SHALL map subject to Event.subject.

**Text**: 

**Context**: FHIR Workflow Pattern mapping for the USCoreConditionProblemsHealthConcernsProfile.

**Actor**: Implementer of the USCoreConditionProblemsHealthConcernsProfile

**Conformance**: SHALL

# Test Specification for REQ-402

## Requirement ID
REQ-402

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement involves validating that the Condition resource's `subject` field is properly mapped to the Event pattern's `subject` field, which can be verified through structural analysis of the FHIR resource instance.

### Complexity
**Simple** - The test involves a straightforward field-to-field mapping verification within a single resource type.

### Prerequisites
- System must support the US Core Condition Problems and Health Concerns Profile
- System must be able to create/retrieve Condition resources conforming to the USCoreConditionProblemsHealthConcernsProfile
- Test data must include valid Patient resources that can be referenced by Condition resources

## Test Implementation Strategy

### Required Inputs
- **FHIR Resources Required:**
  - At least one Condition resource conforming to USCoreConditionProblemsHealthConcernsProfile
  - At least one Patient resource that serves as the subject of the Condition
- **Expected Outputs:**
  - Condition resource instances with properly populated `subject` field
  - Validation confirmation that `subject` field contains a valid reference to a Patient resource

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and will be used:

1. **GET /Condition/{id}** - Retrieve specific Condition resource instances
2. **GET /Condition?patient={patient-id}** - Search for Condition resources by patient (supported search parameter)
3. **GET /Patient/{id}** - Retrieve Patient resources to validate subject references

### Validation Criteria

The test SHALL verify the following assertions to indicate passing:

1. **Subject Field Presence**
   - The Condition resource SHALL contain a `subject` field
   - The `subject` field SHALL NOT be null or empty

2. **Subject Reference Validation**
   - The `subject` field SHALL contain a valid FHIR Reference
   - The reference SHALL point to a Patient resource (reference type validation)
   - The reference SHALL use either:
     - A relative reference format (e.g., "Patient/123")
     - An absolute URL format pointing to a Patient resource
     - A logical reference with identifier

3. **Reference Resolution**
   - If the reference is resolvable within the test system, the referenced Patient resource SHALL exist
   - The referenced Patient resource SHALL be accessible via the supported Patient operations

4. **Profile Conformance**
   - The Condition resource SHALL declare conformance to USCoreConditionProblemsHealthConcernsProfile in its meta.profile
   - The resource SHALL validate against the USCoreConditionProblemsHealthConcernsProfile structure definition

### Test Cases

#### Test Case 1: Basic Subject Mapping Validation
- **Action**: Retrieve Condition resources from the system
- **Validation**: Verify each Condition has a properly formatted `subject` field referencing a Patient

#### Test Case 2: Subject Reference Resolution
- **Action**: For each Condition resource, attempt to resolve the Patient reference in the `subject` field
- **Validation**: Confirm the referenced Patient resource exists and is accessible

#### Test Case 3: Search-Based Validation
- **Action**: Use patient-based Condition searches to verify subject relationships
- **Validation**: Ensure Conditions returned by `GET /Condition?patient={id}` have `subject` fields pointing to the correct Patient resource

### Success Criteria
A system passes this test when:
- All Condition resources conforming to USCoreConditionProblemsHealthConcernsProfile contain a valid `subject` field
- All `subject` references point to valid, accessible Patient resources
- The mapping between Condition.subject and Event.subject is correctly implemented as per FHIR Workflow Pattern requirements

### Failure Scenarios
The test fails if:
- Any Condition resource lacks a `subject` field
- Any `subject` field contains an invalid or malformed reference
- Any `subject` reference points to a non-existent or inaccessible Patient resource
- The resource does not conform to the required profile constraints

---

<a id='req-403'></a>

### REQ-403: The Condition resource SHALL map encounter to Event.context.

**Text**: 

**Context**: FHIR Workflow Pattern mapping for the USCoreConditionProblemsHealthConcernsProfile.

**Actor**: Implementer of the USCoreConditionProblemsHealthConcernsProfile

**Conformance**: SHALL

# Test Specification for REQ-403

## Requirement ID
**REQ-403**

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated inspection of Condition resources that implement the US Core Condition Problems Health Concerns Profile to ensure the encounter field properly maps to Event.context according to the FHIR Workflow Pattern.

### Complexity
**Simple** - The test involves checking a single mapping relationship between two clearly defined fields in a FHIR resource.

### Prerequisites
- FHIR server implementing US Core Condition Problems Health Concerns Profile
- Test data containing Condition resources with encounter references
- Access to retrieve Condition resources via FHIR API
- Test data should include both Condition resources with and without encounter references to verify proper handling

## Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Condition resources conforming to US Core Condition Problems Health Concerns Profile
- Referenced Encounter resources (when encounter field is populated)

**Expected Outputs:**
- Condition resources where encounter field properly represents Event.context mapping
- Proper FHIR resource structure validation
- Appropriate handling of cases where encounter is not present

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required for testing:

1. **GET [base]/Condition/[id]** - Retrieve individual Condition resources
2. **GET [base]/Condition?patient=[patient-id]&category=[category-code]** - Search for Condition resources by patient and category (SHALL support)
3. **GET [base]/Condition?[parameter=value]&_revinclude=Provenance:target** - Include provenance information if available

### Validation Criteria

#### Primary Validation Checks:
1. **Encounter Mapping Verification:**
   - When `Condition.encounter` is present, verify it contains a valid reference to an Encounter resource
   - Confirm the encounter reference follows FHIR reference format (Reference(Encounter))
   - Validate that the encounter reference represents the Event.context as per FHIR Workflow Pattern mapping

2. **Profile Conformance:**
   - Verify each Condition resource declares conformance to US Core Condition Problems Health Concerns Profile
   - Validate the resource passes FHIR structure definition validation for the specified profile

3. **Reference Integrity:**
   - If encounter reference is provided, attempt to resolve the referenced Encounter resource
   - Verify the referenced Encounter resource exists and is accessible
   - Confirm the Encounter resource conforms to US Core Encounter Profile when retrieved

#### Secondary Validation Checks:
1. **Category Validation:**
   - Verify Condition.category includes appropriate values for problems and health concerns
   - Confirm category coding aligns with US Core value sets

2. **Workflow Pattern Compliance:**
   - Validate that the encounter context relationship follows FHIR Workflow Pattern specifications
   - Ensure the mapping maintains semantic consistency between Condition and Encounter

#### Test Assertions for Passing Results:
- **PASS:** All Condition resources with encounter field populated contain valid Encounter references
- **PASS:** Referenced Encounter resources are successfully retrievable and valid
- **PASS:** Encounter mapping properly represents Event.context relationship
- **PASS:** No validation errors against US Core Condition Problems Health Concerns Profile
- **FAIL:** Any encounter reference is malformed, unresolvable, or missing when expected
- **FAIL:** Condition resources fail profile validation
- **FAIL:** Encounter mapping does not align with FHIR Workflow Pattern requirements

#### Edge Case Handling:
- Condition resources without encounter references should still pass (encounter is not always required)
- Verify proper error handling for invalid encounter references
- Test behavior with contained vs. external Encounter resources

---

<a id='req-404'></a>

### REQ-404: The Condition resource SHALL map onset[x] to Event.occurrence[x].

**Text**: 

**Context**: FHIR Workflow Pattern mapping for the USCoreConditionProblemsHealthConcernsProfile.

**Actor**: Implementer of the USCoreConditionProblemsHealthConcernsProfile

**Conformance**: SHALL

# Test Specification for REQ-404

## Requirement ID
REQ-404

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated through automated inspection of FHIR Condition resources to verify that the onset[x] element properly maps to Event.occurrence[x] in the FHIR Workflow Pattern context.

### Complexity
**Simple** - This is a straightforward structural mapping validation that requires checking the presence and proper use of the onset[x] element in Condition resources.

### Prerequisites
- FHIR server implementing US Core Condition Problems and Health Concerns Profile
- Access to Condition resources with onset information
- Understanding of FHIR Workflow Pattern Event.occurrence[x] mapping requirements
- Server must support Condition resource read operations per capability statement

## Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Condition resources conforming to US Core Condition Problems and Health Concerns Profile
- **Data Requirements**: Condition resources that contain onset information (onsetDateTime, onsetAge, onsetPeriod, onsetRange, or onsetString)
- **System Access**: Ability to retrieve Condition resources via FHIR API

### Required FHIR Operations
Based on the capability statement, the following operations are supported and required:

1. **GET [base]/Condition/[id]** - Read specific Condition resources
2. **GET [base]/Condition?patient=[patient-id]** - Search for Condition resources by patient
3. **GET [base]/Condition?patient=[patient-id]&category=[category]** - Search with category filter to focus on problems and health concerns

### Validation Criteria

#### Test Case 1: Verify onset[x] Element Presence and Mapping
**Objective**: Confirm that Condition resources implementing the US Core Condition Problems and Health Concerns Profile properly include onset[x] elements that map to Event.occurrence[x]

**Test Steps**:
1. Retrieve Condition resources using supported search parameters from capability statement
2. Filter for resources conforming to US Core Condition Problems and Health Concerns Profile
3. For each Condition resource, verify onset[x] element handling

**Assertions**:
- **PASS**: When onset information is present, it SHALL be represented using one of the valid onset[x] choices:
  - `onsetDateTime` - specific date/time when condition began
  - `onsetAge` - age when condition began  
  - `onsetPeriod` - period during which condition began
  - `onsetRange` - range of dates/ages when condition began
  - `onsetString` - textual description of onset timing

- **PASS**: The onset[x] element properly represents the Event.occurrence[x] concept from FHIR Workflow Pattern (timing/occurrence of the condition event)

- **PASS**: Only one onset[x] variant is populated per Condition resource (mutually exclusive choices)

- **FAIL**: If onset information exists but is not properly mapped to the onset[x] element structure

#### Test Case 2: Workflow Pattern Compliance Verification
**Objective**: Validate that the onset[x] mapping aligns with FHIR Workflow Pattern Event.occurrence[x] requirements

**Test Steps**:
1. Examine Condition resources with onset[x] populated
2. Verify the semantic alignment with Event.occurrence[x] pattern

**Assertions**:
- **PASS**: onset[x] represents when the condition/problem occurred or was first identified (aligning with Event.occurrence[x] semantics)
- **PASS**: The data type used for onset[x] appropriately represents the temporal aspect of the condition's occurrence
- **FAIL**: onset[x] contains data that doesn't represent occurrence timing information

#### Test Case 3: Profile Conformance Integration
**Objective**: Ensure onset[x] mapping works within the broader US Core Condition Problems and Health Concerns Profile context

**Test Steps**:
1. Retrieve Condition resources using patient+category search combinations supported per capability statement
2. Focus on category values indicating "problem-list-item" 
3. Validate onset[x] usage in context of other profile requirements

**Assertions**:
- **PASS**: Condition resources with problem-list-item category properly utilize onset[x] for Event.occurrence[x] mapping
- **PASS**: onset[x] data is consistent with other temporal elements in the resource (e.g., recordedDate, assertedDate extension)
- **FAIL**: Missing or improperly structured onset[x] elements in Condition resources that should contain occurrence timing information

### Expected Test Outcomes
- **Success**: All Condition resources conforming to US Core Condition Problems and Health Concerns Profile properly implement the onset[x] to Event.occurrence[x] mapping
- **Failure Scenarios**:
  - onset[x] element missing when occurrence timing information should be present
  - Multiple onset[x] variants populated simultaneously
  - onset[x] containing data that doesn't represent occurrence timing
  - Improper data type usage for onset[x] elements

---

<a id='req-405'></a>

### REQ-405: The Condition resource SHALL map evidence code to Event.reasonCode.

**Text**: 

**Context**: FHIR Workflow Pattern mapping for the USCoreConditionProblemsHealthConcernsProfile.

**Actor**: Implementer of the USCoreConditionProblemsHealthConcernsProfile

**Conformance**: SHALL

# Test Specification for REQ-405

## Requirement ID
REQ-405

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated testing by examining the structure and content of Condition resources to ensure evidence codes are properly mapped to Event.reasonCode according to the FHIR Workflow Pattern.

### Complexity
**Simple** - The requirement involves verifying a straightforward mapping between two specific FHIR elements within the same resource type.

### Prerequisites
- System must support US Core Condition Problems and Health Concerns Profile
- System must have Condition resources available for testing
- System must support read operations for Condition resources
- Test data should include Condition resources with evidence codes populated

## Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Condition resources conforming to US Core Condition Problems and Health Concerns Profile
- **Test Data Requirements**: 
  - At least one Condition resource with evidence code populated
  - Condition resources should represent real clinical scenarios where evidence codes would be present
  - Resources should be valid according to the US Core profile

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required for testing:

1. **GET [base]/Condition/[id]** - Read individual Condition resources
2. **GET [base]/Condition?patient=[patient-id]** - Search for patient's conditions
3. **GET [base]/Condition?patient=[patient-id]&category=[category]** - Search with category filter (SHALL support)

### Validation Criteria

#### Primary Validation
1. **Evidence Code Presence Check**:
   - Identify Condition resources that contain evidence codes
   - Verify that evidence codes are populated in the expected location according to FHIR Workflow Pattern mapping

2. **Event.reasonCode Mapping Validation**:
   - For each Condition resource with evidence codes, verify that these codes are properly mapped to Event.reasonCode
   - Confirm that the mapping follows the FHIR Workflow Pattern specifications
   - Ensure code values, systems, and displays are correctly transferred

3. **Profile Conformance**:
   - Validate that all Condition resources conform to the US Core Condition Problems and Health Concerns Profile
   - Verify that the mapping does not violate any profile constraints or requirements

#### Test Assertions
**PASS Criteria**:
- All Condition resources with evidence codes have those codes properly mapped to Event.reasonCode
- The mapping preserves code semantics (system, code, display)
- No profile validation errors are introduced by the mapping
- The implementation follows FHIR Workflow Pattern specifications

**FAIL Criteria**:
- Evidence codes are present but not mapped to Event.reasonCode
- Evidence codes are mapped incorrectly (wrong field, corrupted values)
- The mapping violates US Core profile constraints
- The mapping does not follow FHIR Workflow Pattern requirements

#### Additional Validation Steps
1. **Data Consistency Check**:
   - Verify that evidence codes maintain their original semantic meaning after mapping
   - Ensure no data loss occurs during the mapping process

2. **Multiple Evidence Codes Handling**:
   - If multiple evidence codes exist, verify all are properly mapped
   - Ensure the cardinality constraints are respected

3. **Edge Case Validation**:
   - Test with Condition resources that have no evidence codes (should not fail)
   - Verify handling of invalid or malformed evidence codes
   - Test with various code systems and formats

#### Test Execution Flow
1. Retrieve Condition resources using supported search operations
2. Filter for resources that should contain evidence codes based on clinical context
3. For each relevant Condition resource:
   - Extract evidence codes from source location
   - Verify presence and correct mapping to Event.reasonCode
   - Validate semantic consistency
4. Aggregate results and determine overall conformance status

**Note**: This test should be executed using the "bring your own data" approach, working with whatever Condition resources are available in the test system, rather than requiring specific pre-configured test fixtures.

---

<a id='req-406'></a>

### REQ-406: The Condition resource SHALL map note to Event.note.

**Text**: 

**Context**: FHIR Workflow Pattern mapping for the USCoreConditionProblemsHealthConcernsProfile.

**Actor**: Implementer of the USCoreConditionProblemsHealthConcernsProfile

**Conformance**: SHALL

# Test Specification for REQ-406

## 1. Requirement ID
REQ-406

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated testing by examining the structure and mapping of FHIR Condition resources to ensure the `note` field is properly mapped to `Event.note` according to the FHIR Workflow Pattern.

### Complexity
**Simple** - This is a straightforward structural mapping requirement that involves verifying the presence and correct mapping of a single field between two patterns.

### Prerequisites
- System must support the US Core Condition Problems and Health Concerns Profile
- System must implement FHIR R4 or later
- Test data must include Condition resources with populated `note` elements
- System must support RESTful FHIR operations for Condition resources

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Condition resources conforming to the US Core Condition Problems and Health Concerns Profile that contain populated `note` elements
- **Test Data Requirements**: 
  - At least one Condition resource with a single note
  - At least one Condition resource with multiple notes
  - Condition resources should represent problems and health concerns as defined in the profile

### Expected Outputs
- Condition resources that properly expose the `note` field according to FHIR Workflow Pattern Event.note mapping
- Validation that the note content is accessible and properly structured

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for Condition resources:

- **GET** `/Condition/{id}` - Retrieve specific Condition resources
- **GET** `/Condition?patient={patient-id}` - Search for Condition resources by patient
- **GET** `/Condition?patient={patient-id}&category={category}` - Search with category filter

### Validation Criteria

#### Test Case 1: Single Note Mapping Verification
**Objective**: Verify that a Condition resource with one note properly maps to Event.note

**Test Steps**:
1. Retrieve a Condition resource that contains a populated `note` element
2. Verify the `note` field is present and accessible
3. Validate that the note structure conforms to the Annotation datatype
4. Confirm the note content is properly mapped according to Workflow Pattern Event.note specification

**Pass Criteria**:
- Condition.note field is present when expected
- Note content is accessible via standard FHIR resource access patterns
- Note structure follows FHIR Annotation datatype requirements
- Mapping aligns with FHIR Workflow Pattern Event.note definition

#### Test Case 2: Multiple Notes Mapping Verification
**Objective**: Verify that a Condition resource with multiple notes properly maps all notes to Event.note

**Test Steps**:
1. Retrieve a Condition resource that contains multiple populated `note` elements
2. Verify all `note` elements are present and accessible
3. Validate that each note maintains its individual structure and content
4. Confirm the collection of notes properly represents the Event.note mapping

**Pass Criteria**:
- All Condition.note elements are present and accessible
- Each note maintains proper Annotation datatype structure
- Multiple notes are handled correctly in the Event.note mapping
- No note content is lost or corrupted in the mapping

#### Test Case 3: Profile Conformance Validation
**Objective**: Ensure the note mapping works within the context of the US Core Condition Problems and Health Concerns Profile

**Test Steps**:
1. Retrieve Condition resources using profile-specific searches (e.g., by category for problems/health concerns)
2. Verify that retrieved resources conform to the US Core Condition Problems and Health Concerns Profile
3. Validate note mapping for resources that specifically represent problems and health concerns
4. Confirm the mapping works consistently across different condition categories

**Pass Criteria**:
- Resources conform to US Core Condition Problems and Health Concerns Profile
- Note mapping works consistently for both problem and health concern categories
- Profile-specific constraints don't interfere with note mapping
- Event.note mapping remains functional within profile context

#### Test Case 4: Missing Note Handling
**Objective**: Verify proper behavior when notes are not present

**Test Steps**:
1. Retrieve Condition resources that do not contain `note` elements
2. Verify that the absence of notes is handled appropriately
3. Confirm that missing notes don't cause errors in the Event.note mapping

**Pass Criteria**:
- Resources without notes don't cause mapping errors
- System properly handles optional nature of the note field
- Event.note mapping gracefully handles missing data

### Additional Validation Points
- Verify that the note mapping preserves all required elements of the Annotation datatype (author, time, text)
- Ensure that note content encoding and character sets are properly maintained
- Confirm that note references (if present) are properly resolved in the mapping context
- Validate that the mapping maintains referential integrity with related resources

---

<a id='req-454'></a>

### REQ-454: US Core Condition Encounter Diagnosis Profile implementation

**Text**: 

**Context**: System conformance to US Core Condition Encounter Diagnosis Profile.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-454

## Requirement ID
REQ-454

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated FHIR resource validation and API interaction testing.

### Complexity
**Moderate** - The test involves validating profile conformance, search parameters, and ensuring proper resource structure according to the US Core Condition Encounter Diagnosis Profile.

### Prerequisites
- System must implement US Core Server CapabilityStatement
- System must support the Condition resource type
- System must have test data containing Condition resources with category "encounter-diagnosis"
- System must support required search parameters and interactions as defined in the CapabilityStatement

## Test Implementation Strategy

### Required Inputs
- **Test System**: A FHIR server implementing US Core Server CapabilityStatement
- **Test Data**: Existing Condition resources in the system that represent encounter diagnoses
- **Patient Context**: Valid patient IDs for searching Condition resources

### Required FHIR Operations
Based on the CapabilityStatement, the following operations must be supported:

1. **Read Operation**:
   - `GET [base]/Condition/[id]`

2. **Search Operations**:
   - `GET [base]/Condition?patient=[patient-id]` (SHALL support)
   - `GET [base]/Condition?patient=[patient-id]&category=encounter-diagnosis` (SHALL support)
   - `GET [base]/Condition?patient=[patient-id]&category=[category]&encounter=[encounter-id]` (SHOULD support)

3. **Include Operations**:
   - `GET [base]/Condition?[parameter]&_revinclude=Provenance:target` (SHALL support)

### Validation Criteria

#### 1. Profile Conformance Validation
**Test**: Validate that returned Condition resources conform to US Core Condition Encounter Diagnosis Profile
- **Assertion**: All Condition resources with `category` containing "encounter-diagnosis" must validate against the US Core Condition Encounter Diagnosis Profile (http://hl7.org/fhir/us/core/StructureDefinition/us-core-condition-encounter-diagnosis)
- **Expected Result**: FHIR validator returns no errors for profile conformance

#### 2. Required Search Parameter Support
**Test**: Verify system supports mandatory search parameters
- **Assertion**: System successfully responds to searches using required parameters:
  - `patient` parameter (SHALL support)
  - `patient` + `category` parameter combination (SHALL support)
- **Expected Result**: HTTP 200 response with valid Bundle containing matching resources

#### 3. Resource Structure Validation
**Test**: Validate encounter diagnosis specific requirements
- **Assertion**: When `Condition.category` contains "encounter-diagnosis":
  - The `Condition.encounter` element SHOULD be present and reference a valid Encounter
  - Required elements per the profile are populated
- **Expected Result**: Resources meet structural requirements as defined in the profile

#### 4. Search Parameter Precision Requirements
**Test**: Validate search parameter implementation meets specification requirements
- **Assertion**: For token-type parameters (category, clinical-status):
  - System supports searches with code-only values
  - System supports searches with system+code values
- **Assertion**: For reference-type parameters (patient, encounter):
  - System supports searches with id-only values
  - System supports searches with Type+id values
- **Expected Result**: All supported search formats return appropriate results

#### 5. Interaction Support Validation
**Test**: Verify required FHIR interactions are supported
- **Assertion**: System supports:
  - `search-type` operation (SHALL)
  - `read` operation (SHALL)
  - `_revinclude=Provenance:target` (SHALL)
- **Expected Result**: Operations complete successfully with appropriate HTTP status codes

#### 6. Category-Specific Business Logic
**Test**: Validate encounter diagnosis category handling
- **Assertion**: Resources with `category` containing "encounter-diagnosis" are properly identified and returned when searching with `category=encounter-diagnosis`
- **Expected Result**: Search returns only Condition resources with appropriate category values

#### 7. Data Completeness Assessment
**Test**: Verify must-support elements are populated when data is available
- **Assertion**: For encounter diagnosis Conditions, must-support elements defined in the profile are present when the data exists in the source system
- **Expected Result**: Resources contain expected must-support elements based on available data

### Pass/Fail Criteria

**Test PASSES if**:
- All Condition resources validate against the US Core Condition Encounter Diagnosis Profile
- Required search parameters function correctly
- All mandatory interactions (read, search-type) are supported
- Search parameter precision requirements are met
- Business logic correctly identifies and handles encounter diagnosis conditions

**Test FAILS if**:
- Any Condition resource fails profile validation
- Required search parameters are not supported or return errors
- Mandatory interactions are not supported
- Search results are incomplete or incorrect
- System does not properly handle encounter diagnosis category requirements

---

<a id='req-455'></a>

### REQ-455: US Core Condition Problems and Health Concerns Profile implementation

**Text**: 

**Context**: System conformance to US Core Condition Problems and Health Concerns Profile.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-455

## 1. Requirement ID
**REQ-455**: US Core Condition Problems and Health Concerns Profile implementation

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be systematically tested by validating that Condition resources returned by the system conform to the US Core Condition Problems and Health Concerns Profile structure and constraints.

### Complexity
**Moderate** - Testing requires profile validation, search parameter verification, and conformance to specific US Core requirements, but follows standard FHIR testing patterns.

### Prerequisites
- System must implement US Core Server capabilities as defined in the CapabilityStatement
- System must have Condition resources available for testing
- System must support RESTful FHIR operations for Condition resources
- Access to a FHIR validator that includes US Core profiles
- Test client capable of making FHIR API calls and validating responses

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Condition resources that represent problems and health concerns
- Patient resources that are referenced by the Condition resources
- Any additional resources referenced by Condition resources (e.g., Encounter, Practitioner)

**Expected Outputs:**
- Valid HTTP responses with appropriate status codes
- Condition resources that conform to the US Core Condition Problems and Health Concerns Profile
- Proper FHIR Bundle structures for search operations
- Appropriate error responses for invalid requests

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations must be supported and tested:

1. **READ Operation**: `GET [base]/Condition/[id]`
2. **SEARCH Operations**:
   - `GET [base]/Condition?patient=[reference]`
   - `GET [base]/Condition?patient=[reference]&category=[code]`
   - `GET [base]/Condition?patient=[reference]&clinical-status=[code]`
   - `GET [base]/Condition?patient=[reference]&onset-date=[date]`
   - `GET [base]/Condition?patient=[reference]&code=[code]`

### Validation Criteria

#### Profile Conformance Validation
1. **Profile Declaration**: Each returned Condition resource SHALL declare conformance to the US Core Condition Problems and Health Concerns Profile (`http://hl7.org/fhir/us/core/StructureDefinition/us-core-condition-problems-health-concerns`)

2. **Required Elements**: Validate presence of all required elements:
   - `clinicalStatus` (required)
   - `verificationStatus` (required when clinicalStatus is not entered-in-error)
   - `category` (required, must include at least one code from the required value sets)
   - `code` (required)
   - `subject` (required, must reference a Patient)

3. **Data Type Compliance**: Verify all elements use correct FHIR data types as specified in the profile

4. **Terminology Binding**: Validate terminology bindings:
   - `category` codes from required value sets (problem-list-item, health-concern)
   - `clinicalStatus` from ConditionClinicalStatusCodes value set
   - `verificationStatus` from ConditionVerificationStatus value set
   - `code` should use appropriate clinical terminology (SNOMED CT, ICD-10-CM)

#### API Operation Validation
1. **READ Operation**:
   - Returns HTTP 200 for existing resources
   - Returns HTTP 404 for non-existent resources
   - Response contains valid Condition resource conforming to the profile

2. **SEARCH Operations**:
   - Returns HTTP 200 with Bundle response
   - Bundle.type = "searchset"
   - All returned Condition resources conform to the profile
   - Search parameters function correctly:
     - Patient parameter filters correctly by patient reference
     - Category parameter filters by condition category
     - Clinical-status parameter filters by clinical status
     - Other search parameters work as specified

#### Content Validation
1. **Reference Integrity**: 
   - `subject` references must resolve to valid Patient resources
   - Other references (if present) must be valid FHIR references

2. **Business Logic Validation**:
   - `verificationStatus` is present when `clinicalStatus` is not "entered-in-error"
   - Date/time values are properly formatted and logical
   - Category codes appropriately classify the condition as a problem or health concern

#### Error Handling Validation
1. **Invalid Requests**: System properly handles and returns appropriate HTTP status codes for:
   - Invalid resource IDs (404)
   - Invalid search parameters (400)
   - Malformed requests (400)

2. **Error Response Format**: Error responses follow FHIR OperationOutcome structure

#### Conformance Statement Alignment
1. **Supported Operations**: Verify all operations declared in the CapabilityStatement for Condition resources are functional
2. **Search Parameters**: All declared search parameters work as documented
3. **Profile Support**: System correctly implements the US Core Condition Problems and Health Concerns Profile as declared

### Test Execution Approach
1. **Discovery Phase**: Query the system's CapabilityStatement to verify Condition resource support
2. **Data Retrieval**: Use available patient data to search for existing Condition resources
3. **Profile Validation**: Validate each retrieved Condition resource against the US Core profile
4. **Operation Testing**: Test all supported FHIR operations for Condition resources
5. **Edge Case Testing**: Test boundary conditions and error scenarios with available data
6. **Compliance Verification**: Ensure all responses meet US Core requirements and USCDI data element requirements

---



<a id='coverage'></a>

## Coverage

<a id='req-013'></a>

### REQ-013: Coverage SHALL specify a payor.

**Text**: 

**Context**: 

**Actor**: Coverage

**Conformance**: SHALL

# Test Specification for REQ-013

## 1. Requirement ID
REQ-013

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified programmatically by examining Coverage resources to ensure the payor element is present and populated.

### Complexity
**Simple** - The requirement involves a straightforward validation of a single mandatory field in the Coverage resource.

### Prerequisites
- System must support the US Core Coverage Profile
- Coverage resources must be available for testing
- System must support FHIR R4 JSON format (minimum requirement per Capability Statement)
- System must implement RESTful FHIR API capabilities for Coverage resource access

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Coverage resources conforming to the US Core Coverage Profile
- **Test Data**: Any Coverage instances present in the system under test (supporting "bring your own data" approach)
- **System Configuration**: FHIR server endpoint with Coverage resource support

### Expected Outputs
- Coverage resources with populated payor elements
- Validation results confirming payor presence and proper structure
- HTTP response codes indicating successful resource retrieval

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for Coverage:

1. **Search Operations**:
   - `GET [base]/Coverage?patient=[id]` - Search Coverage by patient
   
2. **Read Operations**:
   - `GET [base]/Coverage/[id]` - Read specific Coverage resource

3. **Additional Supported Features**:
   - JSON format support (required)
   - XML format support (should)
   - Provenance:target reverse includes

### Validation Criteria

#### Primary Validation Checks:
1. **Payor Existence Check**:
   - Verify that each Coverage resource contains a `payor` element
   - Confirm the payor element is not null or empty
   - Validate that the payor element contains at least one entry

2. **Payor Structure Validation**:
   - Verify payor element follows FHIR Reference structure
   - Confirm payor reference includes either:
     - A valid resource reference (reference field)
     - An identifier (identifier field)
     - A display name (display field)

3. **US Core Coverage Profile Conformance**:
   - Validate Coverage resource declares conformance to US Core Coverage Profile in meta.profile
   - Confirm resource passes FHIR validation against the US Core Coverage Profile

#### Test Cases:

**Test Case 1: Coverage Resource Payor Validation**
- **Action**: Retrieve Coverage resources using supported search parameters
- **Assertion**: Each returned Coverage resource SHALL contain a populated payor element
- **Pass Criteria**: All Coverage resources have non-empty payor arrays with valid references

**Test Case 2: Search-Based Validation**
- **Action**: Execute `GET [base]/Coverage?patient=[patient-id]` for available patients
- **Assertion**: All returned Coverage resources contain payor information
- **Pass Criteria**: No Coverage resources are returned without payor elements

**Test Case 3: Individual Resource Validation**
- **Action**: Retrieve individual Coverage resources by ID using `GET [base]/Coverage/[id]`
- **Assertion**: Each Coverage resource contains properly structured payor element
- **Pass Criteria**: Payor element exists and contains valid FHIR Reference structure

#### Error Conditions to Verify:
- Coverage resources missing payor elements should be identified as non-conformant
- Empty payor arrays should be flagged as violations
- Invalid payor reference structures should be detected

#### Success Indicators:
- All Coverage resources contain populated payor elements
- Payor references follow proper FHIR Reference formatting
- Resources validate against US Core Coverage Profile requirements
- System returns appropriate HTTP status codes (200 for successful reads, 404 for missing resources)

---

<a id='req-016'></a>

### REQ-016: Coverage SHALL have a status of 'Active'.

**Text**: 

**Context**: 

**Actor**: Coverage

**Conformance**: SHALL

# Test Specification for REQ-016

## 1. Requirement ID
REQ-016

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be fully automated through programmatic validation of the Coverage resource's status field.

### Complexity
**Simple** - The test involves a straightforward validation of a single field value against a specific enumerated value.

### Prerequisites
- A FHIR server implementing US Core Coverage Profile
- Access to Coverage resources via FHIR API
- Coverage resources must exist in the system being tested

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Coverage resources conforming to the US Core Coverage Profile
- **Test Data**: Any existing Coverage resources in the test system (following "bring your own data" approach)
- **System Access**: FHIR server endpoint with Coverage resource support as defined in the capability statement

### Required FHIR Operations
Based on the capability statement, the following operations are supported for Coverage resources:
- **GET /Coverage?patient={patient-id}** - Search for Coverage resources by patient
- **GET /Coverage/{id}** - Read specific Coverage resource by ID

### Validation Criteria

#### Test Case 1: Validate Coverage Status via Patient Search
1. **Action**: Execute search operation `GET /Coverage?patient={patient-id}` for patients with Coverage resources
2. **Assertion**: For each Coverage resource returned:
   - Verify that the `status` field exists
   - Verify that the `status` field value equals "active" (case-insensitive)
   - Verify that no Coverage resources have status values other than "active"

#### Test Case 2: Validate Coverage Status via Direct Resource Read
1. **Action**: For each known Coverage resource ID, execute `GET /Coverage/{id}`
2. **Assertion**: For each Coverage resource retrieved:
   - Verify that the `status` field exists and is populated
   - Verify that the `status` field value equals "active"

#### Test Case 3: Validate All Coverage Resources in System
1. **Action**: If supported by the server, execute `GET /Coverage` to retrieve all Coverage resources
2. **Assertion**: For each Coverage resource in the response:
   - Verify that the `status` field value is "active"
   - Document any Coverage resources that do not meet this requirement

### Expected Test Results
- **Pass Criteria**: All Coverage resources accessed through any supported FHIR operation have a status value of "active"
- **Fail Criteria**: Any Coverage resource is found with a status value other than "active" or missing status field
- **Error Handling**: If no Coverage resources are found in the system, the test should report "No Coverage resources available for testing" rather than failing

### Test Reporting
- Count of Coverage resources tested
- List of any non-conformant resources with their IDs and actual status values
- Summary of conformance: "X out of Y Coverage resources have required 'active' status"

---

<a id='req-456'></a>

### REQ-456: US Core Coverage Profile implementation

**Text**: 

**Context**: System conformance to US Core Coverage Profile.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-456

## 1. Requirement ID
**REQ-456**: US Core Coverage Profile implementation

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated through automated testing by verifying that Coverage resources returned by the system conform to the US Core Coverage Profile structure, constraints, and required elements.

### Complexity
**Moderate** - Requires validation of profile conformance including must-support elements, value set bindings, cardinality constraints, and data type requirements specific to the US Core Coverage Profile.

### Prerequisites
- System must be configured as a US Core Server implementing the US Core Server CapabilityStatement
- System must have Coverage resources available for testing
- System must support RESTful FHIR operations for Coverage resources
- Test client must have appropriate access credentials/authorization
- FHIR validator capable of validating against US Core profiles must be available

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Coverage resources stored in the system under test
- **Profile URL**: http://hl7.org/fhir/us/core/StructureDefinition/us-core-coverage
- **Test Parameters**: Patient references or Coverage IDs to retrieve test data

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations should be supported:
- `GET [base]/Coverage/[id]` - Read specific Coverage resource
- `GET [base]/Coverage?patient=[reference]` - Search Coverage by patient
- Additional search parameters as defined in US Core Coverage Profile requirements

### Validation Criteria

#### Profile Conformance Validation
**Test Case 1: Coverage Resource Profile Validation**
- **Action**: Retrieve Coverage resources using supported operations
- **Validation**: 
  - Each returned Coverage resource SHALL declare conformance to `http://hl7.org/fhir/us/core/StructureDefinition/us-core-coverage` in `Coverage.meta.profile`
  - All Coverage resources SHALL pass validation against the US Core Coverage Profile
  - FHIR validator reports no errors when validating against the profile

#### Must Support Elements Validation
**Test Case 2: Must Support Elements Present**
- **Action**: Analyze retrieved Coverage resources for must-support elements
- **Validation**:
  - All must-support elements defined in US Core Coverage Profile SHALL be present if data is available
  - System SHALL be capable of populating all must-support elements
  - No must-support elements SHALL be absent without appropriate explanation

#### Data Type and Cardinality Validation
**Test Case 3: Data Type Conformance**
- **Action**: Examine data types and cardinality of elements in Coverage resources
- **Validation**:
  - All elements SHALL conform to data types specified in US Core Coverage Profile
  - Element cardinality SHALL match profile requirements (required vs optional elements)
  - Complex data types SHALL conform to their respective structure definitions

#### Value Set Binding Validation
**Test Case 4: Terminology Binding Compliance**
- **Action**: Validate coded elements against required value sets
- **Validation**:
  - All coded elements with required bindings SHALL use codes from specified value sets
  - Extensible bindings SHALL use preferred codes when applicable concepts exist
  - System SHALL handle value set validation appropriately

#### Search Parameter Support Validation
**Test Case 5: Required Search Parameters**
- **Action**: Test search functionality using US Core Coverage Profile required search parameters
- **Validation**:
  - System SHALL support all required search parameters defined in US Core Coverage Profile
  - Search results SHALL return properly formatted Coverage resources
  - Search parameters SHALL function as specified in the profile documentation

### Expected Test Results for Passing Conformance

1. **Profile Declaration**: All Coverage resources include correct profile URL in meta.profile
2. **Validation Success**: FHIR validator returns zero errors for all Coverage resources
3. **Must Support Compliance**: All required must-support elements are present and populated appropriately
4. **Data Integrity**: All data types, cardinalities, and constraints are properly implemented
5. **Terminology Compliance**: All coded values conform to specified value set bindings
6. **Search Functionality**: All required search parameters work correctly and return conformant results

### Failure Scenarios Indicating Non-Conformance

- Coverage resources fail profile validation
- Missing or incorrectly formatted must-support elements
- Invalid data types or cardinality violations
- Use of incorrect codes from value sets with required bindings
- Non-functional or incorrectly implemented search parameters
- Missing profile declarations in resource metadata

---



<a id='device'></a>

## Device

<a id='req-019'></a>

### REQ-019: Device SHALL have a unique Device Identifier

**Text**: 

**Context**: 

**Actor**: Device

**Conformance**: SHALL

# Test Specification for REQ-019

## 1. Requirement ID
**REQ-019**: Device SHALL have a unique Device Identifier

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified programmatically by examining Device resources to ensure they contain unique device identifiers in the appropriate FHIR elements.

### Complexity
**Simple** - The test involves straightforward validation of Device resource structure and uniqueness checking of identifier values.

### Prerequisites
- System must have Device resources available for testing
- Access to query/retrieve Device resources from the FHIR server
- The system should support standard FHIR Device resource operations

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Device resources present in the system under test
- **Test Data**: Any Device resources available in the system (following "bring your own data" approach)
- **Server Endpoint**: FHIR base URL for the system under test

### Expected Outputs
- Device resources with properly populated unique identifier fields
- Confirmation that no duplicate device identifiers exist across Device resources
- Validation that Device.identifier or Device.udiCarrier elements are present and contain unique values

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are supported:

1. **GET [base]/Device** - Search for all Device resources
2. **GET [base]/Device/[id]** - Read specific Device resources
3. **GET [base]/Device?[search-parameters]** - Search Device resources with parameters

*Note: The specific Device search parameters and operations would need to be confirmed in the complete CapabilityStatement for Device resources*

### Validation Criteria

#### Test Case 1: Device Identifier Presence Validation
**Objective**: Verify that each Device resource contains at least one unique identifier

**Test Steps**:
1. Retrieve all Device resources from the system using `GET [base]/Device`
2. For each Device resource, verify that at least one of the following identifier elements is present:
   - `Device.identifier` array contains at least one Identifier element
   - `Device.udiCarrier` array contains at least one UDICarrier element with device identifier

**Pass Criteria**:
- All Device resources MUST have either Device.identifier or Device.udiCarrier populated
- Each identifier element MUST contain a non-empty value

#### Test Case 2: Device Identifier Uniqueness Validation
**Objective**: Verify that device identifiers are unique across all Device resources

**Test Steps**:
1. Collect all device identifiers from Device resources:
   - Extract values from `Device.identifier[].value` fields
   - Extract values from `Device.udiCarrier[].deviceIdentifier` fields
   - Extract values from `Device.udiCarrier[].carrierHRF` and `Device.udiCarrier[].carrierAIDC` if used as identifiers
2. Create a comprehensive list of all device identifier values
3. Check for duplicate values in the collected identifier list

**Pass Criteria**:
- No duplicate device identifier values SHALL exist across all Device resources
- Each device identifier value MUST be unique within the system
- If multiple identifier types are present on a single Device, they should represent the same physical device

#### Test Case 3: Device Identifier Format Validation
**Objective**: Verify that device identifiers follow appropriate formatting requirements

**Test Steps**:
1. For each Device resource with identifiers:
   - Validate `Device.identifier[].system` contains appropriate URI when present
   - Validate `Device.identifier[].value` is non-empty string
   - For UDI carriers, validate format according to FDA/GS1 standards if applicable

**Pass Criteria**:
- All identifier values MUST be non-empty strings
- Identifier systems MUST be valid URIs when specified
- UDI format validation SHOULD follow established standards (GS1, HIBCC, ICCBBA)

#### Failure Scenarios
The test FAILS if:
- Any Device resource lacks both Device.identifier and Device.udiCarrier elements
- Duplicate device identifier values are found across different Device resources
- Any identifier value is empty, null, or contains only whitespace
- Device resources cannot be successfully retrieved from the server

#### Error Handling
- Document any HTTP errors (400, 401, 403, 404) encountered during Device resource retrieval
- Handle cases where Device resources may not be available in the test system
- Report any resources that cannot be parsed or validated due to structural issues

---

<a id='req-020'></a>

### REQ-020: Device SHALL have a status of 'Active'

**Text**: 

**Context**: 

**Actor**: Device

**Conformance**: SHALL

# Test Specification for REQ-020

## 1. Requirement ID
**REQ-020**: Device SHALL have a status of 'Active'

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be programmatically verified by examining the `status` field of Device resources and confirming the value is 'active'.

### Complexity
**Simple** - Direct field value validation with clear success/failure criteria.

### Prerequisites
- System must support Device resource operations as specified in the Capability Statement
- Test data must include Device resources (specifically US Core Implantable Device Profile instances)
- System must be configured to return Device resources via supported search parameters

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Device resources conforming to US Core Implantable Device Profile
- **Test Data Approach**: "Bring your own data" - any existing Device resources in the system under test
- **Search Parameters**: Utilize supported Device search parameters from Capability Statement:
  - `patient` 
  - `status`
  - `type`
  - Combined searches: `patient+status`, `patient+type`

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for Device resources:

1. **Search Operations**:
   - `GET [base]/Device?status=active` - Search for all active devices
   - `GET [base]/Device?patient=[id]&status=active` - Search for active devices by patient
   - `GET [base]/Device?patient=[id]` - Search for all devices by patient (to verify status)

2. **Read Operations** (if individual Device IDs are known):
   - `GET [base]/Device/[id]` - Direct read of specific Device resources

### Validation Criteria

#### Primary Validation
For each Device resource retrieved:
1. **Status Field Presence**: Verify that `Device.status` field exists and is populated
2. **Status Value Validation**: Assert that `Device.status` equals 'active' (case-sensitive)
3. **Profile Conformance**: Confirm Device resources conform to US Core Implantable Device Profile

#### Test Scenarios

**Scenario 1: Direct Status Search Validation**
- Execute: `GET [base]/Device?status=active`
- Assert: All returned Device resources have `status = 'active'`
- Assert: HTTP response status is 200 (OK)

**Scenario 2: Patient-Specific Device Status Validation**
- Execute: `GET [base]/Device?patient=[patient-id]`
- For each returned Device resource:
  - Assert: `Device.status = 'active'`
- If no Device resources exist for the patient, test should be marked as "Not Applicable"

**Scenario 3: Combined Search Parameter Validation**
- Execute: `GET [base]/Device?patient=[patient-id]&status=active`
- Assert: All returned resources have `status = 'active'`
- Cross-validate with results from patient-only search to ensure consistency

#### Success Criteria
- All Device resources in the system have `status` field set to 'active'
- No Device resources are found with status values other than 'active'
- Search operations return consistent results across different parameter combinations

#### Failure Indicators
- Any Device resource with `status` value other than 'active'
- Missing `status` field in any Device resource
- Inconsistent results between different search parameter combinations
- HTTP error responses (4xx, 5xx) when executing supported search operations

#### Edge Cases to Consider
- Empty result sets (no Device resources available) - should be marked as "Not Applicable"
- Device resources with null or missing status field - should fail validation
- Case sensitivity verification for status value matching

---

<a id='req-021'></a>

### REQ-021: Device SHALL have a manufacturer specified

**Text**: 

**Context**: 

**Actor**: Device

**Conformance**: SHALL

# Test Specification for REQ-021

## 1. Requirement ID
**REQ-021**: Device SHALL have a manufacturer specified

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Automatically testable

This requirement can be automatically validated by checking Device resource instances for the presence and proper specification of manufacturer information. The FHIR Device resource provides multiple pathways for specifying manufacturer information that can be programmatically verified.

### Complexity
**Simple**

The test involves straightforward validation of manufacturer data presence in Device resources without complex business logic or multi-step workflows.

### Prerequisites
- Access to a FHIR server with Device resources
- Device resources must be available for testing (bring your own data approach)
- Server must support basic FHIR RESTful read operations for Device resources
- Authentication/authorization credentials if required by the server

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Device resources (any valid Device instances available in the test system)

**Expected Outputs:**
- Validation results indicating whether each Device resource contains manufacturer specification
- Pass/fail status for each tested Device resource
- Summary report of conformance across all tested devices

### Required FHIR Operations
Based on the Capability Statement analysis, the following operations are needed:

1. **Device Resource Retrieval**:
   - `GET [base]/Device/[id]` - Read specific Device resources
   - `GET [base]/Device` - Search for Device resources (if supported)
   - Operations must support JSON format (SHALL requirement from Capability Statement)
   - May support XML format (SHOULD requirement from Capability Statement)

**Note**: The provided Capability Statement focuses on US Core Server capabilities but doesn't explicitly mention Device resource support. The test assumes Device resource operations are available as this is a Device-specific requirement.

### Validation Criteria

The test SHALL verify that each Device resource contains manufacturer information through one or more of the following valid pathways:

#### Primary Validation Checks:

1. **Device.manufacturer field**:
   - Verify `Device.manufacturer` element exists
   - Verify `Device.manufacturer` contains non-empty string value
   - Verify string is not just whitespace

2. **Device.deviceName with type 'manufacturer-name'**:
   - Check if `Device.deviceName` array contains entry where `Device.deviceName.type` = 'manufacturer-name'
   - Verify corresponding `Device.deviceName.name` contains non-empty string value

3. **Device.udiCarrier manufacturer information**:
   - If `Device.udiCarrier` exists, verify it contains manufacturer-related information
   - Check `Device.udiCarrier.issuer` for manufacturer identification
   - Validate UDI format includes manufacturer information per applicable standards

#### Test Assertions:

**PASS Criteria**:
- Device resource contains at least one of the manufacturer specification pathways listed above
- Manufacturer information is present and non-empty
- Data format follows FHIR specification requirements

**FAIL Criteria**:
- No manufacturer information found in any of the valid pathways
- Manufacturer field exists but contains only empty string or whitespace
- Required manufacturer data elements are missing or malformed

#### Error Handling:
- Handle HTTP 404 responses gracefully (unknown Device resources)
- Handle HTTP 401/403 responses (authorization issues)
- Handle HTTP 400 responses (invalid parameters)
- Validate JSON response format compliance
- Report any FHIR validation errors encountered

#### Reporting Requirements:
- Document specific pathway(s) used for manufacturer specification in each Device
- Provide clear pass/fail status for each tested Device resource
- Generate summary statistics of conformance across all tested devices
- Include any encountered errors or warnings in the test report

---

<a id='req-022'></a>

### REQ-022: Device SHALL have an expiration date

**Text**: 

**Context**: 

**Actor**: Device

**Conformance**: SHALL

# Test Specification for REQ-022

## 1. Requirement ID
**REQ-022**: Device SHALL have an expiration date

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated through automated testing by examining Device resources for the presence of expiration date elements.

### Complexity
**Simple** - The requirement involves checking for the presence of a specific data element in Device resources.

### Prerequisites
- Access to a FHIR server implementing US Core Server capabilities
- Device resources available in the system for testing
- Read access to Device resources via FHIR API

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Device resources that should contain expiration date information
- **System Access**: FHIR server endpoint with Device resource support
- **Authentication**: Appropriate credentials if required by the server

### Expected Outputs
- Device resources retrieved from the server
- Validation results indicating presence/absence of expiration date elements
- Conformance status (PASS/FAIL) for each Device resource tested

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations should be supported:

1. **GET /Device/{id}** - Retrieve specific Device resources by ID
2. **GET /Device** - Search for Device resources (if search parameters are supported)

*Note: The specific Device operations supported should be verified against the complete CapabilityStatement implementation.*

### Validation Criteria

#### Primary Validation Checks
1. **Expiration Date Presence**: Each Device resource SHALL contain at least one of the following expiration date elements:
   - `Device.expirationDate` (if available in the FHIR version being tested)
   - `Device.udiCarrier.expiration` (for UDI-related expiration dates)
   - Other relevant expiration date fields as defined in the Device resource structure

#### Specific Assertions for Test Passing
A test case PASSES when:
- The Device resource contains a valid expiration date element
- The expiration date value is properly formatted according to FHIR dateTime or date specifications
- The expiration date value is not null or empty

A test case FAILS when:
- No expiration date element is present in the Device resource
- The expiration date element exists but contains null, empty, or invalid values
- The expiration date format does not conform to FHIR specifications

#### Test Execution Approach
1. **Resource Discovery**: Query available Device resources using supported search operations
2. **Individual Validation**: For each Device resource found:
   - Retrieve the complete resource
   - Examine all potential expiration date fields
   - Validate format and presence of expiration date data
3. **Conformance Reporting**: Generate results indicating which Device resources conform to the expiration date requirement

#### Edge Case Considerations
- Handle Device resources that may have multiple expiration dates (e.g., different components)
- Account for different date formats that may be valid within FHIR specifications
- Consider timezone implications for date/dateTime values

This test specification supports a "bring your own data" approach by validating whatever Device resources are available in the target system, without requiring specific test fixtures or predetermined data sets.

---

<a id='req-023'></a>

### REQ-023: Device SHALL have a lot number

**Text**: 

**Context**: 

**Actor**: Device

**Conformance**: SHALL

# Test Specification for REQ-023

## Requirement ID
REQ-023

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated through automated testing by examining Device resources to verify the presence of lot number information in the appropriate FHIR elements.

### Complexity
**Simple** - The requirement involves checking for the presence of a specific data element within Device resources, which is a straightforward validation task.

### Prerequisites
- Test system must support Device resource operations as specified in the US Core Server Capability Statement
- Test system must have Device resources available that represent implantable devices (based on US Core Implantable Device Profile support)
- Test data should include a variety of Device resources to ensure comprehensive coverage

## Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Device resources conforming to the US Core Implantable Device Profile
- Device resources should represent various types of implantable medical devices that would be expected to have lot numbers

**Expected Outputs:**
- Validation results indicating whether each Device resource contains the required lot number information
- Clear pass/fail status for each tested Device resource
- Summary report of conformance across all tested Device resources

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for Device resources:

1. **Device Search Operations:**
   - `GET [base]/Device?patient=[reference]` - Search for devices by patient
   - `GET [base]/Device?status=[code]` - Search for devices by status  
   - `GET [base]/Device?type=[code]` - Search for devices by type
   - `GET [base]/Device?patient=[reference]&status=[code]` - Combined patient and status search
   - `GET [base]/Device?patient=[reference]&type=[code]` - Combined patient and type search

2. **Device Read Operations:**
   - `GET [base]/Device/[id]` - Read specific Device resource by ID

### Validation Criteria

**Primary Validation:**
- Each Device resource SHALL contain lot number information in one of the following locations:
  - `Device.lotNumber` element (if available in the resource structure)
  - `Device.udiCarrier.deviceIdentifier` or related UDI fields that contain lot number information
  - `Device.serialNumber` if it contains lot number information
  - `Device.modelNumber` if it incorporates lot number data

**Specific Assertions:**
1. **Lot Number Presence Check:**
   - Assert that at least one lot number-related field is populated and not empty
   - Verify that the lot number value is not just whitespace or placeholder text

2. **Data Format Validation:**
   - Assert that lot number values follow expected format patterns (alphanumeric, appropriate length)
   - Verify that lot number information is machine-readable and properly structured

3. **UDI Integration Check (if applicable):**
   - If Device uses UDI (Unique Device Identifier), assert that lot number information is properly embedded within the UDI structure
   - Verify UDI format compliance if lot number is part of UDI data

**Test Execution Steps:**
1. Query for Device resources using supported search parameters
2. For each returned Device resource:
   - Extract and examine lot number-related fields
   - Validate presence and format of lot number data
   - Record pass/fail status with specific details about which fields were checked
3. Generate comprehensive conformance report

**Pass Criteria:**
- All tested Device resources contain valid lot number information in appropriate FHIR elements
- Lot number data is properly formatted and machine-readable
- No Device resources are missing required lot number information

**Fail Criteria:**
- Any Device resource lacks lot number information entirely
- Lot number fields are present but contain only empty, null, or placeholder values
- Lot number format is invalid or not machine-readable

**Additional Considerations:**
- Test should accommodate different Device types and manufacturers that may store lot number information in varying formats
- Validation should be flexible enough to accept lot numbers in different standard formats while still ensuring the requirement is met
- Consider testing with both active and inactive Device resources to ensure lot number requirements apply regardless of device status

---

<a id='req-024'></a>

### REQ-024: Device SHALL have a serial number

**Text**: 

**Context**: 

**Actor**: Device

**Conformance**: SHALL

# Test Specification for REQ-024

## 1. Requirement ID
REQ-024

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be programmatically verified by checking the presence and structure of the serial number element in Device resources.

### Complexity
**Simple** - The test involves straightforward validation of a mandatory data element presence within a FHIR resource.

### Prerequisites
- System must support FHIR Device resources
- Test system must have access to Device resources (either through API endpoints or provided test data)
- Device resources should be available for testing (following "bring your own data" approach)

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- One or more Device resources from the system under test
- Device resources may be obtained through:
  - GET /Device/{id} operations
  - GET /Device search operations
  - Provided as test data files

**Expected Outputs:**
- Validation results indicating presence/absence of serial number
- Pass/fail status for each Device resource tested

### Required FHIR Operations
Based on the Capability Statement analysis, the following operations may be used to retrieve Device resources for testing:

- **GET /Device/{id}** - Retrieve specific Device resources by ID
- **GET /Device** - Search for Device resources (if search is supported for Device resources)

*Note: The provided Capability Statement focuses on US Core Server capabilities but doesn't explicitly mention Device resource support. The test should verify what Device operations are actually supported by the target system.*

### Validation Criteria

**Primary Validation:**
1. **Serial Number Presence Check:**
   - Verify that each Device resource contains a serial number element
   - Check for the presence of `Device.serialNumber` field
   - Ensure the serial number field is not empty or null

**Specific Assertions:**
- `Device.serialNumber` field SHALL exist in the resource
- `Device.serialNumber` field SHALL contain a non-empty string value
- The serial number value SHALL be a valid string (not just whitespace)

**Test Cases:**
1. **Valid Device with Serial Number:**
   - Input: Device resource with populated `serialNumber` field
   - Expected Result: PASS - Serial number requirement satisfied

2. **Device Missing Serial Number:**
   - Input: Device resource without `serialNumber` field
   - Expected Result: FAIL - Violation of SHALL requirement

3. **Device with Empty Serial Number:**
   - Input: Device resource with empty or null `serialNumber` field
   - Expected Result: FAIL - Empty value does not satisfy SHALL requirement

**Success Criteria:**
- All Device resources tested must contain a non-empty `serialNumber` field
- 100% pass rate required for conformance (since this is a SHALL requirement)

**Error Handling:**
- If Device resources cannot be retrieved, document as a prerequisite failure rather than a requirement failure
- If no Device resources exist in the system, the test should be marked as not applicable rather than passed or failed

---

<a id='req-044'></a>

### REQ-044: Device SHALL have a CarrierHRF for human-readable format.

**Text**: 

**Context**: 

**Actor**: Device Manufacturer

**Conformance**: SHALL

# Test Specification for REQ-044

## 1. Requirement ID
REQ-044

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be programmatically validated by examining Device resources to verify the presence and format of the CarrierHRF element within the UDI structure.

### Complexity
**Simple** - The test involves straightforward validation of a specific data element's presence and format within Device resources.

### Prerequisites
- Access to a FHIR server containing Device resources
- Device resources must have UDI (Unique Device Identifier) information populated
- Understanding of UDI structure and CarrierHRF format requirements per FDA regulations

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Device resources containing UDI information
- The Device resources should represent actual medical devices that would be subject to UDI requirements

**Expected Outputs:**
- Validation results confirming CarrierHRF presence and human-readable format compliance
- Clear pass/fail status for each Device resource examined

### Required FHIR Operations
Based on the US Core Server Capability Statement:
- **GET /Device** - Retrieve Device resources for analysis
- **GET /Device/[id]** - Retrieve specific Device resources by ID
- Standard FHIR read operations as supported by the US Core Server implementation

### Validation Criteria

**Primary Assertions:**
1. **CarrierHRF Presence Validation:**
   - Verify that `Device.udiCarrier.carrierHRF` element is present
   - Confirm the element is not null or empty

2. **Human-Readable Format Validation:**
   - Validate that the CarrierHRF contains human-readable characters
   - Ensure the format follows UDI human-readable formatting standards
   - Verify the string is properly formatted and contains the required UDI components in readable form

3. **Data Type Compliance:**
   - Confirm CarrierHRF is stored as a string data type
   - Validate proper encoding and character set usage

**Test Cases:**
1. **Positive Test Case:**
   - Query Device resources with UDI information
   - For each Device with UDI data, assert that `udiCarrier.carrierHRF` exists and contains valid human-readable UDI format

2. **Coverage Test Case:**
   - Ensure all Device resources that have UDI information include the CarrierHRF element
   - Verify no Device resources with UDI data are missing the required CarrierHRF

**Pass Criteria:**
- All Device resources containing UDI information MUST have a populated CarrierHRF element
- CarrierHRF content MUST be in human-readable format
- No Device resources with UDI data should fail the CarrierHRF validation

**Fail Criteria:**
- Any Device resource with UDI information lacks the CarrierHRF element
- CarrierHRF element is present but empty or null
- CarrierHRF content is not in proper human-readable format

**Implementation Notes:**
- The test should work with any Device data provided by the implementer
- Focus on UDI-enabled devices as these are the devices subject to this requirement
- Test should accommodate different UDI formats while ensuring human readability requirements are met

---

<a id='req-045'></a>

### REQ-045: Device SHALL specify the EntryType.

**Text**: 

**Context**: 

**Actor**: Device Manufacturer

**Conformance**: SHALL

# Test Specification for REQ-045

## 1. Requirement ID
REQ-045

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Not testable due to being too vague

**Rationale**: The requirement "Device SHALL specify the EntryType" lacks sufficient detail for implementation:
- No definition of what "EntryType" refers to in FHIR context
- No specification of which FHIR resource or element should contain this information
- No indication of expected values or format for EntryType
- The context references "Device-udi-3.md" but no specific FHIR Device profile or element is identified

### Complexity
**Classification**: Cannot be determined due to vague requirement

### Prerequisites
Cannot be established due to insufficient requirement specification

## 3. Test Implementation Strategy

### Current Status
**This requirement cannot be implemented as a test** due to the following critical gaps:

1. **Missing FHIR Context**: The requirement does not specify:
   - Which FHIR resource(s) are involved (Device, DeviceDefinition, etc.)
   - Which specific FHIR elements or extensions should contain the EntryType
   - The data type and format expected for EntryType values

2. **Undefined EntryType Concept**: 
   - "EntryType" is not a standard FHIR element name
   - No definition provided for what this represents
   - Could refer to device category, UDI entry type, or other classification

3. **Capability Statement Mismatch**:
   - The provided US Core Server Capability Statement does not include Device resource requirements
   - No Device-related operations or search parameters are specified
   - Cannot validate API operations without proper capability alignment

### Recommended Actions for Requirement Clarification

To make this requirement testable, the following information is needed:

1. **FHIR Resource Specification**:
   - Identify the specific FHIR resource (e.g., Device, DeviceDefinition)
   - Specify the exact FHIR element or extension path

2. **EntryType Definition**:
   - Define what EntryType represents
   - Provide expected values or value set
   - Specify data type (code, string, CodeableConcept, etc.)

3. **Implementation Context**:
   - Clarify the relationship to UDI requirements
   - Specify when and how this information should be provided
   - Define validation rules and constraints

4. **Capability Alignment**:
   - Ensure Device resource operations are included in relevant capability statements
   - Define required Device profile support if applicable

### Suggested Requirement Revision

A properly specified requirement might read:
```
"Device resources SHALL include the device entry type in the Device.type element using codes from the [specified value set]. The entry type SHALL indicate whether the device is [specific classification criteria]."
```

This would enable creation of a testable specification with clear validation criteria and implementation guidance.

---

<a id='req-046'></a>

### REQ-046: Device SHALL have a status.

**Text**: 

**Context**: 

**Actor**: Device Manufacturer

**Conformance**: SHALL

# Test Specification: REQ-046

## Requirement Analysis

**Testability Assessment**: Automatically testable
- This requirement can be validated through automated inspection of FHIR Device resources to verify the presence of the mandatory `status` element.

**Complexity**: Simple
- The test involves checking for the existence of a single required field in the Device resource.

**Prerequisites**:
- Test system must have access to Device resources
- Device resources should be available for testing (bring your own data approach)
- FHIR R4 compliance for Device resource structure

## Test Implementation Strategy

### Required Inputs
**FHIR Resources**:
- One or more Device resources provided by the test implementer
- Resources should represent real-world device data from the system under test

**Expected Outputs**:
- Validation results indicating whether each Device resource contains a `status` element
- Clear pass/fail indication for conformance to the requirement

### Required FHIR Operations
Based on the US Core Server Capability Statement, the following operations may be used to retrieve Device resources for testing:

- **GET /Device/[id]** - Retrieve specific Device resource by ID
- **GET /Device** - Search for Device resources (if search parameters are supported)

*Note: Specific Device operations support should be verified against the complete US Core Server Capability Statement as the provided excerpt focuses on general server capabilities.*

### Validation Criteria

**Primary Assertion**:
- **PASS**: Device resource contains a `status` element with a valid value
- **FAIL**: Device resource is missing the `status` element

**Specific Checks**:
1. **Status Element Presence**: Verify that `Device.status` field exists in the resource
2. **Status Value Validation**: Confirm that the status value conforms to the required ValueSet (active | inactive | entered-in-error | unknown)
3. **Cardinality Compliance**: Ensure status appears exactly once (1..1 cardinality as per FHIR specification)

**Test Execution Approach**:
1. Retrieve available Device resources from the system under test
2. For each Device resource, inspect the JSON/XML structure
3. Verify presence of the `status` element
4. Validate that the status value is from the allowed code system
5. Generate conformance report indicating pass/fail status for each resource tested

**Success Criteria**:
- 100% of tested Device resources must contain a valid `status` element to demonstrate full conformance with REQ-046
- Any Device resource lacking a status element constitutes a conformance failure

---

<a id='req-047'></a>

### REQ-047: Device SHALL have a manufacturer.

**Text**: 

**Context**: 

**Actor**: Device Manufacturer

**Conformance**: SHALL

# Test Specification for REQ-047

## 1. Requirement ID
REQ-047

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be validated programmatically by verifying the presence of manufacturer information in Device resources through FHIR validation and data inspection.

### Complexity
**Simple** - The requirement involves checking for the presence of a single data element (manufacturer) in Device resources.

### Prerequisites
- Test system must support Device resource operations
- Device resources must be available in the system for testing
- Access to retrieve Device resources through FHIR API

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Device resources present in the test system
- **Test Data**: Any Device resources available through the system's FHIR endpoint (bring your own data approach)

### Expected Outputs
- Validation results indicating whether each Device resource contains manufacturer information
- Pass/fail status for each Device resource tested

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required for testing:

1. **GET /Device/{id}** - Retrieve individual Device resources
2. **GET /Device** - Search for Device resources (if search parameters are supported)

*Note: The provided Capability Statement focuses on US Core Server capabilities. Device-specific operations should be confirmed to be supported by the implementation under test.*

### Validation Criteria

The test SHALL verify that each Device resource contains manufacturer information through one of the following elements:

#### Primary Validation Checks:
1. **Device.manufacturer** element is present and populated with a non-empty value
   - **Assertion**: `Device.manufacturer` exists and contains meaningful data (not null, empty string, or whitespace only)

#### Alternative Manufacturer Information Sources:
If Device.manufacturer is not present, verify manufacturer information is available through:

2. **Device.deviceName** array where `deviceName.type = 'manufacturer-name'`
   - **Assertion**: At least one `Device.deviceName` element exists with `type = 'manufacturer-name'` and non-empty `name` value

3. **Device.udiCarrier.deviceIdentifier** with associated manufacturer data
   - **Assertion**: If UDI information is present, verify that manufacturer information can be derived or is explicitly included

#### Test Execution Steps:
1. **Discovery Phase**: Identify all Device resources available in the test system
2. **Retrieval Phase**: Retrieve each Device resource using supported FHIR operations
3. **Validation Phase**: For each Device resource:
   - Check for presence of `Device.manufacturer` element
   - If manufacturer element is absent, check alternative sources
   - Record validation results
4. **Reporting Phase**: Generate pass/fail results for each Device resource tested

#### Pass Criteria:
- **Individual Resource Level**: Each Device resource must have manufacturer information present in at least one of the specified locations
- **Overall Test Level**: All Device resources in the test dataset must pass individual validation

#### Fail Criteria:
- Any Device resource lacks manufacturer information in all checked locations
- Device resource exists but manufacturer data is null, empty, or contains only whitespace

### Additional Considerations:
- Test should handle various data formats and representations of manufacturer information
- Test should account for different implementation approaches while maintaining conformance
- Results should clearly identify which Device resources fail validation and the specific reason for failure

---

<a id='req-048'></a>

### REQ-048: Device SHALL have a manufacture date.

**Text**: 

**Context**: 

**Actor**: Device Manufacturer

**Conformance**: SHALL

# Test Specification for REQ-048

## 1. Requirement ID
REQ-048

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified programmatically by inspecting Device resources to confirm the presence of a manufacturing date field.

### Complexity
**Simple** - This is a straightforward data presence validation that requires checking for a specific field in Device resources.

### Prerequisites
- Access to a FHIR server implementing US Core Server capabilities
- Device resources available in the system for testing
- The system must support Device resource retrieval operations as defined in the US Core Server CapabilityStatement

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Device resources present in the test system
- **Test Data**: Any existing Device resources in the system under test (bring your own data approach)
- **System Access**: Valid credentials and endpoints for the FHIR server being tested

### Expected Outputs
- Device resources that contain manufacturing date information
- Validation results confirming presence of manufacturing date in each Device resource

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations should be supported:

1. **Device Search Operations**:
   - `GET [base]/Device` - Search for Device resources
   - `GET [base]/Device/[id]` - Read specific Device resource by ID

2. **Resource Retrieval**:
   - Standard FHIR read operations to retrieve Device resources for inspection

### Validation Criteria

#### Primary Validation Checks:
1. **Manufacturing Date Presence Check**:
   - Each Device resource SHALL contain a manufacturing date
   - Verify presence of `Device.manufactureDate` element
   - Confirm the field is populated (not null or empty)

2. **Data Type Validation**:
   - Verify `Device.manufactureDate` is a valid FHIR dateTime data type
   - Ensure the date format conforms to FHIR specifications

#### Test Assertions:
- **PASS**: All Device resources contain a populated `manufactureDate` field with valid dateTime values
- **FAIL**: Any Device resource is missing the `manufactureDate` field or contains null/empty values
- **ERROR**: Unable to retrieve Device resources or system access issues

#### Implementation Notes:
1. **Coverage**: Test should validate all Device resources accessible through the system
2. **Data Flexibility**: Test should work with any existing Device data in the system
3. **Conformance Focus**: Validation should focus on the structural requirement (presence of field) rather than business logic validation of dates
4. **Error Handling**: Test should gracefully handle cases where no Device resources exist in the system

#### Success Metrics:
- 100% of Device resources must have a manufacturing date to achieve full conformance
- Test results should provide clear reporting on which resources pass/fail the requirement

---

<a id='req-049'></a>

### REQ-049: Device SHALL have an expiration date.

**Text**: 

**Context**: 

**Actor**: Device Manufacturer

**Conformance**: SHALL

# Test Specification for REQ-049

## 1. Requirement ID
REQ-049

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated through automated inspection of Device resources to verify the presence and format of expiration date fields.

### Complexity
**Simple** - The test involves checking for the presence of a specific field (expiration date) in Device resources, which is a straightforward validation.

### Prerequisites
- Test system must have access to Device resources created or managed by the Device Manufacturer
- Device resources must be accessible via FHIR API endpoints
- Test system must support Device resource validation according to applicable profiles

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Device resources that represent medical devices with UDI information
- Resources should be provided by the Device Manufacturer actor being tested

**Expected Outputs:**
- Confirmation that all Device resources contain expiration date information
- Validation that expiration dates are properly formatted and accessible

### Required FHIR Operations
Based on the US Core Server Capability Statement, the following operations will be utilized:

1. **Device.read** - To retrieve individual Device resources for validation
2. **Device.search** - To query and retrieve multiple Device resources for batch validation
3. Standard FHIR validation operations to verify resource structure compliance

*Note: These operations align with the RESTful capabilities described in the US Core Server CapabilityStatement.*

### Validation Criteria

The test SHALL verify the following assertions for each Device resource:

#### Primary Validation
1. **Expiration Date Presence**: Each Device resource MUST contain expiration date information in one of the following locations:
   - `Device.expirationDate` element (if available in the profile)
   - `Device.udiCarrier.deviceIdentifier` with associated expiration information
   - `Device.udiCarrier.lotNumber` with related expiration data
   - Extension elements containing expiration date information

#### Secondary Validation
2. **Date Format Compliance**: Any expiration date values MUST conform to FHIR date/dateTime formatting requirements (ISO 8601)

3. **Logical Consistency**: Expiration dates MUST be:
   - Future dates relative to manufacturing or issue dates (where available)
   - Logically consistent with device lifecycle information

#### Test Execution Steps
1. **Resource Discovery**: Query for Device resources using appropriate search parameters
2. **Individual Resource Validation**: For each discovered Device resource:
   - Retrieve the complete resource
   - Parse and validate expiration date fields
   - Verify date format compliance
   - Check logical consistency of dates
3. **Aggregate Results**: Compile validation results across all tested Device resources
4. **Pass/Fail Determination**: Test passes if ALL Device resources contain valid expiration date information

#### Pass Criteria
- 100% of tested Device resources contain accessible expiration date information
- All expiration dates are properly formatted according to FHIR standards
- No logical inconsistencies are detected in date relationships

#### Fail Criteria
- Any Device resource lacks expiration date information
- Any expiration date fails FHIR format validation
- Logical inconsistencies are detected in date values

### Additional Considerations
- The test should accommodate various UDI formats and standards that may contain expiration information
- Results should clearly identify which specific Device resources (by ID) pass or fail validation
- The test should be designed to work with whatever Device data the manufacturer provides, following a "bring your own data" approach

---

<a id='req-050'></a>

### REQ-050: Device SHALL have a lot number.

**Text**: 

**Context**: 

**Actor**: Device Manufacturer

**Conformance**: SHALL

# Test Specification for REQ-050

## 1. Requirement ID
**REQ-050**: Device SHALL have a lot number.

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified programmatically by examining Device resources to confirm the presence of lot number information in the appropriate FHIR elements.

### Complexity
**Simple** - This is a straightforward presence check for a specific data element within Device resources.

### Prerequisites
- Access to a FHIR server containing Device resources
- Device resources must represent physical devices that would typically have lot numbers (medical devices, implants, etc.)
- Server must support Device resource queries as specified in the US Core Server Capability Statement

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Device resources from the system under test
- **Test Data**: Any Device resources present in the test system (following "bring your own data" approach)
- **Access Requirements**: Read access to Device resources via FHIR API

### Required FHIR Operations
Based on the US Core Server Capability Statement, the following operations should be supported:
- `GET /Device` - Retrieve Device resources
- `GET /Device/{id}` - Retrieve specific Device resource by ID
- Standard FHIR search parameters for Device resources as supported by the server

### Validation Criteria

#### Primary Validation
For each Device resource retrieved:

1. **Lot Number Presence Check**:
   - Verify that the Device resource contains lot number information in one of the following locations:
     - `Device.lotNumber` element (if present in the profile)
     - `Device.udiCarrier.deviceIdentifier` with appropriate UDI parsing to extract lot number
     - `Device.property` array with a property type indicating lot number
     - `Device.version.value` if used to represent lot number information

#### Acceptance Criteria
- **PASS**: All Device resources contain identifiable lot number information in appropriate FHIR elements
- **FAIL**: Any Device resource lacks lot number information in any recognized FHIR element

#### Test Execution Steps
1. Query the FHIR server to retrieve all available Device resources
2. For each Device resource:
   - Parse the resource structure
   - Check for lot number presence in standard FHIR Device elements
   - Validate that the lot number field contains meaningful data (not null, empty, or placeholder values)
3. Generate test results indicating:
   - Total number of Device resources tested
   - Number of resources with valid lot numbers
   - Number of resources missing lot numbers
   - Specific resource IDs failing the requirement

#### Error Handling
- If no Device resources are available: Report as "No testable data available"
- If server does not support Device resource access: Report as "Capability not supported"
- Document any server errors or connectivity issues that prevent complete testing

This test specification ensures conformance with the SHALL requirement while accommodating various data sets and implementation approaches for representing lot numbers in FHIR Device resources.

---

<a id='req-051'></a>

### REQ-051: Device SHALL have a serial number.

**Text**: 

**Context**: 

**Actor**: Device Manufacturer

**Conformance**: SHALL

# Test Specification for REQ-051

## Requirement ID
REQ-051

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated through automated inspection of Device resources to verify the presence of serial number information in the appropriate FHIR elements.

### Complexity
**Simple** - The requirement involves checking for the existence of a specific data element (serial number) within Device resources, which is a straightforward validation.

### Prerequisites
- Device resources must be available in the system under test
- The system must support Device resource queries as specified in the US Core Server Capability Statement
- Test data should include Device resources that represent medical devices with UDI information

## Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Device resources containing UDI (Unique Device Identification) information
- Device resources should represent actual medical devices that would have serial numbers

**Expected Outputs:**
- Device resources with populated serial number information in the UDI structure
- Validation results confirming serial number presence

### Required FHIR Operations
Based on the US Core Server Capability Statement:
- `GET [base]/Device` - Search for Device resources
- `GET [base]/Device/[id]` - Read specific Device resources
- `GET [base]/Device?patient=[reference]` - Search for devices associated with patients (if supported)

### Validation Criteria

The following checks must be performed to verify conformance:

1. **Serial Number Presence Validation:**
   - For each Device resource, verify that `Device.udiCarrier.deviceIdentifier` exists OR `Device.serialNumber` exists
   - The serial number information should be present in at least one of these locations:
     - `Device.udiCarrier.deviceIdentifier` (when UDI contains serial number)
     - `Device.serialNumber` (direct serial number field)

2. **Data Quality Validation:**
   - If `Device.serialNumber` is present, verify it contains a non-empty string value
   - If using UDI carrier approach, verify `Device.udiCarrier.deviceIdentifier` contains a non-empty string value that represents the full UDI including serial number component

3. **Conformance Assertion:**
   - **PASS:** Device resource contains serial number information in either `Device.serialNumber` or as part of `Device.udiCarrier.deviceIdentifier`
   - **FAIL:** Device resource lacks serial number information in both possible locations
   - **SKIP:** No Device resources available for testing

4. **Test Coverage:**
   - Test should validate serial number presence across all available Device resources in the test dataset
   - Results should indicate the percentage of Device resources that conform to the requirement
   - Any non-conformant resources should be reported with specific resource IDs

**Note:** The test accommodates different implementation approaches for storing serial numbers in Device resources, recognizing that serial numbers may be embedded within UDI strings or stored separately in dedicated fields, both of which satisfy the requirement that devices "SHALL have a serial number."

---

<a id='req-052'></a>

### REQ-052: Device SHALL have a model number.

**Text**: 

**Context**: 

**Actor**: Device Manufacturer

**Conformance**: SHALL

# Test Specification for REQ-052

## 1. Requirement ID
REQ-052

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be automatically validated by checking for the presence and structure of the model number field in Device resources.

### Complexity
**Simple** - This is a straightforward structural validation requiring verification of a single mandatory field.

### Prerequisites
- Access to Device resources from the system under test
- FHIR R4 compliant server implementation
- Device resources must be available for testing (bring your own data approach)

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Device resources from the system under test
- **Test Data**: Any existing Device resources in the target system
- **System Access**: Read access to Device resources via FHIR API

### Expected Outputs
- Validation results indicating whether each Device resource contains a model number
- Pass/Fail determination for overall conformance
- Detailed reporting of any non-conformant Device resources

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations should be supported:

1. **Device Read Operations**:
   - `GET [base]/Device/[id]` - Read specific Device resources
   - `GET [base]/Device` - Search for Device resources (if search is supported)

2. **Search Parameters** (if available):
   - Standard Device search parameters as defined in the capability statement

### Validation Criteria

The test SHALL verify that each Device resource meets the following criteria:

#### Primary Validation
1. **Model Number Presence**: Each Device resource MUST contain a model number field
   - **Location**: Verify presence of `Device.modelNumber` element
   - **Cardinality**: Must be present (1..1 or 1..*)
   - **Assertion**: `Device.modelNumber` exists and is not null/empty

#### Secondary Validations
2. **Data Type Compliance**: 
   - Model number should be a valid string type
   - Model number should contain meaningful content (not just whitespace)

3. **FHIR Structural Compliance**:
   - Device resource must be valid according to FHIR R4 specification
   - All mandatory Device elements must be present per base FHIR specification

#### Test Pass Criteria
- **Individual Resource Level**: Each Device resource contains a non-empty model number
- **System Level**: All Device resources in the test dataset demonstrate conformance
- **Failure Handling**: Any Device resource lacking a model number constitutes a test failure

#### Test Cases to Execute
1. **Positive Test Cases**:
   - Validate Device resources with populated model numbers
   - Verify various model number formats are accepted

2. **Negative Test Cases**:
   - Identify any Device resources missing model number fields
   - Flag Device resources with empty or null model numbers

#### Reporting Requirements
- Total number of Device resources tested
- Number of conformant vs non-conformant resources
- Detailed list of non-conformant resources with specific issues identified
- Overall pass/fail status for the requirement

---

<a id='req-053'></a>

### REQ-053: Device SHALL specify the type.

**Text**: 

**Context**: 

**Actor**: Device Manufacturer

**Conformance**: SHALL

# Test Specification for REQ-053

## 1. Requirement ID
**REQ-053**: Device SHALL specify the type.

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified through automated validation of Device resource instances to ensure the `type` element is present and properly populated.

### Complexity
**Simple** - The test involves checking for the presence and basic validation of a required field in Device resources.

### Prerequisites
- Access to Device resource instances (either existing in the system or provided by the implementer)
- FHIR server supporting Device resource reads/searches
- Valid authentication credentials if security is implemented

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Device resource instances that the implementer wishes to test for conformance
- **Test Data**: Any Device resources available in the system under test, following a "bring your own data" approach

### Expected Outputs
- Validation results indicating whether each Device resource contains a properly specified `type` element
- Clear pass/fail status for each Device resource tested
- Details of any missing or invalid `type` specifications

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and may be used:

1. **Device Resource Read**: `GET [base]/Device/[id]`
   - Retrieve specific Device resources by ID for validation
   
2. **Device Resource Search**: `GET [base]/Device?[parameters]`
   - Search for Device resources to test (if search capabilities are implemented for Device)

**Note**: The provided Capability Statement focuses on US Core Server capabilities. If Device resources are part of the implementation, standard FHIR RESTful operations would apply.

### Validation Criteria

The test SHALL verify that each Device resource instance:

#### Primary Validation
1. **Type Element Presence**: The Device resource MUST contain a `type` element
2. **Type Element Population**: The `type` element MUST NOT be empty or null

#### Detailed Validation Checks
1. **CodeableConcept Structure**: Verify that `Device.type` follows the CodeableConcept data type structure with:
   - At least one `coding` element, OR
   - A `text` element providing a human-readable description

2. **Coding Validation** (if `coding` is present):
   - `system` element should be present and contain a valid URI
   - `code` element should be present and non-empty
   - `display` element should be present (recommended)

3. **Text Validation** (if only `text` is present):
   - `text` element should be non-empty and contain meaningful device type information

#### Test Assertions for Pass/Fail
- **PASS**: Device resource contains a properly structured `type` element with either valid coding or meaningful text
- **FAIL**: Device resource is missing the `type` element, or the `type` element is empty/null
- **WARNING**: Device resource has `type` element but with suboptimal structure (e.g., missing recommended elements)

#### Response Handling
- **HTTP 200**: Successful retrieval - proceed with validation
- **HTTP 404**: Resource not found - document as unable to test specific resource
- **HTTP 401/403**: Authentication/authorization issues - resolve before testing
- **HTTP 400**: Invalid request parameters - adjust test parameters

#### Test Documentation Requirements
For each Device resource tested, document:
- Resource ID
- Validation result (Pass/Fail/Warning)
- Specific issues found (if any)
- Type information present (for verification)

This test specification ensures that Device Manufacturers comply with the requirement to specify device type while accommodating various data scenarios and following FHIR conformance testing best practices.

---

<a id='req-457'></a>

### REQ-457: US Core Implantable Device Profile implementation

**Text**: 

**Context**: System conformance to US Core Implantable Device Profile.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-457

## 1. Requirement ID
**REQ-457**: US Core Implantable Device Profile implementation

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated testing by validating Device resources against the US Core Implantable Device Profile and testing supported FHIR operations.

### Complexity
**Moderate** - Requires validation of profile conformance, testing FHIR operations, and verifying Must Support elements, but follows standard US Core testing patterns.

### Prerequisites
- System must support US Core Server capabilities as defined in the Capability Statement
- System must have Device resources representing implantable devices available for testing
- System must support JSON format (required) and optionally XML format
- Valid authentication/authorization credentials for testing
- System must implement proper security controls (HTTP 401/403/404 responses)

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Device resources that conform to the US Core Implantable Device Profile
- **System Endpoint**: Base FHIR server URL supporting US Core Server capabilities
- **Authentication**: Valid credentials/tokens as per system's security implementation
- **Test Data**: Existing Device resources in the system representing implantable devices

### Required FHIR Operations
Based on the Capability Statement, the following operations must be tested:

1. **READ Operation**: `GET [base]/Device/[id]`
2. **SEARCH Operations**: `GET [base]/Device?[parameters]`
3. **Format Support**: Test with `Accept: application/fhir+json` (required) and optionally `Accept: application/fhir+xml`

### Validation Criteria

#### Profile Conformance Validation
- **Assertion 1**: All returned Device resources SHALL validate against the US Core Implantable Device Profile
- **Assertion 2**: Resources SHALL include required elements as defined by the profile
- **Assertion 3**: Must Support elements SHALL be present when data is available
- **Assertion 4**: Resources SHOULD include `meta.profile` indicating US Core Implantable Device Profile conformance

#### FHIR Operations Testing
- **Assertion 5**: System SHALL support READ operations for Device resources (`GET [base]/Device/[id]`)
- **Assertion 6**: System SHALL support basic SEARCH operations for Device resources
- **Assertion 7**: System SHALL return JSON format when requested
- **Assertion 8**: System SHOULD return XML format when requested (if supported)

#### Response Validation
- **Assertion 9**: System SHALL return appropriate HTTP status codes:
  - 200 for successful requests
  - 400 for invalid parameters
  - 401/403 for unauthorized requests
  - 404 for unknown resources
- **Assertion 10**: All successful responses SHALL contain valid FHIR Device resources
- **Assertion 11**: Response content SHALL match requested format (JSON/XML)

#### Security and Error Handling
- **Assertion 12**: System SHALL reject unauthorized requests with appropriate HTTP status codes (401, 403, or 404)
- **Assertion 13**: System SHALL handle invalid parameters with HTTP 400 status
- **Assertion 14**: System SHALL properly validate and reject malformed requests

#### Must Support Validation
- **Assertion 15**: When Device resources contain data for Must Support elements, these elements SHALL be populated and accessible
- **Assertion 16**: System SHALL support all Must Support references to other US Core Profiles as defined in the Must Support - Resource References section

#### Data Quality and Consistency
- **Assertion 17**: Device resources representing implantable devices SHALL contain appropriate device type codes
- **Assertion 18**: Device resources SHALL maintain referential integrity for any referenced resources (Patient, etc.)
- **Assertion 19**: Returned resources SHALL be consistent across multiple requests for the same resource

### Test Execution Flow
1. Discover available Device resources through search operations
2. Select Device resources that represent implantable devices
3. Validate each resource against the US Core Implantable Device Profile
4. Test READ operations for individual Device resources
5. Test SEARCH operations with various parameters
6. Verify JSON format support (required)
7. Test XML format support (if claimed)
8. Test security and error handling scenarios
9. Validate Must Support elements and references
10. Confirm overall conformance to US Core Server capabilities

---



<a id='diagnosticreport'></a>

## DiagnosticReport

<a id='req-186'></a>

### REQ-186: The system shall ensure the DiagnosticReport status is set to "Final".

**Text**: 

**Context**: 

**Actor**: DiagnosticReport system

**Conformance**: SHALL

# Test Specification for REQ-186

## 1. Requirement ID
**REQ-186**: The system shall ensure the DiagnosticReport status is set to "Final".

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Automatically testable

This requirement can be automatically validated by examining the `status` field of DiagnosticReport resources. The requirement is specific and measurable - it explicitly states that the status must be set to "final".

### Complexity
**Level**: Simple

This is a straightforward field validation test that requires checking a single required element against a specific expected value.

### Prerequisites
- System must support DiagnosticReport resources per US Core Server CapabilityStatement
- System must have DiagnosticReport resources available for testing (bring your own data approach)
- Test client must have appropriate access permissions to read DiagnosticReport resources

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources**:
- One or more DiagnosticReport resources accessible through the system under test
- Resources should represent chest x-ray reports based on the source context (DiagnosticReport-chest-xray-report.md)

**Expected Outputs**:
- DiagnosticReport resources with `status` field set to "final"
- HTTP 200 OK responses for successful resource retrieval

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are supported and required for testing:

1. **GET [base]/DiagnosticReport/[id]** - Read specific DiagnosticReport resources
2. **GET [base]/DiagnosticReport** - Search for DiagnosticReport resources using supported search parameters

### Validation Criteria

**Primary Assertion**:
- The `DiagnosticReport.status` field MUST be present and set to "final"

**Specific Checks**:
1. **Field Presence**: Verify that the `status` element exists in each DiagnosticReport resource
2. **Value Validation**: Confirm that `DiagnosticReport.status` equals "final" (case-sensitive)
3. **Data Type Compliance**: Ensure the status value conforms to the DiagnosticReportStatus value set

**Test Execution Flow**:
1. Retrieve DiagnosticReport resources from the system using supported read/search operations
2. For each DiagnosticReport resource returned:
   - Assert that `status` field is present
   - Assert that `status` value equals "final"
   - Log any resources that fail this validation

**Pass Criteria**:
- All DiagnosticReport resources retrieved from the system have their status field set to "final"
- No HTTP errors occur during resource retrieval operations

**Fail Criteria**:
- Any DiagnosticReport resource has a status other than "final"
- Any DiagnosticReport resource is missing the status field
- System returns HTTP errors preventing resource access

**Test Scope Note**:
This test focuses on conformance validation of existing data rather than testing system behavior under various conditions. The test assumes that DiagnosticReport resources represent finalized reports, which aligns with the requirement's context of ensuring reports have reached their final state.

---

<a id='req-207'></a>

### REQ-207: DXA Bone density measurement report shall include specific measurement details.

**Text**: 

**Context**: 

**Actor**: DiagnosticReport system

**Conformance**: SHALL

# Test Specification for REQ-207

## 1. Requirement ID
REQ-207

## 2. Requirement Analysis

### Testability Assessment
**Not Testable** - The requirement is too vague to create a meaningful conformance test. The requirement states that "DXA Bone density measurement report shall include specific measurement details" but does not define:
- What constitutes "specific measurement details"
- Which FHIR elements or profiles must be present
- The structure or format of these details
- Minimum required data elements

This requirement would need to be refined with explicit FHIR profile requirements, mandatory elements, or reference to specific implementation guide constraints to be testable.

### Complexity
**N/A** - Cannot be assessed due to vague requirement specification

### Prerequisites
**N/A** - Cannot be determined without specific implementation requirements

## 3. Test Implementation Strategy

### Required Inputs
Cannot be specified without clearer requirement definition. Would typically need:
- DiagnosticReport resources with category indicating bone density studies
- Associated Observation resources containing measurement data
- Clear specification of which measurement details are required

### Required FHIR Operations
Based on the US Core Server Capability Statement, the following operations would likely be relevant once the requirement is clarified:
- `GET /DiagnosticReport` - Read DiagnosticReport resources
- `GET /DiagnosticReport?patient=[id]` - Search for patient's diagnostic reports
- `GET /DiagnosticReport?category=[bone-density-category]` - Search for bone density reports
- `GET /Observation` - Read associated Observation resources

### Validation Criteria
Cannot be defined without specific measurement detail requirements. Would need clarification on:
- Required FHIR elements that must be populated
- Specific measurement types that must be included
- Value ranges or formats that constitute valid measurements
- Required terminology bindings

## Recommendation

This requirement needs to be enhanced with specific implementation details before a meaningful conformance test can be developed. The requirement should specify:

1. **FHIR Profile Requirements**: Reference to specific DiagnosticReport profile for bone density
2. **Mandatory Elements**: List of required FHIR elements (e.g., `DiagnosticReport.result`, specific `Observation.code` values)
3. **Measurement Specifications**: Define what constitutes "specific measurement details" (T-scores, Z-scores, BMD values, etc.)
4. **Terminology Requirements**: Required code systems and value sets for bone density measurements
5. **Cardinality Constraints**: Minimum number of measurements or observations required

Without these specifications, any test would be subjective and not suitable for interoperability conformance testing.

---

<a id='req-270'></a>

### REQ-270: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport identifier to the Event.identifier.

**Text**: 

**Context**: 

**Actor**: USCoreDiagnosticReportProfileLaboratoryReporting

**Conformance**: SHALL

# Test Specification for REQ-270

## 1. Requirement ID
REQ-270

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated testing by examining the mapping between DiagnosticReport.identifier and Event.identifier in US Core DiagnosticReport Profile for Laboratory Reporting instances.

### Complexity
**Simple** - This is a straightforward field mapping verification that requires checking the presence and correct mapping of identifier fields.

### Prerequisites
- System must support US Core DiagnosticReport Profile for Laboratory Results Reporting
- System must have DiagnosticReport resources that implement laboratory reporting use cases
- Test data must include DiagnosticReport resources with populated identifier fields
- Access to FHIR server supporting DiagnosticReport read operations

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: 
  - DiagnosticReport resources conforming to US Core DiagnosticReport Profile for Laboratory Results Reporting (http://hl7.org/fhir/us/core/StructureDefinition/us-core-diagnosticreport-lab)
  - Resources must have populated `identifier` elements

- **Expected Outputs**:
  - Verification that DiagnosticReport.identifier elements are properly mapped to Event.identifier pattern
  - Confirmation that identifier values follow the Event workflow pattern mapping requirements

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required:

1. **DiagnosticReport Read Operations**:
   - `GET [base]/DiagnosticReport/{id}` - Read specific DiagnosticReport instances
   - `GET [base]/DiagnosticReport?patient={patient-id}` - Search for DiagnosticReport by patient
   - `GET [base]/DiagnosticReport?category={category}` - Search for laboratory DiagnosticReports by category
   - `GET [base]/DiagnosticReport?patient={patient-id}&category={category}` - Combined patient and category search

### Validation Criteria

The following assertions must pass to indicate test conformance:

1. **Profile Conformance**:
   - Verify DiagnosticReport resource conforms to US Core DiagnosticReport Profile for Laboratory Results Reporting
   - Resource must validate against the profile: `http://hl7.org/fhir/us/core/StructureDefinition/us-core-diagnosticreport-lab`

2. **Identifier Mapping Verification**:
   - Confirm that `DiagnosticReport.identifier` element is present when the resource represents a laboratory report
   - Verify that the identifier structure follows Event.identifier pattern requirements:
     - Each identifier has appropriate `system` and `value` elements
     - Identifier values are unique and meaningful within their system context
     - Type coding is appropriate for laboratory diagnostic reports

3. **Workflow Pattern Compliance**:
   - Validate that identifier mapping supports the Event workflow pattern
   - Ensure identifier can be used to track the diagnostic report through its lifecycle
   - Verify identifier persistence across different system interactions

4. **Data Quality Checks**:
   - Identifier system URLs are valid and resolvable where applicable
   - Identifier values are non-empty and follow expected format patterns
   - Multiple identifiers (if present) have distinct system values

5. **Test Scenarios**:
   - **Scenario 1**: Retrieve DiagnosticReport resources and verify identifier presence
   - **Scenario 2**: Validate identifier structure matches Event.identifier pattern
   - **Scenario 3**: Cross-reference identifiers with related resources to ensure consistency
   - **Scenario 4**: Verify identifier uniqueness within the same system context

**Pass Criteria**: All DiagnosticReport resources conforming to the US Core Laboratory Results profile must have properly structured identifier elements that map correctly to the Event.identifier pattern, enabling proper workflow tracking and resource identification.

**Fail Criteria**: 
- DiagnosticReport resources missing required identifier elements
- Identifier structures that don't conform to Event.identifier pattern
- Invalid or malformed identifier system/value pairs
- Identifier values that cannot support proper workflow pattern implementation

---

<a id='req-271'></a>

### REQ-271: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport status to the Event.status.

**Text**: 

**Context**: 

**Actor**: USCoreDiagnosticReportProfileLaboratoryReporting

**Conformance**: SHALL

# Test Specification for REQ-271

## Requirement ID
REQ-271

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated through automated inspection of DiagnosticReport resources to verify that the status field mapping conforms to the Event.status pattern as defined in the FHIR specification.

### Complexity
**Simple** - This is a straightforward field mapping verification that requires checking a single element (DiagnosticReport.status) against the expected Event.status value set.

### Prerequisites
- US Core Server implementation supporting DiagnosticReport resources
- DiagnosticReport resources conforming to US Core DiagnosticReport Profile for Laboratory Results Reporting
- Access to DiagnosticReport resources via FHIR API

## Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- DiagnosticReport resources that claim conformance to US Core DiagnosticReport Profile for Laboratory Results Reporting (`http://hl7.org/fhir/us/core/StructureDefinition/us-core-diagnosticreport-lab`)

**Expected Outputs:**
- Validation results indicating whether each DiagnosticReport.status value is valid according to the Event.status value set
- List of any non-conformant DiagnosticReport resources with specific status validation errors

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required:

1. **GET /DiagnosticReport** - Retrieve DiagnosticReport resources
2. **GET /DiagnosticReport?patient=[id]** - Search for DiagnosticReport resources by patient
3. **GET /DiagnosticReport?category=[code]** - Search for DiagnosticReport resources by category
4. **GET /DiagnosticReport?status=[code]** - Search for DiagnosticReport resources by status

### Validation Criteria

**Primary Assertion:**
- Each DiagnosticReport resource that claims conformance to the US Core DiagnosticReport Profile for Laboratory Results Reporting SHALL have a `status` element that contains a value from the Event.status value set

**Specific Validation Checks:**

1. **Status Element Presence:**
   - Verify that `DiagnosticReport.status` element is present and not null
   - PASS: Status element exists with a value
   - FAIL: Status element is missing or null

2. **Status Value Validation:**
   - Verify that `DiagnosticReport.status` contains one of the valid Event.status codes:
     - `preliminary`
     - `final`
     - `amended`
     - `corrected`
     - `appended`
     - `cancelled`
     - `entered-in-error`
     - `unknown`
   - PASS: Status value is one of the valid Event.status codes
   - FAIL: Status value is not from the Event.status value set

3. **Profile Conformance Check:**
   - Verify that the DiagnosticReport resource declares conformance to `http://hl7.org/fhir/us/core/StructureDefinition/us-core-diagnosticreport-lab` in `meta.profile`
   - Only apply status mapping validation to resources that claim this profile conformance

**Test Execution Approach:**
1. Retrieve DiagnosticReport resources using supported search parameters
2. Filter resources to only those claiming conformance to the US Core Laboratory DiagnosticReport profile
3. For each conformant resource, validate the status element against Event.status value set
4. Report any resources with invalid or missing status values
5. Calculate conformance percentage based on valid vs. total resources tested

**Success Criteria:**
- 100% of DiagnosticReport resources claiming conformance to the US Core DiagnosticReport Profile for Laboratory Results Reporting have valid Event.status values in their status element
- No DiagnosticReport resources have missing or invalid status values

---

<a id='req-272'></a>

### REQ-272: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport code to the Event.code.

**Text**: 

**Context**: 

**Actor**: USCoreDiagnosticReportProfileLaboratoryReporting

**Conformance**: SHALL

# Test Specification for REQ-272

## Requirement ID
REQ-272

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated programmatically by examining FHIR DiagnosticReport resources that conform to the USCoreDiagnosticReportProfileLaboratoryReporting profile and verifying the mapping between DiagnosticReport.code and Event.code elements.

### Complexity
**Simple** - This is a straightforward mapping validation that requires checking the presence and consistency of code elements between two FHIR resource fields.

### Prerequisites
- System must support US Core DiagnosticReport Profile for Laboratory Reporting
- System must have DiagnosticReport resources available that conform to the USCoreDiagnosticReportProfileLaboratoryReporting profile
- Test data should include DiagnosticReport resources with populated code elements
- Access to FHIR server implementing US Core Server CapabilityStatement

## Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- DiagnosticReport resources conforming to USCoreDiagnosticReportProfileLaboratoryReporting profile
- Resources must contain populated `code` elements

**Expected Outputs:**
- Validation results confirming that DiagnosticReport.code correctly maps to Event.code
- Confirmation that the mapping follows the Workflow Pattern specifications

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are supported and required for testing:

1. **GET /DiagnosticReport** - Retrieve DiagnosticReport resources
2. **GET /DiagnosticReport/[id]** - Retrieve specific DiagnosticReport by ID
3. **GET /DiagnosticReport?patient=[reference]** - Search DiagnosticReports by patient (if testing patient-specific data)

### Validation Criteria

**Primary Assertions:**
1. **Code Element Presence**: Verify that DiagnosticReport.code is present and populated in resources conforming to USCoreDiagnosticReportProfileLaboratoryReporting
2. **Event.code Mapping**: Confirm that DiagnosticReport.code correctly maps to Event.code according to the Workflow Pattern mapping specifications
3. **Code System Consistency**: Validate that the coding system and values used in DiagnosticReport.code are appropriate for Event.code mapping
4. **Profile Conformance**: Ensure tested DiagnosticReport resources declare conformance to USCoreDiagnosticReportProfileLaboratoryReporting profile

**Specific Test Cases:**

**Test Case 1: Basic Code Mapping Validation**
- Retrieve DiagnosticReport resources conforming to the laboratory reporting profile
- For each resource, verify DiagnosticReport.code exists and contains valid coding information
- Confirm the code can be appropriately mapped to Event.code structure
- **Pass Criteria**: All DiagnosticReport resources have properly populated code elements that can be mapped to Event.code

**Test Case 2: Code System Validation**
- Examine the coding system(s) used in DiagnosticReport.code
- Verify the code systems are appropriate for laboratory reporting contexts
- Ensure codes are from recognized terminologies (e.g., LOINC for laboratory procedures)
- **Pass Criteria**: DiagnosticReport.code uses appropriate and valid coding systems suitable for Event.code mapping

**Test Case 3: Workflow Pattern Compliance**
- Validate that the mapping from DiagnosticReport.code to Event.code follows the established Workflow Pattern
- Check that semantic meaning is preserved in the mapping
- **Pass Criteria**: The mapping maintains semantic integrity and follows Workflow Pattern specifications

**Overall Test Success Criteria:**
- All DiagnosticReport resources conforming to USCoreDiagnosticReportProfileLaboratoryReporting have populated code elements
- The code elements can be successfully mapped to Event.code without loss of semantic meaning
- The mapping follows the specified Workflow Pattern requirements
- No validation errors occur during the mapping process

---

<a id='req-273'></a>

### REQ-273: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport subject to the Event.subject.

**Text**: 

**Context**: 

**Actor**: USCoreDiagnosticReportProfileLaboratoryReporting

**Conformance**: SHALL

# Test Specification for REQ-273

## 1. Requirement ID
**REQ-273**: USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport subject to the Event.subject

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified programmatically by examining DiagnosticReport resources to ensure the subject field correctly maps to Event.subject according to the Workflow Pattern mapping.

### Complexity
**Simple** - This is a straightforward mapping verification that requires checking the presence and structure of the subject field in DiagnosticReport resources.

### Prerequisites
- System must support the US Core DiagnosticReport Profile for Laboratory Results Reporting
- System must have DiagnosticReport resources available for testing
- System must implement the US Core Server CapabilityStatement with DiagnosticReport support
- Test data should include DiagnosticReport resources that conform to the US Core DiagnosticReport Profile for Laboratory Results Reporting

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- DiagnosticReport resources conforming to the US Core DiagnosticReport Profile for Laboratory Results Reporting (http://hl7.org/fhir/us/core/StructureDefinition/us-core-diagnosticreport-lab)
- Referenced Patient resources (as targets of the subject field)

**Expected Outputs:**
- Validation results confirming proper subject mapping
- Verification that subject references are valid Patient resources

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are supported and required for testing:

1. **GET /DiagnosticReport** - Retrieve DiagnosticReport resources
2. **GET /DiagnosticReport?patient=[id]** - Search for DiagnosticReports by patient
3. **GET /DiagnosticReport?category=[code]** - Search for DiagnosticReports by category
4. **GET /Patient/[id]** - Retrieve referenced Patient resources for validation

### Validation Criteria

The test SHALL verify the following assertions for each DiagnosticReport resource:

#### Primary Validation Criteria:
1. **Subject Field Presence**: The DiagnosticReport.subject field MUST be present
2. **Subject Field Population**: The DiagnosticReport.subject field MUST contain a valid reference
3. **Reference Type Validation**: The subject reference MUST point to a Patient resource
4. **Reference Resolvability**: The referenced Patient resource MUST be retrievable and valid
5. **Workflow Pattern Compliance**: The subject mapping MUST align with the Event.subject pattern as specified in the Workflow Pattern mapping

#### Specific Test Assertions:
- **Assert**: `DiagnosticReport.subject` is not null or empty
- **Assert**: `DiagnosticReport.subject.reference` follows valid FHIR reference format
- **Assert**: Referenced resource type is "Patient" (either explicit in reference or resolved resource)
- **Assert**: GET request to the subject reference returns a valid Patient resource
- **Assert**: The Patient resource conforms to US Core Patient Profile requirements

#### Test Pass Criteria:
- All DiagnosticReport resources in the test dataset have properly populated subject fields
- All subject references resolve to valid, accessible Patient resources
- No validation errors are encountered when verifying the subject mappings
- The mapping demonstrates proper implementation of the Event.subject pattern

#### Test Fail Criteria:
- Any DiagnosticReport resource lacks a subject field
- Any subject reference is malformed or unresolvable
- Any subject reference points to a non-Patient resource
- Any referenced Patient resource is invalid or inaccessible

### Implementation Notes:
- Tests should be designed to work with any conforming test dataset
- Validation should include both structural checks (field presence, format) and semantic checks (reference resolution, resource validity)
- Consider testing with various patient reference formats (relative, absolute, contained) as supported by the implementation

---

<a id='req-274'></a>

### REQ-274: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport encounter to the Event.encounter.

**Text**: 

**Context**: 

**Actor**: USCoreDiagnosticReportProfileLaboratoryReporting

**Conformance**: SHALL

# Test Specification for REQ-274

## 1. Requirement ID
**REQ-274**: USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport encounter to the Event.encounter

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated programmatically by examining the structure and mapping of DiagnosticReport resources to verify that the encounter field properly maps to Event.encounter according to the Workflow Pattern.

### Complexity
**Simple** - This is a straightforward mapping validation that requires checking the presence and proper referencing of the encounter element in DiagnosticReport resources.

### Prerequisites
- System must support US Core DiagnosticReport Profile for Laboratory Results Reporting
- System must have DiagnosticReport resources with encounter references available
- System must support RESTful FHIR operations for DiagnosticReport retrieval
- Test data should include DiagnosticReport resources that reference Encounter resources

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- DiagnosticReport resources conforming to US Core DiagnosticReport Profile for Laboratory Results Reporting
- Associated Encounter resources referenced by the DiagnosticReport resources
- Patient resources associated with the DiagnosticReport and Encounter resources

**Expected Outputs:**
- Validation that DiagnosticReport.encounter properly references Encounter resources
- Confirmation that the encounter mapping follows the Event.encounter pattern from the Workflow Pattern specification

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required:

1. **GET /DiagnosticReport** - Retrieve DiagnosticReport resources
   - Supported search parameters: category, code, date, _lastUpdated, patient, status
   - Use patient-based searches to retrieve relevant DiagnosticReport resources

2. **GET /Encounter** - Retrieve referenced Encounter resources  
   - Supported search parameters: _id, class, date, _lastUpdated, discharge-disposition, identifier, location, patient, status, type
   - Use _id parameter to retrieve specific Encounter resources referenced by DiagnosticReport

3. **GET /Patient** - Retrieve associated Patient resources
   - Supported search parameters: _id, birthdate, death-date, family, given, identifier, name

### Validation Criteria

**Primary Assertions:**

1. **Encounter Reference Presence**
   - Verify that DiagnosticReport resources conforming to US Core DiagnosticReport Profile for Laboratory Results Reporting contain an `encounter` element when an encounter context exists
   - Assert that `DiagnosticReport.encounter` is present and properly formatted as a Reference

2. **Reference Validity**
   - Validate that `DiagnosticReport.encounter.reference` contains a valid reference to an Encounter resource
   - Verify the reference follows FHIR reference format (e.g., "Encounter/[id]" or absolute URL)
   - Confirm that the referenced Encounter resource exists and is accessible

3. **Workflow Pattern Mapping Compliance**
   - Verify that the DiagnosticReport.encounter field correctly implements the Event.encounter mapping from the Workflow Pattern
   - Ensure the encounter reference provides appropriate context linking the diagnostic report to the healthcare encounter during which it was ordered or performed

4. **Profile Conformance**
   - Validate that DiagnosticReport resources claiming conformance to US Core DiagnosticReport Profile for Laboratory Results Reporting properly implement the encounter mapping
   - Verify that the encounter reference is consistent with the profile's requirements and cardinality constraints

**Test Execution Steps:**

1. Query for DiagnosticReport resources using patient-based searches
2. For each DiagnosticReport resource that conforms to the Laboratory Results Reporting profile:
   - Check for presence of encounter element
   - Validate the encounter reference format
   - Retrieve the referenced Encounter resource to confirm its existence
   - Verify the encounter reference provides appropriate clinical context
3. Document any instances where the encounter mapping is missing or incorrectly implemented

**Pass Criteria:**
- All DiagnosticReport resources conforming to US Core DiagnosticReport Profile for Laboratory Results Reporting that have encounter context properly map DiagnosticReport.encounter to Event.encounter
- All encounter references are valid and resolvable
- The mapping follows the specified Workflow Pattern requirements

**Fail Criteria:**
- DiagnosticReport resources missing required encounter references when encounter context exists
- Invalid or unresolvable encounter references
- Encounter mapping that does not conform to the Event.encounter pattern from the Workflow Pattern specification

---

<a id='req-275'></a>

### REQ-275: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport effective[x] to the Event.occurrence[x].

**Text**: 

**Context**: 

**Actor**: USCoreDiagnosticReportProfileLaboratoryReporting

**Conformance**: SHALL

# Test Specification for REQ-275

## 1. Requirement ID
REQ-275

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified by examining DiagnosticReport resources that conform to the USCoreDiagnosticReportProfileLaboratoryReporting and checking that the `effective[x]` element is properly mapped to the Event.occurrence[x] pattern from the Workflow Pattern.

### Complexity
**Simple** - This is a straightforward mapping verification that requires checking the presence and proper use of the `effective[x]` element in DiagnosticReport resources.

### Prerequisites
- System must support the US Core DiagnosticReport Profile for Laboratory Results Reporting
- System must have DiagnosticReport resources available for testing
- System must support read operations on DiagnosticReport resources

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: DiagnosticReport resources that conform to the US Core DiagnosticReport Profile for Laboratory Results Reporting (StructureDefinition-us-core-diagnosticreport-lab.html)
- **Test Data**: Any existing DiagnosticReport resources with laboratory results in the test system

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required for testing:
- `GET [base]/DiagnosticReport/[id]` - Read specific DiagnosticReport resources
- `GET [base]/DiagnosticReport?patient=[patient-id]&category=LAB` - Search for laboratory DiagnosticReport resources

### Validation Criteria

#### Test Case 1: Verify effective[x] Element Presence and Usage
**Objective**: Confirm that DiagnosticReport resources conforming to USCoreDiagnosticReportProfileLaboratoryReporting include the effective[x] element as required by the Event.occurrence[x] mapping.

**Test Steps**:
1. Retrieve DiagnosticReport resources that conform to the US Core Laboratory Results profile
2. For each DiagnosticReport resource, verify the presence of one of the following effective[x] variants:
   - `effectiveDateTime`
   - `effectivePeriod`
   - `effectiveTiming`
   - `effectiveInstant`

**Pass Criteria**:
- All DiagnosticReport resources conforming to USCoreDiagnosticReportProfileLaboratoryReporting must have exactly one effective[x] element populated
- The effective[x] element must contain a valid date/time value appropriate for the chosen data type
- The element must represent when the diagnostic report's results were observed or collected

#### Test Case 2: Validate effective[x] Data Type Conformance
**Objective**: Ensure the effective[x] element uses appropriate FHIR data types and follows the Event.occurrence[x] pattern specification.

**Test Steps**:
1. For each DiagnosticReport resource with an effective[x] element:
   - Validate that only one variant of effective[x] is present
   - Verify the data type matches FHIR specifications (dateTime, Period, Timing, or instant)
   - Confirm the value is properly formatted according to FHIR standards

**Pass Criteria**:
- Only one effective[x] variant is present per DiagnosticReport
- The chosen data type is valid for representing when the diagnostic results occurred
- Values conform to FHIR data type formatting requirements

#### Test Case 3: Workflow Pattern Mapping Verification
**Objective**: Confirm that the effective[x] element properly represents the Event.occurrence[x] concept from the Workflow Pattern.

**Test Steps**:
1. Examine DiagnosticReport resources to ensure effective[x] represents:
   - The time when the laboratory test was performed, or
   - The time period over which the laboratory results apply, or
   - The specific timing pattern for the diagnostic event

**Pass Criteria**:
- The effective[x] value logically represents when the diagnostic event occurred
- The timing information is clinically meaningful and appropriate for laboratory results
- The mapping supports the workflow pattern's requirement for occurrence timing

#### Negative Test Case: Missing effective[x] Element
**Objective**: Verify that DiagnosticReport resources without effective[x] elements are identified as non-conformant.

**Test Steps**:
1. Identify any DiagnosticReport resources claiming conformance to USCoreDiagnosticReportProfileLaboratoryReporting that lack effective[x] elements
2. Verify these resources are flagged as non-conformant

**Pass Criteria**:
- Resources missing the effective[x] element are identified as failing conformance
- Appropriate error messages or validation failures are generated

### Expected Outputs
- **Conformant Resources**: DiagnosticReport resources with properly populated effective[x] elements that map to Event.occurrence[x]
- **Validation Results**: Clear pass/fail status for each tested DiagnosticReport resource
- **Error Reports**: Detailed information about any non-conformant resources, including missing or improperly formatted effective[x] elements

---

<a id='req-276'></a>

### REQ-276: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport performer to the Event.performer.actor.

**Text**: 

**Context**: 

**Actor**: USCoreDiagnosticReportProfileLaboratoryReporting

**Conformance**: SHALL

# Test Specification for REQ-276

## 1. Requirement ID
REQ-276

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated by analyzing the structure and content of DiagnosticReport resources to verify proper mapping of the performer element to Event.performer.actor according to the Workflow Pattern mapping specification.

### Complexity
**Simple** - The test involves straightforward validation of FHIR element mapping and structure verification within a single resource type.

### Prerequisites
- Test system must support US Core DiagnosticReport Profile for Laboratory Results Reporting
- Test data must include DiagnosticReport resources with populated performer elements
- Access to FHIR server implementing US Core Server CapabilityStatement with DiagnosticReport support
- Understanding of FHIR Workflow Pattern Event mapping requirements

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: DiagnosticReport resources conforming to US Core DiagnosticReport Profile for Laboratory Results Reporting (StructureDefinition-us-core-diagnosticreport-lab.html)
- **Data Requirements**: DiagnosticReport instances with performer elements populated
- **System Under Test**: FHIR server implementing US Core Server capabilities with DiagnosticReport resource support

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported:
- **GET /DiagnosticReport/{id}** - Retrieve specific DiagnosticReport instances
- **GET /DiagnosticReport?patient={patient-id}** - Search for DiagnosticReport by patient
- **GET /DiagnosticReport?category={category}** - Search for DiagnosticReport by category
- **GET /DiagnosticReport?patient={patient-id}&category={category}** - Combined search parameters

### Validation Criteria

The test SHALL verify the following assertions to indicate passing:

#### Core Mapping Validation
1. **Performer Element Presence**: When a DiagnosticReport.performer element exists, verify it is properly structured and populated
2. **Event.performer.actor Mapping**: Validate that the DiagnosticReport.performer element correctly maps to Event.performer.actor as defined in the Workflow Pattern
3. **Reference Integrity**: Confirm that performer references point to valid FHIR resources (Practitioner, PractitionerRole, Organization, CareTeam, Patient, Device, or RelatedPerson)

#### Specific Test Cases
1. **Test Case 1: Single Performer Mapping**
   - Retrieve DiagnosticReport with single performer
   - Assert performer element contains valid reference
   - Verify reference resolves to appropriate resource type
   - Confirm mapping follows Event.performer.actor pattern

2. **Test Case 2: Multiple Performers Mapping**
   - Retrieve DiagnosticReport with multiple performers
   - Assert each performer element is properly structured
   - Verify all references are valid and resolvable
   - Confirm array mapping maintains Event.performer.actor pattern

3. **Test Case 3: Cross-Reference Validation**
   - For each performer reference, attempt to resolve the referenced resource
   - Verify referenced resource exists and is accessible
   - Confirm resource type is appropriate for performer role

#### Success Criteria
A test passes when:
- All DiagnosticReport.performer elements properly reference valid FHIR resources
- The mapping structure aligns with Event.performer.actor pattern requirements
- Referenced performer resources are resolvable and contain expected data elements
- No validation errors are returned when processing the performer mappings

#### Failure Indicators
A test fails when:
- DiagnosticReport.performer elements contain invalid or unresolvable references
- The mapping does not conform to Event.performer.actor pattern
- Referenced resources cannot be retrieved or are of inappropriate types
- FHIR validation errors occur when processing performer elements

---

<a id='req-277'></a>

### REQ-277: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport resultsInterpreter to the Event.performer.actor.

**Text**: 

**Context**: 

**Actor**: USCoreDiagnosticReportProfileLaboratoryReporting

**Conformance**: SHALL

# Test Specification for REQ-277

## 1. Requirement ID
**REQ-277**: USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport resultsInterpreter to the Event.performer.actor

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified programmatically by examining the mapping between DiagnosticReport.resultsInterpreter and Event.performer.actor fields in laboratory reporting profiles.

### Complexity
**Simple** - This is a straightforward field mapping verification that requires checking the presence and correct mapping of specific FHIR elements.

### Prerequisites
- System must support US Core DiagnosticReport Profile for Laboratory Results Reporting
- Test system must have DiagnosticReport resources with resultsInterpreter populated
- Access to DiagnosticReport resources via FHIR API
- Understanding of the Workflow Pattern Event mapping requirements

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- DiagnosticReport resources conforming to US Core DiagnosticReport Profile for Laboratory Results Reporting
- Resources should have `resultsInterpreter` element populated with valid references

**Expected Outputs:**
- Verification that DiagnosticReport.resultsInterpreter correctly maps to Event.performer.actor
- Confirmation that the mapping maintains referential integrity and semantic meaning

### Required FHIR Operations
Based on the Capability Statement, the following supported operations will be used:

1. **GET /DiagnosticReport** - Retrieve DiagnosticReport resources
   - Supported search parameters from Capability Statement:
     - `patient` (to scope results to specific patients)
     - `category` (to filter for laboratory reports)
     - `status` (to filter for specific report statuses)

2. **GET /DiagnosticReport/[id]** - Retrieve specific DiagnosticReport instances for detailed analysis

### Validation Criteria

The test shall verify the following assertions for each DiagnosticReport resource:

#### Primary Validation Checks:
1. **Mapping Presence Verification:**
   - If `DiagnosticReport.resultsInterpreter` is present, verify it correctly represents the Event.performer.actor according to the Workflow Pattern mapping
   - Confirm that the resultsInterpreter reference resolves to appropriate practitioner resources (Practitioner, PractitionerRole, or Organization)

2. **Reference Integrity Validation:**
   - Validate that `DiagnosticReport.resultsInterpreter` contains valid FHIR references
   - Verify referenced resources exist and are accessible
   - Confirm referenced resources conform to appropriate US Core profiles (US Core Practitioner, US Core PractitionerRole, or US Core Organization)

3. **Semantic Mapping Accuracy:**
   - Verify that the resultsInterpreter represents the actor responsible for interpreting the diagnostic results
   - Confirm the mapping aligns with the Event.performer.actor semantic meaning in the Workflow Pattern

#### Test Execution Steps:
1. **Resource Discovery:**
   - Query for DiagnosticReport resources using category search parameter to identify laboratory reports
   - Filter results to include only resources conforming to US Core DiagnosticReport Profile for Laboratory Results Reporting

2. **Mapping Validation:**
   - For each DiagnosticReport resource found:
     - Examine the `resultsInterpreter` element
     - Validate the reference format and target resource type
     - Verify the referenced resource exists and is accessible
     - Confirm the semantic alignment with Event.performer.actor requirements

3. **Conformance Verification:**
   - Validate that the mapping implementation satisfies the SHALL conformance requirement
   - Document any instances where the mapping is absent or incorrect
   - Verify that the implementation follows US Core and base FHIR specifications

#### Pass/Fail Criteria:
- **PASS:** All DiagnosticReport resources with resultsInterpreter elements correctly map to Event.performer.actor with valid references and proper semantic alignment
- **FAIL:** Any DiagnosticReport resource fails to properly implement the required mapping or contains invalid references

#### Edge Cases to Consider:
- DiagnosticReport resources without resultsInterpreter (should not fail the test as the element may be optional)
- Multiple resultsInterpreter references in a single DiagnosticReport
- Different types of referenced resources (Practitioner vs PractitionerRole vs Organization)

---

<a id='req-278'></a>

### REQ-278: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport identifier to OBR-51 for globally unique filler ID.

**Text**: 

**Context**: 

**Actor**: USCoreDiagnosticReportProfileLaboratoryReporting

**Conformance**: SHALL

# Test Specification for REQ-278

## Requirement ID
REQ-278

## Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be automatically verified by examining the mapping between FHIR DiagnosticReport.identifier and HL7 v2 OBR-51 field in the implementation's mapping documentation or transformation logic.

### Complexity
**Moderate** - Requires validation of specific field mapping between FHIR and HL7 v2 formats, which involves understanding both data models and their transformation logic.

### Prerequisites
- System implementing USCoreDiagnosticReportProfileLaboratoryReporting profile
- HL7 v2 to FHIR transformation capability or documented mapping specifications
- Access to DiagnosticReport resources conforming to US Core Laboratory Results Reporting profile
- Documentation or configuration showing the mapping between FHIR and HL7 v2 fields

## Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- DiagnosticReport resources conforming to `US Core DiagnosticReport Profile for Laboratory Results Reporting` (StructureDefinition-us-core-diagnosticreport-lab.html)
- DiagnosticReport resources must contain populated `identifier` elements with globally unique values

**Expected Outputs:**
- HL7 v2 OBR segments with populated OBR-51 (Filler Order Number) field
- Mapping documentation or transformation logs showing the correspondence between DiagnosticReport.identifier and OBR-51

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and may be used:

**DiagnosticReport Resource Operations:**
- `GET /DiagnosticReport?patient={id}` - Retrieve DiagnosticReport resources for testing
- `GET /DiagnosticReport?category=LAB` - Retrieve laboratory DiagnosticReports
- `GET /DiagnosticReport/{id}` - Retrieve specific DiagnosticReport by ID

**Additional Search Parameters (as supported):**
- `GET /DiagnosticReport?patient={id}&category=LAB&status=final`
- `GET /DiagnosticReport?patient={id}&code={lab-code}`

### Validation Criteria

**Primary Validation Checks:**

1. **Identifier Presence Validation:**
   - Verify that DiagnosticReport resources contain at least one `identifier` element
   - Confirm identifiers are globally unique (contain system and value components)

2. **Mapping Correspondence Validation:**
   - Verify that each DiagnosticReport.identifier value maps to the corresponding OBR-51 field in HL7 v2 output
   - Confirm that the identifier system and value are preserved in the OBR-51 field according to HL7 v2 specifications

3. **Filler Order Number Validation:**
   - Verify OBR-51 contains the globally unique filler identifier from DiagnosticReport.identifier
   - Confirm OBR-51 format complies with HL7 v2 data type requirements (typically Encoded Identifier - EI)

4. **Profile Conformance Validation:**
   - Verify DiagnosticReport resources conform to US Core DiagnosticReport Profile for Laboratory Results Reporting
   - Validate that the category includes laboratory-related codes (e.g., "LAB")

**Test Assertions for Passing:**

✅ **PASS Criteria:**
- DiagnosticReport.identifier values are successfully mapped to OBR-51 field
- OBR-51 contains globally unique filler identifier matching DiagnosticReport.identifier
- Mapping preserves identifier uniqueness and traceability
- No loss of identifier information during transformation
- HL7 v2 output validates against OBR segment specifications

❌ **FAIL Criteria:**
- DiagnosticReport.identifier is not mapped to OBR-51
- OBR-51 contains different or missing identifier values
- Mapping loses identifier system or value information
- OBR-51 field is empty when DiagnosticReport.identifier is present
- HL7 v2 output does not conform to OBR segment specifications

**Additional Validation Notes:**
- Test should accommodate various identifier systems (e.g., facility-specific, national identifiers)
- Validation should work with laboratory DiagnosticReports regardless of specific test types
- Test should verify bidirectional consistency if reverse mapping (HL7 v2 to FHIR) is also implemented

---

<a id='req-279'></a>

### REQ-279: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport identifier to a combination of OBR-2, OBR-3, and OBR-4 for non-globally unique filler-id.

**Text**: 

**Context**: 

**Actor**: USCoreDiagnosticReportProfileLaboratoryReporting

**Conformance**: SHALL

# Test Specification for REQ-279

## 1. Requirement ID
**REQ-279**: USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport identifier to a combination of OBR-2, OBR-3, and OBR-4 for non-globally unique filler-id.

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Attestation

**Rationale**: This requirement specifies a mapping rule between FHIR DiagnosticReport.identifier and HL7 v2 OBR segment fields (OBR-2: Placer Order Number, OBR-3: Filler Order Number, OBR-4: Universal Service Identifier). This is an implementation-level mapping concern that cannot be automatically tested through FHIR API interactions alone, as it requires knowledge of the underlying HL7 v2 to FHIR transformation logic.

### Complexity
**Moderate** - While the mapping concept is straightforward, verification requires understanding of both HL7 v2 message structure and FHIR identifier patterns, plus the ability to trace the transformation logic.

### Prerequisites
- System must support US Core DiagnosticReport Profile for Laboratory Results Reporting
- Access to systems that transform HL7 v2 laboratory messages to FHIR DiagnosticReport resources
- Knowledge of the source HL7 v2 OBR segments used in the transformation
- Understanding of identifier uniqueness patterns in the implementing system

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: DiagnosticReport resources conforming to US Core DiagnosticReport Profile for Laboratory Results Reporting that were created from HL7 v2 lab messages
- **Source Data**: Access to the original HL7 v2 messages (specifically OBR segments) that were transformed into the FHIR DiagnosticReport resources
- **System Documentation**: Implementation documentation describing the HL7 v2 to FHIR mapping logic

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported:
- **GET** `/DiagnosticReport` - Retrieve DiagnosticReport resources
- **Search Parameters**: 
  - `patient` - Search by patient
  - `category` - Search by diagnostic service category  
  - `status` - Search by report status
  - `date` - Search by report date
  - `code` - Search by report code

### Validation Criteria

#### Test Case 1: Identifier Structure Verification
**Objective**: Verify that DiagnosticReport.identifier correctly represents the combination of OBR-2, OBR-3, and OBR-4 when the filler-id is not globally unique.

**Test Steps**:
1. Retrieve DiagnosticReport resources that originated from HL7 v2 lab messages
2. For each DiagnosticReport, examine the `identifier` element(s)
3. Cross-reference with the source HL7 v2 OBR segment data

**Attestation Points**:
- [ ] When OBR-3 (Filler Order Number) is not globally unique, the DiagnosticReport.identifier includes information from OBR-2 (Placer Order Number)
- [ ] The DiagnosticReport.identifier includes information from OBR-4 (Universal Service Identifier) 
- [ ] The combination of mapped identifier components creates a unique identifier for the diagnostic report
- [ ] The identifier structure is consistent across all laboratory DiagnosticReport resources from the same system

#### Test Case 2: Identifier Uniqueness Validation
**Objective**: Confirm that the mapped identifier ensures uniqueness when the original filler-id was not globally unique.

**Attestation Points**:
- [ ] DiagnosticReport resources created from different HL7 v2 messages have distinct identifier values
- [ ] The mapping logic prevents identifier collisions that could occur from non-unique OBR-3 values alone
- [ ] The identifier system and/or use attributes appropriately reflect the composite nature of the mapped identifier

#### Test Case 3: Documentation Compliance
**Objective**: Verify that the implementation documentation describes the OBR-to-identifier mapping approach.

**Attestation Points**:
- [ ] System documentation explicitly describes how OBR-2, OBR-3, and OBR-4 are combined to create DiagnosticReport.identifier
- [ ] Documentation explains the logic for handling non-globally unique filler-id scenarios
- [ ] Implementation follows the documented mapping approach consistently

### Success Criteria
The test passes when:
1. All attestation points are confirmed through documentation review and system analysis
2. The DiagnosticReport.identifier structure demonstrates appropriate mapping from the specified OBR fields
3. The mapping ensures identifier uniqueness even when source OBR-3 values are not globally unique
4. Implementation documentation accurately describes the mapping logic and is followed consistently

### Notes for Testers
- This test requires collaboration between testers and system implementers to verify the mapping logic
- Focus on laboratory DiagnosticReport resources specifically, as indicated by the requirement context
- Consider testing with multiple laboratory systems if the implementation receives data from various sources
- Verify that the mapping approach is consistent across different types of laboratory reports

---

<a id='req-280'></a>

### REQ-280: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport status to OBR-25.

**Text**: 

**Context**: 

**Actor**: USCoreDiagnosticReportProfileLaboratoryReporting

**Conformance**: SHALL

# Test Specification for REQ-280

## 1. Requirement ID
REQ-280

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be automatically verified by examining the FHIR DiagnosticReport resource structure and validating the presence and mapping of the status element to the corresponding HL7 v2 OBR-25 field.

### Complexity
**Simple** - The requirement involves a straightforward validation of a single field mapping between FHIR and HL7 v2 formats.

### Prerequisites
- US Core Server implementing the US Core DiagnosticReport Profile for Laboratory Results Reporting
- DiagnosticReport resources conforming to the US Core DiagnosticReport Profile for Laboratory Results Reporting
- Access to FHIR REST API endpoints supporting DiagnosticReport resource operations
- Understanding of HL7 v2 OBR segment structure and OBR-25 field specifications

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: DiagnosticReport resources that conform to the US Core DiagnosticReport Profile for Laboratory Results Reporting (StructureDefinition-us-core-diagnosticreport-lab.html)
- **Test Data**: Any existing DiagnosticReport resources in the system under test that represent laboratory reporting

### Required FHIR Operations
Based on the Capability Statement, the following supported operations will be used:
- **GET /DiagnosticReport** - Retrieve DiagnosticReport resources
- **GET /DiagnosticReport/[id]** - Retrieve specific DiagnosticReport by ID
- Search parameters supported for DiagnosticReport:
  - `patient` - Search by patient
  - `category` - Search by category
  - `status` - Search by status
  - `code` - Search by code
  - `date` - Search by date

### Validation Criteria

#### Primary Validation
1. **Status Element Presence**: Verify that every DiagnosticReport resource conforming to the US Core DiagnosticReport Profile for Laboratory Results Reporting contains a `status` element
2. **Status Value Validation**: Confirm that the `status` element contains a valid value from the FHIR DiagnosticReportStatus value set:
   - `registered`
   - `partial`
   - `preliminary`
   - `modified` (amended)
   - `final`
   - `amended`
   - `corrected`
   - `appended`
   - `cancelled`
   - `entered-in-error`
   - `unknown`

#### Mapping Verification
3. **OBR-25 Mapping Compliance**: Validate that the DiagnosticReport.status value can be appropriately mapped to HL7 v2 OBR-25 (Result Status) according to standard FHIR to HL7 v2 mapping specifications:
   - FHIR `registered` → HL7 v2 `O` (Order received; specimen not yet received)
   - FHIR `partial` → HL7 v2 `P` (Preliminary)
   - FHIR `preliminary` → HL7 v2 `P` (Preliminary)
   - FHIR `final` → HL7 v2 `F` (Final results)
   - FHIR `amended` → HL7 v2 `C` (Correction to results)
   - FHIR `corrected` → HL7 v2 `C` (Correction to results)
   - FHIR `cancelled` → HL7 v2 `X` (Order cannot be done, canceled)
   - FHIR `entered-in-error` → HL7 v2 `E` (Error in processing)

#### Test Execution Steps
1. **Resource Retrieval**: Query the system for DiagnosticReport resources using supported search parameters
2. **Profile Conformance**: Verify that retrieved resources conform to the US Core DiagnosticReport Profile for Laboratory Results Reporting
3. **Status Field Validation**: For each conforming DiagnosticReport:
   - Assert that the `status` element exists
   - Assert that the `status` value is from the allowed value set
   - Verify that the status value has a valid mapping to HL7 v2 OBR-25
4. **Mapping Documentation**: Ensure that the implementation documentation or mapping tables clearly define how each FHIR status maps to the corresponding OBR-25 value

#### Success Criteria
- **100% Coverage**: All DiagnosticReport resources conforming to the US Core Laboratory Results profile must have a valid status element
- **Valid Mapping**: Each status value must have a documented and valid mapping to an appropriate OBR-25 value
- **No Null/Missing Values**: No DiagnosticReport resources should have null, empty, or missing status elements

#### Failure Scenarios
- DiagnosticReport resources missing the status element
- Status elements containing values not in the FHIR DiagnosticReportStatus value set
- Status values that cannot be appropriately mapped to HL7 v2 OBR-25 values
- Inconsistent mapping implementation across multiple DiagnosticReport resources

---

<a id='req-281'></a>

### REQ-281: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport category to OBR-24.

**Text**: 

**Context**: 

**Actor**: USCoreDiagnosticReportProfileLaboratoryReporting

**Conformance**: SHALL

# Test Specification for REQ-281

## 1. Requirement ID
REQ-281

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement involves verifying a specific data mapping between FHIR and HL7 v2 formats, which can be programmatically validated by examining the DiagnosticReport.category field and ensuring it correctly maps to the OBR-24 segment in HL7 v2 messages.

### Complexity
**Simple** - The requirement focuses on a single, well-defined mapping between two specific fields across different message formats.

### Prerequisites
- System must support the US Core DiagnosticReport Profile for Laboratory Results Reporting
- System must be capable of generating or transforming FHIR DiagnosticReport resources to HL7 v2 format
- Test environment must have access to DiagnosticReport resources that contain laboratory results
- System must support the DiagnosticReport RESTful operations as defined in the US Core Server Capability Statement

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- DiagnosticReport resources conforming to the US Core DiagnosticReport Profile for Laboratory Results Reporting (StructureDefinition-us-core-diagnosticreport-lab.html)
- Resources must contain populated `category` elements with appropriate laboratory category codes
- Resources should represent actual laboratory reporting scenarios from the test system's data

**Expected Outputs:**
- HL7 v2 messages (specifically ORM/ORL/ORU messages containing OBR segments) generated from the FHIR DiagnosticReport resources
- Confirmation that the DiagnosticReport.category values are correctly mapped to OBR-24 fields

### Required FHIR Operations
Based on the US Core Server Capability Statement, the following operations will be used:

1. **DiagnosticReport Search Operations:**
   - `GET [base]/DiagnosticReport?patient=[patient-id]&category=LAB`
   - `GET [base]/DiagnosticReport?patient=[patient-id]&category=[category-code]`
   - `GET [base]/DiagnosticReport/[id]` (individual resource retrieval)

2. **Patient Search Operations** (for context):
   - `GET [base]/Patient/[patient-id]` (to validate patient context)

### Validation Criteria

**Primary Validation Checks:**

1. **FHIR Resource Validation:**
   - Verify DiagnosticReport resources conform to US Core DiagnosticReport Profile for Laboratory Results Reporting
   - Confirm DiagnosticReport.category field is populated with appropriate laboratory category codes
   - Validate that category codes use expected code systems (e.g., http://terminology.hl7.org/CodeSystem/v2-0074)

2. **HL7 v2 Mapping Validation:**
   - Extract the DiagnosticReport.category code and display values
   - Verify that when the FHIR resource is transformed to HL7 v2, the category information appears correctly in OBR-24 (Universal Service Identifier)
   - Confirm the mapping preserves both the coded value and text representation where applicable
   - Validate that the code system information is appropriately represented in the HL7 v2 format

3. **Conformance Assertions:**
   - **PASS Criteria:**
     - All retrieved DiagnosticReport resources contain populated category elements
     - Category codes are successfully mapped to OBR-24 in generated HL7 v2 messages
     - The semantic meaning of the category is preserved in the transformation
     - Code system identifiers are correctly represented in both formats

   - **FAIL Criteria:**
     - DiagnosticReport.category is missing or empty
     - Category information is not present in OBR-24 of the corresponding HL7 v2 message
     - Incorrect code values or code systems are used in the mapping
     - Loss of semantic meaning during transformation

**Test Execution Steps:**

1. Query the system for DiagnosticReport resources using supported search parameters
2. For each retrieved DiagnosticReport, validate the presence and content of the category field
3. Request or generate the corresponding HL7 v2 message representation
4. Parse the HL7 v2 message and locate the OBR-24 field
5. Compare the FHIR category values with the OBR-24 content to verify correct mapping
6. Document any discrepancies or mapping failures

**Success Metrics:**
- 100% of tested DiagnosticReport resources demonstrate correct category to OBR-24 mapping
- All laboratory category codes are preserved accurately in the HL7 v2 transformation
- Code system information maintains integrity across format transformation

---

<a id='req-282'></a>

### REQ-282: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport code to OBR-4.

**Text**: 

**Context**: 

**Actor**: USCoreDiagnosticReportProfileLaboratoryReporting

**Conformance**: SHALL

# Test Specification for REQ-282

## 1. Requirement ID
REQ-282

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Attestation

This requirement involves mapping FHIR DiagnosticReport.code to HL7 v2 OBR-4 field, which is a cross-standard mapping specification. Since this is about data transformation between FHIR and HL7 v2 formats rather than FHIR-to-FHIR interoperability, it cannot be directly tested through FHIR API operations alone. The requirement would need to be verified through attestation that the implementing system correctly performs this mapping when converting between formats.

### Complexity
**Level**: Simple

The requirement is straightforward - it specifies a direct field-to-field mapping between DiagnosticReport.code (FHIR) and OBR-4 (HL7 v2). The complexity lies in the cross-standard nature rather than the mapping logic itself.

### Prerequisites
- System must support both FHIR R4 US Core DiagnosticReport Profile for Laboratory Reporting and HL7 v2 messaging
- System must have capability to transform/map data between FHIR and HL7 v2 formats
- Access to sample DiagnosticReport instances that conform to the US Core Laboratory Reporting profile
- Documentation of the system's mapping implementation

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources**:
- DiagnosticReport instances conforming to US Core DiagnosticReport Profile for Laboratory Results Reporting (http://hl7.org/fhir/us/core/StructureDefinition/us-core-diagnosticreport-lab)
- DiagnosticReport instances must contain populated `code` element with appropriate laboratory test codes (e.g., LOINC codes)

**Expected Outputs**:
- HL7 v2 messages containing OBR segments with OBR-4 field populated
- Documentation or attestation showing the mapping implementation

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for DiagnosticReport:

**Primary Operations**:
- `GET /DiagnosticReport` - Retrieve DiagnosticReport instances for testing
- `GET /DiagnosticReport/{id}` - Retrieve specific DiagnosticReport instances

**Supported Search Parameters** (per Capability Statement):
- `patient` - To retrieve laboratory reports for specific patients
- `category` - To filter for laboratory category reports
- `code` - To retrieve reports with specific diagnostic codes
- `date` - To retrieve reports within date ranges
- `status` - To filter by report status

**Example Query**:
```
GET /DiagnosticReport?patient={patient-id}&category=LAB
```

### Validation Criteria

Since this is primarily an attestation-based requirement, the validation approach should include:

**Documentation Review**:
1. **Mapping Documentation**: Verify that system documentation explicitly describes the mapping between DiagnosticReport.code and OBR-4
2. **Implementation Evidence**: Review technical specifications showing how the code element is extracted and placed in OBR-4

**Functional Verification** (if cross-format testing is possible):
1. **Code Preservation**: When a FHIR DiagnosticReport with a populated code element is converted to HL7 v2, verify that:
   - The code value appears in OBR-4.1 (Identifier)
   - The code system appears in OBR-4.3 (Name of Coding System) 
   - The code display text appears in OBR-4.2 (Text) if present in the FHIR resource

2. **Code System Handling**: Verify appropriate handling of different coding systems:
   - LOINC codes are properly mapped
   - SNOMED CT codes are properly mapped
   - Local codes are handled according to implementation specifications

**Sample Assertion Logic**:
```
FOR each DiagnosticReport instance:
  IF DiagnosticReport.code is populated THEN
    VERIFY corresponding HL7 v2 OBR-4 contains:
      - OBR-4.1 = DiagnosticReport.code.coding[0].code
      - OBR-4.3 = DiagnosticReport.code.coding[0].system
      - OBR-4.2 = DiagnosticReport.code.coding[0].display (if present)
```

**Pass Criteria**:
- System provides documentation demonstrating the DiagnosticReport.code to OBR-4 mapping
- If functional testing is performed, 100% of test DiagnosticReport instances show correct mapping to OBR-4
- Code values, systems, and display text are preserved accurately in the transformation

**Attestation Requirements**:
- Implementer confirms that their system performs the specified mapping
- Technical documentation supports the mapping implementation
- Sample transformations demonstrate correct mapping behavior

---

<a id='req-283'></a>

### REQ-283: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport subject to PID-3.

**Text**: 

**Context**: 

**Actor**: USCoreDiagnosticReportProfileLaboratoryReporting

**Conformance**: SHALL

# Test Specification for REQ-283

## 1. Requirement ID
REQ-283

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement involves mapping validation between FHIR DiagnosticReport.subject and HL7 v2 PID-3, which can be programmatically verified through data transformation testing.

### Complexity
**Moderate** - Requires understanding of both FHIR R4 DiagnosticReport structure and HL7 v2 PID segment mapping, plus validation of proper subject reference handling.

### Prerequisites
- System must support US Core DiagnosticReport Profile for Laboratory Results Reporting
- System must be capable of HL7 v2 to FHIR transformation or vice versa
- Test data must include DiagnosticReport resources with valid subject references to Patient resources
- Patient resources must have identifiers that can be mapped to PID-3 format

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- DiagnosticReport resources conforming to US Core DiagnosticReport Profile for Laboratory Results Reporting
- Patient resources referenced by DiagnosticReport.subject
- Patient resources must contain identifier elements suitable for PID-3 mapping

**Expected Outputs:**
- Verification that DiagnosticReport.subject properly maps to HL7 v2 PID-3 format
- Confirmation that patient identifiers are correctly transformed between formats

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required:
- **GET /DiagnosticReport** - Retrieve DiagnosticReport resources
- **GET /Patient** - Retrieve Patient resources referenced by DiagnosticReport.subject
- Search parameters: `patient`, `category`, `status` for DiagnosticReport retrieval

### Validation Criteria

#### Test Case 1: Basic Subject to PID-3 Mapping
**Scenario:** Validate that DiagnosticReport.subject reference correctly maps to PID-3
**Steps:**
1. Retrieve DiagnosticReport resources using supported search parameters
2. For each DiagnosticReport, extract the subject reference
3. Resolve the Patient resource from the subject reference
4. Validate that the Patient.identifier can be properly mapped to PID-3 format

**Assertions:**
- DiagnosticReport.subject must be a valid reference to a Patient resource
- Referenced Patient resource must contain at least one identifier
- Patient identifier must be transformable to PID-3 format (Patient ID List)
- The mapping must preserve patient identity integrity

#### Test Case 2: Multiple Identifier Handling
**Scenario:** Validate proper handling when Patient has multiple identifiers
**Steps:**
1. Retrieve DiagnosticReport with subject referencing Patient having multiple identifiers
2. Verify that the primary identifier is correctly selected for PID-3 mapping
3. Validate that identifier type, system, and value are appropriately transformed

**Assertions:**
- Primary patient identifier is correctly identified for PID-3 mapping
- Identifier system and type information is preserved or appropriately transformed
- Multiple identifiers are handled according to HL7 v2 PID-3 specifications

#### Test Case 3: Reference Format Validation
**Scenario:** Validate different subject reference formats are properly handled
**Steps:**
1. Test with relative references (Patient/123)
2. Test with absolute references (http://server/Patient/123)
3. Test with logical references using identifier

**Assertions:**
- All valid reference formats resolve to correct Patient resource
- Patient identity is consistently mapped to PID-3 regardless of reference format
- No data loss occurs during reference resolution and mapping

#### Test Case 4: Laboratory Profile Specific Validation
**Scenario:** Ensure mapping works specifically for laboratory reporting profile
**Steps:**
1. Filter DiagnosticReport resources to laboratory category
2. Verify subject mapping for laboratory-specific reports
3. Validate that laboratory context doesn't affect patient identification

**Assertions:**
- DiagnosticReport must conform to US Core Laboratory Results Reporting profile
- Subject mapping accuracy is maintained for laboratory reports
- Laboratory-specific elements don't interfere with patient identification

#### Pass/Fail Criteria
**Test Passes If:**
- All DiagnosticReport.subject references successfully resolve to Patient resources
- Patient identifiers are correctly formatted for PID-3 mapping
- No patient identity information is lost during transformation
- Mapping maintains consistency across different reference formats

**Test Fails If:**
- Subject references cannot be resolved to Patient resources
- Patient identifiers cannot be transformed to valid PID-3 format
- Patient identity is lost or corrupted during mapping
- Different reference formats produce inconsistent mapping results

---

<a id='req-284'></a>

### REQ-284: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport encounter to PV1-19.

**Text**: 

**Context**: 

**Actor**: USCoreDiagnosticReportProfileLaboratoryReporting

**Conformance**: SHALL

# Test Specification for REQ-284

## 1. Requirement ID
REQ-284

## 2. Requirement Analysis

### Testability Assessment
**Not Testable** - This requirement is not testable in a FHIR interoperability context for the following reasons:
- The requirement refers to HL7 v2 mapping (DiagnosticReport.encounter to PV1-19) which is outside the scope of FHIR testing
- FHIR testing focuses on FHIR resource validation, API interactions, and FHIR-specific conformance
- HL7 v2 to FHIR mappings are implementation-specific transformation rules, not FHIR interoperability requirements
- The US Core Server Capability Statement does not define any operations or requirements related to HL7 v2 message handling

### Complexity
Not Applicable - Cannot be tested in FHIR context

### Prerequisites
Not Applicable - Requirement is not testable in FHIR interoperability testing

## 3. Test Implementation Strategy

### Assessment
This requirement cannot be implemented as a FHIR interoperability test because:

1. **Scope Mismatch**: The requirement addresses HL7 v2 message mapping, which is not within the scope of FHIR API testing or FHIR resource validation.

2. **Capability Statement Gap**: The US Core Server Capability Statement defines supported FHIR operations for DiagnosticReport resources but does not include any HL7 v2 transformation capabilities or requirements.

3. **Testing Context**: FHIR interoperability testing focuses on:
   - FHIR resource structure and content validation
   - FHIR REST API operations
   - FHIR search parameters and responses
   - FHIR profile conformance

4. **Implementation Detail**: HL7 v2 to FHIR mappings are internal implementation concerns that occur during data transformation, not during FHIR API interactions.

### Recommendation
This requirement should be:
- Moved to implementation guidance documentation rather than testable requirements
- Addressed through implementation attestation rather than automated testing
- Tested at the system integration level during HL7 v2 to FHIR transformation validation, not at the FHIR interoperability level

### Alternative Testing Approach
If testing the relationship between DiagnosticReport and Encounter is needed in a FHIR context, consider testing:
- That DiagnosticReport.encounter references are valid FHIR Encounter resources
- That referenced Encounters can be successfully retrieved via FHIR API
- That the DiagnosticReport conforms to the US Core DiagnosticReport Profile for Laboratory Results Reporting

However, these would be separate, FHIR-specific requirements rather than HL7 v2 mapping requirements.

---

<a id='req-285'></a>

### REQ-285: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport effective[x] to OBR-7.

**Text**: 

**Context**: 

**Actor**: USCoreDiagnosticReportProfileLaboratoryReporting

**Conformance**: SHALL

# Test Specification for REQ-285

## 1. Requirement ID
REQ-285

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Automatically testable

This requirement is automatically testable as it specifies a concrete mapping between FHIR DiagnosticReport.effective[x] element and HL7 v2 OBR-7 field. The mapping can be verified through automated validation of the structure definition and instance data.

### Complexity
**Simple**

The requirement involves a straightforward field-to-field mapping validation between FHIR and HL7 v2 formats.

### Prerequisites
- System under test must support the US Core DiagnosticReport Profile for Laboratory Results Reporting
- System must implement HL7 v2 to FHIR mapping capabilities or provide mapping documentation
- Test data must include DiagnosticReport instances with populated effective[x] elements
- Access to corresponding HL7 v2 OBR segments for mapping verification

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- DiagnosticReport instances conforming to the US Core DiagnosticReport Profile for Laboratory Results Reporting (StructureDefinition-us-core-diagnosticreport-lab.html)
- DiagnosticReport instances must contain populated effective[x] elements (effectiveDateTime, effectivePeriod, etc.)

**Expected Outputs:**
- Corresponding HL7 v2 OBR segments with populated OBR-7 (Observation Date/Time) field
- Mapping validation results confirming correct transformation between FHIR effective[x] and OBR-7

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported:

**READ Operations:**
- `GET [base]/DiagnosticReport/{id}` - Retrieve specific DiagnosticReport instances

**SEARCH Operations:**
- `GET [base]/DiagnosticReport?patient={patient_id}` - Search for DiagnosticReports by patient
- `GET [base]/DiagnosticReport?patient={patient_id}&category=LAB` - Search for laboratory DiagnosticReports
- `GET [base]/DiagnosticReport?patient={patient_id}&date={date}` - Search for DiagnosticReports by date

### Validation Criteria

**Test Case 1: Basic Mapping Validation**
- **Given**: A DiagnosticReport instance with populated effectiveDateTime
- **When**: The system processes the FHIR to HL7 v2 mapping
- **Then**: The resulting OBR-7 field must contain the equivalent date/time value from the FHIR effective[x] element
- **Assertion**: OBR-7 value matches the FHIR effectiveDateTime with appropriate format conversion

**Test Case 2: Period Mapping Validation**
- **Given**: A DiagnosticReport instance with populated effectivePeriod
- **When**: The system processes the FHIR to HL7 v2 mapping
- **Then**: The OBR-7 field must appropriately represent the period (typically using the start date/time)
- **Assertion**: OBR-7 value corresponds to the effectivePeriod.start value

**Test Case 3: Profile Conformance**
- **Given**: Multiple DiagnosticReport instances from the test dataset
- **When**: Validating against the US Core DiagnosticReport Profile for Laboratory Results Reporting
- **Then**: All instances must conform to the profile requirements
- **Assertion**: FHIR validator confirms conformance to StructureDefinition-us-core-diagnosticreport-lab

**Test Case 4: Data Type Support**
- **Given**: DiagnosticReport instances with different effective[x] data types (DateTime, Period, Instant)
- **When**: Processing the mapping to OBR-7
- **Then**: Each data type must be correctly mapped to the appropriate OBR-7 format
- **Assertion**: Mapping maintains semantic equivalence across different FHIR data types

**Pass Criteria:**
- All DiagnosticReport instances in the test dataset that contain effective[x] elements successfully map to OBR-7
- Date/time values are preserved with appropriate format conversion
- No loss of temporal precision beyond what is inherent in the format differences
- Mapping is bidirectionally consistent where applicable

**Fail Criteria:**
- Any DiagnosticReport effective[x] element fails to map to OBR-7
- Date/time values are incorrectly transformed or lost
- Mapping violates the US Core DiagnosticReport Profile requirements
- System generates errors when processing valid effective[x] elements

---

<a id='req-286'></a>

### REQ-286: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport issued to OBR-22.

**Text**: 

**Context**: 

**Actor**: USCoreDiagnosticReportProfileLaboratoryReporting

**Conformance**: SHALL

# Test Specification for REQ-286

## 1. Requirement ID
REQ-286

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Automatically testable

This requirement is automatically testable as it involves verifying a specific mapping between a FHIR element (`DiagnosticReport.issued`) and an HL7 v2 element (`OBR-22`). The test can validate that the mapping is properly implemented by examining DiagnosticReport resources conforming to the US Core DiagnosticReport Profile for Laboratory Reporting.

### Complexity
**Simple**

The requirement involves a straightforward field mapping validation between two well-defined data elements.

### Prerequisites
- System must support US Core Server CapabilityStatement
- System must implement US Core DiagnosticReport Profile for Laboratory Results Reporting
- System must support DiagnosticReport resource operations as defined in the capability statement
- Test data must include DiagnosticReport resources with populated `issued` field
- Access to HL7 v2 mapping documentation for OBR-22 field specifications

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- DiagnosticReport resources conforming to US Core DiagnosticReport Profile for Laboratory Results Reporting (`http://hl7.org/fhir/us/core/StructureDefinition/us-core-diagnosticreport-lab`)
- Resources must have the `issued` element populated with valid dateTime values

**Expected Outputs:**
- Verification that DiagnosticReport.issued values are properly formatted and mappable to OBR-22
- Confirmation that the mapping preserves semantic meaning and data integrity

### Required FHIR Operations
Based on the capability statement, the following operations are supported and required:

1. **GET /DiagnosticReport** - Retrieve DiagnosticReport resources
2. **GET /DiagnosticReport?patient={id}** - Search for DiagnosticReport by patient
3. **GET /DiagnosticReport?category={category}** - Search for laboratory DiagnosticReports
4. **GET /DiagnosticReport?patient={id}&category=LAB** - Search for patient-specific laboratory reports

### Validation Criteria

**Primary Assertions:**
1. **Profile Conformance**: Verify that retrieved DiagnosticReport resources conform to the US Core DiagnosticReport Profile for Laboratory Results Reporting
2. **Field Presence**: Confirm that the `DiagnosticReport.issued` field is present and populated
3. **Data Type Validation**: Verify that `DiagnosticReport.issued` contains a valid FHIR dateTime value
4. **OBR-22 Mapping Compatibility**: Validate that the `issued` value format is compatible with HL7 v2 OBR-22 field requirements (timestamp format that can be mapped to TS data type)

**Specific Test Cases:**
1. **Basic Mapping Test**: 
   - Retrieve DiagnosticReport resources with laboratory category
   - Verify each resource has a populated `issued` field
   - Confirm the dateTime format is valid and mappable to OBR-22

2. **Data Integrity Test**:
   - Validate that `issued` values represent valid timestamps
   - Ensure precision and timezone information is preserved for proper OBR-22 mapping
   - Verify that the semantic meaning (report issuance timestamp) is maintained

3. **Search-Based Validation**:
   - Use supported search parameters to retrieve laboratory DiagnosticReports
   - Apply validation criteria to all returned resources
   - Ensure consistent mapping capability across different retrieval methods

**Pass Criteria:**
- All retrieved US Core DiagnosticReport (Laboratory) resources must have a populated `issued` field
- All `issued` values must be valid FHIR dateTime format
- All `issued` values must be semantically appropriate for OBR-22 mapping (representing the report issuance date/time)
- No validation errors when checking resources against the US Core DiagnosticReport Laboratory profile

**Failure Conditions:**
- DiagnosticReport resources missing the `issued` field
- Invalid dateTime format in the `issued` field
- Resources that do not conform to the US Core DiagnosticReport Laboratory profile
- Semantic misalignment where `issued` values cannot appropriately map to OBR-22 context

---

<a id='req-287'></a>

### REQ-287: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport performer to PRT-8 where PRT-4-Participation equals "PO".

**Text**: 

**Context**: 

**Actor**: USCoreDiagnosticReportProfileLaboratoryReporting

**Conformance**: SHALL

# Test Specification for REQ-287

## 1. Requirement ID
**REQ-287**: USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport performer to PRT-8 where PRT-4-Participation equals "PO"

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Attestation

**Rationale**: This requirement specifies a mapping between FHIR DiagnosticReport.performer and HL7 v2 PRT segment fields. Since this involves transformation between different standards (FHIR to HL7 v2), it cannot be directly tested through FHIR API interactions alone. The requirement addresses data transformation/mapping logic that occurs within the system's implementation rather than externally observable FHIR behavior.

### Complexity
**Moderate** - The requirement involves understanding both FHIR DiagnosticReport structure and HL7 v2 PRT segment mapping, requiring knowledge of cross-standard data transformation.

### Prerequisites
- System implementing US Core DiagnosticReport Profile for Laboratory Results Reporting
- System capability to export/transform FHIR data to HL7 v2 format
- Access to both FHIR DiagnosticReport instances and their corresponding HL7 v2 message outputs
- Understanding of HL7 v2 PRT segment structure and participation codes

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- DiagnosticReport instances conforming to [US Core DiagnosticReport Profile for Laboratory Results Reporting](http://hl7.org/fhir/us/core/StructureDefinition/us-core-diagnosticreport-lab)
- DiagnosticReport instances must contain `performer` element with references to performing organizations/practitioners

**Expected Outputs:**
- Corresponding HL7 v2 messages containing PRT segments
- Documentation or system specification describing the FHIR to HL7 v2 mapping implementation

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are supported for DiagnosticReport:

**Primary Operations:**
- `GET /DiagnosticReport/{id}` - Retrieve specific DiagnosticReport instances
- `GET /DiagnosticReport?patient={patient}&category=LAB` - Search for laboratory DiagnosticReports

**Supporting Search Parameters:**
- `patient+category` - To identify laboratory reports for specific patients
- `patient+status` - To filter by report status if needed

### Validation Criteria

Since this is an attestation-based test, the validation involves verifying the implementation's mapping logic through the following approaches:

#### 1. Mapping Documentation Review
**Assertion**: System documentation explicitly describes how DiagnosticReport.performer maps to PRT-8 when PRT-4 equals "PO"

**Validation Steps:**
- Review system's FHIR to HL7 v2 mapping specification
- Confirm that DiagnosticReport.performer is explicitly mapped to PRT-8
- Verify that the mapping only applies when PRT-4 (Participation) equals "PO" (Principal Organization)

#### 2. Sample Data Verification
**Assertion**: Actual transformed data demonstrates correct mapping implementation

**Validation Steps:**
- Obtain DiagnosticReport instances with populated `performer` elements
- Retrieve corresponding HL7 v2 message output from the same system
- For each DiagnosticReport.performer:
  - Verify presence of corresponding PRT segment in HL7 v2 message
  - Confirm PRT-4 contains "PO" value
  - Validate that PRT-8 contains the performer information from FHIR DiagnosticReport
  - Ensure performer data integrity is maintained in the transformation

#### 3. Edge Case Coverage
**Assertion**: Mapping handles various performer scenarios appropriately

**Test Scenarios:**
- DiagnosticReport with single performer
- DiagnosticReport with multiple performers
- DiagnosticReport with no performer (should not generate PRT with PRT-4="PO")
- Performer references to different resource types (Organization, Practitioner, PractitionerRole)

#### 4. Compliance Verification
**Assertion**: Implementation follows US Core DiagnosticReport Laboratory Profile requirements

**Validation Steps:**
- Confirm that source DiagnosticReport instances conform to US Core Laboratory profile
- Verify that performer mapping preserves required data elements
- Ensure that the mapping is consistent across all laboratory DiagnosticReport instances

### Pass/Fail Criteria

**Pass Conditions:**
- System documentation clearly specifies the DiagnosticReport.performer to PRT-8 mapping when PRT-4="PO"
- Sample data transformations demonstrate correct mapping implementation
- All DiagnosticReport performers are consistently mapped to appropriate PRT segments
- No performer data is lost or corrupted in the transformation process

**Fail Conditions:**
- Missing or unclear mapping documentation
- Incorrect PRT-4 participation code (not "PO")
- DiagnosticReport.performer data not appearing in PRT-8
- Inconsistent mapping behavior across different DiagnosticReport instances
- Data integrity issues in the transformation process

---

<a id='req-288'></a>

### REQ-288: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport resultsInterpreter to OBR-32 and PRT-8 where PRT-4-Participation equals "PI".

**Text**: 

**Context**: 

**Actor**: USCoreDiagnosticReportProfileLaboratoryReporting

**Conformance**: SHALL

# Test Specification for REQ-288

## 1. Requirement ID
REQ-288

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated programmatically by inspecting FHIR DiagnosticReport resources that conform to the USCoreDiagnosticReportProfileLaboratoryReporting profile and verifying the presence and mapping of the resultsInterpreter element according to the specified HL7 v2 mapping rules.

### Complexity
**Moderate** - The requirement involves understanding FHIR to HL7 v2 mappings and validating specific field mappings between different healthcare data standards. It requires knowledge of both FHIR resource structure and HL7 v2 segment specifications.

### Prerequisites
- System must support US Core DiagnosticReport Profile for Laboratory Reporting
- System must be capable of generating or consuming HL7 v2 messages with OBR and PRT segments
- Test data must include DiagnosticReport resources with populated resultsInterpreter elements
- System must support HL7 v2 to FHIR transformation or vice versa for mapping validation

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- DiagnosticReport resources conforming to USCoreDiagnosticReportProfileLaboratoryReporting profile
- DiagnosticReport resources must have populated `resultsInterpreter` elements
- Associated Practitioner or PractitionerRole resources referenced by resultsInterpreter

**Expected Outputs:**
- Corresponding HL7 v2 messages with properly mapped OBR-32 and PRT-8 fields
- PRT-4 field populated with "PI" (Principal Investigator) participation code
- Validation confirmation that mapping rules are correctly implemented

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are required:

1. **GET /DiagnosticReport** - Retrieve DiagnosticReport resources for testing
2. **GET /DiagnosticReport/{id}** - Retrieve specific DiagnosticReport instances
3. **GET /Practitioner/{id}** - Retrieve referenced Practitioner resources
4. **GET /PractitionerRole/{id}** - Retrieve referenced PractitionerRole resources

*Note: These operations align with the US Core Server capability requirements for supporting US Core profiles and RESTful interactions.*

### Validation Criteria

**Primary Assertions:**
1. **resultsInterpreter Presence Validation:**
   - Verify that DiagnosticReport resources conforming to USCoreDiagnosticReportProfileLaboratoryReporting contain `resultsInterpreter` elements when laboratory interpretation is provided

2. **OBR-32 Mapping Validation:**
   - Confirm that FHIR DiagnosticReport.resultsInterpreter is correctly mapped to HL7 v2 OBR-32 (Principal Result Interpreter)
   - Verify that the practitioner identification information is accurately transferred

3. **PRT-8 Mapping Validation:**
   - Confirm that FHIR DiagnosticReport.resultsInterpreter is correctly mapped to HL7 v2 PRT-8 (Person)
   - Verify that associated practitioner details are properly populated in PRT-8

4. **PRT-4 Participation Code Validation:**
   - Verify that when resultsInterpreter mapping occurs, PRT-4 (Participation) is populated with "PI" (Principal Investigator)
   - Confirm that the participation role accurately reflects the interpreter function

**Secondary Assertions:**
1. **Reference Integrity:**
   - Validate that resultsInterpreter references resolve to valid Practitioner or PractitionerRole resources
   - Confirm that referenced resources contain sufficient information for HL7 v2 mapping

2. **Profile Conformance:**
   - Verify that DiagnosticReport resources conform to USCoreDiagnosticReportProfileLaboratoryReporting profile
   - Validate that all mandatory elements required by the profile are present

3. **Data Consistency:**
   - Ensure that practitioner information in FHIR matches the corresponding HL7 v2 representation
   - Verify that no data is lost or corrupted during the mapping process

**Test Success Criteria:**
- All DiagnosticReport resources with resultsInterpreter elements demonstrate correct mapping to OBR-32 and PRT-8
- PRT-4 consistently contains "PI" when resultsInterpreter mapping is applied
- Referenced practitioner information is accurately preserved across the mapping
- No conformance errors are detected in the USCoreDiagnosticReportProfileLaboratoryReporting implementation

**Test Failure Conditions:**
- resultsInterpreter elements are not mapped to the specified HL7 v2 fields
- PRT-4 contains values other than "PI" when resultsInterpreter is present
- Mapping results in data loss or corruption of practitioner information
- Referenced practitioners cannot be resolved or lack required information for mapping

---

<a id='req-289'></a>

### REQ-289: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport specimen to SPM.

**Text**: 

**Context**: 

**Actor**: USCoreDiagnosticReportProfileLaboratoryReporting

**Conformance**: SHALL

# Test Specification for REQ-289

## 1. Requirement ID
REQ-289

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Automatically testable

**Rationale**: This requirement involves verifying a specific mapping between FHIR DiagnosticReport.specimen and HL7 v2 SPM segment. The mapping can be validated by examining the DiagnosticReport resource structure and confirming the specimen field is properly populated and structured according to the US Core DiagnosticReport Profile for Laboratory Results Reporting.

### Complexity
**Level**: Simple

**Rationale**: The test involves straightforward validation of a single field mapping within a DiagnosticReport resource. It requires checking for the presence and proper structure of the specimen reference.

### Prerequisites
- System must implement US Core DiagnosticReport Profile for Laboratory Results Reporting
- System must support DiagnosticReport resource retrieval
- Test data must include DiagnosticReport resources with associated specimens
- System must be capable of handling specimen references in DiagnosticReport resources

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources**:
- DiagnosticReport resources conforming to US Core DiagnosticReport Profile for Laboratory Results Reporting
- Associated Specimen resources conforming to US Core Specimen Profile (referenced by DiagnosticReport)
- Patient resources (as referenced by DiagnosticReport and Specimen)

**Expected Outputs**:
- Verification that DiagnosticReport.specimen field is present when specimens are associated with laboratory reports
- Confirmation that specimen references are properly formatted and resolvable
- Validation that the mapping structure supports HL7 v2 SPM segment requirements

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required:

1. **DiagnosticReport Search Operations**:
   - `GET [base]/DiagnosticReport?patient={patient-id}`
   - `GET [base]/DiagnosticReport?patient={patient-id}&category=LAB`
   - `GET [base]/DiagnosticReport/{id}`

2. **Specimen Retrieval Operations**:
   - `GET [base]/Specimen/{specimen-id}`
   - `GET [base]/Specimen?patient={patient-id}`

3. **Patient Retrieval Operations** (for context):
   - `GET [base]/Patient/{patient-id}`

### Validation Criteria

**Primary Assertions**:

1. **Specimen Field Presence Check**:
   - For DiagnosticReport resources with category indicating laboratory results, verify that the `specimen` field is populated when specimens are associated with the report
   - Assert: `DiagnosticReport.specimen` is present and not null when laboratory specimens exist

2. **Specimen Reference Validation**:
   - Verify that `DiagnosticReport.specimen` contains valid FHIR references
   - Assert: Each specimen reference follows the format `Specimen/{id}` or contains a valid reference structure
   - Assert: Referenced specimen resources can be successfully retrieved

3. **Specimen Resource Conformance**:
   - Verify that referenced Specimen resources conform to US Core Specimen Profile
   - Assert: Retrieved Specimen resources validate against the US Core Specimen Profile constraints

4. **Reference Integrity**:
   - Verify that the patient reference in DiagnosticReport matches the subject reference in associated Specimen resources
   - Assert: `DiagnosticReport.subject` equals `Specimen.subject` for all referenced specimens

**Test Execution Flow**:

1. Query for DiagnosticReport resources with laboratory category using supported search parameters
2. For each DiagnosticReport found:
   - Verify the resource conforms to US Core DiagnosticReport Profile for Laboratory Results Reporting
   - Check for presence of specimen field
   - Validate specimen reference format and resolvability
   - Retrieve referenced Specimen resources
   - Verify Specimen resource conformance to US Core Specimen Profile
   - Validate patient reference consistency between DiagnosticReport and Specimen

**Pass Criteria**:
- All DiagnosticReport resources with associated specimens have properly populated specimen fields
- All specimen references are valid and resolvable
- All referenced Specimen resources conform to US Core Specimen Profile
- Patient references are consistent between DiagnosticReport and associated Specimen resources

**Fail Criteria**:
- DiagnosticReport resources missing specimen field when specimens should be present
- Invalid or unresolvable specimen references
- Referenced Specimen resources that do not conform to US Core Specimen Profile
- Inconsistent patient references between DiagnosticReport and Specimen resources

---

<a id='req-290'></a>

### REQ-290: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport result to OBXs.

**Text**: 

**Context**: 

**Actor**: USCoreDiagnosticReportProfileLaboratoryReporting

**Conformance**: SHALL

# Test Specification for REQ-290

## 1. Requirement ID
**REQ-290**: USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport result to OBXs

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Attestation

**Rationale**: This requirement specifies a mapping obligation between FHIR DiagnosticReport resources conforming to the US Core DiagnosticReport Profile for Laboratory Results Reporting and HL7 v2 OBX segments. The actual mapping implementation occurs within the system's internal transformation logic and cannot be directly validated through FHIR API interactions. The requirement can only be verified through attestation that the system properly implements the specified mapping when generating HL7 v2 messages from FHIR resources.

### Complexity
**Moderate**

The requirement involves understanding the relationship between FHIR DiagnosticReport.result elements and their corresponding HL7 v2 OBX segment representations, requiring knowledge of both FHIR and HL7 v2 standards.

### Prerequisites
- System must support the US Core DiagnosticReport Profile for Laboratory Results Reporting
- System must have capability to transform FHIR resources to HL7 v2 format
- Test environment should contain DiagnosticReport resources with populated result elements
- Access to both FHIR API and HL7 v2 message outputs (if available for verification)

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources**:
- DiagnosticReport resources conforming to US Core DiagnosticReport Profile for Laboratory Results Reporting
- Associated Observation resources referenced in DiagnosticReport.result elements
- Patient resources referenced by the DiagnosticReports

**Expected Outputs**:
- Attestation documentation demonstrating proper mapping implementation
- Sample HL7 v2 messages showing OBX segments derived from DiagnosticReport.result elements (if available)

### Required FHIR Operations
Based on the US Core Server Capability Statement:

1. **DiagnosticReport Read/Search Operations**:
   - `GET [base]/DiagnosticReport/[id]` - Read specific DiagnosticReport
   - `GET [base]/DiagnosticReport?patient=[patient_id]&category=LAB` - Search for laboratory DiagnosticReports
   - `GET [base]/DiagnosticReport?patient=[patient_id]&status=final` - Search for final DiagnosticReports

2. **Observation Read Operations** (for referenced results):
   - `GET [base]/Observation/[id]` - Read Observation resources referenced in DiagnosticReport.result

### Validation Criteria

Since this is an attestation-based test, the following criteria should be documented:

#### Primary Attestation Requirements
1. **Mapping Documentation**: System must provide documentation demonstrating that each DiagnosticReport.result reference is properly mapped to corresponding OBX segments in HL7 v2 messages

2. **Implementation Verification**: For each DiagnosticReport resource used in testing:
   - Confirm the resource conforms to US Core DiagnosticReport Profile for Laboratory Results Reporting
   - Verify that all Observation resources referenced in DiagnosticReport.result elements are properly represented as OBX segments
   - Document the mapping methodology used for transforming FHIR Observation data to HL7 v2 OBX format

#### Supporting Evidence (if available)
1. **Sample Message Comparison**: If system provides access to both FHIR and HL7 v2 outputs, compare:
   - Number of DiagnosticReport.result references matches number of OBX segments
   - Observation values in FHIR correspond to OBX-5 (Observation Value) in HL7 v2
   - Observation codes in FHIR correspond to OBX-3 (Observation Identifier) in HL7 v2

2. **Profile Conformance**: Validate that test DiagnosticReport resources:
   - Successfully validate against US Core DiagnosticReport Profile for Laboratory Results Reporting
   - Contain populated result elements referencing valid Observation resources
   - Meet all required elements and constraints specified in the profile

#### Test Execution Steps
1. Retrieve DiagnosticReport resources using supported search parameters
2. Validate each DiagnosticReport conforms to the US Core Laboratory Results profile
3. Document the presence and content of result elements
4. Obtain attestation from system implementer regarding OBX mapping implementation
5. Review any available supporting evidence (sample HL7 v2 messages, mapping documentation)
6. Verify attestation covers all identified DiagnosticReport.result elements

#### Pass Criteria
- System implementer provides documented attestation confirming proper mapping of DiagnosticReport.result to OBX segments
- All test DiagnosticReport resources conform to US Core DiagnosticReport Profile for Laboratory Results Reporting
- Supporting documentation adequately demonstrates mapping methodology alignment with HL7 v2 OBX segment requirements

---

<a id='req-291'></a>

### REQ-291: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport media to OBX.

**Text**: 

**Context**: 

**Actor**: USCoreDiagnosticReportProfileLaboratoryReporting

**Conformance**: SHALL

# Test Specification for REQ-291

## 1. Requirement ID
REQ-291

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be tested by analyzing DiagnosticReport instances to verify that media elements are properly mapped to OBX segments in HL7 v2 format. The mapping can be validated through structural analysis and content verification.

### Complexity
**Moderate** - The test requires understanding of both FHIR DiagnosticReport structure and HL7 v2 OBX segment mapping rules, as well as validation of the mapping transformation logic.

### Prerequisites
- System must support US Core DiagnosticReport Profile for Laboratory Reporting
- System must be capable of generating or transforming DiagnosticReport resources with media elements
- Access to DiagnosticReport instances that contain media elements
- Understanding of HL7 v2 OBX segment structure for media content

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- DiagnosticReport instances conforming to USCoreDiagnosticReportProfileLaboratoryReporting that contain `media` elements
- The DiagnosticReport resources should include:
  - `media` element with link to Media resource or inline content
  - Associated Media resources (if referenced)
  - Complete laboratory diagnostic report context

**Expected Outputs:**
- HL7 v2 message or mapping documentation showing OBX segments
- Verification that each DiagnosticReport.media element has corresponding OBX segment representation

### Required FHIR Operations
Based on the US Core Server Capability Statement, the following operations are supported and required:

1. **GET /DiagnosticReport/[id]** - Retrieve specific DiagnosticReport instances
2. **GET /DiagnosticReport?[search-parameters]** - Search for DiagnosticReport resources
3. **GET /Media/[id]** - Retrieve referenced Media resources (if media elements reference external Media resources)

### Validation Criteria

**Primary Assertions:**
1. **Media Element Presence Verification:**
   - Verify that DiagnosticReport instances contain `media` elements
   - Confirm that each media element is properly structured according to FHIR specification

2. **OBX Mapping Verification:**
   - For each DiagnosticReport.media element, verify existence of corresponding OBX segment in HL7 v2 output
   - Validate that OBX segment contains appropriate media-related data

3. **Content Mapping Accuracy:**
   - Verify that media content references (URLs, inline data) are properly mapped to OBX-5 (Observation Value)
   - Confirm that media type information is appropriately represented in OBX segments
   - Validate that media metadata (if present) is correctly transferred

4. **Structural Conformance:**
   - Ensure DiagnosticReport instances conform to USCoreDiagnosticReportProfileLaboratoryReporting
   - Verify that media elements follow FHIR DiagnosticReport.media structure requirements

**Test Steps:**
1. Retrieve DiagnosticReport resources that contain media elements
2. Extract all media elements from each DiagnosticReport
3. Obtain or generate HL7 v2 representation of the DiagnosticReport
4. Parse HL7 v2 message to identify OBX segments
5. Verify one-to-one correspondence between media elements and OBX segments
6. Validate content accuracy in the mapping transformation
7. Confirm that no media elements are omitted from the HL7 v2 representation

**Pass Criteria:**
- All DiagnosticReport.media elements have corresponding OBX segments in HL7 v2 output
- Media content and metadata are accurately represented in OBX segments
- No data loss occurs during the FHIR to HL7 v2 mapping process
- Mapping follows established HL7 v2 OBX segment structure standards

**Fail Criteria:**
- Any DiagnosticReport.media element lacks corresponding OBX segment
- Media content is incorrectly mapped or missing in OBX segments
- Structural errors in OBX segment generation
- Loss of essential media metadata during transformation

---

<a id='req-292'></a>

### REQ-292: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport conclusion to OBX.

**Text**: 

**Context**: 

**Actor**: USCoreDiagnosticReportProfileLaboratoryReporting

**Conformance**: SHALL

# Test Specification for REQ-292

## Requirement ID
REQ-292

## Requirement Analysis

### Testability Assessment
**Classification**: Automatically testable

**Rationale**: This requirement can be automatically validated by examining the HL7 v2 mapping information in the FHIR Implementation Guide documentation and verifying that the USCoreDiagnosticReportProfileLaboratoryReporting profile correctly maps the DiagnosticReport.conclusion element to the OBX segment. This is a structural mapping requirement that can be verified through automated analysis of the profile definitions.

### Complexity
**Level**: Simple

**Justification**: This is a straightforward mapping verification requirement that involves checking a single element mapping between FHIR and HL7 v2 formats within the profile documentation.

### Prerequisites
- Access to the US Core Implementation Guide documentation
- Access to the USCoreDiagnosticReportProfileLaboratoryReporting profile definition
- Access to the HL7 v2 mapping information within the profile
- Understanding of HL7 v2 OBX segment structure

## Test Implementation Strategy

### Required Inputs
**FHIR Resources**:
- USCoreDiagnosticReportProfileLaboratoryReporting profile definition from the Implementation Guide
- HL7 v2 mapping documentation associated with the profile

**Expected Outputs**:
- Confirmation that DiagnosticReport.conclusion element has a documented mapping to OBX segment
- Verification that the mapping is explicitly defined as required (SHALL conformance)

### Required FHIR Operations
**Primary Operations**:
- **Profile Definition Retrieval**: Access to StructureDefinition resource for `us-core-diagnosticreport-lab` profile
- **Mapping Documentation Analysis**: Review of the profile's HL7 v2 mapping section

**Note**: Based on the Capability Statement, DiagnosticReport resources are supported with the US Core DiagnosticReport Profile for Laboratory Results Reporting, confirming this profile is within scope.

### Validation Criteria

**Primary Assertions**:
1. **Mapping Existence Check**: Verify that the DiagnosticReport.conclusion element in the USCoreDiagnosticReportProfileLaboratoryReporting profile contains an explicit HL7 v2 mapping definition
2. **OBX Segment Mapping**: Confirm that the conclusion element is mapped specifically to the OBX segment in HL7 v2
3. **Conformance Level Verification**: Validate that the mapping is defined with SHALL conformance level (not MAY or SHOULD)
4. **Mapping Completeness**: Ensure the mapping provides sufficient detail to understand how conclusion content should be transformed to OBX format

**Test Passing Criteria**:
- The profile documentation explicitly states that DiagnosticReport.conclusion maps to OBX
- The mapping is marked as mandatory (SHALL)
- The mapping documentation is present and accessible within the profile definition
- No contradictory mapping information exists for the conclusion element

**Test Failure Conditions**:
- No mapping defined for DiagnosticReport.conclusion to OBX
- Mapping exists but is not marked as SHALL conformance
- Mapping documentation is missing or incomplete
- Conflicting mapping information is present

---

<a id='req-293'></a>

### REQ-293: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport conclusionCode to OBX.

**Text**: 

**Context**: 

**Actor**: USCoreDiagnosticReportProfileLaboratoryReporting

**Conformance**: SHALL

# Test Specification for REQ-293

## 1. Requirement ID
**REQ-293**: USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport conclusionCode to OBX

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Attestation

This requirement is not automatically testable through FHIR API operations because it specifically addresses HL7 v2 mapping behavior. The requirement mandates that when a US Core DiagnosticReport Profile for Laboratory Results Reporting contains a `conclusionCode` element, this data must be mapped to the OBX segment in HL7 v2 format. Since this involves transformation between FHIR and HL7 v2 formats, it requires attestation that the implementing system correctly performs this mapping.

### Complexity
**Moderate** - The requirement involves understanding both FHIR DiagnosticReport structure and HL7 v2 OBX segment mapping, but the specific mapping rule is straightforward.

### Prerequisites
- System must support US Core DiagnosticReport Profile for Laboratory Results Reporting
- System must have HL7 v2 transformation/mapping capabilities
- Test data should include DiagnosticReport resources with populated `conclusionCode` elements
- Access to both FHIR representation and corresponding HL7 v2 output for comparison

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources Required**:
- DiagnosticReport resources conforming to [US Core DiagnosticReport Profile for Laboratory Results Reporting](StructureDefinition-us-core-diagnosticreport-lab.html)
- Test resources must contain the `conclusionCode` element with valid coded values
- Resources should represent realistic laboratory reporting scenarios

**Expected Outputs**:
- Corresponding HL7 v2 messages containing OBX segments
- Documentation or attestation of mapping implementation
- Evidence that conclusionCode values are properly transferred to OBX segments

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for DiagnosticReport resources:

**Primary Operations**:
- `GET /DiagnosticReport/{id}` - Retrieve specific DiagnosticReport instances
- `GET /DiagnosticReport?patient={patient_id}` - Search for DiagnosticReports by patient
- `GET /DiagnosticReport?category={category}&patient={patient_id}` - Search by category and patient

**Supporting Search Parameters** (as per Capability Statement):
- `patient` - Required for searches
- `category` - Laboratory category filtering
- `code` - Specific test/report type
- `status` - Report status
- `date` - Report date range

### Validation Criteria

**For Attestation-Based Testing**:

1. **FHIR Resource Validation**:
   - Verify DiagnosticReport resources conform to US Core DiagnosticReport Profile for Laboratory Results Reporting
   - Confirm presence of `conclusionCode` elements in test data
   - Validate that conclusionCode values use appropriate coding systems

2. **Mapping Documentation Review**:
   - System must provide documentation describing how DiagnosticReport.conclusionCode maps to HL7 v2 OBX segments
   - Mapping specification should align with HL7 v2 OBX segment structure requirements
   - Documentation should specify OBX field positions used for conclusionCode data

3. **Implementation Attestation**:
   - Vendor/implementer attestation that the mapping is implemented as documented
   - Evidence that conclusionCode values are preserved in the transformation
   - Confirmation that coding system information is appropriately handled in OBX segments

4. **Sample Data Verification** (if available):
   - Compare FHIR DiagnosticReport instances with corresponding HL7 v2 messages
   - Verify conclusionCode values appear in the correct OBX segment fields
   - Confirm no data loss occurs during transformation
   - Validate that multiple conclusionCode values (if present) are handled correctly

**Pass Criteria**:
- All DiagnosticReport resources retrieved via supported operations conform to the US Core Laboratory profile
- System documentation clearly describes conclusionCode to OBX mapping
- Attestation confirms implementation of the mapping requirement
- Sample comparisons (if available) demonstrate accurate data transformation

**Fail Criteria**:
- DiagnosticReport resources do not conform to the required US Core profile
- Missing or inadequate mapping documentation
- Lack of implementation attestation
- Evidence of data loss or incorrect mapping in sample comparisons

---

<a id='req-294'></a>

### REQ-294: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport presentedForm to OBX.

**Text**: 

**Context**: 

**Actor**: USCoreDiagnosticReportProfileLaboratoryReporting

**Conformance**: SHALL

# Test Specification for REQ-294

## 1. Requirement ID
REQ-294

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified programmatically by examining DiagnosticReport resources that conform to the US Core DiagnosticReport Profile for Laboratory Results Reporting and validating the mapping of the `presentedForm` element to OBX segments in HL7 v2 format.

### Complexity
**Moderate** - The test requires understanding of both FHIR DiagnosticReport structure and HL7 v2 OBX segment mapping, along with validation of the presentedForm element's presence and proper mapping.

### Prerequisites
- US Core Server implementing DiagnosticReport Profile for Laboratory Results Reporting
- DiagnosticReport resources with `presentedForm` elements available in the test system
- Understanding of HL7 v2 OBX segment structure for validation
- Access to DiagnosticReport resources via FHIR REST API

## 3. Test Implementation Strategy

### Required Inputs
**Required FHIR Resources:**
- DiagnosticReport resources conforming to US Core DiagnosticReport Profile for Laboratory Results Reporting (`http://hl7.org/fhir/us/core/StructureDefinition/us-core-diagnosticreport-lab`)
- DiagnosticReport resources must contain the `presentedForm` element populated with attachment data

**Expected Outputs:**
- Validation confirmation that `presentedForm` elements are properly structured for OBX mapping
- Verification that attachment data in `presentedForm` contains appropriate content types and data
- Confirmation that the mapping preserves the integrity of the presented form data

### Required FHIR Operations
Based on the Capability Statement, the following supported operations will be used:

1. **DiagnosticReport Search Operations:**
   - `GET [base]/DiagnosticReport?patient=[id]` - Retrieve DiagnosticReports for a specific patient
   - `GET [base]/DiagnosticReport?patient=[id]&category=LAB` - Retrieve laboratory DiagnosticReports
   - `GET [base]/DiagnosticReport?patient=[id]&status=final` - Retrieve finalized DiagnosticReports
   - `GET [base]/DiagnosticReport/[id]` - Retrieve specific DiagnosticReport by ID

2. **Resource Read Operations:**
   - `GET [base]/DiagnosticReport/[id]` - Direct read of DiagnosticReport resources

### Validation Criteria

The following checks will verify conformance:

#### 1. DiagnosticReport Profile Conformance
- **Assertion**: DiagnosticReport resources MUST conform to US Core DiagnosticReport Profile for Laboratory Results Reporting
- **Validation**: Verify `meta.profile` contains `http://hl7.org/fhir/us/core/StructureDefinition/us-core-diagnosticreport-lab`

#### 2. PresentedForm Element Presence and Structure
- **Assertion**: When `presentedForm` is present, it MUST be properly structured for OBX mapping
- **Validation**: 
  - Verify `presentedForm` is an array of Attachment elements
  - Each attachment MUST have either `data` (base64 encoded) or `url` populated
  - Each attachment SHOULD have `contentType` specified
  - Each attachment MAY have `title` for identification

#### 3. Content Type Validation
- **Assertion**: PresentedForm attachments MUST have appropriate content types for OBX mapping
- **Validation**:
  - Verify `contentType` is present and contains valid MIME types
  - Common valid types include: `application/pdf`, `text/plain`, `text/html`, `application/xml`, `image/jpeg`, `image/png`

#### 4. Data Integrity Validation
- **Assertion**: PresentedForm data MUST be properly encoded and accessible for OBX mapping
- **Validation**:
  - If `data` is present, verify it contains valid base64 encoded content
  - If `url` is present, verify it contains a valid URL format
  - Verify at least one of `data` or `url` is populated for each attachment

#### 5. OBX Mapping Readiness
- **Assertion**: PresentedForm structure MUST support mapping to HL7 v2 OBX segments
- **Validation**:
  - Verify attachment size is reasonable for OBX segment limits
  - Verify content type is supported in HL7 v2 OBX.5 (Observation Value)
  - Verify encoding method is compatible with OBX.2 (Value Type)

#### 6. Laboratory Context Validation
- **Assertion**: DiagnosticReports with presentedForm MUST be in laboratory context
- **Validation**:
  - Verify `category` contains laboratory-related coding (e.g., `http://terminology.hl7.org/CodeSystem/v2-0074|LAB`)
  - Verify the DiagnosticReport is related to laboratory results

### Test Cases

#### Test Case 1: Basic PresentedForm Validation
- Search for laboratory DiagnosticReports with presentedForm
- Validate each presentedForm attachment structure
- Verify OBX mapping compatibility

#### Test Case 2: Multiple PresentedForm Attachments
- Retrieve DiagnosticReports with multiple presentedForm attachments
- Validate each attachment independently
- Ensure all attachments meet OBX mapping requirements

#### Test Case 3: Different Content Types
- Test presentedForm attachments with various content types
- Validate compatibility with OBX segment mapping
- Ensure proper encoding for different media types

#### Test Case 4: Data vs URL References
- Test both embedded data (base64) and URL-referenced attachments
- Validate both approaches support OBX mapping
- Verify accessibility and integrity of referenced content

### Success Criteria
- All DiagnosticReport resources conforming to US Core Laboratory profile properly structure presentedForm elements
- PresentedForm attachments contain all required elements for OBX mapping
- Content types and encoding methods are compatible with HL7 v2 OBX segments
- No validation errors when processing presentedForm elements for mapping purposes

---

<a id='req-295'></a>

### REQ-295: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport identifier to FiveWs.identifier.

**Text**: 

**Context**: 

**Actor**: USCoreDiagnosticReportProfileLaboratoryReporting

**Conformance**: SHALL

# Test Specification for REQ-295

## 1. Requirement ID
REQ-295

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified by examining FHIR DiagnosticReport resources that claim conformance to the US Core DiagnosticReport Profile for Laboratory Reporting and validating that the DiagnosticReport.identifier field is properly mapped according to the FiveWs pattern.

### Complexity
**Simple** - This is a straightforward structural validation requirement that involves checking the presence and proper mapping of the identifier field in DiagnosticReport resources.

### Prerequisites
- Test system must have access to DiagnosticReport resources that claim conformance to the US Core DiagnosticReport Profile for Laboratory Reporting
- Resources must include the `meta.profile` element indicating conformance to the US Core profile
- Test system must be able to retrieve DiagnosticReport resources via FHIR RESTful API

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: DiagnosticReport resources conforming to the US Core DiagnosticReport Profile for Laboratory Reporting
- **Profile URL**: `http://hl7.org/fhir/us/core/StructureDefinition/us-core-diagnosticreport-lab` (or equivalent US Core laboratory reporting profile)
- **Test Data**: Any DiagnosticReport resources available in the test system that claim conformance to the US Core laboratory reporting profile

### Required FHIR Operations
1. **GET /DiagnosticReport** - Retrieve DiagnosticReport resources
   - Optional search parameters can be used to filter results (e.g., `_profile`, `category`, `patient`)
   - This operation is supported per the US Core Server Capability Statement requirement to support US Core profiles

### Validation Criteria

#### Test Case 1: Identifier Mapping Validation
**Objective**: Verify that DiagnosticReport.identifier is properly mapped according to FiveWs.identifier pattern

**Test Steps**:
1. Retrieve DiagnosticReport resources that claim conformance to US Core DiagnosticReport Profile for Laboratory Reporting
   - Filter by `meta.profile` containing the US Core laboratory DiagnosticReport profile URL
2. For each conforming DiagnosticReport resource:
   - Verify that the `identifier` field exists
   - Validate that the identifier structure follows FHIR Identifier data type requirements
   - Confirm that the identifier serves as a business identifier for the diagnostic report

**Assertions**:
- **PASS**: DiagnosticReport resource contains at least one `identifier` element
- **PASS**: Each `identifier` element follows the FHIR Identifier data type structure
- **PASS**: The identifier appropriately serves as a business identifier mapping to FiveWs.identifier pattern
- **FAIL**: DiagnosticReport resource claiming US Core laboratory reporting profile conformance lacks the `identifier` field
- **FAIL**: Identifier structure does not conform to FHIR Identifier data type requirements

#### Test Case 2: Profile Conformance Validation
**Objective**: Ensure only resources claiming conformance to the US Core laboratory reporting profile are subject to this requirement

**Test Steps**:
1. Retrieve DiagnosticReport resources
2. Examine `meta.profile` elements
3. Apply identifier mapping validation only to resources claiming conformance to US Core DiagnosticReport Profile for Laboratory Reporting

**Assertions**:
- **PASS**: Only DiagnosticReport resources with appropriate US Core laboratory profile claims are tested
- **PASS**: Resources not claiming conformance to the profile are excluded from this specific test
- **FAIL**: Test incorrectly applies requirement to DiagnosticReport resources not claiming US Core laboratory profile conformance

#### Expected Test Results
- **Conformant System**: All DiagnosticReport resources claiming conformance to US Core DiagnosticReport Profile for Laboratory Reporting contain properly structured identifier elements
- **Non-Conformant System**: One or more DiagnosticReport resources claiming profile conformance lack the required identifier field or have improperly structured identifiers

#### Edge Cases to Consider
- DiagnosticReport resources with multiple identifiers (all should be valid)
- DiagnosticReport resources claiming multiple profile conformances
- Resources with empty or missing `meta.profile` elements (should be excluded from this test)

---

<a id='req-296'></a>

### REQ-296: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport status to FiveWs.status.

**Text**: 

**Context**: 

**Actor**: USCoreDiagnosticReportProfileLaboratoryReporting

**Conformance**: SHALL

# Test Specification for REQ-296

## Requirement ID
REQ-296

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified programmatically by examining the DiagnosticReport resource structure and validating that the status field correctly maps to the FiveWs pattern status element.

### Complexity
**Simple** - The requirement involves a straightforward field mapping validation within a single FHIR resource.

### Prerequisites
- US Core DiagnosticReport Profile for Laboratory Results Reporting implementation
- DiagnosticReport resources with populated status fields
- Access to FHIR server supporting US Core DiagnosticReport operations
- Understanding of FiveWs pattern mapping requirements

## Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: DiagnosticReport resources conforming to the US Core DiagnosticReport Profile for Laboratory Results Reporting
- **Data Requirements**: DiagnosticReport instances with various status values (registered, partial, preliminary, final, amended, corrected, appended, cancelled, entered-in-error, unknown)
- **System Access**: FHIR server endpoint with DiagnosticReport read capabilities

### Expected Outputs
- Validation confirmation that DiagnosticReport.status properly maps to FiveWs.status
- Test results indicating successful mapping for each status value tested
- Error reporting for any instances where the mapping is incorrect or missing

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and will be used:

- **READ**: `GET [base]/DiagnosticReport/[id]` - Retrieve specific DiagnosticReport resources
- **SEARCH**: `GET [base]/DiagnosticReport?patient=[reference]&status=[code]` - Search for DiagnosticReport resources by patient and status
- **SEARCH**: `GET [base]/DiagnosticReport?category=LAB` - Search for laboratory DiagnosticReport resources

### Validation Criteria

#### Primary Validation Checks:
1. **Status Field Presence**: Verify that each DiagnosticReport resource has a populated `status` field
2. **Status Value Validation**: Confirm that the status value is one of the allowed FHIR DiagnosticReport status codes
3. **FiveWs Mapping Compliance**: Validate that the DiagnosticReport.status correctly maps to the FiveWs.status pattern according to US Core specifications
4. **Profile Conformance**: Ensure the DiagnosticReport conforms to the US Core DiagnosticReport Profile for Laboratory Results Reporting

#### Specific Test Cases:
1. **Valid Status Values Test**:
   - Retrieve DiagnosticReport resources with different status values
   - Assert that each status value is properly mapped and accessible through the FiveWs pattern
   - Verify status values include: registered, partial, preliminary, final, amended, corrected, appended, cancelled, entered-in-error, unknown

2. **Laboratory Report Specific Test**:
   - Search for DiagnosticReport resources with category=LAB
   - Validate that laboratory-specific DiagnosticReport instances properly implement the status mapping
   - Confirm adherence to the US Core Laboratory Results profile requirements

3. **Cross-Reference Validation**:
   - For each DiagnosticReport, verify that the status field can be accessed both directly (`DiagnosticReport.status`) and through the FiveWs mapping pattern
   - Ensure consistency between the direct field access and the mapped FiveWs.status value

#### Success Criteria:
- All tested DiagnosticReport resources have a populated status field
- Status values conform to FHIR DiagnosticReport status value set
- FiveWs.status mapping is correctly implemented and accessible
- No discrepancies between direct status field and FiveWs mapped status
- Resources validate successfully against the US Core DiagnosticReport Profile for Laboratory Results Reporting

#### Failure Conditions:
- DiagnosticReport resource missing status field
- Status field contains invalid or non-conformant values
- FiveWs.status mapping is missing or incorrect
- Inconsistency between direct status field and mapped FiveWs status
- Resource fails validation against the specified US Core profile

---

<a id='req-297'></a>

### REQ-297: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport category to FiveWs.class.

**Text**: 

**Context**: 

**Actor**: USCoreDiagnosticReportProfileLaboratoryReporting

**Conformance**: SHALL

# Test Specification for REQ-297

## Requirement ID
REQ-297

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated testing by examining FHIR resource instances and validating that the DiagnosticReport.category field correctly maps to the FiveWs pattern's class element.

### Complexity
**Simple** - This is a straightforward mapping validation that requires checking a single field mapping between DiagnosticReport.category and FiveWs.class.

### Prerequisites
- System must support US Core DiagnosticReport Profile for Laboratory Results Reporting
- Test data must include DiagnosticReport resources conforming to the US Core Laboratory profile
- Access to DiagnosticReport resources through FHIR API endpoints

## Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: DiagnosticReport resources that conform to the US Core DiagnosticReport Profile for Laboratory Results Reporting (StructureDefinition-us-core-diagnosticreport-lab.html)
- **Test Data**: Any existing DiagnosticReport resources in the system under test that are used for laboratory reporting

### Expected Outputs
- Validation results confirming that DiagnosticReport.category elements are properly mapped to FiveWs.class
- Confirmation that the mapping follows the specified FiveWs Pattern Mapping requirements

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required:

1. **DiagnosticReport Search Operations**:
   - `GET [base]/DiagnosticReport?patient=[patient-id]` - Retrieve DiagnosticReport resources for analysis
   - `GET [base]/DiagnosticReport?category=LAB` - Retrieve laboratory DiagnosticReport resources specifically
   - `GET [base]/DiagnosticReport/[id]` - Retrieve specific DiagnosticReport instances

2. **Additional supported search parameters** (as per Capability Statement):
   - `category`, `code`, `date`, `_lastUpdated`, `patient`, `status`
   - Combined searches like `patient+category`, `patient+category+date`

### Validation Criteria

The test SHALL verify the following assertions for each DiagnosticReport resource that conforms to the US Core Laboratory profile:

1. **Category Field Presence**: 
   - DiagnosticReport.category field MUST be present
   - DiagnosticReport.category MUST contain at least one CodeableConcept

2. **FiveWs.class Mapping Validation**:
   - The DiagnosticReport.category field MUST be properly mapped to the FiveWs pattern's class element
   - For laboratory reports, verify that the category appropriately represents the classification aspect of the FiveWs pattern

3. **Profile Conformance**:
   - DiagnosticReport resources MUST declare conformance to the US Core DiagnosticReport Profile for Laboratory Results Reporting
   - Resources MUST pass FHIR validation against the specified profile

4. **Data Consistency**:
   - The category values MUST be consistent with laboratory reporting context
   - Category coding MUST use appropriate terminology systems as defined by the US Core profile

### Test Cases

**Test Case 1: Basic Category Mapping Validation**
- Retrieve DiagnosticReport resources using supported search parameters
- For each resource, verify that category field exists and contains valid CodeableConcept values
- Confirm that the category appropriately maps to FiveWs.class concept

**Test Case 2: Laboratory-Specific Category Validation**
- Filter DiagnosticReport resources to those conforming to the laboratory profile
- Validate that category values are appropriate for laboratory reporting context
- Verify mapping consistency across multiple laboratory DiagnosticReport instances

**Test Case 3: Profile Conformance Validation**
- Validate that DiagnosticReport resources declare conformance to US Core Laboratory profile
- Confirm that category mapping requirements are met according to the FiveWs pattern specification
- Verify that no laboratory DiagnosticReport resources lack the required category mapping

### Success Criteria
- All DiagnosticReport resources conforming to US Core Laboratory profile have properly mapped category fields
- Category values successfully represent the FiveWs.class classification
- No validation errors occur when checking the mapping implementation
- The mapping is consistent across all laboratory DiagnosticReport resources in the test dataset

---

<a id='req-298'></a>

### REQ-298: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport code to FiveWs.what[x].

**Text**: 

**Context**: 

**Actor**: USCoreDiagnosticReportProfileLaboratoryReporting

**Conformance**: SHALL

# Test Specification for REQ-298

## 1. Requirement ID
**REQ-298**: USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport code to FiveWs.what[x]

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be automatically verified by examining the FHIR profile structure definition and validating that the DiagnosticReport.code element has the appropriate FiveWs mapping metadata.

### Complexity
**Simple** - This is a structural mapping verification that involves checking profile metadata rather than runtime data validation.

### Prerequisites
- Access to the US Core DiagnosticReport Profile for Laboratory Results Reporting structure definition
- FHIR validation capabilities to inspect profile mappings
- Understanding of FiveWs pattern mapping requirements

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: 
  - StructureDefinition for US Core DiagnosticReport Profile for Laboratory Results Reporting (`http://hl7.org/fhir/us/core/StructureDefinition/us-core-diagnosticreport-lab`)
- **Expected Outputs**:
  - Confirmation that the DiagnosticReport.code element contains mapping to FiveWs.what[x]
  - Validation that the mapping is properly defined in the profile structure

### Required FHIR Operations
- **GET** `/metadata` - To retrieve server capability information
- **GET** `/StructureDefinition/us-core-diagnosticreport-lab` - To retrieve the US Core DiagnosticReport Profile for Laboratory Results Reporting structure definition

### Validation Criteria

#### Primary Validation
1. **Profile Structure Validation**:
   - Verify that the StructureDefinition for US Core DiagnosticReport Profile for Laboratory Results Reporting exists
   - Confirm the profile URL is `http://hl7.org/fhir/us/core/StructureDefinition/us-core-diagnosticreport-lab`

2. **Mapping Verification**:
   - Locate the `DiagnosticReport.code` element definition within the profile structure
   - Verify that the element contains a `mapping` array
   - Confirm that at least one mapping entry has:
     - `identity` field set to "FiveWs" or equivalent FiveWs pattern identifier
     - `map` field set to "FiveWs.what[x]" or equivalent what[x] mapping

3. **Conformance Validation**:
   - Verify that the mapping is marked as mandatory (SHALL) rather than optional
   - Ensure the mapping definition follows FHIR R4 StructureDefinition standards

#### Test Assertions
- **ASSERT**: StructureDefinition for US Core DiagnosticReport Laboratory profile exists
- **ASSERT**: DiagnosticReport.code element is defined in the profile
- **ASSERT**: DiagnosticReport.code element contains FiveWs mapping
- **ASSERT**: FiveWs mapping maps to "what[x]" element
- **ASSERT**: Mapping conforms to FHIR R4 mapping syntax requirements

#### Success Criteria
The test passes when:
1. The US Core DiagnosticReport Profile for Laboratory Results Reporting contains the required FiveWs mapping for the code element
2. The mapping correctly references FiveWs.what[x]
3. The mapping follows proper FHIR structure definition syntax
4. The mapping is designated as mandatory (SHALL level conformance)

#### Failure Scenarios
The test fails if:
- The profile structure definition cannot be retrieved
- The DiagnosticReport.code element lacks FiveWs mapping
- The mapping references incorrect FiveWs elements (not what[x])
- The mapping syntax is malformed or invalid
- The mapping is designated as optional rather than mandatory

---

<a id='req-299'></a>

### REQ-299: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport subject to FiveWs.subject[x].

**Text**: 

**Context**: 

**Actor**: USCoreDiagnosticReportProfileLaboratoryReporting

**Conformance**: SHALL

# Test Specification for REQ-299

## 1. Requirement ID
**REQ-299**: USCoreDiagnosticReportProfileLaboratoryReporting SHALL map DiagnosticReport.subject to FiveWs.subject[x]

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Automatically testable

This requirement verifies that the US Core DiagnosticReport Profile for Laboratory Results Reporting correctly implements the FiveWs pattern mapping for the subject element. This is testable by examining DiagnosticReport instances to ensure the subject field is properly mapped and populated according to the FiveWs pattern specification.

### Complexity
**Level**: Simple

The test involves validating a single field mapping within DiagnosticReport resources. The verification requires checking that the subject element exists and contains appropriate reference data.

### Prerequisites
- System implementing US Core DiagnosticReport Profile for Laboratory Results Reporting
- Access to DiagnosticReport resources with laboratory results
- DiagnosticReport instances must have populated subject fields
- Referenced Patient resources should be available for validation

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources Needed**:
- `DiagnosticReport` resources conforming to US Core DiagnosticReport Profile for Laboratory Results Reporting (`http://hl7.org/fhir/us/core/StructureDefinition/us-core-diagnosticreport-lab`)
- Associated `Patient` resources referenced by DiagnosticReport.subject

**Expected Outputs**:
- Validation results confirming DiagnosticReport.subject mapping compliance
- Confirmation that subject references are valid and resolvable
- Verification that FiveWs.subject[x] pattern requirements are met

### Required FHIR Operations
Based on the US Core Server Capability Statement, the following operations are supported and required:

1. **GET DiagnosticReport** - Retrieve DiagnosticReport resources
   - Supported search parameters: `patient`, `category`, `code`, `date`, `status`
   - Use patient-based searches to retrieve laboratory DiagnosticReports

2. **GET Patient** - Validate referenced Patient resources
   - Supported search parameters: `_id`, `identifier`, `name`
   - Required to verify subject references are valid

### Validation Criteria

**Primary Assertions**:
1. **Subject Element Presence**: DiagnosticReport.subject element MUST be present
2. **Reference Validity**: DiagnosticReport.subject MUST contain a valid reference to a Patient resource
3. **Reference Format**: Subject reference MUST follow FHIR reference format (`Patient/{id}` or absolute URL)
4. **FiveWs Mapping**: The subject element MUST satisfy FiveWs.subject[x] pattern requirements
5. **Resource Resolution**: Referenced Patient resource MUST be resolvable and valid

**Specific Test Cases**:

**Test Case 1: Subject Element Validation**
- Retrieve DiagnosticReport resources using patient search
- Assert that each DiagnosticReport has a populated subject element
- Verify subject element is not null or empty

**Test Case 2: Reference Integrity**
- For each DiagnosticReport.subject reference, extract the Patient ID
- Attempt to retrieve the referenced Patient resource
- Assert successful retrieval and valid Patient resource structure

**Test Case 3: FiveWs Pattern Compliance**
- Verify that DiagnosticReport.subject maps correctly to FiveWs.subject[x]
- Confirm the subject represents "who" the diagnostic report is about
- Validate that the subject reference maintains semantic meaning per FiveWs pattern

**Pass Criteria**:
- All DiagnosticReport instances conforming to US Core DiagnosticReport Profile for Laboratory Results Reporting have valid subject mappings
- 100% of subject references resolve to valid Patient resources
- No validation errors when checking FiveWs pattern compliance
- Subject elements contain meaningful patient references that align with diagnostic report context

**Failure Scenarios**:
- DiagnosticReport.subject is missing or null
- Subject reference points to non-existent or invalid Patient resource
- Subject reference format is malformed
- FiveWs pattern mapping requirements are not satisfied

---

<a id='req-300'></a>

### REQ-300: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport encounter to FiveWs.context.

**Text**: 

**Context**: 

**Actor**: USCoreDiagnosticReportProfileLaboratoryReporting

**Conformance**: SHALL

# Test Specification for REQ-300

## Requirement ID
REQ-300

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated through automated inspection of FHIR resources to verify that the DiagnosticReport.encounter element is properly mapped to the FiveWs.context pattern.

### Complexity
**Simple** - The requirement involves verifying a direct mapping between two well-defined FHIR elements within a single resource profile.

### Prerequisites
- System must support US Core DiagnosticReport Profile for Laboratory Results Reporting
- Test data must include DiagnosticReport resources that reference encounters
- System must be capable of returning DiagnosticReport resources via FHIR API

## Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- DiagnosticReport resources conforming to US Core DiagnosticReport Profile for Laboratory Results Reporting
- Associated Encounter resources (if available for validation)

**Expected Outputs:**
- DiagnosticReport resources with encounter element populated when an encounter context exists
- Confirmation that the encounter mapping aligns with FiveWs.context requirements

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required:

**Primary Operations:**
- `GET /DiagnosticReport` - Retrieve DiagnosticReport resources
- `GET /DiagnosticReport?patient={patient-id}` - Search for DiagnosticReports by patient
- `GET /DiagnosticReport?category={category}` - Search for DiagnosticReports by category (laboratory)

**Supporting Operations (if needed for validation):**
- `GET /Encounter/{encounter-id}` - Retrieve referenced Encounter resources for validation

### Validation Criteria

The test SHALL verify the following assertions:

#### Primary Validation
1. **Encounter Reference Presence**: When a DiagnosticReport has an associated encounter context, the `DiagnosticReport.encounter` element MUST be populated with a valid reference to an Encounter resource.

2. **Reference Format Validation**: The `DiagnosticReport.encounter` element MUST contain a valid FHIR Reference that follows the format:
   - `Reference(Encounter)` with either a relative or absolute URL
   - Include either `reference` or `identifier` sub-elements as per FHIR specification

3. **FiveWs Context Mapping**: The `DiagnosticReport.encounter` element effectively represents the FiveWs.context (where/when the diagnostic report was generated) as required by the mapping specification.

#### Test Cases

**Test Case 1: Laboratory DiagnosticReport with Encounter Context**
- **Given**: A DiagnosticReport resource with category containing laboratory coding
- **When**: The DiagnosticReport was generated in the context of a specific encounter
- **Then**: The `DiagnosticReport.encounter` element MUST be present and contain a valid Encounter reference

**Test Case 2: Encounter Reference Validation**
- **Given**: A DiagnosticReport with a populated encounter element
- **When**: Validating the encounter reference
- **Then**: The reference MUST be resolvable and point to a valid Encounter resource (if accessible)

**Test Case 3: Profile Conformance**
- **Given**: Any DiagnosticReport resource claiming conformance to US Core DiagnosticReport Profile for Laboratory Results Reporting
- **When**: The resource includes encounter context information
- **Then**: The encounter mapping MUST follow the FiveWs pattern requirements

#### Passing Criteria
A test implementation PASSES when:
- All DiagnosticReport resources that have encounter context properly populate the `encounter` element
- All encounter references are structurally valid FHIR References
- The mapping correctly represents the FiveWs.context pattern as specified
- Resources conform to the US Core DiagnosticReport Profile for Laboratory Results Reporting

#### Failing Criteria  
A test implementation FAILS when:
- DiagnosticReport resources with encounter context have empty or missing `encounter` elements
- Encounter references are malformed or invalid
- The encounter mapping does not align with FiveWs.context requirements
- Resources claiming conformance to the profile do not properly implement the mapping

---

<a id='req-301'></a>

### REQ-301: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport effective[x] to FiveWs.done[x].

**Text**: 

**Context**: 

**Actor**: USCoreDiagnosticReportProfileLaboratoryReporting

**Conformance**: SHALL

# Test Specification for REQ-301

## 1. Requirement ID
**REQ-301**: USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport effective[x] to FiveWs.done[x]

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be automatically verified by examining the structure definition mappings and validating that DiagnosticReport instances conforming to the US Core DiagnosticReport Profile for Laboratory Results Reporting contain the required mapping between `effective[x]` and `FiveWs.done[x]`.

### Complexity
**Simple** - This is a straightforward mapping verification that requires checking the presence and correct mapping of a single element.

### Prerequisites
- System must support US Core DiagnosticReport Profile for Laboratory Results Reporting
- System must be capable of returning DiagnosticReport resources via FHIR API
- Test data must include DiagnosticReport resources that claim conformance to the US Core Laboratory Reporting profile
- System must implement the DiagnosticReport resource type as specified in the capability statement

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: DiagnosticReport resources that declare conformance to the US Core DiagnosticReport Profile for Laboratory Results Reporting (`http://hl7.org/fhir/us/core/StructureDefinition/us-core-diagnosticreport-lab`)
- **Data Requirements**: DiagnosticReport resources with populated `effective[x]` elements (effectiveDateTime or effectivePeriod)
- **Profile Declaration**: Resources must include the profile claim in `meta.profile`

### Required FHIR Operations
Based on the capability statement, the following operations are supported for DiagnosticReport:
- `GET /DiagnosticReport` (search operations)
- `GET /DiagnosticReport/{id}` (read operations)

**Recommended Search Parameters** (from capability statement):
- `GET /DiagnosticReport?patient={patient_id}&category=LAB` - to retrieve laboratory diagnostic reports
- `GET /DiagnosticReport?patient={patient_id}&status=final` - to retrieve finalized reports

### Validation Criteria

#### Primary Validation Checks:
1. **Profile Conformance Verification**:
   - Verify that DiagnosticReport resources declare conformance to `http://hl7.org/fhir/us/core/StructureDefinition/us-core-diagnosticreport-lab`
   - Ensure resources pass FHIR validation against this profile

2. **Mapping Element Presence**:
   - Verify that DiagnosticReport resources contain the `effective[x]` element when required by the profile
   - Confirm that the element is properly populated with either:
     - `effectiveDateTime` (dateTime value), OR
     - `effectivePeriod` (Period with start and/or end)

3. **FiveWs Pattern Mapping**:
   - Validate that the `effective[x]` element conceptually maps to the FiveWs.done[x] pattern
   - This mapping is typically validated through the StructureDefinition mapping declarations rather than runtime data

#### Test Assertions:
- **PASS**: DiagnosticReport resource with laboratory category contains `effective[x]` element that is properly mapped to FiveWs.done[x] according to the profile definition
- **FAIL**: DiagnosticReport resource claiming laboratory profile conformance lacks the required `effective[x]` element or the mapping is not properly defined in the profile
- **SKIP**: No DiagnosticReport resources available for testing or resources do not claim conformance to the laboratory profile

#### Implementation Notes:
- The mapping verification primarily occurs at the profile definition level rather than individual resource instance level
- Runtime testing should focus on ensuring that laboratory DiagnosticReport instances contain the `effective[x]` element as required by the mapping
- Testing should accommodate "bring your own data" approach by working with any DiagnosticReport resources that claim conformance to the US Core laboratory profile
- The test should be flexible enough to handle both `effectiveDateTime` and `effectivePeriod` variants of the effective[x] element

---

<a id='req-302'></a>

### REQ-302: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport issued to FiveWs.recorded.

**Text**: 

**Context**: 

**Actor**: USCoreDiagnosticReportProfileLaboratoryReporting

**Conformance**: SHALL

# Test Specification for REQ-302

## 1. Requirement ID
REQ-302

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated testing by examining FHIR resource instances and validating the mapping between DiagnosticReport.issued and the FiveWs pattern's recorded element.

### Complexity
**Simple** - The requirement involves a straightforward field mapping validation that can be verified by checking if the DiagnosticReport.issued field is properly mapped to represent the FiveWs.recorded concept.

### Prerequisites
- System must support the US Core DiagnosticReport Profile for Laboratory Results Reporting
- Test data must include DiagnosticReport resources conforming to the US Core Laboratory Results profile
- DiagnosticReport resources must have the `issued` field populated to enable mapping validation
- System must be capable of FHIR REST API operations (READ) for DiagnosticReport resources

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- DiagnosticReport resources conforming to US Core DiagnosticReport Profile for Laboratory Results Reporting (StructureDefinition-us-core-diagnosticreport-lab.html)
- Resources must contain populated `issued` field values

**Expected Outputs:**
- Validation confirmation that DiagnosticReport.issued field correctly represents the FiveWs.recorded mapping
- Conformance verification that the mapping is implemented according to the US Core specification

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required:

**Primary Operations:**
- `GET /DiagnosticReport/{id}` - Retrieve specific DiagnosticReport instances
- `GET /DiagnosticReport?patient={patient_id}&category=LAB` - Search for laboratory DiagnosticReports by patient

**Supported Search Parameters (from Capability Statement):**
- `patient` (required for most searches)
- `category` 
- `code`
- `date`
- `status`
- `_lastUpdated`

### Validation Criteria

**Primary Assertions:**
1. **Profile Conformance Check:**
   - Verify that DiagnosticReport resources conform to US Core DiagnosticReport Profile for Laboratory Results Reporting
   - Validate that the resource passes FHIR profile validation for the laboratory reporting profile

2. **FiveWs Mapping Validation:**
   - Confirm that DiagnosticReport.issued field is present and populated
   - Verify that the DiagnosticReport.issued value represents a valid dateTime indicating when the diagnostic report was issued/recorded
   - Validate that the issued field semantically aligns with the FiveWs.recorded concept (representing when the report was recorded/documented)

3. **Data Type and Format Validation:**
   - Ensure DiagnosticReport.issued follows FHIR dateTime format requirements
   - Verify that the issued timestamp is logically consistent (not in the future, not before specimen collection if that data is available)

**Test Passing Criteria:**
- All retrieved DiagnosticReport resources conforming to the US Core Laboratory Results profile must have the `issued` field populated
- The `issued` field must contain valid dateTime values
- The mapping between DiagnosticReport.issued and FiveWs.recorded must be semantically correct (both represent when the information was recorded/documented)
- Resources must pass FHIR validation against the US Core DiagnosticReport Laboratory Results profile

**Test Case Approach:**
1. Retrieve DiagnosticReport resources using supported search parameters
2. Filter for resources conforming to US Core Laboratory Results profile
3. Validate each resource's `issued` field presence and format
4. Confirm the semantic mapping to FiveWs.recorded pattern
5. Report any non-conformant resources or mapping issues

This test specification accommodates a "bring your own data" approach by focusing on validation criteria that can be applied to any conformant DiagnosticReport resources provided by the testing system, without requiring specific test fixtures.

---

<a id='req-303'></a>

### REQ-303: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport performer to FiveWs.actor.

**Text**: 

**Context**: 

**Actor**: USCoreDiagnosticReportProfileLaboratoryReporting

**Conformance**: SHALL

# Test Specification for REQ-303

## 1. Requirement ID
REQ-303

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Automatically testable

This requirement can be automatically tested by examining DiagnosticReport instances that conform to the USCoreDiagnosticReportProfileLaboratoryReporting profile and verifying that the `performer` element is properly mapped according to the FiveWs pattern mapping specifications.

### Complexity
**Level**: Simple

The test involves straightforward validation of element presence and structure mapping between DiagnosticReport.performer and the FiveWs.actor pattern.

### Prerequisites
- System must support US Core DiagnosticReport Profile for Laboratory Results Reporting
- Test data must include DiagnosticReport resources with performer elements
- System must be capable of FHIR R4 DiagnosticReport resource operations
- Access to DiagnosticReport instances that claim conformance to the laboratory reporting profile

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources Needed**:
- DiagnosticReport resources that:
  - Conform to `http://hl7.org/fhir/us/core/StructureDefinition/us-core-diagnosticreport-lab`
  - Include `performer` elements
  - Represent laboratory reporting scenarios

**Test Data Requirements**:
- DiagnosticReport instances with populated `performer` elements
- Various performer types (Organization, Practitioner, PractitionerRole) to test different scenarios
- Both single and multiple performer scenarios

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required:

1. **DiagnosticReport Read Operations**:
   - `GET [base]/DiagnosticReport/[id]`
   - `GET [base]/DiagnosticReport?patient=[reference]&category=LAB`

2. **Search Operations** (as supported in Capability Statement):
   - `GET [base]/DiagnosticReport?patient=[patient-id]&category=[category-code]`
   - `GET [base]/DiagnosticReport?patient=[patient-id]&status=[status-code]`

### Expected Outputs
**Successful Test Results**:
- DiagnosticReport resources with properly structured performer elements
- Validation confirmation that performer mapping aligns with FiveWs.actor requirements
- Verification that performer elements contain appropriate resource references or inline data

### Validation Criteria

#### Primary Assertions:
1. **Profile Conformance Check**:
   - Verify DiagnosticReport resource declares conformance to `http://hl7.org/fhir/us/core/StructureDefinition/us-core-diagnosticreport-lab`

2. **Performer Element Presence**:
   - Assert that `DiagnosticReport.performer` element exists when required by the profile
   - Validate that performer element is not empty when present

3. **FiveWs.actor Mapping Validation**:
   - Verify performer element structure aligns with FiveWs pattern requirements for actor
   - Confirm performer contains valid resource references (Organization, Practitioner, or PractitionerRole)
   - Validate that performer references resolve to actual resources when using references

4. **Data Type Compliance**:
   - Assert performer element uses correct FHIR data types (Reference)
   - Verify reference format follows FHIR specification (relative, absolute, or logical references)

#### Secondary Assertions:
1. **Cardinality Compliance**:
   - Verify performer cardinality matches profile requirements (0..* for laboratory reporting)

2. **Resource Reference Validation**:
   - When performer contains references, validate they point to appropriate resource types
   - Confirm referenced resources exist and are accessible (when using relative references)

#### Test Pass Criteria:
- All DiagnosticReport instances claiming conformance to the laboratory reporting profile have performer elements that properly map to FiveWs.actor pattern
- Performer elements contain valid, well-formed resource references or inline data
- No validation errors occur when processing performer elements according to FiveWs mapping requirements

#### Test Fail Criteria:
- DiagnosticReport instances lack required performer elements
- Performer elements contain invalid references or malformed data
- Performer mapping does not align with FiveWs.actor pattern requirements
- Profile validation fails for performer element structure

---

<a id='req-304'></a>

### REQ-304: The USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport resultsInterpreter to FiveWs.actor.

**Text**: 

**Context**: 

**Actor**: USCoreDiagnosticReportProfileLaboratoryReporting

**Conformance**: SHALL

# Test Specification for REQ-304

## 1. Requirement ID
**REQ-304**: USCoreDiagnosticReportProfileLaboratoryReporting SHALL map the DiagnosticReport resultsInterpreter to FiveWs.actor

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Automatically testable

This requirement can be automatically verified by examining DiagnosticReport resources conforming to the US Core DiagnosticReport Profile for Laboratory Results Reporting and validating that the `resultsInterpreter` element is properly populated and mapped according to the FiveWs pattern mapping specification.

### Complexity
**Level**: Simple

The requirement involves a straightforward validation of element presence and proper mapping within a single FHIR resource type.

### Prerequisites
- System must support the US Core DiagnosticReport Profile for Laboratory Results Reporting
- Test data must include DiagnosticReport resources with `resultsInterpreter` elements populated
- System must be capable of FHIR R4 DiagnosticReport resource operations as defined in the US Core Server Capability Statement

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources**:
- DiagnosticReport resources conforming to `http://hl7.org/fhir/us/core/StructureDefinition/us-core-diagnosticreport-lab`
- The DiagnosticReport resources should contain populated `resultsInterpreter` elements
- Referenced Practitioner or PractitionerRole resources (if resultsInterpreter references these resource types)

**Test Data Requirements**:
- DiagnosticReport resources with various resultsInterpreter configurations:
  - Direct Practitioner references
  - PractitionerRole references
  - Organization references (if applicable)
  - Multiple resultsInterpreter entries (to test cardinality handling)

### Required FHIR Operations
Based on the US Core Server Capability Statement, the following operations are supported and required:

1. **GET DiagnosticReport** - Retrieve DiagnosticReport resources
   - Supported search parameters: `category`, `code`, `date`, `_lastUpdated`, `patient`, `status`
   - Combined searches: `patient+category+_lastUpdated`, `patient+status`, `patient+category`, `patient+category+date`, `patient+code`, `patient+code+date`

2. **GET referenced resources** - Retrieve Practitioner, PractitionerRole, or Organization resources referenced by resultsInterpreter
   - For Practitioner: `_id`, `identifier`, `name` searches supported
   - For PractitionerRole: `practitioner`, `specialty` searches supported
   - For Organization: `address`, `name` searches supported

### Validation Criteria

**Primary Assertions**:

1. **Element Presence Validation**:
   - Verify that DiagnosticReport resources conforming to US Core Laboratory profile contain the `resultsInterpreter` element when a results interpreter is involved in the diagnostic report
   - Assert that `resultsInterpreter` is populated with valid FHIR references

2. **FiveWs.actor Mapping Validation**:
   - Verify that the `resultsInterpreter` element properly represents the "who" aspect of the FiveWs pattern (actor)
   - Assert that referenced resources (Practitioner, PractitionerRole, Organization) are accessible and contain appropriate identifying information

3. **Reference Integrity Validation**:
   - Validate that all `resultsInterpreter` references resolve to valid FHIR resources
   - Confirm that referenced resources conform to their respective US Core profiles where applicable

4. **Cardinality Compliance**:
   - Verify that the cardinality constraints for `resultsInterpreter` are respected according to the US Core Laboratory DiagnosticReport profile

**Test Execution Steps**:

1. **Discovery Phase**:
   - Query for DiagnosticReport resources using supported search parameters
   - Filter for resources conforming to the US Core Laboratory DiagnosticReport profile

2. **Validation Phase**:
   - For each retrieved DiagnosticReport:
     - Check if `resultsInterpreter` is present and populated
     - Validate reference format and integrity
     - Retrieve referenced resources and verify they are accessible
     - Confirm proper FiveWs.actor mapping semantics

3. **Compliance Assessment**:
   - Pass: All DiagnosticReport resources with resultsInterpreter elements properly map to FiveWs.actor pattern
   - Fail: Any DiagnosticReport resource lacks proper resultsInterpreter mapping or contains invalid references

**Expected Outcomes**:
- **Pass Condition**: All US Core Laboratory DiagnosticReport resources demonstrate proper mapping of `resultsInterpreter` to FiveWs.actor, with valid references and appropriate semantic representation
- **Fail Condition**: Any DiagnosticReport resource fails to properly map `resultsInterpreter` to the FiveWs.actor pattern or contains invalid/unresolvable references

---

<a id='req-458'></a>

### REQ-458: US Core DiagnosticReport Profile for Laboratory Results Reporting implementation

**Text**: 

**Context**: System conformance to US Core DiagnosticReport (Laboratory) Profile.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-458

## 1. Requirement ID
**REQ-458**: US Core DiagnosticReport Profile for Laboratory Results Reporting implementation

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be systematically validated through automated conformance testing of DiagnosticReport resources against the US Core Laboratory DiagnosticReport profile.

### Complexity
**Moderate** - The test involves profile validation, structural conformance checking, and verification of must-support elements and required value sets, but follows established FHIR validation patterns.

### Prerequisites
- System must implement FHIR R4
- System must support DiagnosticReport resource
- System must have laboratory diagnostic report data available for testing
- System must implement US Core Server CapabilityStatement capabilities for DiagnosticReport
- FHIR validator with US Core profiles loaded
- Test data should include various types of laboratory reports (chemistry, hematology, microbiology, etc.)

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- DiagnosticReport resources representing laboratory results from the system under test
- Associated Patient resources referenced by the DiagnosticReport
- Associated Observation resources referenced by the DiagnosticReport.result
- Associated Practitioner/PractitionerRole resources for performers
- Associated Organization resources for responsible organizations

**Expected Outputs:**
- Validation results confirming conformance to US Core DiagnosticReport Laboratory profile
- Confirmation of required elements presence and correct data types
- Verification of proper resource references and relationships

### Required FHIR Operations
Based on US Core Server CapabilityStatement:

1. **DiagnosticReport read operations**
   - `GET [base]/DiagnosticReport/[id]`

2. **DiagnosticReport search operations** (as supported by US Core Server capability):
   - `GET [base]/DiagnosticReport?patient=[reference]`
   - `GET [base]/DiagnosticReport?patient=[reference]&category=[code]`
   - `GET [base]/DiagnosticReport?patient=[reference]&code=[code]`
   - `GET [base]/DiagnosticReport?patient=[reference]&date=[date]`
   - `GET [base]/DiagnosticReport?patient=[reference]&status=[code]`

### Validation Criteria

**Profile Conformance Validation:**
- Each DiagnosticReport resource MUST validate against the US Core DiagnosticReport Laboratory profile (`http://hl7.org/fhir/us/core/StructureDefinition/us-core-diagnosticreport-lab`)
- FHIR validator MUST return no errors for profile conformance

**Required Elements Verification:**
- `DiagnosticReport.status` MUST be present and contain valid code from required value set
- `DiagnosticReport.category` MUST be present and include laboratory category code
- `DiagnosticReport.code` MUST be present with appropriate LOINC code for laboratory report type
- `DiagnosticReport.subject` MUST reference a US Core Patient resource
- `DiagnosticReport.effectiveDateTime` or `DiagnosticReport.effectivePeriod` MUST be present
- `DiagnosticReport.issued` MUST be present for final/amended reports

**Must Support Elements Verification:**
- Verify presence of must-support elements as defined in the US Core Laboratory DiagnosticReport profile
- `DiagnosticReport.identifier` should be populated when available
- `DiagnosticReport.basedOn` should reference appropriate ServiceRequest when available  
- `DiagnosticReport.result` should reference US Core Laboratory Result Observation profiles
- `DiagnosticReport.performer` should reference US Core Practitioner, PractitionerRole, or Organization

**Reference Integrity Validation:**
- All resource references MUST resolve to valid resources
- Referenced Patient resources MUST conform to US Core Patient profile
- Referenced Observation resources in results MUST conform to US Core Laboratory Result Observation profile
- Referenced Practitioner/PractitionerRole resources MUST conform to respective US Core profiles

**Value Set Binding Validation:**
- `DiagnosticReport.status` MUST use codes from DiagnosticReportStatus value set
- `DiagnosticReport.category` MUST include appropriate laboratory category codes
- Verify required/extensible value set bindings are properly implemented

**Data Type and Cardinality Validation:**
- Verify all elements conform to specified data types
- Verify cardinality constraints (0..1, 1..*, etc.) are satisfied
- Verify conditional requirements and constraints defined in the profile

**Interoperability Validation:**
- System MUST respond appropriately to search requests for DiagnosticReport resources
- Returned resources MUST be valid US Core Laboratory DiagnosticReport instances
- Search results MUST properly filter based on search parameters
- System MUST support the search parameters defined in US Core Server CapabilityStatement

**Success Criteria:**
- All DiagnosticReport resources validate successfully against US Core Laboratory DiagnosticReport profile
- All required and must-support elements are present and properly formatted
- All resource references resolve correctly and reference conformant resources
- Search operations return appropriate results and conform to US Core requirements
- No validation errors are reported by FHIR validator for profile conformance

---

<a id='req-459'></a>

### REQ-459: US Core DiagnosticReport Profile for Report and Note Exchange implementation

**Text**: 

**Context**: System conformance to US Core DiagnosticReport (Report and Note Exchange) Profile.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-459

## 1. Requirement ID
**REQ-459**: US Core DiagnosticReport Profile for Report and Note Exchange implementation

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified through automated testing by validating DiagnosticReport resources against the US Core DiagnosticReport Profile for Report and Note Exchange and testing related FHIR operations.

### Complexity
**Moderate** - Requires validation of profile conformance, data element requirements, and API operations, but follows standard FHIR testing patterns.

### Prerequisites
- System must implement FHIR R4
- System must have DiagnosticReport resources available for testing
- System must support the US Core Server capability requirements
- Test client must have appropriate authentication/authorization to access DiagnosticReport resources
- System must be configured with test data containing DiagnosticReport resources that represent reports and notes

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- DiagnosticReport resources that claim conformance to the US Core DiagnosticReport Profile for Report and Note Exchange
- Associated Patient resources (referenced by DiagnosticReport.subject)
- Associated Practitioner/PractitionerRole resources (if referenced by DiagnosticReport.performer)
- Associated Organization resources (if referenced by DiagnosticReport.performer or contained within PractitionerRole)

**Expected Outputs:**
- Valid DiagnosticReport resources conforming to the US Core profile
- Successful FHIR operation responses
- Proper resource relationships and references

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations should be supported for DiagnosticReport:

1. **READ**: `GET [base]/DiagnosticReport/[id]`
2. **SEARCH**: `GET [base]/DiagnosticReport` with supported search parameters
3. **VREAD** (if supported): `GET [base]/DiagnosticReport/[id]/_history/[vid]`

**Search Parameters** (as typically required by US Core):
- `patient` - Search by patient reference
- `category` - Search by diagnostic service category
- `code` - Search by diagnostic report code
- `date` - Search by report date
- `status` - Search by report status

### Validation Criteria

#### Profile Conformance Validation
1. **Profile Declaration**: Each DiagnosticReport resource SHALL declare conformance to `http://hl7.org/fhir/us/core/StructureDefinition/us-core-diagnosticreport-note`
2. **Profile Validation**: All DiagnosticReport resources SHALL pass validation against the US Core DiagnosticReport Profile for Report and Note Exchange using the official FHIR validator
3. **Required Elements**: Verify presence and validity of all required data elements as defined in the profile

#### API Operation Validation
1. **READ Operation**:
   - System SHALL successfully return DiagnosticReport resources when requested by ID
   - Returned resources SHALL conform to the US Core profile
   - HTTP response SHALL return status 200 for existing resources
   - HTTP response SHALL return appropriate error codes (404) for non-existent resources

2. **SEARCH Operation**:
   - System SHALL support search operations on DiagnosticReport resources
   - System SHALL support required search parameters as defined in the US Core specification
   - Search results SHALL only include DiagnosticReport resources that conform to the US Core profile
   - Search results SHALL be returned in a valid Bundle resource
   - System SHALL support search combinations (e.g., patient + category)

#### Data Quality and Relationship Validation
1. **Reference Integrity**: All resource references (e.g., subject, performer) SHALL resolve to valid resources or be contained resources
2. **Code System Usage**: Coded elements SHALL use appropriate code systems as specified in the US Core profile
3. **Date Formats**: All date/dateTime elements SHALL conform to FHIR date/dateTime requirements
4. **Status Values**: DiagnosticReport.status SHALL contain valid values from the required value set

#### Interoperability Validation
1. **Content Requirements**: DiagnosticReport resources SHALL contain sufficient clinical content to support the "Report and Note Exchange" use case
2. **Narrative Generation**: Resources SHOULD include human-readable narrative text
3. **Categorization**: Resources SHALL be properly categorized using appropriate category codes

#### Error Handling Validation
1. **Invalid Requests**: System SHALL return appropriate HTTP error codes for malformed requests
2. **Authorization**: System SHALL properly handle unauthorized access attempts
3. **Resource Not Found**: System SHALL return HTTP 404 for requests to non-existent DiagnosticReport resources

### Pass/Fail Criteria
**Test PASSES if:**
- All DiagnosticReport resources validate successfully against the US Core profile
- All required FHIR operations return expected responses with appropriate HTTP status codes
- All resource references are valid and resolvable
- Search operations return properly filtered and formatted results
- Error conditions are handled appropriately

**Test FAILS if:**
- Any DiagnosticReport resource fails profile validation
- Required FHIR operations are not supported or return incorrect responses
- Resource references are broken or invalid
- Search operations do not function as specified
- System does not handle error conditions appropriately

---



<a id='documentreference'></a>

## DocumentReference

<a id='req-184'></a>

### REQ-184: The system shall ensure the DocumentReference status is set to "Current".

**Text**: 

**Context**: 

**Actor**: DocumentReference system

**Conformance**: SHALL

# Test Specification for REQ-184

## 1. Requirement ID
REQ-184

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified through automated inspection of DocumentReference resources returned by the system to ensure the status field is set to "current".

### Complexity
**Simple** - The test involves checking a single field value in DocumentReference resources.

### Prerequisites
- System must support the DocumentReference resource as specified in the US Core Implementation Guide
- System must have DocumentReference resources available for testing
- System must support at least one of the required search operations for DocumentReference (patient+category, patient+type, or patient alone)
- System must implement US Core DocumentReference Profile or US Core ADI DocumentReference Profile

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: DocumentReference resources conforming to US Core DocumentReference Profile and/or US Core ADI DocumentReference Profile
- **Test Data**: Any existing DocumentReference resources in the system (bring your own data approach)
- **Patient References**: Valid patient IDs that have associated DocumentReference resources

### Required FHIR Operations
Based on the Capability Statement, the system SHALL support:
- `GET [base]/DocumentReference/[id]` (read operation)
- `GET [base]/DocumentReference?patient=[reference]` (search by patient)
- `GET [base]/DocumentReference?patient=[reference]&category=[token]` (search by patient and category) 
- `GET [base]/DocumentReference?patient=[reference]&type=[token]` (search by patient and type)

### Validation Criteria

#### Test Case 1: Direct Resource Read
**Objective**: Verify DocumentReference status is "current" when accessing resources directly by ID

**Steps**:
1. Identify available DocumentReference resource IDs in the system
2. Execute `GET [base]/DocumentReference/[id]` for each identified resource
3. Parse the returned DocumentReference resource
4. Validate that `DocumentReference.status` field exists
5. Assert that `DocumentReference.status` value equals "current"

**Pass Criteria**: All DocumentReference resources retrieved directly have status = "current"

#### Test Case 2: Search-Based Resource Retrieval
**Objective**: Verify DocumentReference status is "current" for resources returned through search operations

**Steps**:
1. Identify patients with DocumentReference resources
2. Execute search operations using supported parameters:
   - `GET [base]/DocumentReference?patient=[patient-id]`
   - `GET [base]/DocumentReference?patient=[patient-id]&category=[category-code]`
   - `GET [base]/DocumentReference?patient=[patient-id]&type=[type-code]`
3. Parse all DocumentReference resources in the search bundle results
4. For each DocumentReference in the results:
   - Validate that `DocumentReference.status` field exists
   - Assert that `DocumentReference.status` value equals "current"

**Pass Criteria**: All DocumentReference resources returned through search operations have status = "current"

#### Test Case 3: Profile Conformance Validation
**Objective**: Ensure the status requirement applies to both supported DocumentReference profiles

**Steps**:
1. Retrieve DocumentReference resources that conform to US Core DocumentReference Profile
2. Retrieve DocumentReference resources that conform to US Core ADI DocumentReference Profile (if supported)
3. For each profile type:
   - Verify `DocumentReference.status` = "current"
   - Confirm the resource conforms to the respective profile constraints

**Pass Criteria**: All DocumentReference resources, regardless of which US Core profile they conform to, have status = "current"

### Error Handling
- If no DocumentReference resources are found, the test should report "No resources available for testing" rather than fail
- If the system returns HTTP errors (400, 401, 403, 404), these should be logged but may not constitute a test failure unless they prevent proper testing
- Resources that fail profile validation should be noted but don't automatically fail the status requirement test

### Reporting Requirements
- Total number of DocumentReference resources tested
- Number of resources with correct status ("current")
- Number of resources with incorrect status (if any)
- Details of any resources that failed the status requirement
- Breakdown by profile type (US Core DocumentReference vs US Core ADI DocumentReference)

---

<a id='req-185'></a>

### REQ-185: The system shall categorize the DocumentReference under "Clinical".

**Text**: 

**Context**: 

**Actor**: DocumentReference system

**Conformance**: SHALL

# Test Specification for REQ-185

## 1. Requirement ID
**REQ-185**: The system shall categorize the DocumentReference under "Clinical"

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified by examining the `category` field in DocumentReference resources to ensure they contain appropriate clinical categorization codes.

### Complexity
**Simple** - The test involves validating a single field value against expected clinical category codes.

### Prerequisites
- System must support DocumentReference resources
- System must have at least one DocumentReference resource available for testing
- DocumentReference resources must be accessible via FHIR REST API
- System must support US Core DocumentReference profile (as indicated by the discharge summary context)

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: DocumentReference resources present in the system under test
- **Expected Outputs**: DocumentReference resources with `category` field populated with clinical categorization codes

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required for testing:
- `GET /DocumentReference/{id}` - Read specific DocumentReference resources
- `GET /DocumentReference` - Search for DocumentReference resources (if search capabilities are supported)

### Validation Criteria

#### Primary Validation
1. **Category Field Presence**: Each DocumentReference resource SHALL have a `category` field populated
2. **Clinical Category Verification**: The `category` field SHALL contain at least one coding that indicates clinical categorization

#### Specific Assertions for Passing Tests

**Test Case 1: Individual DocumentReference Validation**
- **Given**: A DocumentReference resource exists in the system
- **When**: The resource is retrieved via GET operation
- **Then**: 
  - The resource SHALL contain a `category` field
  - The `category` field SHALL contain at least one CodeableConcept
  - At least one CodeableConcept in the `category` field SHALL contain a coding that represents clinical categorization
  - Common clinical category codes to validate against include:
    - LOINC codes for clinical documents
    - HL7 DocumentClassValueSet codes (e.g., clinical-note)
    - US Core DocumentReference Category codes

**Test Case 2: Bulk Validation (if multiple DocumentReferences exist)**
- **Given**: Multiple DocumentReference resources exist in the system
- **When**: Resources are retrieved via search or individual GET operations
- **Then**: ALL DocumentReference resources SHALL meet the category requirements defined in Test Case 1

#### Expected Clinical Category Values
The test should validate against recognized clinical category coding systems such as:
- US Core DocumentReference Category ValueSet
- LOINC document type codes
- HL7 FHIR DocumentReference category codes indicating clinical context

#### Response Validation
- HTTP Status Code: 200 (OK) for successful retrieval
- Content-Type: application/fhir+json (as JSON support is required per Capability Statement)
- Resource validation: Each DocumentReference SHALL conform to the US Core DocumentReference profile structure

#### Error Handling Validation
- If no DocumentReference resources exist, the test should be marked as inconclusive rather than failed
- HTTP 404 responses for non-existent resources should be handled appropriately
- Authentication/authorization errors (401/403) should be handled per the Capability Statement requirements

---

<a id='req-460'></a>

### REQ-460: US Core ADI DocumentReference Profile implementation

**Text**: 

**Context**: System conformance to US Core ADI DocumentReference Profile.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-460

## 1. Requirement ID
REQ-460

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated validation of DocumentReference resources against the US Core ADI DocumentReference Profile, combined with FHIR operations testing.

### Complexity
**Moderate** - Requires validation of profile conformance, search capabilities, and proper resource structure, but follows standard FHIR validation patterns.

### Prerequisites
- System must be configured as a US Core Server
- System must have DocumentReference resources available for testing
- System must support JSON format (required by US Core Server capability)
- Test client must have appropriate authorization/access credentials
- System should have at least one DocumentReference resource that represents an Advance Directive Interoperability (ADI) document

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: DocumentReference resources that claim conformance to the US Core ADI DocumentReference Profile
- **System Endpoint**: Base FHIR server URL
- **Authentication**: Valid credentials/tokens as required by the system
- **Test Data**: Any existing DocumentReference resources in the system that represent advance directive documents

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations must be supported:

1. **GET** `/DocumentReference/{id}` - Read individual DocumentReference resources
2. **GET** `/DocumentReference` - Search for DocumentReference resources
3. **GET** `/metadata` - Retrieve server capability statement

### Validation Criteria

#### Profile Conformance Validation
- **Assertion 1**: Retrieved DocumentReference resources that claim ADI profile conformance SHALL validate against the US Core ADI DocumentReference Profile using FHIR validation
- **Assertion 2**: Resources SHALL include `meta.profile` element referencing the US Core ADI DocumentReference Profile URL (as per US Core Server SHOULD requirement)
- **Assertion 3**: All Must Support elements defined in the US Core ADI DocumentReference Profile SHALL be present when data is available

#### Server Capability Validation
- **Assertion 4**: Server metadata SHALL declare support for DocumentReference resource type
- **Assertion 5**: Server SHALL support JSON format for all DocumentReference interactions
- **Assertion 6**: Server SHALL return appropriate HTTP status codes:
  - 200 for successful reads
  - 400 for invalid parameters
  - 401/403 for unauthorized requests
  - 404 for unknown resources

#### Resource Structure Validation
- **Assertion 7**: DocumentReference resources SHALL conform to FHIR R4 base resource requirements
- **Assertion 8**: Required elements as defined by the US Core ADI DocumentReference Profile SHALL be present
- **Assertion 9**: Code systems and value sets used SHALL align with those specified in the profile

#### Interoperability Validation
- **Assertion 10**: Resources SHALL be retrievable via standard FHIR RESTful read operations
- **Assertion 11**: Resources SHALL be searchable using supported search parameters for DocumentReference
- **Assertion 12**: Server SHALL handle requests according to US Core General Requirements

#### Error Handling Validation
- **Assertion 13**: Server SHALL reject unauthorized requests with appropriate HTTP status codes (401, 403, or 404)
- **Assertion 14**: Server SHALL handle invalid requests with HTTP 400 status and appropriate error messages

### Test Execution Approach
1. **Discovery Phase**: Query server metadata to confirm DocumentReference support
2. **Resource Retrieval**: Retrieve available DocumentReference resources
3. **Profile Validation**: Validate retrieved resources against US Core ADI DocumentReference Profile
4. **Conformance Verification**: Verify all Must Support elements and profile-specific requirements
5. **Error Scenario Testing**: Test appropriate error responses for invalid requests

### Success Criteria
The system passes REQ-460 when:
- All DocumentReference resources claiming ADI profile conformance validate successfully against the profile
- Server demonstrates proper support for DocumentReference operations as defined in US Core Server CapabilityStatement
- All assertions listed above pass for the available test data
- System handles both successful operations and error conditions appropriately

---

<a id='req-461'></a>

### REQ-461: US Core DocumentReference Profile implementation

**Text**: 

**Context**: System conformance to US Core DocumentReference Profile.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-461

## 1. Requirement ID
REQ-461: US Core DocumentReference Profile implementation

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated testing by examining DocumentReference resources returned by the system and validating them against the US Core DocumentReference Profile.

### Complexity
**Moderate** - The test involves profile validation, Must Support element verification, and potentially testing multiple interactions (read, search) to fully assess conformance.

### Prerequisites
- System must be configured as a US Core Server
- System must have DocumentReference resources available for testing
- System must support JSON format (required by US Core Server capability)
- Valid authentication credentials for accessing the system
- System must implement appropriate security controls

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: DocumentReference resources present in the system under test
- **Test Data**: Any existing DocumentReference instances in the system (bring your own data approach)
- **Authentication**: Valid credentials/tokens for system access
- **Base URL**: FHIR server endpoint URL

### Expected Outputs
- DocumentReference resources that validate against the US Core DocumentReference Profile
- Appropriate HTTP response codes (200, 400, 401, 403, 404 as specified)
- JSON-formatted responses
- Resources with proper `meta.profile` declarations (recommended)

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and should be tested:

1. **GET /DocumentReference/[id]** (read operation)
2. **GET /DocumentReference?[search-parameters]** (search operation)
3. **System-level operations** (if supported): batch, transaction, search-system, history-system

### Validation Criteria

#### Primary Conformance Checks
1. **Profile Validation**
   - All returned DocumentReference resources SHALL validate against the US Core DocumentReference Profile
   - Resources SHALL comply with all profile constraints and cardinalities

2. **Must Support Elements**
   - All Must Support elements defined in the US Core DocumentReference Profile SHALL be populated when data is available
   - System SHALL support all Must Support search parameters for DocumentReference

3. **Response Format**
   - System SHALL return responses in JSON format
   - System SHOULD support XML format (optional verification)

4. **Meta Profile Declaration**
   - Resources SHOULD include `meta.profile` attribute identifying the US Core DocumentReference Profile
   - Profile URL should be: `http://hl7.org/fhir/us/core/StructureDefinition/us-core-documentreference`

#### HTTP Response Validation
1. **Success Responses**
   - Valid requests SHALL return HTTP 200 status code
   - Response body SHALL contain valid FHIR DocumentReference resource(s)

2. **Error Handling**
   - Invalid parameters SHALL return HTTP 400 (Bad Request)
   - Unauthorized requests SHALL return HTTP 401, 403, or 404
   - Unknown resources SHALL return HTTP 404

#### Security Compliance
1. **Authentication/Authorization**
   - System SHALL reject unauthorized requests appropriately
   - System SHALL implement proper security controls as per US Core security requirements

#### Data Integrity
1. **Resource References**
   - All references to other US Core Profiles SHALL be valid
   - Referenced resources SHALL conform to their respective US Core profiles when present

### Test Execution Steps

1. **Discovery Phase**
   - Query system for available DocumentReference resources using search operations
   - Identify test candidates from existing data

2. **Profile Validation Phase**
   - Retrieve DocumentReference resources via read operations
   - Validate each resource against US Core DocumentReference Profile using FHIR validator
   - Verify Must Support elements are properly implemented

3. **Interaction Testing Phase**
   - Test supported search parameters and interactions
   - Verify proper HTTP response codes for various scenarios
   - Test error handling with invalid requests

4. **Format and Metadata Validation**
   - Confirm JSON response format compliance
   - Verify meta.profile declarations (if present)
   - Test XML support if claimed by the server

### Success Criteria
- All DocumentReference resources validate against the US Core DocumentReference Profile without errors
- Must Support elements are properly implemented and populated when data exists
- System responds with appropriate HTTP status codes for all scenarios
- JSON format support is confirmed
- Security requirements are properly implemented
- Referenced resources conform to their respective US Core profiles

---



<a id='encounter'></a>

## Encounter

<a id='req-041'></a>

### REQ-041: Encounter status must be finished

**Text**: 

**Context**: 

**Actor**: Encounter system

**Conformance**: SHALL

# Test Specification for REQ-041

## Requirement ID
REQ-041

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified programmatically by checking the `status` field value in Encounter resources.

### Complexity
**Simple** - The test involves a straightforward validation of a single field value against a known set of valid status codes.

### Prerequisites
- System must support US Core Encounter Profile
- System must have Encounter resources available for testing
- Test system must have access to read Encounter resources via FHIR RESTful API
- System must support the required search parameters for Encounter resources as specified in the Capability Statement

## Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Encounter resources that conform to US Core Encounter Profile
- **Test Data**: Any existing Encounter resources in the system being tested (bring your own data approach)
- **Access Credentials**: Appropriate authentication/authorization to access Encounter resources

### Expected Outputs
- Encounter resources with `status` field set to `finished`
- HTTP 200 responses for successful resource retrieval
- Properly formatted FHIR JSON/XML responses

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and can be used for testing:

1. **Read Operation**: `GET [base]/Encounter/[id]`
   - Retrieve specific Encounter resources by ID

2. **Search Operations**: 
   - `GET [base]/Encounter?patient=[patient-id]` (SHALL support)
   - `GET [base]/Encounter?_id=[encounter-id]` (SHALL support)
   - `GET [base]/Encounter?patient=[patient-id]&status=finished` (SHOULD support)

### Validation Criteria

#### Primary Validation
1. **Status Field Verification**:
   - For each Encounter resource retrieved, verify that `Encounter.status` equals `"finished"`
   - Assertion: `encounter.status == "finished"`

#### Secondary Validations
2. **FHIR Conformance**:
   - Verify that retrieved resources conform to US Core Encounter Profile
   - Assertion: Resource validates against US Core Encounter Profile structure definition

3. **Required Field Presence**:
   - Verify that the `status` field is present in all Encounter resources
   - Assertion: `encounter.status` field exists and is not null

#### Test Cases

**Test Case 1: Individual Encounter Status Validation**
- Execute: `GET [base]/Encounter/[id]` for multiple Encounter IDs
- Validate: Each returned Encounter has `status = "finished"`
- Expected Result: All Encounters must have status "finished" to pass

**Test Case 2: Patient-based Encounter Status Validation**
- Execute: `GET [base]/Encounter?patient=[patient-id]`
- Validate: All returned Encounters for the patient have `status = "finished"`
- Expected Result: All Encounters in the response bundle must have status "finished"

**Test Case 3: Status-filtered Search Validation**
- Execute: `GET [base]/Encounter?patient=[patient-id]&status=finished`
- Validate: All returned Encounters have `status = "finished"`
- Expected Result: Response should only contain Encounters with "finished" status

#### Pass/Fail Criteria
- **Pass**: All tested Encounter resources have `status = "finished"`
- **Fail**: Any Encounter resource has a status other than "finished" (e.g., "planned", "arrived", "triaged", "in-progress", "onleave", "cancelled", "entered-in-error", "unknown")

#### Error Handling
- Test should handle HTTP error responses appropriately (400, 401, 403, 404 as documented in Capability Statement)
- Test should validate that error responses don't affect the overall conformance assessment
- Missing or inaccessible Encounter resources should be reported but not cause automatic test failure

---

<a id='req-042'></a>

### REQ-042: Encounter class must be ambulatory

**Text**: 

**Context**: 

**Actor**: Encounter system

**Conformance**: SHALL

# Test Specification for REQ-042

## Requirement ID
REQ-042

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated programmatically by examining the `class` element of Encounter resources to verify they contain the value "ambulatory".

### Complexity
**Simple** - This is a straightforward validation that requires checking a single element value against a specific coded value.

### Prerequisites
- System must support US Core Encounter Profile
- System must have Encounter resources available for testing
- System must support FHIR RESTful read/search operations for Encounter resources
- Test environment must be configured with appropriate authentication/authorization

## Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Encounter resources that should conform to US Core Encounter Profile
- **Test Data**: Any existing Encounter resources in the system (following "bring your own data" approach)
- **Authentication**: Valid credentials/tokens for system access if required

### Expected Outputs
- **Pass**: All tested Encounter resources have `class.code` = "AMB" (ambulatory)
- **Fail**: One or more Encounter resources have `class.code` values other than "AMB"

### Required FHIR Operations
Based on the Capability Statement, the following supported operations will be used:

1. **Encounter Search Operations** (supported search parameters):
   - `GET [base]/Encounter?patient=[patient-id]` - Search encounters by patient
   - `GET [base]/Encounter?_id=[encounter-id]` - Search encounter by ID
   - `GET [base]/Encounter?class=[class-code]` - Search encounters by class

2. **Encounter Read Operation**:
   - `GET [base]/Encounter/[id]` - Read specific encounter resource

### Validation Criteria

#### Primary Validation
1. **Class Element Presence**: Verify that each Encounter resource contains the required `class` element
2. **Class Code Value**: Verify that `Encounter.class.code` equals "AMB" 
3. **Class System Value**: Verify that `Encounter.class.system` equals "http://terminology.hl7.org/CodeSystem/v3-ActCode"

#### Test Cases

**Test Case 1: Search-Based Validation**
- Execute: `GET [base]/Encounter?patient=[any-patient-id]`
- Validate: For each returned Encounter resource:
  - Assert `class` element is present
  - Assert `class.code` = "AMB"
  - Assert `class.system` = "http://terminology.hl7.org/CodeSystem/v3-ActCode"

**Test Case 2: Direct Read Validation**
- Execute: `GET [base]/Encounter/[existing-encounter-id]`
- Validate: For the returned Encounter resource:
  - Assert `class` element is present
  - Assert `class.code` = "AMB"
  - Assert `class.system` = "http://terminology.hl7.org/CodeSystem/v3-ActCode"

**Test Case 3: Class-Specific Search Validation**
- Execute: `GET [base]/Encounter?class=AMB`
- Validate: All returned encounters should have ambulatory class
- Execute: `GET [base]/Encounter?class=IMP` (inpatient)
- Validate: Should return no results OR system should reject encounters with non-ambulatory class

#### Error Conditions to Test
1. **Invalid Class Code**: If system contains encounters with `class.code` other than "AMB", these should be identified as non-conformant
2. **Missing Class Element**: Encounters missing the `class` element entirely should fail validation
3. **Invalid System**: Encounters with incorrect `class.system` values should fail validation

#### Success Criteria
- **100% Pass Rate**: All Encounter resources in the system must have `class.code` = "AMB"
- **Proper Coding**: All class elements must use the correct code system URI
- **Profile Conformance**: All encounters must validate against the US Core Encounter Profile

#### Reporting
Test results should include:
- Total number of Encounter resources tested
- Number of conformant encounters (class = ambulatory)
- Number of non-conformant encounters with details of violations
- List of specific encounter IDs that failed validation
- Summary of class code values found in the system

---

<a id='req-043'></a>

### REQ-043: Encounter type must be office visit

**Text**: 

**Context**: 

**Actor**: Encounter system

**Conformance**: SHALL

# Test Specification for REQ-043

## 1. Requirement ID
**REQ-043**: Encounter type must be office visit

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be validated by examining the Encounter resource's type field to verify it contains an office visit code.

### Complexity
**Simple** - This is a straightforward validation of a single data element against expected value sets.

### Prerequisites
- System must support US Core Encounter Profile as specified in the Capability Statement
- System must have Encounter resources available for testing
- Understanding of standard office visit type codes (e.g., SNOMED CT, CPT, or other appropriate code systems)

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Encounter resources that should represent office visits
- **Code Systems**: Reference to expected office visit type codes (e.g., SNOMED CT codes like 185349003 "Encounter for check up", 185317003 "Telephone encounter", etc.)
- **Test Data**: Existing Encounter resources in the system under test

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for Encounter resources:

1. **Search Operations**:
   - `GET [base]/Encounter?patient=[patient-id]` - to retrieve encounters for validation
   - `GET [base]/Encounter?type=[type-code]` - to search by encounter type
   - `GET [base]/Encounter/[id]` - to retrieve specific encounter instances

2. **Read Operations**:
   - `GET [base]/Encounter/[id]` - to examine individual encounter resources

### Validation Criteria

#### Primary Assertions
1. **Encounter.type Field Presence**: Verify that each Encounter resource contains the `type` element
2. **Office Visit Code Validation**: Confirm that `Encounter.type` contains at least one coding that represents an office visit
3. **Code System Validation**: Verify that office visit codes use appropriate code systems (SNOMED CT, CPT, etc.)

#### Specific Test Cases

**Test Case 1: Encounter Type Field Validation**
- **Action**: Retrieve Encounter resources using supported search parameters
- **Expected Result**: All Encounter resources must have a populated `type` field
- **Pass Criteria**: `Encounter.type` is present and non-empty

**Test Case 2: Office Visit Code Verification**
- **Action**: Examine the `Encounter.type.coding` array in each Encounter
- **Expected Result**: At least one coding in the type field represents an office visit
- **Pass Criteria**: One or more codings match recognized office visit codes such as:
  - SNOMED CT codes for office visits (e.g., 185349003, 185317003)
  - CPT codes for office visits (e.g., 99201-99205, 99211-99215)
  - Other standard office visit type codes as defined by the implementation

**Test Case 3: Code System Consistency**
- **Action**: Validate that office visit type codes reference appropriate code systems
- **Expected Result**: Coding.system contains valid URI for the code system used
- **Pass Criteria**: `Encounter.type.coding.system` contains valid URIs such as:
  - `http://snomed.info/sct` for SNOMED CT
  - `http://www.ama-assn.org/go/cpt` for CPT codes
  - Other appropriate code system URIs

#### Implementation Notes
- Test should accommodate different code systems that may be used to represent office visit types
- Validation should be flexible enough to accept various legitimate office visit codes rather than requiring specific codes
- Consider that some systems may use local codes with appropriate mappings to standard terminologies
- The test should work with whatever encounter data exists in the system under test, rather than requiring specific test fixtures

#### Failure Conditions
- Encounter resources without a type field
- Encounter resources where no coding in the type field represents an office visit
- Use of invalid or inappropriate code systems for office visit types
- Encounter types that clearly represent non-office visit encounters (e.g., inpatient, emergency, virtual care) when office visits are required

---

<a id='req-204'></a>

### REQ-204: Search for encounters by discharge disposition code

**Text**: 

**Context**: 

**Actor**: FHIR Server

**Conformance**: SHALL

# Test Specification for REQ-204

## 1. Requirement ID
REQ-204

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated API testing by executing search requests with the discharge disposition parameter and validating the server's response.

### Complexity
**Simple** - The requirement involves testing a single search parameter on the Encounter resource, which is straightforward to implement and validate.

### Prerequisites
- FHIR Server implementing US Core Encounter Profile
- Test system with FHIR client capabilities
- Server must have Encounter resources with populated `hospitalization.dischargeDisposition` elements
- Server must support the `discharge-disposition` search parameter as documented in the Capability Statement

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Encounter resources conforming to US Core Encounter Profile with populated `hospitalization.dischargeDisposition` elements
- **Search Parameter**: `discharge-disposition` (token type)
- **Test Data**: Various discharge disposition codes from the existing data set

### Required FHIR Operations
Based on the Capability Statement, the following operations are required:

1. **Search Operation**: `GET [base]/Encounter?patient=[patient-id]&discharge-disposition=[code]`
   - This aligns with the Capability Statement requirement for the parameter combination: `[patient] + [discharge-disposition]` (reference+token)

2. **Read Operation**: `GET [base]/Encounter/[id]` (to verify individual resources)

### Validation Criteria

#### Test Case 1: Basic Discharge Disposition Search
**Objective**: Verify server supports searching encounters by discharge disposition code

**Test Steps**:
1. Identify a patient with encounter data containing discharge disposition information
2. Execute search: `GET [base]/Encounter?patient=[patient-id]&discharge-disposition=[known-code]`
3. Validate response contains encounters with matching discharge disposition codes
4. Verify all returned encounters belong to the specified patient

**Pass Criteria**:
- Server returns HTTP 200 OK
- Response includes Bundle resource with encounter entries
- Each encounter in results has `hospitalization.dischargeDisposition.coding.code` matching the search parameter
- All encounters belong to the specified patient
- No encounters are returned that don't match the search criteria

#### Test Case 2: Code-Only Search Support
**Objective**: Verify server supports searching with code value only (per Capability Statement requirements)

**Test Steps**:
1. Execute search using only code value: `GET [base]/Encounter?patient=[patient-id]&discharge-disposition=[code]`
2. Validate server processes the request successfully

**Pass Criteria**:
- Server accepts and processes the search request
- Returns appropriate encounters matching the code

#### Test Case 3: System and Code Search Support
**Objective**: Verify server supports searching with both system and code values

**Test Steps**:
1. Execute search using system|code format: `GET [base]/Encounter?patient=[patient-id]&discharge-disposition=[system]|[code]`
2. Validate server processes the request successfully

**Pass Criteria**:
- Server accepts and processes the search request
- Returns encounters where discharge disposition matches both system and code
- Results are consistent with code-only search when appropriate

#### Test Case 4: Empty Results Handling
**Objective**: Verify server handles searches with no matching results appropriately

**Test Steps**:
1. Execute search with discharge disposition code known to have no matches: `GET [base]/Encounter?patient=[patient-id]&discharge-disposition=[non-existent-code]`
2. Validate server response

**Pass Criteria**:
- Server returns HTTP 200 OK
- Response contains Bundle with zero entries
- No error conditions are triggered

#### Test Case 5: Invalid Parameter Handling
**Objective**: Verify server handles invalid search parameters appropriately

**Test Steps**:
1. Execute search with malformed discharge disposition parameter
2. Validate server error response

**Pass Criteria**:
- Server returns appropriate HTTP error status (400 Bad Request)
- Error response includes OperationOutcome with descriptive error message

#### Test Case 6: Resource Conformance Validation
**Objective**: Verify returned encounters conform to US Core Encounter Profile

**Test Steps**:
1. Execute valid discharge disposition search
2. Validate each returned encounter against US Core Encounter Profile requirements

**Pass Criteria**:
- All returned encounters validate against US Core Encounter Profile
- Required elements are present and properly formatted
- Discharge disposition elements are populated correctly

### Additional Validation Requirements

1. **Parameter Type Compliance**: Verify the server treats `discharge-disposition` as a token-type parameter according to FHIR specifications
2. **Case Sensitivity**: Test that code matching follows appropriate case sensitivity rules for the coding system used
3. **Multiple Values**: If the server supports multiple discharge disposition codes in a single search, validate proper handling
4. **Integration with Patient Parameter**: Ensure the discharge disposition search works correctly when combined with patient parameter as specified in the Capability Statement

### Expected Outputs
- Successful search operations returning Bundle resources
- Encounter resources with properly populated discharge disposition elements
- Appropriate HTTP status codes and error handling
- Compliance with US Core Encounter Profile specifications

---

<a id='req-205'></a>

### REQ-205: Support multiple OR conditions in discharge disposition search

**Text**: 

**Context**: 

**Actor**: FHIR Server

**Conformance**: MAY

# Test Specification for REQ-205

## 1. Requirement ID
REQ-205

## 2. Requirement Analysis

### Testability Assessment
**Not Testable** - This requirement cannot be tested as specified because:
- The requirement references "discharge disposition search" but the provided Capability Statement information does not include any Encounter resource capabilities or discharge-disposition search parameter support
- The requirement text is incomplete (empty "Text" and "Context" sections)
- No specific FHIR operations or search parameters are defined in the requirement
- The referenced source file "SearchParameter-us-core-encounter-discharge-disposition.md" is not provided in the capability statement information

### Complexity
**Cannot be determined** due to insufficient requirement specification

### Prerequisites
**Cannot be determined** due to lack of requirement details and missing Encounter resource capability information

## 3. Test Implementation Strategy

### Analysis of Implementation Feasibility

This requirement cannot be implemented as a test specification because:

1. **Missing Resource Support**: The provided Capability Statement information does not include the US Core Encounter Profile capabilities, which would be essential for testing discharge disposition searches.

2. **Incomplete Requirement Specification**: The requirement summary mentions "Support multiple OR conditions in discharge disposition search" but provides no details about:
   - What constitutes "multiple OR conditions"
   - Expected search syntax
   - Required search parameters
   - Expected behavior

3. **Missing Search Parameter Details**: While the requirement references "SearchParameter-us-core-encounter-discharge-disposition.md", this information is not included in the provided capability statement details.

4. **Conformance Level Mismatch**: The requirement specifies "MAY" conformance level, but without the underlying Encounter resource capabilities being defined in the provided capability statement, it's impossible to determine if this search functionality should even be available for testing.

### Recommendation

To make this requirement testable, the following information would be needed:

1. **Complete Capability Statement**: Include the US Core Encounter Profile capabilities with search parameter support details
2. **Complete Requirement Text**: Provide the full requirement description including expected behavior
3. **Search Parameter Specification**: Include the discharge-disposition search parameter definition and expected OR condition syntax
4. **Example Scenarios**: Define specific test cases showing how multiple OR conditions should work

### Required FHIR Operations
**Cannot be determined** - Would likely involve `GET [base]/Encounter` searches, but specific parameters and syntax are undefined

### Validation Criteria
**Cannot be determined** - Would need to validate OR condition support in discharge disposition searches, but criteria are not specified

**Note**: This requirement appears to be a placeholder or incomplete specification that cannot be implemented as written without additional context and capability statement information for the Encounter resource.

---

<a id='req-206'></a>

### REQ-206: Support multiple AND conditions in discharge disposition search

**Text**: 

**Context**: 

**Actor**: FHIR Server

**Conformance**: MAY

# REQ-206 Test Specification

## 1. Requirement ID
REQ-206

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated API testing by constructing search queries with multiple AND conditions for the discharge-disposition parameter and validating the server's response behavior.

### Complexity
**Simple** - The requirement involves testing a specific search parameter capability that can be validated through straightforward API calls and response analysis.

### Prerequisites
- FHIR Server must support the US Core Encounter Profile
- Server must support the discharge-disposition search parameter (as indicated by SHOULD conformance in Capability Statement)
- Test system must have access to Encounter resources with discharge disposition data
- Multiple Encounter resources with different discharge disposition values should exist for comprehensive testing

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Encounter resources conforming to US Core Encounter Profile with populated `hospitalization.dischargeDisposition` elements
- **Search Parameters**: Multiple discharge disposition codes/values that exist in the test data
- **Patient Reference**: Valid patient reference to scope the search appropriately

### Required FHIR Operations
- `GET [base]/Encounter?patient=[patient-id]&discharge-disposition=[code1]&discharge-disposition=[code2]`
- `GET [base]/Encounter?discharge-disposition=[code1]&discharge-disposition=[code2]` (if patient-scoped search is not required)

**Note**: The Capability Statement indicates SHOULD support for the `patient+discharge-disposition` search parameter combination, confirming this operation is expected to be supported.

### Validation Criteria

#### Test Case 1: Multiple AND Conditions Support Verification
**Objective**: Verify that the server can process multiple discharge-disposition parameters as AND conditions

**Test Steps**:
1. Identify at least 2 different discharge disposition codes present in the test data
2. Execute search with multiple discharge-disposition parameters: 
   `GET [base]/Encounter?patient=[id]&discharge-disposition=[code1]&discharge-disposition=[code2]`
3. Analyze response for appropriate handling

**Expected Results** (Since this is MAY conformance):
- **If supported**: Server returns Encounters that match ALL specified discharge disposition criteria (logical AND)
- **If not supported**: Server returns appropriate error response (400 Bad Request with OperationOutcome) or falls back to processing only one parameter

#### Test Case 2: Response Validation
**Objective**: Ensure proper response format and content when multiple AND conditions are processed

**Validation Checks**:
- Response status code is appropriate (200 OK if supported, 4xx if not supported)
- If supported, returned Bundle contains only Encounters matching all specified criteria
- Response includes proper FHIR Bundle structure with valid entries
- Each returned Encounter resource has discharge disposition matching the search criteria
- No Encounters are returned that match only one of the specified criteria (confirming AND logic)

#### Test Case 3: Conformance Behavior Verification
**Objective**: Verify appropriate server behavior for MAY-level conformance

**Validation Checks**:
- Server behavior is consistent across multiple test executions
- If not supported, server provides clear indication through error response or ignores additional parameters predictably
- Server does not return incorrect results when processing multiple parameters

#### Test Case 4: Edge Case Handling
**Objective**: Test server behavior with edge cases for multiple AND conditions

**Test Scenarios**:
- Search with same discharge-disposition value repeated multiple times
- Search with invalid/non-existent discharge disposition codes in combination with valid ones
- Search combining system|code and code-only formats for discharge-disposition

**Expected Results**:
- Server handles edge cases gracefully without errors
- Duplicate parameters are processed appropriately
- Invalid parameters result in appropriate error responses or are ignored consistently

### Pass/Fail Criteria

**PASS**: 
- Server either fully supports multiple AND conditions for discharge-disposition search with correct logical behavior, OR
- Server appropriately indicates non-support through proper error responses or consistent fallback behavior
- All responses conform to FHIR specifications
- Response handling is consistent with MAY-level conformance expectations

**FAIL**:
- Server returns incorrect results (e.g., OR logic instead of AND logic when claiming support)
- Server produces malformed responses or unexpected errors
- Server behavior is inconsistent across test executions
- Server crashes or becomes unresponsive when processing multiple discharge-disposition parameters

---

<a id='req-407'></a>

### REQ-407: The Encounter resource SHALL map the identifier to Event.identifier.

**Text**: 

**Context**: FHIR Workflow Pattern mapping for Encounter resource elements to Event pattern fields.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-407

## 1. Requirement ID
REQ-407

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified by examining the structure of Encounter resources and checking that the `identifier` element is properly mapped to the Event.identifier pattern field.

### Complexity
**Simple** - This is a straightforward structural mapping verification that requires checking the presence and format of the identifier field in Encounter resources.

### Prerequisites
- System must support US Core Encounter Profile
- System must have Encounter resources with identifier data available
- Access to FHIR server supporting Encounter read operations
- Test system must support FHIR R4 specification

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Encounter resources that contain identifier elements
- **System Access**: FHIR server endpoint supporting Encounter operations
- **Authentication**: Valid credentials for accessing the FHIR server (if required)

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required for testing:

1. **GET [base]/Encounter/[id]** (SHALL support `read`)
2. **GET [base]/Encounter?[search parameters]** (SHALL support `search-type`)
   - Use supported search parameters like `patient`, `_id`, or combinations such as `date+patient`

### Expected Outputs
- Encounter resources in JSON or XML format
- HTTP 200 responses for successful requests
- Proper FHIR-compliant resource structures

### Validation Criteria

#### Primary Assertions
1. **Identifier Presence Check**:
   - Verify that retrieved Encounter resources contain the `identifier` element
   - Assert that `Encounter.identifier` exists when identifier data is available in the system

2. **Identifier Structure Validation**:
   - Validate that `Encounter.identifier` follows the FHIR Identifier datatype structure
   - Verify required sub-elements are present (e.g., `system`, `value`)
   - Check that the identifier structure conforms to the Event.identifier pattern mapping

3. **Data Type Conformance**:
   - Assert that `Encounter.identifier` is of type `Identifier[]` (array of Identifier objects)
   - Verify each identifier object contains appropriate elements as defined in the FHIR specification

#### Test Cases

**Test Case 1: Basic Identifier Mapping Verification**
- Retrieve Encounter resources using supported search parameters
- For each Encounter resource returned:
  - Assert that if identifier data exists, it is mapped to `Encounter.identifier`
  - Verify the identifier structure matches FHIR Identifier datatype requirements

**Test Case 2: Event Pattern Compliance**
- Validate that the identifier mapping aligns with the FHIR Workflow Event pattern
- Ensure that `Encounter.identifier` serves the same purpose as Event.identifier in workflow patterns
- Check that business identifiers for the encounter are properly represented

**Test Case 3: Multiple Identifier Support**
- Test scenarios where Encounter resources have multiple identifiers
- Verify that all relevant identifiers are included in the `Encounter.identifier` array
- Ensure proper mapping of different identifier types (system-assigned, user-assigned, etc.)

#### Specific Validation Steps

1. **Execute Search Query**:
   ```
   GET [base]/Encounter?patient=[patient-id]
   ```

2. **Validate Response Structure**:
   - Confirm HTTP 200 response
   - Verify FHIR Bundle structure with Encounter entries

3. **Check Identifier Mapping**:
   - For each Encounter in the response bundle:
     - Locate `resource.identifier` element
     - Validate it contains appropriate business identifiers for the encounter
     - Verify structure conforms to FHIR Identifier datatype

4. **Pattern Compliance Verification**:
   - Confirm that the identifier serves as a business identifier for the encounter event
   - Validate that the mapping supports workflow pattern requirements for event identification

#### Pass/Fail Criteria

**Pass Conditions**:
- All Encounter resources with business identifiers have them properly mapped to `Encounter.identifier`
- The identifier structure conforms to FHIR specification requirements
- Multiple identifiers (when present) are properly represented as an array
- The mapping supports the Event pattern workflow requirements

**Fail Conditions**:
- Encounter resources missing expected identifier mappings
- Incorrect data type or structure for identifier elements
- Business identifiers mapped to incorrect elements instead of `Encounter.identifier`
- Non-conformance with FHIR Identifier datatype specification

---

<a id='req-408'></a>

### REQ-408: The Encounter resource SHALL map the status to Event.status.

**Text**: 

**Context**: FHIR Workflow Pattern mapping for Encounter resource elements to Event pattern fields.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-408

## 1. Requirement ID
REQ-408

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified programmatically by examining the structure and content of Encounter resources to ensure the `status` field is properly mapped according to the FHIR Workflow Pattern Event.status mapping.

### Complexity
**Simple** - This is a straightforward field mapping verification that requires checking a single element (`status`) in Encounter resources against the defined workflow pattern.

### Prerequisites
- System must support the US Core Encounter Profile
- System must have Encounter resources available for testing
- Test environment must support FHIR R4 RESTful API operations
- System must implement proper authentication and authorization as per US Core security requirements

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Encounter resources conforming to US Core Encounter Profile
- **Test Data**: Any existing Encounter resources in the system under test (bring your own data approach)
- **Authentication**: Valid credentials/tokens for API access

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for Encounter resources:
- **GET /Encounter/{id}** - Read individual Encounter resources
- **GET /Encounter?patient={patient_id}** - Search for Encounters by patient
- **GET /Encounter?status={status}** - Search for Encounters by status
- **GET /Encounter?_id={id}** - Search for Encounters by ID

### Validation Criteria

#### Primary Validation
1. **Status Field Presence**: Every Encounter resource SHALL have a `status` element present
   - Assert that `Encounter.status` exists and is not null/empty
   
2. **Status Value Conformance**: The `status` field SHALL contain valid values according to FHIR EncounterStatus value set
   - Valid values include: `planned`, `in-progress`, `onhold`, `completed`, `cancelled`, `entered-in-error`, `unknown`
   - Assert that `Encounter.status` contains one of these valid enumerated values

3. **Workflow Pattern Mapping**: The status SHALL properly represent the Event.status in the workflow pattern context
   - Assert that the status value semantically represents the current state of the encounter event
   - Verify status transitions are logical (e.g., `completed` encounters should not transition to `planned`)

#### Secondary Validation
1. **Profile Conformance**: Encounter resources SHALL conform to US Core Encounter Profile
   - Validate against US Core Encounter Profile structure definition
   - Ensure all Must Support elements are present when data is available

2. **Data Type Validation**: Status field SHALL be of correct FHIR data type
   - Assert that `Encounter.status` is of type `code`
   - Verify proper JSON/XML serialization format

#### Test Cases

**Test Case 1: Individual Resource Validation**
- Retrieve individual Encounter resources using `GET /Encounter/{id}`
- For each retrieved Encounter:
  - Verify `status` field is present
  - Verify `status` contains valid EncounterStatus value
  - Validate against US Core Encounter Profile

**Test Case 2: Search Results Validation**
- Execute search operations: `GET /Encounter?patient={patient_id}`
- For each Encounter in search results:
  - Apply same validation criteria as Test Case 1
  - Ensure status-based searches return consistent results

**Test Case 3: Status-Specific Search Validation**
- Execute status-specific searches: `GET /Encounter?status={each_valid_status}`
- Verify that returned resources actually contain the requested status
- Confirm no resources are returned with incorrect status values

#### Success Criteria
- **PASS**: All Encounter resources have properly populated `status` fields with valid EncounterStatus values that correctly represent the Event.status pattern
- **FAIL**: Any Encounter resource is missing the `status` field, contains invalid status values, or has status values that don't align with the workflow pattern requirements

#### Error Handling Validation
- Verify appropriate HTTP status codes are returned (400, 401, 403, 404) for invalid requests as specified in the Capability Statement
- Ensure error responses include appropriate OperationOutcome resources when applicable

---

<a id='req-409'></a>

### REQ-409: The Encounter resource SHALL map the type to Event.code.

**Text**: 

**Context**: FHIR Workflow Pattern mapping for Encounter resource elements to Event pattern fields.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-409

## Requirement ID
REQ-409

## Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified programmatically by examining the structure and content of Encounter resources to confirm that the `type` element is properly mapped to Event.code according to FHIR Workflow Pattern specifications.

### Complexity
**Simple** - The test involves straightforward validation of a single element mapping within the Encounter resource structure.

### Prerequisites
- System must support US Core Encounter Profile
- System must have Encounter resources available for testing
- System must support read operations on Encounter resources
- Test data should include Encounter resources with populated `type` elements

## Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Encounter resources conforming to US Core Encounter Profile
- **Test Data**: Encounter instances with various `type` values populated
- **System Under Test**: FHIR server implementing US Core Encounter Profile

### Expected Outputs
- Encounter resources with properly structured `type` elements that conform to Event.code mapping requirements
- Validation confirmation that `type` element structure aligns with FHIR Workflow Pattern Event.code specifications

### Required FHIR Operations
Based on the Capability Statement, the following operations are required and supported:

1. **Read Operation**: `GET [base]/Encounter/[id]`
   - Used to retrieve individual Encounter resources for validation
   
2. **Search Operations**: 
   - `GET [base]/Encounter?patient=[patient-id]` - To retrieve patient's encounters
   - `GET [base]/Encounter?_id=[encounter-id]` - To retrieve specific encounters by ID

### Validation Criteria

#### Primary Validation Checks

1. **Element Presence Validation**:
   - Verify that the `Encounter.type` element is present when required
   - Confirm the element follows the cardinality constraints defined in the US Core Encounter Profile

2. **Data Type Validation**:
   - Validate that `Encounter.type` is properly structured as a CodeableConcept
   - Ensure the element contains appropriate coding information (system, code, display)

3. **Workflow Pattern Mapping Validation**:
   - Confirm that the `Encounter.type` structure aligns with Event.code pattern requirements
   - Verify that the mapping maintains semantic consistency with FHIR Workflow Pattern specifications

4. **Profile Conformance Validation**:
   - Validate that the Encounter resource conforms to the US Core Encounter Profile
   - Ensure all must-support elements are properly implemented alongside the type mapping

#### Test Execution Steps

1. **Retrieve Test Data**:
   - Query the system for available Encounter resources using supported search parameters
   - Select a representative sample of Encounter resources for testing

2. **Resource Structure Analysis**:
   - For each retrieved Encounter resource, examine the `type` element structure
   - Validate the presence and format of coding elements within the type

3. **Mapping Verification**:
   - Verify that the `type` element structure conforms to Event.code mapping requirements
   - Check that the semantic meaning is preserved in the mapping

4. **Conformance Validation**:
   - Validate each Encounter resource against the US Core Encounter Profile
   - Ensure overall resource conformance while specifically focusing on type element mapping

#### Passing Criteria

A test passes when:
- All examined Encounter resources have properly structured `type` elements
- The `type` elements demonstrate correct mapping to Event.code pattern
- Resources maintain conformance with US Core Encounter Profile requirements
- No validation errors occur during resource structure examination

#### Failing Criteria

A test fails when:
- Encounter resources lack required `type` elements where expected
- The `type` element structure does not align with Event.code mapping specifications
- Resources fail validation against the US Core Encounter Profile
- Structural inconsistencies are found in the type element mapping

---

<a id='req-410'></a>

### REQ-410: The Encounter resource SHALL map the serviceType to Event.code.

**Text**: 

**Context**: FHIR Workflow Pattern mapping for Encounter resource elements to Event pattern fields.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-410

## 1. Requirement ID
**REQ-410**: The Encounter resource SHALL map the serviceType to Event.code.

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated testing by examining the mapping between Encounter.serviceType and the Event workflow pattern's Event.code field.

### Complexity
**Simple** - This is a straightforward mapping verification that requires checking a single field relationship.

### Prerequisites
- System must support US Core Encounter Profile
- System must have Encounter resources with populated serviceType elements
- Understanding of FHIR Workflow Pattern Event mapping requirements
- Access to system's Encounter resources via FHIR API

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Encounter resources that contain serviceType elements
- Any Encounter resources available in the test system (following "bring your own data" approach)

**Expected Outputs:**
- Encounter resources with properly mapped serviceType to Event.code according to FHIR Workflow Pattern specifications
- Verification that the mapping maintains semantic consistency

### Required FHIR Operations
Based on the Capability Statement, the following supported operations will be used:

1. **GET [base]/Encounter** - Retrieve Encounter resources
2. **GET [base]/Encounter?patient=[id]** - Search for Encounters by patient (supported search parameter)
3. **GET [base]/Encounter?_id=[id]** - Retrieve specific Encounter by ID (supported search parameter)
4. **GET [base]/Encounter?status=[status]** - Search Encounters by status (supported search parameter)

### Validation Criteria

#### Test Case 1: Encounter ServiceType Mapping Verification
**Objective:** Verify that Encounter.serviceType correctly maps to Event.code

**Steps:**
1. Retrieve Encounter resources from the system using supported search operations
2. For each Encounter resource that contains a serviceType element:
   - Extract the serviceType value
   - Verify that the serviceType follows the CodeableConcept data type structure
   - Confirm that the serviceType value can be appropriately mapped to Event.code in the workflow pattern context

**Assertions:**
- **PASS**: Encounter.serviceType is present and contains valid CodeableConcept values that can be mapped to Event.code
- **PASS**: The serviceType coding system and codes are appropriate for workflow event representation
- **FAIL**: Encounter.serviceType is missing when it should be present according to the workflow pattern requirements
- **FAIL**: ServiceType values cannot be appropriately mapped to Event.code semantically

#### Test Case 2: Semantic Consistency Validation
**Objective:** Ensure the serviceType values maintain semantic meaning when mapped to Event.code

**Steps:**
1. Retrieve Encounters with serviceType populated
2. Analyze the serviceType CodeableConcept values
3. Verify that the codes and display values are semantically appropriate for representing the type of service/event

**Assertions:**
- **PASS**: ServiceType codes use recognized coding systems (e.g., SNOMED CT, local coding systems)
- **PASS**: ServiceType display values accurately represent the service type
- **PASS**: The mapping from serviceType to Event.code maintains the intended semantic meaning
- **FAIL**: ServiceType uses inappropriate or unrecognized coding systems
- **FAIL**: Semantic meaning is lost or distorted in the mapping

#### Test Case 3: Data Completeness Check
**Objective:** Verify that all relevant Encounters have appropriate serviceType mapping capability

**Steps:**
1. Query for Encounters using various search parameters (patient, status, type)
2. Examine the population of serviceType across different Encounter instances
3. Assess whether the serviceType population pattern supports proper Event.code mapping

**Assertions:**
- **PASS**: Encounters that should have serviceType populated (based on encounter type and context) contain appropriate values
- **PASS**: ServiceType values are consistently formatted and coded across similar encounter types
- **FAIL**: Critical Encounters lack serviceType information needed for proper Event.code mapping
- **FAIL**: Inconsistent serviceType coding patterns that would impair workflow pattern mapping

#### Overall Test Success Criteria
The test passes if:
1. All Encounter resources with serviceType elements can be successfully mapped to Event.code
2. The mapping preserves semantic meaning and follows FHIR Workflow Pattern specifications
3. ServiceType values use appropriate coding systems and maintain consistency
4. The mapping supports proper workflow event representation

The test fails if:
1. ServiceType to Event.code mapping is not possible or semantically incorrect
2. Critical Encounters lack necessary serviceType information
3. ServiceType coding is inconsistent or uses inappropriate systems
4. The workflow pattern mapping requirements are not met

---

<a id='req-411'></a>

### REQ-411: The Encounter resource SHALL map the subject to Event.subject.

**Text**: 

**Context**: FHIR Workflow Pattern mapping for Encounter resource elements to Event pattern fields.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-411

## 1. Requirement ID
**REQ-411**

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated inspection of Encounter resource instances to check if the `subject` field correctly maps to the Event pattern's subject field.

### Complexity
**Simple** - This is a straightforward mapping verification that requires checking a single field in the Encounter resource.

### Prerequisites
- System must support US Core Encounter Profile (confirmed in Capability Statement)
- System must have Encounter resources available for testing
- Encounter resources must have populated `subject` field referencing Patient resources
- Referenced Patient resources should be accessible for validation

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: 
  - Encounter resource instances conforming to US Core Encounter Profile
  - Referenced Patient resources (for validation of subject mapping)
- **Test Data**: Any existing Encounter resources in the system under test (bring your own data approach)

### Required FHIR Operations
Based on the Capability Statement, the following operations are confirmed as supported:

1. **GET [base]/Encounter/[id]** - Read specific Encounter resources
2. **GET [base]/Encounter?patient=[patient-id]** - Search for Encounters by patient (required search parameter)
3. **GET [base]/Patient/[id]** - Read referenced Patient resources for validation

### Validation Criteria

#### Primary Assertions
1. **Subject Field Presence**: 
   - Each Encounter resource MUST have a `subject` field populated
   - Assert: `Encounter.subject` is present and not null

2. **Subject Reference Validity**:
   - The `subject` field MUST contain a valid reference to a Patient resource
   - Assert: `Encounter.subject` follows the pattern `Patient/[id]` or is a valid relative/absolute reference
   - Assert: Referenced Patient resource exists and is accessible

3. **Event Pattern Conformance**:
   - The `subject` field correctly maps to the Event pattern's subject field as specified in FHIR Workflow Pattern
   - Assert: `Encounter.subject` represents "Who the encounter is about" (the patient)
   - Assert: Reference type is Patient (as required by US Core Encounter Profile)

#### Test Execution Steps
1. **Discovery Phase**:
   - Query system for available Encounter resources using supported search parameters
   - Retrieve a representative sample of Encounter resources

2. **Resource Validation**:
   - For each retrieved Encounter resource:
     - Verify `subject` field is present
     - Validate reference format and type
     - Attempt to resolve referenced Patient resource
     - Confirm the reference represents the patient the encounter is about

3. **Event Pattern Mapping Verification**:
   - Confirm that `Encounter.subject` appropriately represents the Event pattern's subject field
   - Verify the mapping aligns with FHIR Workflow Pattern specifications

#### Pass Criteria
- All tested Encounter resources have a populated `subject` field
- All `subject` references are valid and resolvable Patient references  
- The mapping correctly represents "who the encounter is about" per Event pattern requirements
- No Encounter resources violate the subject mapping requirement

#### Failure Scenarios
- Encounter resource missing `subject` field
- `subject` field contains invalid or non-Patient reference
- Referenced Patient resource is not accessible/resolvable
- `subject` field does not properly represent the patient the encounter concerns

### Additional Validation Notes
- Test should accommodate various reference formats (relative, absolute, contained)
- Validation should work with any existing Encounter data in the system
- Test execution should handle systems with different volumes of Encounter resources
- Consider testing across different encounter types and statuses to ensure consistent subject mapping

---

<a id='req-412'></a>

### REQ-412: The Encounter resource SHALL map the episodeOfCare to Event.context.

**Text**: 

**Context**: FHIR Workflow Pattern mapping for Encounter resource elements to Event pattern fields.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-412

## Requirement ID
REQ-412

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified programmatically by examining the structure and content of Encounter resources to confirm that the `episodeOfCare` element properly maps to the Event.context pattern.

### Complexity
**Simple** - This is a straightforward structural validation that checks for the presence and proper mapping of a single element within the Encounter resource.

### Prerequisites
- System must support US Core Encounter Profile as indicated in the Capability Statement
- System must have Encounter resources available for testing
- Test data should include Encounter resources that reference EpisodeOfCare resources where applicable
- System must support read operations on Encounter resources

## Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: 
  - Encounter resources conforming to US Core Encounter Profile
  - EpisodeOfCare resources (if referenced by Encounters)
- **Test Data**: Encounter resources with various scenarios:
  - Encounters that have episodeOfCare references
  - Encounters without episodeOfCare references (to verify proper handling)

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required for testing:

1. **Read Operation**: `GET [base]/Encounter/[id]`
   - Retrieve individual Encounter resources to examine their structure
   - Verify the episodeOfCare element mapping

2. **Search Operation**: `GET [base]/Encounter?patient=[patient-id]`
   - Retrieve multiple Encounter resources for comprehensive testing
   - Use patient-based search as it's a SHALL support parameter

### Expected Outputs
- Encounter resources in JSON or XML format
- Clear indication of episodeOfCare element presence and structure
- Proper mapping to Event.context pattern as specified in FHIR Workflow Pattern

### Validation Criteria

#### Primary Validation
1. **Element Presence Check**: 
   - Verify that when an Encounter resource contains an `episodeOfCare` element, it properly maps to the Event.context pattern
   - Confirm the episodeOfCare element follows the correct FHIR structure (Reference type)

2. **Reference Validity**:
   - If episodeOfCare is present, validate that it contains a proper reference to an EpisodeOfCare resource
   - Verify the reference format follows FHIR specifications (e.g., `EpisodeOfCare/[id]` or full URL)

3. **Workflow Pattern Compliance**:
   - Confirm that the episodeOfCare element serves as the Event.context as defined in FHIR Workflow Pattern
   - Validate that the mapping provides appropriate contextual information for the encounter

#### Secondary Validation
1. **Profile Conformance**:
   - Ensure Encounter resources conform to US Core Encounter Profile
   - Verify proper resource structure and required elements

2. **Data Consistency**:
   - When episodeOfCare references are present, verify they point to valid, accessible EpisodeOfCare resources (if available in the system)
   - Check for logical consistency between Encounter and referenced EpisodeOfCare

#### Test Pass Criteria
- **PASS**: All Encounter resources properly implement the episodeOfCare to Event.context mapping when the element is present
- **PASS**: Systems correctly handle cases where episodeOfCare is not present without errors
- **PASS**: All episodeOfCare references follow proper FHIR Reference formatting
- **FAIL**: Any Encounter resource fails to properly map episodeOfCare to Event.context when the element should be present
- **FAIL**: Malformed or invalid episodeOfCare references
- **FAIL**: System errors when processing Encounter resources with or without episodeOfCare elements

#### Implementation Notes
- The test should accommodate systems that may not use EpisodeOfCare resources extensively
- Focus on the structural correctness of the mapping rather than the business logic of episode management
- Validate against the FHIR R4 specification for Encounter.episodeOfCare element requirements
- Consider testing with both contained and external EpisodeOfCare references if supported by the system

---

<a id='req-413'></a>

### REQ-413: The Encounter resource SHALL map the basedOn to Event.basedOn.

**Text**: 

**Context**: FHIR Workflow Pattern mapping for Encounter resource elements to Event pattern fields.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-413

## 1. Requirement ID
**REQ-413**: The Encounter resource SHALL map the basedOn to Event.basedOn.

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified programmatically by examining Encounter resources to confirm the presence and proper mapping of the `basedOn` element when applicable.

### Complexity
**Simple** - This is a straightforward structural verification that checks for the presence and correct mapping of a single FHIR element.

### Prerequisites
- System must support US Core Encounter Profile as specified in the Capability Statement
- System must have Encounter resources available for testing
- Test system must be able to perform READ operations on Encounter resources
- If testing creation/updates, system must support the appropriate interaction types (CREATE/UPDATE) for Encounter resources

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: 
  - Encounter resources that contain `basedOn` references (when such data exists in the test system)
  - Referenced resources that the `basedOn` element points to (e.g., ServiceRequest, CarePlan, etc.)
- **Test Data**: Systems under test should provide Encounter resources using their own data ("bring your own data" approach)

### Expected Outputs
- Encounter resources with properly mapped `basedOn` elements
- Verification that `basedOn` references conform to Event.basedOn pattern requirements
- Confirmation that referenced resources exist and are accessible (when references are present)

### Required FHIR Operations
Based on the Capability Statement, the following operations are required:
- **GET [base]/Encounter/[id]** - Read specific Encounter resources
- **GET [base]/Encounter?[search-parameters]** - Search for Encounter resources to identify test candidates
- **GET [base]/[ResourceType]/[id]** - Read referenced resources pointed to by `basedOn` element

### Validation Criteria

#### Test Case 1: Encounter Resources with basedOn Element
**Objective**: Verify that when an Encounter resource contains a `basedOn` element, it properly maps to Event.basedOn pattern

**Test Steps**:
1. Retrieve Encounter resources from the system under test
2. Filter for Encounters that contain the `basedOn` element
3. For each Encounter with `basedOn`:
   - Verify `basedOn` is present as an array of References
   - Verify each reference in `basedOn` follows proper FHIR Reference format
   - Verify referenced resources exist and are accessible
   - Confirm the mapping aligns with Event.basedOn pattern requirements

**Pass Criteria**:
- All Encounter resources with `basedOn` elements have properly formatted Reference arrays
- All references in `basedOn` point to valid, accessible FHIR resources
- The `basedOn` element structure conforms to the Event.basedOn pattern as defined in FHIR Workflow Pattern

#### Test Case 2: Encounter Resources without basedOn Element
**Objective**: Verify that Encounters without `basedOn` elements do not fail validation

**Test Steps**:
1. Retrieve Encounter resources that do not contain `basedOn` elements
2. Verify these resources are still valid US Core Encounter Profile instances

**Pass Criteria**:
- Encounter resources without `basedOn` elements remain valid
- No errors or warnings related to missing `basedOn` elements (as this is not always required)

#### Test Case 3: Reference Validation for basedOn
**Objective**: Ensure that `basedOn` references point to appropriate resource types per Event pattern

**Test Steps**:
1. For each Encounter with `basedOn` references:
   - Attempt to resolve each reference
   - Verify the referenced resource type is appropriate for the Event.basedOn pattern
   - Check that referenced resources are accessible via the API

**Pass Criteria**:
- All `basedOn` references resolve to valid FHIR resources
- Referenced resource types are appropriate for Event.basedOn mapping
- Referenced resources follow their respective US Core profiles when applicable

#### Assertion Summary
A test implementation should verify:
- ✅ `Encounter.basedOn` is present when workflow relationships exist
- ✅ `basedOn` follows proper FHIR Reference structure
- ✅ Referenced resources are accessible and valid
- ✅ Mapping conforms to Event.basedOn pattern requirements
- ✅ System handles Encounters both with and without `basedOn` appropriately

---

<a id='req-414'></a>

### REQ-414: The Encounter resource SHALL map the participant to Event.performer.

**Text**: 

**Context**: FHIR Workflow Pattern mapping for Encounter resource elements to Event pattern fields.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-414

## 1. Requirement ID
REQ-414

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement involves verifying a specific mapping between FHIR Encounter resource elements and the FHIR Event pattern, which can be validated programmatically by examining the structure and content of Encounter resources.

### Complexity
**Simple** - The requirement focuses on a straightforward structural mapping verification between the Encounter.participant element and the Event.performer pattern field.

### Prerequisites
- System must support US Core Encounter Profile as indicated in the Capability Statement
- System must have Encounter resources available for testing
- Test system must be able to retrieve Encounter resources via FHIR REST API
- Understanding of FHIR Workflow Event pattern specifications

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Encounter resources that contain participant elements
- **Test Data**: Any existing Encounter resources in the system that include participant information
- **System Endpoint**: FHIR server base URL supporting US Core Encounter Profile

### Expected Outputs
- Encounter resources with participant elements properly structured according to Event.performer pattern
- Validation confirmation that participant mapping aligns with Event pattern requirements

### Required FHIR Operations
Based on the Capability Statement, the following supported operations will be used:

1. **GET /Encounter/[id]** - Retrieve specific Encounter resources for validation
2. **GET /Encounter?patient=[patient-id]** - Search for Encounters by patient (supported search parameter)
3. **GET /Encounter?status=[status]** - Search for Encounters by status (supported search parameter)

### Validation Criteria

#### Primary Assertions
1. **Participant Element Presence**: When an Encounter resource contains a `participant` element, verify that:
   - The participant structure follows the Event.performer pattern requirements
   - Required fields are populated according to the Event pattern specification

2. **Participant Structure Validation**: For each Encounter.participant, verify that:
   - The participant contains appropriate reference to the performing entity (Practitioner, PractitionerRole, RelatedPerson, etc.)
   - The participant.type element (if present) appropriately maps to Event.performer role concepts
   - The participant.period element (if present) aligns with Event.performer timing expectations

3. **Event Pattern Conformance**: Validate that:
   - Encounter.participant elements can be logically interpreted as Event.performer instances
   - The mapping maintains semantic consistency with the FHIR Workflow Event pattern
   - Data types and cardinalities are consistent with Event pattern expectations

#### Test Cases

**Test Case 1: Basic Participant Mapping Validation**
- Retrieve Encounters containing participant elements
- Verify each participant can be mapped to Event.performer pattern
- Confirm required elements are present and properly formatted

**Test Case 2: Multiple Participants Handling**
- Test Encounters with multiple participants
- Verify each participant independently conforms to Event.performer mapping
- Ensure array/collection handling aligns with Event pattern

**Test Case 3: Participant Type Mapping**
- Validate that participant.type values appropriately represent performer roles
- Confirm type mappings are consistent with Event pattern performer role concepts

**Test Case 4: Reference Integrity**
- Verify participant.individual references point to valid resources
- Confirm referenced resources (Practitioner, PractitionerRole, etc.) are appropriate for Event.performer pattern

#### Pass/Fail Criteria
- **PASS**: All Encounter resources with participants demonstrate proper mapping to Event.performer pattern
- **FAIL**: Any Encounter.participant element cannot be appropriately mapped to Event.performer or violates the pattern requirements
- **SKIP**: No Encounter resources with participant elements available for testing

#### Implementation Notes
- Tests should work with any existing Encounter data in the system ("bring your own data" approach)
- Focus on structural and semantic conformance rather than business logic validation
- Utilize the supported Encounter search parameters from the Capability Statement to efficiently locate test data
- Validation should reference the official FHIR Workflow Event pattern documentation for mapping requirements

---

<a id='req-415'></a>

### REQ-415: The Encounter resource SHALL map the type to Event.performer.function.

**Text**: 

**Context**: FHIR Workflow Pattern mapping for Encounter resource elements to Event pattern fields.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-415

## 1. Requirement ID
**REQ-415**: The Encounter resource SHALL map the type to Event.performer.function.

## 2. Requirement Analysis

### Testability Assessment
**Not Testable** - This requirement is too vague for automated testing. The requirement refers to mapping "type to Event.performer.function" but:
- It's unclear what "type" refers to in the Encounter resource context
- "Event.performer.function" appears to reference the FHIR Workflow Event pattern, but the specific mapping relationship is not defined
- No concrete FHIR elements or values are specified for validation
- The requirement lacks sufficient detail about what constitutes conformant behavior

### Complexity
**Not Applicable** - Due to insufficient specification detail

### Prerequisites
**Not Applicable** - Cannot determine prerequisites due to vague requirement specification

## 3. Test Implementation Strategy

### Required Inputs
**Cannot be determined** - The requirement lacks sufficient detail to specify:
- Which FHIR Encounter elements should be tested
- What the expected mapping target should be
- What constitutes a valid or invalid mapping

### Required FHIR Operations
Based on the Capability Statement, the following Encounter operations are supported:
- `GET [base]/Encounter/[id]` (SHALL support read)
- `GET [base]/Encounter?[search parameters]` (SHALL support search-type)

However, these cannot be meaningfully applied without clarification of the requirement.

### Validation Criteria
**Cannot be established** - The requirement needs clarification on:
- What specific Encounter elements constitute the "type" being mapped
- What the target "Event.performer.function" mapping should contain
- What validation rules should be applied
- What would indicate successful vs. failed mapping

## Recommendation

This requirement should be **clarified or rewritten** to include:
1. Specific FHIR Encounter elements involved in the mapping
2. Clear definition of the target mapping destination
3. Concrete validation criteria for conformance testing
4. Examples of valid and invalid mappings

Without these details, automated conformance testing cannot be reliably implemented for this requirement.

---

<a id='req-416'></a>

### REQ-416: The Encounter resource SHALL map the individual to Event.performer.actor.

**Text**: 

**Context**: FHIR Workflow Pattern mapping for Encounter resource elements to Event pattern fields.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-416

## 1. Requirement ID
**REQ-416**

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified through automated inspection of Encounter resource instances to confirm the presence and mapping of individual/performer data to the Event.performer.actor field according to FHIR Workflow Pattern specifications.

### Complexity
**Simple** - The test involves straightforward validation of field mapping between Encounter resource elements and Event pattern fields.

### Prerequisites
- System must support US Core Encounter Profile (confirmed in Capability Statement)
- System must have Encounter resources available for testing
- Test data should include Encounter resources with performer/participant information
- System must support read operations on Encounter resources

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Encounter resources conforming to US Core Encounter Profile
- **Test Data**: Encounter instances that contain performer/participant information representing individuals involved in the encounter
- **System Access**: Read access to Encounter resources via FHIR API

### Expected Outputs
- Verification that individual performers in Encounter resources are properly mapped to Event.performer.actor according to FHIR Workflow Pattern
- Confirmation that the mapping maintains referential integrity and semantic correctness

### Required FHIR Operations
Based on the Capability Statement, the following operations are required:
- `GET [base]/Encounter/[id]` - Read specific Encounter resources
- `GET [base]/Encounter?patient=[patient-id]` - Search for Encounter resources by patient (if needed for test data discovery)

### Validation Criteria

**Primary Assertions:**
1. **Performer Mapping Verification**: For each Encounter resource tested, verify that individuals listed in `Encounter.participant` where `participant.type` indicates a performer role are correctly represented in the context of the Event workflow pattern as Event.performer.actor
2. **Individual Reference Validation**: Confirm that performer actors reference individual resources (Practitioner, PractitionerRole, RelatedPerson, or Patient) rather than organizational entities
3. **Cardinality Compliance**: Verify that the mapping maintains proper cardinality constraints - each individual performer in the Encounter has a corresponding Event.performer.actor mapping
4. **Data Type Consistency**: Ensure that the actor references maintain proper FHIR data types and reference structures

**Passing Criteria:**
- All individual performers identified in Encounter.participant are successfully mapped to Event.performer.actor pattern
- No organizational entities are incorrectly mapped as individual performers
- All references maintain proper FHIR resource reference format
- The mapping preserves the semantic meaning of the performer relationship

**Test Steps:**
1. Retrieve Encounter resources using supported read operations
2. Identify all `Encounter.participant` entries that represent individual performers
3. Validate that these individuals are appropriately represented in the Event workflow pattern mapping
4. Verify referential integrity of performer.actor references
5. Confirm that no required individual performers are missing from the Event pattern mapping
6. Ensure organizational participants are not incorrectly included as individual actors

**Failure Conditions:**
- Individual performers from Encounter.participant are missing from Event.performer.actor mapping
- Organizational entities are incorrectly mapped as individual actors
- Invalid or broken references in performer.actor fields
- Semantic mismatch between Encounter participant roles and Event performer roles

---

<a id='req-417'></a>

### REQ-417: The Encounter resource SHALL map the appointment to Event.basedOn.

**Text**: 

**Context**: FHIR Workflow Pattern mapping for Encounter resource elements to Event pattern fields.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-417

## Requirement ID
REQ-417

## Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified programmatically by examining the structure and content of Encounter resources to confirm the presence and correct mapping of appointment references to the Event.basedOn field.

### Complexity
**Simple** - The test involves a straightforward structural validation of a single field mapping within the Encounter resource.

### Prerequisites
- System must support US Core Encounter Profile
- System must have Encounter resources with appointment-based encounters
- System must support read operations on Encounter resources
- Test data should include Encounter resources that were created based on appointments

## Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: 
  - Encounter resources that conform to US Core Encounter Profile
  - Associated Appointment resources (if external references are used)
- **Test Data Requirements**: 
  - At least one Encounter resource that was created from an appointment
  - Encounter resources should represent real-world appointment-based scenarios

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for Encounter resources:
- `GET [base]/Encounter/[id]` - Read individual Encounter resources
- `GET [base]/Encounter?patient=[id]` - Search for Encounters by patient
- `GET [base]/Encounter?_id=[id]` - Search by Encounter ID

### Validation Criteria

#### Primary Validation
1. **Encounter.basedOn Presence Check**
   - **Assertion**: For Encounter resources that were created based on appointments, the `Encounter.basedOn` field SHALL be present
   - **Expected Result**: `Encounter.basedOn` element exists and is not empty

2. **Reference Type Validation**
   - **Assertion**: The `Encounter.basedOn` reference SHALL point to an Appointment resource
   - **Expected Result**: `Encounter.basedOn.reference` contains a valid reference to an Appointment resource (either relative reference like "Appointment/[id]" or absolute URL)

3. **Reference Integrity Check**
   - **Assertion**: If the appointment reference is external (not contained), it SHALL be resolvable
   - **Expected Result**: The referenced Appointment resource can be retrieved and exists in the system

#### Secondary Validation
4. **US Core Profile Conformance**
   - **Assertion**: The Encounter resource SHALL conform to the US Core Encounter Profile
   - **Expected Result**: Resource validation against US Core Encounter Profile succeeds

5. **FHIR Workflow Pattern Compliance**
   - **Assertion**: The mapping follows FHIR Workflow Event pattern where basedOn represents the authorization for the event
   - **Expected Result**: The relationship between the Encounter and referenced Appointment is semantically correct (the appointment authorized/triggered the encounter)

### Test Execution Steps

1. **Data Discovery**
   - Query the system for Encounter resources using supported search parameters
   - Identify Encounters that were appointment-based (may require manual identification or system-specific indicators)

2. **Structure Validation**
   - For each identified appointment-based Encounter:
     - Verify `basedOn` field is present
     - Validate the reference format and type
     - Confirm it points to an Appointment resource

3. **Reference Resolution**
   - Attempt to resolve external Appointment references
   - Verify the referenced Appointment exists and is accessible

4. **Profile Conformance**
   - Validate the Encounter resource against US Core Encounter Profile
   - Ensure all must-support elements are properly populated

### Expected Test Results

**Pass Criteria:**
- All appointment-based Encounter resources have populated `basedOn` fields
- All `basedOn` references correctly point to Appointment resources
- Referenced Appointments are resolvable (if external)
- Encounter resources conform to US Core Encounter Profile

**Fail Criteria:**
- Any appointment-based Encounter missing the `basedOn` field
- `basedOn` references pointing to non-Appointment resources
- Broken or unresolvable Appointment references
- Non-conformant Encounter resources

### Test Limitations
- The test relies on the ability to identify which Encounters were appointment-based, which may require domain knowledge or system-specific indicators
- Contained Appointment resources cannot be validated for external referential integrity
- The test cannot validate the semantic correctness of the appointment-encounter relationship beyond structural compliance

---

<a id='req-418'></a>

### REQ-418: The Encounter resource SHALL map the period to Event.occurrence[x].

**Text**: 

**Context**: FHIR Workflow Pattern mapping for Encounter resource elements to Event pattern fields.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-418

## 1. Requirement ID
REQ-418

## 2. Requirement Analysis

### Testability Assessment
**Classification:** Automatically testable

This requirement is directly testable through examination of FHIR resource structures. The mapping between `Encounter.period` and `Event.occurrence[x]` can be validated by inspecting the Encounter resource's period element and verifying it contains the expected temporal information.

### Complexity
**Level:** Simple

This is a straightforward structural validation that requires checking the presence and format of a single element (`period`) within an Encounter resource.

### Prerequisites
- System must support US Core Encounter Profile as specified in the Capability Statement
- System must have Encounter resources available with populated period elements
- Test system must be able to perform FHIR resource retrieval operations
- System must support the required search parameters for Encounter resources (minimally `patient` parameter)

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources:** 
  - Encounter resources conforming to US Core Encounter Profile
  - Associated Patient resources for context
- **Test Data Requirements:**
  - Encounter resources with populated `period` elements
  - Various period formats (period with start only, period with start and end, etc.)

### Expected Outputs
- Retrieved Encounter resources with validated period elements
- Confirmation that period elements conform to Event.occurrence[x] mapping requirements

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required for testing:

1. **Read Operation:**
   - `GET [base]/Encounter/[id]` - Retrieve specific Encounter resource

2. **Search Operations:**
   - `GET [base]/Encounter?patient=[patient-id]` - Search Encounters by patient
   - `GET [base]/Encounter?_id=[encounter-id]` - Search by Encounter ID
   - `GET [base]/Encounter?patient=[patient-id]&date=[date-range]` - Search by patient and date

### Validation Criteria

#### Primary Assertions
1. **Period Element Presence:**
   - Verify that retrieved Encounter resources contain the `period` element
   - Assert that `period` is populated with valid FHIR Period datatype structure

2. **Period Structure Validation:**
   - Verify `period.start` contains a valid dateTime value when present
   - Verify `period.end` contains a valid dateTime value when present  
   - Ensure at least `period.start` is populated (as per FHIR Period constraints)

3. **Event.occurrence[x] Mapping Compliance:**
   - Confirm that the period represents the time interval during which the encounter occurred
   - Validate that the period aligns with the Event pattern's occurrence timing requirements
   - Ensure the temporal information is complete enough to represent when the encounter took place

#### Secondary Assertions
1. **Data Type Conformance:**
   - Verify period follows FHIR Period datatype specifications
   - Confirm dateTime values follow FHIR dateTime format requirements
   - Validate timezone information when present

2. **Profile Conformance:**
   - Ensure Encounter resources conform to US Core Encounter Profile
   - Verify all must-support elements are present as required by the profile

#### Test Passing Criteria
A test passes when:
- All retrieved Encounter resources contain a properly structured `period` element
- The period element successfully maps temporal information as required by the Event.occurrence[x] pattern
- Period values are valid FHIR dateTime formats
- Resources conform to US Core Encounter Profile requirements

#### Test Failing Criteria
A test fails when:
- Encounter resources lack the `period` element entirely
- Period elements contain invalid or malformed dateTime values
- Period structure does not conform to FHIR Period datatype requirements
- The temporal mapping to Event.occurrence[x] cannot be established or is incomplete

---

<a id='req-419'></a>

### REQ-419: The Encounter resource SHALL map the length to Event.occurrence[x].

**Text**: 

**Context**: FHIR Workflow Pattern mapping for Encounter resource elements to Event pattern fields.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-419

## 1. Requirement ID
**REQ-419**

## 2. Requirement Analysis

### Testability Assessment
**Not testable due to being covered by the validator**

This requirement is a structural mapping constraint that ensures the Encounter resource's `length` element maps to the FHIR Workflow Pattern's `Event.occurrence[x]` field. This is a design-time conformance requirement that is enforced through the FHIR profile structure definition and validated by standard FHIR validators.

### Complexity
**Simple**

The requirement is a straightforward structural mapping constraint that doesn't involve complex business logic or multi-resource interactions.

### Prerequisites
- System must support the US Core Encounter Profile
- System must have Encounter resources with length information populated
- FHIR validator must be available to validate profile conformance

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Encounter resources that contain length information
- **Expected Outputs**: Validation results confirming structural conformance to the workflow pattern mapping

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for Encounter resources:
- `GET [base]/Encounter/[id]` (read operation - SHALL support)
- `GET [base]/Encounter?[search-parameters]` (search operation - SHALL support)

### Validation Criteria

This requirement is primarily validated through **profile validation** rather than functional testing, as it concerns structural mapping conformance. The validation should confirm:

1. **Profile Conformance**: Any Encounter resource with a `length` element must validate against the US Core Encounter Profile
2. **Workflow Pattern Mapping**: The profile definition correctly maps the `length` element to `Event.occurrence[x]` as specified in the FHIR Workflow Pattern

**Note**: This requirement does not require functional API testing as it is a structural constraint that is enforced by the profile definition and validated by FHIR validators. Systems implementing the US Core Encounter Profile will automatically conform to this mapping requirement if their resources validate successfully against the profile.

**Validation Approach**:
- Use FHIR profile validation tools to confirm Encounter resources conform to the US Core Encounter Profile
- Verify that the profile definition correctly implements the workflow pattern mapping (this is a one-time verification of the profile itself, not individual resource instances)

---

<a id='req-420'></a>

### REQ-420: The Encounter resource SHALL map the reasonCode to Event.reasonCode.

**Text**: 

**Context**: FHIR Workflow Pattern mapping for Encounter resource elements to Event pattern fields.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-420

## 1. Requirement ID
REQ-420

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified programmatically by examining Encounter resources and validating that the reasonCode field is properly mapped to Event.reasonCode according to FHIR Workflow Pattern specifications.

### Complexity
**Simple** - The requirement involves a straightforward field mapping validation that can be checked through resource structure inspection.

### Prerequisites
- System must support US Core Encounter Profile as specified in the Capability Statement
- System must have Encounter resources with reasonCode populated (when applicable)
- Test system must be able to perform read operations on Encounter resources
- Understanding of FHIR Workflow Pattern Event.reasonCode mapping requirements

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Encounter resources that contain reasonCode elements
- **Test Data**: Encounters with various reasonCode values (coded values from appropriate value sets)
- **System Access**: Ability to retrieve Encounter resources via FHIR API

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required for testing:

1. **GET [base]/Encounter/[id]** - Read specific Encounter resources
2. **GET [base]/Encounter?patient=[patient-id]** - Search for Encounters by patient (SHALL support)
3. **GET [base]/Encounter?_id=[id]** - Search by Encounter ID (SHALL support)

### Validation Criteria

#### Primary Validation Checks:

1. **Presence Validation**:
   - When Encounter.reasonCode is present, verify it contains valid coded values
   - Ensure reasonCode follows the structure: system, code, display (as appropriate)

2. **Mapping Compliance**:
   - Verify that Encounter.reasonCode values align with Event pattern reasonCode requirements
   - Confirm that the reasonCode represents the clinical reason for the encounter
   - Validate that reasonCode uses appropriate terminology (ICD-10, SNOMED CT, etc.)

3. **Data Type Validation**:
   - Confirm reasonCode is of type CodeableConcept
   - Verify proper structure with system and code elements when present
   - Ensure display text is meaningful when provided

4. **Conformance Validation**:
   - Validate that reasonCode mapping follows FHIR Workflow Pattern specifications
   - Ensure consistency across multiple Encounter resources
   - Verify that reasonCode complements rather than conflicts with reasonReference (if both are present)

#### Test Scenarios:

**Scenario 1: Basic Mapping Validation**
- Retrieve Encounters with populated reasonCode
- Assert that reasonCode contains valid CodeableConcept structure
- Verify code system is from appropriate value set
- Confirm mapping aligns with Event.reasonCode pattern

**Scenario 2: Multiple Reason Codes**
- Test Encounters with multiple reasonCode entries
- Validate each code follows the Event pattern mapping
- Ensure all codes are clinically relevant to the encounter

**Scenario 3: Consistency Check**
- Compare reasonCode across related Encounters for the same patient
- Verify consistent use of coding systems and patterns
- Ensure Event pattern compliance is maintained

#### Expected Test Results:

**Pass Criteria**:
- All Encounter.reasonCode elements are properly structured as CodeableConcept
- Reason codes use appropriate medical terminology systems
- Mapping follows FHIR Workflow Pattern Event.reasonCode specifications
- No structural or semantic errors in reasonCode representation

**Fail Criteria**:
- Encounter.reasonCode is malformed or uses inappropriate data types
- Reason codes use non-standard or inappropriate code systems
- Mapping does not align with Event pattern requirements
- Inconsistent implementation across resources

#### Implementation Notes:

1. **Data Dependency**: Test effectiveness depends on the presence of Encounters with reasonCode in the test system
2. **Value Set Validation**: Ensure reason codes come from clinically appropriate value sets (ICD-10, SNOMED CT, etc.)
3. **Pattern Compliance**: Focus on adherence to FHIR Workflow Pattern rather than clinical accuracy
4. **Error Handling**: Document any encounters where reasonCode is absent vs. improperly formatted

This test specification ensures that the Encounter resource properly implements the reasonCode to Event.reasonCode mapping as required by the FHIR Workflow Pattern, while working with whatever encounter data is available in the testing system.

---

<a id='req-421'></a>

### REQ-421: The Encounter resource SHALL map the reasonReference to Event.reasonCode.

**Text**: 

**Context**: FHIR Workflow Pattern mapping for Encounter resource elements to Event pattern fields.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-421

## 1. Requirement ID
REQ-421

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be programmatically verified by examining Encounter resources and validating that the reasonReference field properly maps to Event.reasonCode according to FHIR Workflow Pattern specifications.

### Complexity
**Simple** - The requirement involves straightforward field mapping validation between two specific FHIR elements within the Encounter resource.

### Prerequisites
- System must support US Core Encounter Profile
- System must have Encounter resources with populated reasonReference fields
- Test data should include Encounter resources that reference various resource types (Condition, Observation, etc.) in reasonReference
- System must support read operations on Encounter resources

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Encounter resources conforming to US Core Encounter Profile
- Referenced resources that are targets of Encounter.reasonReference (e.g., Condition, Observation, Procedure resources)

**Expected Outputs:**
- Encounter resources with properly mapped reasonReference to Event.reasonCode
- Validation confirmation that the mapping follows FHIR Workflow Pattern specifications

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required:

1. **GET [base]/Encounter/[id]** - Read specific Encounter resources
2. **GET [base]/Encounter?patient=[patient-id]** - Search for Encounters by patient
3. **GET [base]/Encounter?_id=[encounter-id]** - Search by Encounter ID
4. **GET [base]/[ResourceType]/[id]** - Read referenced resources (Condition, Observation, etc.)

### Validation Criteria

**Primary Assertions:**
1. **Encounter Resource Validation:**
   - Verify that retrieved Encounter resources conform to US Core Encounter Profile
   - Confirm that Encounter.reasonReference elements are properly populated when present
   - Validate that reasonReference contains valid references to supported FHIR resources

2. **Workflow Pattern Mapping Validation:**
   - Verify that when Encounter.reasonReference is populated, it correctly maps to the Event pattern's reasonCode field
   - Confirm that the referenced resource (target of reasonReference) contains appropriate coded values that can be mapped to Event.reasonCode
   - Validate that the mapping maintains semantic meaning between the reference and the corresponding code

3. **Reference Resolution:**
   - Verify that reasonReference values can be successfully resolved to actual FHIR resources
   - Confirm that referenced resources are accessible via the supported read operations
   - Validate that referenced resources contain the necessary coded information for proper Event.reasonCode mapping

**Test Case Scenarios:**
1. **Scenario 1: Encounter with Condition Reference**
   - Retrieve Encounter with reasonReference pointing to a Condition resource
   - Resolve the Condition reference and verify it contains appropriate diagnosis codes
   - Validate that the Condition.code can be properly mapped to Event.reasonCode

2. **Scenario 2: Encounter with Observation Reference**
   - Retrieve Encounter with reasonReference pointing to an Observation resource
   - Resolve the Observation reference and verify it contains appropriate observation codes
   - Validate that the Observation.code can be properly mapped to Event.reasonCode

3. **Scenario 3: Multiple reasonReference Validation**
   - Test Encounters containing multiple reasonReference elements
   - Verify that all references can be resolved and mapped appropriately
   - Confirm that the mapping preserves the relationship between multiple reasons

**Pass Criteria:**
- All Encounter resources with reasonReference fields successfully resolve to valid FHIR resources
- The mapping from reasonReference to Event.reasonCode maintains semantic integrity
- Referenced resources contain coded values that can be appropriately mapped to the Event pattern
- No broken references or mapping failures occur during validation
- The implementation follows FHIR Workflow Pattern specifications for Event.reasonCode mapping

**Failure Indicators:**
- Encounter.reasonReference contains unresolvable references
- Referenced resources lack appropriate coded values for Event.reasonCode mapping
- Mapping does not follow FHIR Workflow Pattern specifications
- System fails to support the required read operations for reference resolution

---

<a id='req-422'></a>

### REQ-422: The Encounter resource SHALL map the condition to Event.reasonReference.

**Text**: 

**Context**: FHIR Workflow Pattern mapping for Encounter resource elements to Event pattern fields.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-422

## 1. Requirement ID
REQ-422

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be tested programmatically by examining Encounter resources and verifying that conditions are properly mapped to the `reasonReference` element according to the FHIR Workflow Pattern.

### Complexity
**Simple** - The requirement involves checking a single field mapping within Encounter resources to verify proper implementation of the FHIR Workflow Pattern.

### Prerequisites
- System must support US Core Encounter Profile
- System must have Encounter resources with associated conditions
- System must support read operations on Encounter resources
- Test data should include Encounters that have conditions as reasons for the encounter

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Encounter resources that reference conditions as reasons
- Condition resources that are referenced by Encounters
- Patient resources associated with the Encounters

**Expected Outputs:**
- Encounter resources with populated `reasonReference` elements pointing to Condition resources
- Successful retrieval of referenced Condition resources
- Validation that the referenced conditions are properly structured

### Required FHIR Operations
Based on the Capability Statement, the following operations are required:

1. **Search for Encounters by patient:**
   ```
   GET [base]/Encounter?patient=[patient-id]
   ```

2. **Read specific Encounter resources:**
   ```
   GET [base]/Encounter/[encounter-id]
   ```

3. **Read referenced Condition resources:**
   ```
   GET [base]/Condition/[condition-id]
   ```

4. **Search for Conditions by patient (for validation):**
   ```
   GET [base]/Condition?patient=[patient-id]
   ```

### Validation Criteria

**Primary Assertions:**

1. **Encounter.reasonReference Population Check:**
   - When an Encounter has an associated condition as a reason, the `Encounter.reasonReference` element SHALL be populated
   - The `reasonReference` SHALL contain valid references to Condition resources

2. **Reference Resolution Validation:**
   - All references in `Encounter.reasonReference` SHALL resolve to valid, accessible Condition resources
   - Referenced Condition resources SHALL return HTTP 200 when accessed via GET operation

3. **Reference Format Validation:**
   - References SHALL follow proper FHIR reference format (either relative references like "Condition/[id]" or absolute URLs)
   - References SHALL point to resources of type "Condition"

4. **Workflow Pattern Compliance:**
   - The mapping SHALL follow FHIR Workflow Pattern guidelines for Event.reasonReference
   - Multiple conditions can be referenced if applicable to the encounter

**Secondary Assertions:**

5. **Data Consistency Check:**
   - Referenced Condition resources SHALL be associated with the same patient as the Encounter
   - Condition resources SHALL have appropriate clinical status and verification status

6. **Alternative Mapping Verification:**
   - If `Encounter.reasonReference` is not populated, verify that `Encounter.reasonCode` is used instead (as per US Core Encounter Profile guidance)
   - System SHALL support at least one method of expressing encounter reasons

**Test Pass Criteria:**
- All Encounter resources with condition-based reasons have properly populated `reasonReference` elements
- All referenced Condition resources are accessible and valid
- No broken or invalid references exist in the test dataset
- Referenced conditions belong to the same patient as the encounter

**Test Failure Scenarios:**
- Encounter has a condition as reason but `reasonReference` is empty and no `reasonCode` is provided
- `reasonReference` contains invalid or unresolvable references
- Referenced Condition resource returns HTTP 404 or other error
- Referenced Condition belongs to a different patient than the Encounter
- Reference format is malformed or does not follow FHIR standards

---

<a id='req-462'></a>

### REQ-462: US Core Encounter Profile implementation

**Text**: 

**Context**: System conformance to US Core Encounter Profile.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-462

## 1. Requirement ID
**REQ-462**: US Core Encounter Profile implementation

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated through automated testing by verifying that the system properly implements the US Core Encounter Profile including structure validation, Must Support elements, and required search capabilities.

### Complexity
**Moderate** - The requirement involves validating profile conformance, Must Support elements, search parameters, and ensuring proper FHIR resource structure and behavior according to US Core specifications.

### Prerequisites
- System must have US Core Server capability implemented
- System must support FHIR R4
- System must have Encounter resources available for testing
- System must support JSON format (required by US Core)
- System must implement required US Core search parameters for Encounter resources
- Authentication/authorization mechanism must be in place if required by the system

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Encounter resources that exist in the test system
- **System Endpoint**: Base FHIR server URL
- **Authentication**: Valid credentials/tokens if required
- **Patient References**: Valid patient identifiers to search for encounters

### Expected Outputs
- Valid US Core Encounter Profile-conformant resources
- Proper HTTP response codes (200, 400, 401, 403, 404 as specified)
- JSON-formatted responses
- Proper FHIR Bundle structures for search operations
- Conformant `meta.profile` declarations (should include US Core Encounter profile)

### Required FHIR Operations

Based on the Capability Statement, the following operations must be supported:

1. **READ Operation**: `GET [base]/Encounter/[id]`
2. **SEARCH Operations**: 
   - `GET [base]/Encounter` (with various search parameters)
   - Patient-specific searches as defined in US Core Encounter Profile

### Validation Criteria

#### Test Case 1: Profile Conformance Validation
**Objective**: Verify that Encounter resources conform to US Core Encounter Profile

**Test Steps**:
1. Retrieve Encounter resources from the system using READ operations
2. Validate each Encounter resource against the US Core Encounter Profile using FHIR validation
3. Verify that required elements are present and properly formatted
4. Check that Must Support elements are handled appropriately when present

**Assertions**:
- Encounter resources SHALL validate against US Core Encounter Profile
- All required elements per the profile SHALL be present
- Must Support elements, when present, SHALL be properly populated and accessible
- Resources SHOULD include `meta.profile` declaring conformance to US Core Encounter Profile

#### Test Case 2: JSON Format Support
**Objective**: Verify system supports required JSON format

**Test Steps**:
1. Request Encounter resources with `Accept: application/fhir+json` header
2. Verify response format is valid JSON
3. Verify response contains proper FHIR JSON structure

**Assertions**:
- System SHALL return valid JSON responses
- JSON structure SHALL conform to FHIR R4 specification
- Content-Type header SHALL indicate JSON format

#### Test Case 3: Search Parameter Implementation
**Objective**: Verify implementation of US Core required search parameters for Encounter

**Test Steps**:
1. Execute searches using US Core-defined search parameters for Encounter
2. Verify search results are properly filtered and formatted
3. Test search parameter combinations as defined in US Core

**Assertions**:
- System SHALL support US Core-defined search parameters for Encounter resources
- Search results SHALL return only relevant Encounter resources
- Search results SHALL be returned in proper Bundle format
- Pagination SHALL work correctly for large result sets

#### Test Case 4: HTTP Response Code Compliance
**Objective**: Verify proper HTTP response codes as specified in Capability Statement

**Test Steps**:
1. Test valid requests and verify 200 response codes
2. Test invalid parameters and verify 400 response codes
3. Test unauthorized requests and verify 401/403 response codes
4. Test requests for non-existent resources and verify 404 response codes

**Assertions**:
- Valid requests SHALL return 200 status codes
- Invalid parameters SHALL return 400 status codes
- Unauthorized requests SHALL return 401, 403, or 404 status codes
- Non-existent resources SHALL return 404 status codes

#### Test Case 5: Must Support Resource References
**Objective**: Verify that referenced resources follow US Core Must Support requirements

**Test Steps**:
1. Identify referenced resources in Encounter instances (e.g., Patient, Practitioner, Organization)
2. Verify that referenced resources are accessible and conform to appropriate US Core profiles
3. Check that the reference chain maintains US Core conformance

**Assertions**:
- Referenced resources SHALL be accessible through the FHIR API
- Referenced resources SHALL conform to their respective US Core profiles when applicable
- Reference integrity SHALL be maintained across the system

#### Test Case 6: Error Handling and Security
**Objective**: Verify proper error handling and security implementation

**Test Steps**:
1. Test system behavior with malformed requests
2. Verify security controls are properly implemented
3. Test system behavior under various authentication scenarios

**Assertions**:
- System SHALL handle errors gracefully with appropriate HTTP status codes
- System SHALL implement proper security controls as specified in US Core security requirements
- System SHALL reject unauthorized requests appropriately

### Pass/Fail Criteria
- **PASS**: All test cases pass their respective assertions
- **FAIL**: Any test case fails its assertions, indicating non-conformance to US Core Encounter Profile requirements

### Additional Considerations
- Test execution should accommodate existing system data without requiring specific test fixtures
- Tests should be repeatable and not dependent on specific data values
- Consider testing with various Encounter types and statuses that may exist in the system
- Validate that the system maintains US Core conformance across different usage patterns

---

<a id='req-514'></a>

### REQ-514: US Core Client SHALL fetch Encounter resources.

**Text**: 

**Context**: US Core Client read interaction for Encounter by id

**Actor**: US Core Client

**Conformance**: SHALL

# Test Specification for REQ-514

## 1. Requirement ID
REQ-514

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated through automated API testing by verifying the client's ability to perform read operations on Encounter resources.

### Complexity
**Simple** - This is a straightforward read operation requirement that tests basic FHIR RESTful API capability.

### Prerequisites
- US Core Server must be available and configured with Encounter resources
- Client system must have appropriate authentication credentials and authorization scopes
- Server must support US Core Encounter profile
- At least one valid Encounter resource must exist on the server for testing

## 3. Test Implementation Strategy

### Required Inputs
- **Server Base URL**: FHIR server endpoint supporting US Core
- **Authentication Credentials**: Valid credentials for client authentication
- **Encounter Resource ID**: Valid identifier of an existing Encounter resource on the server
- **Authorization Scopes**: Appropriate scopes for accessing Encounter resources

### Expected Outputs
- **HTTP Response**: Status code indicating success (200) or appropriate error codes
- **FHIR Encounter Resource**: Valid US Core Encounter resource in response body for successful requests
- **Error Response**: Appropriate FHIR OperationOutcome for error scenarios

### Required FHIR Operations
- **GET [base]/Encounter/[id]**: Read operation to fetch a specific Encounter resource by its logical ID

### Validation Criteria

#### Successful Read Operation Test Cases:

**Test Case 1: Valid Encounter Read**
- **Action**: Execute `GET [base]/Encounter/{valid-encounter-id}`
- **Expected Result**: 
  - HTTP status code 200
  - Response body contains valid FHIR Encounter resource
  - Response Content-Type is `application/fhir+json` or `application/json`
  - Returned resource has correct resource type (`Encounter`)
  - Returned resource ID matches requested ID

**Test Case 2: Profile Conformance Validation**
- **Action**: Validate returned Encounter resource against US Core Encounter profile
- **Expected Result**:
  - Resource validates successfully against US Core Encounter profile
  - All mandatory elements per US Core are present
  - Resource includes appropriate `meta.profile` reference to US Core Encounter profile (if supported)

#### Error Handling Test Cases:

**Test Case 3: Non-existent Resource**
- **Action**: Execute `GET [base]/Encounter/{non-existent-id}`
- **Expected Result**:
  - HTTP status code 404
  - Response body contains FHIR OperationOutcome with appropriate error details

**Test Case 4: Invalid Resource ID Format**
- **Action**: Execute `GET [base]/Encounter/{malformed-id}`
- **Expected Result**:
  - HTTP status code 400
  - Response body contains FHIR OperationOutcome indicating invalid parameter

**Test Case 5: Unauthorized Access**
- **Action**: Execute `GET [base]/Encounter/{valid-encounter-id}` without valid authentication
- **Expected Result**:
  - HTTP status code 401, 403, or 404 (per server security policy)
  - Response body contains appropriate error information

**Test Case 6: Insufficient Scopes**
- **Action**: Execute `GET [base]/Encounter/{valid-encounter-id}` with valid authentication but insufficient scopes
- **Expected Result**:
  - HTTP status code 403
  - Response body contains FHIR OperationOutcome indicating insufficient permissions

#### Content Format Test Cases:

**Test Case 7: JSON Format Support**
- **Action**: Execute `GET [base]/Encounter/{valid-encounter-id}` with `Accept: application/fhir+json` header
- **Expected Result**:
  - HTTP status code 200
  - Response Content-Type is `application/fhir+json` or `application/json`
  - Response body is valid JSON format

**Test Case 8: XML Format Support (Optional)**
- **Action**: Execute `GET [base]/Encounter/{valid-encounter-id}` with `Accept: application/fhir+xml` header
- **Expected Result**:
  - If supported: HTTP status code 200 with XML content
  - If not supported: HTTP status code 406 or successful response in default format

### Pass/Fail Criteria

**Test passes if**:
- Client successfully executes read operations for valid Encounter resources
- Client properly handles and responds to error conditions (404, 400, 401/403)
- Client correctly processes JSON formatted responses (mandatory)
- All returned Encounter resources conform to US Core Encounter profile requirements

**Test fails if**:
- Client cannot perform basic read operations on existing Encounter resources
- Client does not properly handle standard HTTP error responses
- Client cannot process mandatory JSON format responses
- Returned resources do not conform to US Core Encounter profile

---



<a id='general/cross-resource'></a>

## General/Cross-Resource

<a id='req-208'></a>

### REQ-208: The system should allow multiple OR conditions in search parameters.

**Text**: 

**Context**: 

**Actor**: System

**Conformance**: MAY

# Test Specification for REQ-208

## 1. Requirement ID
**REQ-208**: Multiple OR conditions in search parameters

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be tested through automated API calls that verify the system's ability to handle multiple OR conditions in search parameters using FHIR's comma-separated value syntax.

### Complexity
**Moderate** - Requires testing multiple search parameter types (token, reference, string, date) across different resources with OR logic, and validating that results include records matching any of the specified criteria.

### Prerequisites
- FHIR server implementation supporting US Core profiles
- Test data containing resources with varying values for searchable parameters
- Resources must exist that would match individual OR conditions to validate proper OR logic implementation

## 3. Test Implementation Strategy

### Required Inputs
**Test Data Requirements:**
- Multiple resources of the same type with different values for the same search parameter
- For example: Organizations with different names, Patients with different identifiers, Conditions with different categories, etc.
- Data should be structured so that some resources match the first OR condition, others match the second OR condition, and some may match both

**Expected Outputs:**
- Search results that include all resources matching ANY of the specified OR conditions
- Results should be a superset of what would be returned by individual searches for each condition
- Proper HTTP response codes (200 for successful searches, 400 for malformed requests)

### Required FHIR Operations

Based on the Capability Statement, the following search operations support multiple OR conditions:

1. **Organization searches** (name parameter - string type):
   ```
   GET [base]/Organization?name=value1,value2,value3
   ```

2. **Patient searches** (identifier, name parameters):
   ```
   GET [base]/Patient?identifier=system1|code1,system2|code2
   GET [base]/Patient?name=name1,name2,name3
   ```

3. **Token-based searches** across multiple resources:
   ```
   GET [base]/Condition?patient=[id]&category=code1,code2,code3
   GET [base]/Observation?patient=[id]&category=category1,category2
   GET [base]/AllergyIntolerance?patient=[id]&clinical-status=status1,status2
   ```

4. **Reference-based searches**:
   ```
   GET [base]/CareTeam?patient=Patient/id1,Patient/id2
   ```

### Validation Criteria

**Test Cases:**

1. **String Parameter OR Logic Testing**
   - Execute: `GET [base]/Organization?name=name1,name2`
   - Assert: Results include organizations with name matching "name1" OR "name2"
   - Verify: Result count ≥ individual searches for each name

2. **Token Parameter OR Logic Testing**
   - Execute: `GET [base]/Patient?identifier=system1|code1,system2|code2`
   - Assert: Results include patients with either identifier
   - Verify: Proper handling of system|code format in OR conditions

3. **Complex Token OR Logic Testing**
   - Execute: `GET [base]/Condition?patient=[id]&clinical-status=active,resolved,inactive`
   - Assert: Results include conditions with any of the specified statuses
   - Verify: Union of results (not intersection)

4. **Reference Parameter OR Logic Testing**
   - Execute: `GET [base]/Observation?patient=Patient/id1,Patient/id2`
   - Assert: Results include observations for either patient
   - Verify: Proper handling of reference format in OR conditions

5. **Date Parameter OR Logic Testing**
   - Execute: `GET [base]/DiagnosticReport?patient=[id]&date=2023-01-01,2023-06-01`
   - Assert: Results include reports from either date
   - Verify: Proper date format handling in OR conditions

**Validation Assertions:**

1. **Logical OR Verification**: 
   - Count of results from OR search ≥ count from individual parameter searches
   - Results contain union of individual searches, not intersection

2. **Parameter Format Compliance**:
   - Server accepts comma-separated values for all supported parameter types
   - Server returns HTTP 400 for malformed OR syntax

3. **Data Type Specific Validation**:
   - Token parameters: Support both code-only and system|code formats in OR conditions
   - Reference parameters: Support both id-only and Type/id formats in OR conditions
   - String parameters: Support multiple string values with appropriate matching
   - Date parameters: Support multiple date values with proper precision

4. **Error Handling**:
   - Invalid OR syntax returns appropriate error codes
   - Mixed valid/invalid values in OR conditions handled gracefully

**Success Criteria:**
- All OR search requests return results that represent the logical union of individual parameter value matches
- Server correctly interprets comma-separated values as OR conditions rather than AND conditions
- Proper HTTP response codes for both successful and error scenarios
- Results demonstrate that the server processes each value in the OR condition independently

---

<a id='req-209'></a>

### REQ-209: The system should allow multiple AND conditions in search parameters.

**Text**: 

**Context**: 

**Actor**: System

**Conformance**: MAY

# Test Specification for REQ-209

## 1. Requirement ID
REQ-209

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be tested through automated API calls to verify the system's support for multiple AND conditions in search parameters.

### Complexity
**Moderate** - Requires testing multiple search parameter combinations with AND logic across different resource types and validating proper logical conjunction behavior.

### Prerequisites
- FHIR server implementing US Core profiles
- Test data containing resources with multiple searchable parameters
- Access to perform search operations on supported resource types
- Resources must exist with varied parameter values to enable meaningful AND condition testing

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Any US Core conformant resources present in the system that support multiple search parameters (e.g., Patient, Condition, Observation, etc.)
- **Search Parameters**: Multiple parameters from the same resource type that can be combined with AND logic
- **Test Data Requirements**: Resources with overlapping and non-overlapping parameter values to test both positive and negative cases

### Required FHIR Operations
Based on the Capability Statement, the following search operations are supported and can be used for testing:

1. **Patient Resource Searches**:
   - `GET [base]/Patient?name=[value]&birthdate=[value]` (SHALL support combination)
   - `GET [base]/Patient?family=[value]&birthdate=[value]` (SHOULD support combination)
   - `GET [base]/Patient?family=[value]&death-date=[value]` (SHOULD support combination)

2. **Condition Resource Searches**:
   - `GET [base]/Condition?patient=[value]&category=[value]` (SHALL support combination)
   - `GET [base]/Condition?patient=[value]&category=[value]&clinical-status=[value]` (SHOULD support combination)
   - `GET [base]/Condition?patient=[value]&category=[value]&encounter=[value]` (SHOULD support combination)

3. **Observation Resource Searches**:
   - `GET [base]/Observation?patient=[value]&category=[value]` (SHALL support combination)
   - `GET [base]/Observation?patient=[value]&category=[value]&date=[value]` (SHALL support combination)
   - `GET [base]/Observation?patient=[value]&code=[value]&date=[value]` (SHOULD support combination)

4. **DiagnosticReport Resource Searches**:
   - `GET [base]/DiagnosticReport?patient=[value]&category=[value]` (SHALL support combination)
   - `GET [base]/DiagnosticReport?patient=[value]&category=[value]&date=[value]` (SHALL support combination)
   - `GET [base]/DiagnosticReport?patient=[value]&code=[value]&date=[value]` (SHOULD support combination)

### Validation Criteria

#### Test Case 1: Basic AND Condition Support
**Objective**: Verify system supports multiple AND conditions in search parameters

**Test Steps**:
1. Identify resources with multiple searchable parameters
2. Construct search queries using 2+ parameters connected with AND logic
3. Execute searches using supported parameter combinations from the Capability Statement

**Assertions**:
- Search requests with multiple parameters return HTTP 200 status
- Results contain only resources matching ALL specified criteria
- No resources are returned that match only partial criteria
- Empty result sets are handled appropriately when no resources match all criteria

#### Test Case 2: Logical Conjunction Validation
**Objective**: Verify AND logic is properly implemented (not OR logic)

**Test Steps**:
1. Execute search with single parameter values that individually return different result sets
2. Execute same search with multiple parameters using AND logic
3. Compare result sets to ensure intersection behavior

**Assertions**:
- Multi-parameter search results are subset of each individual parameter search
- Results represent true logical AND (intersection) not OR (union)
- No false positives where resources match only some criteria

#### Test Case 3: Parameter Type Variety
**Objective**: Test AND conditions across different parameter types (reference, token, date, string)

**Test Steps**:
1. Test combinations of different parameter types as specified in Capability Statement
2. Examples:
   - Reference + Token: `patient=[id]&status=[code]`
   - Reference + Date: `patient=[id]&date=[date]`
   - Reference + Token + Date: `patient=[id]&category=[code]&date=[date]`

**Assertions**:
- System correctly handles AND logic across different parameter types
- Type-specific search behavior is maintained within AND context
- Date ranges, token matching, and reference resolution work correctly in combination

#### Test Case 4: Error Handling
**Objective**: Verify appropriate handling of invalid AND condition searches

**Test Steps**:
1. Send requests with unsupported parameter combinations
2. Send requests with invalid parameter values in AND conditions
3. Send requests with malformed AND syntax

**Assertions**:
- Appropriate HTTP error codes returned for unsupported combinations
- Error messages clearly indicate issues with parameter combinations
- System doesn't crash or return unexpected results

#### Test Case 5: Performance and Scalability
**Objective**: Ensure AND condition searches perform adequately

**Test Steps**:
1. Execute searches with increasing numbers of AND conditions
2. Test with large result sets and complex parameter combinations

**Assertions**:
- Response times remain reasonable for complex AND conditions
- System can handle multiple simultaneous AND condition searches
- Memory usage remains stable during complex searches

#### Pass/Fail Criteria
**Pass**: 
- All supported parameter combinations from Capability Statement work correctly with AND logic
- Results consistently represent true logical conjunction
- Appropriate error handling for unsupported cases
- Performance remains acceptable

**Fail**:
- AND conditions return OR-like results (false positives)
- Supported parameter combinations don't work
- System errors or crashes during AND condition processing
- Significant performance degradation with multiple conditions

---

<a id='req-213'></a>

### REQ-213: The SearchParameter USCorePatientId SHALL NOT be used as a search parameter for search.

**Text**: 

**Context**: 

**Actor**: Servers and Clients

**Conformance**: SHALL NOT

# Test Specification for REQ-213

## Requirement ID
REQ-213

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be systematically verified by checking server behavior when the USCorePatientId SearchParameter is used in search requests.

### Complexity
**Simple** - The requirement has a clear prohibition that can be tested through direct API calls and response validation.

### Prerequisites
- US Core Server implementation under test
- Access to the server's CapabilityStatement
- Ability to make FHIR search requests to the server
- Test data containing Patient resources (bring your own data approach)

## Test Implementation Strategy

### Required Inputs
- **FHIR Server Endpoint**: Base URL of the US Core Server under test
- **Authentication Credentials**: As required by the server
- **Existing Patient Data**: Any patient resources already present in the server (no specific fixtures required)

### Expected Outputs
- Server responses that demonstrate the USCorePatientId SearchParameter is not supported for search operations
- Appropriate error responses when the parameter is used

### Required FHIR Operations
1. **GET [base]/Patient** - Search for patients using various search parameters
2. **GET [base]/metadata** - Retrieve server CapabilityStatement (optional for verification)

### Validation Criteria

#### Test Case 1: Direct USCorePatientId Search Parameter Usage
**Objective**: Verify that the server rejects or ignores the USCorePatientId search parameter

**Test Steps**:
1. Attempt to search for patients using the USCorePatientId search parameter:
   - `GET [base]/Patient?us-core-patient-id=[any-value]`
2. Examine the server response

**Pass Criteria**:
- Server returns an appropriate error response (400 Bad Request with error details indicating unsupported parameter) **OR**
- Server ignores the USCorePatientId parameter and processes the search without using it (returns results as if the parameter was not provided)
- Server does **NOT** return filtered results based on the USCorePatientId parameter

#### Test Case 2: USCorePatientId Combined with Valid Parameters
**Objective**: Verify behavior when USCorePatientId is combined with valid search parameters

**Test Steps**:
1. Attempt to search using both USCorePatientId and a valid search parameter:
   - `GET [base]/Patient?us-core-patient-id=[any-value]&family=[existing-family-name]`
2. Compare results with a search using only the valid parameter:
   - `GET [base]/Patient?family=[same-family-name]`

**Pass Criteria**:
- Results from both searches are identical (proving USCorePatientId was ignored) **OR**
- Server returns an error for the first request due to the unsupported parameter
- Server does **NOT** use USCorePatientId to filter results

#### Test Case 3: Server CapabilityStatement Verification (Optional)
**Objective**: Verify that the server's CapabilityStatement does not advertise support for USCorePatientId

**Test Steps**:
1. Retrieve the server's CapabilityStatement: `GET [base]/metadata`
2. Examine the Patient resource definition within the CapabilityStatement
3. Check the searchParams section for any reference to USCorePatientId

**Pass Criteria**:
- The USCorePatientId search parameter is **NOT** listed in the Patient resource's supported search parameters in the CapabilityStatement

#### Test Case 4: Documentation Compliance Check
**Objective**: Verify server behavior aligns with the documented expectation

**Test Steps**:
1. Review any server documentation or help endpoints
2. Verify that USCorePatientId is not documented as a supported search parameter

**Pass Criteria**:
- Server documentation does not list USCorePatientId as a supported search parameter
- If documentation exists about US Core SearchParameters, it clearly states they should not be used for search

### Additional Validation Notes

**Error Response Expectations**:
- If the server returns an error, it should be a 400 Bad Request with a meaningful error message
- The server MAY return other appropriate HTTP status codes as long as the search functionality using USCorePatientId is prevented

**Acceptable Server Behaviors**:
1. **Explicit Rejection**: Return HTTP 400 with error message about unsupported parameter
2. **Silent Ignore**: Process the request but ignore the USCorePatientId parameter entirely
3. **Parameter Stripping**: Remove the unsupported parameter and process remaining valid parameters

**Unacceptable Server Behavior**:
- Using USCorePatientId to filter or modify search results in any way
- Returning different results when USCorePatientId is included versus excluded (unless due to error handling)

### Test Execution Strategy
- Execute tests with multiple different values for the USCorePatientId parameter to ensure consistent behavior
- Use existing patient data in the system to verify that results are not incorrectly filtered
- Test with both standalone USCorePatientId usage and in combination with valid parameters
- Verify behavior is consistent across different HTTP methods (GET with query parameters)

---

<a id='req-214'></a>

### REQ-214: Servers and Clients SHOULD use the standard FHIR SearchParameter instead of USCorePatientId.

**Text**: 

**Context**: 

**Actor**: Servers and Clients

**Conformance**: SHOULD

# Test Specification for REQ-214

## 1. Requirement ID
**REQ-214**: Servers and Clients SHOULD use the standard FHIR SearchParameter instead of USCorePatientId

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified through automated testing by examining search parameter usage in actual API requests and responses.

### Complexity
**Simple** - The test involves verifying that systems use standard FHIR search parameters rather than custom US Core specific ones.

### Prerequisites
- A US Core compliant server with Patient resources
- Test client capable of making FHIR search requests
- Patient data available for searching
- Server implements Patient search functionality as defined in US Core Server CapabilityStatement

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Patient resources with various identifier values
- **Test Data Requirements**: 
  - Patients with different identifier types (MRN, SSN, etc.)
  - Patients with known identifier values for search testing
- **System Under Test**: US Core Server implementation

### Expected Outputs
- Search results using standard FHIR search parameters
- Demonstration that custom US Core search parameters are not required for functionality
- Consistent behavior between standard and custom parameter usage (if both are supported)

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required for testing:

1. **Patient Search Operations**:
   - `GET [base]/Patient?identifier={value}`
   - `GET [base]/Patient?_id={value}`
   - Other Patient search parameters as defined in US Core Patient profile

### Validation Criteria

#### Primary Test Cases

**Test Case 1: Standard FHIR Search Parameter Usage**
- **Action**: Execute Patient searches using standard FHIR search parameters (e.g., `identifier`, `_id`)
- **Assertion**: Server responds successfully with appropriate Patient resources
- **Expected Result**: HTTP 200 with Bundle containing matching Patient resources

**Test Case 2: Functional Equivalence Verification**
- **Action**: If server supports both standard FHIR parameters and US Core custom parameters, compare results
- **Assertion**: Results should be functionally equivalent between standard and custom parameters
- **Expected Result**: Same or equivalent Patient resources returned for equivalent search criteria

**Test Case 3: Server Capability Documentation**
- **Action**: Review server's CapabilityStatement for search parameter definitions
- **Assertion**: Server documents support for standard FHIR search parameters
- **Expected Result**: CapabilityStatement includes standard FHIR SearchParameters for Patient resource

**Test Case 4: Client Implementation Verification**
- **Action**: Observe client search requests in test scenarios
- **Assertion**: Client preferentially uses standard FHIR search parameters
- **Expected Result**: Client demonstrates use of standard parameters like `identifier` rather than custom alternatives

#### Secondary Validation Checks

**Conformance Validation**:
- Verify server returns appropriate HTTP status codes (200, 400, 401, 403, 404) as specified in CapabilityStatement
- Confirm JSON format support for all interactions
- Validate response Bundle structure conforms to FHIR specification

**Error Handling**:
- **Invalid Parameters**: Server returns HTTP 400 for malformed search parameters
- **Authorization**: Server returns HTTP 401/403 for unauthorized requests
- **Not Found**: Server returns HTTP 404 for unknown resources

#### Pass/Fail Criteria

**PASS Conditions**:
- Server successfully processes searches using standard FHIR search parameters
- Client implementations demonstrate use of standard parameters when available
- If custom parameters are used, they provide equivalent functionality to standard parameters
- Server behavior aligns with US Core Server CapabilityStatement requirements

**FAIL Conditions**:
- Server requires use of custom US Core parameters when standard FHIR parameters would suffice
- Client exclusively uses custom parameters without attempting standard parameters
- Standard parameter usage results in different or incorrect results compared to custom parameters
- Server fails to support standard FHIR search parameters as documented in CapabilityStatement

#### Implementation Notes

1. **SHOULD Conformance**: Since this is a SHOULD requirement, non-compliance does not constitute a failure but should be documented as a deviation from best practice

2. **Backward Compatibility**: Systems may support both standard and custom parameters during transition periods

3. **Documentation**: Test results should include evidence of which search parameters were used and their effectiveness

4. **Interoperability Focus**: Testing should verify that use of standard parameters enhances interoperability between different system implementations

---

<a id='req-256'></a>

### REQ-256: Include "problem-list-item" code in the value set

**Text**: 

**Context**: 

**Actor**: System implementing the value set

**Conformance**: SHALL

# Test Specification for REQ-256

## 1. Requirement ID
REQ-256

## 2. Requirement Analysis

### Testability Assessment: Automatically Testable
This requirement can be automatically tested by examining value sets used by the system to verify the presence of the "problem-list-item" code. The test can validate this through FHIR ValueSet resources and their expansion operations.

### Complexity: Simple
The requirement involves a straightforward verification of code presence in a value set, which can be tested through standard FHIR ValueSet operations.

### Prerequisites
- System must implement FHIR ValueSet resources
- System must support the ValueSet `$expand` operation (as indicated in the Capability Statement)
- The system should have value sets that are expected to contain condition category codes
- Access to value sets used for categorizing conditions (particularly those used in US Core Condition profiles)

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: ValueSet resources that should contain condition category codes
- **Test Data**: Any existing ValueSet resources in the system that are used for condition categorization
- **Expected Code**: The specific code "problem-list-item" that must be present

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required:

1. **ValueSet `$expand` operation** - To retrieve the expanded list of codes in a value set
2. **ValueSet read operations** - To retrieve specific ValueSet resources
3. **Search operations** - To discover relevant ValueSet resources (if needed)

### Validation Criteria

#### Primary Validation
1. **Code Presence Verification**: 
   - Execute `$expand` operation on relevant value sets
   - Verify that the expansion contains a concept with code "problem-list-item"
   - Confirm the code is active and not deprecated

#### Secondary Validations
2. **ValueSet Structure Validation**:
   - Verify the ValueSet resource conforms to FHIR specification
   - Ensure proper system URI is associated with the "problem-list-item" code
   - Validate that the code has appropriate display text

3. **Contextual Validation**:
   - If the system uses US Core Condition profiles, verify that value sets used for condition categories include "problem-list-item"
   - Cross-reference with condition resources to ensure the code can be properly utilized

#### Test Steps
1. **Discovery Phase**:
   - Identify ValueSet resources in the system that contain condition category codes
   - Focus on value sets referenced by US Core Condition profiles (if implemented)

2. **Expansion Phase**:
   - For each relevant ValueSet, perform `$expand` operation
   - Retrieve the complete list of concepts

3. **Verification Phase**:
   - Search the expanded concepts for code "problem-list-item"
   - Verify the code exists and is properly structured
   - Document any missing instances

4. **Compliance Assessment**:
   - **PASS**: "problem-list-item" code is found in appropriate value sets with correct structure
   - **FAIL**: Code is missing from value sets where it should be present
   - **CONDITIONAL PASS**: Code exists but with structural issues that don't prevent functionality

#### Expected Assertions
- `Assert: ValueSet expansion contains concept with code = "problem-list-item"`
- `Assert: Code has valid system URI`
- `Assert: Code has appropriate display text`
- `Assert: Code status is active (not deprecated or inactive)`

#### Integration with System Capabilities
This test leverages the system's support for:
- ValueSet `$expand` operation (explicitly supported per Capability Statement)
- JSON format support (required per Capability Statement)
- US Core profile implementation (if applicable, particularly Condition profiles)

The test approach accommodates a "bring your own data" methodology by working with whatever ValueSet resources exist in the target system, rather than requiring specific test fixtures.

---

<a id='req-257'></a>

### REQ-257: Include "health-concern" code in the value set

**Text**: 

**Context**: 

**Actor**: System implementing the value set

**Conformance**: SHALL

# Test Specification for REQ-257

## 1. Requirement ID
REQ-257: Include "health-concern" code in the value set

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be automatically validated by checking if the "health-concern" code is included in the specified value set implementation.

### Complexity
**Simple** - This is a straightforward validation of value set content inclusion.

### Prerequisites
- System must implement US Core profiles that utilize value sets containing problem/condition categories
- System must have ValueSet resource support with expand operation capability (as indicated in the Capability Statement)
- Access to the implemented value set that should contain the "health-concern" code
- Based on the Capability Statement context showing Condition resources with US Core profiles, this likely relates to condition category value sets

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources Needed:**
  - ValueSet resource(s) that should contain the "health-concern" code
  - Potentially Condition resources using US Core Condition Problems and Health Concerns Profile
  
- **Test Data Requirements:**
  - Any existing ValueSet resources in the system that are used for categorizing health concerns/problems
  - Any existing Condition resources that might reference health-concern categories

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required:

1. **ValueSet/$expand Operation**
   - `GET [base]/ValueSet/[id]/$expand` - To retrieve the expanded value set content
   - This operation is explicitly listed as supported in the Capability Statement

2. **ValueSet Read Operation** (if direct ValueSet access is needed)
   - `GET [base]/ValueSet/[id]` - To retrieve the ValueSet definition

3. **Condition Search Operations** (for validation context)
   - `GET [base]/Condition?patient=[id]&category=[code]` - To verify usage of health-concern category
   - These search parameters are supported per the Capability Statement

### Validation Criteria

The test shall verify conformance through the following assertions:

#### Primary Validation
1. **Value Set Content Verification:**
   - Execute ValueSet/$expand operation on relevant value sets used for condition/problem categorization
   - Verify that the expanded value set contains a code with the value "health-concern"
   - Assert that the "health-concern" code is properly defined with appropriate display text and definition

#### Secondary Validation (Context-based)
2. **Implementation Usage Verification:**
   - If Condition resources exist in the system, search for conditions using category parameter
   - Verify that "health-concern" can be used as a valid category value for Condition resources
   - Confirm that Condition resources referencing "health-concern" category validate successfully against US Core profiles

#### Specific Assertions for Test Pass Criteria
- **PASS Condition 1:** The ValueSet/$expand operation returns a response containing at least one code element where `code.code = "health-concern"`
- **PASS Condition 2:** The "health-concern" code entry includes appropriate metadata (display text, system URI)
- **PASS Condition 3:** If testing with actual Condition resources, creating/updating a Condition resource with category "health-concern" does not result in validation errors
- **FAIL Condition:** The expanded value set does not contain any code with value "health-concern"

#### Test Execution Flow
1. Identify the appropriate ValueSet resource(s) used for condition/problem categorization in the implementation
2. Execute the $expand operation on the identified ValueSet(s)
3. Parse the expansion response and search for the "health-concern" code
4. Validate the code's presence and proper definition
5. Optionally test practical usage by attempting to use "health-concern" as a category value in relevant resources

This test specification ensures that implementations properly include the required "health-concern" code in their value sets, supporting interoperability for health concern categorization as required by the US Core Implementation Guide.

---

<a id='req-305'></a>

### REQ-305: Inclusion of all CPT codes in the value set

**Text**: 

**Context**: 

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-305

## 1. Requirement ID
**REQ-305**: Inclusion of all CPT codes in the value set

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Not testable due to insufficient specification

**Rationale**: The requirement is too vague to create a meaningful automated test. Key missing information includes:
- Which specific value set should contain CPT codes
- What constitutes "all CPT codes" (current version, historical versions, specific subsets)
- How to identify the target value set in FHIR resources
- What FHIR operations should be used to verify value set contents

### Complexity
**Level**: Not Applicable (due to insufficient specification)

### Prerequisites
Cannot be determined without clarification of the requirement scope and target value set identification.

## 3. Test Implementation Strategy

### Required Clarifications
Before this requirement can be tested, the following information must be provided:

1. **Value Set Identification**: 
   - Canonical URL or identifier of the target value set
   - Which FHIR resources or profiles reference this value set

2. **CPT Code Scope**:
   - Which version(s) of CPT codes should be included
   - Whether historical/deprecated codes should be included
   - Any specific CPT code categories or ranges

3. **Verification Method**:
   - How the system exposes value sets (ValueSet resources, $expand operation, etc.)
   - Expected FHIR operations for value set validation

### Potential Test Implementation (Pending Clarifications)

#### Required Inputs
- Target value set canonical URL or identifier
- Reference CPT code list for validation
- System endpoint supporting ValueSet operations

#### Required FHIR Operations
Based on US Core Server Capability Statement:
- **Supported**: `GET` operations for resource retrieval
- **May be supported**: System-level search operations
- **Note**: ValueSet-specific operations (like `$expand`) are not explicitly mentioned in the provided capability statement

#### Validation Criteria (Hypothetical)
If clarifications were provided, the test would verify:
- Value set can be retrieved successfully
- All expected CPT codes are present in the value set
- No unexpected codes are included (if scope is restrictive)
- Proper FHIR ValueSet structure and metadata

### Recommendation
**This requirement should be refined** to include:
- Specific value set identification
- Clear definition of "all CPT codes"
- Expected FHIR interaction patterns
- Acceptance criteria for conformance

Without these clarifications, automated testing cannot be implemented effectively, and the requirement cannot be verified for interoperability conformance.

---

<a id='req-307'></a>

### REQ-307: Inclusion of all HCPCS Level II codes in the value set

**Text**: 

**Context**: 

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-307

## 1. Requirement ID
REQ-307

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Not testable due to being too vague

**Rationale**: The requirement states "Inclusion of all HCPCS Level II codes in the value set" but lacks critical details needed for implementation testing:
- Does not specify which FHIR value set should contain the HCPCS Level II codes
- Does not identify the specific FHIR resource or element that should reference this value set
- Does not define what constitutes "all HCPCS Level II codes" (which version, effective date, active vs. inactive codes)
- No clear relationship to the provided US Core Server Capability Statement requirements

### Complexity
**N/A** - Cannot assess complexity due to insufficient specification details

### Prerequisites
**Cannot be determined** - The requirement lacks specificity to identify necessary system configurations, required data sets, or setup requirements.

## 3. Test Implementation Strategy

### Required Inputs
**Cannot be specified** - Without knowing:
- Which FHIR value set should contain the HCPCS codes
- Which US Core profiles or resources should use this value set
- The specific context where HCPCS codes should appear

### Required FHIR Operations
**Cannot be determined** - The operations would depend on:
- Whether this involves ValueSet expansion operations
- Which specific US Core resources need to be tested for HCPCS code usage
- Whether this requires terminology server interactions

### Validation Criteria
**Cannot be established** - Would require:
- Clear identification of the target value set URI
- Definition of which HCPCS Level II code version/source to validate against
- Specific US Core profile elements that should accept these codes

## Recommendations for Requirement Refinement

To make this requirement testable, the following information should be provided:

1. **Specific Value Set Identification**: 
   - Canonical URL of the value set that should contain HCPCS Level II codes
   - Version of HCPCS Level II codes to include (e.g., current year, specific effective date)

2. **Context Specification**:
   - Which US Core profile elements should use this value set
   - Whether this applies to specific resources like Procedure, Claim, etc.

3. **Scope Definition**:
   - Whether "all codes" means active codes only or includes inactive/deprecated codes
   - If there are any exclusions or filters to apply

4. **Implementation Details**:
   - Whether the value set should be expanded inline or reference an external terminology server
   - How to handle updates to HCPCS Level II codes over time

**Note**: Until these clarifications are provided, this requirement cannot be meaningfully tested in an interoperability context.

---

<a id='req-309'></a>

### REQ-309: Inclusion of all CDT codes in the value set

**Text**: 

**Context**: 

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-309

## 1. Requirement ID
REQ-309: Inclusion of all CDT codes in the value set

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Automatically testable

This requirement can be automatically validated by:
- Retrieving value sets from the server that claim to contain CDT codes
- Verifying the completeness of CDT codes within those value sets against the official CDT code system
- Checking that all mandatory CDT codes are present and properly defined

### Complexity
**Level**: Moderate

The complexity is moderate because it requires:
- Knowledge of the complete CDT code system for comparison
- Ability to query and validate value set contents
- Understanding of FHIR ValueSet structure and expansion mechanisms
- Verification against an authoritative CDT code source

### Prerequisites
- Server must support ValueSet resources and operations
- Access to the official CDT (Current Dental Terminology) code system for validation
- Server must have implemented value sets that claim to include CDT codes
- Network connectivity to query FHIR endpoints

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources Needed**:
- ValueSet resources that reference or contain CDT codes
- CodeSystem resources for CDT codes (if hosted locally)
- Reference to official CDT code system for validation

**Expected Outputs**:
- Complete list of CDT codes from server's value sets
- Validation results comparing server codes against official CDT code system
- Conformance report indicating missing or incorrect CDT codes

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations will be used:

1. **ValueSet Search Operations**:
   ```
   GET [base]/ValueSet?url=<valuesets-containing-cdt>
   GET [base]/ValueSet?identifier=<cdt-valueset-identifiers>
   ```

2. **ValueSet Expansion Operations**:
   ```
   GET [base]/ValueSet/[id]/$expand
   POST [base]/ValueSet/$expand
   ```

3. **CodeSystem Retrieval** (if applicable):
   ```
   GET [base]/CodeSystem?system=<cdt-system-uri>
   ```

4. **Terminology Validation**:
   ```
   GET [base]/ValueSet/[id]/$validate-code
   POST [base]/ValueSet/$validate-code
   ```

### Validation Criteria

#### Primary Assertions (SHALL requirements):
1. **Value Set Identification**: 
   - Server SHALL return all ValueSet resources that claim to contain CDT codes
   - ValueSet resources SHALL be properly formatted and valid FHIR resources

2. **CDT Code Completeness**:
   - Expanded ValueSets SHALL contain all current CDT codes from the official code system
   - No official CDT codes SHALL be missing from the claimed complete value sets

3. **Code Accuracy**:
   - All CDT codes present SHALL have correct code values matching official CDT specifications
   - Code descriptions/displays SHALL accurately reflect official CDT terminology

4. **System URI Consistency**:
   - CDT codes SHALL reference the correct system URI for the CDT code system
   - Version information SHALL be present and accurate where specified

#### Secondary Validation Points:
1. **Response Format Compliance**:
   - All responses SHALL be valid JSON (required) or XML (optional)
   - HTTP status codes SHALL be appropriate (200 for success, 4xx for client errors)

2. **Expansion Behavior**:
   - ValueSet expansion SHALL complete without errors
   - Expansion results SHALL be consistent across multiple requests

3. **Error Handling**:
   - Invalid requests SHALL return appropriate HTTP 400 status
   - Server SHALL handle authorization properly (401/403 status codes)

#### Test Execution Steps:
1. **Discovery Phase**:
   - Query server for ValueSet resources containing CDT codes
   - Identify all relevant ValueSet instances

2. **Expansion Phase**:
   - Expand each identified ValueSet
   - Collect all CDT codes from expanded results

3. **Validation Phase**:
   - Compare collected codes against official CDT code system
   - Verify completeness, accuracy, and proper formatting
   - Document any missing or incorrect codes

4. **Reporting Phase**:
   - Generate conformance report with pass/fail status
   - List any non-conformant findings
   - Provide recommendations for remediation if needed

#### Pass Criteria:
- All official CDT codes are present in the appropriate value sets
- All CDT codes have correct values and descriptions
- Server responses conform to FHIR specifications and US Core requirements
- No HTTP errors occur during normal operation

#### Fail Criteria:
- Any official CDT codes are missing from value sets claiming completeness
- CDT codes have incorrect values or descriptions
- Server returns invalid FHIR resources or inappropriate HTTP status codes
- ValueSet expansion fails or returns inconsistent results

---

<a id='req-310'></a>

### REQ-310: Inclusion of all LOINC codes in the value set

**Text**: 

**Context**: 

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-310

## 1. Requirement ID
**REQ-310**: Inclusion of all LOINC codes in the value set

## 2. Requirement Analysis

### Testability Assessment
**Not Testable** - This requirement is too vague and lacks sufficient context to create meaningful interoperability tests. The requirement does not specify:
- Which specific value set should contain LOINC codes
- What constitutes "all LOINC codes" (the entire LOINC database contains over 90,000 codes)
- Which FHIR operations or interactions this requirement applies to
- How this relates to US Core Server capabilities

### Complexity
**Not Applicable** - Cannot assess complexity due to insufficient requirement specification.

### Prerequisites
**Cannot be determined** - The vague nature of the requirement prevents identification of specific prerequisites.

## 3. Test Implementation Strategy

### Assessment
This requirement cannot be implemented as a meaningful interoperability test due to the following issues:

1. **Lack of Context**: The requirement text is empty, and the summary provides no actionable details about which value set, FHIR resource, or operation this applies to.

2. **Scope Ambiguity**: "All LOINC codes" is not a realistic or testable requirement - LOINC contains tens of thousands of codes across multiple domains.

3. **No Connection to Capability Statement**: The provided US Core Server Capability Statement does not reference specific value sets or LOINC code requirements that could be tested.

4. **Missing Technical Specifications**: Without knowing the target value set URI, associated FHIR resources, or specific use cases, no meaningful validation criteria can be established.

### Recommendations for Requirement Refinement

To make this requirement testable, the following information would be needed:

1. **Specific Value Set Identification**: The exact ValueSet URI and name
2. **Scope Definition**: Which subset of LOINC codes are required (e.g., laboratory codes, vital signs, etc.)
3. **Context Specification**: Which FHIR resources or operations this requirement applies to
4. **Validation Mechanism**: How the system should expose or validate the value set content

### Alternative Testing Approaches

If this requirement is related to US Core implementation, consider testing:

1. **Value Set Validation**: Verify that systems properly validate LOINC codes in relevant US Core profiles
2. **Terminology Server Testing**: Test that the system's terminology server includes required LOINC codes for US Core use cases
3. **Code System Support**: Verify support for the LOINC code system in relevant clinical contexts

**Conclusion**: This requirement needs significant clarification before a meaningful test specification can be developed. The requirement should be revised with specific, actionable details that align with the US Core implementation context.

---

<a id='req-320'></a>

### REQ-320: Inclusion of ICD-10-CM codes in the value set

**Text**: 

**Context**: 

**Actor**: Implementer

**Conformance**: SHALL

# Test Specification for REQ-320

## 1. Requirement ID
REQ-320

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated programmatically by examining ValueSet definitions and their included code systems to verify ICD-10-CM codes are present.

### Complexity
**Simple** - The test involves straightforward validation of ValueSet composition to ensure ICD-10-CM codes are included in the US Core Condition Codes ValueSet.

### Prerequisites
- Access to US Core Implementation Guide ValueSet definitions
- System implementing US Core Server CapabilityStatement
- FHIR R4 server with terminology capabilities
- Access to the ValueSet: US Core Condition Codes (http://hl7.org/fhir/us/core/ValueSet/us-core-condition-code)

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- ValueSet resource for US Core Condition Codes
- Any Condition resources that reference codes from this ValueSet (for validation testing)

**Expected Outputs:**
- ValueSet expansion containing ICD-10-CM codes
- Confirmation that ICD-10-CM code system (http://hl7.org/fhir/sid/icd-10-cm) is included in the ValueSet composition

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are needed:

1. **GET /ValueSet/{id}** - Retrieve the US Core Condition Codes ValueSet definition
2. **GET /ValueSet/{id}/$expand** - Expand the ValueSet to examine included codes (if supported by server)
3. **GET /Condition** - Retrieve Condition resources to validate code usage (optional validation step)

### Validation Criteria

**Primary Assertions:**

1. **ValueSet Structure Validation:**
   - The US Core Condition Codes ValueSet SHALL include the ICD-10-CM code system (http://hl7.org/fhir/sid/icd-10-cm) in its composition
   - Verify the ValueSet.compose.include array contains an entry with system = "http://hl7.org/fhir/sid/icd-10-cm"

2. **Code System Inclusion Verification:**
   - Confirm that ICD-10-CM is explicitly referenced as an included code system
   - Validate that no filters exclude ICD-10-CM codes inappropriately

3. **Expansion Validation (if server supports $expand):**
   - When the ValueSet is expanded, the result SHALL contain codes from the ICD-10-CM code system
   - Verify that expanded codes include the system "http://hl7.org/fhir/sid/icd-10-cm"

**Secondary Assertions (for comprehensive validation):**

4. **Condition Resource Code Validation:**
   - If Condition resources are available, verify that ICD-10-CM codes used in Condition.code are valid according to the ValueSet
   - Confirm that systems can successfully validate ICD-10-CM codes against the US Core Condition Codes ValueSet

**Pass Criteria:**
- The ValueSet definition explicitly includes ICD-10-CM as a code system
- If expansion is supported, the expanded ValueSet contains ICD-10-CM codes
- No validation errors occur when ICD-10-CM codes are used in relevant FHIR resources

**Fail Criteria:**
- ICD-10-CM code system is not included in the ValueSet composition
- ValueSet expansion excludes ICD-10-CM codes
- System rejects valid ICD-10-CM codes when used in Condition resources

## Test Execution Notes

1. **Bring Your Own Data Approach:** This test works with any implementation of the US Core Condition Codes ValueSet, regardless of the specific ICD-10-CM codes included, as long as the code system itself is properly referenced.

2. **Fallback Strategy:** If the server does not support ValueSet expansion ($expand operation), the test can still validate conformance by examining the ValueSet.compose structure directly.

3. **Interoperability Focus:** The test validates that systems properly include ICD-10-CM as a supported code system for conditions, ensuring interoperability when exchanging condition data coded with ICD-10-CM codes.

---

<a id='req-348'></a>

### REQ-348: VSAC Code System Names must be mapped to FHIR Code System URIs.

**Text**: 

**Context**: VSAC to FHIR Code System Mapping Table within US Core IG

**Actor**: Implementation Guide Developer

**Conformance**: MUST

# Test Specification for REQ-348

## 1. Requirement ID
REQ-348: VSAC Code System Names must be mapped to FHIR Code System URIs

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be validated programmatically by checking that all VSAC code system names used in FHIR resources are properly mapped to their corresponding FHIR Code System URIs according to the US Core Implementation Guide mapping table.

### Complexity
**Moderate** - The test requires knowledge of the VSAC to FHIR Code System mapping table from US Core IG and the ability to validate code system URIs across multiple resource types that may contain coded elements.

### Prerequisites
- Access to the VSAC to FHIR Code System Mapping Table from US Core IG v8.0.0
- FHIR server implementing US Core profiles
- Test data containing resources with coded elements that reference VSAC code systems
- Knowledge of which US Core profiles and elements are expected to use VSAC code systems

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
Any US Core profile resources that contain coded elements referencing VSAC code systems, including but not limited to:
- Observation resources (various US Core Observation profiles)
- Condition resources (US Core Condition profiles)
- Procedure resources (US Core Procedure Profile)
- DiagnosticReport resources (US Core DiagnosticReport profiles)
- AllergyIntolerance resources (US Core AllergyIntolerance Profile)
- Immunization resources (US Core Immunization Profile)
- MedicationRequest/MedicationDispense resources (US Core Medication profiles)

**Reference Data:**
- US Core IG v8.0.0 VSAC to FHIR Code System Mapping Table
- List of expected VSAC code system names and their corresponding FHIR URIs

### Expected Outputs
- Validation report indicating conformance with VSAC to FHIR mapping requirements
- List of any non-conformant code system references
- Confirmation that all VSAC code systems are properly mapped to FHIR URIs

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and may be used:

**Read Operations:**
- `GET [base]/[Resource]/[id]` - Read individual resources to validate code system mappings
- `GET [base]/[Resource]?[search parameters]` - Search for resources containing coded elements

**Search Parameters** (as supported in Capability Statement):
- Patient-based searches to retrieve resources for validation
- Category and code-based searches where applicable
- Status-based searches to find active/relevant resources

**Supported Resource Types for Testing:**
All resource types listed in the Capability Statement that contain coded elements, particularly:
- Observation (multiple profiles supported)
- Condition (multiple profiles supported)  
- Procedure
- DiagnosticReport (multiple profiles supported)
- AllergyIntolerance
- Immunization
- MedicationRequest/MedicationDispense

### Validation Criteria

**Primary Assertions:**
1. **Code System URI Validation**: For each coded element in US Core resources that references a VSAC code system:
   - Verify that the `system` attribute contains the correct FHIR Code System URI
   - Verify that the URI matches the mapping specified in the US Core VSAC to FHIR Code System Mapping Table
   - Ensure no VSAC code system names are used directly as URIs

2. **Mapping Table Compliance**: 
   - All VSAC code systems referenced in the implementation must have corresponding entries in the US Core mapping table
   - No deprecated or incorrect VSAC code system references should be present

3. **Resource Profile Compliance**:
   - Validate that resources claiming conformance to US Core profiles properly implement the code system mappings
   - Check that `meta.profile` declarations align with proper code system usage

**Specific Validation Steps:**
1. Extract all coded elements from retrieved US Core resources
2. Identify code systems that originate from VSAC
3. Cross-reference against the US Core VSAC to FHIR Code System Mapping Table
4. Verify that the `system` URI matches the expected FHIR URI for each VSAC code system
5. Report any discrepancies or unmapped VSAC code systems

**Pass Criteria:**
- All VSAC code systems referenced in US Core resources use the correct FHIR Code System URIs as specified in the mapping table
- No direct usage of VSAC code system names as URIs
- All coded elements comply with the US Core profile requirements for code system references

**Fail Criteria:**
- Any VSAC code system reference uses an incorrect or unmapped URI
- Direct usage of VSAC code system names instead of proper FHIR URIs
- Missing or incorrect code system mappings that violate US Core conformance requirements

---

<a id='req-492'></a>

### REQ-492: Servers must support at least one resource type from Table 1.

**Text**: 

**Context**: Subscriptions Backport IG – minimum resource-type support threshold

**Actor**: Server

**Conformance**: SHALL

# Test Specification for REQ-492

## 1. Requirement ID
REQ-492

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified programmatically by interrogating the server's CapabilityStatement to determine which resource types are supported.

### Complexity
**Simple** - The requirement involves a straightforward check of the server's declared capabilities against a reference table (Table 1).

### Prerequisites
- Server must have a publicly accessible CapabilityStatement endpoint
- Access to Table 1 from the Subscriptions Backport IG that defines the minimum resource types
- Server must be operational and responding to HTTP requests

## 3. Test Implementation Strategy

### Required Inputs
- **Server Base URL**: The FHIR server endpoint being tested
- **Table 1 Reference**: List of acceptable resource types from the Subscriptions Backport IG
- **No specific FHIR resources required**: This test examines server capabilities, not actual data

### Expected Outputs
- CapabilityStatement resource from the server
- Boolean result indicating conformance (pass/fail)
- List of supported resource types that match Table 1 criteria

### Required FHIR Operations
1. **GET [base]/metadata**
   - Retrieve the server's CapabilityStatement
   - This operation is universally supported by FHIR servers and is referenced in the provided capability statement information

### Validation Criteria

#### Primary Assertions
1. **CapabilityStatement Retrieval**
   - Server responds with HTTP 200 status code to metadata request
   - Response contains a valid FHIR CapabilityStatement resource
   - CapabilityStatement includes a `rest` array with at least one entry

2. **Resource Type Support Verification**
   - Extract all supported resource types from `CapabilityStatement.rest[].resource[].type` elements
   - Cross-reference extracted resource types against Table 1 from Subscriptions Backport IG
   - **PASS CONDITION**: At least one resource type from the server's supported list matches an entry in Table 1
   - **FAIL CONDITION**: Zero resource types from the server's supported list match entries in Table 1

#### Secondary Validation Checks
1. **CapabilityStatement Structure Validation**
   - Verify the CapabilityStatement resource is valid according to FHIR R4 specification
   - Confirm the presence of required elements: `status`, `date`, `kind`, `fhirVersion`

2. **Resource Support Documentation**
   - For each matching resource type found, verify it has appropriate interaction declarations
   - Ensure the supported resource types have at least basic CRUD operations where applicable

#### Test Result Reporting
- **Pass**: Server supports at least one resource type from Table 1
  - Include list of matching resource types found
  - Include total count of supported resource types
- **Fail**: Server supports zero resource types from Table 1
  - Include list of all server-supported resource types for diagnostic purposes
  - Include reference to Table 1 for comparison

#### Edge Case Handling
- If CapabilityStatement is inaccessible (non-200 response), mark test as **inconclusive**
- If Table 1 reference is unavailable, test cannot proceed - mark as **blocked**
- If CapabilityStatement contains no `rest` entries, treat as supporting zero resource types (fail condition)

---

<a id='req-493'></a>

### REQ-493: Servers must support subscriptions for specified US Core profiles.

**Text**: 

**Context**: Subscriptions Backport IG – profile-dependent subscription support

**Actor**: Server

**Conformance**: SHALL

# Test Specification for REQ-493

## 1. Requirement ID
**REQ-493**: Servers must support subscriptions for specified US Core profiles

## 2. Requirement Analysis

### Testability Assessment
**Complex** - This requirement involves testing subscription functionality across multiple US Core profiles. While the core subscription mechanics can be automatically tested, the requirement references a "Subscriptions Backport IG" which is not fully detailed in the provided context. The test requires coordination between subscription creation, resource changes, and notification delivery.

### Complexity
**Complex** - Testing requires:
- Multi-step workflow testing (create subscription → trigger resource changes → verify notifications)
- Integration with US Core profiles and their specific requirements
- Subscription lifecycle management
- Notification delivery verification

### Prerequisites
- Server implementing US Core Server CapabilityStatement
- Server implementing Subscriptions Backport IG capabilities
- At least US Core Patient profile and one additional US Core profile supported
- Server configured to support subscription notifications (webhook endpoints or other delivery mechanisms)
- Test client capable of receiving and processing subscription notifications

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: 
  - US Core Patient resources (existing or to be created)
  - Resources conforming to at least one additional supported US Core profile
  - Subscription resources configured for supported US Core profiles
- **Configuration Data**:
  - List of US Core profiles supported by the server
  - Subscription notification endpoints/mechanisms supported
  - Server's subscription capabilities and limitations

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are required:

1. **GET [base]/metadata** - Verify server's subscription capabilities
2. **POST [base]/Subscription** - Create subscriptions for US Core profiles
3. **GET [base]/Subscription/[id]** - Retrieve subscription status
4. **POST/PUT [base]/Patient** - Create/update Patient resources to trigger subscriptions
5. **POST/PUT [base]/[ResourceType]** - Create/update resources of supported US Core profiles
6. **DELETE [base]/Subscription/[id]** - Clean up test subscriptions

### Validation Criteria

#### Test Case 1: Verify Subscription Support for US Core Profiles
**Objective**: Confirm server declares subscription support for US Core profiles

**Steps**:
1. Retrieve server's CapabilityStatement via `GET [base]/metadata`
2. Verify subscription interaction is supported
3. Identify which US Core profiles support subscriptions

**Assertions**:
- Server CapabilityStatement includes subscription interaction support
- At least US Core Patient profile supports subscriptions
- Additional supported US Core profiles include subscription capabilities

#### Test Case 2: Create Valid Subscriptions for US Core Profiles
**Objective**: Successfully create subscriptions for supported US Core profiles

**Steps**:
1. Create a subscription for US Core Patient profile changes
2. Create a subscription for at least one additional supported US Core profile
3. Verify subscription creation returns HTTP 201 status
4. Verify subscription status is "active"

**Assertions**:
- `POST [base]/Subscription` returns HTTP 201 for valid US Core profile subscriptions
- Created subscription resources have status "active"
- Subscription criteria correctly reference US Core profile canonical URLs
- Server responds with valid Subscription resource conforming to Subscriptions Backport IG

#### Test Case 3: Trigger Subscription Notifications
**Objective**: Verify subscriptions generate notifications when US Core resources change

**Steps**:
1. Create or update a US Core Patient resource
2. Create or update a resource of additional supported US Core profile
3. Monitor for subscription notifications within reasonable timeframe
4. Verify notification content includes relevant resource changes

**Assertions**:
- Notifications are delivered when subscribed US Core resources are modified
- Notification format conforms to Subscriptions Backport IG requirements
- Notifications include appropriate resource identification and change details
- Timing of notifications is within acceptable parameters

#### Test Case 4: Subscription Lifecycle Management
**Objective**: Verify proper subscription lifecycle management

**Steps**:
1. Create a subscription with finite lease time (if supported)
2. Verify subscription remains active during lease period
3. Update subscription status to "off"
4. Verify no notifications are sent while subscription is inactive
5. Delete subscription
6. Verify subscription is properly removed

**Assertions**:
- Subscription lease time is respected
- Inactive subscriptions do not generate notifications
- Subscription deletion is successful (HTTP 200/204)
- Deleted subscriptions cannot be retrieved (HTTP 404)

#### Test Case 5: Error Handling for Invalid Subscriptions
**Objective**: Verify appropriate error responses for invalid subscription requests

**Steps**:
1. Attempt to create subscription for unsupported profile
2. Attempt to create subscription with invalid criteria syntax
3. Attempt to create subscription with unsupported channel type

**Assertions**:
- Server returns appropriate HTTP 4xx status for invalid subscription requests
- Error responses include meaningful OperationOutcome details
- Server handles malformed subscription requests gracefully

#### Test Case 6: Multi-Profile Subscription Verification
**Objective**: Confirm subscriptions work correctly across multiple supported US Core profiles

**Steps**:
1. Create subscriptions for all declared supported US Core profiles
2. Trigger changes to resources of different profile types
3. Verify each subscription generates appropriate notifications

**Assertions**:
- Multiple concurrent subscriptions function independently
- Profile-specific changes trigger only relevant subscriptions
- No cross-contamination between different profile subscriptions

### Expected Outputs
- Confirmation that server supports subscriptions for required US Core profiles
- Successful creation and management of subscription resources
- Proper notification delivery when subscribed resources change
- Appropriate error handling for invalid subscription scenarios
- Documentation of which specific US Core profiles support subscriptions on the tested server

---

<a id='req-494'></a>

### REQ-494: Servers must support the `rest-hook` channel type for notifications.

**Text**: 

**Context**: Subscriptions Backport IG – notification delivery channel support

**Actor**: Server

**Conformance**: SHALL

# Test Specification for REQ-494

## 1. Requirement ID
**REQ-494**: Servers must support the `rest-hook` channel type for notifications.

## 2. Requirement Analysis

### Testability Assessment
**Not testable** - This requirement cannot be tested based on the provided Implementation Guide requirements and Capability Statement information because:

1. **Missing Context**: The requirement references "Subscriptions Backport IG – notification delivery channel support" but none of the provided Capability Statement information includes any Subscription resource support or notification delivery mechanisms.

2. **No Subscription Capabilities**: The extensive US Core Capability Statement documentation provided covers 32 different FHIR resources (Patient, Observation, DiagnosticReport, etc.) but does not include any mention of:
   - Subscription resources
   - Notification channels
   - Rest-hook endpoints
   - Subscription management operations

3. **Scope Mismatch**: The requirement appears to be from a Subscriptions Backport Implementation Guide, while all the provided capability information is from US Core, which focuses on clinical data exchange rather than subscription-based notifications.

### Complexity
**N/A** - Cannot assess complexity due to lack of relevant capability information.

### Prerequisites
**Cannot be determined** - Without Subscription-related capabilities in the provided Capability Statement, the prerequisites for testing rest-hook notification support cannot be established.

## 3. Test Implementation Strategy

### Required Inputs
**Cannot be specified** - Testing rest-hook channel support would require:
- Subscription resource support (not present in provided capabilities)
- Notification endpoint configuration capabilities
- Rest-hook channel type definitions
- None of which are available in the provided US Core Capability Statement

### Required FHIR Operations
**None available** - The provided Capability Statement does not include any Subscription-related operations that would be needed to test rest-hook channel support, such as:
- Subscription creation (`POST /Subscription`)
- Subscription management operations
- Notification delivery mechanisms

### Validation Criteria
**Cannot be established** - Without the relevant Subscription capabilities, no meaningful validation criteria can be defined for rest-hook channel type support.

---

**Note**: To properly test this requirement, the Capability Statement would need to include information about Subscription resource support, notification channel types, and related operations from the Subscriptions Backport Implementation Guide. The current US Core-focused capabilities do not provide the necessary context for testing subscription-based notification delivery channels.

---

<a id='req-498'></a>

### REQ-498: The USCDI Requirement Extension must have a URL with a specific value.

**Text**: 

**Context**: US Core USCDI Requirement Extension – fixed URL constraint

**Actor**: US Core Profile Implementers

**Conformance**: SHALL

# Test Specification for REQ-498

## 1. Requirement ID
**REQ-498**: US Core USCDI Requirement Extension URL Constraint

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated programmatically by checking the URL value of the USCDI Requirement Extension in FHIR resources.

### Complexity
**Simple** - The test involves a straightforward validation of a fixed URL constraint on an extension.

### Prerequisites
- System must support US Core profiles that utilize the USCDI Requirement Extension
- System must return FHIR resources in JSON format (required per Capability Statement)
- Test client must have appropriate authorization to access FHIR resources
- System must support at least the US Core Patient resource profile plus one additional US Core profile (per Capability Statement requirements)

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Any US Core profile resources that contain the USCDI Requirement Extension
- **Expected Extension URL**: The specific fixed URL value for the USCDI Requirement Extension (to be verified against the US Core Implementation Guide specification)
- **System Endpoint**: Base FHIR server URL with appropriate authentication credentials

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and can be used for testing:

1. **Resource Read Operations**: 
   - `GET [base]/[ResourceType]/[id]` - Read specific resource instances
   - Supported for all US Core profile resource types

2. **Search Operations**:
   - `GET [base]/[ResourceType]?[parameters]` - Search for resources containing the extension
   - Must return JSON format responses (SHALL requirement)

3. **Response Handling**:
   - Verify proper HTTP status codes (200 for successful operations)
   - Handle expected error responses (400, 401, 403, 404) as specified in Capability Statement

### Validation Criteria

#### Primary Validation Checks:
1. **Extension Presence Validation**:
   - Identify all instances of the USCDI Requirement Extension within retrieved resources
   - Verify extension exists in expected locations within US Core profiles

2. **URL Value Validation**:
   - Assert that each USCDI Requirement Extension has the correct fixed URL value
   - Verify the URL exactly matches the specification (case-sensitive string comparison)
   - Ensure no variations or alternative URL formats are present

3. **Extension Structure Validation**:
   - Confirm the extension follows proper FHIR extension structure
   - Validate that the extension appears in the correct context within the resource

#### Test Success Criteria:
- **PASS**: All instances of the USCDI Requirement Extension contain the exact required URL value
- **FAIL**: Any instance of the USCDI Requirement Extension contains an incorrect, missing, or malformed URL value

#### Additional Validation Points:
1. **JSON Format Compliance**: Ensure responses are in valid JSON format (per Capability Statement SHALL requirement)
2. **Security Compliance**: Verify appropriate handling of authentication and authorization (per Capability Statement security requirements)
3. **Error Handling**: Confirm proper HTTP status codes are returned for various scenarios

#### Test Coverage Approach:
- Test against multiple resource types that may contain the USCDI Requirement Extension
- Validate across different resource instances to ensure consistent URL implementation
- Verify extension URL constraint holds across all contexts where the extension appears

This test specification ensures comprehensive validation of the USCDI Requirement Extension URL constraint while accommodating a "bring your own data" testing approach and leveraging the FHIR operations supported by the US Core Server Capability Statement.

---

<a id='req-499'></a>

### REQ-499: The USCDI Requirement Extension must have a value of type boolean.

**Text**: 

**Context**: US Core USCDI Requirement Extension – value type constraint

**Actor**: US Core Profile Implementers

**Conformance**: SHALL

# Test Specification for REQ-499

## 1. Requirement ID
**REQ-499**: The USCDI Requirement Extension must have a value of type boolean.

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be automatically validated by examining the data type of the extension value in FHIR resources that contain the US Core USCDI Requirement Extension.

### Complexity
**Simple** - The test involves straightforward data type validation of an extension value.

### Prerequisites
- Access to FHIR server implementing US Core profiles
- FHIR resources containing the US Core USCDI Requirement Extension
- Authentication credentials if required by the server
- Test client capable of making FHIR REST API calls and parsing JSON responses

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources**: Any US Core profile resources that contain the US Core USCDI Requirement Extension (http://hl7.org/fhir/us/core/StructureDefinition/us-core-uscdi-requirement)

**Expected Outputs**: 
- FHIR resources with valid boolean values (true/false) in the USCDI Requirement Extension
- Validation confirmation that all extension values are of type boolean

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and can be used:

1. **READ operations** - Retrieve specific resources by ID
2. **SEARCH operations** - Query for resources that may contain the extension
3. **JSON format support** (SHALL) - All responses will be in JSON format

*Note: The specific search parameters and resource types will depend on which US Core profiles are implemented by the server under test, as the server SHALL support at least US Core Patient profile and one additional US Core profile.*

### Validation Criteria

**Primary Assertions**:
1. **Extension Presence Validation**: When the US Core USCDI Requirement Extension is present in a resource, it MUST contain a value element
2. **Data Type Validation**: The extension value MUST be of type boolean (true or false)
3. **Extension URL Validation**: Confirm the extension uses the correct canonical URL: `http://hl7.org/fhir/us/core/StructureDefinition/us-core-uscdi-requirement`

**Test Pass Criteria**:
- All instances of the US Core USCDI Requirement Extension contain a value of type boolean
- No instances contain values of other data types (string, integer, decimal, etc.)
- Extension structure conforms to FHIR extension format requirements

**Test Implementation Approach**:
1. Query the server for resources that may contain the extension (using supported search operations)
2. For each returned resource, parse the JSON response
3. Locate any instances of the US Core USCDI Requirement Extension
4. Validate that each extension instance has a `valueBoolean` element with a boolean value (true/false)
5. Report any violations where the extension value is not of type boolean

**Error Conditions to Report**:
- Extension present with non-boolean value types
- Extension present with missing value element
- Extension present with malformed boolean values (e.g., "True", "FALSE", 1, 0)

---

<a id='req-501'></a>

### REQ-501: Extension must have either extensions or value[x], not both.

**Text**: 

**Context**: FHIR core invariant ext-1 – applies to all Extension elements

**Actor**: Implementer

**Conformance**: SHALL

# Test Specification for REQ-501

## 1. Requirement ID
REQ-501

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be automatically verified by examining Extension elements in FHIR resources to ensure they conform to the FHIR core invariant ext-1.

### Complexity
**Simple** - This is a straightforward structural validation that checks the presence/absence of specific elements within Extension elements.

### Prerequisites
- Access to FHIR resources that contain Extension elements
- Ability to parse and examine FHIR resource structure
- Understanding of FHIR Extension element structure (extensions array and value[x] elements)

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Any FHIR resources from the US Core profiles that contain Extension elements, including:
  - Patient resources with extensions (e.g., race, ethnicity, birthsex)
  - Observation resources with extensions
  - Any other US Core profile resources containing custom or standard extensions
- **Test Data**: Implementer's own FHIR data containing various Extension usage patterns

### Required FHIR Operations
Based on the Capability Statement, the following operations can be used to retrieve resources for testing:
- **GET operations** for individual resources using supported search parameters
- **Search operations** using resource-specific search parameters as defined in the capability statement
- Focus on resources that commonly contain extensions such as:
  - Patient search: `GET [base]/Patient?[search-params]`
  - Observation search: `GET [base]/Observation?[search-params]`
  - Other resource searches as supported by the implementation

### Validation Criteria

For each Extension element found in any FHIR resource, verify the following assertions:

#### Primary Validation Rules
1. **Extension Structure Check**: For every Extension element in the resource:
   - **Assertion A**: If the Extension has a `value[x]` element present, then it SHALL NOT have any child `extension` elements
   - **Assertion B**: If the Extension has child `extension` elements present, then it SHALL NOT have a `value[x]` element
   - **Assertion C**: Every Extension element MUST have either a `value[x]` element OR one or more child `extension` elements (but not both, and not neither)

#### Test Cases to Execute

**Test Case 1: Extensions with value[x] only**
- **Expected Result**: PASS - Extension contains only value[x], no child extensions
- **Validation**: Confirm `value[x]` is present and `extension` array is empty or absent

**Test Case 2: Extensions with child extensions only**
- **Expected Result**: PASS - Extension contains only child extensions, no value[x]
- **Validation**: Confirm `extension` array has one or more elements and no `value[x]` is present

**Test Case 3: Extensions with both value[x] and child extensions**
- **Expected Result**: FAIL - Violates ext-1 invariant
- **Validation**: Flag as non-conformant if both are present

**Test Case 4: Extensions with neither value[x] nor child extensions**
- **Expected Result**: FAIL - Violates ext-1 invariant
- **Validation**: Flag as non-conformant if neither are present

#### Implementation Notes
- Test should recursively examine all Extension elements at any level of nesting
- Apply validation to both standard FHIR extensions and custom extensions
- Test should work with any valid FHIR resource data provided by the implementer
- Consider extensions in all possible locations: resource-level extensions, element-level extensions, and nested extensions within other extensions

#### Success Criteria
- **Test Passes**: All Extension elements in the tested resources conform to the ext-1 invariant
- **Test Fails**: Any Extension element violates the ext-1 invariant by having both value[x] and child extensions, or by having neither

This test specification ensures comprehensive validation of the FHIR core Extension invariant across all US Core profile resources while accommodating a "bring your own data" testing approach.

---

<a id='req-502'></a>

### REQ-502: All FHIR elements must have a @value or children.

**Text**: 

**Context**: FHIR core invariant ele-1 – applies to all elements

**Actor**: Implementer

**Conformance**: SHALL

# Test Specification for REQ-502

## 1. Requirement ID
**REQ-502**: All FHIR elements must have a @value or children (FHIR core invariant ele-1)

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Not testable due to being covered by the validator

**Rationale**: This requirement enforces the fundamental FHIR invariant ele-1 that applies to all elements across all FHIR resources. This invariant is automatically validated by FHIR validators and parsers, making it redundant to create separate interoperability tests. The FHIR specification requires that every element must either have a value attribute or contain child elements, but never be completely empty. This is a structural validation that occurs during resource parsing and validation, not during interoperability exchanges.

### Complexity
**Simple** - This is a basic structural requirement that applies universally to all FHIR elements.

### Prerequisites
- FHIR validator or parser capability
- Access to FHIR resources in JSON or XML format
- Understanding of FHIR element structure

## 3. Test Implementation Strategy

### Required Inputs
Since this requirement is automatically enforced by FHIR validators, specific test implementation is not recommended for interoperability testing. Instead, this requirement is satisfied through:

1. **Structural Validation**: Any valid FHIR resource that passes FHIR validation automatically satisfies this requirement
2. **Parser Validation**: FHIR parsers will reject resources that violate the ele-1 invariant

### Required FHIR Operations
None - This is handled at the validation layer, not the operation layer.

### Validation Criteria
**Recommendation**: Rather than creating specific tests for this requirement, implementers should:

1. **Rely on FHIR Validation**: Ensure all FHIR resources are validated against the appropriate profiles using a FHIR validator
2. **Parser Behavior**: Verify that the FHIR implementation correctly rejects malformed resources that violate ele-1
3. **Integration Testing**: Include validation checks in existing interoperability tests for all supported US Core profiles

**Note**: Any resource that successfully exchanges through FHIR APIs and passes profile validation inherently satisfies this requirement. Creating separate tests would be redundant and provide no additional interoperability value.

### Alternative Testing Approach
If explicit testing is required for compliance documentation purposes:

**Test Case**: Structural Validation Test
- **Input**: Any FHIR resource from the supported US Core profiles listed in the Capability Statement
- **Process**: Submit resource to FHIR validator
- **Expected Result**: Resources with empty elements (no @value and no children) should be rejected by the validator
- **Pass Criteria**: Validator correctly identifies and rejects structurally invalid resources while accepting valid ones

This requirement is best addressed through proper implementation of FHIR validation rather than specific interoperability test cases.

---

<a id='req-503'></a>

### REQ-503: Extension URL must be a URI for the Structure Definition.

**Text**: 

**Context**: FHIR core – Extension.url fixedUri constraint

**Actor**: Implementer

**Conformance**: SHALL

# Test Specification for REQ-503

## 1. Requirement ID
**REQ-503**: Extension URL must be a URI for the Structure Definition

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be validated programmatically by examining the Extension.url field in FHIR resources to verify it contains a valid URI format.

### Complexity
**Simple** - The test involves straightforward URI format validation on a specific field.

### Prerequisites
- FHIR server implementing US Core profiles
- Access to FHIR resources that contain extensions
- Test client capable of retrieving FHIR resources and validating URI format

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources**: Any US Core profile resources that contain extensions, including but not limited to:
- Patient resources with extensions
- Observation resources with extensions  
- Condition resources with extensions
- Any other US Core profile resources containing Extension elements

**Expected Outputs**: 
- List of all Extension.url values found in the tested resources
- Validation results indicating whether each Extension.url is a valid URI
- Pass/Fail determination for the requirement

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and can be used:

1. **Resource Read Operations**:
   - `GET /Patient/{id}` - Read specific patient resources
   - `GET /Observation/{id}` - Read specific observation resources
   - `GET /Condition/{id}` - Read specific condition resources
   - Similar read operations for other resource types

2. **Search Operations** (to discover resources with extensions):
   - `GET /Patient` - Search for patient resources
   - `GET /Observation` - Search for observation resources
   - `GET /Condition` - Search for condition resources
   - Additional search parameters as supported per the capability statement

### Validation Criteria

The test SHALL verify the following assertions for each Extension found in the tested resources:

1. **URI Format Validation**:
   - The Extension.url field MUST be present (not null or empty)
   - The Extension.url field MUST conform to valid URI syntax as defined by RFC 3986
   - The URI MUST be absolute (contain a scheme component)

2. **Structure Definition Reference**:
   - The Extension.url SHOULD resolve to a valid StructureDefinition resource (when accessible)
   - The URI format MUST be consistent with FHIR canonical URL patterns

3. **Test Pass Criteria**:
   - **PASS**: All Extension.url values found in the tested resources are valid URIs
   - **FAIL**: Any Extension.url value is not a valid URI format
   - **SKIP**: No resources with extensions are available for testing

4. **Validation Steps**:
   1. Retrieve FHIR resources using supported operations from the capability statement
   2. Extract all Extension elements from the retrieved resources
   3. For each Extension.url value:
      - Verify it matches URI syntax rules (scheme:[//authority]path[?query][#fragment])
      - Confirm it contains a valid scheme (http, https, urn, etc.)
      - Validate it does not contain invalid characters for URIs
   4. Report validation results with specific details for any failures

5. **Error Reporting**:
   - For each invalid Extension.url, report:
     - Resource type and ID where the invalid extension was found
     - The invalid URL value
     - Specific reason why the URL is not a valid URI
     - Path to the extension within the resource

This test specification ensures conformance with the FHIR core constraint on Extension.url while accommodating a "bring your own data" testing approach using the operations supported by the US Core capability statement.

---

<a id='req-504'></a>

### REQ-504: The extension value must be one of a constrained set of data types.

**Text**: 

**Context**: FHIR core – Extension.value[x] datatype constraint

**Actor**: Implementer

**Conformance**: SHALL

# Test Specification for REQ-504

## 1. Requirement ID
REQ-504

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be validated programmatically by examining Extension.value[x] elements in FHIR resources and verifying that the data types used conform to the allowed set of data types defined in the FHIR specification or implementation guide constraints.

### Complexity
**Simple** - The test involves straightforward validation of data types against a defined constraint set. No complex business logic or multi-step interactions are required.

### Prerequisites
- Access to a FHIR server implementing US Core profiles
- FHIR resources containing extensions with value[x] elements
- Knowledge of the specific data type constraints for extensions in the implementation context
- FHIR validation capabilities or tooling

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Any US Core profile resources that contain extensions (Patient, Observation, Condition, etc.)
- **Extension Definitions**: The specific StructureDefinitions or implementation guide documentation that define the allowed data types for Extension.value[x] in the context being tested
- **Test Data**: Existing resources from the system under test that contain extensions

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and can be used:
- **GET** operations for retrieving individual resources by ID
- **Search** operations for finding resources with extensions
- **Capability Statement** retrieval to understand supported profiles

Specific API calls:
```
GET [base]/Patient/[id]
GET [base]/Observation?patient=[patient-id]
GET [base]/Condition?patient=[patient-id] 
GET [base]/metadata (to retrieve CapabilityStatement)
```

### Validation Criteria

#### Test Cases

**Test Case 1: Extension Data Type Validation**
- **Objective**: Verify that all Extension.value[x] elements use only the constrained set of allowed data types
- **Method**: 
  1. Retrieve resources containing extensions using supported search operations
  2. Extract all Extension elements from the retrieved resources
  3. For each Extension.value[x] element, validate that the data type is within the allowed constraint set
  4. Document any violations found

**Test Case 2: Profile-Specific Extension Constraints**
- **Objective**: Verify extension value data type constraints specific to US Core profiles
- **Method**:
  1. Identify US Core profiles that define specific extension constraints
  2. Retrieve resources conforming to these profiles
  3. Validate that extensions in these resources use only the data types allowed by the profile constraints
  4. Cross-reference against the profile's StructureDefinition

**Test Case 3: System-Wide Extension Compliance**
- **Objective**: Ensure consistent application of extension value data type constraints across all supported resource types
- **Method**:
  1. Query multiple resource types that support extensions (Patient, Observation, Condition, etc.)
  2. Aggregate all Extension.value[x] elements across resource types
  3. Validate data type compliance across the entire dataset
  4. Identify any systematic non-compliance patterns

#### Assertions for Passing Tests

1. **Data Type Compliance**: All Extension.value[x] elements MUST use data types from the defined constraint set
2. **Profile Conformance**: Extensions in profile-specific resources MUST conform to the profile's data type constraints
3. **Consistency**: Extension data type usage MUST be consistent across all resource instances
4. **Validation Success**: All extension elements MUST pass FHIR validation against their defined constraints

#### Expected Results for Conformant Implementation
- Zero instances of Extension.value[x] using prohibited data types
- All extensions validate successfully against their defined constraints
- Consistent data type usage patterns across the implementation
- Clear documentation of which data types are supported for each extension context

#### Failure Indicators
- Extension.value[x] elements using data types not in the allowed constraint set
- Validation errors when checking extensions against their StructureDefinitions
- Inconsistent data type usage across similar extension contexts
- Resources that fail profile validation due to extension data type violations

---



<a id='goal'></a>

## Goal

<a id='req-011'></a>

### REQ-011: The Goal resource SHALL have a lifecycleStatus of "Active".

**Text**: 

**Context**: 

**Actor**: Goal Resource

**Conformance**: SHALL

# Test Specification for REQ-011

## Requirement ID
REQ-011

## Requirement Analysis

### Testability Assessment
**Classification:** Automatically testable

This requirement is automatically testable as it involves checking a specific field value (`lifecycleStatus`) within the Goal resource structure. The validation can be performed programmatically by examining the FHIR resource content.

### Complexity
**Simple**

The requirement involves a straightforward field validation against a fixed value constraint.

### Prerequisites
- System under test must support the US Core Goal Profile
- System must have Goal resources available for testing
- Test client must have appropriate access permissions to retrieve Goal resources

## Test Implementation Strategy

### Required Inputs
- **FHIR Resources:** Goal resources conforming to the US Core Goal Profile
- **System Access:** Valid authentication credentials and appropriate scopes for Goal resource access
- **Test Data:** Any existing Goal resources in the system under test (bring your own data approach)

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for Goal resources:
- `GET [base]/Goal` (search operations)
- `GET [base]/Goal/[id]` (read operations)

**Search Parameters Available:**
- `description`
- `lifecycle-status` 
- `patient`
- `target-date`
- Combined searches: `patient+lifecycle-status`, `patient+description`, `patient+target-date`

### Validation Criteria

#### Test Case 1: Direct Goal Resource Validation
**Objective:** Verify that individual Goal resources have lifecycleStatus of "active"

**Test Steps:**
1. Retrieve Goal resource(s) using `GET [base]/Goal/[id]` for specific Goal instances
2. Parse the returned Goal resource(s)
3. Examine the `lifecycleStatus` field in each Goal resource

**Assertions:**
- Each Goal resource SHALL contain a `lifecycleStatus` element
- The value of `lifecycleStatus` SHALL be "active" (case-sensitive)
- Response status code SHALL be 200 for successful retrieval

#### Test Case 2: Search-Based Validation
**Objective:** Verify Goal resources retrieved through search operations have lifecycleStatus of "active"

**Test Steps:**
1. Execute search queries to retrieve Goal resources:
   - `GET [base]/Goal` (retrieve all accessible Goal resources)
   - `GET [base]/Goal?patient=[patient-id]` (if patient context is available)
   - `GET [base]/Goal?lifecycle-status=active` (verify search functionality)
2. Parse the returned Bundle containing Goal resources
3. Examine each Goal resource in the search results

**Assertions:**
- All returned Goal resources SHALL have `lifecycleStatus` value of "active"
- Search using `lifecycle-status=active` parameter SHALL return only resources with lifecycleStatus "active"
- Bundle response SHALL be valid and parseable
- Response status code SHALL be 200 for successful search

#### Test Case 3: Profile Conformance Validation
**Objective:** Ensure Goal resources claiming US Core Goal Profile conformance meet the lifecycleStatus requirement

**Test Steps:**
1. Retrieve Goal resources that declare conformance to US Core Goal Profile
2. Identify resources with `meta.profile` containing US Core Goal Profile URL
3. Validate lifecycleStatus for profile-conformant resources

**Assertions:**
- Goal resources with US Core Goal Profile in `meta.profile` SHALL have lifecycleStatus "active"
- Profile declaration SHALL be consistent with the actual resource content

#### Error Conditions to Test
**Test Steps:**
1. Attempt to retrieve Goal resources (if any exist) that might have different lifecycleStatus values
2. Verify system behavior with invalid requests

**Assertions:**
- System SHALL return appropriate HTTP error codes for unauthorized access (401, 403, 404)
- System SHALL handle malformed requests appropriately (400)

#### Pass/Fail Criteria
**PASS:** All Goal resources retrieved from the system have lifecycleStatus set to "active"

**FAIL:** Any Goal resource is found with lifecycleStatus other than "active", or lifecycleStatus field is missing

**INCONCLUSIVE:** No Goal resources are available in the system for testing, or system access is not properly configured

---

<a id='req-463'></a>

### REQ-463: US Core Goal Profile implementation

**Text**: 

**Context**: System conformance to US Core Goal Profile.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-463

## 1. Requirement ID
**REQ-463**: US Core Goal Profile implementation

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated testing by validating Goal resources against the US Core Goal Profile and testing FHIR operations.

### Complexity
**Moderate** - Requires validation of profile conformance, testing FHIR operations, and verifying data elements meet US Core specifications.

### Prerequisites
- System must implement FHIR R4
- System must have Goal resources available for testing
- System must support RESTful FHIR operations as defined in the US Core Server CapabilityStatement
- Test client must have appropriate authentication/authorization to access Goal resources
- System should have Goal resources that reference valid Patient resources

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Goal resources that exist in the system under test
- Associated Patient resources referenced by Goal.subject
- Any referenced Practitioner or Organization resources in Goal.expressedBy

**Expected Outputs:**
- Valid FHIR Goal resources conforming to US Core Goal Profile
- Appropriate HTTP response codes (200, 404, etc.)
- FHIR-compliant error responses when applicable

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations should be supported:

1. **GET [base]/Goal/[id]** - Read Goal by ID
2. **GET [base]/Goal?patient=[reference]** - Search Goals by patient
3. **GET [base]/Goal?patient=[reference]&lifecycle-status=[status]** - Search Goals by patient and lifecycle status
4. **GET [base]/Goal?patient=[reference]&target-date=[date]** - Search Goals by patient and target date

### Validation Criteria

#### Profile Conformance Validation
**Test Case 1: Goal Profile Validation**
- Retrieve Goal resources using read and search operations
- Validate each Goal resource against the US Core Goal Profile
- **Pass Criteria:**
  - All Goal resources validate successfully against US Core Goal Profile
  - No validation errors related to profile conformance
  - Required elements are present per profile requirements

#### Required Data Elements Validation
**Test Case 2: Mandatory Elements**
- Verify presence of required elements in Goal resources:
  - `lifecycleStatus` - SHALL be present
  - `description` - SHALL be present  
  - `subject` - SHALL be present and reference a Patient
- **Pass Criteria:**
  - All mandatory elements are present in retrieved Goal resources
  - `subject` references resolve to valid Patient resources
  - Data types conform to profile specifications

#### Search Parameter Support
**Test Case 3: Patient Search**
- Execute search: `GET [base]/Goal?patient=[patient-reference]`
- **Pass Criteria:**
  - Search returns appropriate Goal resources for the specified patient
  - HTTP 200 response code
  - Bundle resource with entry elements containing Goal resources
  - All returned Goals have subject references matching the search patient

**Test Case 4: Lifecycle Status Search**
- Execute search: `GET [base]/Goal?patient=[patient-reference]&lifecycle-status=[status]`
- Use valid lifecycle-status values (active, completed, cancelled, etc.)
- **Pass Criteria:**
  - Search returns Goals matching both patient and lifecycle-status criteria
  - All returned Goals have the specified lifecycle-status
  - Empty Bundle returned when no matches exist (not an error)

**Test Case 5: Target Date Search**
- Execute search: `GET [base]/Goal?patient=[patient-reference]&target-date=[date]`
- **Pass Criteria:**
  - Search returns appropriate results based on target date criteria
  - Date search operators work correctly (eq, ge, le, etc.)
  - Goals without target dates are handled appropriately

#### Resource Read Operations
**Test Case 6: Goal Read by ID**
- Execute: `GET [base]/Goal/[id]` for known Goal IDs
- **Pass Criteria:**
  - Returns valid Goal resource with HTTP 200
  - Returned resource conforms to US Core Goal Profile
  - HTTP 404 for non-existent Goal IDs

#### Error Handling
**Test Case 7: Invalid Requests**
- Test invalid search parameters and malformed requests
- **Pass Criteria:**
  - Appropriate HTTP error codes (400, 404, etc.)
  - FHIR OperationOutcome resources for errors
  - Error messages are informative and FHIR-compliant

#### Data Quality Checks
**Test Case 8: Reference Integrity**
- Verify Goal.subject references can be resolved
- Check Goal.expressedBy references if present
- **Pass Criteria:**
  - Patient references resolve to valid Patient resources
  - Referenced resources are accessible through the same FHIR server
  - No broken references in Goal resources

**Test Case 9: Code System Validation**
- Validate terminology usage in Goal.description and other coded elements
- **Pass Criteria:**
  - Coded values use appropriate code systems
  - SNOMED CT codes are used where specified by the profile
  - Code system URIs are correct and accessible

### Overall Test Passing Criteria
The system SHALL pass REQ-463 if:
- All Goal resources validate against the US Core Goal Profile without errors
- Required search parameters are supported and return correct results
- Mandatory data elements are present in all Goal resources
- FHIR operations conform to RESTful API standards
- Error handling follows FHIR specifications
- Referenced resources maintain integrity and are resolvable

---

<a id='req-515'></a>

### REQ-515: US Core Client SHALL fetch Goal resources.

**Text**: 

**Context**: US Core Client read interaction for Goal by id

**Actor**: US Core Client

**Conformance**: SHALL

# Test Specification for REQ-515

## 1. Requirement ID
**REQ-515**: US Core Client SHALL fetch Goal resources

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated testing by attempting to read Goal resources by ID and validating the client's ability to successfully fetch and process the responses.

### Complexity
**Simple** - This is a straightforward read interaction that requires basic FHIR RESTful API operations without complex search parameters or conditional logic.

### Prerequisites
- US Core Server implementation that supports Goal resources
- Available Goal resource instances on the server with known IDs
- Client system capable of making FHIR RESTful API calls
- Authentication/authorization credentials if required by the server
- Network connectivity between client and server

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- One or more Goal resource instances available on the test server
- Known Goal resource IDs for testing (obtained through discovery or pre-existing knowledge)

**Expected Outputs:**
- HTTP 200 OK response with valid Goal resource in JSON format
- Goal resource conforming to US Core Goal profile specifications
- Appropriate error responses (4xx/5xx) for invalid requests

### Required FHIR Operations
Based on the Capability Statement analysis, the following operations are required:

1. **GET [base]/Goal/[id]** - Read interaction for Goal resources by ID
   - This operation is supported as part of the US Core Server capabilities
   - Must support JSON format (required by US Core Server capability)
   - Should handle XML format if server supports it

### Validation Criteria

#### Successful Read Operations
The test SHALL verify that the client can:

1. **Execute HTTP GET Request**: Successfully send a properly formatted GET request to `[base]/Goal/[id]`

2. **Handle Successful Responses**: When server returns HTTP 200:
   - Parse and process the returned Goal resource
   - Validate that the response contains a valid FHIR Goal resource
   - Verify the resource conforms to US Core Goal profile requirements
   - Confirm the resource ID matches the requested ID

3. **Process Required Response Formats**: 
   - Successfully handle JSON-formatted responses (SHALL requirement)
   - Optionally handle XML-formatted responses if server supports them

#### Error Handling
The test SHALL verify that the client appropriately handles error responses as specified in the Capability Statement:

1. **HTTP 400 (Bad Request)**: Client handles invalid parameter errors appropriately
2. **HTTP 401/4xx (Unauthorized)**: Client handles unauthorized request errors appropriately  
3. **HTTP 403 (Forbidden)**: Client handles insufficient scope errors appropriately
4. **HTTP 404 (Not Found)**: Client handles unknown resource errors appropriately

#### Security Compliance
The test SHALL verify that the client:
- Properly handles authentication and authorization as required
- Responds appropriately to security-related error responses
- Maintains secure communication practices

#### Profile Conformance
The test SHALL verify that the client:
- Correctly processes Goal resources that conform to the US Core Goal profile
- Handles `meta.profile` attribute information when present
- Properly interprets Must Support elements as defined in the US Core specification

### Test Case Structure

**Test Case 1: Valid Goal Resource Retrieval**
- Input: Valid Goal resource ID
- Action: Execute GET request to retrieve Goal
- Expected Result: HTTP 200 with valid Goal resource, client processes successfully

**Test Case 2: Invalid Goal Resource ID**
- Input: Non-existent Goal resource ID
- Action: Execute GET request with invalid ID
- Expected Result: HTTP 404 response, client handles error appropriately

**Test Case 3: Authentication/Authorization Testing** (if applicable)
- Input: Request without proper credentials or insufficient scopes
- Action: Execute GET request
- Expected Result: HTTP 401/403 response, client handles security error appropriately

**Test Case 4: Format Support Testing**
- Input: Valid Goal resource ID with Accept header for JSON
- Action: Execute GET request specifying JSON format
- Expected Result: HTTP 200 with JSON-formatted Goal resource, client processes successfully

---



<a id='i-cannot-analyze-this-requirement-because-all-the-fields-(summary,-text,-context,-verification,-actor,-conformance,-conditional,-and-source)-are-empty.-please-provide-the-actual-requirement-content-for-me-to-categorize-it-appropriately.'></a>

## I cannot analyze this requirement because all the fields (Summary, Text, Context, Verification, Actor, Conformance, Conditional, and Source) are empty. Please provide the actual requirement content for me to categorize it appropriately.

<a id='r'></a>

### R: No summary

**Text**: 

**Context**: 

**Actor**: 

**Conformance**: 

# Test Specification

## 1. Requirement ID

**R-UNKNOWN** (No requirement provided in input)

## 2. Requirement Analysis

### Testability Assessment
**Not testable** - No specific requirement was provided in the input. The requirement fields (Summary, Text, Context, Verification, Actor, Conformance, Conditional, Source) are all empty.

### Complexity
**N/A** - Cannot assess complexity without a defined requirement.

### Prerequisites
**N/A** - Cannot determine prerequisites without a specific requirement to test.

## 3. Test Implementation Strategy

### Required Inputs
**Cannot be determined** - Without a specific requirement, it's impossible to define the necessary inputs, FHIR resources, or expected outputs.

### Required FHIR Operations
**Cannot be determined** - The FHIR operations needed depend on the specific requirement being tested.

### Validation Criteria
**Cannot be determined** - Validation criteria must be based on the specific conformance requirement being tested.

---

## Note on Available Capability Statement Information

The provided Capability Statement information indicates support for:

1. **US Core Server Requirements**:
   - Must support US Core Patient resource profile plus at least one additional US Core Profile
   - Must follow General Requirements and Must Support guidance
   - Must return specific HTTP response codes (400, 401/4xx, 403, 404)
   - Must support JSON format
   - Should support XML format and FHIR meta.profile attributes

2. **Security Requirements**:
   - Must reject unauthorized requests with appropriate HTTP status codes
   - Should follow General Security Considerations

3. **System Interactions**:
   - May support transaction, batch, search-system, and history-system interactions

4. **Implementation Guide Support**:
   - Should support SMART App Launch version 2.0.0 and later

**To create a meaningful test specification, please provide the specific requirement details including Summary, Text, Context, Verification criteria, Actor, Conformance level, and any Conditional aspects.**

---



<a id='immunization'></a>

## Immunization

<a id='req-368'></a>

### REQ-368: The Immunization resource SHALL map the identifier to Event.identifier.

**Text**: 

**Context**: Mappings for Workflow Pattern for Immunization

**Actor**: Immunization resource

**Conformance**: SHALL

# Test Specification for REQ-368

## 1. Requirement ID
REQ-368

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Automatically testable

**Rationale**: This requirement specifies a concrete mapping rule that can be programmatically verified by examining Immunization resources to confirm the presence and proper mapping of identifier elements to Event.identifier according to the Workflow Pattern specifications.

### Complexity
**Classification**: Simple

**Rationale**: The test involves straightforward validation of field mapping and presence checking within a single resource type.

### Prerequisites
- System must support US Core Immunization Profile
- System must have Immunization resources with identifier data available
- Test system must be able to retrieve Immunization resources via FHIR API
- Understanding of FHIR Workflow Pattern Event.identifier mapping requirements

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources**:
- Immunization resources that contain identifier elements
- Test should work with any valid Immunization resources present in the system being tested

**Expected Outputs**:
- Validation results confirming proper mapping of Immunization.identifier to Event.identifier pattern
- Conformance status (pass/fail) for each tested Immunization resource

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required:

1. **Search Operation**: 
   ```
   GET [base]/Immunization?patient=[patient-id]
   ```
   - Uses the mandatory search parameter `patient` (reference type)

2. **Read Operation**:
   ```
   GET [base]/Immunization/[id]
   ```
   - For detailed examination of individual Immunization resources

3. **Optional Status-based Search**:
   ```
   GET [base]/Immunization?patient=[patient-id]&status=[status-code]
   ```
   - To focus on specific immunization statuses if needed

### Validation Criteria

The test SHALL verify the following assertions for each Immunization resource:

#### Primary Validation
1. **Identifier Presence Check**:
   - Verify that `Immunization.identifier` element exists when the resource represents an event requiring identification
   - Assert that the identifier follows the Event.identifier pattern as defined in the Workflow Pattern

#### Mapping Validation  
2. **Event.identifier Mapping Compliance**:
   - Confirm that `Immunization.identifier` values conform to the Identifier datatype requirements
   - Validate that the identifier serves the purpose of uniquely identifying the immunization event
   - Ensure the identifier can be used to correlate this immunization across systems (Event.identifier semantics)

#### Structure Validation
3. **Identifier Structure Check**:
   - Verify `Immunization.identifier` contains required sub-elements (system and/or value)
   - Confirm identifier values are appropriately formatted
   - Validate that identifier types are appropriate for immunization events

#### Test Passing Criteria
A test case **PASSES** when:
- All Immunization resources with identifiers properly map to Event.identifier pattern
- No structural or semantic violations of the identifier mapping are found
- The identifier can serve its intended purpose of event identification per Workflow Pattern

A test case **FAILS** when:
- `Immunization.identifier` is missing when required for event identification
- The identifier structure does not conform to Event.identifier requirements
- The mapping does not support the semantic requirements of the Workflow Pattern

#### Test Scope
- Test should examine all available Immunization resources in the system
- Focus on resources that represent actual immunization events (not proposals or plans)
- Validate both single and multiple identifier scenarios per resource
- Ensure testing covers different identifier types and systems if present in the data

---

<a id='req-369'></a>

### REQ-369: The Immunization resource SHALL map the status to Event.status.

**Text**: 

**Context**: Mappings for Workflow Pattern for Immunization

**Actor**: Immunization resource

**Conformance**: SHALL

# Test Specification for REQ-369

## 1. Requirement ID
REQ-369

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified programmatically by examining the mapping between Immunization resource status field and the Event.status field as defined in the FHIR Workflow Pattern.

### Complexity
**Simple** - This is a straightforward mapping verification that requires checking a single field mapping against the specified workflow pattern.

### Prerequisites
- System must support the US Core Immunization Profile
- System must have Immunization resources available for testing
- Access to FHIR R4 specification for Event.status workflow pattern reference
- System must support read operations for Immunization resources

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Immunization resources conforming to US Core Immunization Profile
- **Test Data**: Immunization resources with various status values (completed, entered-in-error, not-done)
- **Reference**: FHIR R4 Event pattern workflow status mappings

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for Immunization resources:
- `GET [base]/Immunization/[id]` (read operation - SHALL support)
- `GET [base]/Immunization?patient=[patient-id]` (search operation - SHALL support)
- `GET [base]/Immunization?patient=[patient-id]&status=[status]` (search with status - SHOULD support)

### Validation Criteria

#### Test Case 1: Status Mapping Verification
**Objective**: Verify that Immunization.status correctly maps to Event.status according to the FHIR Workflow Pattern

**Test Steps**:
1. Retrieve Immunization resources using supported search parameters
2. For each Immunization resource, extract the `status` field value
3. Verify the status value is one of the valid Event.status codes defined in the FHIR specification
4. Confirm the status value follows the Event workflow pattern semantics

**Expected Results**:
- All Immunization resources SHALL have a status field populated
- Status values SHALL be from the valid Event.status value set: `completed`, `entered-in-error`, `not-done`
- Status values SHALL follow the semantic meaning defined in the Event workflow pattern
- No Immunization resources should have invalid or unmapped status values

#### Test Case 2: Status Consistency Validation
**Objective**: Ensure status mapping consistency across multiple Immunization resources

**Test Steps**:
1. Query for Immunization resources using patient search: `GET [base]/Immunization?patient=[patient-id]`
2. If supported, query by status: `GET [base]/Immunization?patient=[patient-id]&status=completed`
3. Verify that status filtering works correctly when supported
4. Validate that all returned resources have consistent status mappings

**Expected Results**:
- Search results SHALL only include Immunization resources with properly mapped status values
- When status search parameter is used, results SHALL be filtered correctly
- All status values SHALL conform to the Event workflow pattern requirements

#### Test Case 3: Individual Resource Status Validation
**Objective**: Verify status mapping for individual Immunization resources via direct read

**Test Steps**:
1. Perform direct read operations: `GET [base]/Immunization/[id]`
2. Extract and validate the status field from each resource
3. Verify the status represents a valid Event.status workflow state

**Expected Results**:
- Each Immunization resource SHALL contain a valid status field
- Status values SHALL map correctly to Event.status as defined in the workflow pattern
- No resources should have missing or invalid status values

### Pass/Fail Criteria
- **PASS**: All Immunization resources have status values that correctly map to valid Event.status codes according to the FHIR Workflow Pattern
- **FAIL**: Any Immunization resource has an invalid status value, missing status field, or status that doesn't conform to the Event workflow pattern mapping requirements

### Additional Validation Notes
- The test should verify against the complete Event.status value set as defined in FHIR R4
- Status mapping should be semantically correct, not just syntactically valid
- The test accommodates "bring your own data" by working with whatever Immunization resources are available in the test system
- Results should be documented showing the mapping validation for audit purposes

---

<a id='req-370'></a>

### REQ-370: The Immunization resource SHALL map the statusReason to Event.statusReason.

**Text**: 

**Context**: Mappings for Workflow Pattern for Immunization

**Actor**: Immunization resource

**Conformance**: SHALL

# Test Specification for REQ-370

## Requirement ID
REQ-370

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified programmatically by examining the mapping between Immunization.statusReason and the Event.statusReason workflow pattern element.

### Complexity
**Simple** - This is a straightforward structural mapping verification that requires checking a single element mapping within the Immunization resource.

### Prerequisites
- System must support US Core Immunization Profile
- Test data must include Immunization resources with populated statusReason elements
- Access to system's FHIR server with read capabilities for Immunization resources

## Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Immunization resources that contain the `statusReason` element
- **Test Data Requirements**: 
  - At least one Immunization resource with a populated `statusReason` field
  - Patient reference to associate with the Immunization resource

### Expected Outputs
- Verification that `Immunization.statusReason` is correctly mapped to the Event workflow pattern's `statusReason` element
- Confirmation that the mapping maintains the correct data type and structure

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required:

1. **GET /Immunization/[id]** - Read specific Immunization resource
2. **GET /Immunization?patient=[patient-id]** - Search for Immunization resources by patient (required search parameter)

Optional but useful operations:
- **GET /Immunization?patient=[patient-id]&status=[status]** - Search with status filter
- **GET /Immunization?patient=[patient-id]&date=[date]** - Search with date filter

### Validation Criteria

The test SHALL verify the following assertions:

1. **Element Presence Verification**:
   - When an Immunization resource contains a `statusReason` element, verify the element is properly structured according to the Event workflow pattern mapping

2. **Data Type Validation**:
   - Verify that `Immunization.statusReason` conforms to the CodeableConcept data type as required by the Event.statusReason mapping
   - Confirm the element structure includes appropriate coding system and code values

3. **Mapping Compliance**:
   - Validate that the `statusReason` element in retrieved Immunization resources follows the Event workflow pattern specification
   - Ensure the semantic meaning is preserved in the mapping (statusReason should indicate why the immunization has its current status)

4. **Profile Conformance**:
   - Verify that Immunization resources containing `statusReason` conform to the US Core Immunization Profile
   - Validate against any additional constraints specified in the profile

### Test Steps

1. **Data Discovery**:
   - Query for Immunization resources using supported search parameters
   - Identify resources that contain the `statusReason` element

2. **Resource Retrieval**:
   - Retrieve individual Immunization resources that contain `statusReason`
   - Verify successful retrieval and valid FHIR structure

3. **Mapping Validation**:
   - Examine the `statusReason` element structure
   - Verify it conforms to the Event workflow pattern requirements
   - Validate CodeableConcept structure with appropriate coding

4. **Conformance Verification**:
   - Confirm the resource validates against the US Core Immunization Profile
   - Verify the mapping maintains interoperability standards

### Pass/Fail Criteria

**PASS**: All retrieved Immunization resources with `statusReason` elements correctly map to the Event.statusReason pattern with proper data type, structure, and semantic meaning.

**FAIL**: Any Immunization resource with a `statusReason` element that does not conform to the Event workflow pattern mapping requirements, has incorrect data types, or fails profile validation.

---

<a id='req-371'></a>

### REQ-371: The Immunization resource SHALL map the vaccineCode to Event.code.

**Text**: 

**Context**: FHIR Workflow Pattern mapping for Immunization resource elements to Event pattern fields.

**Actor**: Immunization resource

**Conformance**: SHALL

# Test Specification for REQ-371

## 1. Requirement ID
**REQ-371**: The Immunization resource SHALL map the vaccineCode to Event.code.

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified programmatically by examining Immunization resources and validating the presence and proper mapping of the vaccineCode element to the FHIR Workflow Pattern Event.code field.

### Complexity
**Simple** - This is a straightforward structural validation requirement that checks for the presence and proper use of a specific FHIR element within the Immunization resource.

### Prerequisites
- Server must support the US Core Immunization Profile
- Server must have Immunization resources available for testing
- Server must support read operations for Immunization resources
- Test system must have access to at least one Immunization resource with vaccine code data

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Immunization resources conforming to US Core Immunization Profile
- **Expected Outputs**: Validation that each Immunization resource contains a properly populated vaccineCode element that maps to Event.code in the FHIR Workflow Pattern

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required:

1. **Search Operation**: 
   ```
   GET [base]/Immunization?patient=[patient-id]
   ```
   - Search for Immunization resources by patient (SHALL support)

2. **Read Operation**:
   ```
   GET [base]/Immunization/[id]
   ```
   - Read individual Immunization resources (SHALL support)

3. **Optional Enhanced Searches** (SHOULD support):
   ```
   GET [base]/Immunization?patient=[patient-id]&status=[status]
   GET [base]/Immunization?patient=[patient-id]&date=[date]
   ```

### Validation Criteria

#### Primary Validation Checks:
1. **Element Presence**: Verify that each Immunization resource contains the `vaccineCode` element
2. **Element Structure**: Confirm that `vaccineCode` follows the expected CodeableConcept structure
3. **Workflow Pattern Mapping**: Validate that the `vaccineCode` appropriately maps to Event.code as defined in the FHIR Workflow Pattern
4. **Profile Conformance**: Ensure the Immunization resource conforms to the US Core Immunization Profile

#### Specific Assertions:
- **PASS Conditions**:
  - `Immunization.vaccineCode` element is present
  - `Immunization.vaccineCode` contains at least one coding with system and code values
  - The vaccineCode follows CVX vaccine code requirements as specified in US Core (required)
  - NDC vaccine codes may be present as additional codings (SHOULD support)
  - The vaccineCode properly represents the vaccine administered (semantic validation)

- **FAIL Conditions**:
  - `Immunization.vaccineCode` element is missing
  - `Immunization.vaccineCode` is present but empty or malformed
  - The vaccine code does not follow expected coding system requirements
  - The resource fails to conform to US Core Immunization Profile validation

#### Test Execution Steps:
1. **Discovery Phase**: Use patient search to identify available Immunization resources
2. **Resource Retrieval**: Read individual Immunization resources using GET operations
3. **Element Validation**: Check each resource for proper vaccineCode implementation
4. **Profile Validation**: Verify conformance to US Core Immunization Profile
5. **Workflow Pattern Compliance**: Confirm mapping aligns with FHIR Event pattern requirements

#### Success Metrics:
- All retrieved Immunization resources contain properly structured vaccineCode elements
- 100% of tested resources pass vaccineCode validation checks
- All resources conform to US Core Immunization Profile requirements
- Vaccine codes align with Event.code mapping requirements from FHIR Workflow Pattern

---

<a id='req-372'></a>

### REQ-372: The Immunization resource SHALL map the patient to Event.subject.

**Text**: 

**Context**: FHIR Workflow Pattern mapping for Immunization resource elements to Event pattern fields.

**Actor**: Immunization resource

**Conformance**: SHALL

# Test Specification for REQ-372

## Requirement ID
REQ-372

## Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be validated through automated inspection of Immunization resource instances to verify that the `patient` element is correctly mapped to `Event.subject`.

### Complexity
**Simple** - This is a straightforward structural validation that checks for the presence and correct reference type of a single element.

### Prerequisites
- System must support the US Core Immunization Profile
- System must have Immunization resources available for testing
- Referenced Patient resources must be accessible for validation
- System must support READ operations for Immunization resources

## Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: 
  - One or more Immunization resources conforming to US Core Immunization Profile
  - Associated Patient resources referenced by the Immunization instances
- **System Configuration**: Server supporting US Core Immunization Profile with READ capabilities

### Expected Outputs
- Immunization resources with valid `patient` element references
- Confirmation that patient references resolve to valid Patient resources

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required for testing:
- `GET [base]/Immunization/[id]` - READ operation for retrieving Immunization resources
- `GET [base]/Patient/[id]` - READ operation for validating referenced Patient resources
- `GET [base]/Immunization?patient=[patient-id]` - SEARCH operation to find Immunizations for a specific patient (using SHALL-supported patient search parameter)

### Validation Criteria

The test SHALL verify the following assertions for each Immunization resource:

1. **Element Presence Validation**:
   - The `Immunization.patient` element SHALL be present
   - The `Immunization.patient` element SHALL not be empty

2. **Reference Type Validation**:
   - The `Immunization.patient` element SHALL be of type Reference
   - The reference SHALL point to a Patient resource type

3. **Reference Integrity Validation**:
   - The referenced Patient resource SHALL be accessible via READ operation
   - The Patient reference SHALL resolve to a valid Patient resource conforming to US Core Patient Profile

4. **FHIR Workflow Pattern Mapping Validation**:
   - Verify that `Immunization.patient` correctly maps to the Event pattern's `Event.subject` field
   - Confirm the reference represents the patient who received the immunization (the subject of the immunization event)

### Test Success Criteria
- **PASS**: All tested Immunization resources contain a valid `patient` element that references an accessible Patient resource
- **FAIL**: Any Immunization resource is missing the `patient` element, contains an invalid reference, or the referenced Patient resource cannot be retrieved

### Test Execution Approach
1. Retrieve available Immunization resources using supported search parameters
2. For each Immunization resource, validate the presence and format of the `patient` element
3. Attempt to resolve each patient reference to confirm resource accessibility
4. Verify that resolved Patient resources conform to expected US Core Patient Profile requirements
5. Document any instances where the mapping requirement is not met

---

<a id='req-373'></a>

### REQ-373: The Immunization resource SHALL map the encounter to Event.context.

**Text**: 

**Context**: FHIR Workflow Pattern mapping for Immunization resource elements to Event pattern fields.

**Actor**: Immunization resource

**Conformance**: SHALL

# Test Specification for REQ-373

## Requirement ID
REQ-373

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified programmatically by checking the mapping between Immunization resource elements and the Event.context field through resource validation and structure verification.

### Complexity
**Simple** - The requirement involves a straightforward mapping verification between a specific Immunization resource element and the Event pattern context field.

### Prerequisites
- FHIR server implementing US Core Immunization Profile
- Test system with Immunization resources that reference encounters
- Access to Immunization resources via FHIR API (read operations)
- Understanding of FHIR Workflow Pattern Event mapping requirements

## Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: 
  - Immunization resources conforming to US Core Immunization Profile
  - Associated Encounter resources (if externally referenced)
- **System Configuration**: FHIR server supporting US Core Immunization Profile with read capabilities
- **Data Requirements**: Immunization resources that contain encounter context information

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required:

1. **GET [base]/Immunization/[id]** - Read specific Immunization resources
2. **GET [base]/Immunization?patient=[patient-id]** - Search for patient's immunizations
3. **GET [base]/Encounter/[id]** - Read referenced Encounter resources (if needed for validation)

### Validation Criteria

#### Primary Validation Checks

1. **Event.context Mapping Verification**:
   - **Assertion**: For each Immunization resource, verify that encounter information is properly mapped to the Event.context field
   - **Expected Result**: Immunization.encounter element should be populated when encounter context exists
   - **Pass Criteria**: All Immunization resources with encounter context successfully map the encounter reference to Event.context

2. **Resource Structure Validation**:
   - **Assertion**: Verify that Immunization resources conform to the Event pattern mapping requirements
   - **Expected Result**: Proper mapping structure between Immunization elements and Event pattern fields
   - **Pass Criteria**: Structural validation passes for Event pattern compliance

3. **Reference Integrity Check**:
   - **Assertion**: If Immunization.encounter is populated, the referenced encounter should be accessible
   - **Expected Result**: Referenced encounters are valid and retrievable
   - **Pass Criteria**: All encounter references in Immunization resources resolve successfully

#### Test Cases

**Test Case 1: Encounter Context Mapping**
- Retrieve Immunization resources from the system
- For each Immunization resource with encounter context:
  - Verify that `Immunization.encounter` element is present
  - Validate that the encounter reference follows proper FHIR reference format
  - Confirm the mapping aligns with Event.context requirements

**Test Case 2: Event Pattern Compliance**
- Validate that the Immunization resource structure supports Event pattern mapping
- Verify that encounter context information is properly structured according to FHIR Workflow Pattern specifications
- Ensure that the mapping from Immunization to Event.context is consistent and complete

**Test Case 3: Reference Resolution**
- For Immunization resources with encounter references:
  - Attempt to resolve the encounter reference
  - Verify that the referenced encounter exists and is accessible
  - Confirm that the encounter context information is complete and valid

#### Expected Outcomes

**Pass**: 
- All Immunization resources properly map encounter information to Event.context
- Referenced encounters are valid and accessible
- Event pattern mapping requirements are satisfied

**Fail**: 
- Immunization resources fail to map encounter to Event.context
- Invalid or unresolvable encounter references
- Non-compliance with Event pattern mapping requirements

#### Notes
- This test focuses on the mapping requirement rather than the clinical validity of the immunization data
- The test should accommodate various encounter reference formats (contained, external references)
- Consider testing with both populated and unpopulated encounter contexts to ensure proper handling in all scenarios

---

<a id='req-374'></a>

### REQ-374: The Immunization resource SHALL map the occurrence[x] to Event.occurrence[x].

**Text**: 

**Context**: FHIR Workflow Pattern mapping for Immunization resource elements to Event pattern fields.

**Actor**: Immunization resource

**Conformance**: SHALL

# Test Specification for REQ-374

## 1. Requirement ID
REQ-374

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be tested programmatically by examining the mapping between Immunization resource elements and the Event pattern fields, specifically validating that `Immunization.occurrence[x]` correctly maps to `Event.occurrence[x]`.

### Complexity
**Simple** - This is a straightforward mapping validation that requires checking a single element mapping between two patterns.

### Prerequisites
- FHIR server implementing US Core Immunization Profile
- Test system capable of retrieving Immunization resources
- Understanding of FHIR Workflow Pattern Event mapping specifications
- Access to Immunization resources with populated `occurrence[x]` elements

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Immunization resources that contain populated `occurrence[x]` elements
- Resources should include various occurrence types (dateTime, string) if supported by the implementation

**Expected Outputs:**
- Validation confirmation that `Immunization.occurrence[x]` elements are properly mapped according to Event pattern specifications
- Documentation of supported occurrence data types and their mappings

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required for testing:

1. **Read Operation:**
   - `GET [base]/Immunization/[id]` - Retrieve specific Immunization resources

2. **Search Operations:**
   - `GET [base]/Immunization?patient=[patient-id]` - Search for patient's immunizations
   - `GET [base]/Immunization?patient=[patient-id]&date=[date]` - Search with date parameters (SHOULD support)
   - `GET [base]/Immunization?patient=[patient-id]&status=[status]` - Search with status parameters (SHOULD support)

### Validation Criteria

**Primary Assertions:**
1. **Occurrence Element Presence Validation:**
   - Verify that retrieved Immunization resources contain `occurrence[x]` elements when immunization timing data is available
   - Confirm that the occurrence data follows FHIR datatype specifications (dateTime, string, etc.)

2. **Event Pattern Mapping Validation:**
   - Validate that `Immunization.occurrence[x]` values are structured according to Event pattern specifications
   - Ensure that the occurrence timing information is properly formatted and accessible
   - Verify that when multiple occurrence formats are supported, they are consistently applied

3. **Data Type Consistency:**
   - Check that occurrence values use appropriate FHIR data types (typically dateTime for specific timing)
   - Validate that string-based occurrence descriptions are properly formatted when used
   - Ensure occurrence precision is appropriate for the clinical context

**Secondary Assertions:**
1. **Profile Conformance:**
   - Verify that Immunization resources conform to US Core Immunization Profile requirements
   - Validate that occurrence mappings don't violate profile constraints

2. **Search Parameter Functionality:**
   - Test that date-based searches using the occurrence information work correctly
   - Verify that retrieved resources maintain proper occurrence mapping in search results

**Test Pass Criteria:**
- All Immunization resources with timing information contain properly formatted `occurrence[x]` elements
- Occurrence elements map correctly to Event pattern specifications
- No validation errors when occurrence data is processed according to Event pattern requirements
- Search operations correctly utilize occurrence timing information when filtering results

**Test Fail Criteria:**
- Missing `occurrence[x]` elements in Immunization resources where timing data should be present
- Occurrence elements that don't conform to Event pattern mapping specifications
- Inconsistent or improperly formatted occurrence data types
- Search operations that fail to properly utilize occurrence timing information

---

<a id='req-375'></a>

### REQ-375: The Immunization resource SHALL map the location to Event.location.

**Text**: 

**Context**: FHIR Workflow Pattern mapping for Immunization resource elements to Event pattern fields.

**Actor**: Immunization resource

**Conformance**: SHALL

# Test Specification for REQ-375

## Requirement ID
REQ-375

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated by examining Immunization resource instances to verify that when a location is present, it is properly mapped to the `Immunization.location` element according to the FHIR Workflow Pattern Event.location mapping.

### Complexity
**Simple** - The test involves straightforward validation of a single element mapping within the Immunization resource structure.

### Prerequisites
- System must support the US Core Immunization Profile
- System must have Immunization resources available for testing
- Test data should include Immunization resources with location information where applicable

## Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Immunization resources that contain location information
- **Expected Outputs**: Confirmation that location data is properly populated in `Immunization.location` element when location information is available

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for Immunization resources:
- `GET [base]/Immunization/[id]` (read operation) - **SHALL** be supported
- `GET [base]/Immunization?patient=[patient-id]` (search operation) - **SHALL** be supported
- `GET [base]/Immunization?[parameter=value]&_revinclude=Provenance:target` (search with Provenance) - **SHALL** be supported

### Validation Criteria

#### Test Case 1: Verify Location Mapping in Individual Immunization Resources
1. **Setup**: Retrieve Immunization resources using the read operation
2. **Execution**: 
   - For each Immunization resource retrieved, examine the resource structure
   - Check if the immunization has associated location information
3. **Validation**:
   - **PASS**: If location information is present in the source data, verify that `Immunization.location` element is populated with a valid reference to a Location resource
   - **PASS**: If no location information exists in the source system, the absence of `Immunization.location` is acceptable
   - **FAIL**: If location information exists but `Immunization.location` is not populated or contains invalid data

#### Test Case 2: Verify Location Mapping via Patient Search
1. **Setup**: Search for Immunization resources by patient using `GET [base]/Immunization?patient=[patient-id]`
2. **Execution**:
   - Retrieve all Immunization resources for one or more patients
   - Examine each returned Immunization resource
3. **Validation**:
   - **PASS**: For each Immunization resource that should contain location data, verify `Immunization.location` is properly populated
   - **PASS**: Location references should resolve to valid Location resources when followed
   - **FAIL**: Any Immunization with location data missing from `Immunization.location` when it should be present

#### Test Case 3: Verify Location Reference Integrity
1. **Setup**: Identify Immunization resources that contain `Immunization.location` references
2. **Execution**:
   - For each location reference found, attempt to resolve the reference
   - Verify the referenced Location resource exists and is accessible
3. **Validation**:
   - **PASS**: All `Immunization.location` references resolve to valid, accessible Location resources
   - **PASS**: Referenced Location resources conform to expected FHIR Location resource structure
   - **FAIL**: Any `Immunization.location` reference that cannot be resolved or points to invalid/inaccessible resources

#### Overall Test Success Criteria
- All Immunization resources with location information must have the location properly mapped to the `Immunization.location` element
- The mapping must follow FHIR Workflow Pattern specifications for Event.location
- Location references must be valid and resolvable within the system
- No location data should be lost or incorrectly mapped during the workflow pattern implementation

---

<a id='req-376'></a>

### REQ-376: The Immunization resource SHALL map the performer to Event.performer.

**Text**: 

**Context**: FHIR Workflow Pattern mapping for Immunization resource elements to Event pattern fields.

**Actor**: Immunization resource

**Conformance**: SHALL

# Test Specification for REQ-376

## Requirement ID
REQ-376

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be tested through automated validation of FHIR resource structure and content mapping.

### Complexity
**Simple** - This is a straightforward mapping validation between two defined FHIR elements within the Immunization resource.

### Prerequisites
- Server must support the US Core Immunization Profile as specified in the Capability Statement
- Server must have Immunization resources available for testing
- Test system must be able to perform READ operations on Immunization resources
- Immunization resources should contain performer information to enable meaningful testing

## Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Immunization resources that contain performer information
- **Server Endpoint**: FHIR server supporting US Core Immunization Profile
- **Patient Context**: Valid patient references for accessing Immunization resources

### Expected Outputs
- Immunization resources with properly mapped performer elements
- Validation confirmation that performer data is correctly structured according to the Event.performer pattern

### Required FHIR Operations
1. **GET /Immunization/[id]** - Retrieve specific Immunization resources for validation
2. **GET /Immunization?patient=[patient-id]** - Search for patient's immunizations (supported per Capability Statement)
3. **GET /Immunization?patient=[patient-id]&status=[status]** - Optional filtered search for immunizations with specific status

### Validation Criteria

#### Primary Validation
1. **Performer Element Presence**: Verify that `Immunization.performer` element exists when performer information is available
2. **Event Pattern Mapping**: Confirm that the `Immunization.performer` structure aligns with the FHIR Workflow Event.performer pattern requirements:
   - `Immunization.performer.function` maps to Event.performer role/function
   - `Immunization.performer.actor` maps to Event.performer actor reference

#### Specific Assertions
1. **Structure Validation**:
   - `Immunization.performer` is properly structured as an array/list
   - Each performer entry contains the required elements per US Core Immunization Profile

2. **Data Type Validation**:
   - `Immunization.performer.function` is a CodeableConcept (if present)
   - `Immunization.performer.actor` is a valid Reference to Practitioner, PractitionerRole, or Organization

3. **Reference Integrity**:
   - Referenced actors in `Immunization.performer.actor` can be resolved (if external references)
   - Referenced resources conform to appropriate US Core profiles when available

#### Test Pass Criteria
- All retrieved Immunization resources with performer data have the performer element correctly mapped to the Event.performer pattern
- No validation errors occur when validating the performer mapping structure
- Referenced performer actors are valid and resolvable where applicable

#### Test Fail Criteria
- Immunization resources contain performer information but lack the `performer` element
- The `performer` element structure does not conform to the Event.performer pattern
- Invalid or unresolvable references in `Immunization.performer.actor`
- Missing required sub-elements within the performer structure as defined by the US Core Immunization Profile

---

<a id='req-377'></a>

### REQ-377: The Immunization resource SHALL map the function to Event.performer.function.

**Text**: 

**Context**: FHIR Workflow Pattern mapping for Immunization resource elements to Event pattern fields.

**Actor**: Immunization resource

**Conformance**: SHALL

# Test Specification for REQ-377

## 1. Requirement ID
**REQ-377**: The Immunization resource SHALL map the function to Event.performer.function.

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated testing by examining Immunization resource instances and validating that the `performer.function` element is properly populated when performer information is present.

### Complexity
**Simple** - This is a straightforward structural mapping requirement that involves checking for the presence and proper population of a specific FHIR element.

### Prerequisites
- Server implements US Core Immunization Profile support
- Test system has access to Immunization resources with performer information
- Server supports read operations for Immunization resources as specified in the Capability Statement

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Immunization resources that contain performer information
- **Test Data**: Immunization instances with populated `performer` elements from the server's dataset
- **Access Method**: Standard FHIR read/search operations as supported per the Capability Statement

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and should be used:

1. **Search Operations**:
   - `GET [base]/Immunization?patient=[patient-id]` - Search for patient's immunizations
   - `GET [base]/Immunization?patient=[patient-id]&status=completed` - Search with status filter

2. **Read Operations**:
   - `GET [base]/Immunization/[id]` - Direct resource read

3. **Include Operations** (if needed):
   - `GET [base]/Immunization?[parameters]&_revinclude=Provenance:target` - Include provenance information

### Validation Criteria

#### Test Case 1: Immunization with Performer Function Mapping
**Objective**: Verify that when an Immunization resource contains performer information, the function is properly mapped to `Event.performer.function`.

**Test Steps**:
1. Retrieve Immunization resources using supported search parameters from Capability Statement
2. Filter for Immunization resources that have `performer` elements populated
3. For each Immunization resource with performers:
   - Verify that `Immunization.performer.function` exists when performer information is present
   - Validate that the function element contains appropriate coded values
   - Confirm the mapping follows FHIR Event pattern requirements

**Validation Assertions**:
- **PASS**: All Immunization resources with performer information have the `performer.function` element properly populated
- **FAIL**: Any Immunization resource with performer information lacks the `performer.function` element or has it improperly populated

#### Test Case 2: Function Element Structure Validation
**Objective**: Ensure the function element conforms to expected FHIR datatypes and value constraints.

**Test Steps**:
1. For Immunization resources with `performer.function` elements:
   - Validate that the function element uses appropriate CodeableConcept structure
   - Check that coded values are from appropriate value sets where binding is specified
   - Verify element cardinality matches profile requirements

**Validation Assertions**:
- **PASS**: All `performer.function` elements conform to FHIR structural requirements and US Core profile constraints
- **FAIL**: Any `performer.function` elements fail structural validation or profile conformance

#### Test Case 3: Event Pattern Conformance
**Objective**: Verify that the Immunization resource's performer function mapping aligns with the FHIR Event pattern.

**Test Steps**:
1. Analyze the mapping between Immunization.performer.function and Event.performer.function
2. Validate consistency in how function roles are represented
3. Check for appropriate semantic meaning preservation in the mapping

**Validation Assertions**:
- **PASS**: The mapping between Immunization.performer.function and Event.performer.function maintains semantic consistency and follows FHIR Event pattern guidelines
- **FAIL**: The mapping fails to properly represent performer functions according to Event pattern requirements

#### Boundary Conditions
- **Empty Performer Lists**: Immunization resources without performer information should not be flagged as non-compliant for this requirement
- **Multiple Performers**: Resources with multiple performers should have function mappings for each performer entry
- **Partial Data**: Resources with performer information but missing function data should be identified as non-compliant

#### Expected Outcomes
- **Compliant System**: All Immunization resources with performer information properly populate the performer.function element according to Event pattern mapping requirements
- **Non-Compliant System**: Missing or improperly structured performer.function elements in resources that contain performer information

---

<a id='req-378'></a>

### REQ-378: The Immunization resource SHALL map the actor to Event.performer.actor.

**Text**: 

**Context**: FHIR Workflow Pattern mapping for Immunization resource elements to Event pattern fields.

**Actor**: Immunization resource

**Conformance**: SHALL

# Test Specification for REQ-378

## 1. Requirement ID
REQ-378

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified programmatically by examining Immunization resource instances and validating that the `performer.actor` field correctly maps to the Event pattern's performer.actor field according to FHIR Workflow Pattern specifications.

### Complexity
**Simple** - This is a straightforward structural mapping verification that requires checking the presence and format of a specific field in Immunization resources.

### Prerequisites
- System must support US Core Immunization Profile
- System must have Immunization resources available for testing
- Test system must be able to perform FHIR resource retrieval operations
- Understanding of FHIR Workflow Pattern Event mappings

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Immunization resources that contain performer information
- Patient resources (referenced by Immunization.patient)

**Expected Outputs:**
- Immunization resources with populated `performer.actor` fields
- Validation confirmation that the mapping follows Event pattern specifications

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required:

1. **GET [base]/Immunization/[id]** - Retrieve specific Immunization resource
2. **GET [base]/Immunization?patient=[patient-id]** - Search for Immunizations by patient
3. **GET [base]/Immunization?patient=[patient-id]&status=[status]** - Search with status filter (optional)
4. **GET [base]/Immunization?patient=[patient-id]&date=[date]** - Search with date filter (optional)

### Validation Criteria

#### Test Case 1: Basic Performer Actor Mapping Validation
**Objective:** Verify that Immunization resources correctly map performer information to the Event.performer.actor field

**Test Steps:**
1. Retrieve Immunization resources from the system using supported search parameters
2. For each Immunization resource that contains performer information:
   - Verify `performer` array is present
   - For each performer entry, verify `actor` field is populated
   - Validate that `actor` contains a valid reference to an appropriate resource (Practitioner, PractitionerRole, Organization, Patient, or RelatedPerson)
   - Confirm the reference format follows FHIR specifications (Reference datatype)

**Pass Criteria:**
- All Immunization resources with performer data contain the `performer.actor` field
- All `performer.actor` references are properly formatted FHIR References
- References point to valid resource types per FHIR Immunization specification

#### Test Case 2: Event Pattern Compliance Verification
**Objective:** Ensure the performer.actor mapping aligns with FHIR Workflow Pattern Event specifications

**Test Steps:**
1. Retrieve Immunization resources with performer data
2. Validate that the `performer.actor` mapping follows the Event pattern requirements:
   - Verify the actor field represents "who performed the activity"
   - Confirm the reference structure is consistent with Event.performer.actor pattern
   - Check that multiple performers (if present) are each properly mapped

**Pass Criteria:**
- The `performer.actor` field correctly represents the entity that performed the immunization
- The mapping structure is consistent with FHIR Workflow Pattern Event.performer.actor requirements
- No missing or malformed actor references in performer entries

#### Test Case 3: Reference Integrity Validation
**Objective:** Verify that performer.actor references resolve to valid resources

**Test Steps:**
1. Extract all `performer.actor` references from Immunization resources
2. For each reference:
   - Verify the reference format is valid
   - If the reference is resolvable within the test scope, attempt to retrieve the referenced resource
   - Validate that the referenced resource type is appropriate (Practitioner, PractitionerRole, Organization, Patient, RelatedPerson)

**Pass Criteria:**
- All `performer.actor` references follow proper FHIR Reference format
- Referenced resources (when resolvable) exist and are of appropriate types
- No broken or invalid references are present

#### Negative Test Cases
**Objective:** Ensure proper handling of edge cases

**Test Steps:**
1. Identify Immunization resources without performer information
2. Verify that resources without performers don't have incomplete performer.actor mappings
3. Check handling of resources with multiple performers

**Pass Criteria:**
- Immunization resources without performer data don't contain partial or empty performer structures
- Resources with multiple performers correctly map each performer.actor
- No structural inconsistencies in performer data

### Assertions for Test Validation
1. **SHALL assertion:** Every Immunization resource with performer data MUST have performer.actor populated
2. **Structure assertion:** performer.actor MUST be a valid FHIR Reference
3. **Mapping assertion:** The performer.actor mapping MUST align with Event pattern specifications
4. **Type assertion:** Referenced actors MUST be of valid resource types per Immunization specification
5. **Completeness assertion:** No performer entries SHALL have missing actor information

---

<a id='req-379'></a>

### REQ-379: The Immunization resource SHALL map the note to Event.note.

**Text**: 

**Context**: FHIR Workflow Pattern mapping for Immunization resource elements to Event pattern fields.

**Actor**: Immunization resource

**Conformance**: SHALL

# Test Specification for REQ-379

## Requirement ID
REQ-379

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated inspection of FHIR Immunization resources to confirm that notes are properly mapped to the `note` element.

### Complexity
**Simple** - This is a straightforward mapping verification that requires checking a single element within the Immunization resource structure.

### Prerequisites
- System must support US Core Immunization Profile
- System must have Immunization resources available for testing
- Test data should include Immunization resources with notes/annotations to verify the mapping

## Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Immunization resources conforming to the US Core Immunization Profile
- **Test Data Requirements**: 
  - At least one Immunization resource containing note information
  - Optional: Immunization resources without notes to verify proper handling of absence

### Expected Outputs
- Immunization resources where any note information is correctly populated in the `Immunization.note` element
- Confirmation that the note content follows the Annotation data type structure

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for Immunization resources:

1. **READ Operation**: `GET [base]/Immunization/[id]`
   - Retrieve individual Immunization resources to inspect note mapping

2. **SEARCH Operation**: `GET [base]/Immunization?patient=[patient-id]`
   - Search for Immunization resources by patient to gather test specimens

### Validation Criteria

#### Primary Validation Checks
1. **Note Element Presence**: When an Immunization resource contains note information, verify that it is populated in the `Immunization.note` element

2. **Note Structure Validation**: Confirm that `Immunization.note` follows the Annotation data type structure:
   - `note.text` contains the actual note content
   - Optional elements like `note.authorReference`, `note.authorString`, and `note.time` are properly formatted if present

3. **Event Pattern Mapping Compliance**: Verify that the note mapping aligns with the FHIR Workflow Pattern's Event.note field specification

#### Test Assertions
- **PASS**: All Immunization resources with note content have that content correctly mapped to `Immunization.note`
- **PASS**: The `note` element structure conforms to the Annotation data type requirements
- **PASS**: No note information is found in inappropriate elements (e.g., stored in extensions or other fields when it should be in `note`)
- **FAIL**: Note information exists in the source data but is not properly mapped to `Immunization.note`
- **FAIL**: The `note` element structure does not conform to the Annotation data type specification

#### Additional Considerations
- Test should verify that multiple notes are handled correctly if the system supports multiple Annotation entries in the `note` array
- Validate that the absence of notes is handled appropriately (empty or absent `note` element)
- Ensure that note content is preserved accurately without truncation or modification during the mapping process

---

<a id='req-380'></a>

### REQ-380: The Immunization resource SHALL map the reasonCode to Event.reasonCode.

**Text**: 

**Context**: FHIR Workflow Pattern mapping for Immunization resource elements to Event pattern fields.

**Actor**: Immunization resource

**Conformance**: SHALL

# Test Specification for REQ-380

## 1. Requirement ID
REQ-380

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated validation of FHIR resource structure and element mapping.

### Complexity
**Simple** - The requirement involves a direct mapping validation between two specific elements within the same resource.

### Prerequisites
- System must support US Core Immunization Profile
- System must have Immunization resources available for testing
- Immunization resources should contain `reasonCode` elements when available in source data
- Test system must support read operations for Immunization resources (as confirmed in Capability Statement)

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Immunization resources that contain `reasonCode` elements
- **Resource Access**: Ability to retrieve Immunization resources via read operations
- **Test Data**: Immunization instances with populated `reasonCode` values representing various clinical scenarios

### Required FHIR Operations
Based on the Capability Statement, the following supported operations will be used:
- `GET [base]/Immunization/[id]` - Read operation to retrieve specific Immunization resources
- `GET [base]/Immunization?patient=[patient-id]` - Search operation to find Immunization resources for testing

### Validation Criteria

The test SHALL verify the following assertions for each Immunization resource:

1. **Element Presence Validation**:
   - When an Immunization resource contains a `reasonCode` element, verify that it conforms to the Event pattern mapping requirements
   - Confirm that `Immunization.reasonCode` is properly structured as a CodeableConcept

2. **Mapping Compliance Validation**:
   - Verify that `Immunization.reasonCode` correctly maps to the Event.reasonCode pattern
   - Ensure the element follows the same semantic meaning and structure as defined in the FHIR Workflow Event pattern
   - Confirm that the reasoning for the immunization is appropriately captured and represented

3. **Profile Conformance**:
   - Validate that the Immunization resource conforms to the US Core Immunization Profile
   - Ensure all must-support elements are properly implemented when data is available

4. **Data Type Validation**:
   - Confirm `reasonCode` uses appropriate CodeableConcept structure with valid coding systems
   - Verify that reason codes use clinically appropriate vocabularies (e.g., SNOMED CT, ICD-10-CM)

### Test Execution Steps

1. **Resource Discovery**: Identify Immunization resources available for testing using supported search parameters
2. **Resource Retrieval**: Retrieve individual Immunization resources using the read operation
3. **Element Analysis**: For each resource, examine the presence and structure of `reasonCode` elements
4. **Mapping Verification**: Validate that `reasonCode` elements conform to Event pattern mapping requirements
5. **Profile Validation**: Ensure overall resource conformance to US Core Immunization Profile

### Expected Test Outcomes

- **PASS**: All Immunization resources with `reasonCode` elements properly map to Event.reasonCode pattern and maintain semantic consistency
- **FAIL**: Any Immunization resource fails to properly implement the reasonCode to Event.reasonCode mapping
- **NOT APPLICABLE**: No Immunization resources contain reasonCode elements in the test dataset

### Success Criteria
The implementation SHALL demonstrate that when `Immunization.reasonCode` is present, it correctly represents the reason for the immunization event in accordance with the FHIR Workflow Event pattern mapping, maintaining both structural and semantic conformance.

---

<a id='req-381'></a>

### REQ-381: The Immunization resource SHALL map the reasonReference to Event.reasonReference.

**Text**: 

**Context**: FHIR Workflow Pattern mapping for Immunization resource elements to Event pattern fields.

**Actor**: Immunization resource

**Conformance**: SHALL

# Test Specification for REQ-381

## 1. Requirement ID
REQ-381

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated by examining Immunization resource instances and verifying that the `reasonReference` element is properly mapped to the Event pattern's `reasonReference` field.

### Complexity
**Simple** - This is a straightforward structural validation that checks for the presence and proper mapping of a specific FHIR element.

### Prerequisites
- Server system supporting US Core Immunization Profile
- Test system with capability to retrieve Immunization resources
- Immunization resources containing `reasonReference` elements in the test dataset

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Immunization resources that contain `reasonReference` elements
- **Test Data**: Patient records with associated immunization history that includes reason references
- **Server Endpoint**: FHIR server supporting US Core Immunization Profile operations

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required for testing:

1. **Search Operation**: 
   ```
   GET [base]/Immunization?patient=[patient-id]
   ```

2. **Read Operation**: 
   ```
   GET [base]/Immunization/[id]
   ```

3. **Optional Search with Status** (if available in test data):
   ```
   GET [base]/Immunization?patient=[patient-id]&status=[status]
   ```

4. **Optional Search with Date** (if available in test data):
   ```
   GET [base]/Immunization?patient=[patient-id]&date=[date]
   ```

### Expected Outputs
- Immunization resources conforming to US Core Immunization Profile
- Resources containing `reasonReference` elements that properly reference other FHIR resources
- Valid references that can be resolved (if external references are used)

### Validation Criteria

#### Test Case 1: Verify reasonReference Element Presence and Structure
**Test Steps:**
1. Retrieve Immunization resources from the server using patient search
2. Filter for Immunization resources that contain `reasonReference` elements
3. Validate that `reasonReference` is present and properly structured

**Assertions:**
- `Immunization.reasonReference` element exists when reason data is provided via reference
- The `reasonReference` follows proper FHIR Reference structure with either:
  - `reference` field containing a valid resource reference
  - `display` field containing human-readable description
  - Both `reference` and `display` fields

#### Test Case 2: Verify reasonReference Target Resource Types
**Test Steps:**
1. Examine each `reasonReference` in retrieved Immunization resources
2. Validate that referenced resources are of appropriate types
3. Verify reference format compliance

**Assertions:**
- `reasonReference.reference` contains valid resource references (e.g., "Condition/[id]", "Observation/[id]")
- Referenced resource types are clinically appropriate for immunization reasons
- Reference format follows FHIR specifications (relative or absolute URLs)

#### Test Case 3: Verify reasonReference Resolution (if external references)
**Test Steps:**
1. For each external `reasonReference` in Immunization resources
2. Attempt to resolve the reference to retrieve the target resource
3. Validate the target resource exists and is accessible

**Assertions:**
- External references can be resolved successfully (return 200 status)
- Resolved resources are valid FHIR resources
- Resolved resources have appropriate content for immunization reasoning

#### Test Case 4: Verify Event Pattern Mapping Compliance
**Test Steps:**
1. Review Immunization resources with `reasonReference` elements
2. Confirm mapping aligns with FHIR Workflow Event pattern expectations
3. Validate semantic consistency

**Assertions:**
- `Immunization.reasonReference` semantically represents the clinical reason for the immunization
- The reference provides appropriate clinical context consistent with Event pattern requirements
- Multiple `reasonReference` entries (if present) are all clinically relevant and properly structured

#### Test Case 5: Verify Profile Conformance
**Test Steps:**
1. Validate retrieved Immunization resources against US Core Immunization Profile
2. Confirm `reasonReference` usage complies with profile constraints
3. Check for any profile-specific requirements regarding reason references

**Assertions:**
- All Immunization resources conform to US Core Immunization Profile
- `reasonReference` usage follows any cardinality constraints specified in the profile
- No validation errors are present related to `reasonReference` usage

### Pass/Fail Criteria
- **Pass**: All Immunization resources with `reasonReference` elements properly map to the Event pattern's `reasonReference` field with valid structure, appropriate target resource types, and successful resolution of external references
- **Fail**: Any Immunization resource fails to properly implement `reasonReference` mapping, contains invalid references, or violates FHIR or profile constraints

### Additional Considerations
- Test should accommodate various reference types (internal, external, contained resources)
- Consider testing with different immunization scenarios (routine, travel, outbreak response)
- Validate both successful reference resolution and appropriate error handling for invalid references
- Ensure test works with implementer's existing data without requiring specific test fixtures

---

<a id='req-382'></a>

### REQ-382: The Immunization resource SHALL map the vaccineCode to RXA-5 in HL7 v2.

**Text**: 

**Context**: HL7 v2 mapping for Immunization resource to HL7 v2 segments/fields.

**Actor**: Immunization resource

**Conformance**: SHALL

# Test Specification for REQ-382

## Requirement ID
REQ-382

## Requirement Analysis

### Testability Assessment
**Not testable** - This requirement is too vague and not directly verifiable through automated testing.

**Rationale:**
- This requirement addresses HL7 v2 mapping, which is outside the scope of FHIR interoperability testing
- The requirement references mapping from FHIR Immunization.vaccineCode to HL7 v2 RXA-5 field, but there's no mechanism to verify this mapping through FHIR API operations
- HL7 v2 message generation and field mapping are implementation-specific internal processes that cannot be tested via FHIR REST API calls
- The Capability Statement provided focuses on FHIR resource interactions and does not include any HL7 v2 transformation capabilities

### Complexity
**Not Applicable** - Cannot be tested through FHIR interoperability testing

### Prerequisites
**Not Applicable** - This requirement cannot be verified through standard FHIR testing approaches

## Test Implementation Strategy

### Assessment
This requirement **cannot be implemented as a FHIR interoperability test** for the following reasons:

1. **Scope Limitation**: The requirement addresses HL7 v2 message mapping, which is an internal system transformation process not exposed through FHIR APIs

2. **No Observable Behavior**: There is no FHIR operation or resource interaction that would allow verification of the mapping from Immunization.vaccineCode to HL7 v2 RXA-5

3. **Missing Capability**: The provided Capability Statement does not include any operations or endpoints that would support HL7 v2 message generation or transformation testing

4. **Implementation-Specific**: The mapping logic is internal to the system and not standardized in a way that can be externally verified

### Alternative Verification Approaches
Since this requirement cannot be tested through automated FHIR interoperability testing, it would require:

- **Attestation**: System implementers would need to attest that their HL7 v2 message generation correctly maps Immunization.vaccineCode to RXA-5
- **Manual Testing**: Direct inspection of generated HL7 v2 messages to verify the mapping
- **Documentation Review**: Verification that system documentation describes the correct mapping implementation

### Recommendation
This requirement should be:
1. Reclassified as an **attestation requirement** rather than a test requirement
2. Addressed through implementation documentation and vendor attestation
3. Potentially verified through manual inspection of HL7 v2 message outputs if such functionality exists in the testing environment

---

<a id='req-383'></a>

### REQ-383: The Immunization resource SHALL map the patient to PID-3 in HL7 v2.

**Text**: 

**Context**: HL7 v2 mapping for Immunization resource to HL7 v2 segments/fields.

**Actor**: Immunization resource

**Conformance**: SHALL

# Test Specification for REQ-383

## 1. Requirement ID
**REQ-383**: The Immunization resource SHALL map the patient to PID-3 in HL7 v2.

## 2. Requirement Analysis

### Testability Assessment
**Not Testable** - This requirement is too vague for direct automated testing. The requirement specifies a mapping between FHIR Immunization resource and HL7 v2 PID-3 field, but:
- It doesn't specify the implementation mechanism for this mapping
- It doesn't define what constitutes successful mapping verification
- The requirement appears to be documentation/mapping guidance rather than a testable functional requirement
- No specific FHIR operations or data validation criteria are implied

### Complexity
**Simple** - The conceptual mapping is straightforward (patient reference to patient identifier), but the requirement lacks testable implementation details.

### Prerequisites
- System supporting US Core Immunization Profile
- Understanding that PID-3 in HL7 v2 represents Patient ID/Patient Identifier List
- Knowledge that this is a mapping specification rather than a functional requirement

## 3. Test Implementation Strategy

### Required Inputs
Since this requirement is not directly testable through FHIR API interactions, no specific test inputs can be defined. The mapping would typically be:
- **FHIR Side**: `Immunization.patient` (reference to Patient resource)
- **HL7 v2 Side**: `PID-3` (Patient Identifier List)

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for Immunization:
- `GET [base]/Immunization/[id]` (read)
- `GET [base]/Immunization?patient=[patient-id]` (search by patient)

However, these operations cannot directly test the v2 mapping requirement.

### Validation Criteria
**No Direct Validation Possible** - This requirement cannot be validated through standard FHIR API testing because:

1. **Mapping Documentation**: This appears to be a specification for implementers on how to map between FHIR and HL7 v2 formats
2. **No Observable Behavior**: The mapping doesn't result in testable FHIR resource behavior
3. **Implementation Internal**: The actual mapping logic is internal to systems that perform FHIR-to-v2 transformations

### Alternative Verification Approach
If testing this requirement were necessary, it would require:
1. **Attestation-Based Testing**: Implementers would attest that their FHIR-to-v2 transformation maps `Immunization.patient` to `PID-3`
2. **Integration Testing**: Testing actual v2 message generation from FHIR resources (outside scope of FHIR API testing)
3. **Documentation Review**: Verification that implementation documentation correctly describes the mapping

### Recommendation
This requirement should be:
- Reclassified as implementation guidance or mapping documentation
- Moved to an attestation-based verification method
- Or refined to specify testable behavioral requirements if FHIR-to-v2 transformation functionality is required to be exposed via the API

---

<a id='req-384'></a>

### REQ-384: The Immunization resource SHALL map the encounter to PV1-19 in HL7 v2.

**Text**: 

**Context**: HL7 v2 mapping for Immunization resource to HL7 v2 segments/fields.

**Actor**: Immunization resource

**Conformance**: SHALL

# Test Specification for REQ-384

## 1. Requirement ID
REQ-384

## 2. Requirement Analysis

### Testability Assessment
**Not Testable** - This requirement is not directly testable through FHIR API operations because:
- The requirement specifies an HL7 v2 mapping (PV1-19 field) which is outside the scope of FHIR testing
- FHIR Implementation Guides and Capability Statements do not expose HL7 v2 mapping information through standard FHIR APIs
- The mapping from FHIR Immunization.encounter to HL7 v2 PV1-19 occurs during message transformation, which is an internal system process not observable through FHIR interactions

### Complexity
**Simple** - The requirement itself is straightforward (a field mapping specification), but it cannot be verified through FHIR API testing.

### Prerequisites
- System supporting US Core Immunization Profile
- System capable of HL7 v2 message generation (for actual mapping verification, which is out of scope for FHIR testing)

## 3. Test Implementation Strategy

### Required Inputs
This requirement cannot be tested through FHIR API operations as it pertains to HL7 v2 message mapping rather than FHIR resource validation or API behavior.

### Required FHIR Operations
None applicable - this requirement cannot be verified through FHIR operations.

### Validation Criteria
**This requirement requires attestation rather than automated testing** because:

1. **HL7 v2 Scope**: The requirement specifies mapping to HL7 v2 PV1-19, which is outside FHIR's domain
2. **Internal Process**: Message transformation from FHIR to HL7 v2 is an internal system process not exposed through FHIR APIs
3. **No Observable FHIR Behavior**: There are no FHIR API responses or resource structures that would indicate compliance with this mapping requirement

### Recommended Attestation Approach
Instead of automated testing, this requirement should be verified through:

1. **System Documentation Review**: Verify that the system's HL7 v2 mapping documentation specifies that `Immunization.encounter` maps to PV1-19
2. **Sample Message Analysis**: Review actual HL7 v2 messages generated by the system to confirm the mapping is implemented correctly
3. **Vendor Attestation**: Obtain written confirmation from the system vendor that the mapping is implemented as specified

### Alternative FHIR-Focused Testing
While the specific mapping cannot be tested via FHIR APIs, related FHIR conformance can be verified:

1. **Verify Immunization.encounter Support**: Confirm that the system supports the `encounter` element in Immunization resources
2. **Test Encounter Reference Validity**: Validate that encounter references in Immunization resources resolve to valid Encounter resources
3. **Profile Conformance**: Ensure Immunization resources conform to the US Core Immunization Profile

However, these tests would verify FHIR conformance but not the specific HL7 v2 mapping requirement.

---

<a id='req-385'></a>

### REQ-385: The Immunization resource SHALL map the occurrence[x] to RXA-3 in HL7 v2.

**Text**: 

**Context**: HL7 v2 mapping for Immunization resource to HL7 v2 segments/fields.

**Actor**: Immunization resource

**Conformance**: SHALL

# Test Specification for REQ-385

## 1. Requirement ID
REQ-385

## 2. Requirement Analysis

### Testability Assessment
**Not testable** - This requirement is covered by FHIR validator functionality. The mapping of FHIR Immunization.occurrence[x] to HL7 v2 RXA-3 is a structural mapping specification that is validated through profile conformance validation rather than runtime API testing.

### Complexity
**Simple** - The requirement specifies a direct field mapping between FHIR and HL7 v2 formats.

### Prerequisites
- System must support US Core Immunization Profile
- System must support Immunization resource operations as specified in the Capability Statement
- Test data must include Immunization resources with populated occurrence[x] elements

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Immunization resources conforming to US Core Immunization Profile
- **Expected Data Elements**: Immunization resources must contain occurrence[x] field (occurrenceDateTime or occurrenceString)
- **Test Data Requirements**: Various Immunization instances with different occurrence[x] value types

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for Immunization resources:
- `GET [base]/Immunization/[id]` (read operation - **SHALL** support)
- `GET [base]/Immunization?patient=[reference]` (search operation - **SHALL** support)
- Optional operations that **MAY** be supported: create, update, patch, delete, history-type

### Validation Criteria

Since this requirement is about structural mapping rather than API behavior, the primary validation approach should be:

1. **Profile Conformance Validation**:
   - Validate that Immunization resources conform to US Core Immunization Profile
   - Verify that occurrence[x] elements are present and properly structured
   - Confirm that the occurrence[x] field uses appropriate data types (dateTime, Period, string, etc.)

2. **Structural Mapping Verification** (if implementing HL7 v2 conversion):
   - If the system provides HL7 v2 conversion capabilities, verify that Immunization.occurrence[x] values are correctly mapped to RXA-3 segment field
   - Validate that the conversion maintains data integrity and appropriate formatting

3. **Data Presence Verification**:
   - Assert that retrieved Immunization resources contain occurrence[x] elements
   - Verify that occurrence[x] values are properly formatted according to FHIR specifications

### Test Execution Steps

1. **Retrieve Immunization Resources**:
   ```
   GET [base]/Immunization?patient=[patient-id]
   ```

2. **Validate Profile Conformance**:
   - Run FHIR validator against retrieved Immunization resources
   - Verify compliance with US Core Immunization Profile

3. **Verify occurrence[x] Elements**:
   - Assert that each Immunization resource contains occurrence[x] field
   - Validate that occurrence[x] uses appropriate FHIR data types
   - Confirm that values are properly structured and formatted

4. **HL7 v2 Mapping Validation** (if applicable):
   - If system supports HL7 v2 conversion, request conversion of Immunization resources
   - Verify that occurrence[x] values appear correctly in RXA-3 field of converted messages
   - Validate that data format conversion is appropriate (e.g., FHIR dateTime to HL7 v2 timestamp format)

### Success Criteria
- All Immunization resources conform to US Core Immunization Profile
- occurrence[x] elements are present and properly formatted in all Immunization resources
- If HL7 v2 conversion is supported, occurrence[x] values are correctly mapped to RXA-3 fields
- No validation errors when processing Immunization resources through FHIR validators

### Notes
This requirement is primarily validated through structural conformance rather than functional API testing. The actual mapping logic would be tested through profile validation and, if applicable, through testing any HL7 v2 conversion functionality that the system provides.

---

<a id='req-386'></a>

### REQ-386: The Immunization resource SHALL map the primarySource to RXA-9 in HL7 v2.

**Text**: 

**Context**: HL7 v2 mapping for Immunization resource to HL7 v2 segments/fields.

**Actor**: Immunization resource

**Conformance**: SHALL

# Test Specification for REQ-386

## 1. Requirement ID
REQ-386

## 2. Requirement Analysis

### Testability Assessment
**Not testable** - This requirement specifies an HL7 v2 mapping rule that is outside the scope of FHIR interoperability testing. The requirement defines how FHIR Immunization.primarySource should map to RXA-9 in HL7 v2 messages, but:
- FHIR interoperability testing focuses on FHIR resource validation and RESTful API interactions
- HL7 v2 mapping is an implementation detail for systems that need to transform between FHIR and HL7 v2 formats
- The mapping itself cannot be verified through FHIR API operations
- This is a structural mapping specification, not a behavioral requirement

### Complexity
**Not Applicable** - The requirement is not testable within the FHIR interoperability testing framework.

### Prerequisites
**Not Applicable** - No FHIR-specific prerequisites since this is a mapping specification.

## 3. Test Implementation Strategy

### Required Inputs
**Not Applicable** - This requirement cannot be tested through FHIR interoperability testing.

### Required FHIR Operations
**None** - No FHIR operations are needed as this is a mapping specification rather than a behavioral requirement.

### Validation Criteria
**Not Applicable** - The mapping rule cannot be validated through FHIR API interactions.

## Alternative Testing Approach

While this specific requirement cannot be tested through FHIR interoperability testing, implementers who need to verify HL7 v2 mapping compliance should consider:

1. **Unit Testing**: Create unit tests within their transformation engines that verify:
   - FHIR Immunization.primarySource values are correctly mapped to HL7 v2 RXA-9 field
   - Data type conversions are handled appropriately
   - Null/missing value handling follows HL7 v2 conventions

2. **Integration Testing**: Test complete message transformation workflows that include:
   - FHIR Immunization resource input
   - HL7 v2 VXU message output
   - Verification that RXA-9 contains the expected primarySource value

3. **Documentation Review**: Ensure implementation documentation clearly describes the mapping relationship between FHIR Immunization.primarySource and HL7 v2 RXA-9.

## Recommendation

This requirement should be classified as an **implementation guidance** rather than a testable conformance requirement for FHIR interoperability testing. Consider documenting this as a mapping specification that implementers must follow when transforming between FHIR and HL7 v2 formats, but verify FHIR conformance through standard FHIR resource validation and API testing instead.

---

<a id='req-387'></a>

### REQ-387: The Immunization resource SHALL map the reportOrigin to RXA-9 in HL7 v2.

**Text**: 

**Context**: HL7 v2 mapping for Immunization resource to HL7 v2 segments/fields.

**Actor**: Immunization resource

**Conformance**: SHALL

# Test Specification for REQ-387

## 1. Requirement ID
REQ-387

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Not testable due to being too vague

**Rationale**: This requirement specifies a mapping between FHIR Immunization.reportOrigin and HL7 v2 RXA-9, but it lacks sufficient detail to create a concrete test specification:
- The requirement doesn't specify the direction of mapping (FHIR to v2, v2 to FHIR, or bidirectional)
- No implementation context is provided (transformation engine, interface, etc.)
- The mapping logic and value transformations are not defined
- There's no specification of when this mapping should occur or what system components are responsible

### Complexity
**Classification**: Complex (if it were testable)

The requirement would involve cross-standard mapping validation, potentially requiring:
- Understanding of both FHIR and HL7 v2 data structures
- Validation of semantic equivalence between different coding systems
- Testing of transformation logic accuracy

### Prerequisites
If this requirement were testable, it would require:
- Access to a system that performs FHIR ↔ HL7 v2 transformations
- Immunization resources with populated `reportOrigin` elements
- Corresponding HL7 v2 messages with RXA segments
- Clear specification of the mapping rules and transformation logic

## 3. Test Implementation Strategy

### Required Inputs
**Cannot be determined** - The requirement lacks sufficient specification to define:
- Input data formats and structures
- Expected transformation behavior
- Validation criteria for mapping accuracy

### Required FHIR Operations
**Cannot be determined** - The requirement doesn't specify:
- Whether this involves FHIR API operations or data transformation
- What system interfaces need to be tested
- How the mapping is implemented or exposed

### Validation Criteria
**Cannot be established** - The requirement needs clarification on:
- What constitutes a correct mapping
- How to verify the RXA-9 field population
- Success/failure criteria for the mapping process

## Recommendation

This requirement should be enhanced with:

1. **Clear Direction**: Specify whether this is FHIR→v2, v2→FHIR, or bidirectional mapping
2. **Implementation Context**: Define what system components perform this mapping
3. **Mapping Rules**: Provide detailed transformation logic and value mappings
4. **Testable Interface**: Specify how the mapping can be tested (API endpoints, file transformation, etc.)
5. **Success Criteria**: Define what constitutes successful mapping validation

Without these details, this requirement cannot be effectively tested for conformance.

---

<a id='req-388'></a>

### REQ-388: The Immunization resource SHALL map the location to RXA-27 or RXA-11 in HL7 v2.

**Text**: 

**Context**: HL7 v2 mapping for Immunization resource to HL7 v2 segments/fields.

**Actor**: Immunization resource

**Conformance**: SHALL

# Test Specification for REQ-388

## 1. Requirement ID
REQ-388

## 2. Requirement Analysis

### Testability Assessment
**Not testable** - This requirement is not testable through FHIR API interactions because:
- It specifies HL7 v2 mapping requirements for RXA-27 or RXA-11 fields, which are HL7 v2 message segments
- FHIR API testing cannot directly verify HL7 v2 message mappings
- The requirement relates to data transformation/mapping logic that occurs outside the FHIR API layer
- There is no way to verify through FHIR REST operations that the `Immunization.location` element correctly maps to specific HL7 v2 fields

### Complexity
**Not Applicable** - Since this requirement is not testable through FHIR API interactions, complexity assessment is not relevant.

### Prerequisites
**Not Applicable** - No FHIR API testing prerequisites can be defined for this requirement.

## 3. Test Implementation Strategy

### Required Inputs
**Not Applicable** - This requirement cannot be tested through FHIR API operations.

### Required FHIR Operations
**None** - No FHIR operations can verify HL7 v2 mapping compliance.

### Validation Criteria
**Not Applicable** - No API-based validation criteria can be established.

## Alternative Testing Approach

Since this requirement cannot be tested through FHIR API interactions, alternative approaches would include:

1. **Documentation Review**: Verify that implementation documentation describes how `Immunization.location` maps to RXA-27 or RXA-11
2. **HL7 v2 Message Analysis**: Examine actual HL7 v2 messages generated by the system to verify correct field mapping
3. **Implementation Attestation**: Request implementer confirmation that the mapping is correctly implemented
4. **Integration Testing**: Test the complete FHIR-to-HL7v2 transformation process in a controlled environment

**Recommendation**: This requirement should be classified as requiring implementer attestation or documentation review rather than automated API testing, as it pertains to data mapping logic that is not directly observable through FHIR REST API interactions.

---

<a id='req-389'></a>

### REQ-389: The Immunization resource SHALL map the manufacturer to RXA-17 in HL7 v2.

**Text**: 

**Context**: HL7 v2 mapping for Immunization resource to HL7 v2 segments/fields.

**Actor**: Immunization resource

**Conformance**: SHALL

# Test Specification for REQ-389

## 1. Requirement ID
REQ-389

## 2. Requirement Analysis

### Testability Assessment
**Not testable** - This requirement specifies an HL7 v2 mapping for the Immunization resource manufacturer field to RXA-17, which is outside the scope of FHIR interoperability testing. This is a mapping specification for systems that need to transform FHIR data to HL7 v2 format, but cannot be validated through standard FHIR API interactions.

### Complexity
**Simple** - The requirement is straightforward in its intent (mapping manufacturer to RXA-17) but cannot be tested via FHIR operations.

### Prerequisites
- System supporting US Core Immunization Profile
- System with HL7 v2 transformation capabilities (for actual implementation, but not testable via FHIR APIs)
- Test data containing Immunization resources with manufacturer information

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Immunization resources conforming to the US Core Immunization Profile
- **Data Requirements**: Immunizations with populated `manufacturer` field (either as Reference or Organization)
- **System Capability**: Read access to Immunization resources

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for Immunization resources:
- `GET [base]/Immunization/[id]` - Read individual Immunization resources
- `GET [base]/Immunization?patient=[id]` - Search Immunizations by patient
- `GET [base]/Immunization?patient=[id]&status=[status]` - Search with status filter
- `GET [base]/Immunization?patient=[id]&date=[date]` - Search with date filter

### Validation Criteria

**Primary Validation:**
This requirement cannot be directly validated through FHIR API testing as it pertains to HL7 v2 mapping behavior that occurs outside of FHIR interactions.

**Alternative Validation Approach:**
Since this requirement cannot be tested via FHIR APIs, the following approach would be recommended:

1. **Documentation Review**: Verify that system documentation explicitly states support for mapping Immunization.manufacturer to HL7 v2 RXA-17 field

2. **Attestation**: System implementers would need to provide attestation that:
   - The system correctly maps FHIR Immunization.manufacturer to HL7 v2 RXA-17 when performing FHIR-to-v2 transformations
   - The mapping preserves manufacturer information integrity during transformation

3. **Indirect FHIR Validation** (if applicable):
   - Retrieve Immunization resources using supported search operations
   - Verify that manufacturer information is present and properly structured in FHIR format
   - Confirm manufacturer data follows US Core Immunization Profile constraints

**Test Assertions for FHIR Data Quality:**
- Immunization resources SHALL contain manufacturer information when available
- Manufacturer information SHALL be represented as either:
  - Reference to Organization resource
  - Organization resource (contained or external)
- Retrieved Immunization resources SHALL conform to US Core Immunization Profile

**Note**: The actual validation of the HL7 v2 mapping (FHIR Immunization.manufacturer → HL7 v2 RXA-17) would require:
- HL7 v2 message generation capabilities
- Comparison between source FHIR data and resulting v2 message
- Verification that RXA-17 field contains the correct manufacturer information

This type of validation falls outside the scope of FHIR API conformance testing and would require specialized testing tools capable of examining HL7 v2 message output.

---

<a id='req-390'></a>

### REQ-390: The Immunization resource SHALL map the lotNumber to RXA-15 in HL7 v2.

**Text**: 

**Context**: HL7 v2 mapping for Immunization resource to HL7 v2 segments/fields.

**Actor**: Immunization resource

**Conformance**: SHALL

# Test Specification for REQ-390

## 1. Requirement ID
REQ-390

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated testing by examining FHIR Immunization resources and validating that the `lotNumber` element maps correctly to HL7 v2 RXA-15 field during transformation or conversion processes.

### Complexity
**Moderate** - The test requires:
- Understanding of both FHIR and HL7 v2 message formats
- Validation of field mapping accuracy between different standards
- Potential need for transformation/conversion functionality

### Prerequisites
- System must support US Core Immunization Profile
- System must have capability to demonstrate HL7 v2 mapping functionality (either through actual v2 message generation or documented mapping specifications)
- Test data should include Immunization resources with populated `lotNumber` elements
- Access to HL7 v2 mapping functionality or transformation capabilities

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Immunization resources conforming to US Core Immunization Profile
- Resources must include populated `Immunization.lotNumber` elements with various valid lot number values
- Resources should represent realistic immunization scenarios with different vaccine types and lot numbers

**Expected Outputs:**
- HL7 v2 RXA segments with RXA-15 field populated with corresponding lot numbers
- Mapping documentation or transformation results showing the field correspondence
- Validation that no data is lost or corrupted during the mapping process

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required:

1. **GET [base]/Immunization/[id]** - Retrieve specific Immunization resources for testing
2. **GET [base]/Immunization?patient=[patient-id]** - Search for patient's immunizations to gather test data
3. **GET [base]/Immunization?patient=[patient-id]&status=[status]** - Filter immunizations by status if needed
4. **GET [base]/Immunization?patient=[patient-id]&date=[date]** - Filter by date if temporal testing is required

### Validation Criteria

**Primary Assertions:**
1. **Field Presence Validation:**
   - Verify that every FHIR `Immunization.lotNumber` value has a corresponding entry in HL7 v2 RXA-15 field
   - Confirm that RXA-15 is populated when `lotNumber` exists in the source FHIR resource

2. **Data Integrity Validation:**
   - Validate that the lot number value in RXA-15 exactly matches the `Immunization.lotNumber` value
   - Ensure no truncation, modification, or formatting changes occur during mapping
   - Verify character encoding and special character handling is preserved

3. **Mapping Completeness:**
   - Test with multiple Immunization resources containing different lot number formats (alphanumeric, numeric, with special characters)
   - Verify mapping works consistently across different vaccine types and manufacturers
   - Confirm that empty or missing `lotNumber` elements result in appropriately empty RXA-15 fields

4. **Conformance Validation:**
   - Ensure the mapping process maintains compliance with both US Core Immunization Profile requirements and HL7 v2 RXA segment specifications
   - Verify that other required fields in the RXA segment remain unaffected by the lot number mapping

**Test Scenarios:**
1. **Standard Lot Numbers:** Test with typical alphanumeric lot numbers (e.g., "ABC123", "LOT001")
2. **Special Characters:** Test with lot numbers containing hyphens, spaces, or other valid characters
3. **Edge Cases:** Test with maximum length lot numbers and minimum length values
4. **Multiple Immunizations:** Test patient records with multiple immunizations to ensure consistent mapping across all records

**Success Criteria:**
- 100% accuracy in lot number field mapping from FHIR to HL7 v2
- No data loss or corruption during transformation
- Consistent mapping behavior across all test scenarios
- Proper handling of edge cases and special characters
- Compliance with both FHIR and HL7 v2 specifications

---

<a id='req-391'></a>

### REQ-391: The Immunization resource SHALL map the expirationDate to RXA-16 in HL7 v2.

**Text**: 

**Context**: HL7 v2 mapping for Immunization resource to HL7 v2 segments/fields.

**Actor**: Immunization resource

**Conformance**: SHALL

# Test Specification for REQ-391

## 1. Requirement ID
REQ-391

## 2. Requirement Analysis

### Testability Assessment
**Not testable** - This requirement is not automatically testable because:
- It specifies a mapping between FHIR and HL7 v2, but the capability statement only defines FHIR REST API interactions
- The capability statement shows no support for HL7 v2 operations or transformations
- Testing this would require access to both FHIR and HL7 v2 systems with transformation capabilities
- This appears to be an implementation guidance requirement rather than an interoperability requirement

### Complexity
**Not Applicable** - Cannot be tested given current capability statement scope

### Prerequisites
**Not Applicable** - No testable implementation path available

## 3. Test Implementation Strategy

### Assessment
This requirement cannot be implemented as a conformance test because:

1. **Scope Mismatch**: The requirement addresses HL7 v2 mapping (RXA-16 field), but the provided capability statement only defines FHIR REST API capabilities for US Core Server interactions.

2. **Missing Capability**: The capability statement for the US Core Immunization resource (Section 14.3.3.14) only specifies:
   - REST operations: `search-type`, `read`, `vread`, `history-instance`
   - Search parameters: `patient`, `status`, `date`
   - No HL7 v2 transformation or mapping operations are defined

3. **Implementation vs. Interoperability**: This requirement appears to be implementation guidance for systems that need to transform FHIR Immunization resources to HL7 v2 format, rather than a FHIR API interoperability requirement.

### Recommendation
To make this requirement testable, one of the following would be needed:

1. **Capability Statement Update**: Add support for HL7 v2 transformation operations or custom operations that expose the mapping
2. **Requirement Clarification**: Reframe as a FHIR-only requirement that can be tested through standard REST operations
3. **Implementation Guide**: Move this to implementation guidance rather than a testable conformance requirement

### Alternative Testing Approach
If this requirement must be tested, it would need to be restructured as an **attestation requirement** where implementers would need to demonstrate their HL7 v2 mapping capabilities outside of the standard FHIR conformance testing framework.

---

<a id='req-392'></a>

### REQ-392: The Immunization resource SHALL map the site to RXR-2 in HL7 v2.

**Text**: 

**Context**: HL7 v2 mapping for Immunization resource to HL7 v2 segments/fields.

**Actor**: Immunization resource

**Conformance**: SHALL

# Test Specification for REQ-392

## 1. Requirement ID
REQ-392

## 2. Requirement Analysis

### Testability Assessment
**Not testable** - This requirement is too vague and lacks sufficient specificity for automated testing. The requirement states that "The Immunization resource SHALL map the site to RXR-2 in HL7 v2" but provides no context about:
- When this mapping should occur
- What system or component performs the mapping
- What the expected mapping values should be
- Whether this is about inbound v2 messages being converted to FHIR, outbound FHIR being converted to v2, or both directions

### Complexity
**Not Applicable** - Cannot be assessed due to vague requirement specification

### Prerequisites
**Not Applicable** - Cannot be determined due to insufficient requirement detail

## 3. Test Implementation Strategy

### Required Inputs
**Cannot be determined** - The requirement lacks sufficient detail to specify test inputs

### Required FHIR Operations
**Cannot be determined** - The requirement does not specify any FHIR API operations

### Validation Criteria
**Cannot be established** - The requirement provides no measurable validation criteria

## Recommendation

This requirement needs significant clarification before it can be tested. The requirement should specify:

1. **Direction of mapping**: Is this for FHIR-to-v2 conversion, v2-to-FHIR conversion, or both?
2. **Scope**: Which systems or components must perform this mapping?
3. **Context**: When should this mapping occur (e.g., during message transformation, API responses, etc.)?
4. **Validation criteria**: What constitutes correct mapping behavior?
5. **Expected mapping values**: What are the valid mappings between Immunization.site and RXR-2?

Without these clarifications, this requirement should be classified as an **attestation** where implementers must document their mapping approach rather than being subject to automated testing.

Additionally, this requirement appears to be about implementation-specific mapping logic rather than FHIR API conformance, which may fall outside the scope of typical FHIR Implementation Guide testing focused on REST API interactions and resource validation.

---

<a id='req-393'></a>

### REQ-393: The Immunization resource SHALL map the route to RXR-1 in HL7 v2.

**Text**: 

**Context**: HL7 v2 mapping for Immunization resource to HL7 v2 segments/fields.

**Actor**: Immunization resource

**Conformance**: SHALL

# Test Specification for REQ-393

## 1. Requirement ID
**REQ-393**: The Immunization resource SHALL map the route to RXR-1 in HL7 v2.

## 2. Requirement Analysis

### Testability Assessment
**Not testable** - This requirement is too vague and lacks specific implementation details. The requirement states that the Immunization resource should map the route to RXR-1 in HL7 v2, but it doesn't specify:
- Which element in the Immunization resource should contain the route information
- What format or coding system should be used for the route values
- How the mapping should be validated or verified
- Whether this is about data transformation, storage, or display

### Complexity
**Not Applicable** - Due to insufficient specification details

### Prerequisites
**Cannot be determined** - The requirement lacks the specificity needed to identify prerequisites

## 3. Test Implementation Strategy

### Required Inputs
**Cannot be specified** - The requirement doesn't provide enough detail about:
- Which FHIR Immunization elements are involved in the mapping
- What the expected HL7 v2 RXR-1 format should contain
- How to validate the mapping relationship

### Required FHIR Operations
**Cannot be determined** - While the Capability Statement shows that Immunization resources support:
- `GET [base]/Immunization/[id]` (read operation)
- Search operations with patient parameter

The requirement doesn't specify which operations would be needed to test the HL7 v2 mapping functionality.

### Validation Criteria
**Cannot be established** - Without knowing:
- The specific FHIR elements involved
- The expected HL7 v2 output format
- The mapping rules or transformation logic

It's impossible to define meaningful validation criteria.

## Recommendation

This requirement needs significant clarification before it can be tested. The following information should be provided:

1. **Source Element**: Specify which Immunization resource element(s) contain the route information (e.g., `Immunization.route`)
2. **Mapping Rules**: Define how FHIR route values should be transformed to HL7 v2 RXR-1 format
3. **Validation Method**: Specify how the mapping can be tested (e.g., through an API endpoint, configuration setting, or data transformation service)
4. **Expected Values**: Provide examples of valid route mappings between FHIR and HL7 v2 formats

Until these details are provided, this requirement cannot be effectively tested for conformance.

---

<a id='req-394'></a>

### REQ-394: The Immunization resource SHALL map the doseQuantity to RXA-6 or RXA-7 in HL7 v2.

**Text**: 

**Context**: HL7 v2 mapping for Immunization resource to HL7 v2 segments/fields.

**Actor**: Immunization resource

**Conformance**: SHALL

# Test Specification for REQ-394

## 1. Requirement ID
REQ-394

## 2. Requirement Analysis

### Testability Assessment
**Not Testable** - This requirement is not suitable for automated testing because:
- It specifies a mapping between FHIR and HL7 v2 message formats, which is an implementation detail
- The requirement focuses on data transformation/mapping rather than FHIR API behavior
- Testing would require access to the system's internal HL7 v2 message generation logic, which is not exposed through FHIR APIs
- The Capability Statement shows support for Immunization resources via FHIR operations, but does not indicate any HL7 v2 message generation capabilities

### Complexity
**Not Applicable** - Since this requirement cannot be tested through FHIR API interactions

### Prerequisites
**Not Applicable** - No testable implementation possible

## 3. Test Implementation Strategy

### Required Inputs
**Not Applicable** - This requirement cannot be tested through standard FHIR conformance testing approaches.

### Required FHIR Operations
**Not Applicable** - While the Capability Statement supports:
- `GET [base]/Immunization/[id]` (read)
- `GET [base]/Immunization?[parameter=value]` (search-type)

These operations only validate FHIR resource structure and API compliance, not HL7 v2 mapping behavior.

### Validation Criteria
**Not Applicable** - The mapping from `Immunization.doseQuantity` to RXA-6 or RXA-7 segments occurs during HL7 v2 message generation, which is:
1. An internal system process not exposed via FHIR APIs
2. Implementation-specific and may vary between systems
3. Not verifiable without access to the generated HL7 v2 messages

### Recommendation
This requirement should be:
- **Marked as an attestation requirement** where implementers confirm compliance through documentation
- **Validated through integration testing** with actual HL7 v2 message exchanges
- **Verified through manual inspection** of generated HL7 v2 RXA segments when Immunization resources are processed

The FHIR conformance testing should focus on ensuring Immunization resources are properly structured and accessible via the supported FHIR operations, while the HL7 v2 mapping verification requires separate testing methodologies outside the scope of FHIR API conformance.

---

<a id='req-395'></a>

### REQ-395: The Immunization resource SHALL map the performer to ORC-12 or RXA-10 in HL7 v2.

**Text**: 

**Context**: HL7 v2 mapping for Immunization resource to HL7 v2 segments/fields.

**Actor**: Immunization resource

**Conformance**: SHALL

# Test Specification for REQ-395

## 1. Requirement ID
REQ-395

## 2. Requirement Analysis

### Testability Assessment
**Not testable** - This requirement specifies HL7 v2 mapping instructions rather than FHIR conformance behavior. The requirement defines how FHIR Immunization.performer should map to HL7 v2 fields (ORC-12 or RXA-10) during transformation between standards, which is an implementation detail that occurs outside the FHIR API layer and cannot be verified through FHIR conformance testing.

### Complexity
**Not Applicable** - The requirement is not testable through FHIR API interactions.

### Prerequisites
**Not Applicable** - No FHIR-specific prerequisites as this is a mapping specification.

## 3. Test Implementation Strategy

### Required Inputs
**Not Applicable** - This requirement cannot be tested through FHIR API interactions as it specifies cross-standard mapping behavior.

### Required FHIR Operations
**None** - The requirement does not involve FHIR API operations but rather describes how data should be transformed when converting between FHIR and HL7 v2 standards.

### Validation Criteria
**Not Applicable** - This requirement describes implementation guidance for systems that perform FHIR-to-HL7v2 transformations, which is outside the scope of FHIR conformance testing.

## Additional Notes

This requirement is part of mapping documentation that guides implementers on how to transform FHIR Immunization resources to HL7 v2 messages. Such mappings are:

1. **Implementation-specific**: Different systems may implement the transformation logic differently
2. **External to FHIR**: The mapping occurs during data transformation, not during FHIR API interactions
3. **Not verifiable via FHIR API**: There is no way to test this mapping through standard FHIR REST operations

While the US Core Server Capability Statement indicates support for the Immunization resource (Section 14.3.3.14), this support relates to FHIR API operations (search, read, etc.) rather than HL7 v2 mapping capabilities.

For conformance testing purposes, the focus should be on verifying that:
- Immunization resources conform to the US Core Immunization Profile
- Required search parameters and operations are supported
- The Immunization.performer element is properly populated according to the US Core profile requirements

The HL7 v2 mapping aspect should be documented as implementation guidance rather than included in automated conformance test suites.

---

<a id='req-396'></a>

### REQ-396: The Immunization resource SHALL map the note to OBX-5 where OBX-3 equals 48767-8 in HL7 v2.

**Text**: 

**Context**: HL7 v2 mapping for Immunization resource to HL7 v2 segments/fields.

**Actor**: Immunization resource

**Conformance**: SHALL

# Test Specification for REQ-396

## 1. Requirement ID
REQ-396

## 2. Requirement Analysis

### Testability Assessment
**Not Testable** - This requirement is not directly testable through FHIR API interactions as it specifies HL7 v2 mapping behavior rather than FHIR resource conformance. The requirement defines how FHIR Immunization resource notes should be mapped to HL7 v2 OBX segments during message transformation, which is an implementation-specific transformation process that occurs outside of FHIR API operations.

### Complexity
**Simple** - The requirement has a clear mapping specification (note → OBX-5 where OBX-3 equals 48767-8), but testing it requires access to the HL7 v2 transformation process.

### Prerequisites
- System capable of transforming FHIR Immunization resources to HL7 v2 messages
- Access to generated HL7 v2 messages or transformation logs
- Immunization resources containing note elements
- Understanding of HL7 v2 OBX segment structure

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: 
  - US Core Immunization Profile instances containing the `note` element with various text content
  - Test data should include immunizations with different types of notes (administration notes, patient reactions, provider comments)

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for Immunization resources:
- `GET [base]/Immunization/[id]` (SHALL support read)
- `GET [base]/Immunization?patient=[patient-id]` (SHALL support search by patient)

**Note**: The actual requirement testing requires access to HL7 v2 transformation capabilities, which are not exposed through standard FHIR API operations.

### Validation Criteria

Since this requirement cannot be directly tested through FHIR API conformance testing, the following approaches would be needed:

#### Alternative Testing Approaches:
1. **Integration Testing**: 
   - Verify that systems producing HL7 v2 messages from FHIR Immunization resources correctly map `Immunization.note` to `OBX-5` with `OBX-3 = 48767-8`

2. **Attestation-Based Testing**:
   - System implementers provide documentation or attestation that their HL7 v2 transformation process correctly implements this mapping

3. **Transformation Validation**:
   - If transformation services are available, test with sample Immunization resources containing notes and verify the resulting HL7 v2 messages contain appropriate OBX segments

#### Expected Results for Conformance:
- Each `Immunization.note.text` value should appear in an OBX-5 field
- The corresponding OBX-3 field should contain the value "48767-8"
- The mapping should preserve the semantic meaning and text content of the original FHIR note

### Recommendation
This requirement should be classified as requiring **attestation** rather than automated API testing, as it involves inter-standard transformation behavior that cannot be verified through standard FHIR conformance testing approaches. The requirement would be better tested through:
- Implementation documentation review
- Manual verification of transformation outputs
- Integration testing with HL7 v2 message validation tools

---

<a id='req-397'></a>

### REQ-397: The Immunization resource SHALL map isSubpotent to RXA-20 with value PA for partial administration in HL7 v2.

**Text**: 

**Context**: HL7 v2 mapping for Immunization resource to HL7 v2 segments/fields.

**Actor**: Immunization resource

**Conformance**: SHALL

# Test Specification for REQ-397

## Requirement ID
REQ-397

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement specifies a concrete mapping between FHIR Immunization resource elements and HL7 v2 fields that can be verified through automated testing.

### Complexity
**Simple** - The requirement involves a straightforward field mapping validation between two specific data elements.

### Prerequisites
- System must support US Core Immunization Profile
- System must support HL7 v2 message generation/transformation capabilities
- Test data must include Immunization resources with `isSubpotent` element populated
- System must be capable of mapping FHIR resources to HL7 v2 RXA segments

## Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Immunization resources conforming to US Core Immunization Profile with:
  - `Immunization.isSubpotent` element present and set to `true` (indicating partial administration)
  - All other required elements per US Core Immunization Profile (patient reference, status, vaccineCode, occurrenceDateTime, etc.)

### Expected Outputs
- HL7 v2 message containing RXA segment with:
  - RXA-20 (Substance/Treatment Refusal Reason) populated with value "PA" when corresponding FHIR Immunization has `isSubpotent = true`

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for Immunization resources:
- `GET [base]/Immunization/[id]` - Read specific Immunization resource
- `GET [base]/Immunization?patient=[patient-id]` - Search Immunization resources by patient
- HL7 v2 transformation/mapping operation (implementation-specific)

### Validation Criteria

#### Test Case 1: isSubpotent True Mapping
**Preconditions:**
- Immunization resource exists with `isSubpotent = true`

**Test Steps:**
1. Retrieve Immunization resource via FHIR API
2. Verify `Immunization.isSubpotent` is present and equals `true`
3. Trigger HL7 v2 transformation/mapping process
4. Examine resulting HL7 v2 message RXA segment

**Pass Criteria:**
- RXA-20 field contains value "PA"
- All other required RXA segment fields are properly populated
- HL7 v2 message structure is valid

#### Test Case 2: isSubpotent False or Absent Mapping
**Preconditions:**
- Immunization resource exists with `isSubpotent = false` OR `isSubpotent` element is absent

**Test Steps:**
1. Retrieve Immunization resource via FHIR API
2. Verify `Immunization.isSubpotent` is either `false` or not present
3. Trigger HL7 v2 transformation/mapping process
4. Examine resulting HL7 v2 message RXA segment

**Pass Criteria:**
- RXA-20 field does NOT contain value "PA" (may be empty or contain other appropriate values)
- All other required RXA segment fields are properly populated
- HL7 v2 message structure is valid

#### Test Case 3: Multiple Immunizations Mixed Scenarios
**Preconditions:**
- Multiple Immunization resources exist for the same patient with varying `isSubpotent` values

**Test Steps:**
1. Retrieve multiple Immunization resources for a patient
2. Process each through HL7 v2 transformation
3. Verify mapping consistency across all resources

**Pass Criteria:**
- Each Immunization with `isSubpotent = true` maps to RXA-20 = "PA"
- Each Immunization with `isSubpotent = false` or absent does NOT map to RXA-20 = "PA"
- Mapping is consistent and deterministic across all resources

#### Failure Conditions
- `isSubpotent = true` but RXA-20 ≠ "PA"
- `isSubpotent = false` but RXA-20 = "PA"
- `isSubpotent` absent but RXA-20 = "PA"
- HL7 v2 message structure is invalid
- RXA segment is missing or malformed

---

<a id='req-464'></a>

### REQ-464: US Core Immunization Profile implementation

**Text**: 

**Context**: System conformance to US Core Immunization Profile.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-464

## 1. Requirement ID
**REQ-464**: US Core Immunization Profile implementation

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated through automated testing by verifying that Immunization resources returned by the system conform to the US Core Immunization Profile structure, constraints, and Must Support requirements.

### Complexity
**Moderate** - The test involves validating profile conformance including data elements, cardinalities, terminology bindings, and Must Support requirements, but follows established patterns for US Core profile testing.

### Prerequisites
- System must implement US Core Server capabilities as defined in the US Core Server CapabilityStatement
- System must have Immunization data available for testing
- System must support JSON format (required by US Core Server CapabilityStatement)
- System must implement appropriate security controls (authentication/authorization)
- FHIR R4 validator with US Core Implementation Guide loaded

## 3. Test Implementation Strategy

### Required Inputs
- **Test Data**: Any existing Immunization resources in the system under test
- **Patient Context**: Valid Patient resources that have associated immunization records
- **Authentication**: Valid credentials/tokens as required by the system's security implementation
- **US Core IG Version**: US Core v8.0.0 Implementation Guide for validation

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are supported and should be tested:

1. **GET /Immunization/[id]** - Read individual Immunization resources
2. **GET /Immunization?patient=[reference]** - Search for Immunization resources by patient
3. **GET /Patient/[id]** - Read Patient resources (prerequisite for Immunization context)

### Validation Criteria

#### Profile Conformance Validation
- **Profile Declaration**: Verify that returned Immunization resources declare conformance to `http://hl7.org/fhir/us/core/StructureDefinition/us-core-immunization` in the `meta.profile` element (SHOULD requirement from CapabilityStatement)
- **Structure Validation**: Validate all Immunization resources against the US Core Immunization Profile using the FHIR validator
- **No Validation Errors**: Resources must pass validation without errors (warnings may be acceptable)

#### Must Support Element Validation
Verify that the system properly supports all Must Support elements as defined in the US Core Immunization Profile:
- **Status Verification**: Confirm `status` element is present and contains valid values
- **Vaccine Code Validation**: Verify `vaccineCode` is present with appropriate terminology bindings
- **Patient Reference**: Confirm `patient` reference is present and valid
- **Occurrence Information**: Verify occurrence date/time information is present as required
- **Primary Source**: Validate `primarySource` element presence and values

#### Data Type and Cardinality Compliance
- **Required Elements**: Verify all elements marked as required (cardinality 1..* or 1..1) are present
- **Data Type Conformance**: Validate that all elements conform to their specified FHIR data types
- **Terminology Binding**: Verify coded elements use appropriate value sets as specified in the profile

#### Response Format Validation
- **JSON Support**: Verify system returns valid JSON format (required by CapabilityStatement)
- **HTTP Status Codes**: Confirm appropriate HTTP status codes are returned:
  - 200 OK for successful requests
  - 404 Not Found for non-existent resources
  - 401/403 for authentication/authorization failures
  - 400 for invalid parameters

#### Search Parameter Compliance
For systems that support search operations:
- **Patient Search**: Verify `GET /Immunization?patient=[reference]` returns Immunization resources associated with the specified patient
- **Search Result Validation**: Ensure all returned resources in search results conform to the US Core Immunization Profile
- **Bundle Structure**: Verify search results are returned in properly formatted FHIR Bundle resources

#### Error Handling Validation
- **Invalid Resource IDs**: Verify system returns appropriate 404 status for non-existent Immunization resources
- **Unauthorized Access**: Confirm system properly handles authentication/authorization per security requirements
- **Malformed Requests**: Verify appropriate 400 status codes for invalid requests

#### Integration with Referenced Resources
- **Patient Resource Conformance**: Verify referenced Patient resources conform to US Core Patient Profile (part of Must Support resource references)
- **Reference Integrity**: Confirm all resource references are valid and resolvable within the system's context

### Success Criteria
A test passes when:
1. All retrieved Immunization resources validate successfully against the US Core Immunization Profile
2. All Must Support elements are properly implemented and populated where data exists
3. Appropriate HTTP status codes are returned for all test scenarios
4. JSON format is properly supported
5. Referenced resources (particularly Patient) conform to their respective US Core profiles
6. System demonstrates proper error handling for invalid requests
7. Security requirements are properly implemented and enforced

The test should be designed to work with any existing Immunization data in the system, focusing on profile conformance rather than specific data values, supporting the "bring your own data" approach for interoperability testing.

---

<a id='req-516'></a>

### REQ-516: US Core Client SHALL fetch Immunization resources.

**Text**: 

**Context**: US Core Client read interaction for Immunization by id

**Actor**: US Core Client

**Conformance**: SHALL

# Test Specification for REQ-516

## 1. Requirement ID
REQ-516

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Automatically testable

**Rationale**: This requirement specifies a concrete FHIR interaction (read Immunization by id) that can be directly tested through API calls and response validation.

### Complexity
**Level**: Simple

**Justification**: This is a straightforward FHIR read operation requiring only a single API call and basic response validation.

### Prerequisites
- US Core Server implementation with Immunization resource support
- Valid Immunization resource IDs available in the test system
- Client system capable of making FHIR read requests
- Authentication/authorization credentials if required by the server
- Network connectivity between client and server

## 3. Test Implementation Strategy

### Required Inputs
- **Server Base URL**: The FHIR server endpoint
- **Immunization Resource IDs**: One or more valid Immunization resource identifiers existing on the server
- **Authentication Credentials**: As required by the server security implementation
- **Expected Format**: JSON (required per Capability Statement), XML (optional)

### Required FHIR Operations
- **read**: `GET [base]/Immunization/[id]`
  - This operation is supported as part of the US Core Server capability to provide responses to queries submitted by US Core Requestors

### Validation Criteria

#### Test Case 1: Successful Immunization Resource Retrieval
**Test Steps**:
1. Execute `GET [base]/Immunization/[valid-id]` request
2. Validate HTTP response status
3. Validate response content type
4. Validate FHIR resource structure
5. Validate US Core Immunization profile conformance

**Expected Results**:
- HTTP Status Code: 200 (OK)
- Content-Type: `application/fhir+json` (required) or `application/fhir+xml` (optional)
- Response body contains a valid FHIR Immunization resource
- Resource conforms to US Core Immunization profile structure
- Resource includes required elements per US Core Immunization profile
- If present, `meta.profile` should reference US Core Immunization profile

#### Test Case 2: Error Handling for Invalid Resource ID
**Test Steps**:
1. Execute `GET [base]/Immunization/[invalid-id]` request
2. Validate HTTP response status
3. Validate error response format

**Expected Results**:
- HTTP Status Code: 404 (Not Found)
- Response includes appropriate FHIR OperationOutcome resource explaining the error
- Error handling aligns with US Core Server requirements

#### Test Case 3: Authorization Error Handling (if applicable)
**Test Steps**:
1. Execute `GET [base]/Immunization/[valid-id]` request without proper credentials
2. Validate HTTP response status

**Expected Results**:
- HTTP Status Code: 401 (Unauthorized), 403 (Forbidden), or 404 (Not Found) per US Core Server security requirements
- Response handling aligns with server security implementation

#### Test Case 4: Format Support Validation
**Test Steps**:
1. Execute `GET [base]/Immunization/[valid-id]` with `Accept: application/fhir+json` header
2. If server supports XML, execute `GET [base]/Immunization/[valid-id]` with `Accept: application/fhir+xml` header
3. Validate response formats

**Expected Results**:
- JSON format request returns valid JSON FHIR response (required)
- XML format request returns valid XML FHIR response (if supported)
- Content-Type headers match requested format

#### Pass/Fail Criteria
**Test passes if**:
- All successful retrieval attempts return HTTP 200 with valid US Core Immunization resources
- Error cases return appropriate HTTP status codes (404, 401, 403) as specified
- JSON format support is demonstrated (required)
- All returned resources pass FHIR validation for the US Core Immunization profile

**Test fails if**:
- Valid Immunization IDs return non-200 HTTP status codes
- Returned resources are not valid FHIR Immunization resources
- Returned resources do not conform to US Core Immunization profile requirements
- JSON format is not supported
- Error responses do not align with US Core Server requirements

---



<a id='location'></a>

## Location

<a id='req-465'></a>

### REQ-465: US Core Location Profile implementation

**Text**: 

**Context**: System conformance to US Core Location Profile.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-465: US Core Location Profile Implementation

## 1. Requirement ID
**REQ-465**

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be tested through automated validation of Location resources against the US Core Location Profile constraints and verification of server capability to handle Location resources according to the profile specifications.

### Complexity
**Moderate** - Requires validation of profile conformance, resource structure validation, and verification of server capabilities for Location resources as specified in the US Core Server CapabilityStatement.

### Prerequisites
- System must implement US Core Server CapabilityStatement
- System must have Location resources available for testing
- Test client must have appropriate access permissions to query Location resources
- FHIR R4 validator with US Core profiles loaded
- Network connectivity to the FHIR server under test

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Location resources conforming to US Core Location Profile
- Any existing Location resources in the test system (bring your own data approach)

**Expected Outputs:**
- Valid FHIR Location resources that conform to US Core Location Profile
- Appropriate HTTP response codes (200, 404, etc.)
- OperationOutcome resources for any validation errors
- Bundle resources for search operations

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations should be supported for Location resources:

1. **GET /Location/[id]** - Read individual Location resource
2. **GET /Location** - Search for Location resources
3. **GET /Location?[search-parameters]** - Search with various parameters as defined in US Core Location Profile

*Note: Specific search parameters and interaction capabilities should be verified against the detailed US Core Server CapabilityStatement Location resource requirements.*

### Validation Criteria

#### Profile Conformance Validation
- **Assertion 1**: All Location resources returned by the server SHALL declare conformance to the US Core Location Profile (`http://hl7.org/fhir/us/core/StructureDefinition/us-core-location`)
- **Assertion 2**: Location resources SHALL pass validation against the US Core Location Profile using a FHIR validator
- **Assertion 3**: Required elements as specified in the US Core Location Profile SHALL be present and populated

#### Server Capability Validation
- **Assertion 4**: Server SHALL support the read interaction for Location resources (`GET /Location/[id]`)
- **Assertion 5**: Server SHALL return appropriate HTTP status codes for Location resource interactions
- **Assertion 6**: Server SHALL return properly formatted FHIR Location resources in response to valid requests

#### Resource Structure Validation
- **Assertion 7**: Location resources SHALL contain valid FHIR data types for all elements
- **Assertion 8**: Location resources SHALL conform to cardinality constraints defined in the US Core Location Profile
- **Assertion 9**: Location resources SHALL use appropriate terminology bindings as specified in the profile

#### Search Functionality Validation (if supported)
- **Assertion 10**: Server SHALL support search parameters as defined in the US Core Location Profile
- **Assertion 11**: Search results SHALL return Bundle resources containing Location resources that conform to the profile
- **Assertion 12**: Search operations SHALL handle invalid parameters appropriately with proper error responses

#### Error Handling Validation
- **Assertion 13**: Server SHALL return appropriate OperationOutcome resources for invalid requests
- **Assertion 14**: Server SHALL handle non-existent Location resource requests with proper 404 responses
- **Assertion 15**: Server SHALL provide meaningful error messages for validation failures

**Test Success Criteria:**
A system passes REQ-465 conformance testing when all assertions pass, demonstrating that the system correctly implements and exposes Location resources according to the US Core Location Profile specifications and supports the required interactions as defined in the US Core Server CapabilityStatement.

---

<a id='req-517'></a>

### REQ-517: US Core Client SHALL fetch Location resources.

**Text**: 

**Context**: US Core Client read interaction for Location by id

**Actor**: US Core Client

**Conformance**: SHALL

# Test Specification for REQ-517

## 1. Requirement ID
**REQ-517**: US Core Client SHALL fetch Location resources

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified through automated testing by performing read operations on Location resources and validating the responses.

### Complexity
**Simple** - This is a straightforward FHIR read interaction that tests basic RESTful API functionality.

### Prerequisites
- US Core Server implementing the US Core Location profile
- At least one Location resource available on the server with a known resource ID
- Client system capable of making FHIR RESTful API calls
- Valid authentication credentials if server requires authorization
- Network connectivity between client and server

## 3. Test Implementation Strategy

### Required Inputs
- **Server Base URL**: The FHIR server endpoint URL
- **Location Resource ID**: Valid identifier for an existing Location resource on the server
- **Authentication Token**: If required by the server's security implementation
- **Accept Header**: Should support `application/fhir+json` at minimum

### Expected Outputs
- **HTTP Status Code**: 200 (OK) for successful retrieval
- **Content-Type**: `application/fhir+json` (required) or `application/fhir+xml` (optional)
- **Response Body**: Valid FHIR Location resource conforming to US Core Location profile
- **Resource ID**: Should match the requested resource ID

### Required FHIR Operations
- **GET [base]/Location/[id]** - Individual Location resource read operation
  - This operation is supported as part of standard FHIR RESTful capabilities
  - Aligns with US Core Server capability requirements for resource access

### Validation Criteria

#### 1. HTTP Response Validation
- **PASS**: HTTP status code is 200 (OK)
- **FAIL**: Any 4xx or 5xx status codes (unless testing error conditions)

#### 2. Content Type Validation
- **PASS**: Response Content-Type header is `application/fhir+json` or `application/fhir+xml`
- **FAIL**: Response Content-Type is not a valid FHIR media type

#### 3. FHIR Resource Structure Validation
- **PASS**: Response body contains a valid FHIR Location resource
- **PASS**: Resource has required elements: `resourceType: "Location"`
- **PASS**: Resource ID in response matches the requested ID
- **FAIL**: Response body is not valid JSON/XML or not a valid FHIR resource

#### 4. US Core Profile Conformance Validation
- **PASS**: Location resource conforms to US Core Location profile requirements
- **PASS**: All Must Support elements are present (if applicable to the specific resource instance)
- **OPTIONAL**: `meta.profile` element references US Core Location profile URL
- **FAIL**: Resource does not meet US Core Location profile constraints

#### 5. Error Handling Validation (for non-existent resources)
- **PASS**: Server returns appropriate error codes as specified in capability statement:
  - Status 404: Unknown resource (for non-existent Location IDs)
  - Status 401/4xx: Unauthorized request (if authentication fails)
  - Status 403: Insufficient scopes (if authorization fails)
  - Status 400: Invalid parameter (for malformed requests)

#### 6. Security Compliance Validation
- **PASS**: Server properly handles unauthorized requests with appropriate HTTP status codes
- **PASS**: Authentication mechanisms work as expected when credentials are provided
- **FAIL**: Server allows unauthorized access when it should be restricted

### Test Cases

#### Test Case 1: Successful Location Resource Retrieval
1. Execute GET request to `[base]/Location/[valid-id]`
2. Verify HTTP 200 status code
3. Validate response content type
4. Verify Location resource structure and profile conformance

#### Test Case 2: Location Resource Not Found
1. Execute GET request to `[base]/Location/[non-existent-id]`
2. Verify HTTP 404 status code
3. Validate appropriate error response structure

#### Test Case 3: Authentication/Authorization Validation
1. Execute GET request without proper credentials (if server requires auth)
2. Verify appropriate 401/403 status code
3. Re-execute with valid credentials and verify successful retrieval

#### Test Case 4: Content Negotiation
1. Execute GET request with `Accept: application/fhir+json` header
2. Verify JSON response format
3. If server supports XML, repeat with `Accept: application/fhir+xml` header

---



<a id='medication'></a>

## Medication

<a id='req-001'></a>

### REQ-001: The US Core Medication Profile SHALL support the medication code.

**Text**: 

**Context**: 

**Actor**: US Core Medication Profile

**Conformance**: SHALL

# Test Specification for REQ-001

## 1. Requirement ID
REQ-001

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated programmatically by examining FHIR Medication resources to verify the presence and structure of medication code elements.

### Complexity
**Simple** - The requirement focuses on a single, well-defined element (medication code) within the US Core Medication Profile.

### Prerequisites
- System under test must implement US Core Server capabilities
- System must support US Core Medication Profile
- Test data must include Medication resources that conform to the US Core Medication Profile
- System must support FHIR R4 JSON format (required per Capability Statement)

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- One or more Medication resources that claim conformance to the US Core Medication Profile (indicated by `meta.profile` containing `http://hl7.org/fhir/us/core/StructureDefinition/us-core-medication`)

**Expected Outputs:**
- Medication resources with populated `code` element containing appropriate medication coding information

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and can be used for testing:
- **GET** operations to retrieve Medication resources
- **Search** operations if Medication search parameters are supported by the implementation

### Validation Criteria

The following assertions must pass for the test to be considered successful:

1. **Profile Conformance Verification:**
   - Verify that each Medication resource includes `meta.profile` containing the US Core Medication Profile URI
   - Validate that the resource passes FHIR validation against the US Core Medication Profile

2. **Medication Code Presence:**
   - Assert that the `Medication.code` element is present and not empty
   - Verify that `Medication.code` is of type CodeableConcept

3. **Code Structure Validation:**
   - Confirm that `Medication.code.coding` contains at least one Coding element
   - Verify that each Coding element has a `system` and `code` value
   - Optionally verify that `display` values are present when available

4. **Terminology Binding Compliance:**
   - Validate that medication codes use appropriate terminology systems as defined in the US Core Medication Profile
   - Verify codes are from expected value sets (e.g., RxNorm, NDC, etc.)

### Test Execution Steps

1. **Resource Retrieval:**
   - Retrieve Medication resources from the system under test using supported FHIR operations
   - Filter for resources that claim US Core Medication Profile conformance

2. **Structural Validation:**
   - For each retrieved Medication resource, validate the presence of the `code` element
   - Verify the structure and content of the CodeableConcept

3. **Conformance Validation:**
   - Run FHIR validation against the US Core Medication Profile
   - Verify that the medication code meets the profile's requirements

4. **Result Assessment:**
   - Document any resources that fail validation
   - Provide specific details about missing or invalid medication code elements

### Pass/Fail Criteria

**Pass:** All tested Medication resources contain valid medication codes that conform to the US Core Medication Profile requirements.

**Fail:** Any Medication resource claiming US Core conformance lacks a medication code or contains an invalid medication code structure.

**Note:** This test accommodates a "bring your own data" approach by testing whatever Medication resources are available in the system, focusing on conformance validation rather than specific data fixtures.

---

<a id='req-018'></a>

### REQ-018: The system SHALL support the USCoreMedicationAdherenceExtension.

**Text**: 

**Context**: 

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-018

## 1. Requirement ID
REQ-018: USCoreMedicationAdherenceExtension Support

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified by examining FHIR resources returned by the system to confirm proper implementation and usage of the USCoreMedicationAdherenceExtension.

### Complexity
**Simple** - The test involves validating the presence and correct structure of a specific extension in FHIR resources.

### Prerequisites
- System must have MedicationStatement or related resources that could contain medication adherence information
- System must support US Core profiles that reference medication adherence
- Test client must have appropriate authentication/authorization to access medication-related resources
- System should have existing patient data with medication information

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Any existing MedicationStatement, MedicationRequest, or other medication-related resources in the system that may contain adherence information
- **Patient Context**: Valid patient identifier to retrieve medication-related resources
- **Authentication**: Valid credentials/tokens as required by the system's security implementation

### Expected Outputs
- FHIR resources (primarily MedicationStatement) that include the USCoreMedicationAdherenceExtension when adherence information is available
- Properly structured extension conforming to the US Core specification
- Valid FHIR JSON/XML format responses

### Required FHIR Operations
Based on the Capability Statement, the following operations should be supported:

1. **MedicationStatement Read/Search Operations**:
   - `GET [base]/MedicationStatement/[id]`
   - `GET [base]/MedicationStatement?patient=[patient-id]`

2. **Patient Resource Access** (required by US Core):
   - `GET [base]/Patient/[id]` (to establish patient context)

### Validation Criteria

#### Test Case 1: Extension Presence Validation
**Objective**: Verify that when medication adherence data is present, the USCoreMedicationAdherenceExtension is properly included

**Steps**:
1. Retrieve MedicationStatement resources for available patients
2. For each MedicationStatement resource returned:
   - Check if adherence information is present
   - If present, validate that the `USCoreMedicationAdherenceExtension` is included in the resource
   - Verify the extension URL matches the official US Core extension URL

**Assertions**:
- Extension URL must be correct: `http://hl7.org/fhir/us/core/StructureDefinition/us-core-medication-adherence`
- Extension structure must conform to the US Core specification
- If adherence data exists, the extension SHALL be present (not optional)

#### Test Case 2: Extension Structure Validation
**Objective**: Verify the extension is properly structured according to US Core specifications

**Steps**:
1. Identify MedicationStatement resources containing the adherence extension
2. Validate the extension's internal structure and data types
3. Verify all required sub-elements are present and properly formatted

**Assertions**:
- Extension contains appropriate value type (CodeableConcept, Boolean, etc. as defined by US Core)
- Values conform to expected value sets or constraints
- Extension does not contain invalid or unexpected elements

#### Test Case 3: FHIR Validation Compliance
**Objective**: Ensure resources with the extension pass FHIR validation

**Steps**:
1. Retrieve resources containing the USCoreMedicationAdherenceExtension
2. Validate against FHIR R4 base specification
3. Validate against US Core profiles

**Assertions**:
- Resources pass FHIR R4 validation
- Resources conform to applicable US Core profiles
- No validation errors related to the extension implementation
- Response format is valid JSON (SHALL support) and optionally XML (SHOULD support)

#### Test Case 4: Negative Testing
**Objective**: Verify system behavior when adherence extension is not applicable

**Steps**:
1. Retrieve MedicationStatement resources where adherence information would not be expected
2. Confirm extension is appropriately omitted when not applicable

**Assertions**:
- Extension is not included when adherence data is not available or applicable
- Resources remain valid without the extension
- No errors occur when extension is absent

### Error Handling Validation
- System returns appropriate HTTP status codes (400, 401, 403, 404) as specified in the Capability Statement
- Error responses follow FHIR OperationOutcome format
- Authentication/authorization errors are properly handled

### Data Format Support
- JSON format support (SHALL requirement)
- XML format support (SHOULD requirement - test if advertised in Capability Statement)
- Proper content-type headers in responses

---

<a id='req-265'></a>

### REQ-265: USCoreMedicationProfile SHALL map the medication code to the appropriate NCPDP SCRIPT 10.6 element.

**Text**: 

**Context**: 

**Actor**: USCoreMedicationProfile

**Conformance**: SHALL

# Test Specification for REQ-265

## 1. Requirement ID
REQ-265: USCoreMedicationProfile SHALL map the medication code to the appropriate NCPDP SCRIPT 10.6 element

## 2. Requirement Analysis

### Testability Assessment
**Attestation** - This requirement involves verifying that medication codes in US Core Medication profiles are properly mapped to NCPDP SCRIPT 10.6 elements. While the mapping itself can be validated, the requirement is primarily about conformance to a specific mapping specification rather than runtime behavior testing.

### Complexity
**Moderate** - The test requires understanding of both FHIR US Core Medication profile structure and NCPDP SCRIPT 10.6 mapping specifications. It involves validating code mappings rather than simple data presence.

### Prerequisites
- System must support US Core Medication profile
- Access to NCPDP SCRIPT 10.6 mapping specification documentation
- Test data containing Medication resources with coded medication information
- Understanding of the specific mapping requirements between FHIR Medication.code and NCPDP SCRIPT 10.6 elements

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Medication resources conforming to US Core Medication profile
- **Reference Data**: NCPDP SCRIPT 10.6 mapping specification
- **Test Data**: Various medication codes (NDC, RxNorm, SNOMED CT, etc.) that should be mapped to NCPDP SCRIPT 10.6

### Expected Outputs
- Validation report confirming proper mapping of medication codes
- Identification of any medication codes that lack appropriate NCPDP SCRIPT 10.6 mapping
- Documentation of mapping compliance per medication resource

### Required FHIR Operations
- **GET /Medication**: Retrieve Medication resources (supported by US Core Server capability)
- **GET /Medication/[id]**: Retrieve specific Medication instances
- **Profile validation**: Verify resources conform to US Core Medication profile

### Validation Criteria

#### Primary Assertions
1. **Profile Conformance**: All tested Medication resources SHALL conform to the US Core Medication profile
2. **Code Presence**: Medication.code element SHALL be present and populated
3. **Mapping Compliance**: Each medication code SHALL have a documented mapping to the appropriate NCPDP SCRIPT 10.6 element

#### Specific Validation Checks
1. **Code System Validation**:
   - Verify that medication codes use appropriate code systems (NDC, RxNorm, etc.)
   - Confirm code system URIs are correctly specified

2. **NCPDP SCRIPT 10.6 Mapping Validation**:
   - For NDC codes: Verify mapping to appropriate NDC field in NCPDP SCRIPT 10.6
   - For RxNorm codes: Verify mapping to appropriate RxNorm field in NCPDP SCRIPT 10.6
   - For other code systems: Verify documented mapping exists and is appropriate

3. **Code Structure Validation**:
   - NDC codes should follow proper NDC format requirements
   - RxNorm codes should reference valid RxNorm concepts
   - Code display names should be present where required

#### Pass/Fail Criteria
- **PASS**: All Medication resources demonstrate proper mapping of medication codes to NCPDP SCRIPT 10.6 elements according to the mapping specification
- **FAIL**: Any Medication resource contains medication codes that cannot be properly mapped to NCPDP SCRIPT 10.6 elements, or mapping is inconsistent with the specification

#### Test Execution Approach
1. **Resource Retrieval**: Query for Medication resources using supported search parameters
2. **Profile Validation**: Validate each Medication resource against US Core Medication profile
3. **Code Analysis**: Extract and analyze medication codes from each resource
4. **Mapping Verification**: Verify each code has appropriate NCPDP SCRIPT 10.6 mapping
5. **Documentation**: Record mapping compliance and any exceptions

#### Attestation Requirements
Since this is primarily a mapping requirement, the test may require:
- Documentation from the implementer showing how medication codes are mapped
- Evidence that the mapping follows NCPDP SCRIPT 10.6 specifications
- Demonstration that the mapping is consistently applied across all medication data

---

<a id='req-266'></a>

### REQ-266: USCoreMedicationProfile SHALL map the medication form to the appropriate NCPDP SCRIPT 10.6 element.

**Text**: 

**Context**: 

**Actor**: USCoreMedicationProfile

**Conformance**: SHALL

# Test Specification for REQ-266

## 1. Requirement ID
REQ-266

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified through automated testing by examining the mapping between FHIR Medication profile form elements and NCPDP SCRIPT 10.6 elements.

### Complexity
**Moderate** - The test requires understanding of both FHIR Medication profile structure and NCPDP SCRIPT 10.6 mapping specifications, along with validation of specific element mappings.

### Prerequisites
- Access to a FHIR server implementing US Core Medication profile
- Understanding of NCPDP SCRIPT 10.6 specification and form element mappings
- Test data containing Medication resources with form elements populated
- Access to US Core Medication profile mapping documentation

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Medication resources conforming to US Core Medication Profile with `form` element populated
- Various medication forms should be represented in test data (tablets, capsules, liquids, etc.)

**Expected Outputs:**
- Validation that medication form elements map correctly to NCPDP SCRIPT 10.6 elements
- Confirmation that mapping follows the specified US Core Medication Profile requirements

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and may be needed:

1. **GET /Medication/[id]** - Retrieve specific Medication resources
2. **GET /Medication?[search-parameters]** - Search for Medication resources (if search parameters are supported)
3. **Profile validation** - Verify resources conform to US Core Medication Profile

*Note: The specific search capabilities for Medication resources would need to be confirmed in the detailed Capability Statement, as the provided excerpt focuses on general server requirements.*

### Validation Criteria

#### Primary Assertions:
1. **Profile Conformance**: All tested Medication resources SHALL conform to the US Core Medication Profile
2. **Form Element Presence**: When medication form is specified, it SHALL be present in the `Medication.form` element
3. **NCPDP Mapping Compliance**: The medication form values SHALL map to appropriate NCPDP SCRIPT 10.6 elements according to the specification
4. **Coding System Validation**: Form codes SHALL use appropriate value sets that align with NCPDP SCRIPT 10.6 requirements

#### Specific Test Cases:
1. **Valid Form Mapping Test**:
   - Retrieve Medication resources with populated form elements
   - Verify each form value maps to the correct NCPDP SCRIPT 10.6 element
   - Confirm mapping completeness and accuracy

2. **Form Coding Validation**:
   - Validate that form codes use appropriate coding systems
   - Verify codes are from value sets compatible with NCPDP SCRIPT 10.6

3. **Missing Form Handling**:
   - Test behavior when form element is not provided
   - Ensure appropriate handling according to profile requirements

#### Pass/Fail Criteria:
- **PASS**: All Medication resources with form elements demonstrate correct mapping to NCPDP SCRIPT 10.6 elements
- **FAIL**: Any Medication resource fails to map form elements correctly or uses incompatible coding systems

#### Additional Validation Points:
- Verify that the mapping is bidirectional where applicable
- Ensure no data loss occurs during the mapping process
- Confirm that all supported medication forms have corresponding NCPDP SCRIPT 10.6 mappings
- Validate that the implementation follows the specific mapping guidance provided in the US Core Medication Profile documentation

---

<a id='req-267'></a>

### REQ-267: USCoreMedicationProfile SHALL map the medication strength to the appropriate NCPDP SCRIPT 10.6 element.

**Text**: 

**Context**: 

**Actor**: USCoreMedicationProfile

**Conformance**: SHALL

# Test Specification for REQ-267

## 1. Requirement ID
**REQ-267**: USCoreMedicationProfile SHALL map the medication strength to the appropriate NCPDP SCRIPT 10.6 element.

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Attestation

**Rationale**: This requirement involves mapping between FHIR US Core Medication Profile elements and NCPDP SCRIPT 10.6 standard elements. Since NCPDP SCRIPT is an external messaging standard used in pharmacy systems and the requirement specifically addresses mapping during data transformation/exchange, this cannot be directly tested through FHIR API interactions alone. The mapping verification requires access to both the FHIR data and the resulting NCPDP SCRIPT output, which is typically handled by specialized pharmacy middleware or integration systems.

### Complexity
**Moderate**

The requirement involves understanding:
- US Core Medication Profile structure and strength representation
- NCPDP SCRIPT 10.6 standard elements for medication strength
- Mapping rules between the two standards
- Verification that strength data is preserved and correctly transformed

### Prerequisites
- System must support US Core Medication Profile
- System must have capability to generate or transform to NCPDP SCRIPT 10.6 format
- Access to medication data that includes strength information
- Documentation or access to the system's mapping implementation
- Knowledge of NCPDP SCRIPT 10.6 strength field specifications

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Medication resources conforming to US Core Medication Profile that contain strength information in various formats:
  - `Medication.ingredient.strength.numerator` and `Medication.ingredient.strength.denominator`
  - `Medication.ingredient.strengthRatio`
  - `Medication.ingredient.strengthQuantity`

**Expected Outputs:**
- NCPDP SCRIPT 10.6 formatted messages or data structures
- Documentation showing the mapping between FHIR strength elements and corresponding NCPDP SCRIPT 10.6 strength fields
- Evidence that strength values are accurately preserved in the transformation

### Required FHIR Operations
Based on the US Core Server Capability Statement, the following operations should be supported:

1. **GET /Medication/{id}** - Retrieve specific medication resources to verify strength data structure
2. **GET /Medication?** - Search for medications with strength information using supported search parameters

*Note: The actual NCPDP SCRIPT generation is typically performed by backend systems and may not be directly observable through FHIR API operations.*

### Validation Criteria

**Primary Assertions:**
1. **Mapping Documentation Verification**:
   - Verify that system documentation clearly identifies which NCPDP SCRIPT 10.6 fields correspond to US Core Medication strength elements
   - Confirm that all relevant strength representation formats in US Core are addressed in the mapping

2. **Data Preservation Verification**:
   - For medications with `strengthRatio`: Verify numerator and denominator values are correctly mapped to appropriate NCPDP strength fields
   - For medications with `strengthQuantity`: Verify quantity value and unit are correctly represented in NCPDP format
   - For medications with complex strength representations: Verify that strength information is not lost or corrupted during transformation

3. **Conformance to NCPDP Standards**:
   - Verify that mapped strength values conform to NCPDP SCRIPT 10.6 field specifications
   - Confirm that units of measure are appropriately converted or mapped to NCPDP-acceptable values
   - Validate that strength precision and formatting meet NCPDP requirements

**Test Process:**
1. **Attestation Collection**: Request documentation from the implementer showing:
   - Detailed mapping specifications between US Core Medication strength elements and NCPDP SCRIPT 10.6 fields
   - Sample transformations demonstrating the mapping in practice
   - Validation processes used to ensure mapping accuracy

2. **Sample Verification**: If possible, request sample pairs of:
   - US Core Medication resources with strength data
   - Corresponding NCPDP SCRIPT 10.6 output showing how strength was mapped

3. **Edge Case Coverage**: Verify that the mapping handles:
   - Different units of measure commonly used in medication strength
   - Complex strength representations (e.g., concentrations, ratios)
   - Missing or incomplete strength information

**Passing Criteria:**
- Complete mapping documentation exists and covers all US Core Medication strength representation methods
- Sample transformations demonstrate accurate preservation of strength data
- Mapping conforms to both US Core requirements and NCPDP SCRIPT 10.6 specifications
- System handles edge cases appropriately without data loss

---

<a id='req-466'></a>

### REQ-466: US Core Medication Profile implementation

**Text**: 

**Context**: System conformance to US Core Medication Profile.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-466

## 1. Requirement ID
**REQ-466**: US Core Medication Profile implementation

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be automatically verified through FHIR resource validation and profile conformance checking.

### Complexity
**Moderate** - Requires validation of Medication resources against the US Core Medication Profile, including Must Support elements and value set bindings.

### Prerequisites
- System must have Medication resources available for testing
- System must support FHIR R4
- System must implement US Core Server CapabilityStatement
- Access to US Core Medication Profile definition and associated value sets
- Authentication/authorization configured if required by the system

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Medication resources from the system under test
- **Profile Definition**: US Core Medication Profile (http://hl7.org/fhir/us/core/StructureDefinition/us-core-medication)
- **System Endpoint**: Base FHIR server URL
- **Authentication**: Valid credentials if required

### Expected Outputs
- Valid Medication resources conforming to US Core Medication Profile
- Proper `meta.profile` declaration (SHOULD requirement)
- Compliance with Must Support requirements
- Appropriate error responses for invalid requests

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported:

1. **GET /Medication/[id]** - Retrieve specific Medication resources
2. **GET /Medication** - Search for Medication resources (if search parameters are implemented)
3. **GET /metadata** - Verify server capabilities and supported profiles

### Validation Criteria

#### Primary Conformance Checks
1. **Profile Conformance Validation**
   - All retrieved Medication resources MUST validate against the US Core Medication Profile
   - Resources MUST pass FHIR validator checks for the specified profile
   - No validation errors or fatal warnings should be present

2. **Must Support Element Verification**
   - Verify that all Must Support elements defined in the US Core Medication Profile are properly implemented
   - Check that required data elements are present when the data exists in the system
   - Validate that Must Support elements follow the cardinality and constraints specified in the profile

3. **Meta Profile Declaration (SHOULD)**
   - Verify that Medication resources include `meta.profile` element referencing the US Core Medication Profile
   - Check: `meta.profile` contains "http://hl7.org/fhir/us/core/StructureDefinition/us-core-medication"

#### Data Type and Value Set Validation
1. **Code System Compliance**
   - Verify that coded elements use appropriate value sets as defined in the US Core Medication Profile
   - Validate terminology bindings for required and extensible value sets
   - Check that RxNorm codes are used where specified

2. **Data Type Conformance**
   - Validate that all elements conform to expected FHIR data types
   - Ensure proper formatting of identifiers, codes, and other complex data types

#### Response Format Validation
1. **JSON Format Support (SHALL)**
   - Verify that the server returns valid JSON responses
   - Ensure proper FHIR JSON formatting and structure

2. **HTTP Status Codes**
   - Verify appropriate HTTP status codes are returned:
     - 200 OK for successful retrievals
     - 404 Not Found for non-existent resources
     - 400 Bad Request for invalid parameters
     - 401/403 for unauthorized requests (if applicable)

#### Server Capability Verification
1. **CapabilityStatement Compliance**
   - Verify that the server's CapabilityStatement declares support for US Core Medication Profile
   - Confirm that the server meets US Core Server CapabilityStatement requirements

### Test Execution Steps
1. **Retrieve Server CapabilityStatement**
   - Verify US Core Medication Profile is listed in supported profiles

2. **Resource Retrieval Testing**
   - Attempt to retrieve available Medication resources
   - Test with valid resource IDs from the system's data

3. **Profile Validation**
   - Run each retrieved Medication resource through FHIR validator with US Core Medication Profile
   - Document any validation failures or warnings

4. **Must Support Analysis**
   - Analyze retrieved resources for Must Support element compliance
   - Verify data presence and format according to profile requirements

5. **Error Handling Verification**
   - Test server responses to invalid requests
   - Verify appropriate error codes and messages are returned

### Pass/Fail Criteria
**PASS**: All retrieved Medication resources successfully validate against the US Core Medication Profile with no validation errors, and the system demonstrates proper implementation of Must Support requirements.

**FAIL**: Any Medication resource fails validation against the US Core Medication Profile, or the system fails to implement required Must Support elements, or returns improper error responses.

---

<a id='req-518'></a>

### REQ-518: US Core Client SHALL fetch Medication resources.

**Text**: 

**Context**: US Core Client read interaction for Medication by id

**Actor**: US Core Client

**Conformance**: SHALL

# Test Specification for REQ-518

## Requirement ID
REQ-518

## Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be automatically tested by verifying that a US Core Client can successfully perform read operations on Medication resources using the FHIR read interaction.

### Complexity
**Simple** - This is a straightforward FHIR read operation test that requires basic REST API interaction capabilities.

### Prerequisites
- US Core Server implementation that supports Medication resources
- US Core Client implementation capable of making FHIR REST API calls
- Valid Medication resource IDs available on the server for testing
- Proper authentication/authorization credentials configured
- Network connectivity between client and server

## Test Implementation Strategy

### Required Inputs
- **Server Base URL**: FHIR server endpoint supporting US Core
- **Authentication Credentials**: Valid credentials for the US Core Client
- **Medication Resource IDs**: List of valid Medication resource identifiers that exist on the server
- **Expected Resource Count**: Minimum number of Medication resources that should be fetchable

### Required FHIR Operations
- **READ Operation**: `GET [base]/Medication/[id]`
  - This operation is supported as part of the standard FHIR RESTful capabilities outlined in the US Core Server CapabilityStatement

### Validation Criteria

#### Primary Validation Checks
1. **Successful HTTP Response**
   - Verify HTTP status code is 200 (OK) for valid Medication resource IDs
   - Confirm response includes proper FHIR headers (Content-Type: application/fhir+json)

2. **Valid FHIR Medication Resource**
   - Verify response body contains a valid FHIR Medication resource
   - Confirm resource type is "Medication"
   - Validate resource structure against FHIR R4 specification
   - Verify resource ID matches the requested ID

3. **US Core Profile Conformance**
   - If present, verify `meta.profile` includes US Core Medication profile reference
   - Validate resource conforms to US Core Medication profile requirements
   - Check that any Must Support elements present in the resource are populated appropriately

4. **Error Handling Validation**
   - For invalid/non-existent Medication IDs, verify appropriate HTTP error responses:
     - 404 (Not Found) for non-existent resources
     - 401 (Unauthorized) for authentication failures
     - 403 (Forbidden) for insufficient permissions

#### Test Pass Criteria
- Client successfully retrieves at least one Medication resource with HTTP 200 response
- Retrieved Medication resource is valid FHIR R4 format
- Resource ID in response matches requested ID
- Client handles error conditions appropriately (receives and processes HTTP error codes)
- If US Core Medication profile is claimed, resource validates against the profile

#### Test Execution Steps
1. **Setup Phase**
   - Configure client with server endpoint and credentials
   - Identify available Medication resource IDs on the server

2. **Positive Test Cases**
   - Execute read operations for available Medication resource IDs
   - Verify successful responses and resource validity

3. **Negative Test Cases**
   - Attempt to read non-existent Medication resource ID
   - Verify appropriate error handling

4. **Validation Phase**
   - Validate all retrieved resources against FHIR specification
   - Confirm US Core profile compliance if applicable
   - Verify client processed all responses correctly

---



<a id='medicationdispense'></a>

## MedicationDispense

<a id='req-467'></a>

### REQ-467: US Core MedicationDispense Profile implementation

**Text**: 

**Context**: System conformance to US Core MedicationDispense Profile.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-467

## Requirement ID
REQ-467: US Core MedicationDispense Profile implementation

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be systematically tested through FHIR resource validation and capability verification.

### Complexity
**Moderate** - Requires validation of profile conformance, Must Support elements, and integration with referenced profiles.

### Prerequisites
- System must implement US Core Server capabilities
- System must have MedicationDispense resources available for testing
- System must support JSON format (required) and optionally XML format
- Test environment must have appropriate security configurations
- Referenced resources (Patient, Medication, Practitioner, etc.) must be available as per Must Support requirements

## Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: 
  - MedicationDispense resources conforming to US Core MedicationDispense Profile
  - Referenced Patient resources (US Core Patient Profile)
  - Referenced Medication resources
  - Referenced Practitioner/PractitionerRole resources (if applicable)
  - Referenced Organization resources (if applicable)

- **System Configuration**:
  - Active FHIR R4 server endpoint
  - Valid authentication credentials
  - Appropriate FHIR CapabilityStatement exposure

### Required FHIR Operations
Based on the Capability Statement, the following operations should be supported:

1. **GET /metadata** - Retrieve CapabilityStatement
2. **GET /MedicationDispense/{id}** - Read individual MedicationDispense resources
3. **GET /MedicationDispense** - Search for MedicationDispense resources (if search parameters are implemented)

### Validation Criteria

#### 1. Profile Conformance Validation
- **Assertion**: All MedicationDispense resources SHALL validate against the US Core MedicationDispense Profile
- **Test Method**: 
  - Retrieve MedicationDispense resources from the system
  - Validate each resource against US Core MedicationDispense Profile using FHIR validator
  - Verify `meta.profile` includes the US Core MedicationDispense Profile URL (SHOULD requirement)

#### 2. Must Support Element Verification
- **Assertion**: All Must Support elements defined in US Core MedicationDispense Profile SHALL be supported
- **Test Method**:
  - Identify all Must Support elements from the profile
  - For each MedicationDispense resource, verify that if data exists for Must Support elements, they are properly populated
  - Verify that the system can process and return Must Support elements without error

#### 3. Referenced Profile Conformance
- **Assertion**: Referenced resources SHALL conform to their respective US Core profiles where specified
- **Test Method**:
  - For each MedicationDispense resource, identify referenced resources (Patient, Medication, etc.)
  - Validate referenced Patient resources against US Core Patient Profile
  - Verify other referenced resources conform to appropriate profiles as specified in Must Support requirements

#### 4. Data Format Support
- **Assertion**: System SHALL support JSON format and SHOULD support XML format
- **Test Method**:
  - Request MedicationDispense resources with `Accept: application/fhir+json` header
  - Verify successful response with valid JSON format
  - Optionally test with `Accept: application/fhir+xml` header for XML support

#### 5. HTTP Response Validation
- **Assertion**: System SHALL return appropriate HTTP status codes as specified
- **Test Method**:
  - Test valid requests and verify successful responses (200 OK)
  - Test invalid resource IDs and verify 404 responses
  - Test unauthorized requests and verify 401/403 responses
  - Test invalid parameters and verify 400 responses

#### 6. CapabilityStatement Declaration
- **Assertion**: System SHALL declare US Core MedicationDispense Profile support in its CapabilityStatement
- **Test Method**:
  - Retrieve system CapabilityStatement via GET /metadata
  - Verify MedicationDispense resource is listed in supported resources
  - Verify US Core MedicationDispense Profile is referenced in supportedProfile or similar elements

#### 7. Security Requirements
- **Assertion**: System SHALL implement appropriate security measures
- **Test Method**:
  - Verify system rejects unauthorized requests with appropriate HTTP status codes
  - Test that security requirements from General Security Considerations are met
  - Validate that sensitive data access follows proper authorization patterns

### Pass/Fail Criteria

**PASS**: Test passes if:
- All MedicationDispense resources validate against US Core MedicationDispense Profile
- Must Support elements are properly implemented and accessible
- Referenced resources conform to required US Core profiles
- JSON format is supported with correct content-type handling
- Appropriate HTTP status codes are returned
- CapabilityStatement correctly declares profile support
- Security requirements are properly implemented

**FAIL**: Test fails if:
- Any MedicationDispense resource fails profile validation
- Must Support elements are missing or inaccessible when data exists
- Referenced resources do not conform to required profiles
- JSON format is not supported or malformed
- Incorrect HTTP status codes are returned
- CapabilityStatement does not declare proper profile support
- Security vulnerabilities are identified in testing

---

<a id='req-519'></a>

### REQ-519: US Core Client SHALL fetch MedicationDispense resources.

**Text**: 

**Context**: US Core Client read interaction for MedicationDispense by id

**Actor**: US Core Client

**Conformance**: SHALL

# Test Specification for REQ-519

## 1. Requirement ID
REQ-519

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated through direct API interactions to verify that a US Core Client can successfully fetch MedicationDispense resources by ID.

### Complexity
**Simple** - The requirement involves a straightforward FHIR read operation with clear success/failure criteria.

### Prerequisites
- US Core Server implementation with MedicationDispense resources available
- Valid MedicationDispense resource IDs existing in the server's data store
- US Core Client implementation under test
- Authentication credentials (if required by the server)
- Network connectivity between client and server

## 3. Test Implementation Strategy

### Required Inputs
- **Server endpoint URL** for the US Core Server being tested against
- **Authentication credentials** (if required)
- **Existing MedicationDispense resource IDs** available in the server's data store
- **US Core Client** implementation to be tested

### Expected Outputs
- **HTTP 200 OK** response for valid MedicationDispense resource requests
- **Valid MedicationDispense resource** in response body conforming to US Core MedicationDispense profile
- **Proper error responses** (400, 401, 403, 404) for invalid requests as specified in the Capability Statement

### Required FHIR Operations
- **GET [base]/MedicationDispense/[id]** - Read operation to fetch specific MedicationDispense resources by ID

### Validation Criteria

#### Primary Success Criteria
1. **Successful Resource Retrieval**: Client SHALL successfully execute GET requests to fetch MedicationDispense resources by valid IDs
2. **HTTP Response Validation**: Server SHALL return HTTP 200 OK status for valid requests
3. **Resource Format Validation**: Response SHALL contain valid FHIR MedicationDispense resource in JSON format (required) or XML format (optional)
4. **Profile Conformance**: Retrieved MedicationDispense resources SHOULD include `meta.profile` indicating US Core MedicationDispense profile conformance

#### Error Handling Validation
1. **Invalid ID Handling**: Client SHALL handle HTTP 404 responses appropriately when requesting non-existent MedicationDispense IDs
2. **Authentication Error Handling**: Client SHALL handle HTTP 401/403 responses appropriately for unauthorized requests
3. **Invalid Parameter Handling**: Client SHALL handle HTTP 400 responses appropriately for malformed requests

#### Test Cases
1. **Valid Resource Fetch**:
   - Execute GET request for existing MedicationDispense ID
   - Verify HTTP 200 response
   - Validate response contains properly formatted MedicationDispense resource
   - Confirm resource structure matches FHIR R4 MedicationDispense resource requirements

2. **Non-existent Resource Handling**:
   - Execute GET request for non-existent MedicationDispense ID
   - Verify appropriate error response (HTTP 404)
   - Confirm client handles the error gracefully

3. **Authentication/Authorization Testing** (if applicable):
   - Execute GET request without proper credentials
   - Verify HTTP 401/403 response
   - Confirm client handles authentication errors appropriately

4. **Multiple Resource Fetching**:
   - Execute GET requests for multiple different MedicationDispense IDs
   - Verify consistent successful retrieval across different resources
   - Validate that each resource maintains proper FHIR structure and US Core profile conformance

#### Assertion Criteria for Test Passing
- ✅ Client successfully retrieves at least one MedicationDispense resource with HTTP 200 response
- ✅ Retrieved resource(s) are valid FHIR MedicationDispense resources in JSON format
- ✅ Client demonstrates appropriate error handling for invalid requests
- ✅ All HTTP interactions follow FHIR RESTful API specifications
- ✅ Client maintains consistent behavior across multiple resource fetch operations

---



<a id='medicationrequest'></a>

## MedicationRequest

<a id='req-107'></a>

### REQ-107: MedicationRequest status must be set to "Active".

**Text**: 

**Context**: 

**Actor**: MedicationRequest

**Conformance**: SHALL

# Test Specification for REQ-107

## 1. Requirement ID
**REQ-107**: MedicationRequest status must be set to "Active"

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified through automated inspection of MedicationRequest resources to check the status field value.

### Complexity
**Simple** - This is a straightforward field value validation requiring a single attribute check.

### Prerequisites
- System must support US Core MedicationRequest Profile
- System must have MedicationRequest resources available for testing
- Test system must support FHIR R4 JSON format
- Authentication credentials if required by the server

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- One or more MedicationRequest resources that conform to the US Core MedicationRequest Profile
- Resources should represent realistic clinical scenarios using tester's own data

**Expected Outputs:**
- MedicationRequest resources with `status` field set to `"active"`
- HTTP 200 responses for successful retrievals
- Valid FHIR R4 JSON format responses

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for MedicationRequest:

1. **Search Operations:**
   - `GET [base]/MedicationRequest?patient=[patient-id]`
   - `GET [base]/MedicationRequest?patient=[patient-id]&intent=[intent-value]`
   - `GET [base]/MedicationRequest?patient=[patient-id]&status=[status-value]`

2. **Read Operations:**
   - `GET [base]/MedicationRequest/[id]` (if specific resource IDs are known)

### Validation Criteria

**Primary Assertions:**
1. **Status Field Presence**: Each MedicationRequest resource MUST contain a `status` field
2. **Status Value Validation**: The `status` field value MUST be exactly `"active"`
3. **Data Type Validation**: The `status` field MUST be of type `code`

**Supporting Validations:**
1. **Profile Conformance**: Resources SHOULD declare conformance to US Core MedicationRequest Profile in `meta.profile`
2. **Resource Structure**: Resources MUST be valid FHIR R4 MedicationRequest resources
3. **Response Format**: Server responses MUST be valid JSON

**Test Cases:**

**Test Case 1: Search-Based Validation**
- Execute: `GET [base]/MedicationRequest?patient=[test-patient-id]`
- Validate: All returned MedicationRequest resources have `status` = `"active"`
- Assert: `Bundle.entry.resource.status` equals `"active"` for each MedicationRequest

**Test Case 2: Status-Specific Search Validation**
- Execute: `GET [base]/MedicationRequest?patient=[test-patient-id]&status=active`
- Validate: Search successfully returns resources and all have active status
- Assert: Response contains MedicationRequest resources with `status` = `"active"`

**Test Case 3: Individual Resource Validation**
- Execute: `GET [base]/MedicationRequest/[known-resource-id]`
- Validate: Retrieved resource has `status` = `"active"`
- Assert: `MedicationRequest.status` equals `"active"`

**Pass Criteria:**
- All MedicationRequest resources examined must have `status` field set to `"active"`
- No MedicationRequest resources should be found with status values other than `"active"`
- Server must respond with appropriate HTTP status codes (200 for successful operations)

**Fail Criteria:**
- Any MedicationRequest resource found with `status` field missing
- Any MedicationRequest resource found with `status` field set to value other than `"active"`
- Server errors that prevent proper resource retrieval and validation

---

<a id='req-108'></a>

### REQ-108: MedicationRequest intent must be set to "Plan".

**Text**: 

**Context**: 

**Actor**: MedicationRequest

**Conformance**: SHALL

# Test Specification for REQ-108

## 1. Requirement ID
**REQ-108**

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be automatically validated by examining the `intent` field value in MedicationRequest resources.

### Complexity
**Simple** - The test involves a straightforward field value validation against a fixed expected value.

### Prerequisites
- System must support MedicationRequest resources per US Core MedicationRequest Profile
- System must have MedicationRequest data available for testing
- Test client must have appropriate read access to MedicationRequest resources

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: MedicationRequest resources that exist in the test system
- **Expected Value**: `intent` field must equal "plan"
- **Profile Conformance**: Resources should conform to US Core MedicationRequest Profile

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for MedicationRequest:

1. **Search Operations** (to retrieve test data):
   - `GET [base]/MedicationRequest?patient=[patient-id]`
   - `GET [base]/MedicationRequest?patient=[patient-id]&intent=plan`
   - `GET [base]/MedicationRequest?intent=plan`

2. **Read Operations** (for specific resource validation):
   - `GET [base]/MedicationRequest/[id]`

### Validation Criteria

#### Primary Validation
- **PASS**: All retrieved MedicationRequest resources have `intent` field set to "plan"
- **FAIL**: Any MedicationRequest resource has `intent` field set to a value other than "plan"
- **FAIL**: Any MedicationRequest resource is missing the `intent` field entirely

#### Test Execution Strategy

**Test Case 1: Search-Based Validation**
1. Execute search: `GET [base]/MedicationRequest?patient=[patient-id]`
2. For each returned MedicationRequest resource:
   - Assert that `resource.intent` exists
   - Assert that `resource.intent` equals "plan"
3. If no resources returned, test is inconclusive (requires attestation that no MedicationRequest data exists)

**Test Case 2: Intent-Filtered Search Validation**
1. Execute search: `GET [base]/MedicationRequest?intent=plan`
2. Execute search: `GET [base]/MedicationRequest` (without intent filter)
3. Compare result counts:
   - **PASS**: Both searches return the same number of resources
   - **FAIL**: Unfiltered search returns more resources than intent-filtered search

**Test Case 3: Individual Resource Validation**
1. For each known MedicationRequest resource ID:
   - Execute: `GET [base]/MedicationRequest/[id]`
   - Assert that `resource.intent` equals "plan"

#### Specific Assertions
```
ASSERT resource.intent IS NOT NULL
ASSERT resource.intent = "plan"
ASSERT resource.resourceType = "MedicationRequest"
```

#### Additional Validation Context
- Verify resources conform to US Core MedicationRequest Profile if `meta.profile` is present
- Log any resources that fail validation for review
- Consider case sensitivity: "plan" should match exactly (lowercase)

#### Edge Cases to Consider
- Empty result sets (inconclusive rather than pass/fail)
- Resources with missing intent field (should fail)
- Resources with null or empty string intent values (should fail)
- Resources with different case variations (e.g., "Plan", "PLAN") should fail per FHIR specifications

#### Test Reporting
- Count of total MedicationRequest resources evaluated
- Count of conformant resources (intent = "plan")
- Count of non-conformant resources with details
- List of specific resource IDs that failed validation

---

<a id='req-109'></a>

### REQ-109: MedicationRequest must include a medication.

**Text**: 

**Context**: 

**Actor**: MedicationRequest

**Conformance**: SHALL

# Test Specification for REQ-109

## 1. Requirement ID
REQ-109

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified through automated validation of MedicationRequest resources to ensure the medication element is present and populated.

### Complexity
**Simple** - This is a straightforward structural validation requirement checking for the presence of a mandatory element.

### Prerequisites
- System must support US Core MedicationRequest Profile
- System must have MedicationRequest resources available for testing
- Test system must be able to retrieve MedicationRequest resources via FHIR API

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: MedicationRequest resources that exist in the test system
- **System Capability**: Server supporting US Core MedicationRequest Profile with read operations
- **Data Requirements**: At least one MedicationRequest resource in the system (following "bring your own data" approach)

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for MedicationRequest:
- `GET [base]/MedicationRequest/[id]` - Read individual MedicationRequest resources
- `GET [base]/MedicationRequest?patient=[patient-id]&intent=[intent-value]` - Search for MedicationRequest resources
- Optional: `GET [base]/MedicationRequest?[parameter=value]&_include=MedicationRequest:medication` - Include referenced Medication resources

### Validation Criteria

#### Primary Validation Checks:
1. **Medication Element Presence**: Each MedicationRequest resource SHALL contain either:
   - `medicationCodeableConcept` element with valid medication coding, OR
   - `medicationReference` element with valid reference to a Medication resource

2. **Medication Content Validation**: 
   - If `medicationCodeableConcept` is used: Verify it contains at least one coding with system and code values
   - If `medicationReference` is used: Verify it contains a valid reference (either relative or absolute URL)

3. **Conformance to US Core Profile**: Verify the MedicationRequest resource conforms to the US Core MedicationRequest Profile structure

#### Test Steps:
1. **Discovery Phase**: Query the system for available MedicationRequest resources using supported search parameters from the Capability Statement
2. **Retrieval Phase**: Retrieve individual MedicationRequest resources using the read operation
3. **Validation Phase**: For each retrieved MedicationRequest resource:
   - Verify presence of medication element (either medicationCodeableConcept or medicationReference)
   - Validate the content and structure of the medication element
   - Confirm the resource validates against the US Core MedicationRequest Profile

#### Pass/Fail Criteria:
- **PASS**: All retrieved MedicationRequest resources contain a properly structured medication element (either medicationCodeableConcept or medicationReference)
- **FAIL**: Any MedicationRequest resource lacks both medicationCodeableConcept and medicationReference elements, or contains malformed medication data

#### Additional Considerations:
- Test should accommodate both inline medication coding and references to external Medication resources
- If medicationReference is used and points to external resources, the test should verify the reference is valid but does not need to resolve it unless testing _include functionality
- Test should work with whatever MedicationRequest data exists in the system being tested, without requiring specific medication types or formats

---

<a id='req-110'></a>

### REQ-110: MedicationRequest must have a reason code.

**Text**: 

**Context**: 

**Actor**: MedicationRequest

**Conformance**: SHALL

# Test Specification for REQ-110

## 1. Requirement ID
**REQ-110**: MedicationRequest must have a reason code

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be programmatically verified by checking for the presence of reason-related elements in MedicationRequest resources.

### Complexity
**Simple** - This is a straightforward structural validation that checks for the presence of required elements in a FHIR resource.

### Prerequisites
- Access to a FHIR server implementing US Core MedicationRequest Profile
- MedicationRequest resources available in the system for testing
- Authentication credentials with appropriate read permissions for MedicationRequest resources

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: MedicationRequest resources that conform to the US Core MedicationRequest Profile
- **Test Data**: Any existing MedicationRequest resources in the system under test (bring your own data approach)

### Expected Outputs
- **Pass**: All tested MedicationRequest resources contain at least one reason code element
- **Fail**: One or more MedicationRequest resources lack reason code elements
- **Test Report**: Summary of conformance validation results

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and will be used:

1. **Search MedicationRequest resources**:
   - `GET [base]/MedicationRequest?patient=[patient-id]&intent=[intent-value]`
   - `GET [base]/MedicationRequest?patient=[patient-id]&intent=[intent-value]&status=[status-value]`
   - `GET [base]/MedicationRequest?patient=[patient-id]&intent=[intent-value]&authoredon=[date-value]`

2. **Read individual MedicationRequest resources**:
   - `GET [base]/MedicationRequest/[id]`

### Validation Criteria

#### Primary Validation Checks
For each MedicationRequest resource retrieved, verify that **at least one** of the following reason-related elements is present and populated:

1. **`reasonCode`** - CodeableConcept array containing coded reasons for the medication request
2. **`reasonReference`** - Reference array to conditions or observations that justify the medication request

#### Specific Assertions
- **Assertion 1**: `MedicationRequest.reasonCode` exists and contains at least one CodeableConcept with a valid code
  - Check: `MedicationRequest.reasonCode.length > 0 AND MedicationRequest.reasonCode[0].coding.length > 0`

- **Assertion 2**: OR `MedicationRequest.reasonReference` exists and contains at least one valid resource reference
  - Check: `MedicationRequest.reasonReference.length > 0 AND MedicationRequest.reasonReference[0].reference` is not null/empty

#### Test Execution Flow
1. **Discovery Phase**: Search for MedicationRequest resources using supported search parameters from the Capability Statement
2. **Validation Phase**: For each retrieved MedicationRequest resource:
   - Parse the resource structure
   - Check for presence of `reasonCode` or `reasonReference`
   - Validate that the reason elements contain meaningful data (not just empty arrays)
3. **Reporting Phase**: Aggregate results and report conformance status

#### Pass/Fail Criteria
- **PASS**: 100% of tested MedicationRequest resources contain at least one populated reason element (`reasonCode` or `reasonReference`)
- **FAIL**: Any MedicationRequest resource lacks both `reasonCode` and `reasonReference` elements, or contains only empty reason elements

#### Additional Validation Considerations
- Validate that `reasonCode` entries contain properly structured CodeableConcept elements with valid coding systems
- Verify that `reasonReference` entries point to valid FHIR resource references (though resolution of references is not required for this conformance test)
- Ensure the test accounts for different MedicationRequest intents (order, plan, etc.) as supported by the server's search capabilities

---

<a id='req-187'></a>

### REQ-187: MedicationRequest SHALL specify the medication.

**Text**: 

**Context**: 

**Actor**: MedicationRequest

**Conformance**: SHALL

# Test Specification for REQ-187

## 1. Requirement ID
REQ-187

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated validation of MedicationRequest resources to ensure the medication element is present and properly specified.

### Complexity
**Simple** - The requirement is straightforward: verify that MedicationRequest resources contain a medication specification through either `medicationCodeableConcept` or `medicationReference`.

### Prerequisites
- FHIR server implementing US Core MedicationRequest Profile
- Test system capable of retrieving MedicationRequest resources
- Valid patient data with existing MedicationRequest resources
- Server must support US Core MedicationRequest Profile operations as defined in the Capability Statement

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: MedicationRequest resources from the system under test
- **Patient Context**: Valid patient ID to retrieve associated MedicationRequest resources
- **Server Endpoint**: Base FHIR server URL supporting US Core Server capabilities

### Expected Outputs
- MedicationRequest resources that contain either:
  - `medicationCodeableConcept` with valid medication coding, OR
  - `medicationReference` with valid reference to a Medication resource
- All retrieved MedicationRequest resources must specify medication information

### Required FHIR Operations
Based on the US Core Server Capability Statement, the following operations are supported and required for testing:

1. **Search MedicationRequest by Patient**:
   ```
   GET [base]/MedicationRequest?patient=[patient-id]&intent=order&status=active
   ```

2. **Read Individual MedicationRequest**:
   ```
   GET [base]/MedicationRequest/[id]
   ```

3. **Include Medication Resources** (if using medicationReference):
   ```
   GET [base]/MedicationRequest?patient=[patient-id]&_include=MedicationRequest:medication
   ```

### Validation Criteria

#### Primary Validation
For each MedicationRequest resource retrieved:

1. **Medication Presence Check**:
   - Verify that either `medicationCodeableConcept` OR `medicationReference` is present
   - Ensure at least one medication specification method exists per the US Core profile requirements

2. **MedicationCodeableConcept Validation** (when present):
   - Verify `medicationCodeableConcept.coding` contains at least one coding
   - Validate that coding includes appropriate medication code systems (RxNorm preferred)
   - Ensure coding has both `system` and `code` values populated

3. **MedicationReference Validation** (when present):
   - Verify `medicationReference.reference` is properly formatted
   - If external reference, confirm the referenced Medication resource is accessible
   - If contained resource, verify the Medication resource exists within the MedicationRequest

#### Secondary Validation
4. **Profile Conformance**:
   - Confirm MedicationRequest conforms to US Core MedicationRequest Profile
   - Verify resource includes required must-support elements as per US Core specification

5. **Data Consistency**:
   - When using `medicationReference`, verify the reference resolves to a valid Medication resource
   - Ensure medication information is clinically meaningful and not just placeholder data

#### Test Passing Criteria
- **Pass**: All retrieved MedicationRequest resources specify medication through either `medicationCodeableConcept` or `medicationReference`
- **Fail**: Any MedicationRequest resource lacks both `medicationCodeableConcept` and `medicationReference`
- **Fail**: Present medication elements contain invalid or empty values
- **Fail**: Referenced Medication resources are inaccessible or invalid

#### Edge Cases to Consider
- Handle cases where MedicationRequest uses contained Medication resources
- Verify behavior when medication information uses multiple coding systems
- Test with various medication code systems beyond RxNorm (NDC, etc.)
- Validate proper handling of medication references that may be relative or absolute URLs

---

<a id='req-188'></a>

### REQ-188: MedicationRequest SHALL include dosage instructions.

**Text**: 

**Context**: 

**Actor**: MedicationRequest

**Conformance**: SHALL

# Test Specification for REQ-188

## 1. Requirement ID
**REQ-188**: MedicationRequest SHALL include dosage instructions.

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified programmatically by checking for the presence of dosage instructions in MedicationRequest resources.

### Complexity
**Simple** - The test involves checking for the presence of a specific element (`dosageInstruction`) in MedicationRequest resources.

### Prerequisites
- System must support the US Core MedicationRequest Profile
- System must have MedicationRequest resources available for testing
- Test client must have appropriate access permissions to read MedicationRequest resources
- System must support the search operations defined in the US Core Server Capability Statement for MedicationRequest

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: MedicationRequest resources that conform to the US Core MedicationRequest Profile
- **Test Data**: Any existing MedicationRequest resources in the system under test
- **Access Credentials**: Valid authentication/authorization to access the FHIR server

### Expected Outputs
- **Pass**: All retrieved MedicationRequest resources contain at least one `dosageInstruction` element
- **Fail**: One or more MedicationRequest resources are missing the `dosageInstruction` element

### Required FHIR Operations
Based on the US Core Server Capability Statement, the following supported operations will be used:

1. **Search MedicationRequest resources**:
   ```
   GET [base]/MedicationRequest?patient=[patient-id]&intent=[intent-value]
   ```

2. **Read individual MedicationRequest resources**:
   ```
   GET [base]/MedicationRequest/[id]
   ```

### Validation Criteria

#### Primary Validation
For each MedicationRequest resource retrieved:

1. **Dosage Instruction Presence Check**:
   - Verify that `MedicationRequest.dosageInstruction` element exists
   - Verify that the `dosageInstruction` array is not empty (contains at least one entry)
   
2. **Profile Conformance**:
   - Verify that the MedicationRequest resource declares conformance to the US Core MedicationRequest Profile in `meta.profile`

#### Test Execution Steps

1. **Discovery Phase**:
   - Query the server to retrieve MedicationRequest resources using supported search parameters
   - Use patient-based searches as required by the capability statement: `patient + intent`
   - If no patient context is available, use alternative supported searches

2. **Validation Phase**:
   - For each retrieved MedicationRequest resource:
     - Check for the presence of `dosageInstruction` element
     - Verify the element is not null or empty
     - Validate that at least one dosage instruction entry exists

3. **Reporting**:
   - Document any MedicationRequest resources that fail the dosage instruction requirement
   - Provide resource IDs and specific failure details
   - Calculate pass/fail rate across all tested resources

#### Assertion Logic
```
PASS IF: 
- MedicationRequest.dosageInstruction exists AND
- MedicationRequest.dosageInstruction is not empty (length > 0)

FAIL IF:
- MedicationRequest.dosageInstruction is missing OR
- MedicationRequest.dosageInstruction is empty (length = 0)
```

#### Edge Cases to Consider
- Contained vs. external Medication references (both should have dosage instructions)
- Different intent values (order, plan, etc.) - all should include dosage instructions
- Various status values - requirement applies regardless of status

#### Success Criteria
- **100% compliance**: All MedicationRequest resources in the system contain dosage instructions
- **Profile conformance**: All tested resources properly declare conformance to US Core MedicationRequest Profile
- **No exceptions**: The requirement uses SHALL conformance, so no exceptions are acceptable

---

<a id='req-189'></a>

### REQ-189: MedicationRequest SHALL specify the dispense request details.

**Text**: 

**Context**: 

**Actor**: MedicationRequest

**Conformance**: SHALL

# Test Specification for REQ-189

## 1. Requirement ID
**REQ-189**: MedicationRequest SHALL specify the dispense request details.

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified through automated validation of MedicationRequest resource structure and content, specifically checking for the presence and completeness of dispense request details.

### Complexity
**Simple** - The requirement involves straightforward validation of specific fields within the MedicationRequest resource.

### Prerequisites
- System must support US Core MedicationRequest profile
- System must have MedicationRequest resources available for testing
- System must support FHIR R4 JSON format (required by capability statement)
- System must implement proper security controls (HTTP 401/403/404 responses for unauthorized access)

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: MedicationRequest resources that should contain dispense request details
- **System Access**: Authenticated access to the FHIR server with appropriate scopes
- **Expected Profile**: Resources should conform to US Core MedicationRequest profile

### Required FHIR Operations
Based on the US Core Server Capability Statement, the following operations are supported:
- **GET** operations to retrieve MedicationRequest resources
- **Search** operations to query MedicationRequest resources (if search parameters are defined in the capability statement)

### Validation Criteria

#### Primary Assertions (SHALL requirements):

1. **Dispense Request Presence Validation**:
   - Assert that `MedicationRequest.dispenseRequest` element is present
   - Verify the element is not empty or null

2. **Dispense Request Detail Completeness**:
   - Validate that `dispenseRequest.quantity` is specified when applicable
   - Check that `dispenseRequest.numberOfRepeatsAllowed` is present when relevant
   - Verify `dispenseRequest.expectedSupplyDuration` is included when appropriate
   - Confirm `dispenseRequest.performer` is specified if dispenser information is required

3. **Profile Conformance**:
   - Verify the MedicationRequest conforms to the US Core MedicationRequest profile
   - Check that `meta.profile` includes the US Core MedicationRequest profile URL (SHOULD requirement from capability statement)

4. **Data Format Validation**:
   - Confirm the resource is returned in JSON format (SHALL requirement from capability statement)
   - Validate proper FHIR R4 structure

#### Secondary Assertions (Error Handling):

5. **Security Response Validation**:
   - Verify system returns appropriate HTTP status codes for unauthorized requests (400, 401, 403, 404)
   - Confirm proper error responses when accessing MedicationRequest resources without sufficient permissions

#### Test Execution Approach:

1. **Resource Retrieval Test**:
   - Retrieve existing MedicationRequest resources from the system
   - Apply validation criteria to each resource
   - Document any resources that lack required dispense request details

2. **Search-based Test** (if supported):
   - Use search parameters to find MedicationRequest resources
   - Validate dispense request details across the result set
   - Ensure consistent implementation across all returned resources

3. **Profile Validation Test**:
   - Validate each MedicationRequest against the US Core profile requirements
   - Check for Must Support elements as defined in the US Core specification
   - Verify resource references comply with US Core requirements

#### Pass/Fail Criteria:
- **Pass**: All MedicationRequest resources contain properly populated dispenseRequest elements with required details
- **Fail**: Any MedicationRequest resource lacks dispenseRequest element or contains incomplete dispense request information
- **Partial Pass**: System implements requirement correctly but has minor issues with profile conformance or optional elements

#### Notes for "Bring Your Own Data" Approach:
- Test should work with any valid MedicationRequest data provided by the tester
- Validation should focus on structural requirements rather than specific clinical content
- Test should accommodate various medication types and prescription scenarios
- Results should clearly identify which specific dispense request details are missing or incomplete

---

<a id='req-468'></a>

### REQ-468: US Core MedicationRequest Profile implementation

**Text**: 

**Context**: System conformance to US Core MedicationRequest Profile.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-468

## 1. Requirement ID
REQ-468: US Core MedicationRequest Profile implementation

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated testing by validating MedicationRequest resources against the US Core MedicationRequest Profile and testing conformance to profile constraints.

### Complexity
**Moderate** - Requires validation of profile conformance, Must Support elements, and proper resource structure, but follows established US Core testing patterns.

### Prerequisites
- System must have MedicationRequest resources available for testing
- System must implement US Core Server capabilities as defined in the CapabilityStatement
- System must support JSON format (required) and optionally XML format
- System must implement proper security controls (authentication/authorization)
- Test client must have appropriate access credentials and scopes

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: MedicationRequest resources conforming to US Core MedicationRequest Profile stored in the system under test
- **Test Parameters**: 
  - Base FHIR server URL
  - Authentication credentials/tokens with appropriate scopes
  - Patient identifiers for resources that should exist in the system

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and should be tested:

1. **GET /MedicationRequest/[id]** - Read individual MedicationRequest resources
2. **GET /MedicationRequest?[search-parameters]** - Search for MedicationRequest resources using supported search parameters
3. **GET /Patient/[id]/MedicationRequest** - Retrieve MedicationRequest resources for specific patients (if supported)

### Validation Criteria

#### Profile Conformance Validation
- **Assertion 1**: All returned MedicationRequest resources SHALL validate against the US Core MedicationRequest Profile
- **Assertion 2**: Resources SHALL include `meta.profile` element identifying the US Core MedicationRequest Profile (SHOULD requirement)
- **Assertion 3**: All Must Support elements defined in the US Core MedicationRequest Profile SHALL be present when data is available

#### Resource Structure Validation  
- **Assertion 4**: MedicationRequest resources SHALL contain all required elements as defined by the profile
- **Assertion 5**: All referenced resources (e.g., Patient, Practitioner, Medication) SHALL conform to their respective US Core profiles when present
- **Assertion 6**: Value sets and code systems SHALL be used as specified in the profile constraints

#### API Response Validation
- **Assertion 7**: System SHALL return appropriate HTTP status codes:
  - 200 OK for successful requests
  - 400 Bad Request for invalid parameters  
  - 401/403/404 for unauthorized/forbidden/not found scenarios
- **Assertion 8**: System SHALL support JSON format responses
- **Assertion 9**: Response structure SHALL follow FHIR R4 specification requirements

#### Search Functionality Validation
- **Assertion 10**: System SHALL support search parameters defined in the US Core MedicationRequest Profile
- **Assertion 11**: Search results SHALL only return resources that match the search criteria
- **Assertion 12**: Search results SHALL be properly formatted as FHIR Bundle resources

#### Security Validation
- **Assertion 13**: System SHALL properly authenticate requests and reject unauthorized access
- **Assertion 14**: System SHALL respect authorization scopes and return appropriate error responses for insufficient permissions

### Test Execution Approach
1. **Discovery Phase**: Query the system to identify available MedicationRequest resources
2. **Individual Resource Testing**: Retrieve individual MedicationRequest resources and validate profile conformance
3. **Search Testing**: Execute search operations using various parameters and validate results
4. **Reference Validation**: Verify that referenced resources conform to their respective US Core profiles
5. **Error Handling Testing**: Test system behavior with invalid requests and insufficient permissions
6. **Format Testing**: Verify JSON support (required) and XML support (optional)

### Success Criteria
The test passes when all assertions are met, demonstrating that the system correctly implements the US Core MedicationRequest Profile with proper profile conformance, Must Support element handling, appropriate API responses, and security controls.

---

<a id='req-520'></a>

### REQ-520: US Core Client SHALL fetch MedicationRequest resources.

**Text**: 

**Context**: US Core Client read interaction for MedicationRequest by id

**Actor**: US Core Client

**Conformance**: SHALL

# REQ-520 Test Specification

## 1. Requirement ID
REQ-520

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be objectively tested by verifying that a US Core Client can successfully perform read interactions on MedicationRequest resources using the resource ID.

### Complexity
**Simple** - This is a basic FHIR read operation that requires minimal setup and validation steps.

### Prerequisites
- US Core Server implementation supporting MedicationRequest resources
- Valid MedicationRequest resource(s) existing on the server with known resource IDs
- Client system configured to communicate with the US Core Server
- Appropriate authentication/authorization credentials if required by the server

## 3. Test Implementation Strategy

### Required Inputs
- **Server Base URL**: The base URL of the US Core Server endpoint
- **MedicationRequest Resource ID(s)**: One or more valid MedicationRequest resource identifiers that exist on the server
- **Authentication Credentials**: If required by the server implementation

### Expected Outputs
- **HTTP Response**: Status code 200 (OK) for successful retrieval
- **FHIR MedicationRequest Resource**: Valid MedicationRequest resource in JSON format (XML format may also be supported)
- **Content-Type Header**: Appropriate FHIR media type (application/fhir+json or application/fhir+xml)

### Required FHIR Operations
- **READ**: `GET [base]/MedicationRequest/[id]`
  - This operation is supported as part of the US Core Server capability requirements

### Validation Criteria

#### HTTP Response Validation
1. **Status Code**: Response SHALL return HTTP status 200 (OK) for existing resources
2. **Content-Type**: Response SHALL include appropriate FHIR media type header
3. **Response Body**: Response SHALL contain a valid FHIR resource

#### Resource Validation
1. **Resource Type**: Retrieved resource SHALL be of type "MedicationRequest"
2. **Resource ID**: Retrieved resource's ID SHALL match the requested ID
3. **FHIR Validity**: Resource SHALL be valid according to FHIR R4 specification
4. **US Core Profile Conformance**: Resource SHOULD conform to the US Core MedicationRequest profile (if meta.profile is populated)

#### Error Handling Validation
1. **Invalid ID**: Client SHALL handle HTTP 404 responses appropriately when requesting non-existent resource IDs
2. **Authentication**: Client SHALL handle HTTP 401/403 responses appropriately when authentication fails or insufficient permissions exist
3. **Server Errors**: Client SHALL handle HTTP 500 series responses gracefully

#### Test Pass Criteria
- Client successfully retrieves at least one MedicationRequest resource using the read operation
- All HTTP response validations pass
- All resource validations pass
- Client demonstrates appropriate error handling for common failure scenarios

#### Test Scenarios
1. **Primary Success Case**: Retrieve existing MedicationRequest by valid ID
2. **Not Found Case**: Attempt to retrieve MedicationRequest with non-existent ID (verify appropriate handling of 404 response)
3. **Multiple Resource Test**: If multiple MedicationRequest IDs are available, verify client can fetch multiple different resources successfully

---



<a id='observation'></a>

## Observation

<a id='req-003'></a>

### REQ-003: Observation SHALL have a status of "Final"

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-003

## 1. Requirement ID
**REQ-003**: Observation SHALL have a status of "Final"

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be programmatically verified by checking the `status` field value in Observation resources.

### Complexity
**Simple** - Single field validation requiring a straightforward string comparison.

### Prerequisites
- System must support Observation resource retrieval
- Test data must include Observation resources (any clinical observations will suffice for "bring your own data" approach)
- System must implement US Core Server capabilities as defined in the CapabilityStatement

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Any existing Observation resources in the system under test
- **System Capability**: US Core Server implementation supporting Observation resource operations
- **Test Data**: No specific fixtures required - test will work with any Observation resources present in the system

### Expected Outputs
- All retrieved Observation resources must have `status` field set to `"final"`
- HTTP 200 responses for successful resource retrieval
- Valid FHIR Observation resources in response payload

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations will be utilized:

1. **GET [base]/Observation** - Search for Observation resources
2. **GET [base]/Observation/[id]** - Read specific Observation resources (if individual resource testing is needed)

*Note: These operations are supported as the US Core Server CapabilityStatement indicates support for Observation resources and standard RESTful operations.*

### Validation Criteria

#### Primary Assertion
For each Observation resource retrieved:
- **PASS**: `Observation.status` field exists AND equals `"final"`
- **FAIL**: `Observation.status` field is missing, null, or contains any value other than `"final"`

#### Test Steps
1. **Discovery Phase**: Query the system for available Observation resources using search operations
2. **Validation Phase**: For each Observation resource found:
   - Extract the `status` field value
   - Verify the value is exactly `"final"` (case-sensitive)
   - Record any non-conformant instances

#### Success Criteria
- **100% Pass Rate**: ALL Observation resources in the system must have status = "final"
- **No Exceptions**: The requirement uses "SHALL" conformance, indicating no conditional logic or exceptions

#### Error Conditions to Report
- Observation resources with missing `status` field
- Observation resources with `status` values other than `"final"` (e.g., "preliminary", "registered", "cancelled", "entered-in-error", "unknown")
- Invalid or malformed Observation resources that cannot be parsed

#### Test Scope Considerations
- Test applies to all Observation resources accessible through the FHIR API
- Test should accommodate any volume of Observation resources (scalable approach)
- Test should work regardless of the clinical content or type of observations present
- Test focuses on conformance validation rather than clinical data validation

---

<a id='req-004'></a>

### REQ-004: Observation SHALL include a category of "Social History" or "Physical Activity"

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-004

## Requirement ID
REQ-004

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified programmatically by checking the `category` field in Observation resources for the presence of specific coded values.

### Complexity
**Simple** - The requirement involves a straightforward validation of a single field (`category`) against two specific allowed values.

### Prerequisites
- System must support US Core Observation profiles as indicated in the Capability Statement
- System must be capable of returning Observation resources via FHIR REST API
- Test data must include Observation resources that claim conformance to profiles requiring this category constraint

## Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources from the system under test
- **Expected Profile Context**: Observations that are subject to the "Social History" or "Physical Activity" category requirement (likely related to exercise/physical activity observations based on the source file name)
- **System Access**: REST API endpoint supporting Observation resource queries

### Required FHIR Operations
Based on the Capability Statement, the following supported operations will be used:

1. **GET /Observation** - Retrieve Observation resources
   - Supported search parameters: `category`, `patient`, `code`, `date`, `status`
   - Use `category` search parameter to filter for relevant observations
   - Use combination searches like `patient+category` if needed

2. **GET /Observation/[id]** - Retrieve specific Observation resources by ID

### Validation Criteria

#### Test Case 1: Verify Category Presence and Values
**Objective**: Confirm that applicable Observation resources contain the required category values

**Test Steps**:
1. Query the system for Observation resources that should be subject to this requirement
2. For each returned Observation resource:
   - Verify that the `category` element is present
   - Verify that at least one category entry contains a coding with:
     - System: `http://terminology.hl7.org/CodeSystem/observation-category`
     - Code: either `social-history` or `physical-activity`

**Assertions**:
- `Observation.category` SHALL be present
- At least one `Observation.category.coding` SHALL have:
  - `system` = `http://terminology.hl7.org/CodeSystem/observation-category`
  - `code` = `social-history` OR `code` = `physical-activity`

#### Test Case 2: Category Search Validation
**Objective**: Verify that category-based searches work correctly and return appropriate resources

**Test Steps**:
1. Perform search: `GET /Observation?category=social-history`
2. Perform search: `GET /Observation?category=physical-activity`
3. Validate that returned resources actually contain the requested category

**Assertions**:
- Search results SHALL only include Observations with the requested category
- All returned resources SHALL conform to the category requirement
- Search functionality SHALL work as documented in the Capability Statement

#### Test Case 3: Profile Conformance Validation
**Objective**: Ensure that Observations claiming conformance to relevant profiles meet the category requirement

**Test Steps**:
1. Identify Observations that declare conformance to profiles requiring this category constraint
2. Validate category compliance for each such Observation
3. Check that the category values align with the profile's intended use case

**Assertions**:
- Observations declaring conformance to exercise/physical activity profiles SHALL have appropriate categories
- Category values SHALL be consistent with the profile's clinical intent
- No Observations SHALL claim profile conformance without meeting the category requirement

#### Pass/Fail Criteria
- **PASS**: All tested Observation resources contain at least one category with the required values (`social-history` or `physical-activity`)
- **FAIL**: Any Observation resource subject to this requirement lacks the required category or contains only other category values
- **FAIL**: System returns Observations in category-based searches that don't actually contain the requested category
- **FAIL**: Any validation errors occur when processing the category field structure

#### Notes for Implementation
- Test should accommodate "bring your own data" by focusing on validation logic rather than specific test fixtures
- Consider testing with both single and multiple category values per Observation
- Verify that the category coding system URI is correctly specified
- Test should be flexible enough to work with various Observation types that may require these categories

---

<a id='req-005'></a>

### REQ-005: Observation SHALL have a code of "Exercise Minutes Per Day"

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-005

## 1. Requirement ID
**REQ-005**: Observation SHALL have a code of "Exercise Minutes Per Day"

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be validated programmatically by examining the Observation.code field to verify it contains the specific code value "Exercise Minutes Per Day".

### Complexity
**Simple** - This is a straightforward validation of a single code field within an Observation resource.

### Prerequisites
- System must support US Core Server capabilities as defined in the CapabilityStatement
- System must have Observation resources available for testing
- Test system must be able to perform FHIR RESTful read operations on Observation resources
- Access to Observation resources that are intended to represent exercise minutes per day data

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- One or more Observation resources that are intended to capture "Exercise Minutes Per Day" data

**Expected Outputs:**
- Validation results indicating whether each tested Observation resource contains the required code
- Pass/Fail status for the overall requirement

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are supported and may be used:

1. **GET [base]/Observation/[id]** - Read specific Observation resources by ID
2. **GET [base]/Observation** - Search for Observation resources (with appropriate search parameters)

*Note: The specific operations used will depend on how the test data is identified and accessed in the "bring your own data" approach.*

### Validation Criteria

**Primary Assertion:**
For each Observation resource being tested for this requirement:
- The `Observation.code` field SHALL contain a coding with the display value "Exercise Minutes Per Day"

**Specific Validation Steps:**
1. **Code Presence Check**: Verify that `Observation.code` exists and is not null
2. **Code Value Validation**: Verify that within `Observation.code.coding[]`, at least one coding element contains:
   - `coding.display = "Exercise Minutes Per Day"` (exact match, case-sensitive)
3. **Alternative Code Representations**: If the code uses a specific code system (e.g., LOINC, SNOMED CT), verify the appropriate code value matches the semantic meaning of "Exercise Minutes Per Day"

**Pass Criteria:**
- ALL tested Observation resources that are intended to capture exercise minutes per day data contain the required code specification
- The code is properly structured within the FHIR Observation.code element

**Fail Criteria:**
- ANY tested Observation resource lacks the required "Exercise Minutes Per Day" code
- The code is present but incorrectly formatted or placed in the wrong location within the resource
- The code uses different terminology that doesn't exactly match "Exercise Minutes Per Day"

**Test Execution Notes:**
- Testers should identify which Observation resources in their data set are intended to represent exercise minutes per day measurements
- The test should be applied only to those specific Observation resources, not all Observation resources in the system
- Consider case sensitivity and exact string matching for the display value
- Document any alternative code systems or code values used if they semantically represent "Exercise Minutes Per Day"

---

<a id='req-006'></a>

### REQ-006: Observation SHALL include a category of "Social History"

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-006

## Requirement ID
REQ-006

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated FHIR resource validation by checking the `category` element of Observation resources.

### Complexity
**Simple** - The requirement involves a straightforward validation of a single element (`Observation.category`) containing a specific value.

### Prerequisites
- System must support US Core Observation profiles (as confirmed in Capability Statement)
- System must have Observation resources available for testing
- Test system must be able to query and retrieve Observation resources
- Observation resources should be related to pregnancy intent context based on the source file reference

## Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources that conform to the US Core Observation Pregnancy Intent Profile
- **Test Data**: Any existing Observation resources in the system that represent pregnancy intent information
- **System Access**: Authenticated access to the FHIR server with appropriate permissions

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required:

1. **Search Operation**: `GET [base]/Observation?patient=[patient-id]&category=social-history`
   - Uses the SHALL support search parameter combination: `patient + category`
   
2. **Read Operation**: `GET [base]/Observation/[id]`
   - Uses the SHALL support read interaction

3. **Alternative Search**: `GET [base]/Observation?patient=[patient-id]&code=[pregnancy-intent-code]`
   - Uses the SHALL support search parameter combination: `patient + code`

### Validation Criteria

#### Primary Validation
For each Observation resource identified as related to pregnancy intent:

1. **Category Presence Check**:
   - Verify that `Observation.category` element exists
   - Verify that `Observation.category` is not empty

2. **Social History Category Validation**:
   - Verify that `Observation.category` contains a coding with:
     - `system`: "http://terminology.hl7.org/CodeSystem/observation-category"
     - `code`: "social-history"
   - Alternative: Verify that `Observation.category` contains a coding with `display` value of "Social History"

3. **Conformance to Profile**:
   - Verify that the Observation resource validates against the US Core Observation Pregnancy Intent Profile
   - Confirm that other required elements per the profile are present

#### Test Pass Criteria
- **PASS**: All Observation resources representing pregnancy intent contain the required "social-history" category
- **FAIL**: Any Observation resource representing pregnancy intent is missing the "social-history" category or contains an incorrect category value

#### Test Execution Steps
1. **Discovery Phase**:
   - Query for Observation resources using available search parameters
   - Filter for resources that appear to represent pregnancy intent (based on code or context)

2. **Validation Phase**:
   - For each identified Observation resource:
     - Retrieve the complete resource using read operation
     - Validate the presence and correctness of the category element
     - Record any non-conformant resources

3. **Reporting Phase**:
   - Document all tested resources
   - Report any failures with specific resource IDs and missing/incorrect category values
   - Provide summary of conformance status

#### Additional Considerations
- The test should accommodate any pregnancy intent-related Observation codes that may be present in the system
- The test should verify that the category is correctly structured as a CodeableConcept with appropriate coding elements
- Multiple categories may be present; the test should pass if "social-history" is among them

---

<a id='req-007'></a>

### REQ-007: Observation SHALL have a code of "Pregnancy Intent"

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-007

## 1. Requirement ID
**REQ-007**

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified programmatically by inspecting the `code` element of Observation resources that claim to conform to the US Core Observation Pregnancy Intent Profile.

### Complexity
**Simple** - The test involves a straightforward validation of a single element's value against a specific code requirement.

### Prerequisites
- System must support the US Core Observation Pregnancy Intent Profile (StructureDefinition-us-core-observation-pregnancyintent)
- System must have Observation resources that represent pregnancy intent information
- Test data should include at least one Observation resource conforming to the pregnancy intent profile

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources that claim conformance to the US Core Observation Pregnancy Intent Profile
- **Profile URL**: `http://hl7.org/fhir/us/core/StructureDefinition/us-core-observation-pregnancyintent`
- **Expected Code System**: The specific code system and code values defined for "Pregnancy Intent" in the US Core IG

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for Observation resources:

1. **Search Operation**: 
   - `GET [base]/Observation?patient=[patient-id]&category=[category]`
   - `GET [base]/Observation?patient=[patient-id]&code=[pregnancy-intent-code]`

2. **Read Operation**:
   - `GET [base]/Observation/[id]` for individual Observation resources

3. **Search by Profile** (if supported):
   - `GET [base]/Observation?_profile=http://hl7.org/fhir/us/core/StructureDefinition/us-core-observation-pregnancyintent`

### Validation Criteria

#### Primary Assertions:
1. **Profile Conformance Check**: Verify that Observation resources claiming to represent pregnancy intent declare conformance to the US Core Observation Pregnancy Intent Profile in their `meta.profile` element

2. **Code Validation**: For each Observation resource conforming to the pregnancy intent profile:
   - Verify `Observation.code` element is present and populated
   - Verify `Observation.code` contains a coding that represents "Pregnancy Intent"
   - Verify the code system and code value match the requirements specified in the US Core Observation Pregnancy Intent Profile

3. **Mandatory Elements**: Ensure other required elements per the profile are present (patient reference, status, category, etc.)

#### Test Scenarios:

**Scenario 1: Search-based Validation**
- Execute search for Observation resources with pregnancy intent category/code
- Validate each returned resource has the required "Pregnancy Intent" code
- Verify proper profile declaration

**Scenario 2: Individual Resource Validation**
- For each Observation resource identified as pregnancy intent related
- Retrieve the resource individually using READ operation
- Validate the `code` element contains the required "Pregnancy Intent" coding

**Scenario 3: Code System Verification**
- Verify that the code system used for the pregnancy intent code aligns with US Core requirements
- Confirm that the specific code value represents pregnancy intent as defined in the implementation guide

#### Success Criteria:
- **PASS**: All Observation resources claiming pregnancy intent profile conformance have a `code` element with appropriate "Pregnancy Intent" coding
- **FAIL**: Any Observation resource conforming to the pregnancy intent profile lacks the required code or has an incorrect code value
- **NOT APPLICABLE**: No Observation resources found that claim conformance to the pregnancy intent profile

#### Error Conditions to Report:
- Missing `code` element in pregnancy intent observations
- Incorrect code system or code value for pregnancy intent
- Missing profile declaration in resources that should represent pregnancy intent
- Inconsistent coding between search results and individual resource retrieval

---

<a id='req-008'></a>

### REQ-008: Observation SHALL have a code of "Pregnancy Status"

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-008

## 1. Requirement ID
**REQ-008**: Observation SHALL have a code of "Pregnancy Status"

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated validation of Observation resources to ensure they contain the appropriate "Pregnancy Status" code.

### Complexity
**Simple** - The requirement involves checking a single code field within Observation resources.

### Prerequisites
- US Core Server implementing the US Core Observation Pregnancy Status Profile
- Test system with access to Observation resources containing pregnancy status data
- Patient data that includes pregnancy status observations

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: 
  - Observation resources conforming to US Core Observation Pregnancy Status Profile
  - Associated Patient resources for context
- **System Configuration**: US Core Server supporting Observation resource operations
- **Test Data**: Existing pregnancy status observations in the system under test

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required for testing:

1. **GET [base]/Observation/[id]** - Read specific Observation resources
2. **GET [base]/Observation?patient=[id]&category=survey** - Search for Observation resources by patient and category
3. **GET [base]/Observation?patient=[id]&code=[code]** - Search for Observation resources by patient and specific code

### Validation Criteria

#### Test Case 1: Direct Resource Validation
**Objective**: Verify that Observation resources representing pregnancy status contain the correct code

**Test Steps**:
1. Retrieve Observation resources that represent pregnancy status using `GET [base]/Observation/[id]`
2. For each retrieved Observation resource:
   - Verify `Observation.code.coding` contains a code indicating "Pregnancy Status"
   - Acceptable code systems and codes include:
     - LOINC code "82810-3" (Pregnancy status)
     - SNOMED CT codes related to pregnancy status
   - Verify the code is properly structured with system, code, and display values

**Pass Criteria**:
- All pregnancy status Observation resources contain appropriate pregnancy status codes
- Code structure includes required elements (system, code)
- Codes are from recognized terminologies (LOINC, SNOMED CT)

#### Test Case 2: Search-Based Validation
**Objective**: Verify that pregnancy status observations can be retrieved using code-based searches

**Test Steps**:
1. Execute search: `GET [base]/Observation?patient=[patient-id]&code=82810-3` (using LOINC pregnancy status code)
2. Execute search: `GET [base]/Observation?patient=[patient-id]&category=survey` and filter results for pregnancy status
3. For each returned Observation:
   - Verify the resource conforms to US Core Observation Pregnancy Status Profile
   - Confirm `Observation.code` contains pregnancy status coding

**Pass Criteria**:
- Search operations return appropriate Observation resources
- All returned resources contain valid pregnancy status codes
- Resources conform to the expected US Core profile

#### Test Case 3: Profile Conformance Validation
**Objective**: Ensure Observation resources claiming to represent pregnancy status conform to the US Core Observation Pregnancy Status Profile

**Test Steps**:
1. Retrieve Observation resources using supported search parameters
2. For resources identified as pregnancy status observations:
   - Validate conformance to US Core Observation Pregnancy Status Profile
   - Verify `Observation.code` contains pregnancy status codes as defined in the profile
   - Check that required elements per the profile are present

**Pass Criteria**:
- All pregnancy status Observation resources validate against the US Core Observation Pregnancy Status Profile
- Required elements are present and properly populated
- Code bindings align with profile requirements

#### Negative Test Case: Invalid Code Detection
**Objective**: Verify that Observation resources claiming to be pregnancy status contain appropriate codes (not generic or unrelated codes)

**Test Steps**:
1. Review Observation resources in the system
2. Identify any resources that might be intended to represent pregnancy status but use incorrect or generic codes
3. Verify that actual pregnancy status observations use specific pregnancy status codes rather than generic observation codes

**Pass Criteria**:
- No pregnancy status observations use generic or inappropriate codes
- All pregnancy status data is properly coded with specific pregnancy status terminologies

### Expected Outcomes
- **Pass**: All Observation resources representing pregnancy status contain appropriate "Pregnancy Status" codes from recognized code systems (LOINC, SNOMED CT)
- **Fail**: Any Observation resource intended to represent pregnancy status lacks the proper pregnancy status code or uses inappropriate/generic coding
- **Not Applicable**: No pregnancy status data exists in the system under test

### Notes
- This test accommodates a "bring your own data" approach by working with whatever pregnancy status observations exist in the test system
- The test focuses on interoperability conformance rather than clinical accuracy
- Multiple code systems are acceptable as long as they appropriately represent pregnancy status concepts

---

<a id='req-009'></a>

### REQ-009: Observation SHALL include a category of "Exam"

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-009

## Requirement ID
REQ-009

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated through automated inspection of Observation resources to verify the presence and value of the category element.

### Complexity
**Simple** - The requirement is straightforward, requiring verification of a single element value within Observation resources.

### Prerequisites
- System under test must implement US Core Server capabilities for Observation resources
- System must have Observation resources available for testing (bring your own data approach)
- The Observation resources should represent heart rate rhythm measurements based on the source context

## Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: One or more Observation resources that represent heart rate rhythm measurements
- **Test Data**: Any existing Observation resources in the system that are intended to represent heart rate rhythm data
- **Expected Output**: All tested Observation resources must contain a category element with the value "exam"

### Required FHIR Operations
Based on the US Core Server Capability Statement, the following operations are supported and required for testing:

1. **READ Operation**: `GET [base]/Observation/[id]`
   - Used to retrieve specific Observation resources for validation
   
2. **SEARCH Operation**: `GET [base]/Observation?patient=[patient-id]&category=exam`
   - Used to discover Observation resources that should have the "exam" category
   - Leverages the SHALL support for `patient+category` search parameter combination

3. **SEARCH Operation**: `GET [base]/Observation?patient=[patient-id]&code=[heart-rate-rhythm-code]`
   - Used to identify heart rate rhythm observations specifically
   - Leverages the SHALL support for `patient+code` search parameter combination

### Validation Criteria

#### Primary Validation
For each Observation resource identified as a heart rate rhythm measurement:

1. **Category Element Presence**: 
   - Assert that `Observation.category` element exists
   - Assert that the category array is not empty

2. **Category Value Validation**:
   - Assert that at least one category coding has the code "exam"
   - The system should be "http://terminology.hl7.org/CodeSystem/observation-category" (if system is provided)
   - Accept either:
     - `Observation.category.coding.code = "exam"` 
     - `Observation.category.text = "Exam"` (if only text is provided)

#### Test Execution Steps

1. **Discovery Phase**:
   - Execute patient-based searches to identify available Observation resources
   - Filter for heart rate rhythm observations using appropriate LOINC codes or clinical context
   - Alternatively, use any provided Observation IDs that represent heart rate rhythm data

2. **Validation Phase**:
   - For each identified Observation resource:
     - Retrieve the full resource using READ operation
     - Inspect the `category` element
     - Verify the presence of "exam" category value
     - Record any non-conformant resources

3. **Reporting Phase**:
   - **PASS**: All heart rate rhythm Observation resources contain category "exam"
   - **FAIL**: One or more heart rate rhythm Observation resources lack the required "exam" category
   - **NOT APPLICABLE**: No heart rate rhythm Observation resources found for testing

#### Error Conditions to Handle
- Observation resource exists but has no category element
- Category element exists but contains no codings with "exam" value
- Category element contains "exam" but with incorrect capitalization (should be treated as non-conformant)
- Network or authorization errors during resource retrieval

#### Implementation Notes
- The test should be flexible enough to work with any heart rate rhythm Observation data present in the system
- The test should not assume specific patient IDs or Observation IDs
- The test should handle both contained and referenced Patient resources appropriately
- Consider that systems may use different LOINC codes for heart rate rhythm measurements

---

<a id='req-010'></a>

### REQ-010: Observation SHALL have a code of "Heart rate rhythm"

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-010

## 1. Requirement ID
REQ-010

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated validation of the Observation resource's code element against the specified value "Heart rate rhythm".

### Complexity
**Simple** - The requirement involves a straightforward validation of a single code element within an Observation resource.

### Prerequisites
- System must support US Core Observation profiles (as indicated in Capability Statement section 14.3.3.20)
- System must have Observation resources with heart rate rhythm measurements available
- System must support Observation read operations (`GET [base]/Observation/[id]`)
- Test data must include at least one Observation resource representing heart rate rhythm

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: One or more Observation resources that represent heart rate rhythm measurements
- **System Capability**: Access to a FHIR server implementing US Core Server CapabilityStatement
- **Data Requirements**: Observation resources in the test dataset that are intended to represent "Heart rate rhythm" measurements

### Required FHIR Operations
Based on the Capability Statement, the following supported operations will be used:
- `GET [base]/Observation/[id]` - Read operation to retrieve specific Observation resources
- `GET [base]/Observation?patient=[patient-id]&code=[code]` - Search operation to find heart rate rhythm observations (supported as per Capability Statement search parameters)

### Validation Criteria

#### Primary Validation
For each Observation resource identified as representing heart rate rhythm:

1. **Code Presence Validation**:
   - Verify that `Observation.code` element is present
   - Verify that `Observation.code` is not null or empty

2. **Code Value Validation**:
   - Verify that `Observation.code.coding` contains at least one coding with:
     - `coding.display` = "Heart rate rhythm" (exact match, case-sensitive)
     - OR `coding.code` represents heart rate rhythm in an appropriate terminology system
   - Alternatively, verify that `Observation.code.text` = "Heart rate rhythm" if no structured coding is provided

3. **Conformance Validation**:
   - Verify the Observation resource validates against applicable US Core Observation profiles as specified in the Capability Statement

#### Test Pass Criteria
- **PASS**: All Observation resources intended to represent heart rate rhythm have a code element that contains "Heart rate rhythm" as either:
  - A display value in at least one coding
  - The text value of the code element
  - An appropriate coded representation that semantically represents heart rate rhythm

#### Test Fail Criteria
- **FAIL**: Any Observation resource intended to represent heart rate rhythm lacks the required "Heart rate rhythm" code
- **FAIL**: The `Observation.code` element is missing or empty for heart rate rhythm observations
- **FAIL**: The code element contains values that do not represent "Heart rate rhythm"

#### Implementation Notes
1. The test should be flexible enough to work with various coding systems (LOINC, SNOMED CT, etc.) as long as the semantic meaning of "Heart rate rhythm" is preserved
2. Test should validate against the US Core Heart Rate Profile (StructureDefinition-us-core-heart-rate.html) if the Observation represents heart rate measurements
3. Consider both structured coding and free-text representations of the code element
4. The test implementation should handle cases where multiple codings exist within the code element

---

<a id='req-012'></a>

### REQ-012: Observation SHALL have an effective date.

**Text**: 

**Context**: 

**Actor**: Observation

**Conformance**: SHALL

# Test Specification for REQ-012

## Requirement ID
REQ-012

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated validation of Observation resources to ensure the presence of an effective date element.

### Complexity
**Simple** - The requirement involves checking for the presence of a mandatory field in an Observation resource, which is a straightforward validation task.

### Prerequisites
- FHIR server implementing US Core Server capabilities
- Server SHALL support Observation resources (as per US Core Server CapabilityStatement)
- Server SHALL support at least one US Core Observation profile
- Test data containing Observation resources with various effective date configurations
- Server SHALL support `read` and `search-type` interactions for Observation resources

## Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources conforming to any of the US Core Observation profiles supported by the server
- **Test Data**: Existing Observation resources in the server's database (bring your own data approach)
- **Server Endpoint**: Base FHIR server URL with Observation resource support

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations SHALL be supported:

1. **GET [base]/Observation/[id]** - Read specific Observation resources
2. **GET [base]/Observation?patient=[patient-id]&category=[category]** - Search for Observation resources by patient and category (SHALL support combination)
3. **GET [base]/Observation?patient=[patient-id]&code=[code]** - Search for Observation resources by patient and code (SHALL support combination)

### Validation Criteria

#### Test Case 1: Direct Resource Validation
**Objective**: Verify that individual Observation resources have an effective date

**Steps**:
1. Retrieve Observation resources using `GET [base]/Observation/[id]` for available Observation IDs
2. For each retrieved Observation resource, validate that ONE of the following effective date elements is present:
   - `Observation.effectiveDateTime` (most common)
   - `Observation.effectivePeriod` (for observations collected over time)
   - `Observation.effectiveTiming` (for recurring observations)
   - `Observation.effectiveInstant` (for precise timestamp)

**Assertions**:
- ✅ **PASS**: Observation resource contains at least one effective date element with a valid value
- ❌ **FAIL**: Observation resource lacks all effective date elements or contains only empty/null values

#### Test Case 2: Search-Based Validation
**Objective**: Verify effective date presence across multiple Observation resources via search

**Steps**:
1. Execute search queries using supported search parameter combinations:
   - `GET [base]/Observation?patient=[patient-id]&category=[category]`
   - `GET [base]/Observation?patient=[patient-id]&code=[code]`
2. For each Observation resource in the search results, validate effective date presence
3. Test with different category values (e.g., "vital-signs", "laboratory", "survey") as supported by the server

**Assertions**:
- ✅ **PASS**: All Observation resources in search results contain at least one effective date element
- ❌ **FAIL**: One or more Observation resources in search results lack effective date elements

#### Test Case 3: Profile-Specific Validation
**Objective**: Verify effective date requirement across different US Core Observation profiles

**Steps**:
1. Identify which US Core Observation profiles are supported by the server (from CapabilityStatement)
2. Search for Observations that conform to each supported profile
3. Validate effective date presence for each profile type

**Supported US Core Observation Profiles** (per CapabilityStatement):
- US Core Laboratory Result Observation Profile
- US Core Vital Signs Profile
- US Core Body Weight Profile
- US Core Blood Pressure Profile
- US Core Simple Observation Profile
- And other supported observation profiles

**Assertions**:
- ✅ **PASS**: Observations conforming to each supported US Core profile contain effective date elements
- ❌ **FAIL**: Any Observation conforming to a US Core profile lacks effective date elements

#### Test Case 4: Date Format Validation
**Objective**: Ensure effective date values are properly formatted

**Steps**:
1. For Observations with effective dates, validate that:
   - `effectiveDateTime` follows FHIR dateTime format (YYYY-MM-DDTHH:mm:ss+ZZ:ZZ or partial)
   - `effectivePeriod` contains valid start and/or end dateTime values
   - `effectiveInstant` follows FHIR instant format
   - `effectiveTiming` contains valid timing specifications

**Assertions**:
- ✅ **PASS**: All effective date values conform to appropriate FHIR data type formats
- ❌ **FAIL**: Effective date values are malformed or invalid

#### Overall Test Results
**Test passes if**: All individual test cases pass, demonstrating that Observation resources consistently include valid effective date information as required by the US Core specification.

**Test fails if**: Any Observation resource lacks an effective date element or contains invalid effective date values.

---

<a id='req-014'></a>

### REQ-014: Observation SHALL include a performer.

**Text**: 

**Context**: 

**Actor**: Observation

**Conformance**: SHALL

# Test Specification for REQ-014

## 1. Requirement ID
**REQ-014**: Observation SHALL include a performer

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified programmatically by checking for the presence of the `performer` element in Observation resources.

### Complexity
**Simple** - This is a straightforward structural validation requirement that checks for the presence of a mandatory field.

### Prerequisites
- System under test must support Observation resources
- System must implement one or more of the US Core Observation profiles as indicated in the Capability Statement
- Test data must include Observation resources that represent the system's typical data patterns

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources from the system under test
- **Profiles**: Any of the supported US Core Observation profiles:
  - US Core Observation ADI Documentation Profile
  - US Core Laboratory Result Observation Profile
  - US Core Simple Observation Profile
  - US Core Vital Signs Profile
  - US Core Observation Clinical Result Profile
  - And other supported US Core Observation profiles as listed in the Capability Statement

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for Observation resources:

1. **Search Operations** (to retrieve test data):
   - `GET [base]/Observation?patient={id}` - Retrieve observations for a specific patient
   - `GET [base]/Observation?category={category}&patient={id}` - Retrieve observations by category and patient
   - `GET [base]/Observation?code={code}&patient={id}` - Retrieve observations by code and patient
   - `GET [base]/Observation?date={date}&patient={id}` - Retrieve observations by date and patient

2. **Read Operations** (if specific Observation IDs are known):
   - `GET [base]/Observation/{id}` - Retrieve specific Observation resource

### Validation Criteria

#### Test Case 1: Performer Element Presence Validation
**Objective**: Verify that all Observation resources include a performer element

**Test Steps**:
1. Retrieve a representative sample of Observation resources using supported search parameters
2. For each retrieved Observation resource:
   - Verify the resource conforms to one of the supported US Core Observation profiles
   - Check that the `performer` element is present
   - Verify that the `performer` element is not empty

**Assertions**:
- **PASS**: `Observation.performer` element exists and contains at least one reference
- **FAIL**: `Observation.performer` element is missing or empty
- **SKIP**: If no Observation resources are available for testing

#### Test Case 2: Performer Reference Validity
**Objective**: Verify that performer references are structurally valid

**Test Steps**:
1. For each Observation resource that contains a performer element:
   - Validate that each performer entry contains a valid reference
   - Verify that the reference follows FHIR reference format (e.g., "ResourceType/id" or absolute URL)

**Assertions**:
- **PASS**: All performer references are structurally valid FHIR references
- **FAIL**: Any performer reference is malformed or invalid
- **SKIP**: If no Observation resources with performers are available

#### Test Case 3: Cross-Profile Validation
**Objective**: Ensure performer requirement applies across all supported US Core Observation profiles

**Test Steps**:
1. Group retrieved Observation resources by their declared profile(s)
2. For each supported US Core Observation profile:
   - Verify that all Observations claiming conformance to that profile include performers
   - Document any profile-specific variations in performer requirements

**Assertions**:
- **PASS**: All Observation resources across all supported profiles include performers
- **FAIL**: Any supported profile has Observation instances missing performers
- **SKIP**: If specific profiles have no available test data

### Expected Test Results
- **Success Criteria**: 100% of Observation resources must include a non-empty performer element
- **Failure Conditions**: Any Observation resource missing the performer element or having an empty performer array
- **Documentation**: Test results should specify which US Core Observation profiles were tested and the total count of resources validated

### Error Handling
- Log specific Observation resource IDs that fail validation
- Provide clear error messages indicating missing or invalid performer elements
- Handle cases where search operations return no results (document as insufficient test data)

---

<a id='req-015'></a>

### REQ-015: Observation SHALL include a value.

**Text**: 

**Context**: 

**Actor**: Observation

**Conformance**: SHALL

# Test Specification for REQ-015

## 1. Requirement ID
**REQ-015**

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified through automated validation of FHIR Observation resources to ensure they contain a value element when required.

### Complexity
**Simple** - The requirement involves checking for the presence of a value in Observation resources, which is a straightforward validation.

### Prerequisites
- FHIR server supporting US Core Observation profiles
- Test system with ability to retrieve Observation resources
- Access to patient data containing Observation resources
- Server must support at least the basic `read` operation for Observation resources per the Capability Statement

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources conforming to any of the US Core Observation profiles listed in the Capability Statement
- **Test Data**: Patient records containing various types of observations (vital signs, lab results, clinical observations, etc.)
- **System Access**: Authenticated access to the FHIR server with appropriate read permissions

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required for testing:

1. **GET [base]/Observation/[id]** - Direct resource retrieval (SHALL support)
2. **GET [base]/Observation?patient=[id]** - Search by patient (implied from search capabilities)
3. **GET [base]/Observation?patient=[id]&category=[category]** - Search by patient and category (SHALL support)

### Validation Criteria

#### Primary Test Cases

**Test Case 1: Direct Resource Validation**
- **Objective**: Verify that individual Observation resources include a value
- **Method**: 
  1. Retrieve Observation resources using direct read operations
  2. For each Observation resource, verify one of the following conditions is met:
     - `Observation.value[x]` is present and populated, OR
     - `Observation.component` exists with at least one component containing a `value[x]`, OR
     - `Observation.dataAbsentReason` is present (indicating why value is absent), OR
     - Resource contains references to other grouped Observations
- **Assertion**: Each Observation SHALL contain a value through one of the acceptable methods above

**Test Case 2: Search-Based Validation**
- **Objective**: Verify value presence across Observations returned from search operations
- **Method**:
  1. Execute patient-based searches for Observations using supported search parameters
  2. Apply the same validation logic as Test Case 1 to all returned resources
- **Assertion**: All Observations in search results SHALL meet the value requirement

**Test Case 3: Category-Specific Validation**
- **Objective**: Verify value requirements across different Observation categories
- **Method**:
  1. Search for Observations by different categories (vital-signs, laboratory, survey, etc.)
  2. Validate value presence for each category type
- **Assertion**: Observations of all categories SHALL include values when expected

#### Specific Validation Rules

1. **Value Presence Check**:
   - Verify `Observation.value[x]` exists and is not null/empty, OR
   - Verify `Observation.component[].value[x]` exists for at least one component, OR
   - Verify `Observation.dataAbsentReason` is present with appropriate coding

2. **Component Observations**:
   - For Observations with components, verify each component without a value has `dataAbsentReason`
   - Ensure at least one component has a value unless all have appropriate absent reasons

3. **Grouped Observations**:
   - For Observations that reference other grouped Observations, verify the referenced resources contain values
   - Validate that the grouping structure is appropriate and meaningful

#### Edge Cases to Consider

1. **Historical/Legacy Data**: Verify handling of older Observation records that may have different value patterns
2. **Different Value Types**: Test across various `value[x]` types (valueQuantity, valueCodeableConcept, valueString, etc.)
3. **Multi-component Observations**: Validate complex Observations like blood pressure with multiple components

#### Success Criteria

- **Pass**: All tested Observation resources contain appropriate values or valid reasons for absent data
- **Fail**: Any Observation resource lacks both a value and a valid reason for the missing value
- **Warning**: Observations that technically meet requirements but may indicate data quality issues

#### Reporting Requirements

Test results should include:
- Total number of Observation resources tested
- Count and details of any non-conformant resources
- Breakdown by Observation category/type
- Specific validation failures with resource IDs and missing elements
- Recommendations for addressing any identified issues

---

<a id='req-017'></a>

### REQ-017: Observation SHALL include a derivedFrom reference.

**Text**: 

**Context**: 

**Actor**: Observation

**Conformance**: SHALL

# Test Specification for REQ-017

## 1. Requirement ID
REQ-017

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Automatically testable

The requirement states that "Observation SHALL include a derivedFrom reference" which is a clear, verifiable constraint that can be automatically tested by examining the structure of Observation resources.

### Complexity
**Level**: Simple

This is a straightforward structural validation requirement that checks for the presence of a specific element in FHIR resources.

### Prerequisites
- System must support US Core Observation profiles as indicated in the Capability Statement
- System must have Observation resources available for testing
- Test system must be able to perform FHIR read operations and search operations on Observation resources

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: 
  - Observation resources that conform to the simple observation disability status profile
  - Valid patient identifiers for searching Observations
- **System Access**: 
  - Authenticated access to FHIR server with appropriate scopes
  - Ability to perform read and search operations on Observation resources

### Expected Outputs
- Observation resources retrieved from the system
- Validation results confirming presence of `derivedFrom` references
- Test pass/fail status for each Observation resource examined

### Required FHIR Operations

Based on the Capability Statement, the following operations are supported and should be used:

1. **Search Operations**:
   - `GET [base]/Observation?patient=[id]&category=[category]` - Search for Observations by patient and category
   - `GET [base]/Observation?patient=[id]&code=[code]` - Search for Observations by patient and code
   
2. **Read Operations**:
   - `GET [base]/Observation/[id]` - Direct read of specific Observation resources

3. **Include Operations** (if needed):
   - Include `_revinclude=Provenance:target` as supported in the Capability Statement

### Validation Criteria

For each Observation resource tested, the following assertions must be verified:

1. **Primary Validation**:
   - Assert that `Observation.derivedFrom` element is present
   - Assert that `Observation.derivedFrom` is not empty or null
   - Assert that `Observation.derivedFrom` contains at least one valid reference

2. **Reference Validation**:
   - If `derivedFrom` references are present, validate that they are properly formatted FHIR references
   - Verify that referenced resources can be resolved (if accessible within test scope)

3. **Profile Conformance**:
   - Confirm that the Observation resource claims conformance to the simple observation disability status profile
   - Validate that the resource passes FHIR validation against the claimed profile

### Test Execution Steps

1. **Discovery Phase**:
   - Search for Observation resources using patient-based searches supported by the Capability Statement
   - Filter for Observations that should conform to the simple observation disability status profile

2. **Validation Phase**:
   - For each retrieved Observation resource:
     - Parse the JSON/XML structure
     - Check for presence of `derivedFrom` element
     - Validate the structure and content of `derivedFrom` references
     - Record validation results

3. **Reporting Phase**:
   - Generate test results indicating pass/fail for each Observation
   - Provide detailed error messages for any failed validations
   - Summarize overall conformance status

### Pass/Fail Criteria

- **PASS**: All tested Observation resources contain a non-empty `derivedFrom` element with valid references
- **FAIL**: Any tested Observation resource lacks a `derivedFrom` element or contains invalid/empty references
- **INCONCLUSIVE**: No applicable Observation resources found for testing, or system access issues prevent proper testing

### Test Data Considerations

Since this follows a "bring your own data" approach:
- The test should work with whatever Observation data exists in the target system
- Focus on Observations that claim conformance to the simple observation disability status profile
- If no relevant Observations exist, the test should report this condition rather than fail
- Test should handle various data scenarios gracefully (different patient populations, date ranges, etc.)

---

<a id='req-025'></a>

### REQ-025: Observation SHALL have a status of 'Final'

**Text**: 

**Context**: 

**Actor**: Observation

**Conformance**: SHALL

# Test Specification for REQ-025

## 1. Requirement ID
**REQ-025**: Observation SHALL have a status of 'Final'

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be programmatically verified by checking the `status` field value in Observation resources.

### Complexity
**Simple** - The test involves a straightforward field value validation against a specific required value.

### Prerequisites
- System must support US Core Observation profiles as indicated in the Capability Statement
- System must have Observation resources available for testing
- Test client must have appropriate access permissions to read Observation resources

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Any Observation resources conforming to US Core Observation profiles available in the system under test
- **Patient Context**: Valid patient ID(s) to scope the Observation queries (following "bring your own data" approach)
- **Expected Outputs**: All retrieved Observation resources should have `status` field set to "final"

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and should be used for testing:

1. **Read Operation**: `GET [base]/Observation/[id]`
   - Direct retrieval of specific Observation resources by ID

2. **Search Operations** (using supported search parameters):
   - `GET [base]/Observation?patient=[patient-id]` - Search by patient
   - `GET [base]/Observation?patient=[patient-id]&category=[category-code]` - Search by patient and category
   - `GET [base]/Observation?patient=[patient-id]&code=[observation-code]` - Search by patient and observation code

### Validation Criteria

#### Primary Assertion
For each Observation resource retrieved:
1. **Status Field Validation**: Verify that `Observation.status` exists and equals "final"
   - **Pass Condition**: `Observation.status = "final"`
   - **Fail Condition**: `Observation.status` is missing, null, or has any value other than "final"

#### Test Execution Strategy
1. **Scope Definition**: Use available patient data to identify Observation resources for testing
2. **Resource Retrieval**: Execute read and search operations to obtain Observation resources
3. **Validation**: Apply the status validation to each retrieved Observation
4. **Result Aggregation**: 
   - Test passes if ALL retrieved Observations have status = "final"
   - Test fails if ANY Observation has a different status value or missing status
   - Document any non-conformant resources with their IDs and actual status values

#### Additional Considerations
- Test should handle multiple US Core Observation profile variants (vital signs, laboratory results, clinical results, etc.)
- Test should validate across different categories of observations to ensure comprehensive coverage
- If no Observation resources are found, the test should be marked as "Not Applicable" rather than "Pass" or "Fail"

#### Success Criteria
- **Complete Success**: 100% of retrieved Observation resources have status = "final"
- **Failure Documentation**: Any deviation should be clearly reported with:
  - Resource ID
  - Actual status value found
  - Expected status value ("final")
  - Profile type of the non-conformant Observation

---

<a id='req-026'></a>

### REQ-026: Observation SHALL include a category of 'Vital Signs'

**Text**: 

**Context**: 

**Actor**: Observation

**Conformance**: SHALL

# REQ-026 Test Specification

## 1. Requirement ID
**REQ-026**: Observation SHALL include a category of 'Vital Signs'

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified programmatically by examining the `category` element of Observation resources to confirm the presence of a 'Vital Signs' category coding.

### Complexity
**Simple** - The test involves checking for a specific category value in the Observation resource structure.

### Prerequisites
- Access to a FHIR server implementing US Core Server capabilities
- Observation resources available in the system that should contain vital signs data
- The system must support Observation resource queries as defined in the US Core Server CapabilityStatement

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources that represent vital signs measurements
- **Test Data**: Any existing Observation resources in the test system that are intended to represent vital signs (blood pressure, heart rate, temperature, etc.)
- **System Access**: FHIR server endpoint with US Core Server capabilities

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following supported operations will be used:

1. **Search Operations**:
   - `GET [base]/Observation?patient=[patient-id]&category=vital-signs`
   - `GET [base]/Observation?category=vital-signs`
   - `GET [base]/Observation/[id]` (read specific Observation resources)

2. **Supported Search Parameters** (from CapabilityStatement):
   - `category`
   - `patient`
   - `patient+category`

### Validation Criteria

#### Primary Validation
For each Observation resource that represents vital signs data:

1. **Category Element Presence**: Verify that the `Observation.category` element exists and is populated
2. **Vital Signs Category Verification**: Confirm that at least one category coding contains:
   - `system`: `http://terminology.hl7.org/CodeSystem/observation-category`
   - `code`: `vital-signs`
   - `display`: `Vital Signs` (optional but recommended)

#### Test Assertions
The test SHALL pass when:
- **Assertion 1**: All Observation resources representing vital signs contain a `category` element
- **Assertion 2**: At least one category coding in each vital signs Observation has the code `vital-signs` from the observation-category code system
- **Assertion 3**: The category coding uses the correct system URI (`http://terminology.hl7.org/CodeSystem/observation-category`)

#### Test Cases

**Test Case 1: Search-Based Validation**
- Execute: `GET [base]/Observation?category=vital-signs`
- Verify: All returned Observation resources contain the required vital signs category
- Expected Result: All resources in the search results have the appropriate category coding

**Test Case 2: Patient-Specific Vital Signs**
- Execute: `GET [base]/Observation?patient=[patient-id]&category=vital-signs`
- Verify: All returned Observation resources for the patient contain the required vital signs category
- Expected Result: Patient-specific vital signs observations have the appropriate category coding

**Test Case 3: Individual Resource Validation**
- Execute: `GET [base]/Observation/[observation-id]` for known vital signs observations
- Verify: Each retrieved Observation resource contains the required vital signs category
- Expected Result: Each observation has the correct category coding structure

#### Expected Outputs
- **Pass Criteria**: All tested Observation resources representing vital signs contain at least one category with code `vital-signs` from the correct code system
- **Fail Criteria**: Any vital signs Observation resource lacks the required category or uses incorrect coding system/code values
- **Validation Report**: Summary of tested resources, number passing/failing the category requirement, and specific details of any non-conformant resources

---

<a id='req-027'></a>

### REQ-027: Observation SHALL include a code for blood pressure

**Text**: 

**Context**: 

**Actor**: Observation

**Conformance**: SHALL

# Test Specification for REQ-027

## 1. Requirement ID
**REQ-027**: Observation SHALL include a code for blood pressure

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be validated through automated inspection of Observation resources to verify the presence and content of the code element for blood pressure observations.

### Complexity
**Simple** - The requirement involves checking for the presence of a specific element (code) in blood pressure Observation resources, which is a straightforward structural validation.

### Prerequisites
- US Core Server implementation supporting Observation resources
- Access to blood pressure Observation data in the system
- Server must support the US Core Blood Pressure Profile (as indicated by the source file reference)
- JSON format support (SHALL requirement from Capability Statement)
- Valid authentication/authorization credentials

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Blood pressure Observation resources present in the test system
- Resources should conform to US Core Blood Pressure Profile

**Expected Outputs:**
- All blood pressure Observation resources must contain a populated `code` element
- The code element should contain appropriate blood pressure-related codes (e.g., LOINC codes for blood pressure measurements)

### Required FHIR Operations
Based on the US Core Server Capability Statement, the following operations are needed:

1. **Search Operations** (to retrieve blood pressure observations):
   - `GET [base]/Observation?category=vital-signs&code=85354-9` (Blood pressure panel)
   - `GET [base]/Observation?category=vital-signs&code=8480-6` (Systolic blood pressure)  
   - `GET [base]/Observation?category=vital-signs&code=8462-4` (Diastolic blood pressure)
   - Alternative search patterns based on available data

2. **Read Operations** (if specific Observation IDs are known):
   - `GET [base]/Observation/{id}`

### Validation Criteria

**Primary Assertions:**
1. **Code Element Presence**: Each blood pressure Observation resource MUST contain a `code` element
2. **Code Element Population**: The `code` element MUST NOT be empty or null
3. **Code System Validity**: The code should reference an appropriate coding system (e.g., LOINC)
4. **Blood Pressure Code Appropriateness**: The code should be relevant to blood pressure measurements

**Test Steps:**
1. Query the server for blood pressure Observation resources using available search parameters
2. For each returned Observation resource:
   - Verify `Observation.code` element exists
   - Verify `Observation.code` is not null or empty
   - Verify `Observation.code.coding` array contains at least one coding
   - Verify each coding has a populated `code` value
   - Verify the coding system is specified (recommended but not strictly required for this test)

**Pass Criteria:**
- All blood pressure Observation resources contain a populated code element
- No blood pressure Observation resources are missing the code element
- Server returns appropriate HTTP status codes (200 for successful queries, 404 for not found, etc.)

**Fail Criteria:**
- Any blood pressure Observation resource lacks a code element
- Any blood pressure Observation resource has an empty/null code element
- Server returns unexpected error responses for valid queries

**Edge Cases to Consider:**
- Observations with data absent reasons still must have codes
- Observations with component values (systolic/diastolic components) must have appropriate panel codes
- Historical vs. current observations should all maintain code requirements

---

<a id='req-028'></a>

### REQ-028: Observation component SHALL include a code for systolic blood pressure

**Text**: 

**Context**: 

**Actor**: Observation

**Conformance**: SHALL

# Test Specification for REQ-028

## 1. Requirement ID
**REQ-028**: Observation component SHALL include a code for systolic blood pressure

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated validation of FHIR Observation resource structure and component codes.

### Complexity
**Simple** - The requirement involves validating the presence and correct coding of a specific component within an Observation resource.

### Prerequisites
- System must support US Core Observation profiles
- Test data must include blood pressure Observations with components
- System must be able to retrieve Observation resources via FHIR API
- Access to terminology services for code validation (LOINC codes)

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources that represent blood pressure measurements with component data
- **Expected Resource Profile**: US Core Blood Pressure Profile or equivalent Observation profile with components
- **Code Systems**: LOINC terminology for vital signs codes
- **Expected Component Code**: LOINC code for systolic blood pressure (8480-6 "Systolic blood pressure")

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required for testing:

1. **GET /Observation/{id}** - Retrieve specific Observation resources
2. **GET /Observation?category=vital-signs** - Search for vital signs observations
3. **GET /Observation?code=85354-9** - Search for blood pressure observations (LOINC code for Blood pressure panel)

*Note: These operations align with the US Core Server capability requirements for supporting US Core profiles and RESTful interactions.*

### Validation Criteria

#### Primary Assertions (Must Pass):
1. **Component Structure Validation**:
   - Verify that blood pressure Observation resources contain a `component` array
   - Confirm that at least one component exists in the array

2. **Systolic Blood Pressure Component Validation**:
   - Verify that at least one component contains a `code` element
   - Validate that the component code matches the LOINC code for systolic blood pressure (8480-6)
   - Confirm the code system is correctly specified as "http://loinc.org"
   - Verify that the component includes a `valueQuantity` or appropriate value element

3. **Code System Validation**:
   - Ensure the coding system reference is valid and accessible
   - Verify code display text is present and appropriate (e.g., "Systolic blood pressure")

#### Secondary Validations (Should Pass):
1. **Profile Conformance**:
   - Validate that the Observation conforms to US Core Blood Pressure profile if specified in meta.profile
   - Verify resource passes FHIR validation against declared profiles

2. **Data Completeness**:
   - Confirm that systolic component includes units (typically "mm[Hg]")
   - Verify that the component value is within reasonable clinical ranges

#### Test Execution Steps:
1. **Discovery Phase**:
   - Query system for blood pressure Observations using supported search parameters
   - Filter results to identify Observations with component data

2. **Validation Phase**:
   - For each retrieved Observation:
     - Parse the component array
     - Locate components with systolic blood pressure codes
     - Validate code structure and values
     - Verify conformance to expected format

3. **Results Assessment**:
   - **PASS**: All blood pressure Observations with components include properly coded systolic blood pressure components
   - **FAIL**: Any blood pressure Observation with components lacks a properly coded systolic blood pressure component
   - **SKIP**: No blood pressure Observations with component data found in test dataset

#### Error Handling:
- Handle cases where Observations exist but components are missing
- Manage scenarios with invalid or missing code systems
- Account for observations that may have components but incorrect codes

---

<a id='req-029'></a>

### REQ-029: Observation component SHALL include a value for systolic blood pressure

**Text**: 

**Context**: 

**Actor**: Observation

**Conformance**: SHALL

# Test Specification for REQ-029

## Requirement ID
REQ-029

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated through automated checks of FHIR Observation resources to verify that blood pressure observations contain a systolic component with a value.

### Complexity
**Simple** - The test involves straightforward validation of the presence of a value in a specific component of blood pressure Observation resources.

### Prerequisites
- System must support US Core Blood Pressure Profile (as indicated by Capability Statement support for Observation resources)
- Test data must include Observation resources conforming to blood pressure profiles
- System must support `GET [base]/Observation/[id]` operation (required by Capability Statement)
- System must support search operations: `GET [base]/Observation?patient=[id]&category=vital-signs`

## Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Patient resources with valid IDs for testing
- Observation resources conforming to US Core Blood Pressure Profile
- Observation resources should include both complete and potentially incomplete blood pressure measurements for comprehensive testing

**Expected Outputs:**
- Retrieved Observation resources with blood pressure category
- Validation results confirming systolic component values are present

### Required FHIR Operations
1. **Search for Blood Pressure Observations:**
   ```
   GET [base]/Observation?patient=[patient-id]&category=vital-signs
   ```

2. **Read Individual Observations:**
   ```
   GET [base]/Observation/[observation-id]
   ```

3. **Alternative category-based search:**
   ```
   GET [base]/Observation?patient=[patient-id]&category=http://terminology.hl7.org/CodeSystem/observation-category|vital-signs
   ```

### Validation Criteria

**Primary Validation:**
1. **Identify Blood Pressure Observations:**
   - Filter retrieved Observations to identify blood pressure measurements
   - Look for Observations with `code.coding` containing LOINC code "85354-9" (Blood pressure panel) or equivalent blood pressure codes
   - Verify the Observation conforms to US Core Blood Pressure Profile structure

2. **Validate Systolic Component Presence:**
   - For each blood pressure Observation, check `component` array
   - Locate component with `code.coding` containing LOINC code "8480-6" (Systolic blood pressure)
   - Verify this component contains either:
     - `valueQuantity` with a numeric value, OR
     - `valueString` with a valid value, OR
     - `valueInteger` with a numeric value

3. **Value Validation:**
   - Assert that the systolic component has a non-null value in one of the supported value types
   - If `dataAbsentReason` is present instead of a value, the test should fail for this requirement
   - Verify the value is appropriately formatted for the chosen value type

**Test Assertions:**
- **PASS:** All blood pressure Observations contain a systolic component with a valid value
- **FAIL:** Any blood pressure Observation has a systolic component without a value (only `dataAbsentReason` present)
- **FAIL:** Any blood pressure Observation lacks a systolic component entirely
- **SKIP:** No blood pressure Observations found in the test data

**Additional Validation Checks:**
- Verify the systolic component uses appropriate UCUM units (typically "mm[Hg]") when `valueQuantity` is used
- Confirm the systolic component code correctly identifies it as systolic blood pressure
- Validate that the parent Observation resource properly conforms to US Core Blood Pressure Profile constraints

**Error Handling:**
- Document any Observations that cannot be processed due to structural issues
- Report any system errors during retrieval operations
- Handle cases where Patient resources have no associated blood pressure Observations

---

<a id='req-030'></a>

### REQ-030: Observation component SHALL include a code for diastolic blood pressure

**Text**: 

**Context**: 

**Actor**: Observation

**Conformance**: SHALL

# Test Specification for REQ-030

## 1. Requirement ID
**REQ-030**: Observation component SHALL include a code for diastolic blood pressure

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified programmatically by examining Observation resources that represent blood pressure measurements and checking for the presence of a diastolic blood pressure component with appropriate coding.

### Complexity
**Simple** - The test involves straightforward validation of component structure and coding within blood pressure Observation resources.

### Prerequisites
- Server must support the US Core Blood Pressure Profile (as indicated in Capability Statement)
- Server must have blood pressure Observation data available
- Server must support Observation read and search operations
- Test data should include Observation resources that represent blood pressure measurements

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Observation resources conforming to US Core Blood Pressure Profile
- Resources must contain component elements representing blood pressure measurements

**Expected Outputs:**
- Validation results confirming presence of diastolic blood pressure component codes
- Confirmation that diastolic components use appropriate standard terminologies

### Required FHIR Operations
Based on the Capability Statement, the following supported operations will be used:

1. **Search Operations:**
   - `GET [base]/Observation?patient=[patient-id]&category=vital-signs`
   - `GET [base]/Observation?patient=[patient-id]&code=[blood-pressure-code]`

2. **Read Operations:**
   - `GET [base]/Observation/[id]` for individual blood pressure observations

3. **Search Parameter Combinations** (as supported):
   - `patient + category + date`
   - `patient + code`

### Validation Criteria

**Primary Assertions:**

1. **Blood Pressure Observation Identification:**
   - Verify that Observation resources with blood pressure measurements are properly identified
   - Check that `Observation.category` includes vital-signs category
   - Verify `Observation.code` represents blood pressure measurement

2. **Component Structure Validation:**
   - Confirm that blood pressure Observations contain `Observation.component` elements
   - Verify at least two components exist (systolic and diastolic)

3. **Diastolic Component Code Validation:**
   - **SHALL assertion**: Every blood pressure Observation must contain a component with a code representing diastolic blood pressure
   - Verify diastolic component uses standard terminology (e.g., LOINC code "8462-4" for "Diastolic blood pressure")
   - Confirm `Observation.component.code` is present and properly structured
   - Validate that the code system and code value are appropriate for diastolic blood pressure

4. **Data Completeness:**
   - Verify that diastolic blood pressure components include both code and value elements
   - Confirm proper units of measure are specified

**Test Execution Steps:**

1. **Discovery Phase:**
   - Search for Observation resources using supported search parameters
   - Filter for blood pressure related observations using category and/or code parameters

2. **Component Analysis:**
   - For each blood pressure Observation, examine the component array
   - Identify components by their code values
   - Locate the diastolic blood pressure component

3. **Validation Phase:**
   - Assert that a diastolic blood pressure component exists
   - Validate the component code structure and values
   - Verify conformance to expected terminology standards

**Pass Criteria:**
- All blood pressure Observation resources contain a component with a valid diastolic blood pressure code
- Component codes use recognized standard terminologies
- Component structure follows FHIR specification requirements

**Fail Criteria:**
- Any blood pressure Observation lacks a diastolic blood pressure component
- Diastolic components have missing or invalid codes
- Component codes do not conform to expected terminology standards

**Edge Cases to Consider:**
- Blood pressure measurements with absent data (should still have component structure with dataAbsentReason)
- Different terminology systems used for diastolic blood pressure coding
- Historical vs. current blood pressure measurements

---

<a id='req-031'></a>

### REQ-031: Observation SHALL include a category of 'Survey'

**Text**: 

**Context**: 

**Actor**: Observation

**Conformance**: SHALL

# Test Specification for REQ-031

## Requirement ID
REQ-031

## Requirement Analysis

### Testability Assessment
**Classification:** Automatically testable

This requirement can be automatically tested by examining the `category` field of Observation resources to verify that at least one category has a coding with the value 'survey' (case-insensitive matching recommended per FHIR conventions).

### Complexity
**Simple**

This is a straightforward validation that requires checking a single field value within an Observation resource.

### Prerequisites
- System must support Observation resources
- Test data must include Observation resources that are intended to represent survey items
- System must be capable of FHIR REST API operations for Observation retrieval

## Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- One or more Observation resources that represent survey responses or survey items
- The Observation resources should be representative of the system's implementation of survey-type observations

**Expected Outputs:**
- All survey-related Observation resources must contain a `category` element with at least one CodeableConcept that includes a coding with the code 'survey'

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and can be used for testing:

1. **GET /Observation/{id}** - Retrieve specific Observation resources by ID
2. **GET /Observation?patient={patient_id}** - Retrieve Observations for a specific patient
3. **GET /Observation?category=survey** - Search for Observations with survey category (if supported by implementation)
4. **GET /Observation?patient={patient_id}&category=survey** - Combined patient and category search

### Validation Criteria

For each Observation resource that represents a survey item or survey response, the test must verify:

1. **Category Presence Check:**
   - The Observation resource MUST contain a `category` element
   - The `category` element MUST be an array of CodeableConcept objects

2. **Survey Category Validation:**
   - At least one CodeableConcept in the `category` array MUST contain a `coding` array
   - At least one Coding within the `coding` array MUST have:
     - `code` value that matches 'survey' (case-insensitive comparison recommended)
     - Optionally verify the `system` URI if a specific terminology is expected

3. **Test Execution Steps:**
   - Retrieve Observation resources using supported search parameters
   - For each Observation that appears to be survey-related (based on context or other identifiers):
     - Parse the `category` field
     - Iterate through each CodeableConcept in the category array
     - For each CodeableConcept, examine the coding array
     - Verify at least one coding has code='survey'
   - Document any Observation resources that fail this validation

4. **Pass/Fail Criteria:**
   - **PASS:** All survey-type Observation resources contain the required 'survey' category
   - **FAIL:** Any survey-type Observation resource lacks the 'survey' category or the category field is missing/malformed

5. **Reporting Requirements:**
   - Report the total number of survey-type Observation resources tested
   - List any resources that failed validation with specific details about the missing or incorrect category values
   - Include resource IDs and relevant category values found for failed resources

**Note:** The test should focus on Observation resources that are contextually survey-related based on the system's data. The determination of which Observations should have the 'survey' category may be based on the specific profiles they claim conformance to, their code values, or other contextual indicators within the test data.

---

<a id='req-032'></a>

### REQ-032: Observation SHALL include a code for exercise engagement

**Text**: 

**Context**: 

**Actor**: Observation

**Conformance**: SHALL

# Test Specification for REQ-032

## 1. Requirement ID
**REQ-032**: Observation SHALL include a code for exercise engagement

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Automatically testable

This requirement can be programmatically verified by checking for the presence of a specific code element within Observation resources that relate to exercise engagement. The requirement is concrete and measurable.

### Complexity
**Level**: Simple

The test involves a straightforward validation of the presence of a required code element in an Observation resource.

### Prerequisites
- FHIR server implementing US Core Server CapabilityStatement
- Observation resources that represent exercise engagement data
- Access to Observation read/search operations as defined in the capability statement
- Test system capable of FHIR resource validation

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Observation resources that are intended to capture exercise engagement data
- The specific Observation profile or context should relate to exercise/physical activity measurements

**Expected Resource Elements:**
- `Observation.code` element must be present and populated
- The code should be appropriate for exercise engagement (e.g., LOINC codes related to physical activity, exercise, or fitness)

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are available and will be used:

1. **READ Operation**: `GET [base]/Observation/[id]`
   - Retrieve specific Observation resources for validation

2. **SEARCH Operations** (as supported in capability statement):
   - `GET [base]/Observation?patient=[patient-id]&category=[category]`
   - `GET [base]/Observation?patient=[patient-id]&code=[code]`
   - `GET [base]/Observation?patient=[patient-id]&category=[category]&date=[date]`

### Validation Criteria

**Primary Assertions:**
1. **Code Presence Validation**
   - `Observation.code` element SHALL be present
   - `Observation.code` SHALL NOT be null or empty
   - `Observation.code.coding` array SHALL contain at least one coding

2. **Code Appropriateness Validation**
   - The code SHALL be semantically appropriate for exercise engagement
   - Verify that `Observation.code.coding.system` contains a recognized coding system (e.g., LOINC, SNOMED CT)
   - Verify that `Observation.code.coding.code` contains a valid code value
   - Optional: Validate that the code is from an expected value set for exercise-related observations

3. **FHIR Conformance Validation**
   - The Observation resource SHALL conform to applicable US Core Observation profiles
   - Resource SHALL pass FHIR validation against the declared profile(s)

**Test Steps:**
1. Identify Observation resources that represent exercise engagement data from the test dataset
2. For each identified Observation resource:
   - Retrieve the resource using READ operation
   - Validate presence of `Observation.code` element
   - Verify that the code is populated with appropriate values
   - Confirm the resource validates against relevant US Core Observation profiles
3. Document any resources that fail the validation criteria

**Pass Criteria:**
- ALL Observation resources representing exercise engagement contain a populated `code` element
- ALL codes are semantically appropriate for exercise engagement
- ALL resources pass FHIR profile validation

**Failure Indicators:**
- Any Observation resource representing exercise engagement is missing the `code` element
- Any `code` element is present but empty/null
- Any code is not appropriate for exercise engagement context
- Resource fails FHIR profile validation

**Reporting:**
- Total number of exercise engagement Observation resources tested
- Number of resources that passed/failed validation
- Specific details of any failures including resource IDs and failure reasons
- Summary of compliance percentage

---

<a id='req-033'></a>

### REQ-033: Observation SHALL include a value for exercise engagement

**Text**: 

**Context**: 

**Actor**: Observation

**Conformance**: SHALL

# Test Specification for REQ-033

## 1. Requirement ID
**REQ-033**: Observation SHALL include a value for exercise engagement

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated by checking for the presence of a value element in Observation resources that represent exercise engagement data.

### Complexity
**Simple** - The requirement focuses on a single structural constraint: the presence of a value in exercise engagement observations.

### Prerequisites
- System must support US Core Observation profiles as defined in the Capability Statement
- Test data must include Observation resources related to exercise engagement (likely with LOINC code 68516-4 based on the source reference)
- System must support standard FHIR REST operations for Observation resources

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Observation resources representing exercise engagement measurements
- Patient resources (as referenced subjects of the observations)

**Expected Resource Characteristics:**
- Observations should have code elements indicating exercise engagement (e.g., LOINC 68516-4)
- Observations should be associated with valid Patient references

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required for testing:

1. **GET /Observation** - Retrieve observation resources
   - With search parameters: `patient`, `category`, `code`, `date`, `status`
   - Combined searches: `patient+category`, `patient+code`, `patient+code+date`

2. **GET /Observation/{id}** - Retrieve specific observation by ID

### Validation Criteria

**Primary Validation:**
1. **Value Presence Check**: Each exercise engagement Observation resource MUST contain a value element
   - Acceptable value types: `valueQuantity`, `valueCodeableConcept`, `valueString`, `valueBoolean`, `valueInteger`, `valueRange`, `valueRatio`, `valueSampledData`, `valueTime`, `valueDateTime`, `valuePeriod`
   - The value element MUST NOT be empty or null

**Secondary Validations:**
1. **Resource Structure**: Observation resources must conform to applicable US Core Observation profiles
2. **Code Validation**: Exercise engagement observations should have appropriate LOINC codes in the `code` element
3. **Patient Reference**: Each observation must reference a valid Patient resource

**Test Assertions:**
- **PASS**: All exercise engagement Observation resources contain a non-null value element
- **FAIL**: Any exercise engagement Observation resource lacks a value element or has a null/empty value
- **SKIP**: No exercise engagement Observation resources found in test data

**Implementation Notes:**
- Tests should work with any valid exercise engagement observation data provided by the implementer
- Focus on structural conformance rather than semantic correctness of values
- Test should accommodate different value types as long as a value is present
- Consider filtering observations by category or code to identify exercise engagement observations specifically

---

<a id='req-034'></a>

### REQ-034: Observation SHALL include a code for tobacco use

**Text**: 

**Context**: 

**Actor**: Observation

**Conformance**: SHALL

# Test Specification for REQ-034

## 1. Requirement ID
REQ-034

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated inspection of Observation resources to confirm the presence of tobacco use codes in the `Observation.code` element.

### Complexity
**Simple** - The test involves straightforward verification of a required code element in Observation resources.

### Prerequisites
- Server must support US Core Observation profiles as specified in the Capability Statement
- Server must have Observation resources available for testing
- Test system must be able to perform FHIR read and search operations on Observation resources

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources that represent tobacco use assessments (specifically those that should contain tobacco use codes)
- **Expected Resource Profiles**: Any US Core Observation profile that could contain tobacco use information, particularly:
  - US Core Observation Screening Assessment Profile
  - US Core Simple Observation Profile
  - US Core Observation Clinical Result Profile

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required for testing:

1. **Search Operations**:
   - `GET [base]/Observation?patient=[patient-id]&category=[category]` - Search for observations by patient and category
   - `GET [base]/Observation?patient=[patient-id]&code=[tobacco-use-code]` - Search for tobacco use observations by patient and code

2. **Read Operations**:
   - `GET [base]/Observation/[id]` - Read specific Observation resources identified through search

3. **Search Parameters** (as supported per Capability Statement):
   - `patient` (reference) - SHALL support
   - `category` (token) - SHALL support  
   - `code` (token) - SHALL support
   - `date` (date) - SHALL support

### Validation Criteria

#### Test Case 1: Tobacco Use Code Presence Validation
**Objective**: Verify that Observation resources representing tobacco use contain a valid tobacco use code in the `Observation.code` element.

**Test Steps**:
1. Search for Observation resources using patient and category parameters to identify potential tobacco use observations
2. For each returned Observation resource, inspect the `Observation.code` element
3. Verify that tobacco use-related observations contain appropriate tobacco use codes

**Validation Checks**:
- **Code Presence**: The `Observation.code` element SHALL be present and populated
- **Code System Validation**: The code should come from appropriate value sets for tobacco use (e.g., LOINC, SNOMED CT)
- **Code Specificity**: The code should specifically relate to tobacco use assessment/status

**Passing Criteria**:
- All Observation resources identified as tobacco use assessments contain a valid tobacco use code in `Observation.code`
- The code element includes both `system` and `code` values
- The code values are from recognized terminology systems appropriate for tobacco use

#### Test Case 2: Search Functionality for Tobacco Use Observations
**Objective**: Verify that tobacco use observations can be properly searched and retrieved.

**Test Steps**:
1. Execute search queries for tobacco use observations using supported search parameters
2. Verify search results return appropriate observations
3. Validate that returned observations meet the tobacco use code requirement

**Validation Checks**:
- Search operations complete successfully without errors
- Returned resources are valid Observation resources
- Each returned observation contains the required tobacco use code

**Passing Criteria**:
- Search operations return expected results
- All returned Observation resources conform to the tobacco use code requirement
- No tobacco use observations are returned without proper coding

#### Error Conditions
**Expected Failures**:
- Test should fail if any Observation resource representing tobacco use lacks a code in the `Observation.code` element
- Test should fail if tobacco use codes are present but use inappropriate code systems or invalid codes
- Test should fail if search operations for tobacco use observations return resources that don't meet the coding requirement

**Boundary Conditions**:
- Test with observations that may have multiple codes to ensure tobacco use code is present
- Verify behavior with observations that have `Observation.code.coding` arrays with multiple coding entries
- Test with various tobacco use code systems to ensure flexibility while maintaining requirement compliance

---

<a id='req-035'></a>

### REQ-035: Observation SHALL include a value for tobacco use

**Text**: 

**Context**: 

**Actor**: Observation

**Conformance**: SHALL

# Test Specification for REQ-035

## Requirement ID
REQ-035

## Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified through automated inspection of Observation resources to confirm the presence of tobacco use values.

### Complexity
**Simple** - The requirement involves checking for the presence of a value element in Observation resources related to tobacco use.

### Prerequisites
- Server must support US Core Observation profiles as specified in the Capability Statement
- Test system must have access to Observation resources with tobacco use data
- Server must support read operations for Observation resources
- Server must support search operations for Observation resources by patient and category/code

## Test Implementation Strategy

### Required Inputs
- **Patient ID**: Valid patient identifier for querying observations
- **Test Data**: Observation resources in the system that represent tobacco use assessments (e.g., LOINC codes like 96842-0 or similar tobacco use screening codes)

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required:

1. **Search Observations by Patient and Code**:
   ```
   GET [base]/Observation?patient=[patient-id]&code=[tobacco-use-code]
   ```

2. **Search Observations by Patient and Category**:
   ```
   GET [base]/Observation?patient=[patient-id]&category=[category-code]
   ```

3. **Read Individual Observation**:
   ```
   GET [base]/Observation/[observation-id]
   ```

### Validation Criteria

#### Primary Validation
For each Observation resource identified as relating to tobacco use:

1. **Value Presence Check**: 
   - Verify that the Observation resource contains at least one of the following value elements:
     - `Observation.valueQuantity`
     - `Observation.valueCodeableConcept`
     - `Observation.valueString`
     - `Observation.valueBoolean`
     - `Observation.valueInteger`
     - `Observation.valueRange`
     - `Observation.valueRatio`
     - `Observation.valueSampledData`
     - `Observation.valueTime`
     - `Observation.valueDateTime`
     - `Observation.valuePeriod`

2. **Alternative Value Representation**:
   - If no direct value element is present, verify that `Observation.component` elements exist and contain values
   - If neither direct values nor components with values exist, verify that `Observation.dataAbsentReason` is present to explain the absence

#### Test Cases

**Test Case 1: Direct Value Presence**
- **Objective**: Verify tobacco use Observations contain a value
- **Method**: 
  - Search for Observations with tobacco use codes (e.g., LOINC 96842-0, 72166-2, 229819007)
  - For each returned Observation, assert that at least one value[x] element is populated
- **Pass Criteria**: All tobacco use Observations have a populated value element
- **Fail Criteria**: Any tobacco use Observation lacks both a value element and appropriate data absent reason

**Test Case 2: Component Value Presence**
- **Objective**: Verify tobacco use Observations with components contain values
- **Method**:
  - Identify Observations with tobacco use codes that use component structure
  - For each component, verify that component.value[x] is populated or component.dataAbsentReason is present
- **Pass Criteria**: All components in tobacco use Observations have either a value or data absent reason
- **Fail Criteria**: Any component lacks both value and data absent reason

**Test Case 3: Data Absent Reason Validation**
- **Objective**: Verify appropriate handling when tobacco use value is absent
- **Method**:
  - Identify tobacco use Observations without direct values or component values
  - Verify that `Observation.dataAbsentReason` is present and contains an appropriate code
- **Pass Criteria**: Observations without values have valid dataAbsentReason codes
- **Fail Criteria**: Observations lack both values and data absent reasons

#### Expected Test Results

**Passing Test Results**:
- All tobacco use Observation resources contain either:
  - A populated value[x] element, OR
  - Component elements with populated component.value[x] elements, OR  
  - A valid `dataAbsentReason` explaining why the value is absent

**Failing Test Results**:
- Any tobacco use Observation resource that lacks:
  - Any value[x] element AND
  - Any component.value[x] elements AND
  - A valid `dataAbsentReason` code

#### Error Handling
- If no tobacco use Observations are found, the test should report this condition rather than fail
- If server returns errors during search operations, document the specific error codes and messages
- Validate that search parameters are supported as specified in the Capability Statement

---

<a id='req-036'></a>

### REQ-036: Observation SHALL include a category of 'Laboratory'

**Text**: 

**Context**: 

**Actor**: Observation

**Conformance**: SHALL

# Test Specification for REQ-036

## 1. Requirement ID
REQ-036

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified by examining the `category` element of Observation resources to confirm the presence of a 'Laboratory' category code.

### Complexity
**Simple** - The test involves checking for the presence of a specific category value in Observation resources.

### Prerequisites
- System must support at least one US Core Observation profile that can include laboratory observations
- System must have Observation resources with laboratory data available for testing
- System must support the search-type and read operations for Observation resources (as specified in capability statement)

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources that represent laboratory tests/results
- **Test Data**: Any existing laboratory Observation resources in the system under test
- **System Capability**: Access to a FHIR server implementing US Core Observation profiles

### Expected Outputs
- Observation resources containing `category` elements with 'Laboratory' category codes
- Successful validation that all laboratory observations include the required category

### Required FHIR Operations
Based on the capability statement, the following supported operations will be used:
1. **GET [base]/Observation?patient=[id]&category=laboratory** - Search for laboratory observations
2. **GET [base]/Observation/[id]** - Read specific Observation resources for validation
3. **GET [base]/Patient?_id=[id]** - Retrieve patient data to identify valid patient references for observation searches

### Validation Criteria

#### Primary Assertions
1. **Category Presence Check**: Each Observation resource identified as a laboratory observation MUST contain at least one `category` element
2. **Laboratory Category Verification**: At least one `category` element MUST contain a coding with:
   - System: `http://terminology.hl7.org/CodeSystem/observation-category`
   - Code: `laboratory`
   - Display: `Laboratory` (optional but recommended)

#### Test Execution Steps
1. **Discovery Phase**:
   - Search for patients in the system: `GET [base]/Patient`
   - For each patient, search for observations with laboratory category: `GET [base]/Observation?patient=[patient-id]&category=laboratory`

2. **Validation Phase**:
   - For each returned Observation resource:
     - Verify the resource contains a `category` array
     - Verify at least one category entry has the coding system `http://terminology.hl7.org/CodeSystem/observation-category`
     - Verify at least one category entry has the code `laboratory`

3. **Completeness Check**:
   - If the system claims to support laboratory observations, verify that the search returns results
   - Validate that all laboratory-type observations (identified by their `code` or context) include the required category

#### Pass Criteria
- **All laboratory Observation resources include the required 'Laboratory' category**
- **The category coding uses the correct system and code values**
- **No laboratory observations are found without the required category**

#### Fail Criteria
- **Any laboratory Observation resource lacks a category element**
- **Any laboratory Observation resource lacks the specific 'laboratory' category code**
- **Category codes use incorrect system URIs or code values**

#### Edge Cases to Consider
- Observations with multiple categories (ensure 'laboratory' is present among them)
- Observations that may be laboratory-related but use different category codes
- Systems that may not have laboratory observations (should be clearly documented as not applicable)

#### Conformance Notes
- This requirement applies to all Observation profiles that represent laboratory data
- The requirement is specifically about the presence of the category, not about which specific laboratory tests are supported
- Systems should use the standard FHIR observation category code system for consistency

---

<a id='req-037'></a>

### REQ-037: Observation SHALL include a code for Rapid Covid Antigen Test

**Text**: 

**Context**: 

**Actor**: Observation

**Conformance**: SHALL

# Test Specification for REQ-037

## Requirement ID
REQ-037

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified by examining Observation resources to ensure they contain appropriate codes for Rapid Covid Antigen Tests.

### Complexity
**Simple** - The test involves validating the presence of a specific code element in Observation resources.

### Prerequisites
- FHIR server implementing US Core Server Capability Statement
- Observation resources representing at-home in-vitro tests (specifically Rapid Covid Antigen Tests)
- Server must support Observation resource read and search operations as specified in the Capability Statement

## Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources that represent Rapid Covid Antigen Tests
- **Test Data**: Any existing Observation resources in the system that are intended to represent at-home in-vitro tests for COVID-19 antigen detection
- **Search Parameters**: Patient reference and category/code combinations supported by the server

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required for testing:

1. **GET [base]/Observation/[id]** - Read individual Observation resources
2. **GET [base]/Observation?patient=[id]&code=[code]** - Search for Observations by patient and code
3. **GET [base]/Observation?patient=[id]&category=[category]** - Search for Observations by patient and category

### Validation Criteria

#### Test Case 1: Direct Resource Validation
**Objective**: Verify that Observation resources representing Rapid Covid Antigen Tests contain required code elements

**Test Steps**:
1. Retrieve Observation resources that represent at-home COVID-19 antigen tests using supported search parameters
2. For each retrieved Observation resource, verify the presence of `Observation.code`
3. Validate that the code appropriately identifies the observation as a Rapid Covid Antigen Test

**Pass Criteria**:
- `Observation.code` element is present and populated
- The code value semantically represents a Rapid Covid Antigen Test (e.g., using appropriate LOINC, SNOMED CT, or other standardized coding system)
- Code system and code value are properly formatted according to FHIR coding requirements

#### Test Case 2: Search-Based Validation
**Objective**: Verify that Rapid Covid Antigen Test observations can be retrieved using code-based searches

**Test Steps**:
1. Perform search queries using `GET [base]/Observation?patient=[id]&code=[rapid-covid-antigen-test-code]`
2. Verify that appropriate Observation resources are returned
3. Confirm that returned resources contain the expected code elements

**Pass Criteria**:
- Search returns relevant Observation resources when using appropriate test codes
- All returned Observation resources contain properly formatted `Observation.code` elements
- Code values correspond to Rapid Covid Antigen Test concepts

#### Test Case 3: Category-Based Validation (if applicable)
**Objective**: Verify that observations are appropriately categorized and coded

**Test Steps**:
1. Search for observations using category parameters: `GET [base]/Observation?patient=[id]&category=laboratory`
2. Filter results to identify COVID antigen test observations
3. Verify code presence and appropriateness

**Pass Criteria**:
- Observations representing Rapid Covid Antigen Tests are retrievable through appropriate category searches
- Each relevant Observation contains the required `code` element
- Code values are consistent with the test type being represented

### Failure Criteria
- Observation resources representing Rapid Covid Antigen Tests lack the `Observation.code` element
- Code values are missing, improperly formatted, or do not semantically represent the intended test type
- Unable to retrieve Rapid Covid Antigen Test observations through supported search mechanisms

### Notes
- This test should be conducted using whatever Observation data exists in the test system, following a "bring your own data" approach
- The specific code values will depend on the coding system used by the implementation (LOINC, SNOMED CT, etc.)
- Test should verify the structural requirement (presence of code) while allowing flexibility in the specific codes used, provided they appropriately represent Rapid Covid Antigen Tests

---

<a id='req-038'></a>

### REQ-038: Observation SHALL include a value for Rapid Covid Antigen Test

**Text**: 

**Context**: 

**Actor**: Observation

**Conformance**: SHALL

# Test Specification for REQ-038

## 1. Requirement ID
REQ-038

## 2. Requirement Analysis

### Testability Assessment
**Not testable due to being too vague**

The requirement states "Observation SHALL include a value for Rapid Covid Antigen Test" but lacks critical specificity:
- No definition of what constitutes a "Rapid Covid Antigen Test" (specific LOINC codes, SNOMED codes, etc.)
- No specification of what "value" means in this context (coded result, numeric value, text, etc.)
- No clear identification of which Observation profile(s) this applies to
- No context about when this requirement applies (all COVID tests, specific scenarios, etc.)

### Complexity
**Not Applicable** - Requirement cannot be tested due to insufficient specification

### Prerequisites
**Not Applicable** - Cannot determine prerequisites without clearer requirement definition

## 3. Test Implementation Strategy

### Required Inputs
**Cannot be determined** - The requirement lacks sufficient detail to specify:
- Which FHIR Observation profile(s) to test against
- How to identify "Rapid Covid Antigen Test" observations
- What constitutes a valid "value" for such tests

### Required FHIR Operations
**Cannot be determined** - Without clear identification criteria, cannot specify which API operations would be needed

### Validation Criteria
**Cannot be established** - The requirement needs clarification on:
- Specific codes or criteria that identify a "Rapid Covid Antigen Test"
- What constitutes an acceptable "value" (data type, value set, format)
- Which Observation profile elements must contain this value
- Whether this applies to all such tests or specific contexts

## Recommendation for Requirement Clarification

To make this requirement testable, it should specify:

1. **Test Identification**: Specific codes (LOINC, SNOMED, etc.) that identify "Rapid Covid Antigen Test" observations
2. **Applicable Profile**: Which US Core Observation profile(s) this requirement applies to (e.g., US Core Laboratory Result Observation Profile)
3. **Value Requirements**: 
   - Which element(s) must contain the value (Observation.value[x], Observation.component.value[x])
   - Expected data type and format
   - Required value sets or acceptable values
4. **Context**: When this requirement applies (all such tests, specific use cases, etc.)

Example of a more testable requirement:
*"Observations conforming to the US Core Laboratory Result Observation Profile with Observation.code from the 'COVID-19 Rapid Antigen Test' value set SHALL include a coded value in Observation.valueCodeableConcept from the 'COVID-19 Test Result' value set."*

---

<a id='req-039'></a>

### REQ-039: Observation SHALL include a code for alcohol consumption

**Text**: 

**Context**: 

**Actor**: Observation

**Conformance**: SHALL

# Test Specification for REQ-039

## 1. Requirement ID
**REQ-039**: Observation SHALL include a code for alcohol consumption

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified programmatically by examining Observation resources to ensure they contain appropriate alcohol consumption codes.

### Complexity
**Simple** - The requirement involves checking for the presence of specific code values in the Observation.code element.

### Prerequisites
- System must support US Core Observation profiles as specified in the Capability Statement
- System must have Observation resources available for testing
- Test data should include Observation resources that represent alcohol consumption assessments (such as AUDIT-C screening tools)

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources that represent alcohol consumption assessments
- **Expected Data Elements**: 
  - Observation resources with codes indicating alcohol consumption screening/assessment
  - Based on the source reference to "AUDIT-C-item-example-68519-8", expect LOINC code 68519-8 or related alcohol consumption codes

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for Observation resources:

1. **Search Operations**:
   - `GET [base]/Observation?patient=[patient-id]&category=[category]`
   - `GET [base]/Observation?patient=[patient-id]&code=[alcohol-consumption-code]`

2. **Read Operations**:
   - `GET [base]/Observation/[id]`

### Validation Criteria

#### Test Case 1: Verify Alcohol Consumption Code Presence
**Objective**: Confirm that Observation resources representing alcohol consumption contain appropriate codes

**Steps**:
1. Search for Observation resources using patient and category parameters
2. Filter results to identify observations related to alcohol consumption
3. For each alcohol consumption observation, verify that `Observation.code` is present and populated

**Assertions**:
- `Observation.code` element SHALL be present
- `Observation.code.coding` SHALL contain at least one coding element
- The coding SHALL include a code that represents alcohol consumption assessment (e.g., LOINC codes for alcohol screening such as 68519-8 "How often did you have a drink containing alcohol in the past year")

#### Test Case 2: Code System Validation
**Objective**: Ensure alcohol consumption codes use appropriate code systems

**Steps**:
1. Retrieve Observation resources identified as alcohol consumption assessments
2. Examine the `Observation.code.coding` elements
3. Validate the code system and code values

**Assertions**:
- `Observation.code.coding.system` SHALL be present
- `Observation.code.coding.code` SHALL be present
- Code system SHOULD be a recognized terminology (e.g., LOINC, SNOMED CT)
- Code values SHOULD be clinically appropriate for alcohol consumption assessment

#### Test Case 3: Profile Conformance
**Objective**: Verify that alcohol consumption observations conform to applicable US Core profiles

**Steps**:
1. Identify Observation resources with alcohol consumption codes
2. Validate against US Core Observation profiles as specified in the Capability Statement
3. Check profile conformance declarations

**Assertions**:
- Observation resources SHALL validate against at least one supported US Core Observation profile
- If the observation is a screening assessment, it SHOULD conform to the US Core Observation Screening Assessment Profile
- All must-support elements for the applicable profile SHALL be present when data is available

#### Test Case 4: Search Capability Verification
**Objective**: Confirm that alcohol consumption observations can be retrieved via supported search parameters

**Steps**:
1. Use supported search parameters to locate alcohol consumption observations:
   - `GET [base]/Observation?patient=[id]&code=[alcohol-code]`
   - `GET [base]/Observation?patient=[id]&category=survey`
2. Verify search results contain relevant observations

**Assertions**:
- Search operations SHALL return appropriate results
- Returned observations SHALL include those with alcohol consumption codes
- Search results SHALL be consistent with direct resource retrieval

### Pass/Fail Criteria
- **PASS**: All Observation resources representing alcohol consumption contain valid codes in the `Observation.code` element with appropriate code systems and values
- **FAIL**: Any Observation resource representing alcohol consumption lacks a code element, has empty/null codes, or uses inappropriate coding systems for alcohol consumption assessment

### Notes
- The test should accommodate various alcohol consumption assessment tools (AUDIT-C, AUDIT, etc.) and their corresponding codes
- Focus on structural conformance rather than clinical validity of specific code choices
- Ensure test cases work with whatever alcohol consumption data is available in the test system

---

<a id='req-040'></a>

### REQ-040: Observation SHALL include a value for alcohol consumption

**Text**: 

**Context**: 

**Actor**: Observation

**Conformance**: SHALL

# Test Specification for REQ-040

## 1. Requirement ID
REQ-040

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be validated through automated testing by examining the structure and content of Observation resources to verify the presence of alcohol consumption values.

### Complexity
**Simple** - The requirement involves straightforward validation of a single field presence in an Observation resource.

### Prerequisites
- System must support US Core Server capabilities for Observation resources
- Test data must include Observation resources that are intended to represent alcohol consumption assessments (specifically AUDIT-C related observations based on the source context)
- System must be capable of FHIR RESTful read operations for Observation resources

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Observation resources representing alcohol consumption data (particularly those following the AUDIT-C item pattern referenced in the source)
- The Observations should be identifiable as alcohol consumption related through their code or category

**Expected Outputs:**
- Observation resources that contain a populated `value` element (valueQuantity, valueCodeableConcept, valueString, valueBoolean, valueInteger, valueRange, valueRatio, valueSampledData, valueTime, valueDateTime, or valuePeriod)

### Required FHIR Operations
Based on the Capability Statement, the following supported operations will be used:
- **GET /Observation/{id}** - Direct read of specific Observation resources
- **GET /Observation?patient={patient-id}&code={alcohol-code}** - Search for alcohol consumption observations by patient and code
- **GET /Observation?patient={patient-id}&category={category}** - Search for observations by patient and category if alcohol consumption falls under a specific category

### Validation Criteria

**Primary Assertions:**
1. **Value Presence Check**: Each Observation resource identified as alcohol consumption related SHALL contain a non-null, non-empty value element
   - Verify that at least one of the value[x] elements exists: `valueQuantity`, `valueCodeableConcept`, `valueString`, `valueBoolean`, `valueInteger`, `valueRange`, `valueRatio`, `valueSampledData`, `valueTime`, `valueDateTime`, or `valuePeriod`

2. **Value Content Validation**: The value element SHALL contain meaningful data
   - For `valueQuantity`: Must have a numeric value and appropriate unit for alcohol consumption
   - For `valueCodeableConcept`: Must contain a coded value representing alcohol consumption level/frequency
   - For `valueString`: Must be a non-empty string with alcohol consumption information
   - For other value types: Must contain appropriate data structure with non-null core elements

**Secondary Assertions:**
3. **Resource Identification**: Verify that the Observation is correctly identified as alcohol consumption related through:
   - `code` element containing alcohol consumption related LOINC codes (e.g., codes from AUDIT-C questionnaire)
   - `category` element if applicable for grouping alcohol-related observations

**Test Passing Criteria:**
- **PASS**: All alcohol consumption Observation resources contain a populated value element with meaningful data
- **FAIL**: Any alcohol consumption Observation resource lacks a value element or contains only null/empty value elements
- **NOT APPLICABLE**: No alcohol consumption Observation resources found in the test dataset

**Implementation Notes:**
- The test should be flexible enough to work with different alcohol consumption measurement approaches (frequency, quantity, coded responses, etc.)
- The test should accommodate the "bring your own data" approach by dynamically identifying alcohol consumption observations rather than relying on fixed resource IDs
- Consider that different implementations may use different value types for representing alcohol consumption data

---

<a id='req-056'></a>

### REQ-056: Observation SHALL have a status.

**Text**: 

**Context**: 

**Actor**: Healthcare Provider

**Conformance**: SHALL

# Test Specification for REQ-056

## 1. Requirement ID
**REQ-056**: Observation SHALL have a status.

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified programmatically by checking for the presence and validity of the `status` field in Observation resources.

### Complexity
**Simple** - This is a straightforward validation of a mandatory field presence and value conformance.

### Prerequisites
- Access to a FHIR server implementing US Core Server capabilities
- Observation resources available in the system (any US Core Observation profile)
- Valid authentication/authorization to access Observation resources

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Any Observation resources conforming to supported US Core Observation profiles:
  - US Core Laboratory Result Observation Profile
  - US Core Vital Signs Profile (including specific vital signs profiles like Blood Pressure, Heart Rate, etc.)
  - US Core Simple Observation Profile
  - US Core Observation Clinical Result Profile
  - US Core Observation Screening Assessment Profile
  - Any other US Core Observation profiles listed in the Capability Statement

### Expected Outputs
- Confirmation that all retrieved Observation resources contain a `status` element
- Validation that the `status` values conform to the required ValueSet (registered | preliminary | final | amended | corrected | cancelled | entered-in-error | unknown)

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for Observation resources:

1. **Search Operations**:
   - `GET [base]/Observation?patient=[id]` - Retrieve observations for a specific patient
   - `GET [base]/Observation?category=[category]&patient=[id]` - Search by category and patient
   - `GET [base]/Observation?status=[status]&patient=[id]` - Search by status and patient
   - `GET [base]/Observation?code=[code]&patient=[id]` - Search by observation code and patient

2. **Read Operations**:
   - `GET [base]/Observation/[id]` - Direct resource retrieval

### Validation Criteria

#### Test Case 1: Patient-based Observation Retrieval
**Objective**: Verify that all Observation resources for a patient contain a status element.

**Steps**:
1. Execute: `GET [base]/Observation?patient=[patient-id]`
2. For each returned Observation resource in the Bundle:
   - Assert that `Observation.status` element is present
   - Assert that `Observation.status` value is one of: `registered`, `preliminary`, `final`, `amended`, `corrected`, `cancelled`, `entered-in-error`, `unknown`
3. **Pass Criteria**: All Observation resources have a valid `status` element
4. **Fail Criteria**: Any Observation resource is missing the `status` element or contains an invalid status value

#### Test Case 2: Category-filtered Observation Retrieval
**Objective**: Verify status requirement across different observation categories.

**Steps**:
1. Execute: `GET [base]/Observation?patient=[patient-id]&category=vital-signs`
2. Execute: `GET [base]/Observation?patient=[patient-id]&category=laboratory`
3. Execute: `GET [base]/Observation?patient=[patient-id]&category=survey` (if applicable)
4. For each returned Observation resource across all category searches:
   - Assert that `Observation.status` element is present
   - Assert that `Observation.status` value is valid per FHIR ValueSet
5. **Pass Criteria**: All Observation resources regardless of category have valid `status` elements
6. **Fail Criteria**: Any Observation resource lacks a `status` element or has an invalid status value

#### Test Case 3: Direct Resource Retrieval
**Objective**: Verify status requirement for directly accessed Observation resources.

**Steps**:
1. Obtain Observation resource IDs from previous searches or system data
2. Execute: `GET [base]/Observation/[observation-id]` for multiple observations
3. For each directly retrieved Observation:
   - Assert that `Observation.status` element is present
   - Assert that `Observation.status` value conforms to the required ValueSet
4. **Pass Criteria**: All directly accessed Observation resources contain valid `status` elements
5. **Fail Criteria**: Any directly accessed Observation resource is missing `status` or has invalid status value

#### Test Case 4: Status-specific Search Validation
**Objective**: Verify that status-based searches return observations with correct status values.

**Steps**:
1. Execute: `GET [base]/Observation?patient=[patient-id]&status=final`
2. Execute: `GET [base]/Observation?patient=[patient-id]&status=preliminary`
3. For each search result:
   - Assert that returned Observations have the requested status value
   - Assert that the `status` element is properly populated
4. **Pass Criteria**: Search results match requested status and all have valid `status` elements
5. **Fail Criteria**: Returned observations have incorrect status values or missing `status` elements

### Additional Validation Notes
- Tests should be executed using the "bring your own data" approach, working with whatever Observation resources exist in the target system
- If no Observation resources exist for a given patient, the test should be marked as "Not Applicable" rather than failed
- Tests should accommodate various US Core Observation profiles as listed in the Capability Statement
- Error handling should account for authorization issues or server errors that prevent resource access

---

<a id='req-057'></a>

### REQ-057: Observation SHALL specify a category.

**Text**: 

**Context**: 

**Actor**: Healthcare Provider

**Conformance**: SHALL

# Test Specification for REQ-057

## 1. Requirement ID
**REQ-057**: Observation SHALL specify a category

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified through automated validation by checking that the `category` element is present and properly populated in Observation resources.

### Complexity
**Simple** - This is a straightforward structural validation requirement that checks for the presence of a mandatory element.

### Prerequisites
- System under test must support the Observation resource type
- System must implement one or more US Core Observation profiles (as indicated in the Capability Statement)
- Test data must include Observation resources that would be expected to have categories per the US Core implementation

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources from the system under test
- **Test Scope**: All Observation instances accessible through the system's FHIR API
- **Profile Context**: Focus on US Core Observation profiles listed in the Capability Statement:
  - US Core Laboratory Result Observation Profile
  - US Core Vital Signs Profile
  - US Core Simple Observation Profile
  - US Core Observation Clinical Result Profile
  - US Core Observation Screening Assessment Profile
  - And other US Core Observation profiles as applicable

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and should be used:

1. **Search Operations** (using supported search parameters):
   - `GET [base]/Observation?patient={id}`
   - `GET [base]/Observation?category={category}`
   - `GET [base]/Observation?patient={id}&category={category}`
   - `GET [base]/Observation?code={code}`
   - `GET [base]/Observation?patient={id}&code={code}`

2. **Read Operations**:
   - `GET [base]/Observation/{id}` - for individual resource validation

### Validation Criteria

#### Primary Validation
For each Observation resource retrieved:

1. **Category Presence Check**:
   - ASSERT: The `category` element exists in the Observation resource
   - ASSERT: The `category` array is not empty
   - ASSERT: At least one `category` entry contains a valid CodeableConcept

2. **Category Structure Validation**:
   - ASSERT: Each `category` entry follows the CodeableConcept structure
   - ASSERT: Each `category` entry contains either:
     - A `coding` array with at least one valid Coding, OR
     - A `text` element with a non-empty string value

3. **Profile-Specific Category Validation** (when applicable):
   - For Vital Signs observations: ASSERT category includes coding from `http://terminology.hl7.org/CodeSystem/observation-category` with code "vital-signs"
   - For Laboratory observations: ASSERT category includes coding with code "laboratory"
   - For Survey observations: ASSERT category includes coding with code "survey"

#### Test Execution Strategy

1. **Comprehensive Resource Retrieval**:
   - Execute patient-based searches to retrieve all Observation resources
   - Execute category-based searches to retrieve observations by specific categories
   - Execute code-based searches to retrieve observations by specific codes

2. **Validation Process**:
   - For each retrieved Observation resource, perform the category validation checks
   - Track any observations that fail the category requirement
   - Generate a compliance report showing the percentage of compliant observations

3. **Expected Test Results**:
   - **PASS**: All Observation resources contain a properly structured `category` element
   - **FAIL**: Any Observation resource lacks a `category` element or has an improperly structured category
   - **WARN**: Observations with category present but missing expected profile-specific category codes

#### Error Conditions to Report
- Observation resources with missing `category` element
- Observation resources with empty `category` array
- Observation resources with malformed CodeableConcept in `category`
- Category entries with neither valid coding nor text content

This test specification ensures that all Observation resources conform to the SHALL requirement for specifying a category, while accommodating the "bring your own data" approach by testing against whatever Observation data exists in the system under test.

---

<a id='req-058'></a>

### REQ-058: Observation SHALL have a code.

**Text**: 

**Context**: 

**Actor**: Healthcare Provider

**Conformance**: SHALL

# Test Specification for REQ-058

## 1. Requirement ID
**REQ-058**: Observation SHALL have a code

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be programmatically verified by checking that every Observation resource contains a populated `code` element.

### Complexity
**Simple** - This is a straightforward structural validation that requires checking for the presence of a required field.

### Prerequisites
- System must support US Core Observation profiles as specified in the Capability Statement
- System must have Observation resources available for testing
- Test system must be able to perform read operations and search operations on Observation resources

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources conforming to any of the US Core Observation profiles listed in the Capability Statement (e.g., Laboratory Results, Vital Signs, Clinical Results, etc.)
- **Test Data**: Any existing Observation resources in the system under test

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required for testing:

1. **Read Operation**: `GET [base]/Observation/[id]`
   - Used to retrieve individual Observation resources for validation

2. **Search Operations**: `GET [base]/Observation?[search-parameters]`
   - Supported search combinations from Capability Statement:
     - `patient + category`
     - `patient + code`
     - `patient + category + date`
     - Additional combinations as specified

### Validation Criteria

#### Primary Assertion
For each Observation resource tested:
- **PASS**: Observation.code element is present AND contains at least one coding or text value
- **FAIL**: Observation.code element is missing, empty, or null

#### Specific Validation Steps

1. **Structure Validation**:
   - Verify `Observation.code` element exists
   - Verify `Observation.code` is not null or empty

2. **Content Validation**:
   - At minimum, one of the following must be present:
     - `Observation.code.coding` array with at least one valid Coding element
     - `Observation.code.text` with non-empty string value

3. **Coding Element Validation** (if present):
   - Each `Observation.code.coding` element should have a valid `code` value
   - System URI should be present and valid when provided

#### Test Execution Approach

**Option 1: Search-Based Testing**
1. Execute supported search operations to retrieve Observation resources
2. For each returned resource, validate the code requirement
3. Report any resources that fail the validation

**Option 2: Direct Resource Testing**
1. If specific Observation resource IDs are known, use read operations
2. Validate each retrieved resource against the code requirement

#### Expected Test Results

**Pass Criteria**:
- All tested Observation resources contain a valid `code` element
- No Observation resources are missing the required code element

**Fail Criteria**:
- Any Observation resource lacks a `code` element
- Any Observation resource has an empty or null `code` element

#### Reporting Requirements

Test results should include:
- Total number of Observation resources tested
- Number of resources that passed validation
- Number of resources that failed validation
- Specific details for any failures, including:
  - Resource ID
  - Resource type/profile
  - Description of the validation failure

#### Additional Considerations

- Test should cover multiple US Core Observation profiles if supported by the system
- Test should accommodate various coding systems (LOINC, SNOMED CT, etc.) as appropriate for different observation types
- Test should not require specific code values, only that a code element is present and properly formatted

---

<a id='req-059'></a>

### REQ-059: Observation SHALL have an effective date.

**Text**: 

**Context**: 

**Actor**: Healthcare Provider

**Conformance**: SHALL

# Test Specification for REQ-059

## Requirement ID
REQ-059

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated programmatically by checking for the presence of effective date elements in Observation resources.

### Complexity
**Simple** - The requirement involves a straightforward validation of mandatory field presence in a single resource type.

### Prerequisites
- System must support US Core Observation profiles as specified in the Capability Statement
- System must have Observation resources available for testing
- Test client must have appropriate authentication/authorization to access Observation resources

## Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources conforming to any of the US Core Observation profiles listed in the Capability Statement
- **Test Data**: System's existing Observation data (bring your own data approach)
- **Authentication**: Valid credentials for accessing the FHIR server

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required for testing:

1. **Read Operation**: `GET [base]/Observation/[id]`
   - Use to retrieve individual Observation resources for validation

2. **Search Operations**: `GET [base]/Observation?[search-parameters]`
   - Primary search combinations supported:
     - `patient + category`
     - `patient + category + date`
     - `patient + code`
     - `patient + code + date`

### Validation Criteria

For each Observation resource retrieved, verify that **at least one** of the following effective date elements is present and populated:

1. **Observation.effectiveDateTime** - Single point in time
2. **Observation.effectivePeriod** - Time period with start and/or end
3. **Observation.effectiveTiming** - Complex timing information
4. **Observation.effectiveInstant** - Precise timestamp

#### Specific Assertions

**Pass Conditions:**
- Observation resource contains at least one of the effective[x] elements
- The effective[x] element contains a valid date/time value (not empty or null)
- The date format conforms to FHIR dateTime, Period, Timing, or instant data types

**Fail Conditions:**
- Observation resource lacks all effective[x] elements
- All present effective[x] elements are empty, null, or contain invalid date values
- Effective date elements are present but do not conform to FHIR data type specifications

#### Test Steps

1. **Discovery Phase**:
   - Query the system for available Observation resources using supported search parameters
   - Collect a representative sample of Observation resources across different profiles

2. **Validation Phase**:
   - For each Observation resource:
     - Verify presence of at least one effective[x] element
     - Validate the data type and format of the effective date element
     - Confirm the value is not empty or null

3. **Coverage Assessment**:
   - Ensure testing covers Observation resources from multiple US Core profiles where applicable
   - Verify the requirement holds across different categories of observations (vital signs, laboratory results, clinical observations, etc.)

#### Expected Results
- **100% compliance**: All Observation resources must have an effective date
- **Clear reporting**: Test results should identify any non-compliant resources with specific details about missing or invalid effective date elements
- **Profile coverage**: Results should demonstrate testing across the various US Core Observation profiles supported by the system

---

<a id='req-064'></a>

### REQ-064: Observation SHALL have a code.

**Text**: 

**Context**: 

**Actor**: Healthcare Provider

**Conformance**: SHALL

# Test Specification for REQ-064

## Requirement ID
REQ-064

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified programmatically by checking for the presence of the `code` element in Observation resources.

### Complexity
**Simple** - This is a straightforward structural validation that requires checking for the existence of a mandatory element.

### Prerequisites
- FHIR server implementing US Core Observation profiles
- Access to Observation resources on the server
- Server must support at least one of the US Core Observation profiles listed in the Capability Statement

## Test Implementation Strategy

### Required Inputs
- **FHIR Server Endpoint**: Base URL of the FHIR server under test
- **Test Patient ID**: Valid patient identifier to retrieve Observation resources
- **Authentication credentials**: If required by the server

### Expected Outputs
- All retrieved Observation resources must contain a `code` element
- Test pass/fail results indicating conformance with the requirement

### Required FHIR Operations

Based on the Capability Statement, the following operations are supported for Observation resources:

1. **Read Operation**:
   ```
   GET [base]/Observation/[id]
   ```

2. **Search Operations** (SHALL support):
   ```
   GET [base]/Observation?patient=[patient-id]&category=[category-code]
   GET [base]/Observation?patient=[patient-id]&code=[code-value]
   ```

3. **Search with Date** (SHALL support):
   ```
   GET [base]/Observation?patient=[patient-id]&category=[category-code]&date=[date-value]
   GET [base]/Observation?patient=[patient-id]&code=[code-value]&date=[date-value]
   ```

### Validation Criteria

#### Test Case 1: Individual Observation Read Validation
**Objective**: Verify that individual Observation resources contain a code element

**Steps**:
1. Retrieve a list of Observation resource IDs for the test patient using search operations
2. For each Observation ID, perform a read operation: `GET [base]/Observation/[id]`
3. Parse the returned Observation resource
4. Verify that the `code` element exists and is not null/empty

**Assertions**:
- ✅ **PASS**: `Observation.code` element is present
- ❌ **FAIL**: `Observation.code` element is missing or null

#### Test Case 2: Search Results Validation
**Objective**: Verify that all Observation resources returned in search results contain a code element

**Steps**:
1. Execute search operations to retrieve Observation resources:
   - `GET [base]/Observation?patient=[patient-id]&category=vital-signs`
   - `GET [base]/Observation?patient=[patient-id]&category=laboratory`
   - `GET [base]/Observation?patient=[patient-id]&category=survey`
2. For each Bundle entry containing an Observation resource
3. Verify that the `code` element exists in each Observation

**Assertions**:
- ✅ **PASS**: All returned Observation resources contain a `code` element
- ❌ **FAIL**: Any Observation resource is missing the `code` element

#### Test Case 3: Profile-Specific Validation
**Objective**: Verify code presence across different US Core Observation profiles

**Steps**:
1. Identify the specific US Core Observation profiles supported by the server
2. Retrieve Observation resources conforming to each supported profile
3. Validate `code` element presence for each profile type

**Assertions**:
- ✅ **PASS**: All Observation resources across all supported US Core profiles contain a `code` element
- ❌ **FAIL**: Any Observation resource from any supported profile is missing the `code` element

#### Data Quality Validation
Beyond presence, the test should also verify:
- The `code` element contains at least one coding with a valid code value
- The coding system is specified where required by the specific US Core profile
- The code is appropriate for the Observation category (when determinable)

#### Error Handling
- If no Observation resources are found for the test patient, the test should be marked as **INCONCLUSIVE** rather than PASS/FAIL
- Server errors (4xx/5xx responses) should be reported separately from conformance failures
- Network timeouts should be distinguished from conformance issues

#### Reporting Requirements
The test results should include:
- Total number of Observation resources tested
- Number of resources that passed/failed the code requirement
- Specific resource IDs that failed validation
- Profile types of the tested resources
- Any server errors encountered during testing

---

<a id='req-065'></a>

### REQ-065: The system SHALL record the observation code as "Hispanic or Latino".

**Text**: 

**Context**: 

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-065

## 1. Requirement ID
**REQ-065**: The system SHALL record the observation code as "Hispanic or Latino"

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified through automated testing by inspecting FHIR Observation resources for specific code values that represent "Hispanic or Latino" ethnicity.

### Complexity
**Simple** - The test involves straightforward validation of observation codes within FHIR Observation resources.

### Prerequisites
- System must support US Core Observation profiles
- System must have Observation resources available for testing (bring your own data approach)
- Test data should include ethnicity-related observations
- System must support FHIR RESTful read operations for Observation resources

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources that contain ethnicity information
- **Expected Codes**: Standard codes that represent "Hispanic or Latino" ethnicity, such as:
  - SNOMED CT codes (e.g., 414408004 "Hispanic or Latino")
  - HL7 ethnicity codes (e.g., "2135-2" from HL7 Ethnicity code system)
  - Other standardized codes representing Hispanic or Latino ethnicity

### Required FHIR Operations
Based on the US Core Server Capability Statement, the following operations are supported and required:

1. **GET /Observation/{id}** - Read specific Observation resources
2. **GET /Observation?[search-parameters]** - Search for Observation resources containing ethnicity data
3. **JSON format support** (SHALL) - All interactions must support JSON format

### Validation Criteria

#### Primary Validation
1. **Code System Validation**: Verify that Observation.code contains appropriate coding for "Hispanic or Latino"
   - Check `Observation.code.coding[].code` values
   - Verify `Observation.code.coding[].system` references appropriate code systems
   - Confirm `Observation.code.coding[].display` accurately represents "Hispanic or Latino"

2. **Conformance to Standards**: Validate that the codes used align with recognized standards:
   - HL7 Ethnicity codes
   - SNOMED CT codes
   - US Core specified value sets for ethnicity

#### Secondary Validation
3. **Profile Conformance**: Ensure Observation resources conform to applicable US Core profiles
   - Validate against US Core Observation profile constraints
   - Check required elements are present and properly formatted

4. **Meta Profile Declaration**: Verify `meta.profile` attribute identifies the US Core profile (SHOULD requirement)

#### Test Assertions for Pass/Fail
**Test PASSES if**:
- At least one Observation resource contains a code representing "Hispanic or Latino" ethnicity
- The code is from a recognized standard code system
- The code accurately represents Hispanic or Latino ethnicity
- The Observation resource validates against US Core profiles

**Test FAILS if**:
- No Observation resources contain codes for "Hispanic or Latino" ethnicity
- Codes used are not from recognized standard code systems
- Code values or displays do not accurately represent Hispanic or Latino ethnicity
- Observation resources fail US Core profile validation

#### Implementation Notes
- Test should accommodate various valid code systems and codes that represent "Hispanic or Latino"
- The test should be flexible enough to work with different healthcare organizations' data representations
- Consider that ethnicity may be recorded in different Observation categories or contexts within the system
- Verify that the system consistently uses the same coding approach across similar ethnicity observations

---

<a id='req-066'></a>

### REQ-066: The system SHALL record the performer of the observation.

**Text**: 

**Context**: 

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-066

## 1. Requirement ID
REQ-066

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - The presence and structure of the `performer` element in Observation resources can be validated programmatically through FHIR resource inspection.

### Complexity
**Simple** - This requirement involves checking for the presence and proper population of a single FHIR element (`Observation.performer`) in Observation resources.

### Prerequisites
- System must support US Core Observation profiles
- System must have Observation resources available for testing
- Test client must have appropriate access permissions to read Observation resources
- System should be configured according to US Core Server CapabilityStatement

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources that conform to US Core Observation profiles
- **Test Data**: Any existing Observation resources in the system (bring your own data approach)
- **Access Credentials**: Valid authentication/authorization for accessing Observation resources

### Expected Outputs
- **Validation Results**: Confirmation that each tested Observation resource contains a properly populated `performer` element
- **Test Report**: Summary of conformance status for the performer requirement across tested resources

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are supported and required for testing:

1. **GET /Observation/[id]** - Read specific Observation resources
2. **GET /Observation?[search-parameters]** - Search for Observation resources using supported US Core search parameters

### Validation Criteria

#### Primary Assertions
1. **Performer Presence Check**: Each Observation resource MUST contain at least one `Observation.performer` element
2. **Performer Structure Validation**: The `performer` element MUST be properly structured as a Reference to an appropriate resource type (e.g., Practitioner, PractitionerRole, Organization, Patient, RelatedPerson, CareTeam)
3. **Reference Validity**: The `performer` reference MUST be valid (either contain a valid reference URL or display text, or both)

#### Detailed Test Steps
1. **Resource Retrieval**: 
   - Retrieve Observation resources using supported search operations or direct read operations
   - Focus on resources that represent observations with identifiable performers

2. **Element Validation**:
   - Verify `Observation.performer` element exists
   - Confirm the element is not empty
   - Validate that the performer is represented as a proper FHIR Reference

3. **Reference Validation**:
   - Check that the Reference has either:
     - A valid `reference` value (URL to the referenced resource)
     - A meaningful `display` value
     - Or both reference and display values
   - Ensure referenced resource types are appropriate for observation performers

#### Pass Criteria
- **100% Compliance**: All tested Observation resources contain a properly populated `performer` element
- **Reference Integrity**: All performer references are structurally valid FHIR References
- **Semantic Appropriateness**: Performer references point to appropriate resource types for observation performers

#### Failure Conditions
- Any Observation resource lacks a `performer` element
- Any `performer` element is empty or null
- Any `performer` Reference lacks both `reference` and `display` values
- Any `performer` Reference contains invalid or malformed reference syntax

### Additional Considerations
- Test should accommodate various types of observations (vital signs, laboratory results, social determinants, etc.)
- Performer may be different types of resources depending on the observation context
- Test should work with existing system data without requiring specific test fixtures
- Consider testing across different observation profiles within US Core

---

<a id='req-067'></a>

### REQ-067: The system SHALL record the value of the observation.

**Text**: 

**Context**: 

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-067

## 1. Requirement ID
REQ-067

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated testing by examining FHIR Observation resources to confirm the presence and proper structure of observation values.

### Complexity
**Simple** - The requirement focuses on a single, well-defined element (observation value) that can be validated through straightforward resource inspection.

### Prerequisites
- System must support US Core Server capabilities as defined in the CapabilityStatement
- System must be capable of storing and retrieving FHIR Observation resources
- Test data must include Observation resources that should contain values
- System must support standard FHIR RESTful operations for Observation resources

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Observation resources (any type) that represent actual clinical observations
- Resources should be representative of the system's typical observation data

**Expected Outputs:**
- Retrieved Observation resources containing properly populated `value[x]` elements
- Confirmation that observation values are recorded in accordance with FHIR R4 specifications

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are required:

1. **GET /Observation/{id}** - Retrieve specific Observation resources by ID
2. **GET /Observation** - Search for Observation resources using supported search parameters
3. **GET /Observation?patient={patient-id}** - Retrieve observations for specific patients (if patient context is available)

### Validation Criteria

**Primary Assertions:**
1. **Value Presence Check**: Each retrieved Observation resource MUST contain at least one of the following value elements:
   - `valueQuantity`
   - `valueCodeableConcept`
   - `valueString`
   - `valueBoolean`
   - `valueInteger`
   - `valueRange`
   - `valueRatio`
   - `valueSampledData`
   - `valueTime`
   - `valueDateTime`
   - `valuePeriod`
   - `valueAttachment`
   - `valueReference`

2. **Value Structure Validation**: When a value element is present, it MUST:
   - Conform to the expected FHIR datatype structure
   - Contain meaningful data (not just empty objects)
   - Be appropriate for the type of observation being recorded

3. **Data Absence Handling**: If an observation value is not present, the resource MUST include:
   - `dataAbsentReason` element explaining why no value is recorded, OR
   - The observation represents a non-value type (e.g.,组件 observations with `component` elements containing values)

**Secondary Assertions:**
1. **FHIR Conformance**: All retrieved Observation resources must be valid FHIR R4 resources
2. **US Core Profile Compliance**: Resources should conform to applicable US Core Observation profiles if claimed
3. **Consistency**: The recorded values should be consistent with the observation's `code` and `category` elements

**Test Pass Criteria:**
- All retrieved Observation resources contain properly recorded values according to the assertions above
- No Observation resources lack both a value element and appropriate `dataAbsentReason`
- All value elements conform to FHIR R4 datatype specifications

**Test Implementation Notes:**
- Tests should accommodate various observation types (vital signs, laboratory results, survey responses, etc.)
- Validation should account for different value types based on the nature of the observation
- Consider observations that may legitimately have no numeric value but contain coded results or textual findings
- Test should work with any valid observation data provided by the implementer

---

<a id='req-068'></a>

### REQ-068: The system SHALL derive the observation from a specific questionnaire response.

**Text**: 

**Context**: 

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-068

## Requirement ID
REQ-068

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be tested by verifying the derivation relationship between an Observation resource and its source QuestionnaireResponse through the `derivedFrom` element.

### Complexity
**Moderate** - Requires validation of resource relationships and proper linking between QuestionnaireResponse and Observation resources, with specific focus on PRAPARE questionnaire responses.

### Prerequisites
- System must support US Core Observation profiles (as indicated in Capability Statement)
- System must support US Core QuestionnaireResponse Profile (SHOULD support level)
- Test data must include:
  - At least one QuestionnaireResponse resource containing PRAPARE questionnaire data
  - At least one Observation resource that should be derived from the QuestionnaireResponse
  - Resources must be linked through the `derivedFrom` element

## Test Implementation Strategy

### Required Inputs
- **QuestionnaireResponse resources**: Must contain PRAPARE questionnaire responses (identifiable by questionnaire reference or canonical URL)
- **Observation resources**: Must contain observations that claim derivation from questionnaire responses
- **Patient resources**: Referenced by both QuestionnaireResponse and Observation resources

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required for testing:

1. **Search QuestionnaireResponse resources**:
   ```
   GET [base]/QuestionnaireResponse?patient=[patient-id]
   ```

2. **Search Observation resources**:
   ```
   GET [base]/Observation?patient=[patient-id]&category=survey
   ```

3. **Read specific resources**:
   ```
   GET [base]/QuestionnaireResponse/[id]
   GET [base]/Observation/[id]
   ```

4. **Search Observations with _include**:
   ```
   GET [base]/Observation?patient=[patient-id]&_include=Observation:derived-from
   ```

### Validation Criteria

#### Primary Validation Checks

1. **Derivation Link Validation**:
   - Verify that Observation resources claiming to be derived from QuestionnaireResponse contain a valid `derivedFrom` reference
   - Confirm the `derivedFrom` reference points to an existing QuestionnaireResponse resource
   - Validate that the referenced QuestionnaireResponse is accessible via the reference

2. **PRAPARE Questionnaire Identification**:
   - Verify that the source QuestionnaireResponse is identifiable as a PRAPARE questionnaire through:
     - `QuestionnaireResponse.questionnaire` reference to a PRAPARE Questionnaire resource, OR
     - Questionnaire canonical URL indicating PRAPARE content
   - Confirm the specific item referenced matches the example context (item 56051-6 if specified)

3. **Resource Consistency Validation**:
   - Verify that the Patient reference is consistent between the QuestionnaireResponse and derived Observation
   - Confirm that the derived Observation's content logically corresponds to the source questionnaire item
   - Validate that the Observation code aligns with the questionnaire item code (e.g., LOINC 56051-6)

4. **Profile Conformance**:
   - Verify the Observation conforms to appropriate US Core Observation profile
   - Confirm the QuestionnaireResponse conforms to US Core QuestionnaireResponse Profile

#### Test Assertions

**PASS Conditions**:
- All Observation resources claiming derivation from QuestionnaireResponse have valid `derivedFrom` references
- Referenced QuestionnaireResponse resources are accessible and contain PRAPARE questionnaire data
- Patient references are consistent between linked resources
- Derived observations contain appropriate codes and values corresponding to source questionnaire items

**FAIL Conditions**:
- Observation resources lack `derivedFrom` references when claiming derivation
- `derivedFrom` references point to non-existent or inaccessible resources
- Referenced QuestionnaireResponse is not identifiable as PRAPARE questionnaire
- Patient references are inconsistent between linked resources
- Derived observation content does not logically correspond to source questionnaire item

#### Additional Validation Steps

1. **Bidirectional Verification**: 
   - For each QuestionnaireResponse, check if there are corresponding derived Observations
   - For each Observation with `derivedFrom`, verify the source QuestionnaireResponse exists

2. **Content Mapping Validation**:
   - Verify that the observation value appropriately represents the questionnaire response answer
   - Confirm that coded values in observations align with questionnaire item codes

3. **Temporal Consistency**:
   - Verify that observation dates are consistent with or after the questionnaire response authored date

---

<a id='req-069'></a>

### REQ-069: The system SHALL record the observation code as "Stress level".

**Text**: 

**Context**: 

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-069

## 1. Requirement ID
REQ-069

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated validation of FHIR Observation resources by checking the observation code value against the expected "Stress level" code.

### Complexity
**Simple** - This is a straightforward validation of a single code value within an Observation resource.

### Prerequisites
- System must support FHIR R4 Observation resources
- System must be capable of creating/storing Observation resources with PRAPARE survey data
- Test data should include Observation resources that represent stress level assessments
- System must implement US Core Server capabilities for Observation resources

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources that represent stress level measurements from PRAPARE assessments
- **Test Data Requirements**: 
  - At least one Observation resource with stress level data
  - Resources should follow the PRAPARE item pattern for stress level (code 93038-8)
  - Resources must be valid FHIR R4 format

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations should be supported:
- `GET [base]/Observation` - Search for Observation resources
- `GET [base]/Observation/[id]` - Read specific Observation resources
- `GET [base]/Observation?code=93038-8` - Search for stress level observations (if supported by server search parameters)

### Validation Criteria

#### Primary Validation
1. **Code Verification**: Each Observation resource representing stress level must have:
   - `Observation.code.coding.code` = "93038-8" 
   - `Observation.code.coding.system` = "http://loinc.org"
   - `Observation.code.coding.display` = "Stress level" (or equivalent display text)

#### Secondary Validations
2. **Resource Structure**: Verify the Observation resource:
   - Is a valid FHIR R4 Observation resource
   - Contains required elements per US Core Observation profile requirements
   - Has appropriate resource metadata

3. **Code System Consistency**: Ensure:
   - The coding system is correctly specified as LOINC
   - The code value matches the PRAPARE stress level item code
   - Display text appropriately represents "Stress level"

#### Test Execution Steps
1. **Discovery**: Query the system for Observation resources using available search parameters
2. **Filtering**: Identify Observation resources that represent stress level assessments (may use code search if available)
3. **Validation**: For each identified stress level Observation:
   - Extract the `Observation.code` element
   - Verify the coding contains the required code "93038-8"
   - Verify the system is "http://loinc.org"
   - Verify the display text represents "Stress level"
4. **Reporting**: Document any non-conformant observations and provide specific details about coding discrepancies

#### Pass/Fail Criteria
- **Pass**: All Observation resources representing stress level contain the correct code "93038-8" with appropriate system and display values
- **Fail**: Any Observation resource representing stress level is missing the required code, has an incorrect code value, incorrect coding system, or inappropriate display text

#### Edge Cases to Consider
- Observations with multiple codings in the code element (ensure at least one matches the requirement)
- Observations with different display text variations that still represent "Stress level"
- Resources that may have been created before this requirement was implemented (consider versioning implications)

---

<a id='req-070'></a>

### REQ-070: The system SHALL record the value of the observation as "Somewhat".

**Text**: 

**Context**: 

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-070

## 1. Requirement ID
REQ-070

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated validation of FHIR Observation resources to check for the presence of the specific value "Somewhat" in observation data.

### Complexity
**Simple** - The requirement involves straightforward validation of a single field value within FHIR Observation resources.

### Prerequisites
- System must support US Core Server capabilities as defined in the CapabilityStatement
- System must have FHIR Observation resources available that relate to PRAPARE item 93038-8
- Test environment must support FHIR R4 API operations
- Access to system's FHIR endpoint with appropriate authentication/authorization

## 3. Test Implementation Strategy

### Required Inputs
**Required FHIR Resources:**
- One or more Observation resources that reference PRAPARE item code 93038-8
- Resources should be accessible via the system's FHIR API endpoint

**Expected Outputs:**
- Observation resources containing `valueString` or `valueCodeableConcept` fields with the value "Somewhat"
- Properly formatted FHIR R4 Observation resources conforming to US Core profiles

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are required:

1. **GET /Observation** - Search for Observation resources
   - With search parameters to filter for PRAPARE-related observations
   - Supported search parameters may include: `code`, `patient`, `category`

2. **GET /Observation/{id}** - Read specific Observation resources by ID
   - To retrieve individual observations for detailed validation

### Validation Criteria

**Test Case 1: Value Verification**
- **Assertion**: Any Observation resource with code 93038-8 (or related PRAPARE coding) SHALL contain the value "Somewhat"
- **Validation Steps**:
  1. Search for Observation resources using `GET /Observation?code=93038-8`
  2. For each returned Observation resource:
     - Verify `Observation.code` contains the PRAPARE item code 93038-8
     - Verify `Observation.valueString` equals "Somewhat" OR
     - Verify `Observation.valueCodeableConcept.text` equals "Somewhat" OR  
     - Verify `Observation.valueCodeableConcept.coding` contains a code with display value "Somewhat"
  3. At least one Observation must be found with the required value

**Test Case 2: Resource Conformance**
- **Assertion**: Retrieved Observation resources SHALL conform to US Core Observation profiles
- **Validation Steps**:
  1. Validate each Observation resource against the appropriate US Core profile
  2. Verify required elements are present and properly formatted
  3. Verify resource structure follows FHIR R4 specification

**Pass Criteria:**
- At least one Observation resource is found that contains PRAPARE item 93038-8
- The identified Observation resource(s) contain the exact value "Somewhat" in an appropriate value field
- All retrieved resources pass US Core profile validation
- API responses return valid HTTP status codes (200, 404 as appropriate)

**Fail Criteria:**
- No Observation resources found with the specified PRAPARE code
- Found Observation resources do not contain "Somewhat" as a value
- Retrieved resources fail US Core profile validation
- API operations return unexpected error codes or malformed responses

---

<a id='req-071'></a>

### REQ-071: The system SHALL record the observation code as "Patient Health Questionnaire 9 item (PHQ-9) total score [Reported]".

**Text**: 

**Context**: 

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-071

## 1. Requirement ID
REQ-071

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified programmatically by examining the `code` element of Observation resources to ensure it contains the specific LOINC code and display text for PHQ-9 total score.

### Complexity
**Simple** - The requirement involves validating a single, specific coding element within an Observation resource.

### Prerequisites
- System must support US Core Observation profiles
- System must have capability to create/store Observation resources with PHQ-9 data
- Test data must include at least one Observation resource representing a PHQ-9 total score
- System must support RESTful FHIR operations as defined in the US Core Server CapabilityStatement

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- One or more Observation resources that represent PHQ-9 total scores
- Resources should conform to US Core Observation profiles

**Expected Resource Characteristics:**
- Observation.code element must be populated
- Observation should represent a PHQ-9 questionnaire result
- Resource should be retrievable via standard FHIR REST operations

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are supported and required for testing:

1. **GET /Observation/[id]** - Retrieve specific Observation resources
2. **GET /Observation?category=survey** - Search for survey-type observations (if PHQ-9 observations are categorized as surveys)
3. **GET /Observation?code=[code]** - Search for observations by code (if supported by the implementation)

### Validation Criteria

**Primary Assertion:**
For each Observation resource that represents a PHQ-9 total score, verify that:

1. **Code System Validation:**
   - `Observation.code.coding` contains at least one coding element where:
     - `system` = "http://loinc.org"
     - `code` = "44261-6"

2. **Display Text Validation:**
   - The coding element with LOINC code "44261-6" has:
     - `display` = "Patient Health Questionnaire 9 item (PHQ-9) total score [Reported]" (exact match, case-sensitive)

**Test Steps:**
1. Retrieve Observation resources from the system using supported search parameters
2. Filter for observations that appear to represent PHQ-9 total scores
3. For each qualifying Observation:
   - Verify `Observation.code.coding` array exists and is not empty
   - Locate coding entry with system "http://loinc.org" and code "44261-6"
   - Verify the display text matches exactly: "Patient Health Questionnaire 9 item (PHQ-9) total score [Reported]"

**Pass Criteria:**
- All PHQ-9 total score Observations have the correct LOINC code (44261-6)
- All such observations have the exact required display text
- No PHQ-9 total score observations use incorrect or variant coding

**Fail Criteria:**
- Any PHQ-9 total score Observation missing the required LOINC code
- Any PHQ-9 total score Observation with incorrect display text (including variations in spelling, capitalization, or punctuation)
- Any PHQ-9 total score Observation using alternative coding systems without the required LOINC coding

**Edge Cases to Consider:**
- Observations with multiple coding elements (should include the required LOINC code among others)
- Observations with additional display languages (primary display should still match requirement)
- System-generated vs. user-entered display text variations

---

<a id='req-072'></a>

### REQ-072: The system SHALL record the value of the observation as "12".

**Text**: 

**Context**: 

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-072

## 1. Requirement ID
**REQ-072**: The system SHALL record the value of the observation as "12".

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be validated through automated testing by examining the `value` field in Observation resources that match the PHQ-9 item context (code 44261-6).

### Complexity
**Simple** - This is a straightforward data validation requirement that checks for a specific numeric value in an Observation resource.

### Prerequisites
- System must support US Core Observation Profile
- System must have Observation resources with LOINC code 44261-6 (PHQ-9 item)
- System must implement RESTful FHIR API operations for Observation retrieval
- Test data should include Observation resources representing PHQ-9 questionnaire responses

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Observation resources with:
  - `code.coding.code` = "44261-6" (LOINC code for PHQ-9 item)
  - `code.coding.system` = "http://loinc.org"
  - `valueInteger` or `valueQuantity` field populated
  - Valid resource metadata (id, status, subject, etc.)

**Expected Outputs:**
- Observation resources where the value field contains the integer value "12"
- HTTP 200 responses for successful retrievals
- Properly formatted FHIR Observation resources conforming to US Core Observation Profile

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are required:

1. **GET /Observation** - Search for Observations
2. **GET /Observation/{id}** - Read specific Observation by ID
3. **GET /Observation?code=44261-6** - Search for PHQ-9 item observations by code

### Validation Criteria

**Primary Assertions:**
1. **Value Validation**: For Observation resources with code 44261-6, verify that:
   - `valueInteger` equals 12, OR
   - `valueQuantity.value` equals 12

2. **Data Type Validation**: Ensure the value is recorded as either:
   - An integer data type (`valueInteger`)
   - A quantity data type with numeric value (`valueQuantity.value`)

3. **Resource Conformance**: Verify that:
   - Observation resources conform to US Core Observation Profile
   - Required fields are present (status, code, subject)
   - LOINC code 44261-6 is properly represented in `code.coding`

**Test Cases:**

**Test Case 1: Direct Resource Validation**
- Retrieve Observation resources with code 44261-6
- Assert that `valueInteger = 12` OR `valueQuantity.value = 12`
- Verify proper LOINC code representation

**Test Case 2: Search-based Validation**
- Execute search: `GET /Observation?code=44261-6`
- Filter results where value equals 12
- Confirm at least one matching resource exists
- Validate the value field format and content

**Passing Criteria:**
- All Observation resources with LOINC code 44261-6 that have a value of "12" are properly recorded with the correct data type
- Resources successfully validate against US Core Observation Profile
- API operations return expected HTTP status codes and properly formatted FHIR resources

**Failure Conditions:**
- Value is recorded as something other than 12
- Value is recorded in incorrect data type or format
- Missing required Observation fields
- Invalid LOINC code representation
- Non-conformant FHIR resource structure

---

<a id='req-073'></a>

### REQ-073: The system SHALL derive the observation from a specific PHQ-9 questionnaire response.

**Text**: 

**Context**: 

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-073

## Requirement ID
REQ-073

## Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be automatically tested by validating the derivation of PHQ-9 observations from questionnaire responses through API interactions and data structure verification.

### Complexity
**Moderate** - The test requires understanding the relationship between QuestionnaireResponse and Observation resources, validating proper derivation logic, and ensuring correct PHQ-9 item mapping.

### Prerequisites
- System must support US Core Observation Screening Assessment Profile
- System must support US Core QuestionnaireResponse Profile (SHOULD support per capability statement)
- PHQ-9 questionnaire must be available in the system
- Test data must include completed PHQ-9 QuestionnaireResponse resources
- System must have derived Observation resources from PHQ-9 questionnaire responses

## Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- QuestionnaireResponse resources with:
  - `questionnaire` reference pointing to a PHQ-9 questionnaire
  - `item` elements containing PHQ-9 question responses
  - `status` of "completed"
  - Valid `subject` reference to a Patient
- Observation resources that should be derived from the QuestionnaireResponse:
  - Must conform to US Core Observation Screening Assessment Profile
  - Should reference the source QuestionnaireResponse via `derivedFrom`
  - Must contain appropriate PHQ-9 codes (e.g., LOINC code 44261-6 for total score)

**Test Data Requirements:**
- At least one completed PHQ-9 QuestionnaireResponse per test patient
- Corresponding derived Observation resources for each QuestionnaireResponse
- Patient resources referenced by the QuestionnaireResponse and Observation resources

### Required FHIR Operations
Based on the capability statement, the following operations are supported and required:

1. **QuestionnaireResponse Search:**
   - `GET [base]/QuestionnaireResponse?patient=[patient-id]`
   - `GET [base]/QuestionnaireResponse?patient=[patient-id]&questionnaire=[questionnaire-id]`

2. **Observation Search:**
   - `GET [base]/Observation?patient=[patient-id]&category=survey`
   - `GET [base]/Observation?patient=[patient-id]&code=44261-6` (PHQ-9 total score)

3. **Resource Read:**
   - `GET [base]/QuestionnaireResponse/[id]`
   - `GET [base]/Observation/[id]`

### Validation Criteria

**Primary Assertions:**

1. **Derivation Relationship Validation:**
   - For each PHQ-9 QuestionnaireResponse, verify that at least one corresponding Observation exists
   - Verify Observation.derivedFrom references the source QuestionnaireResponse
   - Confirm Observation.subject matches QuestionnaireResponse.subject

2. **PHQ-9 Specific Validation:**
   - Verify Observation.code contains appropriate PHQ-9 LOINC codes (e.g., 44261-6 for total score)
   - Validate Observation.category includes "survey" category
   - Confirm Observation conforms to US Core Observation Screening Assessment Profile

3. **Data Integrity Checks:**
   - Verify Observation.effectiveDateTime is consistent with QuestionnaireResponse.authored
   - Ensure Observation.status is appropriate (typically "final" for completed assessments)
   - Validate that derived values in Observation align with QuestionnaireResponse item values

4. **Profile Conformance:**
   - Validate that derived Observations conform to US Core Observation Screening Assessment Profile
   - Verify all Must Support elements are populated appropriately
   - Confirm proper use of value sets and coding systems

**Test Pass Criteria:**
- System successfully demonstrates derivation of Observation resources from PHQ-9 QuestionnaireResponse resources
- All derived Observations maintain proper referential integrity with source QuestionnaireResponse
- Derived observations contain appropriate PHQ-9 codes and conform to required profiles
- API searches successfully return both source QuestionnaireResponse and derived Observation resources

**Test Failure Indicators:**
- No Observation resources found that derive from existing PHQ-9 QuestionnaireResponse resources
- Observation.derivedFrom does not reference the source QuestionnaireResponse
- Missing or incorrect PHQ-9 specific codes in derived Observations
- Profile validation failures for derived Observation resources
- Inconsistent or missing data relationships between QuestionnaireResponse and Observation

---

<a id='req-074'></a>

### REQ-074: The system SHALL record the observation code as "Poor appetite or overeating in last 2 weeks [Reported.PHQ]".

**Text**: 

**Context**: 

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-074

## 1. Requirement ID
REQ-074

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement specifies an exact observation code that must be recorded, which can be validated programmatically through FHIR resource inspection.

### Complexity
**Simple** - The requirement involves verifying a single, specific code value in an Observation resource.

### Prerequisites
- System must support US Core Observation profiles (as indicated by Capability Statement)
- System must have Observation resources available for testing
- Test data should include PHQ-9 assessment observations, specifically item 44251-7

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources that represent PHQ-9 screening assessment items
- **Test Data**: Any existing Observation resources in the system that are intended to represent "Poor appetite or overeating in last 2 weeks [Reported.PHQ]"
- **Patient Context**: Valid patient reference for observation queries

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required for testing:

1. **GET [base]/Observation/[id]** - Direct resource retrieval
2. **GET [base]/Observation?patient=[patient-id]&code=[code]** - Search by patient and code
3. **GET [base]/Observation?patient=[patient-id]&category=survey** - Search by patient and category (screening assessments typically use category "survey")

### Validation Criteria

#### Primary Assertion
**Observation Code Validation**: For any Observation resource that represents "Poor appetite or overeating in last 2 weeks [Reported.PHQ]", verify that:

```
Observation.code.coding contains:
- system: "http://loinc.org" 
- code: "44251-7"
- display: "Poor appetite or overeating in last 2 weeks [Reported.PHQ]" (or semantically equivalent)
```

#### Test Steps
1. **Discovery Phase**:
   - Query for Observation resources using `GET [base]/Observation?patient=[patient-id]&category=survey`
   - Identify Observation resources that may represent PHQ-9 items
   - Filter for observations that should represent the specific appetite/overeating question

2. **Validation Phase**:
   - For each identified Observation resource, retrieve the full resource using `GET [base]/Observation/[id]`
   - Inspect `Observation.code.coding` array
   - Verify the presence of the required LOINC code "44251-7"
   - Confirm the code system is "http://loinc.org"
   - Optionally validate the display text matches the expected description

3. **Conformance Verification**:
   - **PASS**: All observations representing "Poor appetite or overeating in last 2 weeks" contain the correct LOINC code 44251-7
   - **FAIL**: Any observation representing this concept uses a different or incorrect code
   - **NOT APPLICABLE**: No observations representing this specific PHQ-9 item exist in the test data

#### Additional Validation Points
- Verify that if multiple codings are present in `Observation.code.coding`, at least one contains the required LOINC code
- Ensure the observation conforms to appropriate US Core Observation profiles (likely US Core Observation Screening Assessment Profile)
- Validate that the observation has appropriate patient reference and other required elements per the profile

#### Error Conditions to Check
- Observation uses incorrect LOINC code for this concept
- Observation uses correct display text but wrong code
- Observation uses non-LOINC code system for this standardized assessment item
- Missing or malformed code element entirely

---

<a id='req-075'></a>

### REQ-075: The system SHALL record the value of the observation as "Several days".

**Text**: 

**Context**: 

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-075

## 1. Requirement ID
REQ-075

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified by examining the value field of specific Observation resources to confirm the literal string "Several days" is recorded as specified.

### Complexity
**Simple** - The requirement involves a straightforward string value verification within an Observation resource.

### Prerequisites
- System must support US Core Server capabilities as defined in the CapabilityStatement
- System must have PHQ-9 item observations (specifically item 44251-7) available for testing
- Test system must be able to query and retrieve Observation resources
- PHQ-9 questionnaire responses must be recorded in the system with appropriate LOINC codes

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources Needed:**
- Observation resources representing PHQ-9 item responses with LOINC code 44251-7
- Patient resources associated with the observations (for context)

**Test Data Requirements:**
- At least one Observation resource where the value should be "Several days"
- The Observation must use the appropriate PHQ-9 item coding (LOINC 44251-7)
- Observation must be properly linked to a valid Patient resource

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are supported and required:

1. **GET /Observation** - Retrieve Observation resources
2. **GET /Observation?code=44251-7** - Search for specific PHQ-9 item observations by LOINC code
3. **GET /Observation?patient=[id]** - Search for observations by patient (if testing patient-specific scenarios)
4. **GET /Observation/[id]** - Direct retrieval of specific Observation resources

### Validation Criteria

**Primary Assertion:**
- The Observation.value[x] field must contain exactly the string "Several days" (case-sensitive match)

**Supporting Validations:**
1. **Resource Type Verification**: Confirm the resource is of type "Observation"
2. **Coding Verification**: Verify the Observation.code contains LOINC code 44251-7 for the appropriate PHQ-9 item
3. **Value Type Verification**: Confirm the value is recorded as a string or CodeableConcept with display text
4. **Resource Validity**: Ensure the Observation resource passes basic FHIR validation rules

**Test Steps:**
1. Query the system for Observation resources with code 44251-7
2. For each returned Observation resource:
   - Extract the value field (Observation.value[x])
   - If valueString: verify exact match to "Several days"
   - If valueCodeableConcept: verify display text matches "Several days"
3. Assert that at least one qualifying observation contains the required value
4. Verify no observations contain variations like "several days", "Several Days", or other case variations

**Pass Criteria:**
- At least one PHQ-9 item observation (44251-7) contains the exact value "Several days"
- All observations with this value use the correct LOINC coding
- The observations are valid FHIR resources that conform to US Core profiles

**Fail Criteria:**
- No observations found with the specified value
- Value recorded with incorrect case or spelling variations
- Value recorded in wrong field or format
- Associated observations lack proper PHQ-9 item coding

---

<a id='req-076'></a>

### REQ-076: The system SHALL record the observation code as "Primary insurance".

**Text**: 

**Context**: 

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-076

## 1. Requirement ID
REQ-076

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified programmatically by examining Observation resources to confirm the presence and correct value of the observation code.

### Complexity
**Simple** - This is a straightforward validation of a specific code value in an Observation resource.

### Prerequisites
- System must support US Core Server capabilities as defined in the CapabilityStatement
- System must be able to create and/or retrieve Observation resources
- System must have Observation data available for testing (following "bring your own data" approach)
- Test data should include Observation resources that represent PRAPARE (Protocol for Responding to and Assessing Patients' Assets, Risks, and Experiences) assessments

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Observation resources that represent PRAPARE survey responses, specifically those related to primary insurance coverage
- The Observation resources should be based on or conform to the PRAPARE item example referenced (76437-3)

**Expected Outputs:**
- Observation resources with code.coding containing the appropriate "Primary insurance" code
- Confirmation that the observation code is properly structured according to FHIR specifications

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations should be supported:

1. **GET /Observation** - Retrieve Observation resources
2. **GET /Observation/[id]** - Retrieve specific Observation resource by ID
3. **GET /Observation?code=[code]** - Search for Observations by code (if supported by the server's search parameters)

### Validation Criteria

**Primary Validation:**
1. **Code Presence Check**: Verify that each relevant Observation resource contains a `code` element
2. **Code Value Verification**: Confirm that the `code.coding` array contains an entry where:
   - The coding represents "Primary insurance" 
   - The code value matches the expected LOINC code (likely 76437-3 based on the example reference)
   - The system URI is correctly specified (typically http://loinc.org for LOINC codes)
   - The display text appropriately represents "Primary insurance" or equivalent

**Secondary Validation:**
1. **FHIR Structure Compliance**: Ensure the code element follows proper FHIR R4 structure
2. **Coding System Consistency**: Verify that if multiple codings are present, they are consistent and appropriate
3. **Resource Validity**: Confirm the overall Observation resource is valid FHIR

**Test Assertions for Passing:**
- ✅ All tested Observation resources contain a `code` element
- ✅ The `code.coding` contains at least one entry with the correct code for "Primary insurance"
- ✅ The coding system is properly identified
- ✅ The display text is appropriate for the primary insurance concept
- ✅ No FHIR validation errors are present in the Observation structure

**Test Implementation Notes:**
- Test should be flexible to work with any conformant PRAPARE Observation data provided by the tester
- Should handle cases where multiple coding entries exist (e.g., LOINC + SNOMED)
- Should validate both the presence of the required code and the absence of incorrect codes for this specific observation type
- Consider testing with multiple Observation instances to ensure consistency across the system's data

---

<a id='req-077'></a>

### REQ-077: The system SHALL record the value of the observation as "Medicaid".

**Text**: 

**Context**: 

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-077

## 1. Requirement ID
**REQ-077**

## 2. Requirement Analysis

### Testability Assessment
**Not Testable** - This requirement is too vague and lacks sufficient context for meaningful testing.

**Rationale:**
- The requirement states "The system SHALL record the value of the observation as 'Medicaid'" but provides no context about:
  - Which specific observation type should have this value
  - What field/element should contain "Medicaid"
  - Under what conditions this value should be recorded
  - What coding system should be used
- The source reference "Observation-PRAPARE-item-example-76437-3.md" suggests this relates to PRAPARE (Protocol for Responding to and Assessing Patients' Assets, Risks, and Experiences) screening, but without access to that specific example, the requirement cannot be properly tested
- The requirement lacks the specificity needed to create deterministic test cases

### Complexity
**Not Applicable** - Cannot be assessed due to vague requirement specification.

### Prerequisites
**Cannot be determined** - The lack of context makes it impossible to identify necessary prerequisites.

## 3. Test Implementation Strategy

### Assessment
This requirement cannot be implemented as a meaningful test case due to insufficient specification. The requirement would need to be clarified with additional context such as:

1. **Specific Observation Profile**: Which US Core Observation profile should be tested (e.g., US Core Simple Observation Profile, US Core Observation Screening Assessment Profile)

2. **Element Specification**: Which specific FHIR element should contain "Medicaid" (e.g., `Observation.valueString`, `Observation.valueCodeableConcept.text`, `Observation.component.valueString`)

3. **Coding Context**: Whether "Medicaid" should be:
   - A coded value with specific system/code
   - Free text
   - Part of a specific value set

4. **Triggering Conditions**: Under what circumstances this value should be recorded (e.g., specific LOINC codes, patient demographics, insurance status)

5. **PRAPARE Context**: The specific PRAPARE item (76437-3) that this requirement relates to and its expected response structure

### Recommendation
This requirement should be revised to include:
- Specific FHIR resource and element paths
- Clear triggering conditions
- Expected data format and coding system
- Reference to the actual PRAPARE item specification

Without this additional context, any test implementation would be based on assumptions and could not reliably verify conformance to the intended requirement.

---

<a id='req-078'></a>

### REQ-078: The system shall record the value of an observation.

**Text**: 

**Context**: 

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-078

## 1. Requirement ID
REQ-078

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated testing by examining FHIR Observation resources to confirm that observation values are properly recorded and accessible.

### Complexity
**Simple** - The requirement focuses on a fundamental FHIR capability of recording observation values, which can be tested through straightforward resource validation and retrieval operations.

### Prerequisites
- System must support US Core Server capabilities as defined in the CapabilityStatement
- System must have Observation resources available for testing
- System must support RESTful FHIR operations for Observation resources
- Test data should include various types of observations with different value types (numeric, coded, text, etc.)

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Observation resources that contain value elements
- Patient resources (as subjects of observations)
- Any supporting resources referenced by the observations (e.g., Practitioner, Organization)

**Expected Outputs:**
- Successful retrieval of Observation resources
- Validation that observation values are present and properly formatted
- Confirmation that values conform to US Core Observation profiles

### Required FHIR Operations
Based on US Core Server CapabilityStatement requirements:
- **GET [base]/Observation/[id]** - Retrieve specific observation resources
- **GET [base]/Observation?patient=[reference]** - Search for observations by patient
- **GET [base]/Observation?category=[code]** - Search for observations by category (if supported)

### Validation Criteria

**Primary Assertions:**
1. **Value Presence Check**: Each retrieved Observation resource MUST contain at least one of the following value elements:
   - `valueQuantity`
   - `valueCodeableConcept` 
   - `valueString`
   - `valueBoolean`
   - `valueInteger`
   - `valueRange`
   - `valueRatio`
   - `valueSampledData`
   - `valueTime`
   - `valueDateTime`
   - `valuePeriod`
   - `component.valueQuantity`
   - `component.valueCodeableConcept`
   - (or other component value types)

2. **Value Format Validation**: The observation value(s) MUST:
   - Conform to the appropriate FHIR data type specifications
   - Include required sub-elements for complex types (e.g., Quantity must have value and unit)
   - Use appropriate terminology bindings where specified by US Core profiles

3. **Resource Completeness**: Observation resources MUST:
   - Have a valid `status` element
   - Reference a valid `subject` (typically a Patient)
   - Include appropriate `code` element identifying what was observed
   - Pass FHIR resource validation against US Core Observation profiles

**Test Success Criteria:**
- All retrieved Observation resources contain recorded values
- Values are properly formatted according to FHIR specifications
- Values are accessible through standard FHIR API operations
- No validation errors when validating against applicable US Core profiles

**Test Failure Indicators:**
- Observation resources exist but lack any value elements
- Value elements are present but malformed or incomplete
- API calls fail to retrieve observation data
- Retrieved observations fail US Core profile validation

---

<a id='req-079'></a>

### REQ-079: The system shall categorize observations.

**Text**: 

**Context**: 

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-079

## 1. Requirement ID
**REQ-079**

## 2. Requirement Analysis

### Testability Assessment
**Not testable due to being too vague**

The requirement "The system shall categorize observations" lacks sufficient specificity to create meaningful automated tests. The requirement does not specify:
- Which categorization system(s) to use
- Required categories that must be supported
- How categorization should be validated
- Context of which observations need categorization

### Complexity
**Not Applicable** - Cannot be tested as written

### Prerequisites
**Not Applicable** - Requirement too vague to establish prerequisites

## 3. Test Implementation Strategy

### Assessment
This requirement cannot be effectively tested in its current form because:

1. **Lack of Specificity**: The requirement doesn't specify what "categorize observations" means in the context of FHIR
2. **Missing Context**: No indication of which observation types, categories, or categorization schemes are required
3. **Ambiguous Verification**: No clear criteria for what constitutes successful categorization

### Recommendations for Requirement Refinement

To make this requirement testable, it should be refined to specify:

1. **Specific Categories**: Define required observation categories (e.g., vital-signs, laboratory, survey, imaging, social-history)
2. **Categorization Method**: Specify use of `Observation.category` element with appropriate terminology bindings
3. **Required Value Sets**: Define which category coding systems must be supported (e.g., http://terminology.hl7.org/CodeSystem/observation-category)
4. **Scope**: Clarify which observation profiles this applies to

### Suggested Revised Requirement
```
The system shall populate the Observation.category element for all observations using codes from the Observation Category Codes value set (http://hl7.org/fhir/ValueSet/observation-category), with at minimum support for 'vital-signs', 'laboratory', and 'survey' categories.
```

### Potential Test Implementation (if requirement were refined)

**Required FHIR Operations:**
- `GET [base]/Observation?patient=[id]`
- `GET [base]/Observation/[id]` (for individual observation validation)

**Validation Criteria:**
- Verify `Observation.category` element is present and populated
- Confirm category codes are from the specified value set
- Validate appropriate categories are used for different observation types

**Required Inputs:**
- Patient ID for observation queries
- Expected observation data with categorization

**Expected Outputs:**
- Observations with properly populated category elements
- Category codes conforming to specified value sets

---

<a id='req-080'></a>

### REQ-080: The system shall record the value of an observation.

**Text**: 

**Context**: 

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-080

## 1. Requirement ID
**REQ-080**: The system shall record the value of an observation.

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be tested through automated validation of FHIR Observation resources to verify that observation values are properly recorded according to FHIR specifications.

### Complexity
**Simple** - The requirement focuses on a fundamental FHIR Observation capability with clear validation criteria.

### Prerequisites
- System must support FHIR R4 Observation resources
- System must implement US Core Server capabilities for Observation resources
- Test data must include Observation resources with various value types (e.g., Quantity, CodeableConcept, string, boolean, integer, Range, Ratio, SampledData, time, dateTime, Period)

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Observation resources representing various clinical observations (PHQ-9 items, vital signs, laboratory results, etc.)
- Patient resources associated with the observations
- Practitioner/PractitionerRole resources for observation performers (if applicable)

**Expected Outputs:**
- Successfully stored/retrieved Observation resources with properly formatted value elements
- Validation that observation values conform to FHIR datatypes and US Core profiles

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations must be supported:

1. **POST /Observation** - Create new observation resources
2. **GET /Observation/[id]** - Read specific observation resources
3. **GET /Observation?patient=[reference]** - Search observations by patient
4. **GET /Observation?category=[code]** - Search observations by category
5. **GET /Observation?code=[code]** - Search observations by observation code

### Validation Criteria

#### Primary Assertions:
1. **Value Element Presence**: Each Observation resource must contain at least one value element (value[x], component.value[x], or dataAbsentReason if no value is available)

2. **Value Datatype Conformance**: The value[x] element must use an appropriate FHIR datatype:
   - Quantity for numeric measurements with units
   - CodeableConcept for coded values
   - String for text observations
   - Boolean for true/false observations
   - Integer for whole number values
   - Range for value ranges
   - Ratio for ratios
   - SampledData for waveform data
   - Time, dateTime, or Period for temporal values

3. **US Core Profile Compliance**: Observation resources must conform to applicable US Core profiles (e.g., US Core Vital Signs, US Core Laboratory Result, US Core Simple Observation)

4. **Required Elements**: Each observation must include:
   - Valid status (registered, preliminary, final, amended, corrected, cancelled, entered-in-error, unknown)
   - Valid category code(s)
   - Valid observation code
   - Subject reference (patient)

#### Test Cases:

**Test Case 1: Numeric Value Recording**
- **Action**: Submit/retrieve observations with Quantity values (e.g., weight, height, blood pressure)
- **Assertion**: Value.quantity contains numeric value, unit, and UCUM code where applicable

**Test Case 2: Coded Value Recording**
- **Action**: Submit/retrieve observations with CodeableConcept values (e.g., PHQ-9 responses)
- **Assertion**: Value.codeableConcept contains valid coding with system, code, and display

**Test Case 3: Text Value Recording**
- **Action**: Submit/retrieve observations with string values (e.g., clinical notes)
- **Assertion**: Value.string contains the recorded text value

**Test Case 4: Component Observation Values**
- **Action**: Submit/retrieve multi-component observations (e.g., blood pressure with systolic/diastolic)
- **Assertion**: Each component contains appropriate value[x] element

**Test Case 5: Data Absent Reason**
- **Action**: Submit/retrieve observations where value is not available
- **Assertion**: dataAbsentReason is populated with appropriate code when value[x] is absent

#### Success Criteria:
- All observation values are successfully recorded and retrievable
- Value datatypes match the clinical context and FHIR specifications
- No validation errors when processing observation values
- Observations conform to US Core profiles where applicable
- Search operations return observations with complete value information

#### Failure Conditions:
- Observation resources missing value elements without dataAbsentReason
- Invalid datatypes used for observation values
- Non-conformant values that fail FHIR validation
- Values that don't align with the specified observation code semantics

---

<a id='req-081'></a>

### REQ-081: Observation status must be set to "Final"

**Text**: 

**Context**: 

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-081

## 1. Requirement ID
REQ-081

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified programmatically by inspecting the `status` field of Observation resources to ensure it is set to "final".

### Complexity
**Simple** - This is a straightforward field value validation that requires checking a single element in the Observation resource.

### Prerequisites
- System must support FHIR R4 Observation resources
- System must have Observation resources available for testing
- Test client must have appropriate access permissions to read Observation resources
- System should support US Core Observation profiles (based on PRAPARE context)

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: One or more Observation resources that should have status set to "final"
- **Test Data**: Any existing Observation resources in the system under test (following "bring your own data" approach)
- **Access Credentials**: Valid authentication tokens/credentials with read access to Observation resources

### Expected Outputs
- Observation resources with `status` field explicitly set to "final"
- Appropriate HTTP response codes (200 for successful reads)
- Valid FHIR JSON/XML responses containing Observation resources

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required for testing:

1. **READ Operation**: `GET [base]/Observation/[id]`
   - Retrieve individual Observation resources by ID
   - Verify status field in response

2. **SEARCH Operation**: `GET [base]/Observation?[parameters]`
   - Search for Observation resources using appropriate search parameters
   - Verify status field in all returned resources

**Note**: Both operations are standard FHIR RESTful operations that align with the US Core Server capabilities outlined in the Capability Statement.

### Validation Criteria

#### Primary Assertion
- **Status Field Validation**: Each Observation resource MUST have a `status` field with the value "final"
  ```json
  {
    "resourceType": "Observation",
    "status": "final",
    ...
  }
  ```

#### Supporting Validations
1. **Resource Structure**: Verify that retrieved resources are valid Observation resources
2. **HTTP Response**: Confirm successful HTTP 200 responses for valid resource requests
3. **FHIR Compliance**: Ensure responses conform to FHIR R4 specification structure
4. **Profile Compliance**: If US Core Observation profiles are used, validate against appropriate profile constraints

#### Test Pass Criteria
- **100% Compliance**: ALL Observation resources examined must have `status` set to "final"
- **Valid FHIR Structure**: All responses must be well-formed FHIR resources
- **Proper HTTP Responses**: All API calls return appropriate HTTP status codes
- **No Exceptions**: No system errors or unexpected responses during testing

#### Test Failure Scenarios
- Any Observation resource has `status` field with value other than "final" (e.g., "preliminary", "registered", "cancelled", "entered-in-error", "unknown")
- Missing `status` field in Observation resources
- Invalid FHIR structure in responses
- HTTP error responses (4xx, 5xx) for valid requests
- System authentication/authorization failures

#### Implementation Notes
- Test should accommodate various Observation types and profiles while focusing specifically on the status field requirement
- Consider testing with both individual resource reads and search operations to ensure comprehensive coverage
- Validate that the requirement applies consistently across all Observation resources in the system

---

<a id='req-082'></a>

### REQ-082: Observation category must include "SDOH" and "Survey"

**Text**: 

**Context**: 

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-082

## 1. Requirement ID
REQ-082

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified programmatically by examining the `category` field of Observation resources to ensure both "SDOH" and "Survey" categories are present.

### Complexity
**Simple** - The requirement involves straightforward validation of specific category values in Observation resources.

### Prerequisites
- System must support US Core Observation profiles as indicated in the Capability Statement
- System must have Observation resources available for testing
- Test system must be able to query Observation resources using supported search parameters (patient, category, code, date, status)

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Observation resources that should conform to PRAPARE (Protocol for Responding to and Assessing Patients' Assets, Risks, and Experiences) requirements
- These Observations should be related to Social Determinants of Health (SDOH) survey responses

**Expected Outputs:**
- Observation resources with `category` field containing both:
  - A category with coding system indicating "SDOH" 
  - A category with coding system indicating "Survey"

### Required FHIR Operations
Based on the Capability Statement, the following supported operations will be used:

1. **GET /Observation** - Retrieve Observation resources
2. **GET /Observation?patient=[id]** - Search for Observations by patient
3. **GET /Observation?category=[category]** - Search for Observations by category
4. **GET /Observation?patient=[id]&category=[category]** - Combined patient and category search

### Validation Criteria

#### Test Case 1: Direct Resource Validation
**Objective:** Verify that PRAPARE-related Observation resources contain required categories

**Steps:**
1. Retrieve Observation resources from the system (using any of the supported search parameters)
2. Filter for Observations that appear to be PRAPARE/SDOH survey-related (based on codes, context, or other identifying characteristics)
3. For each relevant Observation resource, validate the `category` array

**Pass Criteria:**
- Each PRAPARE-related Observation MUST have a `category` array that contains:
  - At least one category entry with a coding that represents "SDOH" (Social Determinants of Health)
  - At least one category entry with a coding that represents "Survey"
- Both required categories MUST be present simultaneously in the same Observation resource

**Specific Validation Checks:**
```
For each Observation.category[] array:
- ASSERT: Contains entry with coding.system and coding.code representing SDOH category
- ASSERT: Contains entry with coding.system and coding.code representing Survey category
- ASSERT: Both categories are present in the same resource
```

#### Test Case 2: Category-based Search Validation
**Objective:** Verify that SDOH survey Observations can be retrieved using category searches

**Steps:**
1. Execute search: `GET /Observation?category=survey` (if supported by system's category value set)
2. Execute search: `GET /Observation?category=sdoh` (if supported by system's category value set)
3. Validate returned resources meet the dual category requirement

**Pass Criteria:**
- Resources returned from category-based searches MUST still contain both required categories
- Search results SHOULD return PRAPARE-related Observations when searching by either category

#### Test Case 3: Combined Search Validation
**Objective:** Verify that systems can handle searches combining patient and category parameters

**Steps:**
1. Identify a patient with PRAPARE/SDOH survey data
2. Execute: `GET /Observation?patient=[id]&category=[category]`
3. Validate returned Observations meet the requirement

**Pass Criteria:**
- Combined searches MUST return Observations that contain both required categories
- Results MUST be consistent with the dual category requirement

### Failure Scenarios
The test FAILS if:
- Any PRAPARE-related Observation is missing the "SDOH" category
- Any PRAPARE-related Observation is missing the "Survey" category  
- An Observation contains only one of the required categories but not both
- Category values are present but use incorrect coding systems or codes

### Implementation Notes
- The specific coding systems and codes for "SDOH" and "Survey" categories should align with US Core and PRAPARE implementation guide specifications
- Test implementers should verify the exact category coding requirements in the relevant PRAPARE profile documentation
- Systems may use different value sets for categories, so validation should account for various valid representations of SDOH and Survey categories

---

<a id='req-083'></a>

### REQ-083: Observation performer must match the subject

**Text**: 

**Context**: 

**Actor**: System

**Conformance**: SHALL

# REQ-083 Test Specification

## 1. Requirement ID
**REQ-083**: Observation performer must match the subject

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified through automated validation by comparing the `performer` and `subject` references in Observation resources.

### Complexity
**Simple** - The test involves straightforward reference comparison between two fields within the same FHIR resource.

### Prerequisites
- System must support US Core Observation profiles as defined in the Capability Statement
- Test data must include Observation resources with both `subject` and `performer` elements populated
- Referenced Patient and Practitioner/PractitionerRole/Organization resources should be available for validation

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Observation resources conforming to any US Core Observation profiles (laboratory results, vital signs, clinical results, etc.)
- Patient resources referenced in Observation.subject
- Practitioner, PractitionerRole, or Organization resources referenced in Observation.performer

**Expected Outputs:**
- Validation results indicating whether performer references match the subject appropriately
- Clear identification of any non-conformant Observation resources

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and may be used:

1. **GET /Observation** - Retrieve Observation resources for testing
   - Supported search parameters: `patient`, `category`, `code`, `date`, `status`
   - Use `patient+category` searches to efficiently retrieve relevant observations

2. **GET /Patient/{id}** - Retrieve Patient resources referenced in Observation.subject
   - Supported search parameters: `_id`, `identifier`, `name`

3. **GET /Practitioner/{id}** - Retrieve Practitioner resources referenced in Observation.performer
   - Supported search parameters: `_id`, `identifier`, `name`

4. **GET /PractitionerRole/{id}** - Retrieve PractitionerRole resources referenced in Observation.performer
   - Supported search parameters: `practitioner`, `specialty`

5. **GET /Organization/{id}** - Retrieve Organization resources for organizational performers

### Validation Criteria

The test SHALL verify the following assertions for each Observation resource:

1. **Primary Validation:**
   - If `Observation.performer` is populated, verify that at least one performer reference relates to the same patient as specified in `Observation.subject`
   - The relationship may be direct (performer is the patient) or indirect (performer has a documented relationship to the patient)

2. **Reference Resolution:**
   - All references in `Observation.performer` and `Observation.subject` SHALL resolve to valid FHIR resources
   - Referenced resources SHALL conform to their respective US Core profiles

3. **Business Logic Validation:**
   - **Direct Match**: `Observation.performer` contains a reference to the same Patient resource as `Observation.subject`
   - **Practitioner/Patient Relationship**: If performer is a Practitioner or PractitionerRole, verify they have an established care relationship with the patient
   - **Organizational Relationship**: If performer is an Organization, verify it provides care to the patient

4. **Conformance Checks:**
   - Observation resources SHALL conform to applicable US Core Observation profiles
   - All referenced resources SHALL be accessible and valid

**Pass Criteria:**
- All Observation resources demonstrate that the performer has an appropriate relationship to the subject
- All resource references resolve successfully
- No validation errors are encountered during reference resolution

**Fail Criteria:**
- Any Observation resource has a performer that cannot be related to the subject
- Invalid or unresolvable references in performer or subject fields
- Missing required elements that prevent validation of the performer-subject relationship

**Test Execution Notes:**
- The test should accommodate various types of performers (Patient, Practitioner, PractitionerRole, Organization)
- Consider both self-reported observations (patient as performer) and clinician-reported observations
- The test should work with any conformant test data provided by the implementer

---

<a id='req-084'></a>

### REQ-084: Observation effective date must be specified

**Text**: 

**Context**: 

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-084

## 1. Requirement ID
**REQ-084**: Observation effective date must be specified

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated programmatically by examining FHIR Observation resources to verify the presence of effective date/time elements.

### Complexity
**Simple** - The requirement involves checking for the presence of a single data element (effective date) in Observation resources.

### Prerequisites
- System must support US Core Server capabilities as defined in the CapabilityStatement
- System must be able to serve Observation resources via FHIR REST API
- Test data must include Observation resources (tester's own data)
- System must support standard FHIR read/search operations for Observation resources

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources present in the system under test
- **System Endpoint**: Base FHIR server URL implementing US Core Server capabilities
- **Authentication**: Appropriate credentials/tokens if required by the system

### Expected Outputs
- FHIR Observation resources with populated effective date/time fields
- Validation results indicating conformance with the requirement

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations should be supported:

1. **GET [base]/Observation/[id]** - Read specific Observation resources
2. **GET [base]/Observation** - Search for Observation resources
3. **GET [base]/Observation?patient=[reference]** - Search Observations by patient (typical US Core requirement)

### Validation Criteria

#### Primary Validation Checks:
1. **Effective Date Presence**: Each Observation resource must contain at least one of the following elements:
   - `effectiveDateTime` (single point in time)
   - `effectivePeriod` (time period with start/end)
   - `effectiveTiming` (recurring time pattern)
   - `effectiveInstant` (precise timestamp)

2. **Data Type Validation**: The effective date element must conform to appropriate FHIR data types:
   - `effectiveDateTime`: dateTime format
   - `effectivePeriod`: Period data type with valid start/end dates
   - `effectiveTiming`: Timing data type
   - `effectiveInstant`: instant format

#### Test Scenarios:

**Scenario 1: Single Observation Resource Validation**
- Retrieve individual Observation resources using GET [base]/Observation/[id]
- Assert that each resource contains one of the effective date elements
- Verify the date/time value is properly formatted and not empty

**Scenario 2: Batch Observation Validation**
- Search for Observation resources using GET [base]/Observation
- Apply pagination if necessary to process all available resources
- Validate each returned Observation resource for effective date presence
- Generate summary report of conformance across all resources

**Scenario 3: Patient-Specific Observation Validation**
- Search for Observations by patient using GET [base]/Observation?patient=[reference]
- Validate all patient-associated Observations contain effective dates
- Ensure conformance across different patients in the system

#### Success Criteria:
- **Pass**: 100% of Observation resources contain a valid effective date element
- **Fail**: Any Observation resource lacks an effective date element or contains invalid date/time values

#### Error Handling:
- Document any HTTP errors encountered during resource retrieval
- Report any FHIR validation errors related to date/time formatting
- Handle cases where resources are not accessible due to authorization constraints

#### Reporting Requirements:
- Total number of Observation resources tested
- Number of resources with valid effective dates
- Number of resources failing the requirement
- Specific resource IDs that fail validation
- Types of effective date elements found (DateTime, Period, Timing, Instant)

---

<a id='req-085'></a>

### REQ-085: Observation code must be specific to the context

**Text**: 

**Context**: 

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-085

## 1. Requirement ID
**REQ-085**: Observation code must be specific to the context

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Too vague - Not testable as currently specified

**Rationale**: The requirement "Observation code must be specific to the context" lacks sufficient detail to create a meaningful conformance test. Key missing information includes:
- What constitutes "context" (clinical domain, care setting, patient condition, etc.)
- How "specific" is defined or measured
- What validation rules or value sets should be applied
- Whether this refers to Observation.code, Observation.category, or both

The source reference to "Observation-PRAPARE-item-example-67875-5.md" suggests this may relate to PRAPARE (Protocol for Responding to and Assessing Patient Assets, Risks, and Experiences) social determinants screening, but without access to that specific example, the requirement remains insufficiently defined.

### Complexity
**Level**: Cannot be determined due to vague specification

### Prerequisites
Cannot be determined without clarification of the requirement.

## 3. Test Implementation Strategy

### Required Clarification
Before this requirement can be implemented as a test, the following information must be provided:

1. **Context Definition**: Clear specification of what "context" means (e.g., clinical specialty, care setting, screening tool type)
2. **Specificity Criteria**: Explicit rules for what makes a code "specific" to its context
3. **Validation Rules**: 
   - Required value sets or code systems
   - Acceptable code hierarchies or categories
   - Relationship between Observation.code and Observation.category
4. **PRAPARE Context**: If this relates to PRAPARE screening, specific requirements for social determinants observation coding

### Recommended Requirement Refinement
The requirement should be rewritten to include specific, testable criteria such as:

**Example Refined Requirement**: 
"For PRAPARE social determinants screening observations, the Observation.code SHALL use LOINC codes from the PRAPARE value set [specific ValueSet URL], and the Observation.category SHALL include the 'social-history' category code."

### Required FHIR Operations
*Cannot be determined until requirement is clarified*

### Validation Criteria
*Cannot be established until requirement is clarified*

## 4. Recommendation

**Action Required**: This requirement needs to be clarified and refined before a conformance test can be developed. The requirement author should provide:

1. Access to the referenced example (Observation-PRAPARE-item-example-67875-5.md)
2. Specific context definition and validation rules
3. Clear success/failure criteria

Once clarified, this requirement could potentially be tested through:
- Validation of Observation.code against specified value sets
- Verification of appropriate Observation.category values
- Contextual validation rules based on patient demographics or care setting

**Current Status**: Not implementable as a conformance test due to insufficient specification.

---

<a id='req-086'></a>

### REQ-086: Observation must include a category of 'Survey' or 'Disability Status'

**Text**: 

**Context**: 

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-086

## 1. Requirement ID
**REQ-086**: Observation must include a category of 'Survey' or 'Disability Status'

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be programmatically validated by inspecting the `Observation.category` element for specific coded values.

### Complexity
**Simple** - The requirement involves checking for the presence of specific category codes within the Observation resource, which is a straightforward validation task.

### Prerequisites
- System must support US Core Server capabilities as defined in the CapabilityStatement
- System must have Observation resources available for testing
- Test data should include Observation resources that are expected to conform to this requirement (PHQ-9 survey items based on the source context)

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources that should contain survey or disability status categories
- **Expected Resource Types**: Observation resources, particularly those related to PHQ-9 survey items
- **Data Requirements**: Any existing Observation data in the system under test

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations should be supported:
- `GET [base]/Observation` - Retrieve Observation resources
- `GET [base]/Observation/[id]` - Retrieve specific Observation resources by ID
- Search operations on Observation resources as supported by the US Core Server

### Validation Criteria

#### Test Case 1: Validate Survey Category
**Objective**: Verify that Observation resources include a category with code 'survey'

**Test Steps**:
1. Retrieve Observation resources from the system
2. For each Observation resource that should conform to this requirement:
   - Inspect the `Observation.category` array
   - Verify that at least one category element contains:
     - `coding.system` = "http://terminology.hl7.org/CodeSystem/observation-category"
     - `coding.code` = "survey"

**Pass Criteria**: All applicable Observation resources contain a category with the 'survey' code

#### Test Case 2: Validate Disability Status Category
**Objective**: Verify that Observation resources include a category with code related to disability status

**Test Steps**:
1. Retrieve Observation resources from the system
2. For each Observation resource that should conform to this requirement:
   - Inspect the `Observation.category` array
   - Verify that at least one category element contains a disability status related code
   - Check for appropriate coding system and code values for disability status

**Pass Criteria**: All applicable Observation resources contain a category with an appropriate disability status code

#### Test Case 3: Category Presence Validation
**Objective**: Ensure that the category element is present and properly structured

**Test Steps**:
1. Retrieve Observation resources from the system
2. For each Observation resource:
   - Verify that `Observation.category` element exists
   - Verify that the category array is not empty
   - Verify that each category element has proper coding structure with system and code elements

**Pass Criteria**: 
- `Observation.category` element is present
- At least one category entry exists
- Category entries have valid coding structure
- At least one category matches either 'Survey' or 'Disability Status' requirements

#### Overall Test Assertions
1. **Mandatory Presence**: Every tested Observation resource SHALL have at least one category
2. **Code Validation**: At least one category SHALL contain either:
   - A 'survey' code from the observation-category code system, OR
   - An appropriate disability status related code
3. **Structure Validation**: Category elements SHALL be properly formatted with valid coding system and code values

#### Failure Conditions
- Observation resource lacks a `category` element
- Category array is empty
- No category contains 'survey' or disability status related codes
- Category coding structure is malformed or missing required elements

---

<a id='req-087'></a>

### REQ-087: Observation must include a code for the specific PHQ-9 question

**Text**: 

**Context**: 

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-087

## 1. Requirement ID
REQ-087

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated validation of the Observation resource structure and content.

### Complexity
**Simple** - The requirement involves straightforward validation of a single field (code) within an Observation resource.

### Prerequisites
- System must support US Core Server capabilities as defined in the CapabilityStatement
- System must have PHQ-9 Observation resources available for testing
- System must support JSON format (SHALL requirement from CapabilityStatement)
- System must implement appropriate security controls (authentication/authorization)

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources that claim to represent PHQ-9 questionnaire items
- **Expected Outputs**: Validation results confirming presence and appropriateness of code elements
- **Test Data**: Any existing PHQ-9 Observation resources in the system under test (following "bring your own data" approach)

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are supported and will be used:

1. **GET /Observation/{id}** - Retrieve specific Observation resources for validation
2. **GET /Observation?category=survey** - Search for survey-type observations (if supported by implementation)
3. **GET /Observation?code={PHQ-9-codes}** - Search for observations with specific PHQ-9 question codes (if supported)

*Note: Specific search parameters will depend on the server's search capability implementation as defined in their CapabilityStatement*

### Validation Criteria

#### Primary Assertions (Must Pass):
1. **Code Element Presence**: Each Observation resource representing a PHQ-9 question item MUST contain a `code` element
2. **Code System Validation**: The code MUST use an appropriate coding system (e.g., LOINC) for PHQ-9 question identification
3. **PHQ-9 Specificity**: The code MUST specifically identify which PHQ-9 question the observation represents (questions 1-9, or total score)

#### Specific Validation Steps:
1. **Structural Validation**:
   - Verify `Observation.code` element exists and is not empty
   - Verify `Observation.code.coding` array contains at least one coding entry
   - Verify each coding entry has both `system` and `code` values

2. **Semantic Validation**:
   - Verify the coding system used is appropriate for PHQ-9 items (commonly LOINC: http://loinc.org)
   - Verify the specific code identifies a recognized PHQ-9 question or component
   - Common PHQ-9 LOINC codes include:
     - Individual questions: 44250-9 through 44258-1, plus 44259-0
     - Total score: 44261-6

3. **Conformance Validation**:
   - Verify the resource validates against the US Core Observation profile if claimed
   - Verify proper use of `meta.profile` if US Core profile is claimed (SHOULD requirement)

#### Test Pass Conditions:
- All retrieved PHQ-9 Observation resources contain a properly formatted `code` element
- Each code accurately represents a specific PHQ-9 question component
- The coding system used is recognized and appropriate for PHQ-9 questionnaires
- Resources pass FHIR validation against declared profiles

#### Test Fail Conditions:
- Any PHQ-9 Observation resource lacks a `code` element
- Code element is present but empty or malformed
- Code does not specifically identify which PHQ-9 question is represented
- Coding system is inappropriate or unrecognized for PHQ-9 context
- Resource validation fails against claimed profiles

---

<a id='req-088'></a>

### REQ-088: Observation must include a performer

**Text**: 

**Context**: 

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-088

## Requirement ID
REQ-088: Observation must include a performer

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be programmatically verified by checking for the presence of the `performer` element in Observation resources.

### Complexity
**Simple** - This is a straightforward structural validation that requires checking for the existence of a single element.

### Prerequisites
- System must support FHIR R4
- System must implement US Core Server capabilities
- System must have Observation resources available for testing
- Test system must be able to perform FHIR read operations on Observation resources

## Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: One or more Observation resources from the system under test
- **Test Data**: Any existing Observation resources in the system (bring your own data approach)
- **System Endpoint**: Base FHIR server URL supporting US Core Server capabilities

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are supported and can be used for testing:

1. **GET [base]/Observation/[id]** - Read specific Observation resources
2. **GET [base]/Observation** - Search for Observation resources (with appropriate search parameters)

### Validation Criteria

#### Primary Validation
**PASS Criteria:**
- Every Observation resource retrieved from the system MUST contain a `performer` element
- The `performer` element MUST NOT be empty
- The `performer` element MUST contain at least one valid reference to a practitioner, organization, patient, or related person

**FAIL Criteria:**
- Any Observation resource lacks a `performer` element entirely
- The `performer` element is present but empty (no array entries)
- The `performer` element contains invalid or malformed references

#### Test Implementation Steps

1. **Resource Discovery**
   - Query the system to identify available Observation resources using supported search parameters
   - Select a representative sample of Observation resources for testing

2. **Resource Retrieval**
   - Perform GET operations to retrieve individual Observation resources
   - Collect all Observation resources from search results

3. **Structural Validation**
   - For each Observation resource, verify the presence of the `performer` element
   - Validate that `performer` is an array with at least one entry
   - Verify that each performer reference is properly formatted

4. **Conformance Assessment**
   - Document any Observation resources that fail the performer requirement
   - Calculate the percentage of compliant resources
   - Generate a conformance report

#### Specific Assertions
```
ASSERT: Observation.performer EXISTS
ASSERT: Observation.performer.length >= 1
ASSERT: Each Observation.performer[n].reference IS_VALID_REFERENCE
```

#### Expected Test Results
- **100% compliance required**: All Observation resources must include a performer element
- **Test Report**: Summary of total observations tested, number passing/failing, and details of any non-compliant resources
- **Error Details**: For any failing resources, provide the resource ID and specific missing/invalid performer information

---

<a id='req-089'></a>

### REQ-089: Observation must include a derivedFrom reference

**Text**: 

**Context**: 

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-089

## 1. Requirement ID
**REQ-089**: Observation must include a derivedFrom reference

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be validated programmatically by checking for the presence of the `derivedFrom` element in Observation resources and verifying that it contains valid references.

### Complexity
**Simple** - The test involves a straightforward structural validation of a specific element within an Observation resource.

### Prerequisites
- System must support US Core Observation profiles (as indicated by the PHQ-9 context)
- Test system must have access to Observation resources that are expected to contain derivedFrom references
- System must support FHIR RESTful read operations for Observation resources
- Test data should include Observation resources that represent derived measurements or assessments (such as PHQ-9 items)

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources that should contain derivedFrom references (particularly those representing derived or calculated values, assessment items, or secondary observations)
- **System Configuration**: Access to a FHIR server implementing US Core Server capabilities
- **Authentication**: Valid credentials/tokens if required by the server security implementation

### Expected Outputs
- Observation resources with populated `derivedFrom` element containing valid FHIR references
- Successful validation of reference integrity and format compliance

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are supported and required for testing:

1. **GET /Observation/{id}** - Read operation to retrieve specific Observation resources
2. **GET /Observation** - Search operation to retrieve multiple Observation resources for batch validation
3. **Optional**: Reference resolution to validate that derivedFrom references point to valid, accessible resources

### Validation Criteria

#### Primary Assertions (SHALL requirements):
1. **Presence Validation**: Each tested Observation resource MUST contain a `derivedFrom` element
2. **Structure Validation**: The `derivedFrom` element MUST be properly structured as a FHIR Reference type
3. **Reference Format**: Each reference in `derivedFrom` MUST follow valid FHIR reference format (either relative or absolute URI)

#### Secondary Assertions (SHOULD requirements):
1. **Reference Integrity**: Referenced resources SHOULD be accessible and valid FHIR resources
2. **Reference Type**: References SHOULD point to appropriate resource types (typically other Observation resources, DocumentReference, or related clinical resources)

#### Test Execution Steps:
1. **Discovery Phase**: 
   - Query the system for Observation resources using GET /Observation
   - Filter for resources that are expected to have derivedFrom references (e.g., PHQ-9 items, derived measurements)

2. **Validation Phase**:
   - For each identified Observation resource:
     - Assert presence of `derivedFrom` element
     - Validate Reference structure and format
     - Verify reference syntax compliance with FHIR specification
   - Optional: Attempt to resolve references to confirm accessibility

3. **Reporting Phase**:
   - Document any Observation resources missing required derivedFrom references
   - Report any malformed or invalid references
   - Provide summary of conformance status

#### Pass/Fail Criteria:
- **PASS**: All tested Observation resources contain properly formatted derivedFrom references
- **FAIL**: Any tested Observation resource lacks a derivedFrom element or contains malformed references
- **CONDITIONAL PASS**: If no applicable Observation resources are found in the test data, the test should be marked as "Not Applicable" rather than failed

#### Error Handling:
- Handle HTTP 401/403/404 responses as per US Core Server CapabilityStatement requirements
- Account for server-side filtering or access controls that may limit resource visibility
- Ensure test gracefully handles resources that may not require derivedFrom references (distinguish between resources that should have derivedFrom vs. those that optionally may have it)

---

<a id='req-090'></a>

### REQ-090: Observation must include a value for the PHQ-9 response

**Text**: 

**Context**: 

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-090

## 1. Requirement ID
**REQ-090**: Observation must include a value for the PHQ-9 response

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be validated programmatically by checking for the presence of a value element in PHQ-9 Observation resources.

### Complexity
**Simple** - The test involves straightforward validation of a required data element presence in FHIR Observation resources.

### Prerequisites
- System must support US Core Observation profiles
- System must have PHQ-9 Observation resources available for testing
- System must support FHIR R4 JSON format
- Test client must have appropriate authentication/authorization to access Observation resources

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources that represent PHQ-9 assessments
- **Resource Identification**: Observations can be identified by:
  - `code.coding.code` = "44259-0" (PHQ-9 total score)
  - `code.coding.system` = "http://loinc.org"
  - Or other PHQ-9 related LOINC codes for individual items

### Required FHIR Operations
Based on the US Core Server Capability Statement, the following operations are supported:

1. **GET /Observation/[id]** - Direct resource retrieval
2. **GET /Observation?code=[code]** - Search for PHQ-9 observations by code
3. **GET /Observation?patient=[patient-id]** - Search for observations by patient (if testing patient-specific data)

### Validation Criteria

#### Primary Validation
For each PHQ-9 Observation resource retrieved:

1. **Value Presence Check**:
   - Verify that the Observation resource contains at least one of the following value elements:
     - `valueQuantity` (for numeric scores)
     - `valueInteger` (for integer scores)
     - `valueString` (for text responses)
     - `valueCodeableConcept` (for coded responses)
     - `valueBoolean` (for yes/no responses)
     - `valueRange` (for range values)

2. **Value Content Validation**:
   - If `valueQuantity` is present, verify it has a numeric `value`
   - If `valueInteger` is present, verify it contains a valid integer
   - If `valueString` is present, verify it is not empty or null
   - If `valueCodeableConcept` is present, verify it contains valid coding information
   - If `valueBoolean` is present, verify it contains true/false
   - If `valueRange` is present, verify it contains valid range bounds

#### Test Assertions

**PASS Criteria**:
- All PHQ-9 Observation resources contain a populated value element
- The value element contains valid, non-null data appropriate for the value type
- The value is clinically meaningful for PHQ-9 context (e.g., numeric scores within expected ranges)

**FAIL Criteria**:
- Any PHQ-9 Observation resource lacks a value element
- Any value element is present but empty/null
- Any value element contains invalid data for its declared type

#### Implementation Notes

1. **Resource Identification**: The test should identify PHQ-9 observations through standard LOINC codes or profile declarations rather than hardcoded resource IDs

2. **Data Flexibility**: The test accommodates "bring your own data" by:
   - Searching for PHQ-9 observations using standard codes
   - Validating any PHQ-9 observations found in the system
   - Not requiring specific test fixtures or predefined data sets

3. **Multiple Value Types**: The test accounts for different ways PHQ-9 responses might be represented (numeric scores, text responses, coded values)

4. **Scope Limitation**: Focus on value presence and basic validity rather than clinical accuracy or comprehensive PHQ-9 scoring validation

#### Test Execution Flow

1. Search for PHQ-9 Observation resources using supported search parameters
2. For each returned Observation:
   - Verify it represents a PHQ-9 assessment
   - Check for presence of any value element
   - Validate the content of the value element
3. Report results indicating conformance with the SHALL requirement

---

<a id='req-091'></a>

### REQ-091: Observation must include a code for the specific PHQ-9 question

**Text**: 

**Context**: 

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-091

## Requirement ID
REQ-091

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated validation by examining the structure and content of Observation resources that represent PHQ-9 question items.

### Complexity
**Simple** - The requirement involves validating the presence and correctness of a single field (code) within Observation resources.

### Prerequisites
- System must support US Core Server capabilities as defined in the CapabilityStatement
- System must be able to return Observation resources
- Test data should include Observation resources that represent individual PHQ-9 question items
- System must support JSON format (required by US Core Server CapabilityStatement)

## Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources that represent individual PHQ-9 question items
- **Expected Resource Profile**: Observations should conform to relevant US Core or PHQ-9 specific profiles
- **Test Data**: Any existing Observation resources in the system that are intended to represent PHQ-9 question items

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are supported and can be used:
- **GET /Observation/{id}** - Retrieve specific Observation resources
- **GET /Observation?[search-parameters]** - Search for Observation resources (if search parameters for PHQ-9 observations are available)

### Validation Criteria

#### Primary Assertions
1. **Code Presence Validation**:
   - Each Observation resource representing a PHQ-9 question item SHALL have a `code` element
   - The `code` element SHALL NOT be null or empty

2. **Code Structure Validation**:
   - The `code` element SHALL contain at least one coding
   - Each coding SHALL have a `code` value that identifies the specific PHQ-9 question

3. **PHQ-9 Question Specificity**:
   - The code SHALL be specific enough to identify which PHQ-9 question is being answered
   - Common PHQ-9 question codes include:
     - Individual question codes (e.g., LOINC codes for specific PHQ-9 questions)
     - Codes that clearly map to one of the 9 PHQ-9 questions

#### Secondary Assertions
1. **Coding System Validation**:
   - If LOINC codes are used, verify the `system` is "http://loinc.org"
   - Verify that the coding system is appropriate for PHQ-9 question identification

2. **Code Validity**:
   - If using standard terminologies, verify that the codes are valid within their respective systems
   - Ensure codes appropriately represent PHQ-9 question items rather than summary scores

#### Test Steps
1. **Resource Identification**:
   - Identify all Observation resources that represent PHQ-9 question items in the test data
   - This may be done through resource metadata, profiles, or code analysis

2. **Code Element Validation**:
   - For each identified PHQ-9 question Observation:
     - Verify `observation.code` exists and is not null
     - Verify `observation.code.coding` array exists and contains at least one coding
     - Verify each coding has a non-null, non-empty `code` value

3. **Specificity Validation**:
   - Verify that the code identifies a specific PHQ-9 question rather than a generic mental health assessment
   - Ensure the code can distinguish between different PHQ-9 questions (questions 1-9)

#### Pass/Fail Criteria
- **PASS**: All Observation resources representing PHQ-9 question items contain a properly structured code element that specifically identifies the PHQ-9 question being addressed
- **FAIL**: Any PHQ-9 question Observation resource lacks a code element, has a null/empty code, or has a code that does not specifically identify the PHQ-9 question

#### Error Handling
- Document any HTTP error responses (400, 401, 403, 404) as per US Core Server requirements
- Handle cases where no PHQ-9 question Observations exist in the test data (test may be marked as not applicable rather than failed)

---

<a id='req-092'></a>

### REQ-092: The system shall categorize observations.

**Text**: 

**Context**: 

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-092

## Requirement ID
REQ-092

## Requirement Analysis

### Testability Assessment
**Classification**: Not testable due to being too vague

**Rationale**: The requirement "The system shall categorize observations" is extremely vague and lacks specific criteria for what constitutes proper categorization. While the Capability Statement shows extensive support for Observation resources with category-based search parameters, the requirement itself doesn't specify:
- What categorization scheme should be used
- Which observations must be categorized
- What constitutes valid categories
- Whether this refers to the `Observation.category` element or some other categorization mechanism

### Complexity
**Level**: Not Applicable (due to vagueness)

### Prerequisites
Not applicable - requirement is too vague to develop meaningful test criteria.

## Test Implementation Strategy

### Assessment
This requirement cannot be translated into a concrete test specification because:

1. **Lack of Specificity**: The requirement doesn't define what "categorize observations" means in the context of FHIR implementation
2. **Missing Criteria**: No success criteria are provided to determine what constitutes proper categorization
3. **Ambiguous Scope**: It's unclear whether this applies to all observations or specific types

### Recommendations for Requirement Refinement

To make this requirement testable, it should be refined to include:

1. **Specific Categorization Requirements**: 
   - Which FHIR elements must be populated (e.g., `Observation.category`)
   - Required value sets or coding systems
   - Specific category codes that must be supported

2. **Scope Definition**:
   - Which Observation profiles this applies to (given the 25+ US Core Observation profiles in the Capability Statement)
   - Whether this is about search functionality, data validation, or both

3. **Success Criteria**:
   - Measurable outcomes that indicate proper categorization
   - Expected system behavior when categorization is missing or incorrect

### Alternative Testing Approach

If the intent is to test that observations are properly categorized according to US Core requirements, consider testing against the specific Observation profiles mentioned in the Capability Statement, which already include category requirements and constraints that can be validated through:

1. **Profile Validation**: Using FHIR validators to ensure observations conform to their respective US Core profiles
2. **Search Parameter Testing**: Verifying that category-based searches work as specified in the Capability Statement
3. **Data Quality Checks**: Ensuring `Observation.category` is populated with appropriate values from required value sets

## Conclusion

This requirement needs significant refinement before it can be effectively tested. The current language is too abstract to create meaningful conformance tests that would ensure interoperability.

---

<a id='req-093'></a>

### REQ-093: Observation must include a derivedFrom reference

**Text**: 

**Context**: 

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-093

## 1. Requirement ID
**REQ-093**: Observation must include a derivedFrom reference

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated inspection of Observation resources to check for the presence of the `derivedFrom` element.

### Complexity
**Simple** - This is a straightforward structural validation that checks for the presence of a specific FHIR element.

### Prerequisites
- System must support US Core Observation profiles (based on PHQ-9 context)
- System must have Observation resources available for testing
- System must support FHIR RESTful read operations as per the Capability Statement
- Test client must have appropriate authorization/authentication credentials

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: 
  - Observation resources (specifically PHQ-9 related observations based on the source context)
  - Any referenced resources that may be targets of the `derivedFrom` element
- **System Configuration**: 
  - Active FHIR server endpoint supporting US Core Server capabilities
  - Valid authentication/authorization tokens if required

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are required:
- **GET /Observation/{id}** - Individual resource retrieval
- **GET /Observation** - Search operations to identify test candidates
- Support for JSON format (SHALL requirement from CapabilityStatement)
- Proper HTTP response handling (400, 401, 403, 404 status codes)

### Validation Criteria

#### Test Case 1: Verify derivedFrom Presence in Individual Observations
**Objective**: Confirm that Observation resources contain the required `derivedFrom` element

**Test Steps**:
1. Query the system to retrieve available Observation resources using supported search parameters
2. For each Observation resource returned:
   - Perform GET /Observation/{id} to retrieve the complete resource
   - Verify HTTP response is 200 (success)
   - Parse the JSON response
3. Inspect each Observation resource structure

**Assertions**:
- **PASS Criteria**:
  - Observation resource contains a `derivedFrom` element
  - The `derivedFrom` element contains at least one valid Reference
  - Each Reference in `derivedFrom` has either a valid `reference` URL or contained resource identifier
  - JSON structure is valid and parseable

- **FAIL Criteria**:
  - Observation resource lacks a `derivedFrom` element entirely
  - `derivedFrom` element is present but empty/null
  - `derivedFrom` contains invalid reference syntax
  - System returns error responses (4xx, 5xx) for valid requests

#### Test Case 2: Validate derivedFrom Reference Integrity
**Objective**: Ensure `derivedFrom` references point to valid resources when resolvable

**Test Steps**:
1. For Observation resources with `derivedFrom` elements identified in Test Case 1
2. Extract reference URLs from `derivedFrom` elements
3. For internal references (not external URLs), attempt to resolve the referenced resource
4. Verify referenced resource accessibility

**Assertions**:
- **PASS Criteria**:
  - Internal references in `derivedFrom` resolve to accessible resources (HTTP 200)
  - External references follow proper URL format
  - Contained resources referenced in `derivedFrom` exist within the same Observation resource

- **FAIL Criteria**:
  - Internal references result in HTTP 404 (not found) errors
  - Reference syntax is malformed
  - Referenced contained resources are missing from the parent resource

#### Test Case 3: Conformance with US Core Requirements
**Objective**: Verify the implementation aligns with US Core Server capabilities

**Test Steps**:
1. Verify system supports JSON format responses
2. Confirm proper HTTP status code handling
3. Validate security requirements are met

**Assertions**:
- **PASS Criteria**:
  - System returns JSON formatted Observation resources
  - Appropriate HTTP status codes returned (200 for success, 4xx for client errors)
  - Security requirements satisfied (proper authentication/authorization handling)

- **FAIL Criteria**:
  - System fails to support required JSON format
  - Improper HTTP status code responses
  - Security violations or unauthorized access permitted

### Expected Test Outcomes
- **Overall PASS**: All tested Observation resources contain valid `derivedFrom` elements with proper references
- **Overall FAIL**: Any Observation resource lacks the required `derivedFrom` element or contains invalid references
- **Partial Compliance**: Some but not all Observation resources meet the requirement (indicates systematic implementation issue)

### Notes for Testers
- Focus testing on PHQ-9 related Observation resources based on the requirement source context
- Use the "bring your own data" approach - test against whatever Observation resources are available in the target system
- Ensure test coverage includes various types of references (internal, external, contained) if present in the test data
- Document any system-specific patterns in `derivedFrom` usage for future reference

---

<a id='req-094'></a>

### REQ-094: Observation status must be set to 'Final'

**Text**: 

**Context**: 

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-094

## 1. Requirement ID
REQ-094: Observation status must be set to 'Final'

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated programmatically by checking the `status` field value in Observation resources.

### Complexity
**Simple** - This is a straightforward field validation check requiring examination of a single element in the Observation resource.

### Prerequisites
- System must support US Core Server capabilities as defined in the CapabilityStatement
- System must have Observation resources available (specifically PRAPARE-related observations based on the source context)
- System must support FHIR R4 JSON format
- Valid authentication/authorization credentials for API access

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources that are expected to have "final" status
- **System Endpoint**: Base FHIR server URL supporting US Core Server CapabilityStatement
- **Authentication**: Valid credentials/tokens as per system security requirements

### Expected Outputs
- All retrieved Observation resources must have `status` field set to "final"
- HTTP 200 response for successful resource retrieval
- Valid FHIR JSON format responses

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are supported and can be used:

1. **GET [base]/Observation/[id]** - Read specific Observation resource
2. **GET [base]/Observation?[search-parameters]** - Search for Observation resources
3. **GET [base]/Observation** - Retrieve all accessible Observation resources (if supported)

*Note: The specific search parameters and read operations must align with what's defined in the US Core Observation profiles that the server supports.*

### Validation Criteria

#### Primary Assertions
1. **Status Field Presence**: Every Observation resource must contain a `status` field
2. **Status Value Validation**: The `status` field value must equal "final" (case-sensitive)
3. **FHIR Conformance**: Resources must be valid FHIR Observation resources with proper JSON structure

#### Test Cases

**Test Case 1: Individual Observation Resource Validation**
- **Action**: Retrieve individual Observation resources by ID
- **Assertion**: `observation.status == "final"`
- **Pass Criteria**: All retrieved Observation resources have status set to "final"

**Test Case 2: Bulk Observation Validation via Search**
- **Action**: Search for Observation resources using available search parameters
- **Assertion**: For each Observation in the search results, `observation.status == "final"`
- **Pass Criteria**: All Observation resources in search results have status set to "final"

**Test Case 3: Error Handling Validation**
- **Action**: Attempt to access Observation resources with proper authentication
- **Assertion**: System returns appropriate HTTP status codes (200 for success, 401/403/404 for auth/access issues as per CapabilityStatement)
- **Pass Criteria**: System responds with expected HTTP status codes and any successfully retrieved Observations have status "final"

#### Failure Scenarios
- **Test Fails If**: Any Observation resource has a `status` field with a value other than "final"
- **Test Fails If**: Any Observation resource is missing the `status` field entirely
- **Test Fails If**: Retrieved resources are not valid FHIR Observation resources
- **Test Fails If**: System returns unexpected HTTP error codes not aligned with CapabilityStatement requirements

#### Additional Validation Notes
- Test should be designed to work with existing data in the system (bring your own data approach)
- If no Observation resources are available in the system, the test should report this as an inconclusive result rather than a failure
- Test should handle pagination if the system returns paged results for Observation searches
- Test should respect any access control limitations and only validate Observations that the test client is authorized to access

---

<a id='req-095'></a>

### REQ-095: Observation must include a category of 'SDOH' or 'Survey'

**Text**: 

**Context**: 

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-095

## Requirement ID
REQ-095

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated through automated verification of the Observation resource's category field values.

### Complexity
**Simple** - The requirement involves checking for the presence of specific category codes in an Observation resource.

### Prerequisites
- System must support US Core Observation profiles as specified in the Capability Statement
- System must have Observation resources available for testing
- Test system must be able to perform FHIR REST API operations (GET requests)

## Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources that claim conformance to any US Core Observation profile
- **System Endpoint**: Base FHIR server URL supporting US Core Server CapabilityStatement
- **Test Data**: Any existing Observation resources in the system under test

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required for testing:

1. **Search Operations**:
   - `GET [base]/Observation?patient=[patient-id]` - to retrieve patient's observations
   - `GET [base]/Observation?category=[category]` - to search by category
   - `GET [base]/Observation?patient=[patient-id]&category=[category]` - combined search

2. **Read Operations**:
   - `GET [base]/Observation/[id]` - to retrieve specific observation instances

### Validation Criteria

#### Test Case 1: Verify Category Presence and Values
**Objective**: Confirm that Observation resources include a category field with 'SDOH' or 'Survey' values

**Test Steps**:
1. Retrieve Observation resources from the system using supported search parameters
2. For each Observation resource, examine the `category` element
3. Verify that at least one category coding contains either:
   - Code value 'SDOH' (Social Determinants of Health), OR
   - Code value 'Survey'

**Pass Criteria**:
- Observation.category element is present
- At least one Observation.category.coding element contains code 'SDOH' OR 'Survey'
- The category coding follows proper FHIR CodeableConcept structure

**Fail Criteria**:
- Observation.category element is missing
- No category coding contains 'SDOH' or 'Survey' codes
- Category element exists but is empty or improperly formatted

#### Test Case 2: Category Code System Validation
**Objective**: Ensure category codes use appropriate code systems

**Test Steps**:
1. For each Observation with 'SDOH' or 'Survey' category codes
2. Verify the coding system URI is appropriate for the code used
3. Check that the category follows US Core Observation profile constraints

**Pass Criteria**:
- Category codes reference valid code systems
- Coding structure conforms to US Core requirements
- No conflicting or invalid category combinations

#### Test Case 3: Profile-Specific Category Requirements
**Objective**: Validate category requirements across different US Core Observation profiles

**Test Steps**:
1. Identify which US Core Observation profile each resource claims conformance to
2. Apply profile-specific category validation rules
3. Ensure SDOH/Survey categories are appropriate for the specific observation type

**Pass Criteria**:
- Category values align with the claimed US Core profile
- Required categories for specific profiles are present
- SDOH/Survey categories are contextually appropriate

### Expected Assertions
- `assert observation.category exists`
- `assert observation.category.coding.where(code='SDOH' or code='Survey').exists()`
- `assert observation.category.coding.system is valid URI when code='SDOH' or 'Survey'`
- `assert observation conforms to declared US Core profile with appropriate category`

### Notes
- This test accommodates "bring your own data" by working with any existing Observation resources
- The test validates conformance to the SHALL requirement without requiring specific test fixtures
- Multiple US Core Observation profiles are supported as listed in the Capability Statement
- The test focuses on interoperability conformance rather than exhaustive edge case testing

---

<a id='req-096'></a>

### REQ-096: Observation must include a code for the specific question being assessed

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-096

## 1. Requirement ID
REQ-096

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified programmatically by examining the structure and content of Observation resources to ensure they contain the required code element.

### Complexity
**Simple** - The test involves straightforward validation of a mandatory FHIR element presence and structure within Observation resources.

### Prerequisites
- System must support US Core Server capabilities as defined in the Capability Statement
- System must have Observation resources available for testing (bring your own data approach)
- Test client must have appropriate access permissions to retrieve Observation resources
- System must support JSON format (required by US Core)

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources that represent assessment questions/items
- **System Endpoint**: FHIR server base URL supporting US Core Server capabilities
- **Authentication**: Valid credentials/tokens as required by the system's security implementation

### Expected Outputs
- Observation resources containing properly structured `code` elements
- Each `code` element should identify the specific question/assessment being performed

### Required FHIR Operations
Based on the US Core Server Capability Statement, the following operations are supported and should be used:

1. **GET /Observation/{id}** - Retrieve specific Observation resources by ID
2. **GET /Observation?[search-parameters]** - Search for Observation resources using supported search parameters
3. **GET /metadata** - Retrieve server capability statement to confirm US Core support

### Validation Criteria

#### Primary Assertions (Must Pass):
1. **Code Element Presence**: Each tested Observation resource SHALL contain a `code` element
   - Path: `Observation.code`
   - Cardinality: 1..1 (exactly one required)

2. **Code Structure Validation**: The `code` element SHALL be properly structured as a CodeableConcept
   - Must contain at least one `coding` element OR a `text` element
   - Path: `Observation.code.coding` or `Observation.code.text`

3. **Specific Question Identification**: The code SHALL identify the specific question/assessment being performed
   - Verify that `Observation.code.coding.code` contains a meaningful identifier
   - Verify that `Observation.code.coding.system` identifies the coding system used
   - OR verify that `Observation.code.text` contains descriptive text identifying the question

#### Secondary Assertions (Should Pass):
1. **US Core Profile Conformance**: If the server declares US Core profile support, validate against appropriate US Core Observation profiles
   - Check `meta.profile` for US Core profile declarations
   - Validate resource structure against declared profiles

2. **Coding System Validation**: When `coding` is present, verify standard coding systems are used appropriately
   - Common systems: LOINC, SNOMED CT, local codes with proper system URI

#### Test Execution Steps:
1. **Discovery Phase**:
   - Retrieve server CapabilityStatement to confirm US Core Server support
   - Identify available Observation resources for testing

2. **Resource Retrieval Phase**:
   - Retrieve sample Observation resources using supported search operations
   - Focus on resources representing assessment questions/items

3. **Validation Phase**:
   - For each retrieved Observation:
     - Assert presence of `code` element
     - Validate `code` structure as CodeableConcept
     - Verify code identifies specific question being assessed
     - Check for US Core profile conformance if applicable

4. **Reporting Phase**:
   - Document any Observation resources missing required `code` elements
   - Report any improperly structured `code` elements
   - Summarize conformance status

#### Pass/Fail Criteria:
- **PASS**: All tested Observation resources contain properly structured `code` elements that identify the specific question being assessed
- **FAIL**: Any Observation resource lacks a `code` element OR contains improperly structured `code` element OR code does not identify the specific question being assessed

#### Error Handling:
- If no Observation resources are available, the test should be marked as "Not Applicable" rather than failed
- Authentication/authorization failures should be reported as configuration issues, not conformance failures
- Server errors (5xx) should be reported as environmental issues requiring investigation

---

<a id='req-097'></a>

### REQ-097: Observation must have an effective date and time

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-097

## 1. Requirement ID
**REQ-097**: Observation must have an effective date and time

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified programmatically by checking for the presence and format of the effective date/time elements in Observation resources.

### Complexity
**Simple** - This is a straightforward structural validation that checks for mandatory data elements in a FHIR resource.

### Prerequisites
- Access to a FHIR server implementing US Core Server capabilities
- Observation resources available in the system (any Observation resources can be used for testing)
- Test client capable of making FHIR REST API calls
- Ability to parse and validate FHIR JSON/XML responses

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Any existing Observation resources in the system under test
- Focus on PRAPARE-related Observations if available, but any Observation resources are suitable for this test

**Expected Outputs:**
- FHIR Observation resources with populated effective date/time elements
- Validation results confirming presence of required temporal data

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations should be supported:

1. **GET /Observation/[id]** - Read specific Observation resources
2. **GET /Observation?[search-parameters]** - Search for Observation resources using supported search parameters
3. **GET /Observation?patient=[patient-id]** - Retrieve Observations for specific patients (common US Core search requirement)

### Validation Criteria

**Primary Assertions:**
1. **Effective Element Presence Check**: Each Observation resource MUST contain at least one of the following effective elements:
   - `effectiveDateTime` (single point in time)
   - `effectivePeriod` (time range)
   - `effectiveInstant` (precise timestamp)

2. **Data Type Validation**: The effective element(s) present MUST conform to appropriate FHIR data types:
   - `effectiveDateTime`: Valid FHIR dateTime format (YYYY-MM-DDTHH:mm:ss+/-ZZ:zz)
   - `effectivePeriod`: Valid Period with start and/or end dateTime values
   - `effectiveInstant`: Valid FHIR instant format with mandatory timezone

3. **Cardinality Compliance**: Only one effective[x] element should be present per Observation (FHIR choice type constraint)

**Test Execution Steps:**
1. Query the system for available Observation resources using supported search operations
2. For each retrieved Observation resource:
   - Verify presence of exactly one effective[x] element
   - Validate the data type and format of the effective element
   - Confirm the value is not null or empty
3. Record any Observation resources that fail the effective date/time requirement
4. Generate a conformance report indicating pass/fail status

**Pass Criteria:**
- All tested Observation resources contain a valid effective date/time element
- No Observation resources are missing the effective temporal information
- All effective date/time values conform to FHIR data type specifications

**Fail Criteria:**
- Any Observation resource lacks an effective[x] element
- Any effective date/time value is malformed or invalid according to FHIR specifications
- Multiple effective[x] elements present in a single Observation resource

---

<a id='req-098'></a>

### REQ-098: Observation must include a performer

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-098

## 1. Requirement ID
**REQ-098**: Observation must include a performer

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated programmatically by checking the presence of the `performer` element in Observation resources.

### Complexity
**Simple** - This is a straightforward structural validation requiring verification of a mandatory field presence.

### Prerequisites
- System must support FHIR R4
- System must implement US Core Server capabilities for Observation resources
- Test data must include Observation resources (particularly PRAPARE-related observations based on the source context)
- System must support read operations on Observation resources as specified in the US Core Server CapabilityStatement

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: 
  - Observation resources stored in the system under test
  - Focus on Observation resources that would be subject to this requirement (particularly those related to PRAPARE assessments based on the source context)
- **System Access**: 
  - Authenticated access to the FHIR server
  - Appropriate permissions to read Observation resources

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are supported and required for testing:

1. **GET [base]/Observation/[id]** - Individual resource retrieval
2. **GET [base]/Observation** - Search for Observation resources with various parameters
3. **GET [base]/Observation?patient=[reference]** - Patient-specific observation search (if testing patient-scoped data)

### Validation Criteria

#### Primary Validation
For each Observation resource retrieved:

1. **Performer Presence Check**:
   - Verify that `Observation.performer` element exists
   - Confirm that `Observation.performer` is not empty
   - Validate that `Observation.performer` contains at least one valid reference

#### Detailed Assertions
- **PASS**: Observation resource contains a `performer` element with at least one valid reference
- **FAIL**: Observation resource lacks a `performer` element OR `performer` element is present but empty

#### Test Case Structure
1. **Discovery Phase**:
   - Query the system to retrieve available Observation resources using supported search parameters
   - Focus on observations that fall under the scope of this requirement

2. **Validation Phase**:
   - For each retrieved Observation resource:
     - Parse the resource structure
     - Check for the presence of `Observation.performer`
     - Validate that the performer contains valid FHIR reference format
     - Document any resources that fail the requirement

3. **Reporting Phase**:
   - Calculate compliance percentage (passing observations / total observations tested)
   - Provide detailed results for any failing observations
   - Report should include resource IDs of non-conformant observations

#### Success Criteria
- **100% compliance required** due to SHALL conformance level
- All tested Observation resources must include a valid performer element
- Any resource lacking a performer constitutes a conformance failure

#### Edge Cases to Consider
- Observations with multiple performers (should pass)
- Observations with performer references to different resource types (Practitioner, Organization, Patient, etc.)
- Verify that empty performer arrays are caught as failures

This test specification supports a "bring your own data" approach by testing whatever Observation resources exist in the target system, ensuring the requirement is validated across the system's actual data rather than contrived test fixtures.

---

<a id='req-099'></a>

### REQ-099: Observation must have a value indicating the response

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-099

## 1. Requirement ID
**REQ-099**: Observation must have a value indicating the response

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified programmatically by checking for the presence and validity of value elements in Observation resources.

### Complexity
**Simple** - The requirement is straightforward to test by verifying the existence of value-related fields in Observation resources.

### Prerequisites
- System must support US Core Server capabilities for Observation resources
- Test system must have access to Observation resources (either through search operations or pre-loaded test data)
- System must support JSON format (required by US Core Server capability)
- Proper authentication/authorization setup as per US Core security requirements

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- One or more Observation resources that should contain response values
- Resources may be obtained through:
  - Search operations (if supported by the system under test)
  - Direct resource retrieval by ID
  - System's existing test data following "bring your own data" approach

**Expected Outputs:**
- Observation resources with populated value elements indicating responses
- HTTP 200 status for successful resource retrieval
- Valid FHIR JSON format responses

### Required FHIR Operations
Based on US Core Server CapabilityStatement, the following operations **MAY** be used (depending on system support):

1. **GET [base]/Observation/[id]** - Direct resource retrieval
2. **GET [base]/Observation?[search-parameters]** - Search for Observation resources
3. **GET [base]/Patient/[id]/Observation** - Patient-specific observation search (if supported)

**Note:** The specific search parameters and operations used will depend on what the system under test supports according to their CapabilityStatement.

### Validation Criteria

For each Observation resource retrieved, verify the following assertions:

#### Primary Validation
1. **Value Presence Check**: The Observation resource **SHALL** contain at least one of the following value elements:
   - `valueQuantity`
   - `valueCodeableConcept`
   - `valueString`
   - `valueBoolean`
   - `valueInteger`
   - `valueRange`
   - `valueRatio`
   - `valueSampledData`
   - `valueTime`
   - `valueDateTime`
   - `valuePeriod`
   - `valueAttachment`
   - `valueReference`

#### Secondary Validation
2. **Value Content Check**: If a value element is present, it **SHALL**:
   - Be properly formatted according to FHIR data type specifications
   - Not be empty or null
   - Contain meaningful response data (not just placeholder values)

3. **Resource Validity**: The Observation resource **SHALL**:
   - Be valid FHIR JSON format
   - Pass basic FHIR validation rules
   - Include required Observation elements (status, code, subject)

#### Test Pass Criteria
- **PASS**: All retrieved Observation resources contain at least one populated value element indicating a response
- **FAIL**: Any Observation resource lacks a value element or contains only empty/null value elements
- **ERROR**: Unable to retrieve Observation resources due to system errors or unsupported operations

#### Error Handling Validation
4. **HTTP Response Validation**: Verify appropriate HTTP status codes:
   - 200: Successful retrieval
   - 401/403: Authentication/authorization issues (as per US Core security requirements)
   - 404: Resource not found
   - 400: Invalid parameters

**Test Execution Notes:**
- This test accommodates a "bring your own data" approach by validating whatever Observation resources are available in the system
- The test does not require specific fixture data but works with existing system data
- Multiple Observation resources should be tested when available to ensure consistent conformance
- The test focuses on interoperability conformance rather than comprehensive edge case testing

---

<a id='req-100'></a>

### REQ-100: Observation must include a category of "Survey" or "Disability Status"

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-100

## 1. Requirement ID
**REQ-100**: Observation must include a category of "Survey" or "Disability Status"

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Automatically testable

This requirement can be automatically validated by examining the `category` field in Observation resources to verify the presence of required category values. The requirement is specific and measurable.

### Complexity
**Simple**

The test involves checking for the presence of specific coded values in a single field (`Observation.category`).

### Prerequisites
- System must support US Core Observation profiles (multiple profiles supported per Capability Statement)
- System must have Observation resources available for testing
- Test system must support FHIR R4 RESTful API operations
- Access to search Observations by patient and category parameters (supported per Capability Statement)

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: 
  - Observation resources that should contain either "Survey" or "Disability Status" categories
  - Patient resources (as subjects for the observations)
- **Test Parameters**:
  - Patient identifier(s) for test subjects
  - No specific fixture data required (bring your own data approach)

### Expected Outputs
- **Success Case**: Observation resources with `category` containing either:
  - A coding with system/code representing "Survey" 
  - A coding with system/code representing "Disability Status"
- **Failure Case**: Observation resources missing both required category values

### Required FHIR Operations
Based on the Capability Statement, the following supported operations will be used:

1. **Search Observations**: 
   - `GET [base]/Observation?patient=[patient-id]` 
   - `GET [base]/Observation?patient=[patient-id]&category=[category-code]`
   - `GET [base]/Observation?category=[category-code]`

2. **Read Individual Observations**:
   - `GET [base]/Observation/[id]` (if specific observation IDs are known)

### Validation Criteria

#### Primary Assertions
For each Observation resource retrieved:

1. **Category Field Presence**: 
   - Verify `Observation.category` array exists and is not empty
   - **Pass Condition**: `category` field is present and contains at least one element

2. **Required Category Values**:
   - Check if any `category` element contains a coding that represents "Survey" OR "Disability Status"
   - **Pass Condition**: At least one category coding matches either:
     - Survey category (system and code values that represent survey data)
     - Disability Status category (system and code values that represent disability status)

3. **Coding Structure Validation**:
   - Verify that category entries follow proper CodeableConcept structure
   - **Pass Condition**: Each category contains properly structured `coding` elements with `system` and `code` values

#### Test Scenarios

**Scenario 1: Survey Category Present**
- Search for Observations with survey-related categories
- Validate that returned observations contain appropriate survey category coding
- **Expected Result**: PASS if survey category found

**Scenario 2: Disability Status Category Present** 
- Search for Observations with disability status categories
- Validate that returned observations contain appropriate disability status category coding
- **Expected Result**: PASS if disability status category found

**Scenario 3: Both Categories Present**
- Test observations that may contain both survey and disability status categories
- **Expected Result**: PASS if either category is present

**Scenario 4: Missing Required Categories**
- Identify observations that lack both required category types
- **Expected Result**: FAIL - requirement violation

#### Overall Test Pass Criteria
- **Requirement Conformance**: All tested Observation resources must contain at least one category of "Survey" OR "Disability Status"
- **System Behavior**: The system should only return/store Observation resources that meet this category requirement
- **Interoperability**: Category values should use standard coding systems to ensure semantic interoperability

#### Error Handling
- Document any Observation resources that fail the category requirement
- Report specific missing category information for remediation
- Validate that search operations work correctly with category parameters

---

<a id='req-101'></a>

### REQ-101: Observation must include a category of "Survey"

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-101

## 1. Requirement ID
**REQ-101**: Observation must include a category of "Survey"

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be validated programmatically by checking the presence and value of the `category` element in Observation resources.

### Complexity
**Simple** - The requirement involves a straightforward validation of a single field value within an Observation resource.

### Prerequisites
- System must support US Core Observation profiles as indicated in the Capability Statement
- System must be capable of creating/storing Observation resources with category elements
- Test data should include Observation resources that are expected to have "Survey" category

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- One or more Observation resources that should conform to the requirement
- Observation resources should be related to survey/questionnaire data (based on the source reference to AUDIT-C item example)

**Expected Outputs:**
- Validation results indicating whether each Observation resource contains the required "Survey" category
- Pass/fail status for each tested Observation

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for Observation resources:

**Primary Operations:**
- `GET /Observation?patient={id}&category=survey` - Search for survey observations by patient
- `GET /Observation/{id}` - Retrieve specific Observation resources for validation
- `GET /Observation?category=survey` - Search for all survey observations (if not patient-specific testing)

**Supported Search Parameters (from Capability Statement):**
- `category` - Can be used to filter for survey observations
- `patient` - Can be combined with category for patient-specific searches
- `code`, `date`, `status` - Additional parameters for refined searches if needed

### Validation Criteria

**Primary Assertion:**
1. **Category Presence Check**: Each tested Observation resource MUST contain at least one `category` element
2. **Category Value Validation**: At least one `category` element MUST contain a coding with:
   - System: `http://terminology.hl7.org/CodeSystem/observation-category`
   - Code: `survey`
   - Display: "Survey" (optional but recommended)

**Specific Validation Steps:**
1. Parse the Observation resource
2. Locate the `category` array element
3. Verify that at least one category entry exists
4. For each category entry, check if any coding contains:
   ```json
   {
     "system": "http://terminology.hl7.org/CodeSystem/observation-category",
     "code": "survey"
   }
   ```
5. **Pass Criteria**: At least one category coding matches the survey category requirement
6. **Fail Criteria**: No category elements present OR no category coding contains the survey code

**Additional Considerations:**
- The test should account for multiple category values (an Observation may have multiple categories)
- The test should be flexible enough to work with any survey-related Observation data provided by the tester
- Validation should check both the presence of the category element and the correct coding system/code values
- Consider testing both positive cases (observations that should have survey category) and negative cases (observations that should not have survey category) if the test data supports it

**Test Result Reporting:**
- Report the total number of Observation resources tested
- Report the number of resources that passed/failed the survey category requirement
- Provide specific details about any failures, including which category values were found instead of "survey"

---

<a id='req-102'></a>

### REQ-102: Observation must include a category of 'Vital Signs'

**Text**: 

**Context**: 

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-102

## Requirement ID
REQ-102

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through programmatic validation of FHIR resource content.

### Complexity
**Simple** - The test involves checking for the presence of a specific category value in an Observation resource.

### Prerequisites
- System under test must support the US Core Observation profiles (as indicated in Capability Statement section 14.3.3.20)
- System must have Observation resources available for testing
- Test system must be able to retrieve Observation resources via FHIR API

## Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources that are expected to represent vital signs measurements
- **Resource Identification**: Observation resource IDs or search parameters to identify vital signs observations
- **Expected Category**: The observation should contain a category with the value 'vital-signs'

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required for testing:

1. **Read Operation**: `GET [base]/Observation/[id]`
   - Conformance: SHALL support
   - Used to retrieve specific Observation resources for validation

2. **Search Operation**: `GET [base]/Observation?[search-parameters]`
   - Conformance: SHALL support
   - Relevant search parameter combinations from Capability Statement:
     - `patient + category`: `GET [base]/Observation?patient=[patient-id]&category=vital-signs`
     - `patient + category + date`: `GET [base]/Observation?patient=[patient-id]&category=vital-signs&date=[date-range]`

### Validation Criteria

#### Primary Validation
**Category Presence Check**: Each Observation resource must contain at least one `category` element with:
- `category.coding.system` = "http://terminology.hl7.org/CodeSystem/observation-category"
- `category.coding.code` = "vital-signs"

#### Secondary Validations
1. **Profile Conformance**: Verify the Observation conforms to one of the US Core vital signs profiles listed in the Capability Statement:
   - US Core Vital Signs Profile
   - US Core Blood Pressure Profile
   - US Core Average Blood Pressure Profile
   - US Core Body Temperature Profile
   - US Core Heart Rate Profile
   - US Core Respiratory Rate Profile
   - US Core Pulse Oximetry Profile
   - US Core Body Height Profile
   - US Core Body Weight Profile
   - US Core BMI Profile
   - US Core Head Circumference Profile
   - Other US Core vital signs profiles

2. **Search Functionality**: When searching for observations with `category=vital-signs`, the returned resources should all have the vital signs category.

#### Test Execution Steps
1. Identify Observation resources that represent vital signs measurements using available data
2. For each identified Observation:
   - Retrieve the resource using READ operation
   - Validate presence of category element with 'vital-signs' value
   - Verify the category coding uses the correct system URI
3. Perform search operations using category parameter to verify search functionality
4. Validate that search results consistently return only observations with vital signs category

#### Pass Criteria
- **Assertion 1**: All Observation resources representing vital signs measurements contain `category.coding` with system "http://terminology.hl7.org/CodeSystem/observation-category" and code "vital-signs"
- **Assertion 2**: Search operations using `category=vital-signs` parameter return only observations with the vital signs category
- **Assertion 3**: No vital signs observations are missing the required category classification

#### Fail Criteria
- Any Observation resource that represents a vital signs measurement lacks the 'vital-signs' category
- Search operations return inconsistent results regarding category filtering
- Category elements use incorrect coding system or code values

---

<a id='req-103'></a>

### REQ-103: Observation must include a code for average blood pressure

**Text**: 

**Context**: 

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-103

## 1. Requirement ID
REQ-103

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified programmatically by inspecting the `code` element in Observation resources that represent average blood pressure measurements.

### Complexity
**Simple** - The test involves straightforward validation of a required field presence in FHIR resources.

### Prerequisites
- System must support US Core Server capabilities as defined in the CapabilityStatement
- System must have Observation resources representing average blood pressure measurements
- System must support FHIR R4 Observation resource structure
- Test client must have appropriate access permissions to query Observation resources

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Observation resources that represent average blood pressure measurements
- Resources should conform to relevant US Core Observation profiles

**Expected Outputs:**
- Observation resources with populated `code` element
- Code values that appropriately identify the measurement as average blood pressure

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are supported and can be used for testing:

1. **GET [base]/Observation/[id]** - Retrieve specific Observation resources by ID
2. **GET [base]/Observation?category=vital-signs** - Search for vital sign observations
3. **GET [base]/Observation?code=[code]** - Search for observations by specific codes related to blood pressure

### Validation Criteria

The test SHALL verify the following assertions for each Observation resource representing average blood pressure:

#### Primary Assertions:
1. **Code Presence**: The Observation resource MUST contain a `code` element
2. **Code Structure**: The `code` element MUST be properly structured as a CodeableConcept
3. **Code Value Appropriateness**: The code MUST appropriately identify the observation as representing average blood pressure

#### Specific Validation Steps:
1. **Mandatory Field Check**: 
   - Assert that `Observation.code` exists and is not null/empty
   - Assert that `Observation.code` is a valid CodeableConcept structure

2. **Code Content Validation**:
   - Verify that at least one coding system is present in `Observation.code.coding`
   - Confirm that the code value(s) semantically represent "average blood pressure"
   - Common expected code systems include LOINC, SNOMED CT, or local coding systems

3. **Conformance Validation**:
   - If the Observation claims conformance to a specific US Core profile, validate against that profile's requirements for the code element
   - Ensure the code aligns with vital signs category if `category` element indicates vital signs

#### Test Execution Pattern:
For each average blood pressure Observation resource:
```
GIVEN an Observation resource representing average blood pressure
WHEN the resource is retrieved/queried from the system
THEN the Observation.code element SHALL be present and populated
AND the code SHALL appropriately identify the measurement as average blood pressure
```

#### Pass Criteria:
- All tested Observation resources have a populated `code` element
- All codes appropriately represent average blood pressure measurements
- Code structure conforms to FHIR CodeableConcept requirements

#### Fail Criteria:
- Any Observation resource lacks the `code` element
- Any `code` element is present but empty or structurally invalid
- Any code value does not appropriately represent average blood pressure

---

<a id='req-104'></a>

### REQ-104: Observation must include components for systolic and diastolic values

**Text**: 

**Context**: 

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-104

## 1. Requirement ID
**REQ-104**: Observation must include components for systolic and diastolic values

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be validated programmatically by checking the structure and content of Observation resources.

### Complexity
**Simple** - The requirement involves straightforward validation of component elements within blood pressure Observation resources.

### Prerequisites
- System must support US Core Observation profiles, specifically blood pressure related profiles
- System must have blood pressure Observation data available for testing
- Test client must have read access to Observation resources via FHIR API

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources that represent blood pressure measurements
- **Profile Context**: Based on the capability statement, this applies to:
  - US Core Average Blood Pressure Profile
  - US Core Blood Pressure Profile
  - US Core Vital Signs Profile (when representing blood pressure)

### Required FHIR Operations
Based on the capability statement, the following operations are supported:
- `GET [base]/Observation/[id]` - Read specific Observation resources
- `GET [base]/Observation?patient=[patient-id]&category=vital-signs` - Search for vital signs observations
- `GET [base]/Observation?patient=[patient-id]&code=[blood-pressure-code]` - Search for blood pressure observations

### Test Cases

#### Test Case 1: Blood Pressure Observation Component Validation
**Objective**: Verify that blood pressure Observation resources contain required systolic and diastolic components

**Test Steps**:
1. Query for Observation resources that represent blood pressure measurements using supported search parameters:
   - `GET [base]/Observation?patient=[patient-id]&category=vital-signs`
   - Filter results for blood pressure observations (LOINC codes like 85354-9, 8480-6, etc.)

2. For each blood pressure Observation resource:
   - Verify `Observation.component` array exists and is not empty
   - Check that there are at least two component entries
   - Validate that one component represents systolic blood pressure
   - Validate that one component represents diastolic blood pressure

#### Test Case 2: Component Structure Validation
**Objective**: Ensure components follow proper FHIR structure for blood pressure values

**Test Steps**:
1. For each identified blood pressure Observation:
   - Verify each component has `component.code` element
   - Verify each component has `component.value[x]` element (typically `valueQuantity`)
   - Check that systolic component uses appropriate LOINC code (e.g., 8480-6 "Systolic blood pressure")
   - Check that diastolic component uses appropriate LOINC code (e.g., 8462-4 "Diastolic blood pressure")

### Validation Criteria

**Pass Criteria**:
- All blood pressure Observation resources contain a `component` array
- Each blood pressure Observation has at least two components
- One component represents systolic blood pressure with:
  - Appropriate code (e.g., LOINC 8480-6)
  - Valid value (typically `valueQuantity` with mmHg units)
- One component represents diastolic blood pressure with:
  - Appropriate code (e.g., LOINC 8462-4)  
  - Valid value (typically `valueQuantity` with mmHg units)
- Components follow FHIR R4 structural requirements

**Fail Criteria**:
- Blood pressure Observation resources missing `component` array
- Blood pressure Observation resources with empty `component` array
- Missing systolic or diastolic component
- Components lacking required `code` or `value[x]` elements
- Invalid component structure according to FHIR R4 specification

### Expected Test Results
- **Conformant System**: All blood pressure Observation resources will have properly structured components for both systolic and diastolic values
- **Non-conformant System**: Blood pressure observations may be missing components, have incomplete component data, or use incorrect component structure

### Notes
- This test applies specifically to Observation resources representing blood pressure measurements
- The test should accommodate various blood pressure measurement scenarios (average, individual readings, etc.)
- Systems may use different LOINC codes for blood pressure observations, so the test should be flexible in identifying relevant observations
- The test focuses on structural conformance rather than clinical validity of the actual blood pressure values

---

<a id='req-105'></a>

### REQ-105: Observation must include a component for the number of measurements

**Text**: 

**Context**: 

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-105

## 1. Requirement ID
**REQ-105**: Observation must include a component for the number of measurements

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated validation by examining the structure of Observation resources to confirm the presence of a required component element.

### Complexity
**Simple** - The test involves checking for the existence of a specific component within an Observation resource, which is a straightforward structural validation.

### Prerequisites
- System must support US Core Server CapabilityStatement operations
- System must have Observation resources available for testing (specifically average blood pressure observations based on the source context)
- System must implement FHIR R4 specification
- Test data should include Observation resources that represent average blood pressure measurements

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Observation resources representing average blood pressure measurements
- Resources should be accessible through the system under test

**Expected Outputs:**
- Observation resources that contain a `component` array
- At least one component within the array that represents the number of measurements used to calculate the average

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations should be supported:

1. **GET /Observation/{id}** - Retrieve specific Observation resources
2. **GET /Observation?[search-parameters]** - Search for Observation resources (e.g., by patient, category, code)

*Note: The specific search parameters supported should align with the US Core Observation profile requirements as defined in the CapabilityStatement.*

### Validation Criteria

**Primary Assertion:**
- Each tested Observation resource MUST contain a `component` element (array)
- The `component` array MUST contain at least one component that represents the number of measurements

**Specific Checks:**
1. **Structure Validation:**
   - Verify `Observation.component` exists and is populated
   - Verify `Observation.component` is an array with at least one element

2. **Component Content Validation:**
   - At least one component element should have a `code` that indicates it represents a count/number of measurements
   - The component representing the number of measurements should have a `valueQuantity`, `valueInteger`, or appropriate value type
   - The value should be a positive integer representing the count of measurements

3. **Semantic Validation:**
   - The component code should semantically represent "number of measurements," "count," or similar concept
   - Common codes might include LOINC codes or SNOMED CT codes that represent measurement counts

**Test Pass Criteria:**
- All retrieved Observation resources contain the required component structure
- Each Observation has at least one component that can be identified as representing the number of measurements
- The component values are appropriate data types (numeric) and contain reasonable values (positive integers)

**Test Fail Criteria:**
- Any Observation resource lacks the `component` element
- No component within an Observation can be identified as representing the number of measurements
- Component values are missing, incorrect data types, or contain invalid values (e.g., negative numbers, non-numeric values)

**Implementation Note:**
This test should be executed against all Observation resources that represent average blood pressure measurements within the test dataset, following a "bring your own data" approach where the specific patient data and observation instances are provided by the testing environment.

---

<a id='req-106'></a>

### REQ-106: Observation category must include "SDOH" and "Survey".

**Text**: 

**Context**: 

**Actor**: Observation

**Conformance**: SHALL

# Test Specification for REQ-106

## 1. Requirement ID
**REQ-106**: Observation category must include "SDOH" and "Survey"

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified through automated validation of Observation resource content to check for the presence of required category codes.

### Complexity
**Simple** - The requirement involves straightforward validation of specific coded values within the Observation.category element.

### Prerequisites
- System must support US Core Observation profiles as defined in the Capability Statement
- System must have Observation resources available for testing
- Test data should include Observation resources that are expected to conform to PRAPARE item requirements

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources from the system under test
- **Expected Resource Profiles**: Any US Core Observation profile that should contain SDOH survey data (particularly those related to screening assessments)
- **Test Scope**: Observation resources that are specifically related to PRAPARE (Protocol for Responding to and Assessing Patients' Assets, Risks, and Experiences) items or similar SDOH survey instruments

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for Observation resources:
- **GET /Observation** - Retrieve Observation resources using supported search parameters
- **GET /Observation?category=survey** - Search for survey-type observations
- **GET /Observation?patient={patient-id}&category=survey** - Patient-specific survey observations
- **GET /Observation/{observation-id}** - Retrieve specific Observation resources by ID

### Validation Criteria

#### Primary Assertions
1. **Category Array Validation**: Each tested Observation resource SHALL contain a `category` array
2. **SDOH Category Presence**: The `category` array SHALL contain at least one CodeableConcept with a coding that represents "SDOH" (Social Determinants of Health)
3. **Survey Category Presence**: The `category` array SHALL contain at least one CodeableConcept with a coding that represents "Survey"

#### Specific Validation Steps
1. **Retrieve Test Data**:
   - Query the system for Observation resources using available search parameters
   - Focus on observations that are likely to be SDOH-related (e.g., screening assessments)

2. **Category Structure Validation**:
   - Verify that each Observation has a `category` element
   - Confirm that `category` is an array of CodeableConcept elements
   - Validate that each CodeableConcept contains appropriate coding elements

3. **SDOH Category Validation**:
   - Check for presence of SDOH-related category codes, such as:
     - Code system: `http://terminology.hl7.org/CodeSystem/observation-category`
     - Expected codes: `sdoh` or similar SDOH-related categorization
   - Alternative code systems and codes that represent Social Determinants of Health concepts should also be accepted

4. **Survey Category Validation**:
   - Check for presence of Survey-related category codes, such as:
     - Code system: `http://terminology.hl7.org/CodeSystem/observation-category`
     - Expected codes: `survey`
   - Alternative code systems and codes that represent survey/questionnaire concepts should also be accepted

#### Success Criteria
- **Pass**: All tested Observation resources contain both "SDOH" and "Survey" categories (or equivalent codes from appropriate code systems)
- **Fail**: Any tested Observation resource is missing either the "SDOH" category, "Survey" category, or both

#### Test Execution Notes
- The test should accommodate different coding systems that may be used to represent SDOH and Survey categories
- The test should validate the semantic meaning of the categories rather than requiring exact code matches
- Consider that some systems may use local code systems or extensions, provided the semantic meaning aligns with SDOH and Survey concepts
- Document any specific code systems and codes found during testing to ensure consistency and support interoperability verification

---

<a id='req-111'></a>

### REQ-111: Observation SHALL include a status of "Final".

**Text**: 

**Context**: 

**Actor**: Observation

**Conformance**: SHALL

# Test Specification for REQ-111

## 1. Requirement ID
**REQ-111**

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified programmatically by examining the `status` field value in Observation resources.

### Complexity
**Simple** - The test involves a straightforward field value check against a specific required value.

### Prerequisites
- System must support US Core Observation profiles as specified in the Capability Statement
- System must have Observation resources available for testing
- System must support FHIR R4 Observation resource structure
- Test client must have appropriate access permissions to read Observation resources

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: One or more Observation resources that conform to any of the US Core Observation profiles listed in the Capability Statement:
  - US Core Laboratory Result Observation Profile
  - US Core Vital Signs Profile
  - US Core Simple Observation Profile
  - US Core Observation Clinical Result Profile
  - US Core Observation Screening Assessment Profile
  - Any other US Core Observation profiles supported by the system
- **Resource Identification**: Valid Observation resource IDs or search parameters to locate Observation resources

### Expected Outputs
- Observation resources with `status` field set to "final"
- HTTP 200 response codes for successful resource retrieval
- Valid FHIR-compliant Observation resources in response payloads

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and can be used for testing:

1. **Direct Resource Read**:
   ```
   GET [base]/Observation/[id]
   ```

2. **Search Operations** (any of the supported combinations):
   ```
   GET [base]/Observation?patient=[patient-id]&category=[category]
   GET [base]/Observation?patient=[patient-id]&code=[code]
   GET [base]/Observation?patient=[patient-id]&category=[category]&date=[date]
   ```

### Validation Criteria

#### Primary Assertion
- **Status Field Validation**: Each retrieved Observation resource MUST contain a `status` field with the value "final"
  - Field path: `Observation.status`
  - Expected value: "final" (case-sensitive)
  - Requirement level: SHALL (mandatory)

#### Supporting Validations
1. **Resource Structure Validation**: 
   - Verify that retrieved resources are valid FHIR Observation resources
   - Confirm resources conform to applicable US Core Observation profiles

2. **Field Presence Validation**:
   - Verify that the `status` field is present (not null or missing)
   - Confirm the field contains a valid ObservationStatus code

3. **HTTP Response Validation**:
   - Verify successful HTTP response codes (200 OK for reads, 200/201 for searches)
   - Confirm proper FHIR content-type headers

#### Test Execution Steps
1. **Resource Discovery**: Use supported search operations or direct resource IDs to identify available Observation resources
2. **Resource Retrieval**: Fetch Observation resources using supported FHIR operations
3. **Status Validation**: For each retrieved Observation resource:
   - Extract the `status` field value
   - Assert that the value equals "final"
   - Log any non-conformant resources for reporting
4. **Results Compilation**: Generate test report indicating pass/fail status for the requirement

#### Pass Criteria
- **All** retrieved Observation resources must have `status` = "final"
- No exceptions or alternative status values are permitted per the SHALL conformance level

#### Fail Criteria
- Any Observation resource with a `status` value other than "final"
- Missing `status` field in any Observation resource
- Invalid or malformed `status` field values

---

<a id='req-112'></a>

### REQ-112: Observation SHALL specify the category as "SDOH, Survey".

**Text**: 

**Context**: 

**Actor**: Observation

**Conformance**: SHALL

# Test Specification for REQ-112

## Requirement ID
REQ-112

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated through automated testing by examining the `category` field in Observation resources to verify it contains the specified values "SDOH" and "Survey".

### Complexity
**Simple** - The requirement involves checking for the presence of specific category values in a well-defined FHIR element.

### Prerequisites
- System under test must implement US Core Server capabilities for Observation resources
- System must support at least one of the US Core Observation profiles listed in the capability statement
- Test data must include Observation resources that claim conformance to PRAPARE-related profiles
- System must support RESTful read operations for Observation resources

## Test Implementation Strategy

### Required Inputs
**Required FHIR Resources:**
- Observation resources that are expected to conform to PRAPARE item example requirements
- Resources should represent Social Determinants of Health (SDOH) survey data

**Expected Outputs:**
- Observation resources with `category` field containing both "SDOH" and "Survey" category codes
- Validation results indicating conformance or non-conformance with the requirement

### Required FHIR Operations
Based on the capability statement, the following supported operations will be used:
- `GET [base]/Observation/[id]` - Read specific Observation resources
- `GET [base]/Observation?patient=[patient-id]&category=survey` - Search for Observations by patient and category (if testing with patient context)
- `GET [base]/Observation?category=survey` - Search for survey-type Observations

### Validation Criteria

**Primary Assertion:**
For each Observation resource under test, verify that:
1. The `Observation.category` array contains at least two CodeableConcept entries
2. One CodeableConcept represents "SDOH" category:
   - Should contain appropriate SDOH coding system and code
   - Common systems include LOINC or custom SDOH taxonomies
3. One CodeableConcept represents "Survey" category:
   - Should contain coding from http://terminology.hl7.org/CodeSystem/observation-category
   - Code should be "survey"

**Specific Validation Steps:**
1. **Category Array Validation:**
   - `Observation.category` is present and is an array
   - Array contains at least two elements

2. **SDOH Category Validation:**
   - At least one `category` entry has a coding that represents SDOH
   - Verify the coding system and code value are appropriate for SDOH classification

3. **Survey Category Validation:**
   - At least one `category` entry contains:
     - `system`: "http://terminology.hl7.org/CodeSystem/observation-category"
     - `code`: "survey"

**Test Pass Criteria:**
- All Observation resources claiming PRAPARE conformance have both required category values
- Categories are properly coded using appropriate terminology systems
- The requirement conformance level (SHALL) is satisfied for all tested resources

**Test Fail Criteria:**
- Any Observation resource is missing either "SDOH" or "Survey" category
- Categories are present but improperly coded
- Category array is empty or missing entirely

---

<a id='req-113'></a>

### REQ-113: Observation SHALL specify the code as "Housing status".

**Text**: 

**Context**: 

**Actor**: Observation

**Conformance**: SHALL

# Test Specification for REQ-113

## 1. Requirement ID
**REQ-113**

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified programmatically by examining the `code` element of Observation resources to ensure it contains the specific code for "Housing status".

### Complexity
**Simple** - This is a straightforward validation of a single code element within an Observation resource.

### Prerequisites
- FHIR server implementing US Core Observation profiles
- Observation resources containing housing status data
- Access to retrieve Observation resources via FHIR API
- Knowledge of the expected code for "Housing status" (likely LOINC code 71802-3 based on the source reference)

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources that represent housing status information
- **Expected Code**: The specific code that represents "Housing status" (LOINC 71802-3 "Housing status" based on the source reference)
- **Code System**: LOINC (http://loinc.org)

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for Observation resources:
- **GET [base]/Observation/[id]** - Retrieve specific Observation by ID
- **GET [base]/Observation?patient=[patient-id]** - Search for Observations by patient
- **GET [base]/Observation?patient=[patient-id]&code=[code]** - Search for Observations by patient and code
- **GET [base]/Observation?patient=[patient-id]&category=[category]** - Search for Observations by patient and category

### Validation Criteria

#### Primary Validation
For each Observation resource that represents housing status:

1. **Code Presence Validation**:
   - Verify that `Observation.code` element is present
   - Assert that `Observation.code` is not null or empty

2. **Housing Status Code Validation**:
   - Verify that `Observation.code.coding` contains at least one coding with:
     - `system` = "http://loinc.org"
     - `code` = "71802-3"
   - OR verify that `Observation.code.text` contains "Housing status" if coded values are not available

3. **Code System Validation**:
   - If coded, verify the code system URI is correctly specified as "http://loinc.org"

#### Test Scenarios

**Scenario 1: Direct Resource Retrieval**
- Retrieve housing status Observation resources directly by ID
- Validate each resource meets the code requirements

**Scenario 2: Patient-based Search**
- Search for all Observations for a given patient
- Filter results to identify housing status observations
- Validate that identified housing status observations contain the correct code

**Scenario 3: Code-based Search**
- Search for Observations using the housing status code (71802-3)
- Verify returned resources actually contain the specified code
- Confirm search results are consistent with code requirements

#### Success Criteria
- **PASS**: All housing status Observation resources contain `Observation.code` with either:
  - A LOINC coding with code "71802-3" and system "http://loinc.org", OR
  - Text description that clearly indicates "Housing status"
  
- **FAIL**: Any housing status Observation resource lacks the required code specification or contains incorrect/missing code values

#### Additional Validation Considerations
- Verify that the code is specified at the appropriate level (not just in components)
- Check for consistency across multiple housing status observations for the same patient
- Validate that the code aligns with any category classifications if present
- Ensure the observation conforms to the applicable US Core Observation profile requirements

### Test Data Requirements
- Test should work with any legitimate housing status Observation data
- No specific fixture data required - test accommodates "bring your own data" approach
- Test should identify housing status observations through code matching rather than relying on predetermined resource IDs

---

<a id='req-114'></a>

### REQ-114: Observation SHALL include an effective date.

**Text**: 

**Context**: 

**Actor**: Observation

**Conformance**: SHALL

# Test Specification for REQ-114

## Requirement ID
REQ-114

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated validation by checking for the presence of an effective date element in Observation resources.

### Complexity
**Simple** - The requirement is straightforward: verify that an Observation resource contains an effective date element.

### Prerequisites
- System under test must support US Core Observation profiles as specified in the Capability Statement
- Test data must include Observation resources
- System must support FHIR R4 specification

## Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources conforming to any of the supported US Core Observation profiles listed in the Capability Statement:
  - US Core Laboratory Result Observation Profile
  - US Core Vital Signs Profile
  - US Core Simple Observation Profile
  - US Core Observation Clinical Result Profile
  - US Core Observation Screening Assessment Profile
  - Any other US Core Observation profiles supported by the system
- **Test Data**: Any existing Observation resources in the system under test (following "bring your own data" approach)

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and should be used for testing:

1. **READ Operation**: `GET [base]/Observation/[id]`
   - Retrieve individual Observation resources by ID
   - Conformance: SHALL support

2. **SEARCH Operation**: `GET [base]/Observation?[search-parameters]`
   - Search for Observation resources using supported search parameters
   - Conformance: SHALL support
   - Relevant search parameter combinations from Capability Statement:
     - `patient + category`
     - `patient + code`
     - `patient + category + date`

### Validation Criteria

#### Primary Validation
For each Observation resource tested, verify that **at least one** of the following effective date elements is present and populated:

1. **Observation.effectiveDateTime** - Single point in time
2. **Observation.effectivePeriod** - Time period with start and/or end
3. **Observation.effectiveTiming** - Complex timing specification
4. **Observation.effectiveInstant** - Precise timestamp

#### Test Cases

**Test Case 1: Direct Resource Retrieval**
- Use READ operation to retrieve Observation resources by ID
- For each retrieved Observation:
  - Assert that one of the effective[x] elements (effectiveDateTime, effectivePeriod, effectiveTiming, or effectiveInstant) is present
  - Assert that the present effective[x] element contains a valid, non-empty value
  - Verify the value conforms to the appropriate FHIR data type (dateTime, Period, Timing, or instant)

**Test Case 2: Search-Based Validation**
- Use SEARCH operations with supported parameters to retrieve Observation resources
- Apply the same validation criteria as Test Case 1 to all returned resources
- Recommended search patterns:
  - Search by patient and category: `GET [base]/Observation?patient=[id]&category=[code]`
  - Search by patient and code: `GET [base]/Observation?patient=[id]&code=[code]`

#### Success Criteria
- **Pass**: All tested Observation resources contain at least one populated effective date element
- **Fail**: Any Observation resource lacks all effective date elements or contains only empty/null values
- **Not Applicable**: No Observation resources available for testing

#### Additional Considerations
- The test should accommodate any US Core Observation profile variant
- The test should handle both contained and referenced resources appropriately
- The validation should account for different date/time formats as specified in FHIR R4
- Systems that support `Observation.effectivePeriod` should be recognized as conformant even if they don't use `effectiveDateTime`

---

<a id='req-115'></a>

### REQ-115: Observation SHALL include a derivedFrom reference.

**Text**: 

**Context**: 

**Actor**: Observation

**Conformance**: SHALL

# Test Specification for REQ-115

## 1. Requirement ID
**REQ-115**

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated validation of FHIR resource structure and content.

### Complexity
**Simple** - The requirement involves checking for the presence of a single element (`derivedFrom`) in Observation resources.

### Prerequisites
- System must support US Core Observation profiles as indicated in the Capability Statement
- System must have Observation resources available for testing
- System must support FHIR RESTful read and search operations for Observation resources

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources that conform to any of the US Core Observation profiles listed in the Capability Statement
- **Test Data**: Any existing Observation resources in the system under test (following "bring your own data" approach)

### Required FHIR Operations
Based on the Capability Statement, the following supported operations will be used:

1. **Search Operations**:
   - `GET [base]/Observation?patient=[patient-id]` - Search for Observations by patient
   - `GET [base]/Observation?patient=[patient-id]&category=[category]` - Search with category filter
   - `GET [base]/Observation?patient=[patient-id]&code=[code]` - Search with code filter

2. **Read Operations**:
   - `GET [base]/Observation/[id]` - Direct read of specific Observation resources

### Expected Outputs
- FHIR Observation resources in JSON format (SHALL support) or XML format (SHOULD support)
- Resources should include the `derivedFrom` element with valid reference values

### Validation Criteria

#### Primary Validation Checks
1. **Presence Check**: Every retrieved Observation resource MUST contain a `derivedFrom` element
2. **Cardinality Check**: The `derivedFrom` element must have at least one reference (minimum cardinality of 1)
3. **Reference Validity**: Each `derivedFrom` reference must:
   - Follow valid FHIR Reference format
   - Point to a valid FHIR resource type
   - Contain either a valid resource ID or a valid absolute URL

#### Test Execution Steps
1. **Discovery Phase**:
   - Query the system for available Observation resources using patient-based searches
   - Identify a representative sample of Observation resources across different US Core Observation profiles

2. **Validation Phase**:
   - For each retrieved Observation resource:
     - Verify `derivedFrom` element exists in the resource JSON/XML
     - Validate that `derivedFrom` contains at least one reference
     - Check reference format compliance with FHIR specification
     - Ensure reference values are not empty or null

3. **Assertion Criteria**:
   - **PASS**: All tested Observation resources contain a valid `derivedFrom` reference
   - **FAIL**: Any Observation resource lacks the `derivedFrom` element or contains invalid reference values
   - **SKIP**: No Observation resources available for testing

#### Profile-Specific Considerations
Given the multiple US Core Observation profiles listed in the Capability Statement, the test should validate `derivedFrom` presence across:
- Laboratory Result Observations
- Vital Signs Observations  
- Clinical Result Observations
- Screening Assessment Observations
- Any other US Core Observation profile variants present in the system

#### Error Handling
- Document any HTTP errors encountered during resource retrieval
- Handle cases where referenced resources in `derivedFrom` may not be accessible
- Report on any profile-specific variations in `derivedFrom` implementation

---

<a id='req-116'></a>

### REQ-116: Observation SHALL specify the category as "Survey, Disability Status".

**Text**: 

**Context**: 

**Actor**: Observation

**Conformance**: SHALL

# Test Specification for REQ-116

## Requirement ID
REQ-116

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement specifies a concrete data validation rule that can be programmatically verified by examining the `category` field of Observation resources.

### Complexity
**Simple** - This is a straightforward field validation requirement that checks for a specific category value in Observation resources.

### Prerequisites
- System under test must support US Core Observation profiles as indicated in the Capability Statement
- Test system must have access to Observation resources that are intended to represent PHQ-9 survey items or similar disability status assessments
- System must support FHIR R4 Observation resource structure

## Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources that represent survey items related to disability status (e.g., PHQ-9 questionnaire responses)
- **Test Data**: Any existing Observation resources in the system that should conform to this requirement based on their clinical context
- **Expected Resource Types**: Observation resources with survey-based disability status assessments

### Required FHIR Operations
Based on the Capability Statement, the following supported operations will be used:
- **GET /Observation**: Retrieve Observation resources for testing
- **GET /Observation?category={category}**: Search for observations by category (supported search parameter)
- **GET /Observation?patient={patient}&category={category}**: Patient-scoped category search (supported combination)

### Validation Criteria

#### Primary Assertion
For each Observation resource that represents a survey-based disability status assessment:
1. **Category Presence Check**: Verify that the `Observation.category` field is present and populated
2. **Category Value Validation**: Verify that at least one category entry contains:
   - `coding.system` = "http://terminology.hl7.org/CodeSystem/observation-category"
   - `coding.code` = "survey"
   - `coding.display` = "Survey" (or equivalent)
3. **Additional Category Check**: Verify that the categories include disability status representation (this may require checking for specific LOINC codes or other relevant coding systems that indicate disability status assessment)

#### Secondary Validations
1. **FHIR Compliance**: Verify that the category field follows proper FHIR CodeableConcept structure
2. **Cardinality**: Confirm that the category field meets FHIR cardinality requirements (0..* for Observation.category)

#### Test Case Structure
**For each relevant Observation resource:**

```
GIVEN an Observation resource representing a survey-based disability status assessment
WHEN the Observation.category field is examined
THEN it SHALL contain at least one category with:
  - system: "http://terminology.hl7.org/CodeSystem/observation-category"
  - code: "survey"
AND the observation SHALL represent disability status information
```

#### Pass Criteria
- All identified survey-based disability status Observation resources contain the required "survey" category
- Category fields are properly structured as FHIR CodeableConcept elements
- No survey-based disability status observations are missing the required category

#### Fail Criteria
- Any survey-based disability status Observation resource lacks the "survey" category
- Category fields are malformed or use incorrect coding systems
- Required category information is missing or incomplete

#### Implementation Notes
1. **Scope Identification**: Test implementations should identify which Observation resources are intended to represent survey-based disability status assessments (e.g., through LOINC codes, resource context, or other clinical indicators)
2. **Bring Your Own Data**: This test works with any existing Observation data that represents survey-based disability assessments, without requiring specific test fixtures
3. **Category Flexibility**: While "survey" category is required, additional categories may also be present and should not cause test failure

---

<a id='req-117'></a>

### REQ-117: Observation SHALL specify the code as "Moving or speaking so slowly...".

**Text**: 

**Context**: 

**Actor**: Observation

**Conformance**: SHALL

# Test Specification for REQ-117

## 1. Requirement ID
REQ-117

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be automatically verified by examining the Observation resource's code element and validating it contains the specified text "Moving or speaking so slowly...". This is a structural validation that can be programmatically checked.

### Complexity
**Simple** - The requirement involves validating a single code field within an Observation resource against a specific text criterion. This is a straightforward string/code validation task.

### Prerequisites
- Access to Observation resources that represent PHQ-9 questionnaire items
- System must support US Core Server capabilities for Observation resource operations
- Test system must be able to read and validate Observation resources
- Understanding that this relates to PHQ-9 item 44253-3 (psychomotor retardation assessment)

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Observation resources representing PHQ-9 questionnaire responses
- Specifically, Observation resources that should contain the code for "Moving or speaking so slowly..."

**Expected Outputs:**
- Validation results confirming the presence and correctness of the specified code text
- Pass/fail status for each tested Observation resource

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are supported and may be used:

1. **GET /Observation/{id}** - Retrieve specific Observation resources by ID
2. **GET /Observation** - Search for Observation resources using search parameters
3. **Search Parameters** (as supported by US Core):
   - `category` - to filter for survey/questionnaire observations
   - `code` - to search for specific LOINC codes
   - `patient` - to scope observations to specific patients
   - `date` - to filter by observation date

### Validation Criteria

**Primary Validation:**
1. **Code Presence Check**: Verify that the Observation resource contains a `code` element
2. **Code Text Validation**: Confirm that the code element contains the exact text "Moving or speaking so slowly..." in either:
   - `code.coding[].display` field
   - `code.text` field
   - As part of the code system's definition when the appropriate LOINC code is used

**Specific Assertions for Test Passing:**
- **ASSERTION 1**: `Observation.code` element must be present and populated
- **ASSERTION 2**: The code must reference the concept for "Moving or speaking so slowly..." through one of these methods:
  - Direct text match in `code.text` containing "Moving or speaking so slowly"
  - LOINC code with display text containing "Moving or speaking so slowly"
  - Coding display that includes "Moving or speaking so slowly"

**Test Cases:**
1. **Positive Test**: Observation resources with correctly specified "Moving or speaking so slowly..." code should pass validation
2. **Negative Test**: Observation resources missing this code or with incorrect code text should fail validation
3. **Edge Case Test**: Observation resources with partial matches or similar but incorrect text should fail validation

**Success Criteria:**
- All PHQ-9 psychomotor retardation item Observations (44253-3) must contain the specified text
- The validation must be case-sensitive and require exact text matching
- The test must work regardless of the specific patient data or observation values used

**Implementation Notes:**
- The test should accommodate different ways the text might be represented in FHIR (coding.display, code.text, etc.)
- The test should be data-agnostic and work with any conformant PHQ-9 Observation data
- Consider that the requirement may apply to a specific LOINC code (44253-3) based on the source context

---

<a id='req-118'></a>

### REQ-118: Observation SHALL include a category of "Laboratory"

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-118

## 1. Requirement ID
REQ-118

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified programmatically by examining the `category` element of Observation resources to confirm the presence of a "Laboratory" category code.

### Complexity
**Simple** - The test involves a straightforward validation of a single element (`Observation.category`) against a specific value.

### Prerequisites
- System must support US Core Laboratory Result Observation Profile
- System must have laboratory observation data available for testing
- System must support FHIR R4 Observation resource operations as defined in the US Core Server Capability Statement

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources that represent laboratory results
- **Test Data**: Laboratory observations with serum calcium measurements (based on the source context)
- **System Configuration**: US Core compliant FHIR server with Observation resource support

### Expected Outputs
- All laboratory Observation resources must contain `category` element with a coding that indicates "Laboratory"
- Category coding should use appropriate code system (typically `http://terminology.hl7.org/CodeSystem/observation-category`)

### Required FHIR Operations
Based on the US Core Server Capability Statement, the following operations are supported and can be used for testing:

1. **READ Operation**: `GET [base]/Observation/[id]`
2. **SEARCH Operations**:
   - `GET [base]/Observation?patient=[patient-id]&category=laboratory`
   - `GET [base]/Observation?patient=[patient-id]&code=[lab-code]`
   - `GET [base]/Observation?patient=[patient-id]&category=[category-code]`

### Validation Criteria

#### Primary Validation
1. **Category Element Presence**: Each laboratory Observation resource SHALL contain at least one `Observation.category` element
2. **Laboratory Category Value**: At least one `category` element SHALL contain a coding with:
   - `code`: "laboratory" 
   - `system`: "http://terminology.hl7.org/CodeSystem/observation-category"
   - OR equivalent coding that represents laboratory category per US Core Laboratory Result Observation Profile

#### Test Cases

**Test Case 1: Individual Observation Validation**
- Retrieve individual Observation resources using READ operation
- For each Observation that represents a laboratory result:
  - Verify `category` array is not empty
  - Verify at least one category coding has code "laboratory"
  - Verify appropriate code system is used

**Test Case 2: Search-based Validation**
- Execute search: `GET [base]/Observation?patient=[id]&category=laboratory`
- For each returned Observation:
  - Verify the resource contains the laboratory category as expected
  - Confirm the category element structure is valid per FHIR specification

**Test Case 3: Cross-validation with Profile**
- Validate that laboratory Observations conform to US Core Laboratory Result Observation Profile
- Ensure category requirements align with profile constraints
- Verify any additional category codes (beyond laboratory) are also valid

#### Acceptance Criteria
- **PASS**: All laboratory Observation resources contain required laboratory category coding
- **FAIL**: Any laboratory Observation resource lacks the required laboratory category coding
- **CONDITIONAL**: If no laboratory observations exist in the system, the test should be marked as not applicable rather than failed

#### Error Handling
- Handle cases where Observation resources may have multiple categories (ensure laboratory is present among them)
- Account for different code system representations that may be equivalent to the standard laboratory category
- Validate that the category coding structure follows FHIR specification (system, code, display elements)

---

<a id='req-119'></a>

### REQ-119: Observation category must be set to "Survey"

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-119

## 1. Requirement ID
**REQ-119**: Observation category must be set to "Survey"

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated validation by examining the `category` field in Observation resources to confirm it contains the required "Survey" value.

### Complexity
**Simple** - This is a straightforward field validation check requiring examination of a single element within an Observation resource.

### Prerequisites
- Test system must have access to Observation resources that are expected to conform to this requirement
- The specific context where this requirement applies must be understood (appears to be related to EVS panel examples based on the source)
- Test system must support FHIR Observation resource queries as specified in the Capability Statement

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources that should conform to the survey category requirement
- **Test Data**: Any Observation resources provided by the system under test that are expected to have "Survey" category
- **Context Filter**: Ability to identify which Observation resources should conform to this requirement (likely those related to EVS panels or survey-based observations)

### Expected Outputs
- **Pass**: All applicable Observation resources contain `category` with coding system and code that represents "Survey"
- **Fail**: One or more applicable Observation resources either:
  - Lack a `category` element
  - Have `category` element but without "Survey" classification
  - Have malformed `category` element

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required for testing:

1. **Observation Search Operations**:
   - `GET [base]/Observation?patient={patient-id}` - Retrieve observations for specific patients
   - `GET [base]/Observation?category=survey` - Search for observations by category (if supported)
   - `GET [base]/Observation/{id}` - Retrieve specific observation resources

2. **Supported Search Parameters** (from Capability Statement):
   - `category` - Filter observations by category
   - `patient` - Filter observations by patient
   - `patient+category` - Combined search parameters

### Validation Criteria

#### Primary Validation Checks:
1. **Category Element Presence**: Verify that each applicable Observation resource contains a `category` element
2. **Survey Category Value**: Confirm that the `category` element includes a coding that represents "Survey"
3. **Category Structure Validation**: Ensure the `category` element follows proper FHIR structure:
   - Contains `coding` array
   - Coding entries have appropriate `system` and `code` values
   - One of the codings represents "Survey" concept

#### Specific Assertions:
- `Observation.category` element exists and is not empty
- `Observation.category.coding` contains at least one entry
- At least one `Observation.category.coding` entry has:
  - A `code` value that represents "Survey" (e.g., "survey")
  - Appropriate `system` URI (e.g., "http://terminology.hl7.org/CodeSystem/observation-category")

#### Test Execution Approach:
1. **Resource Discovery**: Use supported search parameters to identify Observation resources that should comply with this requirement
2. **Iterative Validation**: For each identified Observation resource, perform the validation criteria checks
3. **Result Aggregation**: Compile results showing which resources pass/fail and specific failure reasons

#### Pass/Fail Criteria:
- **PASS**: 100% of applicable Observation resources have properly structured `category` element with "Survey" classification
- **FAIL**: Any applicable Observation resource lacks the required "Survey" category or has malformed category structure

#### Error Handling:
- Document any resources that cannot be retrieved or parsed
- Handle cases where category element exists but is malformed
- Report on any system errors encountered during resource retrieval

---

<a id='req-120'></a>

### REQ-120: Observation code must be "Exercise Vital Sign (EVS)"

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-120

## 1. Requirement ID
**REQ-120**: Observation code must be "Exercise Vital Sign (EVS)"

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be validated programmatically by examining the Observation resource's code element to verify it contains the specific "Exercise Vital Sign (EVS)" code.

### Complexity
**Simple** - This is a straightforward validation of a single code value within an Observation resource.

### Prerequisites
- System must support US Core Server CapabilityStatement
- System must be able to create/store Observation resources
- Test data must include Observation resources that claim to be Exercise Vital Sign observations
- Access to FHIR R4 server supporting US Core Observation profiles

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- One or more Observation resources that are intended to represent Exercise Vital Sign (EVS) observations
- Resources should be provided by the testing organization using their own data

**Expected Outputs:**
- Validation results indicating whether each Observation resource contains the correct EVS code
- Clear pass/fail status for each tested Observation

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are supported and may be used:

1. **GET /Observation/{id}** - Retrieve specific Observation resources for validation
2. **GET /Observation?patient={patient}&category={category}** - Search for Observations by patient and category to identify EVS observations
3. **GET /Observation?patient={patient}&code={code}** - Search for Observations by patient and specific code

### Validation Criteria

**Primary Assertions:**
1. **Code Presence Validation**: Each Observation resource must have a `code` element present
2. **EVS Code Validation**: The Observation.code must contain a coding that represents "Exercise Vital Sign (EVS)"
3. **Code System Validation**: Verify that the coding uses an appropriate code system (likely LOINC)

**Specific Validation Steps:**

1. **Extract Code Element**: 
   - Verify `Observation.code` exists and is not empty
   - Extract all codings within the code element

2. **EVS Code Verification**:
   - Check if any coding within `Observation.code.coding[]` has:
     - A display value matching "Exercise Vital Sign (EVS)" (case-insensitive), OR
     - A code value that corresponds to Exercise Vital Sign in the appropriate terminology system
   - Common expected patterns might include:
     - LOINC codes related to exercise vital signs
     - Display text containing "Exercise Vital Sign" or "EVS"

3. **Code System Validation**:
   - Verify that at least one coding references a recognized terminology system
   - Ensure the system URI is properly formatted

**Pass Criteria:**
- All tested Observation resources contain appropriate Exercise Vital Sign coding in their code element
- Code element is properly structured according to FHIR R4 specifications
- At least one coding clearly identifies the observation as an Exercise Vital Sign

**Fail Criteria:**
- Any Observation resource lacks a code element
- Code element exists but contains no codings that identify it as an Exercise Vital Sign
- Code element is malformed or references invalid code systems

**Test Execution Approach:**
1. Identify candidate Observation resources from the test dataset
2. For each Observation, extract and validate the code element
3. Apply the validation criteria systematically
4. Generate detailed results showing which resources pass/fail and why
5. Provide summary statistics and any recommendations for remediation

**Additional Considerations:**
- The test should accommodate variations in how Exercise Vital Sign may be coded across different systems
- Consider both exact matches and semantic equivalence when validating codes
- Document any assumptions made about acceptable code values or systems

---

<a id='req-124'></a>

### REQ-124: Observation status must be set to "Final"

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-124

## 1. Requirement ID
**REQ-124**: Observation status must be set to "Final"

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be programmatically verified by inspecting the `status` field of Observation resources to confirm it contains the value "final".

### Complexity
**Simple** - This is a straightforward field validation check requiring examination of a single data element within Observation resources.

### Prerequisites
- System must support US Core Observation profiles as indicated in the Capability Statement
- Test system must have access to Observation resources (either existing data or ability to create/retrieve Observations)
- System must support JSON format (required per Capability Statement)
- Proper authentication/authorization must be established for API access

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources that claim conformance to US Core profiles, specifically those related to serum glucose measurements based on the source context
- **System Access**: Authenticated access to the FHIR server implementing US Core Server capabilities
- **Data Scope**: Any existing Observation resources in the system that should conform to this requirement

### Required FHIR Operations
Based on the US Core Server Capability Statement, the following operations are supported and can be used for testing:

1. **GET /Observation/{id}** - Retrieve specific Observation resources by ID
2. **GET /Observation?[search-parameters]** - Search for Observation resources using supported search parameters
3. **GET /metadata** - Verify server capabilities and supported profiles

### Validation Criteria

#### Primary Validation
1. **Status Field Validation**:
   - Assert that `Observation.status` field exists
   - Assert that `Observation.status` value equals "final"
   - Verify the status value is from the required FHIR ValueSet for observation-status

#### Secondary Validations
2. **Profile Conformance**:
   - Verify that Observations claiming US Core profile conformance (via `meta.profile`) include the required status
   - Confirm the Observation resource validates against the declared US Core profile

3. **Data Integrity**:
   - Ensure the status field is consistently "final" across all retrieved Observation resources
   - Validate that the JSON response structure is well-formed

#### Test Execution Steps
1. **Discovery Phase**:
   - Query the server's CapabilityStatement to confirm Observation resource support
   - Identify available Observation resources in the test dataset

2. **Validation Phase**:
   - Retrieve Observation resources using supported search operations
   - For each Observation resource:
     - Extract the `status` field value
     - Assert the value equals "final"
     - Log any non-conformant instances

3. **Reporting Phase**:
   - Document conformance rate (percentage of Observations with status="final")
   - Report any instances where status is not "final"
   - Verify 100% conformance for passing result

#### Expected Results for Test Pass
- **All** Observation resources must have `status` field set to "final"
- No Observation resources should have status values of "registered", "preliminary", "cancelled", "entered-in-error", "unknown", or any other non-final status
- Server responses must return HTTP 200 for successful retrievals
- JSON responses must be valid and parseable

#### Failure Conditions
- Any Observation resource with `status` field missing
- Any Observation resource with `status` field set to value other than "final"
- Server errors (HTTP 4xx/5xx) that prevent validation of the requirement
- Invalid JSON responses that cannot be parsed

---

<a id='req-125'></a>

### REQ-125: Observation category must be "Laboratory"

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-125

## 1. Requirement ID
**REQ-125**: Observation category must be "Laboratory"

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated programmatically by examining the `category` element of Observation resources to verify it contains the "Laboratory" category.

### Complexity
**Simple** - This is a straightforward validation of a single element value within Observation resources.

### Prerequisites
- System must support US Core Observation profiles, specifically:
  - US Core Laboratory Result Observation Profile
  - Other relevant US Core Observation profiles that may contain laboratory results
- System must have laboratory Observation data available for testing
- System must support Observation search operations as defined in the Capability Statement

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources that represent laboratory results
- **Test Data**: System's existing laboratory Observation data (bring your own data approach)
- **Search Parameters**: Patient references to retrieve relevant Observations

### Required FHIR Operations
Based on the Capability Statement, the following operations are required:

1. **Search Operations**:
   - `GET [base]/Observation?patient=[patient-id]&category=laboratory` - Search for laboratory observations
   - `GET [base]/Observation?patient=[patient-id]&category=http://terminology.hl7.org/CodeSystem/observation-category|laboratory` - Search with full system URI
   - `GET [base]/Observation/[observation-id]` - Read specific Observation resources

2. **Search Parameter Combinations** (as supported per Capability Statement):
   - `patient+category` (SHALL support)
   - `patient+category+date` (SHALL support)
   - `patient+category+status` (SHOULD support)

### Validation Criteria

The test shall verify the following assertions for each Observation resource identified as a laboratory result:

1. **Category Presence Check**:
   - Verify that `Observation.category` element exists
   - Verify that the category array is not empty

2. **Laboratory Category Validation**:
   - Verify that at least one `Observation.category.coding` contains:
     - `system`: `http://terminology.hl7.org/CodeSystem/observation-category`
     - `code`: `laboratory`
   - Alternative acceptable formats:
     - Code-only search parameter should match `laboratory`
     - System and code combination should match the full URI format

3. **Search Consistency Check**:
   - Verify that Observations returned by category search for "laboratory" all contain the laboratory category
   - Verify that the same Observations are returned whether using code-only (`laboratory`) or system+code format

4. **Profile Conformance**:
   - Verify that laboratory Observations conform to US Core Laboratory Result Observation Profile
   - Validate that other required elements for laboratory observations are present as per the profile

### Test Execution Steps

1. **Discovery Phase**:
   - Identify available patients with laboratory data
   - Perform search: `GET [base]/Observation?patient=[patient-id]&category=laboratory`

2. **Validation Phase**:
   - For each returned Observation:
     - Assert `category` element exists
     - Assert at least one category coding has system `http://terminology.hl7.org/CodeSystem/observation-category` and code `laboratory`
   - Perform additional search with full system URI and verify consistent results

3. **Negative Testing**:
   - Verify that non-laboratory Observations (e.g., vital signs) do not appear in laboratory category searches
   - Confirm that laboratory observations are not returned when searching for other categories

### Expected Test Results

**Pass Criteria**:
- All Observation resources identified as laboratory results contain the required "laboratory" category
- Search operations consistently return the same set of laboratory observations
- Category coding follows the specified terminology system and code values

**Fail Criteria**:
- Any laboratory Observation missing the "laboratory" category
- Inconsistent search results between different category search formats
- Non-laboratory observations appearing in laboratory category searches

---

<a id='req-126'></a>

### REQ-126: Observation code must be "Hematocrit, Blood"

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-126

## Requirement ID
REQ-126

## Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be automatically validated by examining the `code` element of Observation resources to verify they contain the specific "Hematocrit, Blood" code.

### Complexity
**Simple** - The requirement involves a straightforward validation of a single coded element against a specific expected value.

### Prerequisites
- Server must support US Core Laboratory Result Observation Profile (as indicated in Capability Statement)
- Server must have Observation resources with hematocrit measurements available
- Test system must be able to perform FHIR resource retrieval operations
- Server must support the required search parameters for Observation resources as specified in the Capability Statement

## Test Implementation Strategy

### Required Inputs
- **FHIR Resources Needed:**
  - Observation resources representing hematocrit measurements
  - Patient resources (referenced by Observation.subject)
  
- **Test Data Requirements:**
  - At least one Observation resource that should represent a hematocrit measurement
  - The Observation should conform to US Core Laboratory Result Observation Profile
  - Patient identifier or Observation identifier for resource retrieval

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required:

1. **GET [base]/Observation/[id]** - Direct resource retrieval by ID
2. **GET [base]/Observation?patient=[patient-id]&category=laboratory** - Search for laboratory observations by patient
3. **GET [base]/Observation?patient=[patient-id]&code=[hematocrit-code]** - Search for specific coded observations

All operations must include `_revinclude=Provenance:target` support as required by the Capability Statement.

### Validation Criteria

#### Primary Validation
For each Observation resource identified as a hematocrit measurement:

1. **Code Validation:**
   - Verify `Observation.code` contains a coding with:
     - System: `http://loinc.org` 
     - Code: One of the accepted LOINC codes for "Hematocrit, Blood" (e.g., `20570-8`, `4544-3`, `31100-1`)
     - Display: Should match or be equivalent to "Hematocrit, Blood"

2. **Profile Conformance:**
   - Verify the Observation resource conforms to US Core Laboratory Result Observation Profile
   - Validate required elements per the profile are present

3. **Category Validation:**
   - Verify `Observation.category` includes laboratory category code
   - System: `http://terminology.hl7.org/CodeSystem/observation-category`
   - Code: `laboratory`

#### Secondary Validation
1. **Resource Integrity:**
   - Verify `Observation.status` has an appropriate value (final, corrected, etc.)
   - Verify `Observation.subject` references a valid Patient resource
   - Verify required must-support elements are present per US Core profile

2. **Search Functionality:**
   - Verify search by patient + code returns appropriate hematocrit observations
   - Verify search by patient + category=laboratory includes hematocrit observations

#### Test Success Criteria
- **PASS:** All identified hematocrit Observation resources contain the correct LOINC code for "Hematocrit, Blood" in the `Observation.code` element
- **FAIL:** Any hematocrit Observation resource lacks the required "Hematocrit, Blood" code or uses an incorrect/inappropriate code
- **NOT APPLICABLE:** No hematocrit observations are available in the test dataset

#### Error Handling
- Document any Observation resources that appear to represent hematocrit measurements but use non-standard or incorrect codes
- Report any resources that fail US Core Laboratory Result Observation Profile validation
- Note any search operations that fail or return unexpected results

---

<a id='req-127'></a>

### REQ-127: Observation code must be "MCHC"

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-127

## 1. Requirement ID
**REQ-127**: Observation code must be "MCHC"

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified programmatically by examining the Observation resource's code field to confirm it contains "MCHC" as the code value.

### Complexity
**Simple** - The test involves a straightforward validation of a single code field within an Observation resource.

### Prerequisites
- System under test must support US Core Observation profiles
- System must have MCHC (Mean Corpuscular Hemoglobin Concentration) observation data available
- System must support FHIR R4 JSON format (as per capability statement requirements)
- Valid authentication/authorization credentials for API access

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources that represent CBC (Complete Blood Count) MCHC measurements
- **Authentication**: Valid credentials/tokens for system access
- **Expected Code System**: The appropriate code system for MCHC (typically LOINC code "33747-0" or equivalent)

### Required FHIR Operations
Based on the capability statement, the following operations are supported and may be used:

1. **GET /Observation/{id}** - Retrieve specific MCHC observation by ID
2. **GET /Observation?code=[MCHC-code]** - Search for observations with MCHC code (if search is supported)
3. **GET /Observation?patient={patient-id}** - Retrieve patient's observations to identify MCHC entries

### Validation Criteria

#### Primary Validation
1. **Code Field Verification**: 
   - Verify `Observation.code.coding` array contains at least one coding with:
     - Code value representing MCHC (e.g., "33747-0" for LOINC)
     - Display value indicating MCHC or Mean Corpuscular Hemoglobin Concentration
   - Alternative code systems may be acceptable if they represent MCHC

#### Secondary Validations
2. **Resource Structure**: 
   - Confirm the resource is a valid FHIR Observation
   - Verify resource conforms to US Core Observation profile requirements

3. **Code System Consistency**:
   - If code system is specified, verify it's appropriate for laboratory codes (e.g., LOINC)
   - Ensure coding display matches the code meaning for MCHC

#### Test Assertions
- **PASS**: Observation.code contains a coding element with a code value that represents MCHC
- **FAIL**: Observation.code does not contain any coding for MCHC
- **FAIL**: Code field is missing or malformed
- **FAIL**: HTTP error responses (400, 401, 403, 404) indicate system issues

#### Expected Test Results
- All CBC MCHC observations retrieved from the system must have `Observation.code` containing appropriate MCHC coding
- System responds with valid JSON-formatted FHIR Observation resources
- Authentication and authorization work as expected per capability statement security requirements

### Test Execution Notes
- Test should work with any MCHC observation data present in the system ("bring your own data")
- Focus on interoperability conformance rather than clinical accuracy of values
- Verify that the code field correctly identifies the observation as MCHC regardless of the actual measurement values or units

---

<a id='req-128'></a>

### REQ-128: Observation code must be "Glucose, Blood"

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-128

## 1. Requirement ID
**REQ-128**

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified programmatically by examining the `Observation.code` element in returned Observation resources and validating that it contains the specific code for "Glucose, Blood".

### Complexity
**Simple** - The test involves straightforward validation of a single code element against a specific expected value.

### Prerequisites
- System must support US Core Laboratory Result Observation Profile (as indicated by Capability Statement)
- System must have at least one Observation resource with glucose blood measurements
- System must support Observation read and search operations
- Valid patient identifier for testing

## 3. Test Implementation Strategy

### Required Inputs
- **Patient identifier**: A valid patient ID that exists in the system under test
- **Expected glucose code**: The specific code/coding that represents "Glucose, Blood" (typically LOINC code 2345-7 "Glucose [Mass/volume] in Serum or Plasma" or similar glucose blood measurement codes)

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required for testing:

1. **Search Observations by patient and category**:
   ```
   GET [base]/Observation?patient=[patient-id]&category=laboratory
   ```

2. **Search Observations by patient and code**:
   ```
   GET [base]/Observation?patient=[patient-id]&code=[glucose-code]
   ```

3. **Read specific Observation resources**:
   ```
   GET [base]/Observation/[observation-id]
   ```

### Validation Criteria

#### Primary Validation
For each Observation resource that represents a glucose blood measurement:

1. **Code Validation**: Verify that `Observation.code` contains a coding that represents "Glucose, Blood"
   - Check `Observation.code.coding[].code` values
   - Check `Observation.code.coding[].system` to ensure appropriate code system (e.g., LOINC)
   - Verify `Observation.code.coding[].display` contains appropriate display text related to glucose blood measurement

2. **Category Validation**: Confirm that glucose observations have appropriate category
   - Verify `Observation.category` includes laboratory category when applicable

#### Test Scenarios

**Scenario 1: Search and Validate Glucose Observations**
- Execute search for laboratory observations for a test patient
- Filter results for glucose-related observations
- Validate each glucose observation has proper "Glucose, Blood" coding

**Scenario 2: Direct Code Search Validation**
- Search for observations using specific glucose blood codes
- Verify returned observations contain the expected glucose blood codes
- Confirm no observations are returned that don't match glucose blood criteria

**Scenario 3: Resource Read Validation**
- If glucose observation IDs are known, perform direct read operations
- Validate the retrieved resources contain proper glucose blood codes

#### Success Criteria
- All glucose blood observations contain appropriate codes representing "Glucose, Blood"
- Code system is appropriate (typically LOINC for laboratory values)
- Display text accurately represents glucose blood measurements
- No glucose blood observations are missing the required coding

#### Failure Scenarios
- Observation resources representing glucose blood measurements without proper codes
- Incorrect code systems used for glucose blood measurements
- Missing or inappropriate display text for glucose blood codes
- Observations with glucose blood values but coded as different measurement types

---

<a id='req-129'></a>

### REQ-129: Observation value must be expressed in mg/dL

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-129

## 1. Requirement ID
**REQ-129**: Observation value must be expressed in mg/dL

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified programmatically by examining Observation resources to confirm that value quantities use the correct unit of measure (mg/dL).

### Complexity
**Simple** - The test involves straightforward validation of a single field (valueQuantity.unit) against a specific expected value.

### Prerequisites
- System must support US Core Server CapabilityStatement
- System must have Observation resources available for testing
- Test system must be able to retrieve Observation resources via FHIR RESTful operations
- Observations should include serum glucose measurements (based on source context: Observation-serum-glucose.md)

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources containing glucose measurements
- **Search Parameters**: Standard FHIR Observation search parameters to identify relevant observations
- **Expected Outputs**: Observation resources with valueQuantity.unit = "mg/dL"

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are required:
- **GET /Observation** - Retrieve Observation resources
- **GET /Observation/[id]** - Retrieve specific Observation by ID
- **GET /Observation?category=laboratory** - Search for laboratory observations
- **GET /Observation?code=[glucose-code]** - Search for glucose-specific observations using appropriate LOINC codes

### Validation Criteria

#### Primary Assertion
For each Observation resource tested:
1. **Unit Validation**: Verify that `Observation.valueQuantity.unit` equals "mg/dL"
2. **Unit Code Validation**: Verify that `Observation.valueQuantity.code` equals "mg/dL" 
3. **Unit System Validation**: Verify that `Observation.valueQuantity.system` equals "http://unitsofmeasure.org"

#### Test Scenarios

**Scenario 1: Direct Resource Retrieval**
- Retrieve individual Observation resources
- For each resource where the observation represents a glucose measurement:
  - Assert `valueQuantity.unit = "mg/dL"`
  - Assert `valueQuantity.code = "mg/dL"`
  - Assert `valueQuantity.system = "http://unitsofmeasure.org"`

**Scenario 2: Search-Based Validation**
- Execute search queries to retrieve sets of Observation resources
- Apply glucose-related filters (e.g., using LOINC codes for glucose measurements)
- For each returned Observation:
  - Validate unit requirements as above
  - Ensure no glucose observations use alternative units (e.g., mmol/L)

**Scenario 3: Category-Based Testing**
- Search for laboratory category observations: `GET /Observation?category=laboratory`
- Filter results for glucose-related observations
- Validate unit compliance across all glucose measurements

#### Pass/Fail Criteria
- **Pass**: All glucose Observation resources use mg/dL as the unit of measure
- **Fail**: Any glucose Observation resource uses a unit other than mg/dL
- **Skip**: No glucose Observation resources available for testing

#### Edge Cases to Consider
- Observations with missing valueQuantity elements (should not fail this specific test)
- Observations with valueQuantity but missing unit information (test failure)
- Non-glucose observations (should be excluded from this test)
- Observations with multiple components (validate each relevant component)

---

<a id='req-130'></a>

### REQ-130: Observation category must be "Vital Signs"

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-130

## 1. Requirement ID
**REQ-130**: Observation category must be "Vital Signs"

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated inspection of Observation resources to check the category field value.

### Complexity
**Simple** - This is a straightforward field validation requirement that checks for a specific categorical value in the Observation.category field.

### Prerequisites
- System must support US Core Observation profiles, particularly vital signs profiles
- System must be capable of creating/storing Observation resources with category classifications
- Test data should include Observation resources that are intended to represent vital signs measurements

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Observation resources that represent vital signs data (e.g., blood pressure, heart rate, respiratory rate, temperature, pulse oximetry, etc.)
- Resources should be instances of US Core vital signs profiles such as:
  - US Core Vital Signs Profile
  - US Core Blood Pressure Profile
  - US Core Heart Rate Profile
  - US Core Respiratory Rate Profile
  - US Core Body Temperature Profile
  - US Core Pulse Oximetry Profile
  - Other vital signs profiles as applicable

**Expected Outputs:**
- Validation results confirming that all vital signs Observation resources have category = "vital-signs"
- Clear pass/fail status for each Observation resource tested

### Required FHIR Operations
Based on the Capability Statement, the following supported operations can be used:

1. **Search Operations:**
   - `GET [base]/Observation?patient=[id]&category=vital-signs` - to retrieve vital signs observations
   - `GET [base]/Observation?patient=[id]&category=vital-signs&_lastUpdated=[date]` - to retrieve recent vital signs
   - `GET [base]/Observation?category=vital-signs` - to retrieve all vital signs observations

2. **Read Operations:**
   - `GET [base]/Observation/[id]` - to retrieve specific Observation resources for validation

### Validation Criteria

**Primary Assertion:**
- Each Observation resource that represents a vital sign measurement SHALL have `Observation.category` containing a coding with:
  - `system = "http://terminology.hl7.org/CodeSystem/observation-category"`
  - `code = "vital-signs"`

**Specific Validation Steps:**

1. **Category Field Presence Check:**
   - Verify that `Observation.category` field exists and is not empty
   - PASS: Category field is present
   - FAIL: Category field is missing or empty

2. **Vital Signs Category Validation:**
   - For each `Observation.category.coding` entry, check if any coding has:
     - `system = "http://terminology.hl7.org/CodeSystem/observation-category"`
     - `code = "vital-signs"`
   - PASS: At least one coding with the required system and code is present
   - FAIL: No coding with the required vital-signs category is found

3. **Profile Compliance Cross-Check:**
   - If the Observation claims conformance to a US Core vital signs profile (via `meta.profile`), verify the category requirement is met
   - PASS: Profile conformance aligns with category requirement
   - FAIL: Claims vital signs profile conformance but lacks proper category

**Test Execution Approach:**

1. **Data Discovery:**
   - Use search operations to identify Observation resources that should be classified as vital signs
   - Focus on observations with codes typically associated with vital signs measurements

2. **Resource Validation:**
   - Retrieve each identified Observation resource
   - Apply the validation criteria to each resource
   - Document results with specific resource IDs and failure details

3. **Result Reporting:**
   - Report percentage of compliant vs non-compliant vital signs observations
   - Provide specific examples of non-compliant resources
   - Include recommendations for remediation if failures are found

**Success Criteria:**
The test passes when 100% of Observation resources representing vital signs measurements contain the required "vital-signs" category coding as specified above.

---

<a id='req-131'></a>

### REQ-131: Observation code must be "Oxygen saturation in Arterial blood"

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-131

## Requirement ID
REQ-131

## Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified programmatically by examining the `Observation.code` element in oxygen saturation observations and validating against the expected code value.

### Complexity
**Simple** - The requirement involves a straightforward validation of a single coded element against a specific expected value.

### Prerequisites
- System must support US Core Observation profiles (confirmed in Capability Statement)
- System must have oxygen saturation observations available for testing
- Test data should include Observation resources that represent oxygen saturation measurements
- The specific code system and code value for "Oxygen saturation in Arterial blood" must be defined (typically LOINC code)

## Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources that represent oxygen saturation measurements
- **Expected Code**: The specific code that represents "Oxygen saturation in Arterial blood" (likely LOINC code such as `2708-6` or similar)
- **Code System**: The terminology system URI (typically `http://loinc.org`)

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and may be used:

1. **GET [base]/Observation/[id]** - Retrieve specific Observation resources
2. **GET [base]/Observation?patient=[patient-id]&category=vital-signs** - Search for vital sign observations
3. **GET [base]/Observation?patient=[patient-id]&code=[oxygen-saturation-code]** - Search for oxygen saturation observations specifically

### Validation Criteria

#### Primary Validation
For each Observation resource identified as representing oxygen saturation in arterial blood:

1. **Code Validation**:
   - Verify `Observation.code.coding` contains at least one coding element
   - Verify at least one `Observation.code.coding` element has:
     - `system` = expected code system URI (e.g., `http://loinc.org`)
     - `code` = expected code value for "Oxygen saturation in Arterial blood"
   - Verify the `display` value (if present) appropriately represents "Oxygen saturation in Arterial blood"

#### Secondary Validation
2. **Profile Conformance**:
   - Verify the Observation resource conforms to an appropriate US Core profile (likely US Core Pulse Oximetry Profile or US Core Vital Signs Profile)
   - Validate the resource against the profile using FHIR validation tools

#### Test Pass Criteria
- **PASS**: All oxygen saturation in arterial blood observations contain the correct code in `Observation.code`
- **FAIL**: Any oxygen saturation in arterial blood observation lacks the required code or uses an incorrect code
- **SKIP**: No oxygen saturation observations are available in the test dataset

#### Additional Considerations
- If multiple coding systems are present in `Observation.code.coding`, at least one must contain the required code
- The test should be flexible enough to work with different test datasets while maintaining the core validation logic
- Consider edge cases where observations might have multiple codes but still include the required "Oxygen saturation in Arterial blood" code

### Test Execution Steps
1. Identify Observation resources in the test dataset that represent oxygen saturation measurements
2. For each identified observation, extract the `Observation.code` element
3. Validate that the code element contains the required coding for "Oxygen saturation in Arterial blood"
4. Report results indicating compliance or non-compliance with the requirement
5. Provide detailed feedback on any non-compliant observations found

---

<a id='req-132'></a>

### REQ-132: Observation value must be expressed in percentage

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-132

## 1. Requirement ID
**REQ-132**: Observation value must be expressed in percentage

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be validated programmatically by examining the structure and content of Observation resources to verify that values are expressed as percentages with appropriate units.

### Complexity
**Simple** - The requirement involves straightforward validation of unit codes and value representation in FHIR Observation resources.

### Prerequisites
- Access to a FHIR server implementing US Core Server capabilities
- Observation resources containing satO2-fiO2 measurements
- Understanding of FHIR Observation resource structure and UCUM unit codes
- Test client capable of performing FHIR REST operations

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Observation resources with satO2-fiO2 measurements that should express values in percentage
- Resources should conform to relevant US Core Observation profiles

**Expected Outputs:**
- Observation resources where percentage values are properly encoded with:
  - Numeric value in `valueQuantity.value`
  - Unit code "%" in `valueQuantity.code`
  - Unit system "http://unitsofmeasure.org" in `valueQuantity.system`
  - Display value "percent" or "%" in `valueQuantity.unit`

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations will be used:

1. **GET /Observation** - Search for Observation resources
2. **GET /Observation/[id]** - Read specific Observation resources
3. **GET /Observation?category=vital-signs** - Search for vital sign observations (if applicable)
4. **GET /Observation?code=[satO2-fiO2-code]** - Search for specific satO2-fiO2 observations

### Validation Criteria

#### Primary Assertions (Must Pass):
1. **Unit Code Validation**: 
   - `valueQuantity.code` equals "%" 
   - `valueQuantity.system` equals "http://unitsofmeasure.org"

2. **Value Type Validation**:
   - `valueQuantity.value` contains a numeric value
   - Value is within expected range for percentage (typically 0-100 or 0-1 depending on context)

3. **Unit Display Validation**:
   - `valueQuantity.unit` contains appropriate display text (e.g., "percent", "%", "per cent")

#### Secondary Assertions (Should Pass):
1. **Resource Structure**:
   - Observation resource contains `valueQuantity` element (not other value types like valueString)
   - Required Observation elements are present per US Core profiles

2. **Data Consistency**:
   - Values are consistent with percentage representation
   - No conflicting unit information across different fields

#### Test Execution Steps:
1. **Discovery**: Search for or identify Observation resources that should contain satO2-fiO2 percentage values
2. **Retrieval**: Fetch the identified Observation resources using appropriate REST operations
3. **Structure Validation**: Verify the presence of `valueQuantity` element
4. **Unit Validation**: Check that percentage units are properly encoded using UCUM standards
5. **Value Validation**: Confirm numeric values are appropriate for percentage representation
6. **Profile Conformance**: Validate against applicable US Core Observation profiles

#### Pass Criteria:
- All identified satO2-fiO2 Observation resources express values using percentage units
- Unit codes conform to UCUM standard ("%")
- Numeric values are consistent with percentage representation
- No violations of US Core Observation profile requirements

#### Failure Indicators:
- Values expressed in non-percentage units (e.g., decimal fractions without % unit)
- Missing or incorrect unit codes
- Use of non-standard unit systems
- Inconsistent unit representation across resources

---

<a id='req-133'></a>

### REQ-133: Observation code must be "Creatinine, Blood"

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-133

## 1. Requirement ID
REQ-133

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified through automated validation of the Observation resource's code element to ensure it contains the specific value "Creatinine, Blood".

### Complexity
**Simple** - The requirement involves a straightforward validation of a single code value in an Observation resource.

### Prerequisites
- System must support the US Core Laboratory Result Observation Profile
- System must have serum creatinine laboratory result data available
- System must support Observation resource read operations (as specified in Capability Statement section 14.3.3.20)

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources that represent serum creatinine laboratory results
- **Test Data**: Any existing Observation resources in the system that are intended to represent serum creatinine measurements
- **System Access**: Ability to query and retrieve Observation resources from the test system

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and may be used:

1. **Read Operation**: `GET [base]/Observation/[id]`
   - Used to retrieve specific Observation resources for validation

2. **Search Operations** (any of the following supported combinations):
   - `GET [base]/Observation?patient=[patient-id]&category=laboratory`
   - `GET [base]/Observation?patient=[patient-id]&code=[creatinine-code]`
   - `GET [base]/Observation?patient=[patient-id]&category=laboratory&date=[date-range]`

### Validation Criteria

#### Primary Validation
For each Observation resource that represents a serum creatinine measurement:

1. **Code Validation**: 
   - Verify that `Observation.code.coding` contains at least one coding where:
     - The display value equals "Creatinine, Blood" (case-sensitive match), OR
     - The code represents creatinine in blood/serum using standard terminology (e.g., LOINC codes such as "2160-0" for "Creatinine [Mass/Volume] in Serum or Plasma")

2. **Terminology Binding Compliance**:
   - Verify that the code system used is appropriate for laboratory results (preferably LOINC)
   - Confirm the code specifically represents creatinine measured in blood/serum (not urine or other specimens)

#### Secondary Validation
- **Profile Conformance**: Verify the Observation resource conforms to the US Core Laboratory Result Observation Profile
- **Category Validation**: Confirm `Observation.category` includes "laboratory" category code
- **Specimen Context**: If specimen information is present, verify it's consistent with blood/serum collection

#### Test Passing Criteria
A test passes when:
- All Observation resources intended to represent serum creatinine measurements have appropriate codes that clearly identify them as "Creatinine, Blood" measurements
- The codes used follow standard terminology practices (preferably LOINC)
- No false positives (non-creatinine observations incorrectly coded) are identified
- The system consistently applies the correct coding across all serum creatinine observations

#### Test Failure Scenarios
A test fails when:
- Serum creatinine observations are found with incorrect or missing codes
- The display text or code doesn't clearly indicate "Creatinine, Blood"
- Inconsistent coding practices are used across similar observations
- Creatinine measurements from non-blood specimens (e.g., urine) are incorrectly coded as blood creatinine

---

<a id='req-134'></a>

### REQ-134: Observation category must include "SDOH" and "Survey"

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-134

## 1. Requirement ID
**REQ-134**: Observation category must include "SDOH" and "Survey"

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified programmatically by examining the `category` field of Observation resources to confirm the presence of both "SDOH" and "Survey" categories.

### Complexity
**Simple** - The test involves straightforward validation of specific category values in Observation resources.

### Prerequisites
- System must support US Core Observation profiles (as indicated in Capability Statement)
- System must have Observation resources available for testing
- System must support RESTful read operations for Observation resources
- Test system must be able to access Observation resources that are expected to have SDOH and Survey categories (likely PRAPARE or similar SDOH screening observations)

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources that should conform to SDOH survey requirements (e.g., PRAPARE observations)
- **Resource Identification**: Either specific Observation IDs or search criteria to identify relevant Observation resources
- **Expected Categories**: The requirement specifies that observations must include both:
  - "SDOH" category
  - "Survey" category

### Required FHIR Operations
Based on the Capability Statement, the following supported operations will be used:
- `GET /Observation/{id}` - Read specific Observation resources
- `GET /Observation?category={category}&patient={patient}` - Search for observations by category (if needed to identify test candidates)
- `GET /Observation?patient={patient}` - Search for patient observations (if needed to identify test candidates)

### Validation Criteria

#### Primary Assertions
1. **Category Field Existence**: Verify that the Observation resource contains a `category` field
2. **SDOH Category Present**: Confirm that at least one category element contains "SDOH" 
3. **Survey Category Present**: Confirm that at least one category element contains "Survey"
4. **Category Structure**: Verify that categories are properly formatted as CodeableConcept elements

#### Specific Test Steps
1. **Resource Retrieval**: Retrieve Observation resource(s) using supported read/search operations
2. **Category Validation**: For each relevant Observation:
   - Extract the `category` array from the Observation
   - Iterate through category elements to identify coding systems and codes
   - Verify presence of "SDOH" category (checking both `code` and `display` values as appropriate)
   - Verify presence of "Survey" category (checking both `code` and `display` values as appropriate)
3. **Conformance Check**: Ensure both required categories are present simultaneously in the same Observation

#### Expected Test Results
- **PASS**: Observation resources contain both "SDOH" and "Survey" categories in their category field
- **FAIL**: Observation resources are missing either "SDOH" category, "Survey" category, or both
- **ERROR**: Unable to retrieve Observation resources or category field is malformed

#### Additional Considerations
- The test should account for different coding systems that might be used for categories
- Categories may be represented with different code systems (e.g., observation-category, LOINC, etc.)
- The test should be flexible enough to work with various SDOH survey implementations while maintaining the core requirement validation
- Consider that categories might be specified using different combinations of `code`, `display`, and `system` values within the CodeableConcept structure

---

<a id='req-135'></a>

### REQ-135: Serum Sodium Observation SHALL have a code of "Sodium, Blood"

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-135

## 1. Requirement ID
**REQ-135**: Serum Sodium Observation SHALL have a code of "Sodium, Blood"

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be validated programmatically by examining the `code` element of Observation resources that represent serum sodium results.

### Complexity
**Simple** - The test involves straightforward validation of a specific code value in the Observation.code element.

### Prerequisites
- System must support US Core Laboratory Result Observation Profile
- System must have serum sodium observation data available for testing
- System must support Observation resource read and search operations as specified in the Capability Statement

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources conforming to US Core Laboratory Result Observation Profile that represent serum sodium measurements
- **Test Data**: Any existing serum sodium observations in the system under test
- **Patient Context**: Valid patient ID for whom serum sodium observations exist

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and should be used:

1. **Search Operations**:
   - `GET [base]/Observation?patient=[patient-id]&category=laboratory`
   - `GET [base]/Observation?patient=[patient-id]&code=[sodium-code]`
   - `GET [base]/Observation/[observation-id]` (direct read)

2. **Include Operations** (if needed):
   - `GET [base]/Observation?[parameters]&_revinclude=Provenance:target`

### Validation Criteria

#### Primary Validation
For each Observation resource that represents a serum sodium measurement:

1. **Code Validation**: 
   - Verify `Observation.code` contains a coding with:
     - A code that represents "Sodium, Blood" 
     - Common acceptable codes include:
       - LOINC: `2951-2` (Sodium [Moles/volume] in Serum or Plasma)
       - LOINC: `2947-0` (Sodium [Mass/volume] in Serum or Plasma)
       - SNOMED CT: `365755007` (Finding of sodium level)
   - Verify the code system is appropriately specified (e.g., `http://loinc.org` for LOINC codes)

2. **Profile Conformance**:
   - Verify the Observation conforms to US Core Laboratory Result Observation Profile
   - Verify `Observation.category` contains laboratory category code

3. **Resource Identification**:
   - Identify serum sodium observations by examining:
     - `Observation.code` for sodium-related codes
     - `Observation.category` to confirm laboratory category
     - Clinical context to ensure it represents serum/blood sodium

#### Test Execution Steps

1. **Discovery Phase**:
   - Search for laboratory observations: `GET [base]/Observation?patient=[id]&category=laboratory`
   - Filter results to identify serum sodium observations based on code values
   - If no serum sodium observations found, document this for test reporting

2. **Validation Phase**:
   - For each identified serum sodium observation:
     - Retrieve full resource details
     - Validate code element contains appropriate "Sodium, Blood" code
     - Verify code system is properly specified
     - Confirm resource conforms to US Core Laboratory Result Observation Profile

3. **Assertion Criteria**:
   - **PASS**: All serum sodium observations contain appropriate codes representing "Sodium, Blood"
   - **FAIL**: Any serum sodium observation lacks the required code or uses incorrect/inappropriate codes
   - **NOT APPLICABLE**: No serum sodium observations found in test data

#### Expected Test Outcomes

- **Success Condition**: All serum sodium Observation resources contain codes that clearly represent "Sodium, Blood" measurements
- **Failure Condition**: One or more serum sodium observations use incorrect, missing, or inappropriate codes
- **Edge Cases to Handle**:
  - Multiple codings in Observation.code (at least one must represent "Sodium, Blood")
  - Different units of measurement (moles/volume vs mass/volume)
  - Historical vs current observations (all must comply)

#### Reporting Requirements
- Document total number of serum sodium observations tested
- List specific codes found and their appropriateness
- Report any non-conformant observations with details about the incorrect codes used
- Include recommendations for code corrections if failures are found

---

<a id='req-136'></a>

### REQ-136: MCV Observation SHALL have a code of "Mean Corpuscular Volume (MCV), Red blood cells"

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-136

## 1. Requirement ID
**REQ-136**: MCV Observation SHALL have a code of "Mean Corpuscular Volume (MCV), Red blood cells"

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified programmatically by inspecting the `code` element of MCV Observation resources to ensure it contains the required coding for "Mean Corpuscular Volume (MCV), Red blood cells".

### Complexity
**Simple** - The test involves straightforward validation of a single coded value within an Observation resource.

### Prerequisites
- System must support US Core Observation profiles
- System must have MCV Observation resources available for testing
- Test client must have appropriate access permissions to query Observation resources
- System should implement the US Core Server CapabilityStatement requirements

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources that represent MCV (Mean Corpuscular Volume) laboratory results
- **Test Data**: Any existing MCV observations in the system under test (following "bring your own data" approach)
- **Search Parameters**: Ability to identify and retrieve MCV observations from the test system

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations should be supported:

1. **GET [base]/Observation** - Search for Observation resources
2. **GET [base]/Observation/[id]** - Read specific Observation resources
3. **Search parameters** (as supported by US Core):
   - `category` - to filter for laboratory observations
   - `code` - to search for MCV-specific observations
   - `patient` - to scope searches to specific patients

### Validation Criteria

#### Primary Validation
For each MCV Observation resource identified in the test system:

1. **Code Presence Validation**:
   - Verify that `Observation.code` element is present and populated
   - Assert that the code element is not null or empty

2. **Code Content Validation**:
   - Verify that `Observation.code.coding` contains at least one coding entry
   - Assert that at least one coding entry represents "Mean Corpuscular Volume (MCV), Red blood cells"
   - Acceptable code systems and values may include:
     - LOINC: `787-2` (MCV [Volume] in Red Blood Cells by Automated count)
     - LOINC: `30428-7` (MCV [Volume] in Red Blood Cells)
     - Other equivalent codes that represent MCV of red blood cells

3. **Code System Validation**:
   - Verify that the coding uses a recognized terminology system (preferably LOINC for laboratory values)
   - Assert that the `system` and `code` values are properly formatted URIs and codes respectively

#### Test Execution Steps
1. **Discovery Phase**:
   - Query the system to identify Observation resources that represent MCV measurements
   - Use search parameters like `category=laboratory` and code-based searches to locate relevant observations

2. **Validation Phase**:
   - For each identified MCV Observation:
     - Extract the `code` element
     - Validate that it contains appropriate coding for MCV of red blood cells
     - Verify the coding follows proper FHIR structure and terminology binding requirements

3. **Pass/Fail Criteria**:
   - **PASS**: All identified MCV Observations contain the required code for "Mean Corpuscular Volume (MCV), Red blood cells"
   - **FAIL**: Any MCV Observation lacks the required code or contains incorrect/inappropriate codes
   - **NOT APPLICABLE**: No MCV Observations found in the test system (document this condition)

#### Expected Assertions
- `Observation.code` is present and not null
- `Observation.code.coding` array contains at least one entry
- At least one coding entry has a system and code that represents MCV of red blood cells
- The coding follows FHIR terminology binding requirements
- The code is semantically appropriate for MCV measurements

This test specification ensures conformance with the SHALL requirement while accommodating various test environments and data sets without requiring specific test fixtures.

---

<a id='req-137'></a>

### REQ-137: Hemoglobin Observation SHALL have a code of "Hemoglobin, Blood"

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-137

## 1. Requirement ID
**REQ-137**: Hemoglobin Observation SHALL have a code of "Hemoglobin, Blood"

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be programmatically verified by examining the `code` element of Hemoglobin Observation resources.

### Complexity
**Simple** - The requirement involves a straightforward validation of a single coding element in an Observation resource.

### Prerequisites
- Server implementing US Core Laboratory Result Observation Profile
- Test data containing hemoglobin observations 
- Server supporting Observation resource search capabilities as defined in the US Core Server Capability Statement

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources representing hemoglobin laboratory results
- **Test Data**: Any existing hemoglobin observations in the system under test
- **Patient Context**: Valid patient reference to scope observation searches

### Required FHIR Operations
Based on the Capability Statement, the following operations SHALL be supported:

1. **Search Operations**:
   - `GET [base]/Observation?patient=[id]&category=laboratory` (SHALL support)
   - `GET [base]/Observation?patient=[id]&code=[hemoglobin-code]` (SHALL support)
   - `GET [base]/Observation/[id]` (SHALL support - individual resource read)

2. **Search Parameters** (per Capability Statement requirements):
   - `patient` (reference) - SHALL support
   - `category` (token) - SHALL support  
   - `code` (token) - SHALL support

### Validation Criteria

#### Primary Validation
For each Observation resource identified as a hemoglobin measurement:

1. **Code Validation**: 
   - Verify `Observation.code.coding` contains a coding with the display value "Hemoglobin, Blood" OR
   - Verify `Observation.code.coding` contains a coding that semantically represents hemoglobin in blood (e.g., LOINC codes like "718-7", "30313-1", etc.)

2. **Profile Conformance**:
   - Verify the Observation conforms to US Core Laboratory Result Observation Profile
   - Verify `Observation.category` includes laboratory category coding

#### Test Cases

**Test Case 1: Search-based Validation**
- Execute: `GET [base]/Observation?patient=[patient-id]&category=laboratory`
- Filter results for hemoglobin observations based on common hemoglobin codes
- For each hemoglobin observation found, validate the code element contains appropriate "Hemoglobin, Blood" coding

**Test Case 2: Targeted Code Search**
- Execute: `GET [base]/Observation?patient=[patient-id]&code=[known-hemoglobin-code]`
- Verify returned observations have codes consistent with "Hemoglobin, Blood" requirement
- Validate that the display text or semantic meaning aligns with hemoglobin blood measurements

**Test Case 3: Direct Resource Validation**
- For any known hemoglobin Observation resource IDs: `GET [base]/Observation/[id]`
- Directly validate the `code` element meets the "Hemoglobin, Blood" requirement

#### Success Criteria
- All hemoglobin observations in the system contain appropriate coding for "Hemoglobin, Blood"
- No hemoglobin observations are found with incorrect or missing code values
- All returned observations conform to US Core Laboratory Result Observation Profile requirements

#### Failure Indicators
- Hemoglobin observations with missing `code` element
- Hemoglobin observations with codes that do not represent "Hemoglobin, Blood"
- Hemoglobin observations that fail US Core profile validation
- Server inability to support required search parameters per Capability Statement

---

<a id='req-138'></a>

### REQ-138: MCH Observation SHALL have a status of "Final"

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-138

## 1. Requirement ID
**REQ-138**: MCH Observation SHALL have a status of "Final"

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified programmatically by checking the `status` field value in MCH Observation resources.

### Complexity
**Simple** - This is a straightforward field validation requirement that checks a single element value against a specific expected value.

### Prerequisites
- System must support US Core Server capabilities as defined in the CapabilityStatement
- System must have MCH (Mean Corpuscular Hemoglobin) Observation resources available for testing
- MCH Observations should be identifiable through appropriate LOINC codes or profile conformance
- Test system must have read access to Observation resources

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources that represent MCH (Mean Corpuscular Hemoglobin) measurements
- **Resource Identification**: Observations should be identifiable as MCH observations through:
  - LOINC code for MCH (typically `785-6` for "Erythrocyte mean corpuscular hemoglobin [Entitic mass]")
  - Profile declaration referencing the MCH observation profile
- **Data Requirements**: Any existing MCH Observation resources in the test system (bring your own data approach)

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are supported and required for testing:

1. **Observation Read Operations**:
   - `GET [base]/Observation/[id]` - Read individual MCH Observation resources
   - `GET [base]/Observation?category=laboratory` - Search for laboratory observations
   - `GET [base]/Observation?code=[MCH-LOINC-code]` - Search by specific MCH LOINC codes

2. **Observation Search Operations** (as supported by US Core Server):
   - Search by patient: `GET [base]/Observation?patient=[reference]`
   - Search by category and patient: `GET [base]/Observation?category=laboratory&patient=[reference]`
   - Search by code: `GET [base]/Observation?code=785-6` (for MCH LOINC code)

### Expected Outputs
- MCH Observation resources with `status` field populated
- Confirmation that all retrieved MCH Observation resources have the required status value

### Validation Criteria

#### Primary Assertion
For each MCH Observation resource identified and retrieved:
1. **Status Field Presence**: Verify that the `status` element is present in the Observation resource
2. **Status Value Validation**: Assert that `Observation.status` equals `"final"`
3. **Case Sensitivity**: Ensure the status value matches exactly (lowercase "final")

#### Test Cases

**Test Case 1: Direct Resource Read**
- **Action**: Read MCH Observation resources by ID
- **Validation**: For each resource, assert `Observation.status == "final"`
- **Pass Criteria**: All MCH Observation resources have status = "final"
- **Fail Criteria**: Any MCH Observation resource has a status other than "final"

**Test Case 2: Search-based Validation**
- **Action**: Search for MCH observations using supported search parameters
- **Validation**: For each returned resource in the Bundle, assert `Observation.status == "final"`
- **Pass Criteria**: All MCH Observation resources in search results have status = "final"
- **Fail Criteria**: Any MCH Observation resource has a status other than "final"

**Test Case 3: Profile-specific Validation**
- **Action**: Identify MCH observations through profile conformance declarations
- **Validation**: For resources claiming conformance to MCH observation profiles, assert `Observation.status == "final"`
- **Pass Criteria**: All profile-conformant MCH Observations have status = "final"
- **Fail Criteria**: Any profile-conformant MCH Observation has a status other than "final"

#### Error Conditions
- **Missing Status**: If `Observation.status` is not present, the test should fail
- **Invalid Status Values**: Any status value other than "final" (e.g., "preliminary", "registered", "cancelled") should result in test failure
- **Empty Status**: Null or empty status values should result in test failure

#### Conformance Verification
- Verify that the requirement applies specifically to MCH observations (not all observations)
- Ensure that observations are correctly identified as MCH type through appropriate coding or profile references
- Validate that the SHALL conformance level is enforced (no exceptions allowed)

---

<a id='req-139'></a>

### REQ-139: MCH Observation SHALL have a category of "Laboratory"

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-139

## 1. Requirement ID
REQ-139

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified programmatically by examining the `category` field of MCH Observation resources to confirm the presence of a "Laboratory" category code.

### Complexity
**Simple** - The test involves a straightforward field validation check on a single FHIR element.

### Prerequisites
- System must support US Core Server capabilities as defined in the CapabilityStatement
- System must have MCH (Mean Corpuscular Hemoglobin) Observation resources available for testing
- Test system must be able to retrieve Observation resources via FHIR RESTful API
- MCH Observations should conform to the CBC MCH profile referenced in the source

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources representing MCH (Mean Corpuscular Hemoglobin) laboratory results
- **Test Data**: Any existing MCH Observation data in the system under test (bring your own data approach)
- **Profile Context**: Understanding that these are CBC MCH observations as referenced in `Observation-cbc-mch.md`

### Expected Outputs
- Confirmation that all retrieved MCH Observation resources contain a category element with the code "laboratory"
- Test results indicating pass/fail status for each MCH Observation evaluated
- Summary report of conformance status

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations should be supported:

1. **GET /Observation** - Retrieve Observation resources
2. **GET /Observation?category=laboratory** - Search for Observations by category (if supported by implementation)
3. **GET /Observation/[id]** - Retrieve specific Observation resources by ID

### Validation Criteria

#### Primary Assertion
For each MCH Observation resource identified:
- **PASS**: The `Observation.category` array contains at least one CodeableConcept with:
  - `coding` array containing a code with value "laboratory" 
  - Preferably from the coding system `http://terminology.hl7.org/CodeSystem/observation-category`

#### Specific Validation Steps
1. **Resource Identification**: Identify MCH Observation resources in the test dataset
   - Look for Observations with appropriate LOINC codes for MCH (e.g., "28540-3" for MCH)
   - Or use implementation-specific methods to identify MCH observations

2. **Category Field Validation**: For each identified MCH Observation:
   - Verify `category` field exists and is not empty
   - Verify `category` is an array of CodeableConcept elements
   - Check that at least one CodeableConcept in the category array contains a coding with code "laboratory"

3. **Conformance Validation**: 
   - **PASS Condition**: ALL MCH Observations have the required "laboratory" category
   - **FAIL Condition**: ANY MCH Observation lacks the "laboratory" category
   - **SKIP Condition**: No MCH Observations found in test dataset

#### Example Validation Logic
```
FOR each Observation resource WHERE resource represents MCH:
  ASSERT Observation.category EXISTS
  ASSERT Observation.category IS NOT EMPTY
  ASSERT EXISTS category IN Observation.category WHERE 
    category.coding EXISTS AND
    EXISTS coding IN category.coding WHERE 
      coding.code = "laboratory"
```

#### Test Reporting
- Document total number of MCH Observations tested
- Report number of conformant vs non-conformant resources
- Provide specific details for any non-conformant resources including resource ID and missing/incorrect category values
- Overall test result: PASS if 100% conformance, FAIL otherwise

---

<a id='req-140'></a>

### REQ-140: MCH Observation SHALL have a code of "Mean Corpuscular Hemoglobin (MCH), Red blood cells"

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-140

## Requirement ID
REQ-140

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated through automated inspection of FHIR Observation resources to verify the presence and correctness of the specified code.

### Complexity
**Simple** - The requirement involves a straightforward validation of a single code element in an Observation resource.

### Prerequisites
- System must support US Core Laboratory Result Observation Profile
- System must have MCH (Mean Corpuscular Hemoglobin) laboratory observations available
- System must support FHIR R4 Observation resource structure
- Test data should include CBC (Complete Blood Count) observations that contain MCH measurements

## Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources conforming to US Core Laboratory Result Observation Profile that represent MCH measurements
- **Test Data**: Laboratory observations from CBC panels containing MCH values
- **Expected Code**: The observation must have a code representing "Mean Corpuscular Hemoglobin (MCH), Red blood cells"

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required for testing:

1. **GET [base]/Observation/[id]** - Read specific MCH observations
2. **GET [base]/Observation?patient=[patient-id]&category=laboratory** - Search for laboratory observations by patient
3. **GET [base]/Observation?patient=[patient-id]&code=[mch-code]** - Search for MCH observations by patient and code

### Validation Criteria

#### Primary Validation
1. **Code Presence**: Each MCH Observation resource SHALL contain an `Observation.code` element
2. **Code Value**: The `Observation.code` SHALL represent "Mean Corpuscular Hemoglobin (MCH), Red blood cells"
3. **Code System**: The code SHALL use an appropriate terminology system (typically LOINC)
4. **Expected LOINC Code**: The observation should use LOINC code `28540-3` (Mean corpuscular hemoglobin [Entitic mass] in Blood by Automated count) or equivalent MCH-related LOINC codes

#### Test Assertions
- **PASS**: All MCH observations contain the correct code for "Mean Corpuscular Hemoglobin (MCH), Red blood cells"
- **FAIL**: Any MCH observation lacks the required code or uses an incorrect code
- **FAIL**: MCH observations use codes that don't represent Mean Corpuscular Hemoglobin measurements

#### Validation Steps
1. Retrieve all laboratory Observation resources from the test dataset
2. Filter observations that represent MCH measurements (may be identified through observation context, panel membership, or code inspection)
3. For each identified MCH observation:
   - Verify `Observation.code` element exists
   - Verify the code represents Mean Corpuscular Hemoglobin (MCH) for red blood cells
   - Verify the code uses appropriate terminology (preferably LOINC)
   - Verify the code is semantically correct for MCH measurements

#### Edge Cases to Consider
- MCH observations that are part of CBC panels
- MCH observations with multiple codings in `Observation.code.coding`
- MCH observations with different but equivalent terminology codes
- Historical or legacy MCH observations that may use different coding systems

#### Success Criteria
- 100% of identified MCH observations SHALL have the correct code for "Mean Corpuscular Hemoglobin (MCH), Red blood cells"
- The code SHALL be semantically appropriate and use recognized medical terminology standards
- The requirement is satisfied when all MCH observations in the test dataset comply with the specified coding requirement

---

<a id='req-141'></a>

### REQ-141: MCH Observation SHALL have a value of 30 pg

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-141

## 1. Requirement ID
REQ-141

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Not testable due to insufficient requirement detail

**Rationale**: The requirement "MCH Observation SHALL have a value of 30 pg" is too vague and lacks critical context for creating a meaningful interoperability test:
- No specification of which MCH (Mean Corpuscular Hemoglobin) observation profile to use
- No context for when this specific value constraint applies
- Unclear if this is a fixed value requirement, minimum/maximum constraint, or example value
- Missing FHIR resource structure requirements
- No reference to specific use cases or clinical scenarios

### Complexity
**Simple** - If properly specified, this would be a straightforward value validation test

### Prerequisites
- Access to a FHIR server implementing US Core Server Capability Statement
- Test system capable of FHIR R4 API interactions
- Observation resources containing MCH (Mean Corpuscular Hemoglobin) laboratory results
- Understanding of the specific MCH observation profile being tested

## 3. Test Implementation Strategy

### Required Inputs
**Note**: This test specification cannot be implemented as written due to insufficient requirement detail. The following outlines what would be needed if the requirement were properly specified:

**FHIR Resources Needed**:
- Observation resources with:
  - `code` indicating MCH measurement
  - `value[x]` containing the measurement value
  - Appropriate units (typically pg - picograms)

**Expected Outputs**:
- Confirmation that MCH observations meet the specified value constraint
- Validation of proper FHIR Observation structure
- Verification of appropriate units and coding

### Required FHIR Operations
Based on US Core Server Capability Statement:

1. **GET /Observation** - Retrieve observation resources
   - Supported search parameters as defined in US Core
   - Filter for laboratory/MCH observations

2. **GET /Observation/[id]** - Retrieve specific observation by ID

### Validation Criteria

**Unable to define specific validation criteria** due to requirement ambiguity. Proper criteria would require:

1. **Value Validation**:
   - Clear specification of when "30 pg" constraint applies
   - Definition of acceptable value ranges or exact matching requirements
   - Handling of different units or unit conversions

2. **FHIR Structure Validation**:
   - Proper Observation resource structure
   - Correct coding for MCH measurements
   - Appropriate value[x] element usage

3. **Profile Conformance**:
   - Adherence to specified MCH observation profile
   - Required elements present and properly formatted

## Recommendation for Requirement Improvement

To make this requirement testable, it should be revised to include:

1. **Specific Profile Reference**: Reference to the exact FHIR profile (e.g., US Core Laboratory Result Observation Profile)
2. **Clear Context**: When and where this value constraint applies
3. **Value Specification**: Whether this is an exact value, range, or conditional requirement
4. **Use Case Definition**: Clinical scenario where this constraint is relevant
5. **FHIR Element Mapping**: Specific FHIR elements and paths that contain this value

**Example of improved requirement**:
"MCH Observation resources conforming to [specific profile] SHALL have a value between 27-32 pg in the Observation.valueQuantity element when representing normal adult MCH levels"

---

<a id='req-142'></a>

### REQ-142: MCH Observation SHALL have an interpretation of "Normal"

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-142

## 1. Requirement ID
REQ-142: MCH Observation SHALL have an interpretation of "Normal"

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified programmatically by examining the `interpretation` field of MCH Observation resources to confirm they contain "Normal" values.

### Complexity
**Simple** - The test involves a straightforward field validation on a specific observation type.

### Prerequisites
- System must support US Core Observation profiles
- System must have MCH (Mean Corpuscular Hemoglobin) observation data available
- System must support FHIR R4 JSON format
- Valid authentication credentials for API access

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources with category indicating laboratory results and code indicating MCH measurements
- **Authentication**: Valid credentials to access the FHIR server
- **Test Data**: System's existing MCH observation data (bring your own data approach)

### Expected Outputs
- FHIR Observation resources containing MCH measurements
- Each MCH Observation resource should have an `interpretation` element with value "Normal"

### Required FHIR Operations
Based on the US Core Server Capability Statement, the following operations are supported and required for this test:

1. **Search Operation**: `GET [base]/Observation`
   - Search for Observation resources with appropriate filters
   - Supported per US Core Server capabilities for Observation resources

2. **Read Operation**: `GET [base]/Observation/[id]` (if individual resource retrieval is needed)
   - Retrieve specific Observation resources for detailed validation

### Validation Criteria

#### Primary Assertions
1. **MCH Observation Identification**: 
   - Verify that retrieved Observation resources represent MCH measurements
   - Check `code.coding` contains appropriate LOINC code for MCH (e.g., "28540-3" for MCH)

2. **Interpretation Presence**:
   - Assert that each MCH Observation resource contains an `interpretation` element
   - Verify the `interpretation` field is not null or empty

3. **Interpretation Value Validation**:
   - Assert that the `interpretation.coding.code` equals "N" (Normal) or equivalent normal interpretation code
   - Verify `interpretation.coding.system` uses appropriate code system (e.g., "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation")
   - Confirm `interpretation.coding.display` indicates "Normal" or equivalent display text

#### Test Steps
1. **Discovery**: Query the system for MCH Observation resources using appropriate search parameters
2. **Retrieval**: Collect all MCH Observation resources from the system
3. **Validation**: For each MCH Observation resource:
   - Confirm it represents an MCH measurement
   - Verify presence of interpretation element
   - Validate interpretation value equals "Normal"
4. **Reporting**: Document any MCH Observations that do not have "Normal" interpretation as conformance failures

#### Success Criteria
- **PASS**: All MCH Observation resources have interpretation of "Normal"
- **FAIL**: Any MCH Observation resource lacks interpretation element or has interpretation other than "Normal"

#### Error Handling
- Handle HTTP 404 responses if no MCH observations exist (test may be skipped if no applicable data)
- Handle HTTP 401/403 responses per US Core Server security requirements
- Document any system errors that prevent complete testing

---

<a id='req-143'></a>

### REQ-143: Serum Chloride Observation status requirement

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification: REQ-143

## 1. Requirement ID
REQ-143: Serum Chloride Observation status requirement

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Automatically testable

The requirement can be validated through automated testing by examining the `status` element of Serum Chloride Observation resources. This is a structural conformance requirement that can be verified programmatically.

### Complexity
**Level**: Simple

This is a straightforward validation of a required element within a specific Observation profile. The test involves checking for the presence and validity of the `status` field.

### Prerequisites
- System must support US Core Server capabilities as defined in the CapabilityStatement
- System must be capable of storing and retrieving Observation resources
- Test data must include Serum Chloride Observation instances
- System must support FHIR R4 specification

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources**:
- One or more Observation resources conforming to the US Core Laboratory Result Observation Profile
- Observations must represent serum chloride laboratory results (identifiable by appropriate LOINC codes such as 2075-0 "Chloride [Moles/volume] in Serum or Plasma")

**Expected Outputs**:
- Retrieved Observation resources with populated `status` elements
- Validation confirmation that all serum chloride observations contain the required status field

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are supported and required for testing:

1. **GET /Observation/{id}** - Retrieve specific Observation resources
2. **GET /Observation?category=laboratory** - Search for laboratory observations
3. **GET /Observation?code={loinc-code}** - Search for observations by specific LOINC codes

### Validation Criteria

**Primary Assertions**:
1. **Status Element Presence**: Every serum chloride Observation resource SHALL contain a `status` element
2. **Status Value Validity**: The `status` value SHALL be one of the valid codes from the ObservationStatus value set:
   - `registered`
   - `preliminary` 
   - `final`
   - `amended`
   - `corrected`
   - `cancelled`
   - `entered-in-error`
   - `unknown`

**Test Steps**:
1. Query the system for all available serum chloride observations using appropriate search parameters
2. For each retrieved Observation resource:
   - Verify the resource conforms to the US Core Laboratory Result Observation Profile
   - Confirm the observation represents a serum chloride measurement
   - Assert that the `Observation.status` element exists and is not null
   - Validate that the `status` value is from the required value set
3. Document any observations that fail the status requirement

**Pass Criteria**:
- 100% of serum chloride Observation resources contain a valid `status` element
- All `status` values conform to the FHIR ObservationStatus value set
- No validation errors related to missing or invalid status values

**Fail Criteria**:
- Any serum chloride Observation resource lacks a `status` element
- Any `status` value is not from the required ObservationStatus value set
- Any `status` element contains null or empty values

---

<a id='req-144'></a>

### REQ-144: Serum Chloride Observation category requirement

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-144

## 1. Requirement ID
REQ-144: Serum Chloride Observation category requirement

## 2. Requirement Analysis

### Testability Assessment
**Not testable due to incomplete requirement specification**

The requirement as provided lacks essential details:
- No specific category value or coding system is specified
- The requirement text is empty, providing no testable criteria
- Without the actual Observation profile content (Observation-serum-chloride.md), the specific category requirements cannot be determined

### Complexity
**Simple** (once requirement details are clarified)

Category validation is typically a straightforward field check against expected values.

### Prerequisites
- Access to a FHIR server implementing US Core Server CapabilityStatement
- System must support Observation resource operations as defined in US Core
- Test data should include Observation resources representing serum chloride measurements
- Access to the complete Observation-serum-chloride profile specification

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Observation resources with serum chloride measurements
- Resources should represent typical clinical serum chloride data from the testing organization

**Expected Outputs:**
- Validation that all serum chloride Observation resources contain the required category element(s)
- Confirmation that category values conform to the specified coding system and values

### Required FHIR Operations
Based on US Core Server CapabilityStatement:
- **GET /Observation** - Retrieve Observation resources for analysis
- **GET /Observation?category=[category-code]** - Search for observations by category (if supported)
- **GET /Observation/[id]** - Retrieve specific Observation instances

*Note: The exact search parameters and operations would need to be verified against the US Core Observation profile requirements*

### Validation Criteria

**To properly implement this test, the following information is needed from the source specification:**

1. **Category Coding Requirements:**
   - Which coding system should be used (e.g., http://terminology.hl7.org/CodeSystem/observation-category)
   - What specific category code(s) are required for serum chloride observations
   - Whether multiple categories are allowed or required

2. **Conformance Level:**
   - Whether the category is required (cardinality 1..*)
   - Whether specific category values must be present
   - Any conditional requirements based on other observation properties

**Proposed Validation Approach (pending requirement clarification):**

1. **Retrieve Test Data:**
   - Query for Observation resources representing serum chloride measurements
   - Use appropriate search parameters to identify serum chloride observations

2. **Category Presence Validation:**
   - Verify each serum chloride Observation contains the required category element
   - Assert: `Observation.category` is present and not empty

3. **Category Value Validation:**
   - Validate category coding against required code system and values
   - Assert: Category contains expected code(s) from specified value set

4. **Conformance Validation:**
   - Ensure all serum chloride observations meet the category requirements
   - Report any observations that fail to meet the requirements

**Recommendation:**
This requirement cannot be fully tested without access to the complete specification from Observation-serum-chloride.md. The test specification should be updated once the specific category requirements are clarified, including the required coding system, specific codes, and any conditional logic.

---

<a id='req-145'></a>

### REQ-145: Serum Chloride Observation code requirement

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-145

## 1. Requirement ID
**REQ-145**: Serum Chloride Observation code requirement

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Not testable due to incomplete requirement specification

**Rationale**: The requirement text is empty, providing no specific criteria for what constitutes conformant serum chloride observation codes. Without explicit coding requirements, value constraints, or reference to specific terminologies (e.g., LOINC codes), this requirement cannot be effectively tested for conformance.

### Complexity
**Level**: Cannot be determined due to incomplete specification

### Prerequisites
- Cannot be determined without complete requirement specification
- Would typically require:
  - Access to US Core Server implementing Observation resources
  - Understanding of required coding systems for serum chloride observations
  - Knowledge of acceptable value ranges and units

## 3. Test Implementation Strategy

### Current Status
**Implementation Not Possible**: Due to the incomplete nature of the requirement specification, a comprehensive test implementation strategy cannot be developed.

### Required Information for Implementation
To make this requirement testable, the following information would be needed:

1. **Specific Coding Requirements**:
   - Required LOINC codes for serum chloride observations
   - Acceptable coding systems and their hierarchies
   - Required vs. optional coding elements

2. **Value Constraints**:
   - Acceptable units of measure (e.g., mEq/L, mmol/L)
   - Expected value ranges for serum chloride
   - Required precision or significant figures

3. **Profile References**:
   - Specific US Core Observation profile requirements
   - Must Support elements for serum chloride observations
   - Required vs. optional data elements

### Hypothetical Test Strategy (if requirement were complete)
If the requirement specified serum chloride coding requirements, the test strategy would likely include:

#### Required FHIR Operations
- `GET /Observation` - Retrieve serum chloride observations (supported per US Core Server CapabilityStatement)
- Query parameters as supported by the US Core Server capability

#### Potential Validation Criteria
- Verify presence of required LOINC codes in `Observation.code`
- Validate appropriate units in `Observation.valueQuantity.unit`
- Confirm coding system references are correct
- Check for required terminology bindings

### Recommendation
**Action Required**: The requirement specification must be completed with explicit criteria before test implementation can proceed. The requirement should specify:
- Exact coding requirements for serum chloride observations
- Reference to applicable US Core profiles
- Specific conformance criteria that can be validated

**Test Approach**: Once requirements are clarified, this would likely be an **automatically testable** requirement using FHIR resource validation and terminology checking.

---

<a id='req-146'></a>

### REQ-146: Serum Chloride Observation value requirement

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-146

## 1. Requirement ID
REQ-146: Serum Chloride Observation value requirement

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Not testable due to incomplete requirement specification

**Rationale**: The requirement text is empty, providing no specific conformance criteria to test against. Without the actual requirement content from "Observation-serum-chloride.md", it's impossible to determine what specific value requirements, constraints, or validation rules should be tested.

### Complexity
**Level**: Cannot be determined without requirement details

### Prerequisites
- Cannot be determined without the complete requirement specification
- Would likely require:
  - US Core Server implementation supporting Observation resources
  - Test data containing serum chloride observations
  - Access to the referenced "Observation-serum-chloride.md" specification

## 3. Test Implementation Strategy

### Required Inputs
**Cannot be specified without complete requirement details**

Typical inputs for serum chloride observation testing would likely include:
- Observation resources with serum chloride measurements
- Patient context for the observations
- Laboratory result coding systems (LOINC, SNOMED)

### Required FHIR Operations
Based on the US Core Server Capability Statement, the following operations would typically be available for Observation testing:
- `GET [base]/Observation/[id]` - Read specific observation
- `GET [base]/Observation?patient=[reference]` - Search observations by patient
- `GET [base]/Observation?category=laboratory` - Search laboratory observations
- `GET [base]/Observation?code=[code]` - Search by observation code

### Validation Criteria
**Cannot be determined without the complete requirement specification**

Common validation criteria for serum chloride observations might include:
- Verification of proper LOINC coding for serum chloride
- Validation of value ranges and units
- Confirmation of required data elements
- Checking conformance to US Core Observation profiles

## Recommendation

To create a proper test specification for REQ-146, the following information is needed:
1. Complete requirement text from "Observation-serum-chloride.md"
2. Specific conformance criteria for serum chloride observations
3. Expected data elements, value constraints, and coding requirements
4. Any specific US Core profile requirements for serum chloride observations

Without this fundamental requirement information, no meaningful conformance test can be designed or implemented.

---

<a id='req-147'></a>

### REQ-147: Serum CO2 Observation status requirement

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-147

## Requirement ID
REQ-147

## Requirement Analysis

### Testability Assessment
**Classification**: Not testable due to incomplete requirement specification

**Rationale**: The requirement text is empty, providing only a summary that mentions "Serum CO2 Observation status requirement" without any specific conformance criteria, expected values, or testable conditions. The requirement references "Observation-serum-co2.md" as a source, but the actual conformance rules are not provided in the requirement text.

### Complexity
**Classification**: Cannot be determined

**Rationale**: Without specific requirement text, the complexity cannot be assessed. Status-related requirements could range from simple (checking for presence of a status field) to complex (validating specific status values, transitions, or business rules).

### Prerequisites
**Cannot be determined**: Prerequisites cannot be established without knowing the specific conformance requirements.

## Test Implementation Strategy

### Required Inputs
**Cannot be specified**: Without clear requirement text, the following cannot be determined:
- Required FHIR resource types and profiles
- Expected data elements and constraints
- Input parameters or search criteria
- Expected system behavior

### Required FHIR Operations
**Cannot be specified**: The following cannot be determined without requirement details:
- Specific API endpoints to test
- Required search parameters
- Expected response formats
- HTTP methods and status codes

### Validation Criteria
**Cannot be specified**: Without requirement text, validation criteria cannot be established, including:
- Pass/fail conditions
- Expected values or value ranges
- Required data elements
- Conformance assertions

## Recommendation

To create a testable specification for REQ-147, the following information is needed:

1. **Complete Requirement Text**: The actual conformance requirements for Serum CO2 Observation status
2. **Specific Constraints**: What status values are required, prohibited, or conditionally allowed
3. **Context Information**: When and how this requirement applies
4. **Reference Material**: Access to the "Observation-serum-co2.md" source document

Once this information is provided, a comprehensive test specification can be developed that includes:
- Specific test scenarios for status validation
- Required FHIR operations (likely Observation read/search operations)
- Clear pass/fail criteria based on status field validation
- Integration with US Core Server capabilities for Observation resources

---

<a id='req-148'></a>

### REQ-148: Serum CO2 Observation category requirement

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-148

## Requirement ID
REQ-148: Serum CO2 Observation category requirement

## Requirement Analysis

### Testability Assessment
**Not testable due to being too vague**

The requirement lacks essential details needed for testing:
- No specific category value(s) that must be present
- No reference to the actual Observation-serum-co2 profile requirements
- Missing context about what category requirements apply
- Insufficient information to determine conformance criteria

### Complexity
**N/A** - Cannot assess complexity without clear requirements

### Prerequisites
Cannot be determined without complete requirement specification

## Test Implementation Strategy

### Required Inputs
- **Cannot be specified** - The requirement text does not provide sufficient detail about:
  - What category codes are required for Serum CO2 observations
  - The format or coding system for categories
  - Whether multiple categories are allowed or required
  - Specific validation rules for the category element

### Required FHIR Operations
- **Cannot be determined** - Without knowing the specific category requirements, it's unclear whether this requires:
  - Simple validation of existing Observation resources
  - Search operations to filter by category
  - Creation/update operations with category validation

### Validation Criteria
**Cannot be established** - The requirement lacks:
- Specific category values to validate against
- Clear pass/fail criteria
- Reference to the actual profile constraints

## Recommendation

This requirement needs to be enhanced with:

1. **Specific category requirements** from the Observation-serum-co2 profile
2. **Expected category values** (e.g., specific LOINC codes, category coding systems)
3. **Clear conformance criteria** (what constitutes compliance)
4. **Reference to the full profile specification** for context

Once these details are provided, a comprehensive test specification can be developed that would likely involve:
- Validating Observation resources against the serum CO2 profile
- Checking for required category elements and values
- Verifying proper coding system usage for categories

**Status: Requirement requires clarification before test implementation**

---

<a id='req-149'></a>

### REQ-149: Serum CO2 Observation code requirement

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-149

## 1. Requirement ID
REQ-149: Serum CO2 Observation code requirement

## 2. Requirement Analysis

### Testability Assessment
**Not testable** - The requirement is too vague as provided. The requirement summary mentions "Serum CO2 Observation code requirement" but the actual text and verification criteria are empty. Without specific details about:
- What codes are required/expected for serum CO2 observations
- The specific code system (LOINC, SNOMED, etc.)
- The exact coding requirements or constraints

This requirement cannot be meaningfully tested for conformance.

### Complexity
**Cannot be determined** - Due to insufficient requirement details

### Prerequisites
**Cannot be determined** - Due to insufficient requirement details

## 3. Test Implementation Strategy

### Current Status
**Test implementation cannot be completed** due to incomplete requirement specification.

### Required Information for Test Implementation

To make this requirement testable, the following information would be needed:

1. **Specific Code Requirements**: 
   - What specific codes must be used for serum CO2 observations?
   - Which code system(s) are acceptable (e.g., LOINC)?
   - Are there specific preferred codes vs acceptable alternatives?

2. **Observation Profile Context**:
   - Which US Core Observation profile applies?
   - Are there specific constraints beyond the base profile?

3. **Validation Scope**:
   - Should the test validate code presence, correctness, or both?
   - Are there display name requirements?
   - Are there unit requirements for serum CO2 values?

### Potential Test Approach (if requirement details were available)

If the requirement were properly specified, the test strategy would likely include:

**Required Inputs:**
- FHIR Observation resources representing serum CO2 measurements from the test system

**Required FHIR Operations:**
- `GET /Observation` (supported per US Core Server capability)
- Search parameters as defined in US Core Observation profiles

**Validation Criteria:**
- Verify Observation.code contains required serum CO2 codes
- Validate code system and display values
- Confirm conformance to applicable US Core Observation profile

### Recommendation
**Requirement REQ-149 needs to be updated with complete specification details before test implementation can proceed.** The requirement should specify the exact coding requirements for serum CO2 observations to enable meaningful conformance testing.

---

<a id='req-150'></a>

### REQ-150: Serum CO2 Observation value requirement

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-150

## 1. Requirement ID
REQ-150

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Not testable due to insufficient requirement specification

**Rationale**: The requirement summary mentions "Serum CO2 Observation value requirement" but the requirement text, context, and verification details are empty or incomplete. Without specific criteria for what constitutes a valid serum CO2 observation value (e.g., data type, value range, units, coding requirements), it is impossible to create meaningful test assertions.

### Complexity
**Not Applicable** - Cannot be determined without complete requirement specification

### Prerequisites
**Cannot be determined** - Requirement specification incomplete

## 3. Test Implementation Strategy

### Required Inputs
**Cannot be specified** - The requirement lacks sufficient detail to determine:
- Expected value ranges for serum CO2
- Required units of measure
- Mandatory coding systems
- Value constraints or validation rules

### Required FHIR Operations
**Cannot be determined** - While the US Core Server CapabilityStatement supports Observation resources, the specific operations needed depend on the complete requirement specification.

### Validation Criteria
**Cannot be established** - Without knowing the specific requirements for serum CO2 observation values, no validation criteria can be defined.

## Recommendations

To make this requirement testable, the following information should be provided:

1. **Complete requirement text** describing the specific constraints for serum CO2 observation values
2. **Reference to the specific FHIR profile** (likely US Core Laboratory Result Observation Profile)
3. **Value constraints** such as:
   - Acceptable units (e.g., mEq/L, mmol/L)
   - Valid value ranges
   - Required LOINC codes for serum CO2
   - Data type specifications
4. **Context information** explaining when and how this requirement applies
5. **Clear verification criteria** that can be tested

Once these details are provided, a comprehensive test specification can be developed that would include validation of observation values against the specified constraints using the appropriate FHIR operations supported by the US Core Server CapabilityStatement.

---

<a id='req-151'></a>

### REQ-151: Serum Potassium Observation status requirement

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-151

## 1. Requirement ID
REQ-151: Serum Potassium Observation status requirement

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Not testable due to incomplete requirement specification

**Rationale**: The requirement text is empty, providing no specific criteria to test against. While the requirement relates to "Serum Potassium Observation status requirement" and references "Observation-serum-potassium.md", without the actual requirement text, no meaningful test can be designed.

### Complexity
**Not Applicable** - Cannot assess complexity without requirement details

### Prerequisites
**Cannot be determined** - Prerequisites depend on the specific status requirements that are not provided

## 3. Test Implementation Strategy

### Current Status
**Test cannot be implemented** due to insufficient requirement information.

### Required Information to Proceed
To create a meaningful test specification, the following information is needed:

1. **Complete Requirement Text**: The actual status requirements for Serum Potassium Observations
2. **Specific Status Values**: What status values are required, prohibited, or conditional
3. **Context Information**: When and how these status requirements apply
4. **Referenced Profile**: Access to the "Observation-serum-potassium.md" document for detailed specifications

### Potential Test Approach (Once Requirements Are Available)
Based on the requirement summary mentioning "status requirement" and the SHALL conformance level, the test would likely involve:

#### Required FHIR Operations
- **GET** `/Observation` - To retrieve Serum Potassium observations for validation
- Operations would need to be supported per the US Core Server CapabilityStatement

#### Expected Validation Criteria Framework
Once requirements are clarified, validation would likely include:
- Verification of required status values
- Validation against prohibited status values  
- Contextual status requirement checks
- Conformance to US Core Observation profiles

### Recommendation
**Action Required**: Obtain the complete requirement specification from the "Observation-serum-potassium.md" source document to enable proper test design and implementation.

**Note**: The US Core Server CapabilityStatement supports Observation resources and standard FHIR operations, so once the specific status requirements are clarified, appropriate test cases can be developed using the "bring your own data" approach for any Serum Potassium observations in the test system.

---

<a id='req-152'></a>

### REQ-152: Serum Potassium Observation category requirement

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-152

## 1. Requirement ID
REQ-152

## 2. Requirement Analysis

### Testability Assessment
**Not testable due to incomplete requirement specification**

The requirement summary mentions "Serum Potassium Observation category requirement" but provides no actual requirement text, context, or verification details beyond stating it should be tested. Without the specific requirement text, it's impossible to determine what aspect of serum potassium observations should be tested regarding categories.

### Complexity
**Cannot be determined** - Insufficient requirement specification

### Prerequisites
**Cannot be determined** - The requirement lacks sufficient detail to identify prerequisites

## 3. Test Implementation Strategy

### Required Inputs
**Cannot be specified** - The requirement text is missing, making it impossible to determine:
- What specific FHIR resources are needed
- What data elements should be present
- What validation criteria should be applied

### Required FHIR Operations
**Cannot be determined** - Without knowing the specific requirement, it's unclear which operations from the Capability Statement would be relevant. Potentially relevant operations from the US Core Server Capability Statement for Observation resources include:
- `GET [base]/Observation/[id]` (read)
- `GET [base]/Observation?[search parameters]` (search)

### Validation Criteria
**Cannot be specified** - The requirement lacks the necessary detail to establish validation criteria.

## Recommendation

This requirement (REQ-152) needs to be updated with:

1. **Complete requirement text** - What specific aspect of serum potassium observation categories must be tested?
2. **Context** - Under what conditions does this requirement apply?
3. **Verification details** - What specific conformance behavior should be validated?

Common category-related requirements for laboratory observations typically involve:
- Presence of appropriate category codes (e.g., "laboratory")
- Correct coding system usage
- Proper categorization for search functionality

Once the complete requirement specification is provided, a comprehensive test specification can be developed that aligns with the US Core Observation profiles and search capabilities outlined in the Capability Statement.

---

<a id='req-153'></a>

### REQ-153: Serum Potassium Observation code requirement

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-153

## Requirement ID
REQ-153

## Requirement Analysis

### Testability Assessment
**Not Testable** - The requirement text is incomplete, containing only "Serum Potassium Observation code requirement" without specific implementation details. The actual conformance requirements for serum potassium observation codes are not specified in the provided text. This would typically be covered by FHIR validation tools once the complete requirement is defined.

### Complexity
**Cannot be determined** - Without the complete requirement text, complexity cannot be assessed.

### Prerequisites
**Cannot be determined** - Prerequisites would depend on the specific conformance requirements that are not provided in the incomplete requirement text.

## Test Implementation Strategy

### Status
**Test cannot be implemented** due to incomplete requirement specification.

### Required Information Needed
To create a proper test specification, the following information would be needed:

1. **Complete requirement text** - The actual conformance rules for serum potassium observation codes
2. **Specific code systems** - Which coding systems should be supported (e.g., LOINC)
3. **Required codes** - Specific codes that must be supported for serum potassium observations
4. **Binding strength** - Whether the coding requirements are required, extensible, or preferred
5. **Profile constraints** - Any specific US Core profile constraints related to serum potassium observations

### Typical Test Approach for Observation Code Requirements
If this were a complete requirement specifying serum potassium observation codes, the test would likely involve:

#### Required FHIR Operations
- `GET [base]/Observation?patient=[id]&category=laboratory`
- `GET [base]/Observation?patient=[id]&code=[serum-potassium-codes]`

#### Expected Test Pattern
1. Query for laboratory observations for test patients
2. Filter or identify serum potassium observations
3. Validate that serum potassium observations use the required code system(s) and codes
4. Verify conformance to the US Core Laboratory Result Observation Profile

### Recommendation
**This requirement should be completed with specific implementation details before a test can be developed.** The test would likely fall under the existing US Core Observation testing framework once the specific coding requirements are defined.

---

<a id='req-154'></a>

### REQ-154: Serum Potassium Observation value requirement

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-154

## Requirement ID
REQ-154

## Requirement Analysis

### Testability Assessment
**Classification**: Not testable due to insufficient requirement detail

**Rationale**: The requirement summary only states "Serum Potassium Observation value requirement" without specifying what the actual requirement is for the serum potassium observation value. The requirement text, context, and verification fields are empty, making it impossible to determine what specific conformance behavior needs to be tested.

### Complexity
**Not Applicable** - Cannot assess complexity without knowing the specific requirement details.

### Prerequisites
**Cannot be determined** - Prerequisites depend on the actual requirement specification which is not provided.

## Test Implementation Strategy

### Current Status
**Test specification cannot be created** due to incomplete requirement information.

### Required Information for Test Creation
To create a proper test specification for this requirement, the following information would be needed:

1. **Specific Value Requirements**: What constraints or requirements apply to serum potassium observation values (e.g., units, value ranges, mandatory fields)?

2. **Profile Reference**: Which US Core Observation profile should be used for serum potassium observations?

3. **LOINC Codes**: What specific LOINC codes are required for serum potassium observations?

4. **Value Constraints**: Are there specific:
   - Units of measure required (e.g., mEq/L, mmol/L)?
   - Acceptable value ranges?
   - Required data elements beyond the value?

### Recommended Next Steps

1. **Requirement Clarification**: Review the source document (Observation-serum-potassium.md) to extract the actual requirement details.

2. **Profile Analysis**: Examine the US Core Observation profiles to understand serum potassium-specific requirements.

3. **FHIR Operations Assessment**: Once requirements are clarified, determine if testing requires:
   - `GET /Observation` searches
   - `POST /Observation` creation validation
   - Profile validation against US Core constraints

### Note
The US Core Server CapabilityStatement indicates support for Observation resources, which would be relevant once the specific serum potassium requirements are clarified. However, without knowing the actual requirement, no specific test implementation can be designed.

**Recommendation**: This requirement should be marked as "Blocked" until the requirement specification is completed with the necessary detail to enable conformance testing.

---

<a id='req-155'></a>

### REQ-155: TAPS Item Observation status requirement

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-155

## 1. Requirement ID
REQ-155

## 2. Requirement Analysis

### Testability Assessment
**Not testable due to insufficient information** - The requirement text, context, and verification sections are empty, making it impossible to determine what specific aspect of TAPS Item Observation status needs to be tested. The only available information is:
- Actor: Observation System
- Conformance: SHALL
- Source references a TAPS item example (88037-7)

### Complexity
**Cannot be determined** - Without requirement text or context, the complexity cannot be assessed.

### Prerequisites
**Cannot be determined** - The specific prerequisites depend on the actual requirement being tested, which is not provided.

## 3. Test Implementation Strategy

### Required Inputs
**Cannot be specified** - The test inputs depend on the actual requirement details that are missing from the specification.

Based on the source reference to "Observation-TAPS-item-example-88037-7.md", this appears to be related to:
- TAPS (Tobacco, Alcohol, Prescription medication, and other Substance use) screening observations
- LOINC code 88037-7 (which typically relates to substance use screening)
- Observation resources with specific status requirements

### Required FHIR Operations
**Cannot be determined** - Without knowing the specific requirement, it's unclear which operations are needed. However, based on the US Core Server Capability Statement and the Observation System actor, likely operations would include:
- `GET /Observation` (if supported for the relevant observation type)
- Standard FHIR validation operations

### Validation Criteria
**Cannot be specified** - The validation criteria cannot be determined without knowing:
- What specific status requirement needs to be validated
- What constitutes conformant vs. non-conformant behavior
- What the expected status values should be for TAPS item observations

## Recommendation

This requirement specification is incomplete and cannot be tested as written. To make this requirement testable, the following information needs to be provided:

1. **Requirement Text**: Clear description of what status requirement applies to TAPS Item Observations
2. **Context**: Background information about when and how this requirement applies
3. **Verification Details**: Specific criteria for what constitutes conformance
4. **Expected Status Values**: What status values are required, prohibited, or conditional for TAPS observations

Once this information is available, a proper test specification can be created that would likely involve:
- Validating Observation resources with LOINC code 88037-7 or related TAPS codes
- Checking that the `Observation.status` field meets the specified requirements
- Ensuring conformance with US Core Observation profiles if applicable

---

<a id='req-156'></a>

### REQ-156: TAPS Item Observation category requirement

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-156

## 1. Requirement ID
**REQ-156**: TAPS Item Observation category requirement

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Not testable due to insufficient requirement specification

**Rationale**: The provided requirement lacks critical details:
- No specific text describing what the category requirement entails
- Missing context about what TAPS (Tobacco, Alcohol, Prescription medication, and other Substance) item categories are expected
- No explicit conformance criteria specified beyond the SHALL conformance level
- The only reference is to an example file (Observation-TAPS-item-example-88037-7.md) which is not provided

### Complexity
**Not Applicable** - Cannot assess complexity without complete requirement specification

### Prerequisites
**Cannot be determined** - Prerequisites cannot be established without understanding the specific category requirements

## 3. Test Implementation Strategy

### Current Limitations
This requirement cannot be properly tested in its current form due to:

1. **Missing Requirement Text**: The requirement text field is empty, providing no guidance on what specific category requirements must be met
2. **Insufficient Context**: No context is provided about TAPS item categorization rules
3. **Missing Example Reference**: The referenced example file (Observation-TAPS-item-example-88037-7.md) is not available for analysis

### Recommended Next Steps for Requirement Clarification

To make this requirement testable, the following information is needed:

1. **Complete Requirement Text** specifying:
   - What category or categories are required for TAPS item Observations
   - The expected category coding system(s) and codes
   - Any conditional logic for category assignment

2. **Context Documentation** explaining:
   - What constitutes a TAPS item Observation
   - How categories relate to different types of substance use assessments
   - Any relevant value sets or code systems

3. **Example Analysis** from the referenced file showing:
   - Proper category implementation
   - Expected data structure
   - Validation patterns

### Placeholder Test Framework

Once the requirement is properly specified, the test implementation would likely include:

#### Required Inputs
- FHIR Observation resources representing TAPS items
- System capability to retrieve/validate Observation resources

#### Required FHIR Operations
- `GET [base]/Observation` (supported per US Core Server CapabilityStatement)
- Resource validation operations

#### Validation Criteria Framework
- Verify presence of required category elements
- Validate category coding against specified value sets
- Confirm conformance with US Core Observation profile requirements

---

**Note**: This test specification cannot be completed without the full requirement details. Please provide the complete requirement text, context, and referenced example to enable proper test specification development.

---

<a id='req-157'></a>

### REQ-157: TAPS Item Observation code requirement

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-157

## 1. Requirement ID
REQ-157: TAPS Item Observation code requirement

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Not testable due to insufficient information

**Rationale**: The requirement text is incomplete, providing only a summary that mentions "TAPS Item Observation code requirement" without specifying what the actual conformance requirement is. The requirement references an example file (`Observation-TAPS-item-example-88037-7.md`) but the actual conformance criteria are not defined in the provided text.

### Complexity
**N/A** - Cannot assess complexity without complete requirement specification

### Prerequisites
**N/A** - Cannot determine prerequisites without understanding the specific requirement

## 3. Test Implementation Strategy

### Current Limitation
This requirement cannot be properly tested in its current form because:

1. The requirement text is empty/incomplete
2. No specific conformance criteria are provided
3. The actual code requirement is not specified
4. Only a reference to an example file is given without the actual requirement details

### Recommended Action
To make this requirement testable, the following information would be needed:

1. **Complete Requirement Text**: The actual conformance requirement for TAPS Item Observation codes
2. **Specific Code Requirements**: What codes are required, from which code systems
3. **Validation Rules**: What specific validation should be performed on the codes
4. **Context Information**: How this relates to the TAPS (likely referring to a specific clinical assessment or screening tool)

### Potential Test Structure (Once Requirements Are Complete)
If this requirement were to specify code conformance for TAPS Item Observations, the test would likely include:

#### Required Inputs
- FHIR Observation resources representing TAPS items
- System endpoint supporting US Core Server capabilities

#### Required FHIR Operations
- `GET /Observation` (supported per US Core Server CapabilityStatement)
- Potentially `POST /Observation` for testing code validation

#### Validation Criteria (Hypothetical)
- Verify Observation.code contains required TAPS item codes
- Validate code system references
- Confirm code binding strength compliance
- Check for required code attributes

### Recommendation
This requirement should be reviewed and updated with complete conformance criteria before test implementation can proceed. The test specification should be regenerated once the actual requirement details are available.

---

<a id='req-158'></a>

### REQ-158: TAPS Item Observation value requirement

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-158

## 1. Requirement ID
**REQ-158**: TAPS Item Observation value requirement

## 2. Requirement Analysis

### Testability Assessment
**Not testable due to insufficient information** - The requirement summary mentions "TAPS Item Observation value requirement" but the requirement text, context, and verification details are empty. The only available information is a reference to an example file "Observation-TAPS-item-example-88037-7.md" which suggests this relates to a specific TAPS (Tobacco, Alcohol, Prescription medication, and other Substance use) screening item with LOINC code 88037-7.

### Complexity
**Cannot be determined** - Without the actual requirement text and context, complexity assessment is not possible.

### Prerequisites
**Cannot be determined** - Prerequisites cannot be established without knowing the specific requirement details.

## 3. Test Implementation Strategy

### Analysis of Available Information
Based on the limited information provided:
- The requirement relates to TAPS item observations
- LOINC code 88037-7 is referenced in the example filename
- The actor is "Observation System" 
- Conformance level is "SHALL"
- The requirement is not conditional

### Recommendations for Complete Test Specification

To create a proper test specification for this requirement, the following information is needed:

1. **Complete Requirement Text**: The actual requirement statement describing what the TAPS Item Observation value requirement entails
2. **Context Information**: Details about when and how this requirement applies
3. **Verification Details**: Specific criteria for what constitutes compliance
4. **Example Resource**: Access to the referenced example file "Observation-TAPS-item-example-88037-7.md"

### Potential Test Framework (Preliminary)

If this requirement follows typical TAPS screening patterns, the test might involve:

**Required FHIR Operations** (supported by US Core Server CapabilityStatement):
- `GET /Observation` - Read operations for Observation resources
- `GET /Observation?code=88037-7` - Search for specific TAPS item observations

**Potential Validation Criteria** (pending requirement details):
- Verify Observation resources conform to appropriate US Core Observation profiles
- Validate presence and format of observation values for TAPS screening items
- Check conformance with specified value sets or coding requirements
- Ensure proper linkage to patient and encounter resources

### Required Inputs
- **FHIR Resources**: Observation resources representing TAPS screening items
- **Test Data**: Patient data with associated TAPS observations using code 88037-7

### Expected Outputs
- **Validation Results**: Confirmation that TAPS item observations meet the specified value requirements
- **Conformance Report**: Documentation of compliance with the SHALL-level requirement

## Conclusion

This requirement cannot be properly tested without the complete requirement specification. The test specification should be updated once the full requirement text, context, and verification criteria are provided. The current information suggests a focus on TAPS screening observations but lacks the necessary detail to create executable test cases.

---

<a id='req-159'></a>

### REQ-159: Observation SHALL have a status of "Final"

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-159

## 1. Requirement ID
**REQ-159**: Observation SHALL have a status of "Final"

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be programmatically verified by examining the `status` field of Observation resources and confirming it contains the value "final".

### Complexity
**Simple** - This is a straightforward field value validation that requires checking a single element in the Observation resource.

### Prerequisites
- System must support US Core Server capabilities for Observation resources
- Test system must have access to Observation resources that are expected to have final status
- System must support FHIR R4 Observation resource structure

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources that should have final status (specifically those related to 10-minute Apgar scores based on the source context)
- **Test Data**: Any existing Observation resources in the system under test that are expected to conform to this requirement
- **Expected Outputs**: Observation resources with `status` field set to "final"

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations should be supported:

1. **GET /Observation** - Retrieve Observation resources
2. **GET /Observation/[id]** - Retrieve specific Observation by ID
3. **GET /Observation?[search parameters]** - Search for Observations using supported search parameters

*Note: The specific search parameters and detailed operation support should align with the US Core Server CapabilityStatement's Observation resource requirements.*

### Validation Criteria

#### Primary Validation
**Status Field Validation**:
- **Assertion**: For each Observation resource tested, verify that `Observation.status` equals "final"
- **Implementation**: 
  ```
  ASSERT Observation.status = "final"
  ```

#### Test Execution Steps
1. **Resource Retrieval**: Obtain Observation resources through supported FHIR operations
2. **Status Verification**: For each retrieved Observation resource:
   - Locate the `status` element
   - Verify the value is exactly "final" (case-sensitive)
   - Record any non-conforming instances

#### Success Criteria
- **Pass**: All tested Observation resources have `status = "final"`
- **Fail**: Any Observation resource has a `status` value other than "final" or missing status

#### Error Handling
- **Missing Status**: If `Observation.status` is not present, this constitutes a test failure
- **Invalid Status Values**: Any status other than "final" (e.g., "preliminary", "amended", "cancelled") constitutes a test failure

#### Scope Considerations
- Apply this validation to all Observation resources that are expected to represent finalized clinical observations
- Focus particularly on 10-minute Apgar score observations based on the requirement source context
- Test should accommodate "bring your own data" approach by validating whatever Observation resources are available in the test system

---

<a id='req-160'></a>

### REQ-160: Observation SHALL include a category of "Survey"

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-160

## 1. Requirement ID
**REQ-160**: Observation SHALL include a category of "Survey"

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified programmatically by checking that Observation resources contain a category element with the value "Survey".

### Complexity
**Simple** - This is a straightforward validation of a single element value within an Observation resource.

### Prerequisites
- System must support FHIR R4 Observation resources
- System must implement US Core Server capability for Observation resources
- Test data must include Observation resources that should contain the "Survey" category
- Access to FHIR server endpoints supporting Observation resource operations

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Observation resources from the system under test that are expected to have "Survey" category
- Resources should be retrieved using supported search parameters from the Capability Statement

**Expected Outputs:**
- All retrieved Observation resources must contain `category` element with coding system and code indicating "Survey"
- Validation results confirming conformance or non-conformance with specific details of failures

### Required FHIR Operations
Based on the Capability Statement, the following supported operations will be used:

1. **GET /Observation** - Retrieve Observation resources using supported search parameters:
   - `patient` - Search by patient reference
   - `category` - Search by category (can be used to filter for Survey observations)
   - `patient+category` - Combined search parameters
   - `code` - Search by observation code
   - `date` - Search by observation date
   - `status` - Search by observation status

2. **GET /Observation/{id}** - Retrieve specific Observation resources by ID

### Validation Criteria

For each Observation resource retrieved, the test shall verify:

**Primary Assertion:**
- The `Observation.category` element exists and is not empty
- At least one `category` entry contains a coding with:
  - `system` value of `"http://terminology.hl7.org/CodeSystem/observation-category"`
  - `code` value of `"survey"`

**Secondary Validations:**
- The category element structure conforms to FHIR R4 specification
- If multiple categories exist, at least one must be "survey"
- The coding system URI is correctly formatted and accessible

**Test Pass Criteria:**
- All Observation resources that are expected to be survey-based contain the required "Survey" category
- No false positives (non-survey observations incorrectly categorized as surveys)

**Test Fail Criteria:**
- Any Observation resource missing the category element entirely
- Any Observation resource with category element present but lacking "survey" coding
- Incorrect coding system or malformed category structure

**Test Execution Approach:**
1. Query the system for Observation resources using supported search parameters
2. For each returned Observation resource, validate the category requirement
3. Generate detailed results showing:
   - Total number of Observations tested
   - Number passing/failing the category requirement
   - Specific resource IDs and details for any failures
4. Provide summary conformance assessment for the requirement

---

<a id='req-161'></a>

### REQ-161: Observation SHALL include a code for "10 minute Apgar Score"

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-161

## Requirement ID
REQ-161

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified by examining Observation resources to confirm the presence of a code for "10 minute Apgar Score".

### Complexity
**Simple** - The test requires checking for the presence of a specific code value in the Observation.code element.

### Prerequisites
- System must support US Core Observation profiles (confirmed by Capability Statement)
- System must have Observation resources available for testing
- Test data should include Observation resources that represent 10-minute Apgar scores

## Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources from the system under test
- **Expected Code**: LOINC code "9274-2" (10 minute Apgar Score) or equivalent standardized code for 10-minute Apgar scoring
- **Test Scope**: All Observation resources that clinically represent 10-minute Apgar scores

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required for testing:

1. **Search Operations**:
   - `GET [base]/Observation?patient=[patient-id]&category=survey` - Search for survey/assessment observations
   - `GET [base]/Observation?patient=[patient-id]&code=9274-2` - Search for specific Apgar score observations

2. **Read Operations**:
   - `GET [base]/Observation/[id]` - Direct read of specific Observation resources

3. **Search Parameters** (as supported by Capability Statement):
   - `patient` + `category` (SHALL support combination)
   - `patient` + `code` (SHALL support combination)

### Validation Criteria

#### Primary Validation
**Code Presence Check**: Each Observation resource representing a 10-minute Apgar score SHALL contain:
- `Observation.code.coding` element with appropriate code system and code value
- Acceptable code systems include:
  - LOINC: "9274-2" (10 minute Apgar Score)
  - SNOMED CT: equivalent concept if mapped
  - Other standardized terminologies with equivalent semantic meaning

#### Secondary Validations
1. **Code System Validation**: 
   - Verify that the code system URI is properly specified
   - Confirm the code system is appropriate for Apgar scoring

2. **Code Display Validation**:
   - If `Observation.code.coding.display` is present, verify it accurately represents "10 minute Apgar Score" or equivalent

3. **Multiple Coding Support**:
   - System MAY provide multiple codings for the same concept
   - At least one coding SHALL represent the 10-minute Apgar score concept

#### Test Execution Steps
1. **Discovery Phase**:
   - Query for Observation resources using supported search parameters
   - Identify observations that clinically represent 10-minute Apgar scores

2. **Validation Phase**:
   - For each identified 10-minute Apgar score observation:
     - Verify presence of `Observation.code` element
     - Verify at least one `Observation.code.coding` contains appropriate code
     - Validate code system and code value combination

3. **Conformance Assessment**:
   - **PASS**: All 10-minute Apgar score observations contain required code
   - **FAIL**: Any 10-minute Apgar score observation lacks the required code
   - **NOT APPLICABLE**: No 10-minute Apgar score observations found in test data

#### Expected Test Results
- **Assertion**: `Observation.code.coding` contains at least one coding with a code representing "10 minute Apgar Score"
- **Error Handling**: Test should clearly identify any non-conformant observations with specific details about missing or incorrect coding
- **Reporting**: Provide summary of total observations tested and conformance rate

---

<a id='req-162'></a>

### REQ-162: Observation SHALL have a performer

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-162

## 1. Requirement ID
**REQ-162**: Observation SHALL have a performer

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified programmatically by checking for the presence of the `performer` element in Observation resources.

### Complexity
**Simple** - This is a straightforward structural validation that requires checking for the existence of a mandatory field.

### Prerequisites
- Access to a FHIR server implementing US Core Server capabilities
- Observation resources available in the system (any of the supported US Core Observation profiles)
- Read access permissions for Observation resources

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources of any supported US Core profile types:
  - US Core Laboratory Result Observation
  - US Core Vital Signs profiles (Blood Pressure, Heart Rate, Respiratory Rate, etc.)
  - US Core Simple Observation
  - US Core Observation Clinical Result
  - US Core Screening Assessment Observation
  - Any other US Core Observation profile variants
- **Test Data**: Any existing Observation resources in the system under test

### Expected Outputs
- **Pass**: All retrieved Observation resources contain a `performer` element
- **Fail**: One or more Observation resources are missing the `performer` element
- **Test Report**: Summary of total Observations tested and conformance results

### Required FHIR Operations
Based on the US Core Server Capability Statement, the following supported operations will be used:

1. **Search Operations** (using supported search parameters):
   - `GET [base]/Observation?patient={patient-id}`
   - `GET [base]/Observation?category={category}`
   - `GET [base]/Observation?patient={patient-id}&category={category}`
   - `GET [base]/Observation?patient={patient-id}&code={code}`

2. **Read Operations**:
   - `GET [base]/Observation/{id}` for individual resource validation

### Validation Criteria

#### Primary Assertion
For each Observation resource retrieved:
- **PASS**: `Observation.performer` element exists and is not empty
- **FAIL**: `Observation.performer` element is missing or empty

#### Specific Checks
1. **Structural Validation**:
   - Verify `performer` field presence in JSON/XML response
   - Ensure `performer` array contains at least one element
   
2. **Data Type Validation**:
   - Confirm `performer` elements are valid References to appropriate resources (Practitioner, PractitionerRole, Organization, Patient, RelatedPerson, CareTeam)

3. **Profile Coverage**:
   - Test across all US Core Observation profile variants present in the system
   - Ensure requirement applies consistently across different observation types

#### Test Execution Flow
1. **Discovery Phase**: Query for available Observation resources using supported search parameters
2. **Retrieval Phase**: Fetch individual or bundles of Observation resources
3. **Validation Phase**: Check each Observation for `performer` element presence
4. **Reporting Phase**: Aggregate results and report conformance status

#### Success Criteria
- **100% Conformance**: All Observation resources in the system contain the required `performer` element
- **Comprehensive Coverage**: Test includes observations from multiple profiles and categories when available
- **No False Positives**: Test accurately distinguishes between present and absent `performer` elements

#### Failure Scenarios
- Any Observation resource lacking a `performer` element
- `performer` element present but empty (no references)
- System returns Observation resources that cannot be validated due to access restrictions

---

<a id='req-163'></a>

### REQ-163: Observation SHALL have a value with UCUM code

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-163

## 1. Requirement ID
**REQ-163**: Observation SHALL have a value with UCUM code

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified programmatically by examining Observation resources to ensure they contain value elements with proper UCUM coding.

### Complexity
**Simple** - The requirement involves straightforward validation of data elements within Observation resources.

### Prerequisites
- System must support US Core Observation profiles
- Test data should include Observation resources with quantitative measurements
- Access to retrieve Observation resources via FHIR RESTful API
- Understanding of UCUM (Unified Code for Units of Measure) code system

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources that contain quantitative values
- **Test Data Requirements**: 
  - Observations with numeric/quantitative measurements (e.g., vital signs, lab results, assessment scores)
  - Mix of different observation types to ensure broad coverage
  - Resources should represent real-world clinical scenarios

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported:
- **GET** `/Observation/{id}` - Retrieve specific Observation resources
- **GET** `/Observation?[search-parameters]` - Search for Observation resources
- **JSON format support** (SHALL be supported per Capability Statement)
- **XML format support** (SHOULD be supported per Capability Statement)

### Validation Criteria

#### Primary Assertions
1. **UCUM Code Presence**: Each Observation resource with a quantitative value SHALL include a unit code from the UCUM code system
   - Verify `Observation.valueQuantity.code` is present
   - Verify `Observation.valueQuantity.system` equals "http://unitsofmeasure.org"
   - Verify `Observation.valueQuantity.unit` contains human-readable unit description

2. **Value Structure Validation**: For Observations with quantitative measurements
   - Verify `Observation.valueQuantity` element exists when appropriate
   - Verify `Observation.valueQuantity.value` contains numeric data
   - Verify the UCUM code is syntactically valid according to UCUM specification

3. **Code System Compliance**: 
   - Verify the unit code follows UCUM syntax rules
   - Verify the code system URI is correctly specified as "http://unitsofmeasure.org"

#### Test Execution Steps
1. **Resource Discovery**: Retrieve Observation resources from the system under test
2. **Filtering**: Identify Observations that contain quantitative values (valueQuantity present)
3. **UCUM Validation**: For each qualifying Observation:
   - Assert `valueQuantity.system` = "http://unitsofmeasure.org"
   - Assert `valueQuantity.code` is present and non-empty
   - Assert `valueQuantity.unit` is present (recommended but not strictly required by FHIR)
   - Validate UCUM code syntax using UCUM validation rules

#### Success Criteria
- **100% compliance**: All Observation resources with quantitative values must include valid UCUM codes
- **No false positives**: Only Observations with quantitative measurements should be subject to this requirement
- **Proper error handling**: Test should clearly identify which specific Observation resources fail validation

#### Edge Cases to Consider
- Observations with non-quantitative values (valueString, valueBoolean, etc.) should not be subject to this requirement
- Observations with missing value elements should be handled appropriately
- Observations with complex values (valueRange, valueRatio) may have different unit requirements

#### Expected Outcomes
- **Pass**: All Observation resources with valueQuantity elements contain valid UCUM codes in the appropriate system
- **Fail**: One or more Observation resources with quantitative values lack proper UCUM coding
- **Not Applicable**: No Observation resources with quantitative values found in test dataset

This test specification ensures that systems properly implement UCUM coding for quantitative Observation values, supporting interoperability by standardizing unit representations across different healthcare systems.

---

<a id='req-164'></a>

### REQ-164: Observation SHALL have a status of "Final"

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-164

## 1. Requirement ID
**REQ-164**: Observation SHALL have a status of "Final"

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be validated programmatically by checking the `status` field value in Observation resources.

### Complexity
**Simple** - This is a straightforward field validation that requires checking a single element against a specific value.

### Prerequisites
- System must support FHIR R4
- System must implement US Core Server capabilities as defined in the CapabilityStatement
- System must have Observation resources available for testing
- Test system must have read access to Observation resources

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Any Observation resources present in the system under test
- **Expected Outputs**: All retrieved Observation resources must have `status` field set to "final"

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations should be supported:

1. **GET [base]/Observation/[id]** - Read individual Observation resources
2. **GET [base]/Observation** - Search for Observation resources (with appropriate search parameters)

### Validation Criteria

#### Primary Validation
- **Assertion**: Every Observation resource retrieved from the system SHALL have `Observation.status = "final"`
- **Data Type**: The status field must be of type `code`
- **Required Element**: The status field must be present (not null or missing)

#### Test Cases

**Test Case 1: Individual Observation Resource Validation**
- Retrieve individual Observation resources using GET operations
- For each Observation resource:
  - Verify `status` field is present
  - Verify `status` field value equals "final" (case-sensitive)
  - Log any resources that do not meet this requirement as test failures

**Test Case 2: Bulk Observation Resource Validation**
- Perform search operations to retrieve multiple Observation resources
- Apply the same validation logic as Test Case 1 to all returned resources
- Ensure validation covers the entire result set, including paged results if applicable

**Test Case 3: PRAPARE Panel-Specific Validation**
- If PRAPARE panel Observations are present (given the source context), specifically validate these resources
- Use appropriate search parameters to identify PRAPARE-related Observations
- Apply the same status validation requirements

#### Success Criteria
- **Pass**: 100% of Observation resources have `status = "final"`
- **Fail**: Any Observation resource has a status other than "final", missing status field, or null status value

#### Error Handling
- Document any HTTP errors encountered during resource retrieval
- Handle cases where Observation resources may not be available
- Provide clear reporting on the number of resources tested vs. total available

#### Reporting Requirements
- Total number of Observation resources tested
- Number of compliant resources (status = "final")
- Number of non-compliant resources with details of actual status values found
- List of specific resource IDs that failed validation for traceability

---

<a id='req-165'></a>

### REQ-165: Observation SHALL include a category of "SDOH, Survey"

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-165

## 1. Requirement ID
REQ-165

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated through automated examination of Observation resources to verify the presence and correct values of the category field.

### Complexity
**Simple** - The requirement involves checking for specific category values in a single field of an Observation resource.

### Prerequisites
- Access to an Observation System that implements US Core Observation profiles
- Observation resources that are intended to represent SDOH (Social Determinants of Health) survey data
- The system must support the US Core Server CapabilityStatement for Observation resources

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- One or more Observation resources that represent PRAPARE panel or other SDOH survey data
- These Observation resources should be accessible through the system under test

**Expected Outputs:**
- Observation resources with category field containing both "SDOH" and "Survey" category values
- HTTP 200 responses for successful resource retrieval
- Valid FHIR Observation resources conforming to applicable US Core profiles

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required for testing:

1. **GET /Observation/[id]** - Retrieve specific Observation resources by ID
2. **GET /Observation?patient=[patient-id]** - Search for Observations by patient
3. **GET /Observation?category=[category-code]** - Search for Observations by category
4. **GET /Observation?patient=[patient-id]&category=[category-code]** - Combined patient and category search

### Validation Criteria

**Primary Assertions:**
1. **Category Presence Check**: Each Observation resource SHALL contain a `category` array with at least two entries
2. **SDOH Category Validation**: The category array SHALL include an entry with:
   - `coding.system` = "http://terminology.hl7.org/CodeSystem/observation-category" (or equivalent)
   - `coding.code` = "social-history" or appropriate SDOH category code
   - `text` or `coding.display` indicating "SDOH" classification
3. **Survey Category Validation**: The category array SHALL include an entry with:
   - `coding.system` = "http://terminology.hl7.org/CodeSystem/observation-category" (or equivalent)  
   - `coding.code` = "survey" or appropriate survey category code
   - `text` or `coding.display` indicating "Survey" classification

**Test Cases:**

**Test Case 1: Direct Resource Validation**
- Retrieve Observation resources that represent SDOH survey data
- Validate that each resource contains both required category classifications
- Assert that category values are properly coded using standard terminologies

**Test Case 2: Search-Based Validation**
- Search for Observations using category search parameters
- Verify that SDOH survey Observations are returned when searching by either category
- Confirm that returned resources meet the dual category requirement

**Test Case 3: Patient-Specific Validation**
- For a given patient, retrieve all Observation resources
- Filter for those that should represent SDOH survey data (based on code or context)
- Validate that these resources contain both required category values

**Passing Criteria:**
- All SDOH survey Observation resources contain both "SDOH" and "Survey" category classifications
- Category values use appropriate coding systems and codes
- Resources are retrievable through supported search operations
- No SDOH survey Observation resources lack either required category

**Failure Indicators:**
- Observation resources missing either "SDOH" or "Survey" category
- Incorrect coding systems or codes used for category values
- Resources not discoverable through category-based searches
- Invalid or malformed category structures

---

<a id='req-166'></a>

### REQ-166: Observation SHALL include a code for "Social and emotional health"

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-166

## 1. Requirement ID
REQ-166

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be automatically validated by checking if Observation resources contain the required code for "Social and emotional health". The specific code value and system can be verified programmatically.

### Complexity
**Simple** - This is a straightforward validation requirement that checks for the presence of a specific code element in Observation resources.

### Prerequisites
- System must support US Core Observation profiles as specified in the Capability Statement
- Access to Observation resources that should contain social and emotional health data
- Knowledge of the expected code system and value for "Social and emotional health" (likely LOINC code 93040-4 based on the source reference)

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources that are intended to represent social and emotional health assessments
- **Expected Code**: The test should identify what constitutes a valid "Social and emotional health" code (e.g., LOINC 93040-4)
- **Test Data**: Any Observation resources from the system under test that claim to represent social and emotional health data

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for Observation resources:
- **GET /Observation** - Retrieve Observation resources
- **GET /Observation?category={category}** - Search for Observations by category
- **GET /Observation?code={code}** - Search for Observations by specific code
- **GET /Observation?patient={patient}&category={category}** - Search for patient-specific Observations by category

### Validation Criteria

#### Primary Validation
1. **Code Presence Check**: Each Observation resource SHALL contain a `code` element
2. **Social and Emotional Health Code Validation**: The `code` element SHALL include a coding that represents "Social and emotional health"
   - Verify `code.coding` array contains at least one coding with the appropriate system and code
   - Expected system: http://loinc.org
   - Expected code: 93040-4 (or other valid codes for social and emotional health)
   - Expected display: "Social and emotional health" (or equivalent)

#### Secondary Validations
3. **Code System Validation**: Verify that the coding uses the correct code system (LOINC)
4. **Code Value Validation**: Confirm the code value matches the expected value for social and emotional health assessments
5. **Profile Conformance**: Ensure the Observation resource conforms to appropriate US Core Observation profiles

#### Test Assertions for Passing Results
- **PASS**: Observation resource contains `code.coding` with system "http://loinc.org" and code "93040-4" (or other valid social and emotional health code)
- **PASS**: Code display value appropriately represents "Social and emotional health" concept
- **FAIL**: Observation resource lacks the required code element
- **FAIL**: Code element does not contain appropriate coding for social and emotional health
- **FAIL**: Code system is incorrect or missing

#### Implementation Notes
- The test should accommodate variations in how "Social and emotional health" might be coded, while ensuring conformance to the specific requirements
- Consider supporting multiple valid code systems if the implementation guide allows alternatives to LOINC
- Validate against the broader context of PRAPARE panel observations if this requirement is specific to that use case
- Test should work with any conformant Observation data provided by the implementer, focusing on those that claim to represent social and emotional health assessments

---

<a id='req-167'></a>

### REQ-167: Observation SHALL have a status of "Final"

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-167

## 1. Requirement ID
**REQ-167**: Observation SHALL have a status of "Final"

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified programmatically by checking the `status` field value in Observation resources.

### Complexity
**Simple** - This is a straightforward field validation requiring a single attribute check against a specific value.

### Prerequisites
- System under test must implement US Core Server CapabilityStatement
- System must support Observation resources
- Test data must include Observation resources that are expected to have "final" status according to the implementation guide context (CBC platelet observations)

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources from the system under test, specifically those that should conform to the CBC platelets profile or similar clinical observations expected to have final status
- **Data Approach**: "Bring your own data" - testers will use their existing Observation resources
- **System Configuration**: US Core Server implementation with Observation resource support

### Expected Outputs
- All retrieved Observation resources that fall under the scope of this requirement must have `status` field set to "final"
- Confirmation that no Observation resources violate this constraint

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations should be supported and can be used for testing:

1. **GET [base]/Observation/[id]** - Retrieve specific Observation resources by ID
2. **GET [base]/Observation?[parameters]** - Search for Observation resources using supported search parameters
3. **GET [base]/Patient/[id]/Observation** - Retrieve Observations for a specific patient (if supported)

### Validation Criteria

#### Test Case 1: Individual Observation Status Validation
**Objective**: Verify that each Observation resource has status = "final"

**Steps**:
1. Retrieve Observation resources using supported FHIR operations from the system under test
2. For each Observation resource returned:
   - Verify the presence of the `status` field
   - Assert that `status` field value equals "final"

**Pass Criteria**:
- All Observation resources must have `Observation.status = "final"`
- No Observation resource should have any other status value (e.g., "preliminary", "amended", "cancelled", "entered-in-error")

#### Test Case 2: Bulk Observation Status Validation
**Objective**: Validate status compliance across multiple Observation resources

**Steps**:
1. Execute search operations to retrieve sets of Observation resources
2. Iterate through all returned resources in the Bundle
3. Apply the same validation logic as Test Case 1 to each resource

**Pass Criteria**:
- 100% of retrieved Observation resources must have status = "final"
- Test should report any non-compliant resources with their resource ID and actual status value

#### Assertions for Conformance
1. **Field Presence**: `Observation.status` field must be present (not null/empty)
2. **Value Validation**: `Observation.status` must exactly match the string "final"
3. **Data Type Compliance**: Status field must be of type `code` as per FHIR specification
4. **No Exceptions**: All Observation resources in scope must comply without exception

#### Error Handling
- If no Observation resources are available for testing, the test should be marked as inconclusive rather than passed
- Any HTTP errors or invalid FHIR responses should cause test failure with appropriate error reporting
- Document any Observation resources that cannot be evaluated due to access restrictions or system errors

---

<a id='req-168'></a>

### REQ-168: Observation SHALL include a category of "Laboratory"

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-168

## 1. Requirement ID
**REQ-168**: Observation SHALL include a category of "Laboratory"

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated validation of FHIR Observation resources by checking for the presence and value of the `category` element.

### Complexity
**Simple** - The requirement involves a straightforward validation of a single element value in FHIR Observation resources.

### Prerequisites
- System must support US Core Observation profiles, specifically the US Core Laboratory Result Observation Profile
- System must have laboratory Observation data available for testing
- System must support FHIR R4 specification
- Based on the Capability Statement, the system SHALL support Observation search operations with category parameter

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources that represent laboratory results
- **Test Data**: Laboratory Observation instances from the system under test (using "bring your own data" approach)
- **Search Parameters**: Patient ID and category parameters for filtering laboratory observations

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required for testing:

1. **Search Operations**:
   - `GET [base]/Observation?patient=[patient-id]&category=laboratory`
   - `GET [base]/Observation?patient=[patient-id]&category=http://terminology.hl7.org/CodeSystem/observation-category|laboratory`

2. **Read Operations**:
   - `GET [base]/Observation/[id]` for individual observation retrieval

### Validation Criteria

#### Primary Validation
For each Observation resource identified as a laboratory result:

1. **Category Element Presence**: 
   - Verify that `Observation.category` element exists
   - Assert: `Observation.category` is present and not null

2. **Laboratory Category Value**:
   - Verify that at least one `Observation.category` coding contains the "laboratory" category
   - Assert: One of the following conditions is met:
     - `Observation.category.coding.code = "laboratory"`
     - `Observation.category.coding.system = "http://terminology.hl7.org/CodeSystem/observation-category"` AND `Observation.category.coding.code = "laboratory"`

#### Secondary Validation
3. **Search Functionality**:
   - Verify that laboratory observations can be retrieved using category search parameter
   - Assert: `GET [base]/Observation?patient=[patient-id]&category=laboratory` returns the same laboratory observations as manual inspection

4. **Profile Conformance**:
   - Verify that laboratory observations conform to US Core Laboratory Result Observation Profile
   - Assert: Laboratory observations validate against the US Core Laboratory Result Observation Profile structure definition

#### Test Execution Steps
1. **Discovery Phase**:
   - Search for all Observations for test patients: `GET [base]/Observation?patient=[patient-id]`
   - Identify laboratory observations based on context clues (laboratory codes, laboratory reference ranges, etc.)

2. **Direct Validation Phase**:
   - For each identified laboratory observation, validate the category element contains "laboratory"
   - Record any failures where laboratory observations lack the required category

3. **Search Validation Phase**:
   - Execute category-specific search: `GET [base]/Observation?patient=[patient-id]&category=laboratory`
   - Compare results with manually identified laboratory observations
   - Verify all laboratory observations are returned by the category search

#### Pass/Fail Criteria
- **PASS**: All laboratory Observation resources contain `category` with value "laboratory" AND category search returns expected laboratory observations
- **FAIL**: Any laboratory Observation resource missing the required category value OR category search fails to return known laboratory observations

#### Error Handling
- Document any Observation resources that appear to be laboratory results but lack proper categorization
- Report any inconsistencies between manual identification and category-based search results
- Note any system-specific interpretations of "laboratory" category requirements

---

<a id='req-169'></a>

### REQ-169: Observation SHALL include a code for "Platelet count, Blood"

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-169

## Requirement ID
REQ-169

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified by examining Observation resources for the presence of a specific LOINC code for "Platelet count, Blood".

### Complexity
**Simple** - The test requires checking for the presence of a specific code value in the Observation.code element.

### Prerequisites
- System under test must support US Core Laboratory Result Observation Profile
- System must have Observation resources representing laboratory results available for testing
- Test data should include CBC (Complete Blood Count) results with platelet count observations
- System must support FHIR R4 Observation resource read operations

## Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources conforming to US Core Laboratory Result Observation Profile
- **Test Data**: Laboratory results that include platelet count measurements from CBC panels
- **Expected LOINC Code**: `777-3` (Platelets [#/volume] in Blood by Automated count) or equivalent platelet count codes

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for Observation resources:
- `GET [base]/Observation/[id]` - Read specific Observation resources
- `GET [base]/Observation?patient=[patient-id]&category=laboratory` - Search for laboratory observations
- `GET [base]/Observation?patient=[patient-id]&code=777-3` - Search for specific platelet count observations

### Validation Criteria

#### Primary Validation
1. **Code Presence Verification**:
   - Each Observation resource representing a platelet count SHALL have `Observation.code` populated
   - The `Observation.code` SHALL contain a coding with system `http://loinc.org`
   - The code value SHALL be `777-3` (Platelets [#/volume] in Blood by Automated count) or another appropriate LOINC code for platelet count

#### Secondary Validations
2. **Code System Verification**:
   - Verify that the coding system is correctly specified as `http://loinc.org`
   - Confirm the code display text appropriately represents "Platelet count, Blood" or equivalent

3. **Profile Conformance**:
   - Verify the Observation resource conforms to the US Core Laboratory Result Observation Profile
   - Ensure all must-support elements are present as required by the profile

#### Test Execution Steps
1. **Discovery Phase**:
   - Query the system for Observation resources using: `GET [base]/Observation?patient=[patient-id]&category=laboratory`
   - Filter results to identify platelet count observations based on code values

2. **Validation Phase**:
   - For each identified platelet count Observation:
     - Verify `Observation.code` is present and not empty
     - Confirm at least one coding contains system `http://loinc.org`
     - Validate the LOINC code represents platelet count (e.g., `777-3` or equivalent)
     - Check that the code display text is appropriate for platelet count

3. **Conformance Verification**:
   - Validate each Observation against the US Core Laboratory Result Observation Profile
   - Confirm the resource includes all required must-support elements

#### Pass Criteria
- **PASS**: All Observation resources representing platelet count contain appropriate LOINC codes in `Observation.code`
- **FAIL**: Any platelet count Observation lacks the required code or contains incorrect/missing coding system information

#### Expected Test Outcomes
- Successful identification of platelet count observations with proper LOINC coding
- Confirmation that all CBC platelet count results include the mandatory code element
- Validation that the coding follows LOINC standards for platelet count representation

---

<a id='req-170'></a>

### REQ-170: Observation SHALL have a performer

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-170

## 1. Requirement ID
**REQ-170**: Observation SHALL have a performer

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified programmatically by checking for the presence of the `performer` element in Observation resources.

### Complexity
**Simple** - This is a straightforward structural validation that requires checking for the presence of a mandatory element.

### Prerequisites
- System under test must implement US Core Server capabilities for Observation resources
- System must support at least one of the US Core Observation profiles listed in the Capability Statement
- Test data must include Observation resources that should conform to US Core requirements

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources from the system under test that claim conformance to US Core Observation profiles
- **Test Data Source**: Any existing Observation data in the system (leveraging "bring your own data" approach)
- **Profile Context**: Knowledge of which US Core Observation profiles the system claims to support

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and can be used to retrieve test data:

1. **Search Operations**:
   - `GET [base]/Observation?patient={patient-id}`
   - `GET [base]/Observation?category={category}`
   - `GET [base]/Observation?patient={patient-id}&category={category}`
   - `GET [base]/Observation?code={code}`

2. **Read Operations**:
   - `GET [base]/Observation/{id}` (if specific Observation IDs are known)

### Validation Criteria

#### Primary Validation
For each Observation resource retrieved:

1. **Performer Presence Check**:
   - Verify that the `performer` element exists in the Observation resource
   - Assertion: `Observation.performer` is present and not empty
   - Expected Result: PASS if performer element exists, FAIL if absent

#### Secondary Validations
2. **Performer Reference Validity**:
   - Verify that each performer reference is a valid FHIR reference
   - Check that performer references point to appropriate resource types (Practitioner, PractitionerRole, Organization, Patient, RelatedPerson, CareTeam)
   - Assertion: `Observation.performer[*].reference` contains valid reference format

3. **Profile-Specific Validation**:
   - Apply this validation to all US Core Observation profiles supported by the system
   - Ensure the requirement applies consistently across different observation types (lab results, vital signs, clinical results, etc.)

#### Test Execution Steps
1. Query the system for Observation resources using supported search parameters
2. For each returned Observation resource:
   - Parse the resource JSON/XML
   - Check for presence of `performer` element
   - Validate performer reference format if present
   - Record pass/fail result with resource ID for traceability
3. Generate summary report showing:
   - Total Observation resources tested
   - Number passing performer requirement
   - Number failing performer requirement
   - Specific resource IDs that failed validation

#### Expected Test Results
- **PASS**: All Observation resources contain a valid `performer` element
- **FAIL**: Any Observation resource lacks the `performer` element
- **PARTIAL**: Some Observation resources pass while others fail (indicates inconsistent implementation)

#### Error Handling
- Handle cases where Observation resources cannot be retrieved due to access permissions
- Account for empty result sets (no Observation data available)
- Manage network timeouts or server errors during resource retrieval
- Document any resources that cannot be validated due to technical issues

This test specification ensures that the mandatory performer requirement is consistently enforced across all Observation resources in systems claiming US Core conformance, while accommodating existing system data and supporting comprehensive validation across multiple Observation profile types.

---

<a id='req-171'></a>

### REQ-171: Observation SHALL have a value with UCUM code

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-171

## 1. Requirement ID
REQ-171: Observation SHALL have a value with UCUM code

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified through automated validation of Observation resources to ensure values include proper UCUM codes.

### Complexity
**Simple** - The requirement involves straightforward validation of a specific data element (UCUM codes in Observation values) against established coding standards.

### Prerequisites
- Access to a FHIR server implementing US Core Server capabilities
- Observation resources available in the system (preferably CBC platelet observations based on the source context)
- UCUM code validation capability or reference
- Valid authentication/authorization credentials for the FHIR server

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources that contain quantitative values
- **System Under Test**: US Core Server implementation
- **Reference Data**: UCUM code system (http://unitsofmeasure.org) for validation

### Expected Outputs
- Observation resources retrieved from the server
- Validation results confirming UCUM code presence and validity
- Pass/fail determination for each tested Observation

### Required FHIR Operations
Based on the US Core Server Capability Statement, the following operations are supported and will be used:

1. **Search Operation**: `GET [base]/Observation` 
   - Retrieve Observation resources from the server
   - Use appropriate search parameters to filter for quantitative observations
   
2. **Read Operation**: `GET [base]/Observation/[id]`
   - Retrieve specific Observation instances for detailed validation

### Validation Criteria

The following assertions must pass for the requirement to be satisfied:

#### Primary Validation Criteria:
1. **UCUM Code Presence**: For each Observation resource with a quantitative value:
   - `Observation.valueQuantity.code` SHALL be present
   - `Observation.valueQuantity.system` SHALL equal "http://unitsofmeasure.org"

2. **UCUM Code Validity**: 
   - The `Observation.valueQuantity.code` value SHALL be a valid UCUM code
   - The code SHALL conform to UCUM syntax and semantic rules

3. **Value Structure Compliance**:
   - When `Observation.valueQuantity` is present, it SHALL include both `value` and `code` elements
   - The `unit` element SHOULD be present and human-readable

#### Test Execution Steps:
1. **Discovery Phase**:
   - Search for Observation resources: `GET [base]/Observation`
   - Filter results to identify observations with quantitative values

2. **Validation Phase**:
   - For each Observation with `valueQuantity`:
     - Verify `valueQuantity.system` = "http://unitsofmeasure.org"
     - Verify `valueQuantity.code` is present and non-empty
     - Validate `valueQuantity.code` against UCUM specification
     - Confirm `valueQuantity.value` is present when code is specified

3. **Result Assessment**:
   - **PASS**: All tested Observations with quantitative values have valid UCUM codes
   - **FAIL**: Any Observation with quantitative values lacks UCUM codes or contains invalid codes
   - **SKIP**: No Observations with quantitative values found in the system

#### Additional Validation Considerations:
- Test should accommodate various Observation types (vital signs, laboratory results, etc.)
- Handle cases where Observations may have non-quantitative values (valueString, valueBoolean, etc.) - these should be excluded from UCUM validation
- Verify that the requirement applies specifically to quantitative measurements where units are meaningful

#### Error Handling:
- Document any HTTP error responses encountered during resource retrieval
- Report any Observations that have malformed valueQuantity structures
- Handle cases where UCUM validation services are unavailable

---

<a id='req-172'></a>

### REQ-172: Observation SHALL have a status of "Final"

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-172

## 1. Requirement ID
**REQ-172**: Observation SHALL have a status of "Final"

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be validated programmatically by examining the `status` field of Observation resources to ensure it contains the value "final".

### Complexity
**Simple** - This is a straightforward field value validation requiring a single property check against a specific enumerated value.

### Prerequisites
- System must implement US Core Server capabilities for Observation resources
- System must have Observation resources available for testing
- Test client must have read access to Observation resources
- System should support standard FHIR RESTful operations for Observation retrieval

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: One or more Observation resources that should conform to the requirement
- **Test Data**: Any existing Observation resources in the system under test (bring your own data approach)
- **Access Credentials**: Appropriate authentication/authorization to access Observation resources

### Expected Outputs
- **Pass Condition**: All retrieved Observation resources have `status` field set to "final"
- **Fail Condition**: Any Observation resource has a `status` field with a value other than "final"

### Required FHIR Operations
The following operations are supported by the US Core Server CapabilityStatement and can be used for testing:

1. **GET [base]/Observation/[id]** - Read individual Observation resources
2. **GET [base]/Observation** - Search for Observation resources
3. **GET [base]/Observation?patient=[patient-id]** - Search Observations by patient (if patient-scoped testing is desired)

### Validation Criteria

#### Primary Validation
- **Field Validation**: For each Observation resource tested, verify that `Observation.status` equals "final"
- **Data Type Validation**: Confirm that the status field is of type `code` as per FHIR specification
- **Case Sensitivity**: Verify exact match to "final" (FHIR codes are case-sensitive)

#### Test Assertions
1. **Assertion 1**: `Observation.status` field exists and is not null
2. **Assertion 2**: `Observation.status` value equals exactly "final"
3. **Assertion 3**: No Observation resources have status values other than "final" (e.g., "preliminary", "amended", "corrected", "cancelled", "entered-in-error", "unknown")

#### Test Cases
1. **Single Resource Test**: Retrieve individual Observation resources by ID and validate status
2. **Batch Validation Test**: Retrieve multiple Observation resources through search operations and validate all status fields
3. **Patient-Scoped Test**: If patient context is available, retrieve all Observations for specific patients and validate status fields

#### Error Conditions to Check
- Handle cases where Observation resources exist but status field is missing
- Handle cases where status field contains invalid or unexpected values
- Verify appropriate error handling for malformed or incomplete Observation resources

#### Compliance Verification
- Document any non-compliant Observation resources found during testing
- Report the total number of Observation resources tested vs. the number that passed validation
- Ensure 100% compliance rate for the requirement to be considered met (SHALL conformance level)

---

<a id='req-173'></a>

### REQ-173: Observation SHALL include a category of "Laboratory"

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-173

## 1. Requirement ID
REQ-173

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified programmatically by examining the `category` element in Observation resources to confirm the presence of a "Laboratory" category code.

### Complexity
**Simple** - The test involves a straightforward validation of a single element's value in FHIR resources.

### Prerequisites
- System must support the US Core Laboratory Result Observation Profile
- System must have laboratory Observation resources available for testing
- System must support read operations for Observation resources per the Capability Statement

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources that represent laboratory results (specifically those conforming to the US Core Laboratory Result Observation Profile)
- **Test Data**: Any existing laboratory Observation resources in the system under test
- **Access Method**: Direct resource access via read operations or search results containing laboratory observations

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and can be used for testing:

1. **Read Operation**: `GET [base]/Observation/[id]`
2. **Search Operations** (any of the supported combinations):
   - `GET [base]/Observation?patient=[patient-id]&category=laboratory`
   - `GET [base]/Observation?patient=[patient-id]&category=[category-code]`
   - `GET [base]/Observation?patient=[patient-id]&code=[lab-code]`

### Validation Criteria

#### Primary Assertions
1. **Category Element Presence**: Each laboratory Observation resource SHALL contain at least one `category` element
2. **Laboratory Category Value**: At least one `category` element SHALL contain a coding with:
   - **Code**: "laboratory" 
   - **System**: "http://terminology.hl7.org/CodeSystem/observation-category" (recommended)
   - **Alternative acceptable systems**: Any valid coding system that represents laboratory categories

#### Specific Validation Steps
1. **Resource Type Verification**: Confirm the resource is of type "Observation"
2. **Profile Conformance**: Verify the resource claims conformance to US Core Laboratory Result Observation Profile (if meta.profile is present)
3. **Category Array Check**: Ensure `Observation.category` array exists and is not empty
4. **Laboratory Category Validation**: Within the category array, verify at least one category contains:
   - A coding with code "laboratory" OR
   - A coding that semantically represents laboratory categorization from a recognized terminology system
5. **Coding System Validation**: If the system is specified, ensure it's a valid terminology system URI

#### Test Execution Approach
1. **Discover Test Candidates**: Use search operations to identify laboratory Observation resources
2. **Resource Retrieval**: Retrieve individual Observation resources using read operations
3. **Systematic Validation**: Apply validation criteria to each laboratory Observation resource
4. **Result Compilation**: Document any non-conformant resources with specific details about missing or incorrect category values

#### Success Criteria
- **Pass**: All laboratory Observation resources contain the required "Laboratory" category
- **Fail**: Any laboratory Observation resource lacks the required "Laboratory" category or contains incorrect category values

#### Edge Cases to Consider
- Observations with multiple category values (ensure at least one is "laboratory")
- Different capitalization of category codes (should be case-sensitive per FHIR specification)
- Missing category element entirely
- Category present but with incorrect or missing coding system

---

<a id='req-174'></a>

### REQ-174: Observation SHALL include a code for "White blood cell (WBC) count, Blood"

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-174

## Requirement ID
REQ-174

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified programmatically by checking that Observation resources contain the specified code for "White blood cell (WBC) count, Blood".

### Complexity
**Simple** - The requirement involves a straightforward validation of a single code element in Observation resources.

### Prerequisites
- System must support the US Core Laboratory Result Observation Profile
- System must have Observation resources with laboratory results available
- System must support search operations for Observation resources as defined in the US Core Server Capability Statement

## Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources that represent laboratory results, specifically complete blood count (CBC) tests that include white blood cell count
- **Test Data**: Any existing Observation resources in the system that contain WBC count measurements
- **Expected Code**: The test should identify the appropriate LOINC or other standard code for "White blood cell (WBC) count, Blood" (commonly LOINC code 6690-2 "Leukocytes [#/volume] in Blood by Automated count")

### Required FHIR Operations
Based on the US Core Server Capability Statement, the following operations are required:

1. **Search Operation**: `GET [base]/Observation?patient=[patient-id]&category=laboratory`
   - Uses the SHALL support search parameter combination: patient + category
   
2. **Read Operation**: `GET [base]/Observation/[id]`
   - To retrieve individual Observation resources for detailed validation

3. **Optional Enhanced Search**: `GET [base]/Observation?patient=[patient-id]&code=[wbc-code]`
   - Uses the SHALL support search parameter combination: patient + code
   - Can help identify WBC count observations directly

### Validation Criteria

The test SHALL verify that for each Observation resource representing a White blood cell (WBC) count:

1. **Code Presence**: The `Observation.code` element contains a coding that represents "White blood cell (WBC) count, Blood"

2. **Standard Code System**: The code should be from an appropriate standard terminology system such as:
   - LOINC (preferred for laboratory observations)
   - SNOMED CT
   - Other laboratory-specific code systems

3. **Code Validation**: Common acceptable codes include but are not limited to:
   - LOINC 6690-2: "Leukocytes [#/volume] in Blood by Automated count"
   - LOINC 33747-0: "Leukocytes [#/volume] in Blood by Manual count"
   - LOINC 26464-8: "Leukocytes [#/volume] in Blood"

4. **Profile Conformance**: The Observation resource SHOULD conform to the US Core Laboratory Result Observation Profile

### Test Execution Steps

1. **Discovery Phase**:
   - Query for laboratory Observation resources using: `GET [base]/Observation?category=laboratory`
   - Filter results to identify WBC count observations (either by code search or by examining returned resources)

2. **Validation Phase**:
   - For each identified WBC count Observation resource:
     - Verify `Observation.code.coding` contains at least one coding
     - Check that at least one coding represents "White blood cell (WBC) count, Blood"
     - Validate the code system is from a recognized standard terminology

3. **Conformance Check**:
   - Verify the Observation resource validates against the US Core Laboratory Result Observation Profile
   - Confirm the resource includes other required elements per the profile

### Pass/Fail Criteria

**PASS**: All Observation resources representing WBC count contain appropriate standardized codes for "White blood cell (WBC) count, Blood" in the `Observation.code` element.

**FAIL**: Any Observation resource representing WBC count either:
- Lacks a code in the `Observation.code` element
- Contains only non-standard or inappropriate codes
- Uses free text without corresponding standardized codes

### Notes
- The test should accommodate "bring your own data" by working with whatever WBC count observations exist in the test system
- If no WBC count observations are available, the test should report this condition rather than failing
- The test should accept any valid standard code that represents WBC count, not just a single specific code

---

<a id='req-175'></a>

### REQ-175: Observation SHALL have a performer

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-175

## 1. Requirement ID
**REQ-175**: Observation SHALL have a performer

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified programmatically by checking the presence of the `performer` element in Observation resources.

### Complexity
**Simple** - The test involves a straightforward validation of a required field presence in FHIR resources.

### Prerequisites
- Access to a FHIR server implementing US Core Server CapabilityStatement
- Observation resources available on the server (any US Core Observation profile)
- Server must support Observation resource queries as specified in the CapabilityStatement

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Server Endpoint**: Base URL of the FHIR server under test
- **Test Data**: Existing Observation resources on the server (leveraging "bring your own data" approach)
- **Authentication credentials** (if required by the server)

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are supported and required for testing:

1. **Search Operations**:
   - `GET [base]/Observation?patient=[patient-id]`
   - `GET [base]/Observation?category=[category]`
   - `GET [base]/Observation?patient=[patient-id]&category=[category]`

2. **Read Operations**:
   - `GET [base]/Observation/[id]` (for individual resource validation)

### Validation Criteria

#### Primary Validation
For each Observation resource retrieved:
1. **Performer Presence Check**: Verify that the `Observation.performer` element is present and not empty
2. **Performer Cardinality**: Confirm that at least one performer is specified (cardinality: 1..*)
3. **Performer Reference Validity**: Validate that each performer contains a valid reference to:
   - Practitioner
   - PractitionerRole
   - Organization
   - CareTeam
   - Patient
   - RelatedPerson

#### Test Execution Steps
1. **Discovery Phase**:
   - Query the server for available Observation resources using supported search parameters
   - Retrieve a representative sample of Observation resources across different US Core Observation profiles

2. **Validation Phase**:
   - For each retrieved Observation resource:
     - Assert `Observation.performer` element exists
     - Assert `Observation.performer` is not null or empty
     - Assert at least one performer reference is present
     - Validate that performer references follow FHIR reference format

3. **Profile-Specific Testing**:
   - Test across multiple US Core Observation profiles mentioned in the CapabilityStatement:
     - Laboratory Result Observations
     - Vital Signs Observations
     - Clinical Result Observations
     - Screening Assessment Observations
     - And other supported US Core Observation profiles

#### Pass Criteria
- **100% compliance**: ALL Observation resources retrieved must have the `performer` element populated
- No Observation resource should be missing the `performer` element
- All performer references must be syntactically valid FHIR references

#### Fail Criteria
- Any Observation resource lacks the `performer` element
- Any Observation resource has an empty or null `performer` element
- Any performer reference is malformed or invalid

#### Test Coverage Considerations
- Test with different patient populations to ensure broad coverage
- Include Observations from different categories (laboratory, vital-signs, etc.)
- Verify across different time periods using date-based searches
- Test both active and historical Observation records

This test specification ensures comprehensive validation of the performer requirement while accommodating the "bring your own data" testing approach and leveraging the search capabilities defined in the US Core Server CapabilityStatement.

---

<a id='req-176'></a>

### REQ-176: Observation SHALL have a value with UCUM code

**Text**: 

**Context**: 

**Actor**: Observation System

**Conformance**: SHALL

# Test Specification for REQ-176

## 1. Requirement ID
REQ-176

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified programmatically by examining Observation resources to confirm they contain value elements with UCUM codes.

### Complexity
**Simple** - The requirement involves straightforward validation of specific data elements and coding systems within Observation resources.

### Prerequisites
- Access to a FHIR server implementing US Core Server capabilities
- Observation resources containing CBC leukocyte measurements
- Server must support Observation resource queries as per US Core Server CapabilityStatement

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Observation resources representing CBC leukocyte measurements
- Resources should be available on the target FHIR server for testing

**Expected Outputs:**
- Observation resources with populated value elements containing UCUM-coded measurements
- Confirmation that all retrieved observations meet the UCUM coding requirement

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are supported:

1. **GET /Observation** - Retrieve Observation resources
2. **GET /Observation/{id}** - Retrieve specific Observation by ID
3. **GET /Observation?category=laboratory** - Search for laboratory observations (if applicable)
4. **GET /Observation?code={loinc-code}** - Search for specific CBC leukocyte observations

### Validation Criteria

**Primary Assertions:**
1. **Value Presence Check**: Each Observation resource MUST contain at least one value element (valueQuantity, valueCodeableConcept, etc.)

2. **UCUM Code Validation**: For Observation resources with quantitative values:
   - `valueQuantity.system` MUST equal `"http://unitsofmeasure.org"`
   - `valueQuantity.code` MUST contain a valid UCUM code
   - `valueQuantity.unit` SHOULD be present and human-readable

3. **Resource Structure Validation**: 
   - Observation resources MUST be valid against the base FHIR R4 Observation structure
   - Resources SHOULD validate against applicable US Core Observation profiles

**Test Cases:**

**Test Case 1: Single Observation Validation**
- Retrieve an individual Observation resource by ID
- Verify the resource contains a value element with UCUM coding
- Assert that the UCUM code is appropriate for the measurement type

**Test Case 2: Bulk Observation Validation**
- Query for multiple Observation resources (using search parameters)
- Iterate through all returned resources
- Verify each Observation contains properly UCUM-coded values
- Report any non-conforming resources

**Test Case 3: Different Value Types**
- Test Observations with different value types (valueQuantity, valueString, etc.)
- Verify that quantitative measurements use UCUM codes
- Confirm that non-quantitative values are handled appropriately

**Pass Criteria:**
- All Observation resources contain value elements
- All quantitative values use valid UCUM codes from the http://unitsofmeasure.org code system
- No validation errors against FHIR R4 base specifications
- Server returns appropriate HTTP status codes (200 for successful retrieval)

**Failure Conditions:**
- Observation resources missing value elements
- Quantitative values without UCUM coding
- Invalid or non-existent UCUM codes
- Server errors or unexpected HTTP responses

---

<a id='req-177'></a>

### REQ-177: The system shall ensure that the Observation status is set to "Final".

**Text**: 

**Context**: 

**Actor**: Observation system

**Conformance**: SHALL

# Test Specification for REQ-177

## 1. Requirement ID
REQ-177

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated inspection of Observation resources returned by the system. The test can programmatically check the `status` field value in Observation resources.

### Complexity
**Simple** - This is a straightforward field value validation that requires checking a single element in Observation resources.

### Prerequisites
- System must support US Core Server capabilities as defined in the CapabilityStatement
- System must have Observation resources available for testing
- Test client must have appropriate access permissions to retrieve Observation resources
- System should contain CBC erythrocytes observations or similar laboratory observations

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Any existing Observation resources in the system, particularly laboratory observations
- **System Endpoint**: Base FHIR server URL with US Core Server CapabilityStatement support
- **Authentication**: Appropriate credentials/tokens as required by the system

### Expected Outputs
- Observation resources with `status` field set to "final"
- Successful HTTP responses (200 OK) for valid requests
- FHIR-compliant JSON/XML responses containing Observation resources

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations should be supported:

1. **GET /Observation** - Search for observations
2. **GET /Observation/[id]** - Read specific observation by ID
3. **GET /Observation?patient=[reference]** - Search observations by patient (if patient context available)
4. **GET /Observation?category=laboratory** - Search laboratory observations (if supported)

### Validation Criteria

#### Primary Assertion
- **Status Field Validation**: Every returned Observation resource MUST have the `status` element set to exactly "final"
  ```
  Observation.status = "final"
  ```

#### Supporting Validations
- **Field Presence**: The `status` field MUST be present in each Observation resource
- **Data Type Validation**: The `status` field MUST be of type `code`
- **Case Sensitivity**: The value MUST be exactly "final" (lowercase)
- **FHIR Compliance**: All returned resources MUST be valid FHIR Observation resources

#### Test Cases

1. **Individual Observation Retrieval**
   - Retrieve individual Observation resources by ID
   - Assert each resource has `status = "final"`

2. **Observation Search Results**
   - Perform search operations returning multiple Observation resources
   - Assert ALL returned resources have `status = "final"`

3. **Patient-Specific Observations**
   - Search for observations by patient reference (if patient data available)
   - Assert ALL patient-related observations have `status = "final"`

4. **Laboratory Observations**
   - Search for laboratory category observations (when available)
   - Assert ALL laboratory observations have `status = "final"`

#### Pass Criteria
- 100% of retrieved Observation resources have `status = "final"`
- No Observation resources found with status values other than "final"
- All HTTP requests return successful responses with valid FHIR resources

#### Fail Criteria
- Any Observation resource has a `status` value other than "final"
- Any Observation resource is missing the `status` field
- Any Observation resource has an invalid `status` data type
- System returns non-FHIR compliant responses

#### Implementation Notes
- Test should work with existing data in the system (bring your own data approach)
- If no Observation resources exist in the system, the test should report "No data to test" rather than fail
- Test should handle pagination if the system returns large result sets
- Test should verify the requirement applies to all Observation resource types, not just CBC erythrocytes specifically

---

<a id='req-178'></a>

### REQ-178: The system shall categorize the Observation under "Laboratory".

**Text**: 

**Context**: 

**Actor**: Observation system

**Conformance**: SHALL

# Test Specification for REQ-178

## 1. Requirement ID
**REQ-178**: The system shall categorize the Observation under "Laboratory".

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified programmatically by checking the `Observation.category` element for the presence of laboratory-related category codes.

### Complexity
**Simple** - The test involves straightforward validation of a single FHIR element value against expected category codes.

### Prerequisites
- System must support US Core Laboratory Result Observation Profile
- System must have laboratory observation data available
- System must support FHIR Observation resource search operations as defined in the US Core Server Capability Statement

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources that represent laboratory results
- **Test Data**: Any existing laboratory observations in the system being tested
- **Search Parameters**: Patient reference for querying observations

### Required FHIR Operations
Based on the US Core Server Capability Statement, the following operations are required:

1. **Search Operations**:
   - `GET [base]/Observation?patient=[patient-id]&category=laboratory`
   - `GET [base]/Observation?patient=[patient-id]&category=http://terminology.hl7.org/CodeSystem/observation-category|laboratory`

2. **Read Operations**:
   - `GET [base]/Observation/[id]` for individual observation validation

### Validation Criteria

#### Primary Validation
For each Observation resource that represents a laboratory result, verify that:

1. **Category Element Presence**: 
   - `Observation.category` element is present and populated

2. **Laboratory Category Code**:
   - At least one `Observation.category` element contains a coding with:
     - `system`: `http://terminology.hl7.org/CodeSystem/observation-category`
     - `code`: `laboratory`
   - OR contains text indicating "Laboratory" or similar laboratory categorization

#### Secondary Validation
1. **Profile Conformance**:
   - Observations should conform to US Core Laboratory Result Observation Profile
   - Validate against profile constraints for laboratory observations

2. **Search Functionality**:
   - System correctly returns laboratory observations when searching with `category=laboratory` parameter
   - Search results only include observations with appropriate laboratory categorization

#### Test Pass Criteria
- **PASS**: All laboratory observation resources contain appropriate laboratory category coding
- **FAIL**: Any laboratory observation lacks the required laboratory category classification
- **INCONCLUSIVE**: No laboratory observations found in the test data

#### Additional Validation Points
1. Multiple category codes are acceptable as long as at least one indicates laboratory
2. Both coded values and text-only categories should be accepted if they clearly indicate laboratory categorization
3. The category should align with the observation's clinical context and data type

### Test Execution Notes
- Test should work with any laboratory observation data present in the system
- Focus on observations that clinically represent laboratory results (lab values, test results, etc.)
- Exclude observations that are clearly not laboratory-related (vital signs, clinical assessments, etc.) from this specific test
- The test validates conformance to categorization requirements, not the clinical accuracy of the categorization

---

<a id='req-179'></a>

### REQ-179: The system shall record the effective date of the Observation as 2005-07-05.

**Text**: 

**Context**: 

**Actor**: Observation system

**Conformance**: SHALL

# Test Specification for REQ-179

## 1. Requirement ID
**REQ-179**: The system shall record the effective date of the Observation as 2005-07-05.

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement specifies a concrete, verifiable data element (effective date) with a specific expected value that can be validated through automated testing of FHIR Observation resources.

### Complexity
**Simple** - The requirement involves validating a single date field in an Observation resource against a specific expected value.

### Prerequisites
- System must support US Core Server capabilities for Observation resources
- Test data must include Observation resources that are expected to have an effective date of 2005-07-05
- System must be capable of CREATE and/or READ operations for Observation resources
- Test environment must have appropriate Observation resources available for validation

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Observation resources that should contain an effective date of 2005-07-05
- Resources may be existing in the system or provided by the tester following a "bring your own data" approach

**Expected Outputs:**
- Observation resources with `effectiveDateTime` or `effectivePeriod` fields populated with date value of 2005-07-05
- Successful validation that the effective date matches the expected value

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are supported and may be utilized:

1. **READ Operation**: `GET [base]/Observation/[id]`
   - Retrieve specific Observation resources for validation
   
2. **SEARCH Operations**: `GET [base]/Observation?[parameters]`
   - Search for Observation resources that should contain the specified effective date
   - Useful parameters may include patient, category, code, or date ranges

### Validation Criteria

The test shall verify the following assertions to indicate passing:

1. **Primary Assertion - Effective Date Value**:
   - The Observation resource contains an effective date field (`effectiveDateTime` or `effectivePeriod.start`)
   - The date value equals "2005-07-05" (ISO 8601 format: 2005-07-05)
   - If using `effectivePeriod`, the start date must equal 2005-07-05

2. **Secondary Assertions - Data Integrity**:
   - The effective date field is properly formatted according to FHIR date/dateTime specifications
   - The Observation resource is valid according to US Core Observation profiles
   - The effective date is reasonable and consistent with other temporal data in the resource

3. **Conformance Validation**:
   - The Observation resource successfully validates against the appropriate US Core Observation profile
   - Required fields per the US Core specification are present and valid
   - The resource follows FHIR R4 structural requirements

**Test Success Criteria:**
- All targeted Observation resources contain the effective date of 2005-07-05
- No validation errors are returned when processing the resources
- The date format complies with FHIR specifications
- Resources conform to US Core Observation profile requirements

**Test Failure Conditions:**
- Effective date is missing from Observation resources
- Effective date value is not 2005-07-05
- Date format is invalid or non-compliant with FHIR specifications
- Resource fails US Core profile validation
- System returns errors when attempting to read or search for Observation resources

---

<a id='req-180'></a>

### REQ-180: The system shall ensure the Observation value is recorded as 4.58 10*6/uL.

**Text**: 

**Context**: 

**Actor**: Observation system

**Conformance**: SHALL

# Test Specification for REQ-180

## 1. Requirement ID
**REQ-180**

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified programmatically by examining the Observation resource's value field and validating that it contains the specific numeric value with appropriate units.

### Complexity
**Simple** - The requirement involves validating a single data element (value) within an Observation resource for a specific format and unit structure.

### Prerequisites
- System must support US Core Server capabilities for Observation resources
- System must have CBC (Complete Blood Count) erythrocyte observation data available
- Test system must be able to retrieve Observation resources via FHIR API
- Observation resources must conform to US Core Observation profiles

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Observation resources representing CBC erythrocyte measurements
- Resources should contain value measurements for red blood cell counts

**Expected Outputs:**
- Observation resources with properly formatted value fields containing "4.58 10*6/uL" or equivalent structured representation

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are supported and required for testing:

1. **GET /Observation** - Retrieve observation resources
2. **GET /Observation/[id]** - Retrieve specific observation by ID
3. **GET /Observation?category=laboratory** - Search for laboratory observations
4. **GET /Observation?code=789-8** - Search for erythrocyte count observations (using LOINC code)

### Validation Criteria

#### Primary Validation Checks:

1. **Value Presence Validation:**
   - Verify that the Observation resource contains a `value[x]` element
   - Confirm the value element is populated (not null or empty)

2. **Value Format Validation:**
   - Validate that the value is represented as `valueQuantity`
   - Verify the numeric value equals 4.58
   - Confirm the unit structure represents "10*6/uL" or equivalent

3. **Unit Representation Validation:**
   - Check that units are properly encoded using UCUM (Unified Code for Units of Measure)
   - Validate unit field contains appropriate representation for "10*6/uL" such as:
     - `unit: "10*6/uL"`
     - `code: "10*6/uL"` with appropriate system reference
     - Alternative acceptable UCUM representations of the same unit

4. **Data Type Compliance:**
   - Verify the observation value conforms to FHIR Quantity datatype structure
   - Ensure proper decimal precision for the numeric value (4.58)

#### Test Assertion Logic:
**PASS Criteria:**
- Observation.valueQuantity.value = 4.58
- Observation.valueQuantity.unit contains representation of "10*6/uL" or UCUM equivalent
- Observation.valueQuantity.code properly references the unit system
- Resource validates against US Core Observation profile

**FAIL Criteria:**
- Missing value element
- Incorrect numeric value (not 4.58)
- Incorrect or missing unit specification
- Unit does not represent "10*6/uL" or equivalent measure for erythrocyte count

#### Additional Conformance Checks:
- Verify Observation.code appropriately identifies erythrocyte/red blood cell count measurement
- Confirm Observation.category includes "laboratory" when applicable
- Validate resource conforms to US Core Observation Laboratory Result Reporting profile requirements

---

<a id='req-181'></a>

### REQ-181: The system shall ensure the Observation interpretation is recorded as "Normal".

**Text**: 

**Context**: 

**Actor**: Observation system

**Conformance**: SHALL

# Test Specification for REQ-181

## 1. Requirement ID
REQ-181

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated through automated inspection of Observation resources to verify the interpretation field contains "Normal" values.

### Complexity
**Simple** - The requirement involves a straightforward check of a single field value in Observation resources.

### Prerequisites
- System must support US Core Observation profiles (as indicated in Capability Statement)
- System must have Observation resources available for testing
- Test system must have access to read Observation resources via FHIR API
- The system should contain some Observation resources with interpretations recorded (though the specific interpretation values will vary based on the system's data)

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Observation resources conforming to supported US Core Observation profiles, including:
  - US Core Laboratory Result Observation Profile
  - US Core Vital Signs Profile  
  - US Core Observation Clinical Result Profile
  - Other supported US Core Observation profiles as listed in Capability Statement

**Expected Outputs:**
- Observation resources where `Observation.interpretation` field contains CodeableConcept with codes indicating "Normal" status
- Common normal interpretation codes include:
  - `N` (Normal) from http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation
  - `NOR` (Normal) from http://terminology.hl7.org/CodeSystem/v2-0078

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required for testing:

1. **Search Operations:**
   - `GET [base]/Observation?patient=[patient-id]` - Search for patient's observations
   - `GET [base]/Observation?patient=[patient-id]&category=[category]` - Search by patient and category
   - `GET [base]/Observation?patient=[patient-id]&code=[code]` - Search by patient and observation code

2. **Read Operations:**
   - `GET [base]/Observation/[id]` - Direct read of specific Observation resources

### Validation Criteria

**Primary Assertion:**
- For Observation resources that contain an `interpretation` element, verify that at least some contain codes indicating "Normal" status

**Specific Validation Steps:**

1. **Retrieve Observation Resources:**
   - Execute search operations to retrieve available Observation resources
   - Focus on clinical result observations that would typically have interpretations

2. **Interpretation Field Validation:**
   - Verify `Observation.interpretation` field is present where clinically appropriate
   - Check that `Observation.interpretation.coding` contains at least one code indicating normal status
   - Validate against standard interpretation code systems:
     - http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation
     - http://terminology.hl7.org/CodeSystem/v2-0078

3. **Pass Criteria:**
   - **Test passes if:** At least one Observation resource contains `interpretation` field with "Normal" coded values
   - **Test fails if:** No Observation resources contain interpretation fields with normal values, or interpretation fields are consistently absent where they should be present

4. **Additional Validation:**
   - Ensure interpretation codes use proper CodeableConcept structure
   - Verify codes are from recognized terminology systems
   - Confirm that interpretation values are contextually appropriate for the observation type

**Note:** This test accommodates a "bring your own data" approach by searching through existing Observation resources rather than requiring specific test fixtures. The test will work with whatever clinical data exists in the system under test, focusing on the structural and semantic correctness of the interpretation field when present.

---

<a id='req-182'></a>

### REQ-182: The system shall ensure the Observation status for the Apgar Score Panel is set to "Final".

**Text**: 

**Context**: 

**Actor**: Observation system

**Conformance**: SHALL

# Test Specification for REQ-182

## 1. Requirement ID
**REQ-182**: Apgar Score Panel Observation Status Validation

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Automatically testable

This requirement is clearly testable as it specifies a concrete constraint on a specific FHIR element (`Observation.status`) for a particular type of observation (Apgar Score Panel). The requirement can be validated through automated inspection of FHIR resources.

### Complexity
**Level**: Simple

The requirement involves checking a single element value against a specific constraint, making it straightforward to implement and validate.

### Prerequisites
- System must support US Core Server capabilities for Observation resources
- System must be capable of creating/storing Apgar Score Panel observations
- Test data must include Apgar Score Panel observations (either existing in the system or provided by the tester)
- System must support FHIR R4 Observation resource structure

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources**:
- One or more `Observation` resources representing Apgar Score Panel observations
- Resources should be identifiable as Apgar Score Panel observations through:
  - `Observation.code` matching Apgar Score Panel LOINC codes (e.g., "9274-2" for 10-minute Apgar score)
  - `Observation.category` indicating vital signs or survey
  - Component observations for individual Apgar criteria

**Expected Outputs**:
- Validation results confirming all Apgar Score Panel observations have `status` = "final"
- Clear pass/fail indication for each tested observation
- Detailed reporting of any non-conformant observations

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations should be supported:

1. **GET /Observation** - Search for Apgar Score Panel observations
   - Search parameters may include:
     - `code` parameter to filter for Apgar Score Panel codes
     - `category` parameter to filter for appropriate observation categories
     - `patient` parameter if testing specific patient data

2. **GET /Observation/[id]** - Retrieve specific Observation resources for validation

*Note: These operations align with the US Core Server CapabilityStatement requirement to support Observation resource queries.*

### Validation Criteria

**Primary Assertion**:
- For each Observation resource identified as an Apgar Score Panel:
  - `Observation.status` field MUST be present
  - `Observation.status` value MUST equal "final"

**Test Pass Conditions**:
- ALL Apgar Score Panel observations in the test dataset have `status` = "final"
- No exceptions or errors occur during resource retrieval and validation

**Test Fail Conditions**:
- ANY Apgar Score Panel observation has `status` with a value other than "final"
- ANY Apgar Score Panel observation is missing the `status` field
- System errors prevent proper validation of the observations

**Identification Criteria for Apgar Score Panel Observations**:
- `Observation.code.coding` contains LOINC codes associated with Apgar Score Panel (e.g., "9274-2", "9271-8")
- OR `Observation` contains component observations with Apgar-specific LOINC codes
- Resource structure follows the expected Apgar Score Panel profile pattern

**Reporting Requirements**:
- Total count of Apgar Score Panel observations tested
- Count of conformant vs. non-conformant observations
- Specific details for any failing observations including:
  - Resource ID
  - Current status value
  - Expected status value ("final")

---

<a id='req-183'></a>

### REQ-183: The system shall categorize the Apgar Score Panel under "Survey".

**Text**: 

**Context**: 

**Actor**: Observation system

**Conformance**: SHALL

# Test Specification for REQ-183

## 1. Requirement ID
**REQ-183**: The system shall categorize the Apgar Score Panel under "Survey".

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be automatically validated by checking the category field in Apgar Score Panel Observation resources.

### Complexity
**Simple** - The test involves verifying a single field value in FHIR Observation resources.

### Prerequisites
- System must support US Core Server capabilities for Observation resources
- System must have Apgar Score Panel observations available for testing
- Test data should include 10-minute Apgar Score Panel observations as referenced in the source document

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Observation resources representing 10-minute Apgar Score Panels
- Resources should be available in the system under test using implementer's own data

**Expected Outputs:**
- Observation resources with category field properly set to "survey"
- Resources should conform to US Core Observation profile requirements

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are supported and required for testing:

1. **Search Operation**: `GET [base]/Observation`
   - Search for Apgar Score Panel observations using appropriate search parameters
   - Use category search parameter if supported to filter for survey observations

2. **Read Operation**: `GET [base]/Observation/{id}`
   - Retrieve specific Apgar Score Panel observation instances for validation

### Validation Criteria

**Primary Assertion:**
- Each 10-minute Apgar Score Panel Observation resource SHALL contain a `category` element with a coding that indicates "survey"

**Specific Validation Checks:**

1. **Category Presence Validation:**
   - Verify that `Observation.category` field is present and populated
   - Assertion: `Observation.category` exists and is not empty

2. **Category Value Validation:**
   - Verify that at least one category coding indicates "survey"
   - Expected coding system: `http://terminology.hl7.org/CodeSystem/observation-category`
   - Expected code: `survey`
   - Assertion: `Observation.category.coding` contains an entry where `system = "http://terminology.hl7.org/CodeSystem/observation-category"` and `code = "survey"`

3. **Resource Type Validation:**
   - Confirm the resource being tested is actually an Apgar Score Panel observation
   - Verify `Observation.code` contains appropriate LOINC code for 10-minute Apgar Score Panel
   - Expected LOINC code: `9274-2` (10 minute Apgar Score)

**Test Pass Criteria:**
- All identified Apgar Score Panel observations in the system categorize themselves under "survey"
- No Apgar Score Panel observations are found with missing or incorrect category values
- Resources conform to US Core Observation profile structural requirements

**Test Failure Scenarios:**
- Apgar Score Panel observation found without a category element
- Apgar Score Panel observation found with category element but missing "survey" coding
- Apgar Score Panel observation found with incorrect category classification (not "survey")

---

<a id='req-190'></a>

### REQ-190: Observation SHALL specify the status.

**Text**: 

**Context**: 

**Actor**: Observation

**Conformance**: SHALL

# Test Specification for REQ-190

## 1. Requirement ID
**REQ-190**: Observation SHALL specify the status

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be automatically validated by checking the presence and validity of the `status` element in Observation resources.

### Complexity
**Simple** - This is a straightforward presence validation of a required field with enumerated values.

### Prerequisites
- System must support Observation resources as defined in the US Core Implementation Guide
- Test system must have access to Observation resources through supported FHIR operations
- System should implement one or more US Core Observation profiles as indicated in the Capability Statement

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources of any US Core Observation profile type
- **System Under Test**: FHIR server implementing US Core Server capabilities
- **Test Data**: Any existing Observation resources accessible through the system's supported search operations

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for Observation resources:

**Primary Operations:**
- `GET /Observation/{id}` - Read specific Observation resources
- `GET /Observation?patient={patient_id}` - Search Observations by patient
- `GET /Observation?category={category}` - Search Observations by category
- `GET /Observation?patient={patient_id}&category={category}` - Combined search parameters

**Additional Supported Search Operations:**
- `GET /Observation?code={code}`
- `GET /Observation?date={date}`
- `GET /Observation?status={status}`
- Various combination searches as listed in the Capability Statement

### Validation Criteria

**Test Cases:**

#### Test Case 1: Individual Observation Resource Validation
1. **Retrieve Observation resources** using any of the supported search operations
2. **For each Observation resource returned:**
   - **Assert**: `status` element is present
   - **Assert**: `status` value is one of the valid FHIR Observation status codes:
     - `registered`
     - `preliminary` 
     - `final`
     - `amended`
     - `corrected`
     - `cancelled`
     - `entered-in-error`
     - `unknown`

#### Test Case 2: Bundle Response Validation
1. **Execute search operations** that return Bundle resources containing Observation entries
2. **For each Observation entry in the Bundle:**
   - **Assert**: `status` element exists in `resource` object
   - **Assert**: `status` value conforms to required enumeration

#### Test Case 3: Direct Resource Read Validation
1. **Perform direct reads** using `GET /Observation/{id}` for known Observation resource IDs
2. **For each retrieved Observation:**
   - **Assert**: Response is successful (200 OK)
   - **Assert**: `status` field is populated
   - **Assert**: `status` value is valid according to FHIR specification

**Pass Criteria:**
- All retrieved Observation resources contain a `status` element
- All `status` values are valid FHIR Observation status enumeration values
- No Observation resources are missing the `status` element

**Fail Criteria:**
- Any Observation resource lacks a `status` element
- Any `status` value is not a valid FHIR enumeration value
- Any `status` element is present but empty/null

**Coverage Requirements:**
- Test should cover Observation resources from different US Core profiles if multiple are implemented
- Test should validate across different search result sets to ensure comprehensive coverage
- Test should include both individual resource reads and search bundle results

---

<a id='req-191'></a>

### REQ-191: Observation SHALL include a category.

**Text**: 

**Context**: 

**Actor**: Observation

**Conformance**: SHALL

# Test Specification for REQ-191

## 1. Requirement ID
REQ-191

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated programmatically by checking for the presence of the `category` element in Observation resources.

### Complexity
**Simple** - This is a straightforward structural validation that requires checking for the existence of a mandatory field.

### Prerequisites
- FHIR server implementing US Core Observation profiles
- Test system capable of retrieving Observation resources
- Access to patient data containing Observation resources

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources conforming to any of the US Core Observation profiles listed in the Capability Statement
- **Test Data**: Patient data containing various types of observations (lab results, vital signs, screening assessments, etc.)
- **System Under Test**: FHIR server with Observation resource support

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and will be used for testing:

1. **GET [base]/Observation/[id]** - Direct resource retrieval
2. **GET [base]/Observation?patient=[patient-id]** - Search by patient
3. **GET [base]/Observation?patient=[patient-id]&category=[category-code]** - Search by patient and category

### Validation Criteria

#### Primary Test Cases

**Test Case 1: Direct Resource Retrieval Validation**
- **Action**: Retrieve individual Observation resources using `GET [base]/Observation/[id]`
- **Assertion**: Each retrieved Observation resource MUST contain at least one `Observation.category` element
- **Expected Result**: PASS if category element exists, FAIL if category element is missing or empty

**Test Case 2: Patient-Based Search Validation** 
- **Action**: Search for observations by patient using `GET [base]/Observation?patient=[patient-id]`
- **Assertion**: Every Observation resource in the search results MUST contain at least one `Observation.category` element
- **Expected Result**: PASS if all returned observations have category elements, FAIL if any observation lacks a category

**Test Case 3: Category-Based Search Validation**
- **Action**: Perform category-based searches using `GET [base]/Observation?patient=[patient-id]&category=[category-code]` for various category codes (e.g., "laboratory", "vital-signs", "survey")
- **Assertion**: All returned Observation resources MUST contain the `Observation.category` element with the searched category value
- **Expected Result**: PASS if search results contain observations with matching categories, FAIL if category is missing or doesn't match search criteria

#### Profile-Specific Validation

**Test Case 4: Multi-Profile Category Validation**
- **Action**: Test observations conforming to different US Core Observation profiles (Lab Results, Vital Signs, Screening Assessment, etc.)
- **Assertion**: Each observation type MUST have appropriate category values according to its profile requirements
- **Expected Result**: PASS if category values align with profile expectations (e.g., lab results have "laboratory" category, vital signs have "vital-signs" category)

#### Edge Case Testing

**Test Case 5: Multiple Categories Validation**
- **Action**: Retrieve observations that may have multiple category elements
- **Assertion**: At least one `Observation.category` element MUST be present (multiple categories are allowed)
- **Expected Result**: PASS if one or more category elements exist

#### Compliance Verification

**Test Case 6: Server Behavior Validation**
- **Action**: Attempt to create or validate observations without category elements (if server supports write operations)
- **Assertion**: Server SHOULD reject or flag observations missing required category elements
- **Expected Result**: PASS if server enforces category requirement appropriately

### Success Criteria
- **100% compliance**: All retrieved Observation resources contain at least one category element
- **Search consistency**: Category-based searches return only observations with matching category values
- **Profile adherence**: Category values align with the specific US Core Observation profile requirements

### Failure Conditions
- Any Observation resource retrieved without a category element
- Search results containing observations that don't match the specified category criteria
- Inconsistent category values across different retrieval methods for the same observation

---

<a id='req-193'></a>

### REQ-193: The Observation resource SHALL include a status.

**Text**: 

**Context**: 

**Actor**: Observation resource

**Conformance**: SHALL

# Test Specification for REQ-193

## Requirement ID
REQ-193

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated programmatically by checking the presence of the `status` field in Observation resources.

### Complexity
**Simple** - The requirement involves a straightforward validation of a mandatory field presence in FHIR resources.

### Prerequisites
- FHIR server implementing US Core profiles with Observation resource support
- Test system capable of performing FHIR REST API operations
- Access to Observation resources (either existing data or ability to create test resources)
- Authentication credentials if server requires authorization

## Test Implementation Strategy

### Required Inputs
- **FHIR Server Base URL**: The endpoint of the FHIR server under test
- **Authentication credentials**: If required by the server
- **Observation resources**: Either existing Observation resources accessible via the server or the ability to retrieve Observation resources through supported search parameters

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for Observation resources:
- `GET [base]/Observation/{id}` - Read specific Observation resource
- `GET [base]/Observation?patient={patient_id}` - Search Observations by patient
- `GET [base]/Observation?category={category}` - Search Observations by category
- `GET [base]/Observation?status={status}` - Search Observations by status
- Any other supported search combinations as listed in the capability statement

### Test Cases

#### Test Case 1: Validate Status Presence in Individual Observation Resources
**Objective**: Verify that each Observation resource contains a `status` field

**Steps**:
1. Retrieve Observation resources using one of the supported operations:
   - If specific Observation IDs are known: `GET [base]/Observation/{id}`
   - If patient data is available: `GET [base]/Observation?patient={patient_id}`
   - Use any other supported search parameters to retrieve Observation resources
2. For each returned Observation resource, validate the presence of the `status` field
3. Verify that the `status` field is not null or empty

#### Test Case 2: Validate Status Presence in Search Result Bundles
**Objective**: Verify that all Observation resources returned in search bundles contain the `status` field

**Steps**:
1. Execute search operations that return multiple Observation resources:
   - `GET [base]/Observation?patient={patient_id}`
   - `GET [base]/Observation?category={category}`
   - Other supported search combinations
2. Parse the returned Bundle resource
3. For each Observation resource in the Bundle entries, validate the presence of the `status` field
4. Verify that the `status` field is not null or empty

### Validation Criteria

#### Pass Criteria
- **All** retrieved Observation resources MUST contain a `status` field
- The `status` field MUST NOT be null, undefined, or empty string
- The `status` field MUST be present at the root level of the Observation resource structure
- The test passes if 100% of examined Observation resources contain the required `status` field

#### Fail Criteria
- **Any** Observation resource is missing the `status` field
- **Any** Observation resource has a null, undefined, or empty `status` field
- Server returns an error response when attempting to retrieve Observation resources (unless it's a legitimate 404 for non-existent resources)

#### Test Assertions
1. `Assert.IsNotNull(observation.status)` - Status field exists
2. `Assert.IsNotEmpty(observation.status)` - Status field is not empty
3. `Assert.IsTrue(observation.status is valid FHIR code)` - Status contains a valid value according to FHIR specifications

#### Error Handling
- If no Observation resources are available for testing, the test should report this condition rather than pass or fail
- Network errors or server errors should be reported as test infrastructure issues, not conformance failures
- Authentication failures should be reported as configuration issues

#### Reporting Requirements
- Total number of Observation resources examined
- Number of resources with missing `status` field
- Number of resources with null/empty `status` field
- List of specific resource IDs that failed validation (for debugging purposes)
- Overall pass/fail status for the requirement

---

<a id='req-194'></a>

### REQ-194: The Observation resource SHALL include a category.

**Text**: 

**Context**: 

**Actor**: Observation resource

**Conformance**: SHALL

# Test Specification for REQ-194

## 1. Requirement ID
REQ-194

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be automatically validated by examining the structure of Observation resources to verify the presence of the category element.

### Complexity
**Simple** - This is a straightforward structural validation that requires checking for the presence of a mandatory element in the Observation resource.

### Prerequisites
- A FHIR server implementing US Core profiles
- Access to Observation resources that conform to one or more of the supported US Core Observation profiles
- The server must support at least one of the US Core Observation profiles listed in the Capability Statement

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Any Observation resources available in the test system that claim conformance to US Core Observation profiles
- **Profiles to Test**: Any of the 25+ US Core Observation profiles supported according to the Capability Statement:
  - US Core Laboratory Result Observation Profile
  - US Core Vital Signs Profile
  - US Core Blood Pressure Profile
  - US Core Simple Observation Profile
  - US Core Observation Screening Assessment Profile
  - And all other US Core Observation profiles listed in the Capability Statement

### Required FHIR Operations
Based on the Capability Statement, the following search operations are supported for Observation resources:

1. **Search by Patient and Category**: 
   ```
   GET [base]/Observation?patient=[patient-id]&category=[category-code]
   ```

2. **Search by Patient**: 
   ```
   GET [base]/Observation?patient=[patient-id]
   ```

3. **Direct Resource Retrieval** (if resource IDs are known):
   ```
   GET [base]/Observation/[id]
   ```

### Validation Criteria

#### Primary Validation
For each Observation resource retrieved:

1. **Category Element Presence Check**:
   - Verify that the `Observation.category` element is present
   - The category element SHALL NOT be null or empty
   - The category element SHALL contain at least one CodeableConcept

2. **Category Structure Validation**:
   - Each category entry SHOULD be a valid CodeableConcept
   - Each CodeableConcept SHOULD contain at least one coding or text value

#### Test Assertions
- **PASS**: All retrieved Observation resources contain a non-empty category element
- **FAIL**: Any Observation resource is missing the category element or has an empty category array
- **WARNING**: Category is present but contains invalid CodeableConcept structures

#### Test Execution Steps
1. Discover available Observation resources using supported search parameters
2. For each discovered Observation resource:
   - Retrieve the complete resource representation
   - Validate the presence of the category element
   - Verify the category element contains valid data
3. Aggregate results across all tested Observation resources
4. Report compliance rate and any non-conformant instances

#### Expected Test Coverage
- Test should cover Observation resources across multiple US Core profiles if available
- Test should work with any patient data present in the system
- Test should validate both directly accessed resources and resources returned through search operations

#### Error Handling
- Document any Observation resources that cannot be retrieved due to access permissions
- Report any resources that claim US Core profile conformance but fail category validation
- Handle cases where no Observation resources are available for testing (report as inconclusive rather than pass/fail)

---

<a id='req-195'></a>

### REQ-195: The Observation resource SHALL include a code.

**Text**: 

**Context**: 

**Actor**: Observation resource

**Conformance**: SHALL

# Test Specification for REQ-195

## Requirement ID
REQ-195

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified programmatically by checking for the presence of the `code` element in Observation resources.

### Complexity
**Simple** - The requirement involves a straightforward validation of a single mandatory element presence.

### Prerequisites
- FHIR server implementing US Core profiles with Observation resources
- Access to Observation resources through supported FHIR operations
- Test client capable of performing FHIR read/search operations and validating resource structure

## Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources accessible through the test system
- **Expected Outputs**: Validation results indicating presence/absence of the `code` element in each Observation resource tested

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for Observation resources:
- **READ**: `GET [base]/Observation/[id]` - To retrieve specific Observation resources
- **SEARCH**: `GET [base]/Observation?[parameters]` - To retrieve collections of Observation resources using supported search parameters:
  - `patient` (required for most searches)
  - `category`
  - `code` 
  - `date`
  - `status`
  - Combined searches like `patient+category`, `patient+code+date`, etc.

### Validation Criteria

#### Test Case 1: Validate Code Element in Individual Observations
**Objective**: Verify that each Observation resource contains a mandatory `code` element.

**Test Steps**:
1. Retrieve Observation resources using supported operations (READ or SEARCH)
2. For each Observation resource obtained:
   - Check that the `code` element exists
   - Verify that the `code` element is not null or empty
   - Validate that the `code` element follows the expected structure (CodeableConcept)

**Assertions**:
- **PASS**: `code` element is present and properly structured in the Observation resource
- **FAIL**: `code` element is missing, null, or improperly structured

#### Test Case 2: Batch Validation Across Multiple Observations
**Objective**: Ensure consistent presence of `code` element across all accessible Observation resources.

**Test Steps**:
1. Perform search operations to retrieve multiple Observation resources:
   ```
   GET [base]/Observation?patient=[patient-id]
   ```
2. Iterate through all returned Observation resources in the Bundle
3. Apply validation criteria from Test Case 1 to each resource

**Assertions**:
- **PASS**: All Observation resources in the response contain the required `code` element
- **FAIL**: One or more Observation resources lack the required `code` element

#### Test Case 3: Profile-Specific Code Validation
**Objective**: Verify `code` element presence across different US Core Observation profiles supported by the system.

**Test Steps**:
1. Identify which US Core Observation profiles are implemented (based on `meta.profile` or resource content)
2. For each supported profile type, retrieve sample resources using appropriate search parameters:
   - Laboratory results: `GET [base]/Observation?patient=[id]&category=laboratory`
   - Vital signs: `GET [base]/Observation?patient=[id]&category=vital-signs`
   - Social history: `GET [base]/Observation?patient=[id]&category=social-history`
   - etc.
3. Validate `code` element presence for each profile type

**Assertions**:
- **PASS**: `code` element is present in Observation resources across all implemented US Core profiles
- **FAIL**: `code` element is missing in Observation resources for any implemented profile

#### Error Handling Validation
**Objective**: Ensure proper error responses when searching by code parameter.

**Test Steps**:
1. Attempt searches using the `code` parameter to verify the system expects this element:
   ```
   GET [base]/Observation?patient=[id]&code=[valid-code]
   ```
2. Verify that the search executes successfully (indicating code support)

**Assertions**:
- **PASS**: Search operations using `code` parameter execute without structural errors
- **FAIL**: System errors suggest improper `code` element implementation

### Additional Validation Notes
- The validation should accommodate any Observation data present in the system (bring your own data approach)
- Tests should work regardless of the specific clinical content, focusing only on the structural requirement
- Consider testing with various Observation types to ensure broad coverage
- Validation should check for the element's presence but not necessarily its clinical validity (content validation is separate from structural conformance)

---

<a id='req-196'></a>

### REQ-196: The Observation resource SHALL include a subject.

**Text**: 

**Context**: 

**Actor**: Observation resource

**Conformance**: SHALL

# Test Specification for REQ-196

## 1. Requirement ID
REQ-196

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated through automated testing by examining the structure of Observation resources to verify the presence of the subject element.

### Complexity
**Simple** - The requirement involves a straightforward structural validation of a single mandatory element within the Observation resource.

### Prerequisites
- System must support US Core Observation profiles as indicated in the Capability Statement
- Test data must include Observation resources in the system
- System must support FHIR R4 JSON format (required per Capability Statement)
- Appropriate authentication/authorization must be configured for API access

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources present in the test system
- **Authentication**: Valid credentials with appropriate scopes to read Observation resources
- **System Endpoint**: Base FHIR server URL supporting US Core capabilities

### Expected Outputs
- Retrieved Observation resources in JSON format
- Validation results indicating presence or absence of subject element
- Test pass/fail status for each Observation resource examined

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for Observation resources:

1. **Search Operations**:
   - `GET [base]/Observation?patient=[patient-id]` - Search by patient
   - `GET [base]/Observation?category=[category]` - Search by category  
   - `GET [base]/Observation?code=[code]` - Search by code
   - `GET [base]/Observation?status=[status]` - Search by status
   - Combined searches as supported per Capability Statement

2. **Read Operations**:
   - `GET [base]/Observation/[id]` - Direct resource retrieval (if resource IDs are known)

### Validation Criteria

For each Observation resource retrieved, the test must verify:

**Primary Assertion**:
- The Observation resource SHALL contain a `subject` element
- The `subject` element SHALL NOT be null or empty
- The `subject` element SHALL contain a valid reference (either relative or absolute)

**Specific Validation Steps**:

1. **Structural Presence Check**:
   ```
   ASSERT: observation.subject exists
   ASSERT: observation.subject is not null
   ```

2. **Reference Validity Check**:
   ```
   ASSERT: observation.subject.reference exists OR observation.subject.identifier exists
   ASSERT: if observation.subject.reference exists, it follows FHIR reference format
   ```

3. **Compliance Verification**:
   ```
   ASSERT: subject reference is not empty string
   ASSERT: subject contains either reference, identifier, or display (at minimum reference or identifier)
   ```

**Test Execution Approach**:
1. Query the system for Observation resources using supported search parameters
2. For each returned Observation resource, validate the presence and structure of the subject element
3. Record results for each resource tested
4. Generate summary report indicating overall conformance

**Success Criteria**:
- 100% of retrieved Observation resources contain a valid subject element
- All subject elements contain appropriate reference information
- No Observation resources fail the subject validation check

**Failure Scenarios**:
- Any Observation resource missing the subject element
- Subject element present but null/empty
- Subject element present but lacking valid reference information

---

<a id='req-197'></a>

### REQ-197: The Observation resource SHALL include an effective date/time.

**Text**: 

**Context**: 

**Actor**: Observation resource

**Conformance**: SHALL

# Test Specification for REQ-197

## 1. Requirement ID
REQ-197

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be validated programmatically by checking for the presence and validity of the effective date/time element in Observation resources.

### Complexity
**Simple** - The requirement involves a straightforward validation of a single mandatory element within the Observation resource structure.

### Prerequisites
- Access to a FHIR server implementing US Core Server capabilities
- Observation resources available for testing (using "bring your own data" approach)
- FHIR client capable of performing RESTful operations
- Understanding of FHIR dateTime and Period data types for effective[x] element

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- One or more Observation resources stored on the server under test
- Resources should represent real-world clinical data scenarios

**Expected Outputs:**
- Observation resources with populated `effective[x]` element
- Valid date/time values in appropriate FHIR data types (dateTime, Period, Timing, or instant)

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are required:

1. **GET [base]/Observation/[id]** - Retrieve specific Observation resources by ID
2. **GET [base]/Observation** - Search for Observation resources (with appropriate search parameters)

*Note: These operations are supported by the US Core Server CapabilityStatement which defines comprehensive RESTful capabilities for Observation resources.*

### Validation Criteria

**Primary Assertions:**
1. **Presence Check**: Every retrieved Observation resource MUST contain an `effective[x]` element
   - Verify that the effective element exists and is not null/empty
   - Acceptable effective element variants: `effectiveDateTime`, `effectivePeriod`, `effectiveTiming`, or `effectiveInstant`

2. **Data Type Validation**: The effective date/time MUST use valid FHIR data types
   - If `effectiveDateTime`: Validate against FHIR dateTime format (YYYY-MM-DDTHH:mm:ss+zz:zz)
   - If `effectivePeriod`: Validate Period structure with start and/or end elements
   - If `effectiveTiming`: Validate Timing structure according to FHIR specification
   - If `effectiveInstant`: Validate instant format with required precision

3. **Content Validation**: The date/time value MUST be meaningful and reasonable
   - Date should not be in the future (unless specifically appropriate for the observation type)
   - Date should be within a reasonable historical range
   - For Period types, start date should precede or equal end date

**Test Execution Steps:**
1. Query the server for available Observation resources using search operations
2. For each retrieved Observation resource:
   - Parse the resource structure
   - Locate the `effective[x]` element
   - Validate presence (SHALL requirement)
   - Validate data type conformance
   - Validate content reasonableness
3. Document any resources that fail the effective date/time requirement
4. Calculate pass/fail rate across all tested Observation resources

**Pass Criteria:**
- 100% of tested Observation resources MUST contain a valid effective date/time element
- All effective date/time values MUST conform to FHIR data type specifications

**Failure Scenarios:**
- Any Observation resource missing the `effective[x]` element
- Invalid date/time formats that don't conform to FHIR specifications
- Logically inconsistent date ranges (e.g., Period.end before Period.start)

---

<a id='req-198'></a>

### REQ-198: The Observation resource SHALL include a performer.

**Text**: 

**Context**: 

**Actor**: Observation resource

**Conformance**: SHALL

# Test Specification: REQ-198

## 1. Requirement ID
REQ-198

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated programmatically by checking the presence and structure of the `performer` element in Observation resources.

### Complexity
**Simple** - The requirement involves a straightforward validation of a mandatory field presence in FHIR resources.

### Prerequisites
- Access to a FHIR server implementing US Core Observation profiles
- Valid Observation resources available in the system
- Read access to Observation resources via FHIR REST API

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Any existing Observation resources in the test system that conform to US Core Observation profiles
- **System Access**: FHIR server endpoint with Observation resource support
- **Authentication**: Valid credentials/tokens if required by the server

### Expected Outputs
- Observation resources retrieved from the server
- Validation results confirming presence of `performer` element in each Observation
- Pass/fail determination for each tested Observation resource

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for Observation resources:

1. **Search Operations** (using supported search parameters):
   - `GET [base]/Observation?patient=[id]` - Search by patient
   - `GET [base]/Observation?category=[code]` - Search by category
   - `GET [base]/Observation?code=[code]` - Search by observation code
   - `GET [base]/Observation?status=[status]` - Search by status
   - `GET [base]/Observation?date=[date]` - Search by date
   - `GET [base]/Observation?_lastUpdated=[timestamp]` - Search by last updated

2. **Read Operations**:
   - `GET [base]/Observation/[id]` - Read specific Observation by ID

### Validation Criteria

#### Primary Validation
For each Observation resource retrieved:

1. **Performer Presence Check**:
   - Assert that `Observation.performer` element exists
   - Assert that `Observation.performer` is not null or empty
   - Assert that `Observation.performer` contains at least one reference

#### Secondary Validation
2. **Performer Structure Validation**:
   - If `performer` is present, validate that each performer entry contains a valid reference
   - Verify that `performer.reference` follows FHIR reference format (e.g., "Practitioner/123", "Organization/456")
   - Optionally validate that referenced resources exist if display names are not provided

#### Test Execution Steps
1. **Discovery Phase**:
   - Query the server to retrieve available Observation resources using supported search parameters
   - Identify US Core Observation profile instances using `_profile` parameter or `meta.profile` element

2. **Validation Phase**:
   - For each retrieved Observation resource:
     - Parse the JSON/XML response
     - Locate the `performer` element
     - Validate presence and structure according to criteria above
     - Record pass/fail status with specific error messages

3. **Reporting Phase**:
   - Generate test report showing:
     - Total number of Observation resources tested
     - Number of resources with valid `performer` elements
     - Number of resources failing validation
     - Specific failure details for non-conformant resources

#### Pass Criteria
- **Individual Resource**: An Observation resource passes if it contains at least one `performer` element with a valid reference structure
- **Overall Test**: The test passes if ALL tested Observation resources contain the required `performer` element

#### Fail Criteria
- **Individual Resource**: An Observation resource fails if:
  - `performer` element is missing
  - `performer` element is present but empty/null
  - `performer` references are malformed or invalid
- **Overall Test**: The test fails if ANY tested Observation resource lacks a valid `performer` element

#### Edge Cases to Consider
- Observation resources with multiple performers (should still pass)
- Different performer reference types (Practitioner, Organization, Patient, etc.)
- Performer references with display names vs. without display names
- Contained vs. external references in performer field

---

<a id='req-268'></a>

### REQ-268: The system SHALL support the 'final' status for smoking status observations.

**Text**: 

**Context**: 

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-268

## Requirement ID
REQ-268

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified by examining Observation resources that represent smoking status and confirming they support the 'final' status value.

### Complexity
**Simple** - The requirement is straightforward: verify that the system can handle smoking status observations with a 'final' status.

### Prerequisites
- System must have implemented the US Core Smoking Status Observation Profile
- System must have smoking status observation data available for testing
- System must support Observation resource read operations as specified in the Capability Statement

## Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: 
  - Observation resources conforming to US Core Smoking Status Observation Profile
  - Patient resources (referenced by smoking status observations)
- **Data Requirements**: 
  - At least one smoking status observation with `status = 'final'`
  - Valid patient reference in the observation

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required for testing:

1. **Search Operations**:
   - `GET [base]/Observation?patient=[patient-id]&category=social-history`
   - `GET [base]/Observation?patient=[patient-id]&code=72166-2` (smoking status LOINC code)

2. **Read Operations**:
   - `GET [base]/Observation/[observation-id]`

3. **Search Parameter Support** (per Capability Statement):
   - `patient` (reference) - **SHALL** support
   - `category` (token) - **SHALL** support  
   - `code` (token) - **SHALL** support

### Validation Criteria

#### Primary Validation
1. **Status Value Verification**:
   - Locate smoking status observations in the system
   - Verify that at least one observation has `Observation.status = 'final'`
   - Confirm the observation conforms to US Core Smoking Status Observation Profile

#### Secondary Validations
2. **Profile Conformance**:
   - Verify observations validate against US Core Smoking Status Observation Profile
   - Confirm `Observation.category` includes social-history category
   - Verify `Observation.code` uses appropriate smoking status codes (e.g., LOINC 72166-2)

3. **Resource Integrity**:
   - Verify smoking status observations with 'final' status have required elements populated
   - Confirm valid patient references
   - Verify effective date/time is present

#### Success Criteria
**Test passes when**:
- At least one smoking status observation is found with `status = 'final'`
- The observation successfully validates against the US Core Smoking Status Observation Profile
- All required must-support elements are present and valid
- The observation can be successfully retrieved via supported search parameters

**Test fails when**:
- No smoking status observations with 'final' status are found
- Observations with 'final' status fail profile validation
- Required search operations are not supported
- Critical must-support elements are missing or invalid

### Additional Test Considerations
- Test should accommodate various smoking status codes (current smoker, former smoker, never smoked, etc.)
- Verify the system handles 'final' status consistently across different smoking status values
- Confirm that observations with 'final' status are returned in search results appropriately

---

<a id='req-269'></a>

### REQ-269: The system SHALL support the 'entered-in-error' status for smoking status observations.

**Text**: 

**Context**: 

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-269

## 1. Requirement ID
REQ-269

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated testing by examining FHIR Observation resources that conform to the US Core Smoking Status Observation Profile and validating that the system supports the 'entered-in-error' status value.

### Complexity
**Simple** - The requirement involves validating support for a specific status value in a well-defined FHIR resource profile.

### Prerequisites
- System must implement US Core Server capabilities as defined in the US Core Server CapabilityStatement
- System must support the US Core Smoking Status Observation Profile (as indicated in the Observation capabilities)
- System must have Observation resources with smoking status category available for testing
- Test data must include at least one smoking status observation with 'entered-in-error' status

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources conforming to US Core Smoking Status Observation Profile
- **Test Data Requirements**: 
  - At least one Observation resource with:
    - `category` containing smoking status code (typically from `http://terminology.hl7.org/CodeSystem/observation-category`)
    - `code` from the smoking status value set
    - `status` set to 'entered-in-error'
    - Valid `subject` reference to a Patient resource

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required for testing:

1. **Search Operations**:
   - `GET [base]/Observation?patient=[patient-id]&category=[smoking-status-category]`
   - `GET [base]/Observation?patient=[patient-id]&code=[smoking-status-code]`

2. **Read Operations**:
   - `GET [base]/Observation/[observation-id]`

### Validation Criteria

#### Primary Validation Checks
1. **Status Value Support**: 
   - Verify that the system can store and retrieve Observation resources with `status` = 'entered-in-error'
   - Confirm the status value conforms to the FHIR ObservationStatus value set

2. **Profile Conformance**:
   - Validate that observations with 'entered-in-error' status still conform to the US Core Smoking Status Observation Profile
   - Ensure all required profile elements are present and valid

3. **Search Functionality**:
   - Verify that observations with 'entered-in-error' status are returned in search results when appropriate search parameters are used
   - Confirm that status-based filtering works correctly if supported by the system

#### Specific Test Cases

**Test Case 1: Retrieve Smoking Status Observations with entered-in-error Status**
- Execute: `GET [base]/Observation?patient=[patient-id]&category=social-history`
- Assert: Response includes observations with `status` = 'entered-in-error' if such data exists
- Verify: Each returned observation conforms to US Core Smoking Status Observation Profile

**Test Case 2: Direct Resource Read**
- Execute: `GET [base]/Observation/[observation-id]` for a known smoking status observation with entered-in-error status
- Assert: Response returns the observation with `status` = 'entered-in-error'
- Verify: Resource structure and content conform to the profile requirements

**Test Case 3: Status Value Validation**
- For each smoking status observation with entered-in-error status:
  - Assert: `status` field contains exactly 'entered-in-error'
  - Assert: Status value is from the appropriate FHIR value set
  - Verify: No additional validation errors are present

#### Success Criteria
- System successfully stores and retrieves smoking status observations with 'entered-in-error' status
- All observations maintain conformance to the US Core Smoking Status Observation Profile regardless of status
- Search operations return appropriate results including observations with 'entered-in-error' status
- No FHIR validation errors occur when processing observations with this status value

#### Failure Indicators
- System rejects or fails to process observations with 'entered-in-error' status
- Profile validation failures occur specifically related to the status field
- Search operations exclude observations with 'entered-in-error' status inappropriately
- Status value is not properly encoded according to FHIR specifications

---

<a id='req-328'></a>

### REQ-328: Conformant systems must support the minimum value set of category codes.

**Text**: 

**Context**: ValueSet: US Core Screening Assessment Observation Category

**Actor**: Conformant system

**Conformance**: SHALL

# Test Specification for REQ-328

## 1. Requirement ID
**REQ-328**: Conformant systems must support the minimum value set of category codes.

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified by examining the supported value set for the US Core Screening Assessment Observation Category and validating that conformant systems support the minimum required category codes.

### Complexity
**Simple** - The test involves validating value set support, which is a straightforward verification of supported codes.

### Prerequisites
- System must support US Core Observation Screening Assessment Profile
- System must have Observation resources with screening assessment category codes
- Access to the US Core Screening Assessment Observation Category ValueSet definition
- Test data containing Observation resources that use screening assessment categories

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Observation resources conforming to US Core Observation Screening Assessment Profile
- ValueSet resource for US Core Screening Assessment Observation Category
- Patient resources (as subjects for the observations)

**Expected Outputs:**
- Successful retrieval and validation of Observation resources with category codes from the minimum value set
- Confirmation that the system supports the required category codes as defined in the US Core Screening Assessment Observation Category ValueSet

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required:

1. **Search Operations:**
   - `GET [base]/Observation?patient=[id]&category=[category-code]` - Search for screening assessment observations by patient and category
   - `GET [base]/Observation?[parameter=value]&_revinclude=Provenance:target` - Include provenance information

2. **Read Operations:**
   - `GET [base]/Observation/[id]` - Retrieve specific observation resources

3. **ValueSet Operations (if supported):**
   - `GET [base]/ValueSet/[id]/$expand` - Expand the US Core Screening Assessment Observation Category ValueSet to verify supported codes

### Validation Criteria

**Primary Validation Checks:**

1. **Category Code Presence Validation:**
   - Verify that Observation resources with screening assessment context contain `category` elements
   - Confirm that category codes are from the US Core Screening Assessment Observation Category ValueSet

2. **Minimum ValueSet Support Validation:**
   - Retrieve the US Core Screening Assessment Observation Category ValueSet
   - Verify that the system supports all codes defined as minimum requirements in the value set
   - Confirm that search operations using category codes return appropriate results

3. **Search Functionality Validation:**
   - Execute search queries using `patient + category` parameter combinations (SHALL support per Capability Statement)
   - Verify that searches with category codes from the minimum value set return relevant screening assessment observations
   - Confirm that invalid or unsupported category codes are handled appropriately

4. **Profile Conformance Validation:**
   - Validate that returned Observation resources conform to the US Core Observation Screening Assessment Profile
   - Verify that the category binding is correctly implemented according to the profile requirements

**Specific Assertions for Test Passing:**

- **Assertion 1:** All screening assessment observations retrieved contain at least one category code from the US Core Screening Assessment Observation Category ValueSet
- **Assertion 2:** Search operations using category codes from the minimum value set successfully return matching observations
- **Assertion 3:** The system demonstrates support for the complete minimum set of category codes as defined in the ValueSet
- **Assertion 4:** Category codes are properly structured with both system and code values when present
- **Assertion 5:** Retrieved observations validate against the US Core Observation Screening Assessment Profile

**Test Success Criteria:**
- All assertions pass without errors
- System demonstrates consistent support for the minimum category codes across different search operations
- No validation errors occur when processing observations with the required category codes
- Search operations return expected results for all supported category codes from the minimum value set

---

<a id='req-423'></a>

### REQ-423: The USCoreVitalSignsProfile SHALL map the Observation device to SNOMED CT concept < 49062001.

**Text**: 

**Context**: USCoreVitalSignsProfile SNOMED CT Concept Domain Binding for Observation.device mapping.

**Actor**: USCoreVitalSignsProfile

**Conformance**: SHALL

# Test Specification for REQ-423

## 1. Requirement ID
**REQ-423**: USCoreVitalSignsProfile SHALL map the Observation device to SNOMED CT concept < 49062001

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated through automated testing by examining Observation resources that conform to the USCoreVitalSignsProfile and verifying that any device references use appropriate SNOMED CT codes that are descendants of concept 49062001 (Medical device).

### Complexity
**Simple** - This is a straightforward validation of SNOMED CT concept hierarchy compliance for a specific element in the USCoreVitalSignsProfile.

### Prerequisites
- Access to a FHIR server implementing US Core Server CapabilityStatement
- SNOMED CT terminology service or local terminology validation capability
- Knowledge of SNOMED CT concept 49062001 hierarchy (Medical device)
- Test data containing USCoreVitalSignsProfile Observation resources with device references

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: 
  - Observation resources conforming to USCoreVitalSignsProfile that contain `device` elements
  - Device resources referenced by the Observation.device elements (if using references)
- **Terminology Resources**:
  - Access to SNOMED CT terminology to validate concept hierarchy
  - SNOMED CT concept 49062001 (Medical device) and its descendants

### Expected Outputs
- Validation results confirming all device mappings use SNOMED CT codes that are proper descendants of 49062001
- Clear identification of any non-conformant device mappings

### Required FHIR Operations
Based on the US Core Server CapabilityStatement:
1. **GET /Observation** - Retrieve Observation resources conforming to USCoreVitalSignsProfile
2. **GET /Device** - Retrieve referenced Device resources (if device is referenced rather than coded inline)
3. **GET /ValueSet** or terminology service calls - Validate SNOMED CT concept hierarchy

### Validation Criteria

#### Primary Validation Checks:
1. **Profile Conformance**: Verify that Observation resources claim conformance to USCoreVitalSignsProfile via `meta.profile`

2. **Device Element Presence**: For each USCoreVitalSignsProfile Observation:
   - If `device` element is present, proceed with validation
   - If `device` element is absent, test passes (element is not required to be present)

3. **SNOMED CT Concept Validation**: For each device mapping:
   - **Direct Coding**: If `device` contains a CodeableConcept with SNOMED CT coding:
     - Verify the SNOMED CT code is a descendant of 49062001
   - **Device Reference**: If `device` contains a reference to a Device resource:
     - Retrieve the referenced Device resource
     - Examine Device.type for SNOMED CT codings
     - Verify any SNOMED CT codes are descendants of 49062001

4. **Terminology Hierarchy Check**: 
   - Validate that each SNOMED CT code used is semantically "IS-A" descendant of 49062001 (Medical device)
   - This can be done via:
     - FHIR terminology service $validate-code operation
     - SNOMED CT concept model traversal
     - Pre-computed hierarchy lookup

#### Pass Criteria:
- All USCoreVitalSignsProfile Observation resources with device elements use only SNOMED CT codes that are proper descendants of concept 49062001
- No device mappings use SNOMED CT codes outside the 49062001 hierarchy
- All referenced Device resources (if applicable) conform to the same constraint

#### Fail Criteria:
- Any device mapping uses a SNOMED CT code that is not a descendant of 49062001
- Device mappings use non-SNOMED CT terminologies where SNOMED CT is required
- Referenced Device resources contain non-conformant SNOMED CT codes

#### Test Execution Notes:
- Test should accommodate various device reference patterns (direct coding vs. Device resource references)
- Should handle cases where no device element is present (not a failure condition)
- Must verify both direct codings in Observation.device and codings in referenced Device resources
- Should provide clear error messages identifying specific non-conformant codes and their relationship to the required hierarchy

---

<a id='req-424'></a>

### REQ-424: The USCoreObservationPregnancyStatusProfile SHALL map the Observation identifier to Event.identifier.

**Text**: 

**Context**: Workflow Pattern mapping for USCoreObservationPregnancyStatusProfile.

**Actor**: USCoreObservationPregnancyStatusProfile

**Conformance**: SHALL

# Test Specification for REQ-424

## 1. Requirement ID
**REQ-424**: USCoreObservationPregnancyStatusProfile SHALL map the Observation identifier to Event.identifier

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated programmatically by examining FHIR Observation resources that conform to the USCoreObservationPregnancyStatusProfile and verifying the presence and mapping of the identifier element.

### Complexity
**Simple** - This is a straightforward structural validation that checks for the presence and proper mapping of a single element (identifier) within a specific FHIR profile.

### Prerequisites
- System must support US Core Observation Pregnancy Status Profile
- System must be capable of creating/storing Observation resources with identifiers
- Test system must have access to Observation resources that conform to USCoreObservationPregnancyStatusProfile
- System must support FHIR R4 specification

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources that claim conformance to the US Core Observation Pregnancy Status Profile (`http://hl7.org/fhir/us/core/StructureDefinition/us-core-observation-pregnancystatus`)
- **Resource Selection Criteria**: 
  - Observation resources with `meta.profile` containing the US Core Pregnancy Status Profile URL, OR
  - Observation resources with pregnancy status-related codes (e.g., LOINC codes like "82810-3" for pregnancy status)
- **Data Requirements**: Test data should include Observation resources that contain identifier elements

### Required FHIR Operations
Based on the Capability Statement, the following supported operations will be used:

1. **GET /Observation** - Search for Observation resources
   - Supported search parameters: `patient`, `category`, `code`, `date`, `status`
   - Use `category=survey` and/or `code` parameters to identify pregnancy status observations
   
2. **GET /Observation/{id}** - Retrieve specific Observation resources for detailed validation

3. **GET /Observation?patient={patient-id}&category=survey** - Search for survey-type observations for specific patients (pregnancy status observations typically fall under survey category)

### Validation Criteria

#### Primary Validation Checks:

1. **Profile Conformance Validation**:
   - Verify that the Observation resource declares conformance to US Core Observation Pregnancy Status Profile
   - Check `meta.profile` contains `http://hl7.org/fhir/us/core/StructureDefinition/us-core-observation-pregnancystatus`

2. **Identifier Element Presence**:
   - Verify that the Observation resource contains at least one `identifier` element
   - Assert that `Observation.identifier` is present and populated

3. **Identifier Structure Validation**:
   - Validate that each `identifier` element follows the FHIR Identifier datatype structure
   - Check for required sub-elements as defined by the profile requirements
   - Verify identifier system and value are appropriately populated when present

4. **Workflow Pattern Mapping Compliance**:
   - Confirm that the identifier serves as the Event.identifier in the context of the Workflow Pattern
   - Validate that the identifier can uniquely identify this pregnancy status observation event

#### Test Assertions:

**PASS Criteria**:
- All Observation resources claiming conformance to USCoreObservationPregnancyStatusProfile contain at least one populated `identifier` element
- The identifier element(s) conform to FHIR Identifier datatype specifications
- The identifier serves the functional requirement of Event.identifier mapping

**FAIL Criteria**:
- Any Observation resource claiming conformance to USCoreObservationPregnancyStatusProfile lacks the `identifier` element
- The identifier element is present but empty/null
- The identifier element does not conform to FHIR Identifier datatype structure

#### Implementation Notes:
- Test should accommodate "bring your own data" approach by searching for pregnancy status observations in the test system rather than requiring specific fixture data
- If no pregnancy status observations are found in the system, the test should report this as a prerequisite not met rather than a failure
- The test should validate the structural requirement without making assumptions about specific identifier values or formats used by different implementations

---

<a id='req-425'></a>

### REQ-425: The USCoreObservationPregnancyStatusProfile SHALL map the Observation status to Event.status.

**Text**: 

**Context**: Workflow Pattern mapping for USCoreObservationPregnancyStatusProfile.

**Actor**: USCoreObservationPregnancyStatusProfile

**Conformance**: SHALL

# Test Specification for REQ-425

## 1. Requirement ID
**REQ-425**: USCoreObservationPregnancyStatusProfile SHALL map the Observation status to Event.status

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be tested programmatically by validating the mapping between Observation.status and Event.status fields in USCoreObservationPregnancyStatusProfile instances.

### Complexity
**Simple** - This is a straightforward mapping validation between two specific fields with well-defined value sets.

### Prerequisites
- System must support US Core Observation Pregnancy Status Profile
- System must be capable of creating/retrieving Observation resources conforming to USCoreObservationPregnancyStatusProfile
- Test data must include Observation resources with various status values
- Understanding of FHIR Workflow Pattern mapping requirements

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- One or more Observation resources conforming to USCoreObservationPregnancyStatusProfile
- Each Observation resource must have a populated `status` field
- Resources should cover different valid status values (e.g., "final", "preliminary", "amended", "cancelled", etc.)

**Expected Outputs:**
- Validation confirmation that Observation.status correctly maps to Event.status according to FHIR Workflow Pattern specifications
- Verification that status values are from the appropriate value set and properly formatted

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported:
- **GET /Observation** - Retrieve pregnancy status observations
- **Search parameters**: `patient+category`, `patient+code`, `patient+status` (as supported in the capability statement)
- No specific create/update operations required for this mapping test

### Validation Criteria

**Primary Assertions:**
1. **Profile Conformance**: Verify that each Observation resource validates against the USCoreObservationPregnancyStatusProfile
2. **Status Field Presence**: Confirm that `Observation.status` field is present and populated
3. **Status Value Validation**: Verify that `Observation.status` contains a valid value from the ObservationStatus value set
4. **Workflow Pattern Mapping**: Validate that the Observation.status value correctly represents the Event.status according to FHIR Workflow Pattern mapping rules

**Specific Test Cases:**
1. **Status Mapping Verification**:
   - For each Observation resource, extract the `status` value
   - Verify the status value is one of the valid ObservationStatus codes
   - Confirm the mapping aligns with Event.status semantics (e.g., "final" status indicates completed event)

2. **Profile-Specific Validation**:
   - Validate that the Observation resource conforms to USCoreObservationPregnancyStatusProfile constraints
   - Verify that pregnancy status-specific requirements are met while maintaining proper status mapping

3. **Value Set Compliance**:
   - Ensure status values comply with the bound value set
   - Verify no invalid or custom status codes are used that would break the Event.status mapping

**Pass Criteria:**
- All Observation resources successfully validate against USCoreObservationPregnancyStatusProfile
- All `status` fields contain valid ObservationStatus values
- Status values properly represent Event.status semantics according to FHIR Workflow Pattern requirements
- No mapping inconsistencies between Observation.status and expected Event.status behavior

**Fail Criteria:**
- Any Observation resource fails profile validation
- Missing or invalid `status` field values
- Status values that don't properly map to Event.status according to Workflow Pattern specifications
- Use of non-standard status codes that break the mapping contract

---

<a id='req-426'></a>

### REQ-426: The USCoreObservationPregnancyStatusProfile SHALL map the Observation code to Event.code.

**Text**: 

**Context**: Workflow Pattern mapping for USCoreObservationPregnancyStatusProfile.

**Actor**: USCoreObservationPregnancyStatusProfile

**Conformance**: SHALL

# Test Specification for REQ-426

## 1. Requirement ID
**REQ-426**: USCoreObservationPregnancyStatusProfile SHALL map the Observation code to Event.code

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified programmatically by examining the mapping between the Observation.code field in US Core Observation Pregnancy Status Profile instances and the corresponding Event.code in the Workflow Pattern mapping.

### Complexity
**Simple** - This is a straightforward structural mapping validation that requires checking the presence and correct mapping of a single field between two patterns.

### Prerequisites
- System must support US Core Observation Pregnancy Status Profile
- System must implement the Workflow Pattern mapping as specified in US Core
- Test data must include valid USCoreObservationPregnancyStatusProfile instances
- Access to the system's FHIR server with Observation resource support as confirmed in the Capability Statement

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources Needed:**
- One or more Observation resources conforming to the US Core Observation Pregnancy Status Profile
- Each Observation must have a populated `code` element with appropriate pregnancy status codes (e.g., LOINC codes like "82810-3" for "Pregnancy status")

**Expected Outputs:**
- Confirmation that each Observation.code value is correctly mapped to Event.code in the Workflow Pattern
- Validation that the mapping preserves the semantic meaning of the pregnancy status code

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required for testing:

1. **GET /Observation** - Retrieve Observation resources
   - Supported search parameters: `category`, `code`, `date`, `patient`, `status`
   - Use `patient+category` search to filter for pregnancy status observations

2. **GET /Observation/[id]** - Retrieve specific Observation instances by ID

### Validation Criteria

**Primary Assertions:**
1. **Code Presence Validation:**
   - Verify that each USCoreObservationPregnancyStatusProfile instance has a populated `Observation.code` element
   - Assert that `Observation.code` is not null or empty

2. **Workflow Pattern Mapping Validation:**
   - Confirm that the `Observation.code` value maps correctly to `Event.code` in the Workflow Pattern
   - Verify that the code system, code value, and display text are preserved in the mapping

3. **Profile Conformance:**
   - Validate that the Observation resource conforms to the US Core Observation Pregnancy Status Profile
   - Ensure the `code` element uses appropriate pregnancy status codes (typically LOINC codes for pregnancy status)

**Test Passing Criteria:**
- All retrieved USCoreObservationPregnancyStatusProfile instances have populated `code` elements
- The Workflow Pattern mapping correctly preserves the `Observation.code` value in `Event.code`
- No mapping errors or data loss occurs during the code mapping process
- The semantic meaning of pregnancy status codes is maintained through the mapping

**Implementation Notes:**
- Test should work with any valid pregnancy status observation data provided by the implementer
- Focus on the mapping mechanism rather than specific code values
- Verify both the technical mapping structure and semantic preservation
- Test should accommodate various pregnancy status codes as long as they conform to the profile requirements

---

<a id='req-427'></a>

### REQ-427: The USCoreObservationPregnancyStatusProfile SHALL map the Observation subject to Event.subject.

**Text**: 

**Context**: Workflow Pattern mapping for USCoreObservationPregnancyStatusProfile.

**Actor**: USCoreObservationPregnancyStatusProfile

**Conformance**: SHALL

# Test Specification for REQ-427

## 1. Requirement ID
**REQ-427**: USCoreObservationPregnancyStatusProfile SHALL map the Observation subject to Event.subject

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement involves verifying a structural mapping between FHIR resource elements, which can be programmatically validated by examining the Observation.subject field in USCoreObservationPregnancyStatusProfile instances.

### Complexity
**Simple** - The requirement involves a direct field mapping verification between two well-defined FHIR elements without complex business logic or conditional dependencies.

### Prerequisites
- System must support the US Core Observation Pregnancy Status Profile
- System must be capable of creating/retrieving Observation resources conforming to USCoreObservationPregnancyStatusProfile
- Test data must include Observation resources with the pregnancy status profile that have populated subject fields
- Access to a FHIR server implementing the US Core Server CapabilityStatement

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- One or more Observation resources conforming to the US Core Observation Pregnancy Status Profile (http://hl7.org/fhir/us/core/StructureDefinition/us-core-observation-pregnancystatus)
- The Observation resources must have populated `subject` elements
- Associated Patient resources referenced by the Observation.subject field

**Expected Outputs:**
- Confirmation that Observation.subject is properly populated and maps to Event.subject pattern
- Validation that the subject reference is valid and accessible

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are supported and required:

1. **GET /Observation?patient={patient-id}&category=survey**
   - Retrieve pregnancy status observations for specific patients
   - Uses supported search parameters: patient+category

2. **GET /Observation/{id}**
   - Retrieve specific Observation resources by ID for detailed validation

3. **GET /Patient/{patient-id}**
   - Retrieve referenced Patient resources to validate subject references

### Validation Criteria

**Primary Assertions:**
1. **Subject Presence Validation:**
   - Verify that `Observation.subject` element is present and not null
   - Assert that the subject field contains a valid Reference

2. **Subject Reference Validation:**
   - Verify that `Observation.subject.reference` contains a valid Patient resource reference
   - Confirm the reference format follows FHIR standards (e.g., "Patient/{id}" or absolute URL)

3. **Subject Accessibility Validation:**
   - Attempt to resolve the Patient reference from `Observation.subject`
   - Verify that the referenced Patient resource can be successfully retrieved
   - Confirm that the retrieved Patient resource is valid and accessible

4. **Profile Conformance Validation:**
   - Verify that the Observation resource declares conformance to US Core Observation Pregnancy Status Profile
   - Validate that `Observation.meta.profile` includes "http://hl7.org/fhir/us/core/StructureDefinition/us-core-observation-pregnancystatus"

**Test Passing Criteria:**
- All pregnancy status Observation resources in the test dataset have populated and valid subject references
- All subject references can be successfully resolved to accessible Patient resources
- The mapping between Observation.subject and the Event pattern subject is structurally correct
- No broken or invalid subject references are found in any USCoreObservationPregnancyStatusProfile instances

**Test Implementation Steps:**
1. Query for all Observation resources matching the pregnancy status profile using supported search parameters
2. For each retrieved Observation resource:
   - Validate presence and format of the subject field
   - Attempt to resolve the Patient reference
   - Verify the structural mapping aligns with Event.subject pattern requirements
3. Report any instances where the subject mapping is missing, invalid, or inaccessible
4. Aggregate results to determine overall conformance with the mapping requirement

---

<a id='req-428'></a>

### REQ-428: The USCoreObservationPregnancyStatusProfile SHALL map the Observation effective[x] to Event.occurrence[x].

**Text**: 

**Context**: Workflow Pattern mapping for USCoreObservationPregnancyStatusProfile.

**Actor**: USCoreObservationPregnancyStatusProfile

**Conformance**: SHALL

# Test Specification for REQ-428

## 1. Requirement ID
**REQ-428**: USCoreObservationPregnancyStatusProfile SHALL map Observation effective[x] to Event.occurrence[x]

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Automatically testable

This requirement can be automatically tested by validating that pregnancy status observations contain the appropriate effective[x] elements that properly map to the Workflow Pattern's Event.occurrence[x] field. The mapping is a structural conformance requirement that can be verified through automated validation.

### Complexity
**Complexity Level**: Simple

This is a straightforward mapping validation that checks for the presence and appropriate use of the effective[x] element in pregnancy status observations.

### Prerequisites
- System must support US Core Server Capability Statement
- System must implement US Core Observation Pregnancy Status Profile
- System must have pregnancy status observations available for testing
- Test system must support Observation resource queries with patient and category search parameters

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources Needed**:
- Observation resources conforming to US Core Observation Pregnancy Status Profile
- Patient resources (referenced by the observations)
- Valid pregnancy status code values (e.g., LOINC codes for pregnancy status)

**Expected Outputs**:
- Observation resources with populated effective[x] elements
- Validation confirmation that effective[x] elements are present and properly formatted
- Confirmation that the effective[x] values can be mapped to Event.occurrence[x] pattern

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required:

1. **GET [base]/Observation?patient={patient-id}&category=survey**
   - Search for pregnancy status observations by patient and category
   - Category should include survey observations which typically include pregnancy status

2. **GET [base]/Observation?patient={patient-id}&code={pregnancy-status-code}**
   - Search for specific pregnancy status observations using appropriate LOINC codes
   - Example codes: 82810-3 (Pregnancy status), 11449-6 (Pregnancy status - Reported)

3. **GET [base]/Observation/{observation-id}**
   - Retrieve specific pregnancy status observation instances for detailed validation

### Validation Criteria

**Primary Assertions**:

1. **Effective Element Presence**:
   - Each US Core Observation Pregnancy Status Profile instance MUST contain at least one effective[x] element
   - Validate that `effectiveDateTime`, `effectivePeriod`, `effectiveTiming`, or `effectiveInstant` is present

2. **Effective Element Format Validation**:
   - If `effectiveDateTime` is used, validate it follows FHIR dateTime format
   - If `effectivePeriod` is used, validate it contains valid start/end dates
   - If `effectiveTiming` is used, validate it follows FHIR Timing format
   - If `effectiveInstant` is used, validate it follows FHIR instant format

3. **Workflow Pattern Mapping Compatibility**:
   - Verify that the effective[x] element values are compatible with Event.occurrence[x] mapping
   - Confirm that the temporal information captured can represent when the pregnancy status was determined/observed
   - Validate that the effective[x] element provides sufficient temporal context for clinical workflow

4. **Profile Conformance**:
   - Validate that the Observation resource declares conformance to the US Core Observation Pregnancy Status Profile
   - Verify that all required elements per the profile are present

**Test Execution Steps**:

1. Query the system for pregnancy status observations using supported search parameters
2. For each returned Observation resource:
   - Validate profile conformance declaration
   - Check for presence of effective[x] element
   - Validate the format and content of the effective[x] element
   - Confirm the effective[x] value provides meaningful temporal information
3. Document any observations that fail the mapping requirement
4. Generate test results indicating pass/fail status for the requirement

**Success Criteria**:
- All US Core Observation Pregnancy Status Profile instances contain valid effective[x] elements
- All effective[x] elements are properly formatted according to FHIR specifications
- The effective[x] elements contain meaningful temporal data that supports the Workflow Pattern mapping to Event.occurrence[x]

**Failure Conditions**:
- Any pregnancy status observation missing the effective[x] element
- Malformed or invalid effective[x] element values
- Effective[x] elements that cannot provide meaningful temporal context for workflow mapping

---

<a id='req-429'></a>

### REQ-429: The USCoreObservationPregnancyStatusProfile SHALL map the Observation performer to Event.performer.actor.

**Text**: 

**Context**: Workflow Pattern mapping for USCoreObservationPregnancyStatusProfile.

**Actor**: USCoreObservationPregnancyStatusProfile

**Conformance**: SHALL

# Test Specification for REQ-429

## 1. Requirement ID
**REQ-429**: USCoreObservationPregnancyStatusProfile SHALL map the Observation performer to Event.performer.actor

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified programmatically by examining the structure and mapping of FHIR Observation resources conforming to the USCoreObservationPregnancyStatusProfile.

### Complexity
**Simple** - The requirement involves a straightforward field mapping verification between two well-defined FHIR elements.

### Prerequisites
- System under test must support the US Core Observation Pregnancy Status Profile
- System must be capable of retrieving Observation resources via RESTful API
- Test data must include Observation resources with populated `performer` elements
- Access to systems implementing the Workflow Pattern Event structure for comparison

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- One or more Observation resources conforming to the US Core Observation Pregnancy Status Profile (`http://hl7.org/fhir/us/core/StructureDefinition/us-core-observation-pregnancystatus`)
- Observation resources must contain populated `performer` elements to enable mapping verification

**Expected Outputs:**
- Confirmation that the `Observation.performer` field correctly maps to `Event.performer.actor` in the Workflow Pattern
- Validation that the mapping maintains referential integrity and data consistency

### Required FHIR Operations
Based on the capability statement, the following operations are supported and required:

1. **GET /Observation** with search parameters:
   - `patient` (to retrieve pregnancy status observations for specific patients)
   - `category` (to filter for pregnancy status observations)
   - `code` (to identify specific pregnancy status codes)
   - `status` (to ensure active/valid observations)

2. **GET /Observation/[id]** - Direct resource retrieval for detailed examination

### Validation Criteria

**Primary Assertions:**
1. **Profile Conformance**: Verify that retrieved Observation resources conform to the US Core Observation Pregnancy Status Profile
2. **Performer Element Presence**: Confirm that `Observation.performer` element is populated when performer information is available
3. **Mapping Accuracy**: Validate that the content and structure of `Observation.performer` appropriately represents what would be expected in `Event.performer.actor` according to the Workflow Pattern specification

**Specific Validation Steps:**
1. **Resource Validation**:
   - Retrieve Observation resources using supported search parameters
   - Verify each resource declares conformance to `http://hl7.org/fhir/us/core/StructureDefinition/us-core-observation-pregnancystatus`

2. **Performer Mapping Verification**:
   - For each Observation with a populated `performer` element:
     - Verify the performer reference is valid and resolvable
     - Confirm the performer type (Practitioner, PractitionerRole, Organization, Patient, RelatedPerson, or CareTeam)
     - Validate that the reference structure matches the expected `Event.performer.actor` pattern

3. **Data Consistency Checks**:
   - Ensure performer references maintain consistency across related resources
   - Verify that performer information is appropriately scoped to the pregnancy status observation context

**Success Criteria:**
- All retrieved US Core Observation Pregnancy Status Profile resources with performer data demonstrate correct mapping to the Event.performer.actor pattern
- No mapping inconsistencies or referential integrity issues are identified
- The mapping preserves all relevant performer information as specified in the Workflow Pattern

**Failure Conditions:**
- Observation resources claiming conformance to the US Core Pregnancy Status Profile do not properly map performer to Event.performer.actor
- Missing or invalid performer references that should be present according to the Workflow Pattern
- Structural inconsistencies in the performer mapping that would break interoperability

---

<a id='req-430'></a>

### REQ-430: The USCoreObservationPregnancyStatusProfile SHALL map the Observation status to OBX-11 in HL7 v2.

**Text**: 

**Context**: HL7 v2 mapping for USCoreObservationPregnancyStatusProfile.

**Actor**: USCoreObservationPregnancyStatusProfile

**Conformance**: SHALL

# Test Specification for REQ-430

## 1. Requirement ID
REQ-430

## 2. Requirement Analysis

### Testability Assessment: 
**Attestation** - This requirement is an attestation because it specifies a mapping between FHIR elements and HL7 v2 fields, which cannot be directly tested through FHIR API interactions. The mapping verification requires examining implementation documentation or code rather than runtime behavior.

### Complexity: 
**Simple** - The requirement is straightforward, specifying a direct mapping between a single FHIR element (Observation.status) and a single HL7 v2 field (OBX-11).

### Prerequisites:
- System must support USCoreObservationPregnancyStatusProfile
- System must have capability to export/transform FHIR Observation resources to HL7 v2 format
- Access to system documentation describing HL7 v2 mapping implementation
- Sample USCoreObservationPregnancyStatusProfile instances with various status values

## 3. Test Implementation Strategy

### Required Inputs:
- **FHIR Resources**: USCoreObservationPregnancyStatusProfile instances containing various Observation.status values (e.g., "final", "preliminary", "cancelled", "entered-in-error", "unknown")
- **System Documentation**: Implementation documentation describing how FHIR to HL7 v2 mapping is performed
- **Sample HL7 v2 Output**: Examples of HL7 v2 messages generated from the FHIR Observation resources

### Required FHIR Operations:
- **GET /Observation**: Retrieve USCoreObservationPregnancyStatusProfile instances (supported per US Core Server capability)
- **Export/Transform Operation**: System-specific operation to convert FHIR resources to HL7 v2 format (if available via API)

### Validation Criteria:

#### Primary Attestation Criteria:
1. **Documentation Review**:
   - Verify that system documentation explicitly states that Observation.status maps to OBX-11 in HL7 v2 output
   - Confirm that the mapping covers all possible FHIR Observation.status values according to the FHIR specification

2. **Mapping Verification**:
   - For each test Observation resource, verify that the FHIR Observation.status value correctly appears in the OBX-11 field of the corresponding HL7 v2 message
   - Validate that the mapping preserves the semantic meaning of the status values

#### Specific Test Cases:
1. **Status Value Mapping**:
   - **Input**: USCoreObservationPregnancyStatusProfile with status = "final"
   - **Expected Output**: HL7 v2 message with OBX-11 containing "F" or equivalent final status code
   
2. **Multiple Status Values**:
   - **Input**: Multiple Observation instances with different status values ("preliminary", "cancelled", "entered-in-error")
   - **Expected Output**: Each corresponding HL7 v2 message has the appropriate status code in OBX-11

3. **Status Code Translation**:
   - Verify that FHIR status codes are appropriately translated to HL7 v2 status codes in OBX-11
   - Confirm that no status values are lost or incorrectly mapped during transformation

#### Pass/Fail Criteria:
- **PASS**: System documentation clearly describes the Observation.status to OBX-11 mapping AND sample transformations demonstrate correct mapping for all tested status values
- **FAIL**: System documentation does not describe this mapping OR sample transformations show incorrect or missing OBX-11 values OR status values are not properly translated

#### Additional Validation:
- Verify that the mapping is consistent across all USCoreObservationPregnancyStatusProfile instances
- Confirm that edge cases (unknown status values) are handled appropriately
- Validate that the mapping aligns with both FHIR R4 Observation.status value set and HL7 v2 OBX-11 specifications

---

<a id='req-431'></a>

### REQ-431: The USCoreObservationPregnancyStatusProfile SHALL map the Observation code to OBX-3 in HL7 v2.

**Text**: 

**Context**: HL7 v2 mapping for USCoreObservationPregnancyStatusProfile.

**Actor**: USCoreObservationPregnancyStatusProfile

**Conformance**: SHALL

# Test Specification for REQ-431

## 1. Requirement ID
REQ-431

## 2. Requirement Analysis

### Testability Assessment
**Not testable** - This requirement addresses HL7 v2 mapping specifications, which are implementation guidance for systems that need to transform between FHIR and HL7 v2 formats. The requirement does not describe testable FHIR API behavior or resource validation rules that can be verified through standard FHIR testing approaches.

### Complexity
Not Applicable

### Prerequisites
Not Applicable

## 3. Test Implementation Strategy

### Required Inputs
This requirement cannot be tested through standard FHIR interoperability testing as it addresses:

1. **Implementation Guidance**: The mapping specification describes how implementers should transform USCoreObservationPregnancyStatusProfile.code to HL7 v2 OBX-3 segment
2. **Transformation Logic**: This is internal system logic for data format conversion, not externally observable FHIR behavior
3. **No FHIR API Operations**: The requirement does not involve any FHIR RESTful operations that can be tested against the US Core Server capabilities

### Required FHIR Operations
None - This requirement does not involve testable FHIR operations.

### Validation Criteria
This requirement falls outside the scope of FHIR interoperability conformance testing because:

- It addresses mapping/transformation specifications rather than FHIR resource validation or API behavior
- It cannot be verified through FHIR API interactions with a US Core Server
- It requires access to internal system transformation logic that is not exposed through standard FHIR interfaces

**Recommendation**: This requirement should be classified as **implementation guidance** rather than a testable conformance requirement. Systems claiming conformance to this mapping specification would need to demonstrate compliance through:
- Documentation review
- Code inspection  
- Integration testing with HL7 v2 systems
- Attestation processes

These verification methods fall outside the scope of standard FHIR interoperability testing frameworks.

---

<a id='req-432'></a>

### REQ-432: The USCoreObservationPregnancyStatusProfile SHALL map the Observation subject to PID-3 in HL7 v2.

**Text**: 

**Context**: HL7 v2 mapping for USCoreObservationPregnancyStatusProfile.

**Actor**: USCoreObservationPregnancyStatusProfile

**Conformance**: SHALL

# Test Specification for REQ-432

## 1. Requirement ID
REQ-432

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated through automated inspection of FHIR Observation resources that conform to the USCoreObservationPregnancyStatusProfile to verify that the `subject` element is properly mapped to support HL7 v2 PID-3 field conversion.

### Complexity
**Simple** - This is a straightforward mapping validation that requires checking the presence and structure of the `subject` element in Observation resources.

### Prerequisites
- System must support US Core Server capabilities as defined in the Capability Statement
- System must be able to create/store Observation resources conforming to USCoreObservationPregnancyStatusProfile
- Test data must include Observation resources with pregnancy status information
- Patient resources must exist to serve as valid subjects for the observations

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources Needed:**
  - One or more Observation resources conforming to USCoreObservationPregnancyStatusProfile
  - Referenced Patient resources that serve as subjects for the observations
  - The Observation resources should contain pregnancy status information

- **Expected Outputs:**
  - Validation that each USCoreObservationPregnancyStatusProfile Observation has a properly structured `subject` element
  - Confirmation that the `subject` reference can be resolved to a valid Patient resource
  - Verification that the Patient resource contains appropriate identifiers that would map to HL7 v2 PID-3

### Required FHIR Operations
Based on the US Core Server Capability Statement, the following operations will be used:
- **GET /Observation** - Retrieve observation resources (supported per US Core Server capabilities)
- **GET /Patient** - Retrieve referenced patient resources (required per US Core Server capabilities)

### Validation Criteria

The test SHALL verify the following assertions for each USCoreObservationPregnancyStatusProfile:

1. **Subject Element Presence:**
   - The Observation resource MUST contain a `subject` element
   - The `subject` element MUST be a valid FHIR Reference

2. **Subject Reference Structure:**
   - The `subject.reference` MUST point to a Patient resource
   - The reference MUST be resolvable (either absolute URL or relative reference to an existing Patient)

3. **Referenced Patient Resource Validation:**
   - The referenced Patient resource MUST exist and be accessible
   - The Patient resource MUST contain at least one identifier in the `Patient.identifier` array
   - Each identifier MUST have both `system` and `value` elements populated (required for HL7 v2 PID-3 mapping)

4. **Profile Conformance:**
   - The Observation resource MUST declare conformance to USCoreObservationPregnancyStatusProfile in its `meta.profile` element (as recommended by the Capability Statement)

### Test Steps

1. **Discovery Phase:**
   - Query for all Observation resources that claim conformance to USCoreObservationPregnancyStatusProfile
   - If no profile declaration is found in meta.profile, identify pregnancy status observations by code/category

2. **Subject Validation Phase:**
   - For each identified pregnancy status observation:
     - Verify presence of `subject` element
     - Extract and validate the patient reference
     - Attempt to resolve the patient reference

3. **Patient Identifier Validation Phase:**
   - For each referenced Patient resource:
     - Verify the Patient resource can be retrieved successfully
     - Validate that Patient.identifier array contains at least one identifier
     - Verify each identifier has the required system and value elements

4. **Mapping Compatibility Assessment:**
   - Confirm that the patient identifiers present would be suitable for mapping to HL7 v2 PID-3 field
   - Document any observations that lack proper subject mapping capability

### Pass/Fail Criteria

**PASS:** All USCoreObservationPregnancyStatusProfile resources have properly structured subject references that point to valid Patient resources with appropriate identifiers for HL7 v2 PID-3 mapping.

**FAIL:** Any USCoreObservationPregnancyStatusProfile resource lacks a subject element, has an unresolvable subject reference, or references a Patient resource without proper identifiers for HL7 v2 mapping.

---

<a id='req-433'></a>

### REQ-433: The USCoreObservationPregnancyStatusProfile SHALL map the Observation effective[x] to OBX-14, and/or OBX-19 after v2.4 in HL7 v2.

**Text**: 

**Context**: HL7 v2 mapping for USCoreObservationPregnancyStatusProfile.

**Actor**: USCoreObservationPregnancyStatusProfile

**Conformance**: SHALL

# Test Specification for REQ-433

## 1. Requirement ID
REQ-433

## 2. Requirement Analysis

### Testability Assessment
**Attestation** - This requirement specifies HL7 v2 mapping behavior that cannot be directly validated through FHIR API interactions. The mapping from FHIR Observation.effective[x] to HL7 v2 OBX segments occurs during message transformation processes that are typically internal to the system and not exposed through standard FHIR endpoints.

### Complexity
**Simple** - The requirement is straightforward, focusing on a specific field mapping between FHIR and HL7 v2 formats for a single profile.

### Prerequisites
- System must support USCoreObservationPregnancyStatusProfile
- System must have HL7 v2 message generation/transformation capabilities
- Test data must include Observation resources conforming to USCoreObservationPregnancyStatusProfile with populated effective[x] elements
- Access to both FHIR representation and generated HL7 v2 messages for comparison

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- One or more Observation resources that conform to USCoreObservationPregnancyStatusProfile
- Each test Observation must include a populated `effective[x]` element (effectiveDateTime, effectivePeriod, or effectiveInstant)
- Observations should represent various pregnancy status scenarios with different effective date/time formats

**Expected Outputs:**
- Corresponding HL7 v2 messages containing OBX segments
- Documentation or system attestation demonstrating the mapping behavior

### Required FHIR Operations
Based on the US Core Server Capability Statement, the following operations are supported and may be used to retrieve test data:

- `GET [base]/Observation?patient={id}` - to retrieve pregnancy status observations for a patient
- `GET [base]/Observation/{id}` - to retrieve specific pregnancy status observations
- `GET [base]/Observation?category=survey` - if pregnancy status observations are categorized as survey data

**Note:** The actual mapping validation requires access to HL7 v2 message generation capabilities, which are not exposed through standard FHIR REST operations.

### Validation Criteria

Since this is an attestation-based test, the following validation approach should be used:

**Primary Validation:**
1. **System Documentation Review:**
   - Verify system documentation explicitly states that Observation.effective[x] elements from USCoreObservationPregnancyStatusProfile are mapped to OBX-14 and/or OBX-19 (for v2.4+)
   - Confirm documentation specifies handling of different effective[x] types (DateTime, Period, Instant)

2. **Sample Message Analysis:**
   - Request sample HL7 v2 messages generated from test USCoreObservationPregnancyStatusProfile instances
   - Verify that the effective[x] values appear correctly in OBX-14 and/or OBX-19 fields
   - Confirm proper HL7 v2 date/time formatting is applied

3. **Version-Specific Validation:**
   - For HL7 v2.4 and later: Verify mapping uses OBX-19 (or both OBX-14 and OBX-19)
   - For pre-v2.4: Verify mapping uses OBX-14
   - Confirm system properly identifies HL7 v2 version being used

**Pass Criteria:**
- System provides clear documentation of the required mapping
- Sample messages demonstrate correct placement of effective[x] values in specified OBX fields
- Appropriate HL7 v2 version-specific field usage is documented and demonstrated
- All different effective[x] data types (DateTime, Period, Instant) are properly handled in the mapping

**Attestation Statement:**
The implementer must attest that their system correctly maps USCoreObservationPregnancyStatusProfile Observation.effective[x] elements to HL7 v2 OBX-14 and/or OBX-19 fields according to the HL7 v2 version being used, with supporting documentation and sample messages provided as evidence.

---

<a id='req-434'></a>

### REQ-434: The USCoreObservationPregnancyStatusProfile SHALL map the Observation performer to OBX.15 / (Practitioner) OBX-16, PRT-5:PRT-4='RO' / (Device) OBX-18 , PRT-10:PRT-4='EQUIP' / (Organization) OBX-23, PRT-8:PRT-4='PO' in HL7 v2.

**Text**: 

**Context**: HL7 v2 mapping for USCoreObservationPregnancyStatusProfile including performer role-specific segments.

**Actor**: USCoreObservationPregnancyStatusProfile

**Conformance**: SHALL

# Test Specification for REQ-434

## 1. Requirement ID
REQ-434

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Attestation

This requirement defines HL7 v2 mapping rules for the USCoreObservationPregnancyStatusProfile performer field. Since this is a mapping specification between FHIR and HL7 v2 formats rather than a FHIR API behavior requirement, it cannot be automatically tested through FHIR operations. Testing would require:
- Access to both FHIR and HL7 v2 representations of the same data
- Implementation-specific mapping logic verification
- Cross-format data transformation validation

### Complexity
**Complex**

The requirement involves:
- Multiple conditional mapping paths based on performer type (Practitioner, Device, Organization)
- Different HL7 v2 segments and fields for each performer type
- Role-specific segment assignments (RO, EQUIP, PO)
- Understanding of both FHIR and HL7 v2 data structures

### Prerequisites
- System capable of producing both FHIR USCoreObservationPregnancyStatusProfile instances and HL7 v2 messages
- Test data containing Observation instances with different performer types (Practitioner, Device, Organization)
- Access to the system's FHIR-to-HL7v2 mapping implementation
- Understanding of HL7 v2 OBX and PRT segments

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources Needed**:
- USCoreObservationPregnancyStatusProfile instances with populated `performer` field
- Associated Practitioner, Device, and Organization resources referenced by the performer field
- Test cases should include:
  - Observations with Practitioner performers
  - Observations with Device performers  
  - Observations with Organization performers
  - Observations with multiple performers of different types

**Expected Outputs**:
- Corresponding HL7 v2 messages containing the mapped performer data in appropriate segments
- Documentation or attestation of mapping implementation

### Required FHIR Operations
**Primary Operations** (supported per Capability Statement):
- `GET /Observation?patient={id}&category=survey` - Retrieve pregnancy status observations
- `GET /Observation/{id}` - Retrieve specific observation instances
- `GET /Practitioner/{id}` - Retrieve practitioner details when referenced as performer
- `GET /Organization/{id}` - Retrieve organization details when referenced as performer

**Note**: Device resources are not explicitly listed in the capability statement but may be retrievable via standard FHIR operations.

### Validation Criteria

**Attestation Requirements**:

1. **Practitioner Performer Mapping**:
   - Verify FHIR `Observation.performer` references to Practitioner resources map to HL7 v2 OBX.15 or OBX-16
   - Verify PRT segment created with PRT-5:PRT-4='RO' when applicable
   - Confirm practitioner identification and details are correctly transferred

2. **Device Performer Mapping**:
   - Verify FHIR `Observation.performer` references to Device resources map to HL7 v2 OBX-18
   - Verify PRT segment created with PRT-10:PRT-4='EQUIP' when applicable
   - Confirm device identification and details are correctly transferred

3. **Organization Performer Mapping**:
   - Verify FHIR `Observation.performer` references to Organization resources map to HL7 v2 OBX-23
   - Verify PRT segment created with PRT-8:PRT-4='PO' when applicable
   - Confirm organization identification and details are correctly transferred

4. **Multiple Performer Scenarios**:
   - Verify that observations with multiple performers of different types create appropriate multiple HL7 v2 segments
   - Confirm each performer type maintains its correct mapping destination

**Test Evidence Requirements**:
- Side-by-side comparison of FHIR USCoreObservationPregnancyStatusProfile instances and corresponding HL7 v2 messages
- Documentation showing the mapping logic implementation
- Validation that all performer types are handled according to the specified mapping rules
- Confirmation that the mapping preserves semantic meaning and referential integrity between formats

**Passing Criteria**:
The test passes when the implementer can demonstrate through documentation and examples that their FHIR-to-HL7v2 mapping implementation correctly routes USCoreObservationPregnancyStatusProfile performer references to the appropriate HL7 v2 segments based on performer resource type, following the specified mapping rules for each performer category.

---

<a id='req-435'></a>

### REQ-435: The USCoreObservationPregnancyIntentProfile SHALL map the Observation.identifier to Event.identifier.

**Text**: 

**Context**: Workflow Pattern mapping for USCoreObservationPregnancyIntentProfile.

**Actor**: USCoreObservationPregnancyIntentProfile

**Conformance**: SHALL

# Test Specification for REQ-435

## Requirement ID
REQ-435

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated testing by examining the FHIR resource structure and validating the mapping between `Observation.identifier` and `Event.identifier` fields in USCoreObservationPregnancyIntentProfile instances.

### Complexity
**Simple** - The requirement involves a straightforward field mapping verification between two well-defined FHIR elements.

### Prerequisites
- System must support US Core Observation Pregnancy Intent Profile
- Test data must include Observation resources conforming to USCoreObservationPregnancyIntentProfile
- System must be capable of handling Workflow Pattern mappings
- Access to Observation resources with populated identifier fields

## Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- One or more Observation resources that conform to the USCoreObservationPregnancyIntentProfile
- Resources should have populated `Observation.identifier` elements to enable meaningful testing

**Expected Outputs:**
- Validation that each `Observation.identifier` value is properly mapped to the corresponding `Event.identifier` in the Workflow Pattern context
- Confirmation that the mapping maintains data integrity and completeness

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required:

1. **GET /Observation** - Retrieve Observation resources using supported search parameters:
   - `patient` (to filter for specific patient's pregnancy intent observations)
   - `category` (to filter for pregnancy-related observations)
   - `code` (to identify pregnancy intent observations specifically)
   - Combined searches such as `patient+category` or `patient+code`

2. **GET /Observation/{id}** - Retrieve specific Observation resources by ID for detailed validation

### Validation Criteria

The test SHALL verify the following assertions to indicate passing:

1. **Profile Conformance Validation:**
   - Confirm that retrieved Observation resources conform to USCoreObservationPregnancyIntentProfile
   - Validate that resources pass FHIR profile validation for the specified profile

2. **Identifier Mapping Validation:**
   - For each USCoreObservationPregnancyIntentProfile instance:
     - Verify that `Observation.identifier` elements are present when the resource has identifiers
     - Confirm that each `Observation.identifier` value maps correctly to `Event.identifier` in the Workflow Pattern context
     - Validate that the mapping preserves identifier system, value, and use attributes
     - Ensure no identifier data is lost or corrupted during the mapping process

3. **Data Integrity Checks:**
   - Verify that identifier arrays maintain correct cardinality (0..* for both source and target)
   - Confirm that identifier attributes (system, value, use, type) are preserved in the mapping
   - Validate that empty or missing identifier collections are handled appropriately

4. **Workflow Pattern Compliance:**
   - Ensure the mapping follows the established Workflow Pattern specifications
   - Verify that the Event.identifier structure matches the expected Workflow Pattern requirements

**Test Passing Criteria:**
- All Observation resources claiming conformance to USCoreObservationPregnancyIntentProfile successfully map their identifier elements to Event.identifier
- No data loss occurs during the mapping process
- The mapping maintains referential integrity and follows Workflow Pattern specifications
- Resources without identifiers handle the mapping gracefully (empty to empty mapping)

**Test Failure Indicators:**
- Identifier data is lost, corrupted, or incorrectly transformed during mapping
- USCoreObservationPregnancyIntentProfile resources fail to properly implement the identifier mapping
- Workflow Pattern mapping requirements are not met
- System errors occur when processing the identifier mapping

---

<a id='req-436'></a>

### REQ-436: The USCoreObservationPregnancyIntentProfile SHALL map the Observation.status to Event.status.

**Text**: 

**Context**: Workflow Pattern mapping for USCoreObservationPregnancyIntentProfile.

**Actor**: USCoreObservationPregnancyIntentProfile

**Conformance**: SHALL

# Test Specification for REQ-436

## 1. Requirement ID
REQ-436

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Automatically testable

The requirement specifies a clear mapping requirement between two specific FHIR elements (`Observation.status` to `Event.status`) within the USCoreObservationPregnancyIntentProfile. This can be validated programmatically by examining the actual mapping implementation in FHIR resources that conform to this profile.

### Complexity
**Level**: Simple

This is a straightforward field mapping validation that requires checking the presence and correct mapping of a single element between two defined patterns.

### Prerequisites
- FHIR server implementing US Core Server CapabilityStatement
- System must support the US Core Observation Pregnancy Intent Profile
- Test data must include Observation resources conforming to USCoreObservationPregnancyIntentProfile
- Server must support Observation resource operations as defined in the capability statement

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources Needed:**
- One or more Observation resources that conform to the US Core Observation Pregnancy Intent Profile
- Resources must contain populated `Observation.status` field with valid status values (e.g., "final", "preliminary", "cancelled", "amended", etc.)

**Expected Outputs:**
- Confirmation that the Observation.status field correctly maps to Event.status according to the Workflow Pattern mapping
- Validation that the status values are properly represented in both contexts

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are supported and required:

1. **GET /Observation** - Retrieve Observation resources using supported search parameters:
   - `patient` parameter to filter by patient
   - `category` parameter to identify pregnancy intent observations
   - `status` parameter to test different status values

2. **GET /Observation/{id}** - Retrieve specific Observation instances for detailed validation

### Validation Criteria

**Primary Assertion:**
- Verify that for each USCoreObservationPregnancyIntentProfile resource, the `Observation.status` field value correctly corresponds to the `Event.status` mapping as defined in the Workflow Pattern

**Specific Validation Steps:**

1. **Profile Conformance Check:**
   - Confirm the Observation resource declares conformance to `http://hl7.org/fhir/us/core/StructureDefinition/us-core-observation-pregnancyintent`
   - Validate that the resource passes profile validation

2. **Status Field Validation:**
   - Verify `Observation.status` field is present and populated
   - Confirm the status value is from the required ValueSet for Observation status
   - Validate that the status value maps correctly to Event.status according to FHIR workflow pattern mappings:
     - `final` → `completed`
     - `preliminary` → `in-progress`
     - `cancelled` → `not-done`
     - `amended` → `completed` (with appropriate versioning)
     - `corrected` → `completed` (with appropriate versioning)

3. **Mapping Consistency Check:**
   - For each status value found, verify it follows the established Observation to Event status mapping conventions
   - Ensure no invalid or unmapped status values are present

**Pass Criteria:**
- All Observation resources conforming to USCoreObservationPregnancyIntentProfile have valid status values
- Status values correctly implement the Workflow Pattern mapping from Observation.status to Event.status
- No mapping violations or inconsistencies are detected

**Fail Criteria:**
- Any USCoreObservationPregnancyIntentProfile resource lacks a status field
- Status values that don't conform to proper Event.status mapping
- Invalid status values that cannot be mapped according to the Workflow Pattern requirements

---

<a id='req-437'></a>

### REQ-437: The USCoreObservationPregnancyIntentProfile SHALL map the Observation.code to Event.code.

**Text**: 

**Context**: Workflow Pattern mapping for USCoreObservationPregnancyIntentProfile.

**Actor**: USCoreObservationPregnancyIntentProfile

**Conformance**: SHALL

# Test Specification for REQ-437

## 1. Requirement ID
**REQ-437**: USCoreObservationPregnancyIntentProfile SHALL map Observation.code to Event.code

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be automatically validated by examining the mapping configuration and verifying that the USCoreObservationPregnancyIntentProfile correctly implements the Workflow Pattern mapping from Observation.code to Event.code.

### Complexity
**Simple** - This is a straightforward mapping verification that requires checking a single field mapping within the profile implementation.

### Prerequisites
- System must support US Core Observation Pregnancy Intent Profile
- System must implement the Workflow Pattern mapping specifications
- Test system must have access to Observation resources conforming to the USCoreObservationPregnancyIntentProfile
- System must support FHIR R4 Observation resource operations as defined in the capability statement

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources Needed:**
- Observation resources that conform to the US Core Observation Pregnancy Intent Profile
- Resources should contain populated `Observation.code` elements with appropriate pregnancy intent codes

**Expected Outputs:**
- Verification that Observation.code values are correctly mapped to Event.code in the Workflow Pattern implementation
- Confirmation that the mapping maintains semantic integrity between the source and target elements

### Required FHIR Operations
Based on the capability statement, the following operations are supported and required for testing:

1. **GET /Observation** - Retrieve Observation resources
   - Supported search parameters: `category`, `code`, `date`, `patient`, `status`
   - Combination searches: `patient+category`, `patient+code`, `patient+code+date`

2. **GET /Observation/[id]** - Retrieve specific Observation instance by ID

### Validation Criteria

**Primary Assertions:**
1. **Profile Conformance Check**
   - Verify that retrieved Observation resources conform to the US Core Observation Pregnancy Intent Profile
   - Validate that `Observation.code` is present and populated with appropriate pregnancy intent codes

2. **Mapping Verification**
   - Confirm that the `Observation.code` element in USCoreObservationPregnancyIntentProfile instances correctly maps to `Event.code` in the Workflow Pattern
   - Verify that the mapping preserves the semantic meaning of the pregnancy intent codes

3. **Code System Validation**
   - Ensure that codes used in `Observation.code` are from the appropriate value sets for pregnancy intent observations
   - Validate that mapped `Event.code` values maintain consistency with the source codes

**Test Cases:**

**Test Case 1: Basic Mapping Verification**
- Retrieve Observation resources with pregnancy intent codes
- Verify each resource conforms to USCoreObservationPregnancyIntentProfile
- Assert that `Observation.code` contains valid pregnancy intent codes
- Confirm the Workflow Pattern mapping implementation correctly translates `Observation.code` to `Event.code`

**Test Case 2: Search-Based Validation**
- Use `patient+code` search to retrieve pregnancy intent observations
- Validate that returned resources demonstrate proper code mapping
- Verify consistency across multiple resources from the same patient

**Test Case 3: Code System Consistency**
- Retrieve observations using different pregnancy intent codes
- Verify that all code mappings maintain semantic consistency
- Ensure no data loss or transformation errors in the mapping process

**Pass/Fail Criteria:**
- **Pass**: All retrieved USCoreObservationPregnancyIntentProfile resources correctly implement the Observation.code to Event.code mapping as specified in the Workflow Pattern
- **Fail**: Any resource fails to properly map Observation.code to Event.code, or the mapping loses semantic integrity

**Additional Validation Points:**
- Verify that the mapping is bidirectional where applicable
- Ensure that mandatory elements in both source and target are properly handled
- Confirm that the mapping implementation follows FHIR mapping best practices

---

<a id='req-438'></a>

### REQ-438: The USCoreObservationPregnancyIntentProfile SHALL map the Observation.subject to Event.subject.

**Text**: 

**Context**: Workflow Pattern mapping for USCoreObservationPregnancyIntentProfile.

**Actor**: USCoreObservationPregnancyIntentProfile

**Conformance**: SHALL

# Test Specification for REQ-438

## 1. Requirement ID
REQ-438

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement involves verifying that a specific FHIR element mapping is correctly implemented, which can be validated through automated inspection of FHIR resources.

### Complexity
**Simple** - This is a straightforward element mapping verification that requires checking if `Observation.subject` exists and contains appropriate reference data.

### Prerequisites
- System must support US Core Observation Pregnancy Intent Profile
- System must have at least one Observation resource conforming to the USCoreObservationPregnancyIntentProfile
- The Observation resource must have a populated `subject` element
- Referenced Patient resource should be accessible for validation

## 3. Test Implementation Strategy

### Required Inputs
**Required FHIR Resources:**
- Observation resource conforming to USCoreObservationPregnancyIntentProfile
- Patient resource referenced by the Observation.subject

**Expected Outputs:**
- Confirmation that Observation.subject element exists and is properly populated
- Validation that the subject reference resolves to a valid Patient resource
- Verification that the mapping follows Event.subject pattern requirements

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported:
- `GET /Observation` - Retrieve Observation resources
- `GET /Observation/{id}` - Retrieve specific Observation by ID
- `GET /Patient/{id}` - Retrieve referenced Patient resource
- Search parameters: `patient`, `category`, `code`, `date`, `status` for Observation resources

### Validation Criteria

**Primary Assertions:**
1. **Subject Element Presence**: Verify that `Observation.subject` element is present and not null
2. **Reference Structure**: Confirm that `Observation.subject` contains a valid FHIR Reference structure
3. **Reference Target**: Validate that the reference points to a Patient resource (reference should start with "Patient/" or be a valid Patient resource reference)
4. **Reference Resolvability**: Ensure the referenced Patient resource can be successfully retrieved
5. **Profile Conformance**: Verify the Observation resource conforms to USCoreObservationPregnancyIntentProfile

**Test Cases:**

**Test Case 1: Basic Subject Mapping Validation**
- Retrieve an Observation resource that claims conformance to USCoreObservationPregnancyIntentProfile
- Assert that `Observation.subject` exists
- Assert that `Observation.subject.reference` is populated
- Verify the reference format follows FHIR Reference patterns

**Test Case 2: Patient Reference Validation**
- Extract the patient reference from `Observation.subject.reference`
- Attempt to resolve the reference to retrieve the Patient resource
- Assert that the GET request returns a valid Patient resource (HTTP 200)
- Verify the retrieved resource is of resourceType "Patient"

**Test Case 3: Workflow Pattern Compliance**
- Confirm that the subject mapping aligns with Event.subject workflow pattern
- Verify that the subject represents "who/what the observation is about"
- Ensure the reference maintains referential integrity within the system

**Passing Criteria:**
- All Observation resources conforming to USCoreObservationPregnancyIntentProfile must have a populated `subject` element
- The `subject` element must contain a valid reference to a Patient resource
- The referenced Patient resource must be retrievable and valid
- The mapping must maintain consistency with the Event workflow pattern specifications

**Failure Conditions:**
- Missing `Observation.subject` element
- Empty or null `Observation.subject.reference`
- Invalid reference format
- Referenced Patient resource is not accessible or invalid
- Profile validation errors for USCoreObservationPregnancyIntentProfile conformance

---

<a id='req-439'></a>

### REQ-439: The USCoreObservationPregnancyIntentProfile SHALL map the Observation.effective[x] to Event.occurrence[x].

**Text**: 

**Context**: Workflow Pattern mapping for USCoreObservationPregnancyIntentProfile.

**Actor**: USCoreObservationPregnancyIntentProfile

**Conformance**: SHALL

# Test Specification for REQ-439

## 1. Requirement ID
REQ-439

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated testing by examining the mapping implementation between `Observation.effective[x]` and the Event pattern's `occurrence[x]` element in USCoreObservationPregnancyIntentProfile instances.

### Complexity
**Simple** - This is a straightforward data mapping verification that requires checking the presence and correct mapping of a single element.

### Prerequisites
- System must support US Core Observation Pregnancy Intent Profile
- System must implement the Workflow Pattern mapping as specified in US Core
- Test data must include Observation resources conforming to USCoreObservationPregnancyIntentProfile
- System must support FHIR R4 Observation resource operations as defined in the US Core Server Capability Statement

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources that conform to the US Core Observation Pregnancy Intent Profile (http://hl7.org/fhir/us/core/StructureDefinition/us-core-observation-pregnancyintent)
- **Test Data Requirements**: 
  - Observation resources with populated `effective[x]` elements (effectiveDateTime, effectivePeriod, effectiveTiming, or effectiveInstant)
  - Resources must be valid instances of USCoreObservationPregnancyIntentProfile
- **Expected Outputs**: Confirmation that the Workflow Pattern mapping correctly maps `Observation.effective[x]` to `Event.occurrence[x]`

### Required FHIR Operations
Based on the US Core Server Capability Statement, the following operations are supported for Observation resources:

1. **GET /Observation/[id]** - Retrieve specific Observation instances
2. **GET /Observation?patient=[patient-id]** - Search for Observations by patient
3. **GET /Observation?patient=[patient-id]&category=[category]** - Search with category filter
4. **GET /Observation?patient=[patient-id]&code=[code]** - Search with code filter

### Validation Criteria

The test shall verify the following assertions:

1. **Profile Conformance**: 
   - Verify that the Observation resource conforms to the US Core Observation Pregnancy Intent Profile
   - Validate using FHIR validation tools against the profile definition

2. **Element Presence Validation**:
   - Assert that if `Observation.effective[x]` is present in the source data, it contains valid temporal information
   - Verify that the element uses one of the allowed types: effectiveDateTime, effectivePeriod, effectiveTiming, or effectiveInstant

3. **Workflow Pattern Mapping Validation**:
   - Confirm that the `Observation.effective[x]` element is correctly mapped to the Event pattern's `occurrence[x]` element
   - Validate that the temporal semantics are preserved in the mapping (i.e., the timing information maintains its meaning)
   - Verify that the mapping follows the Workflow Pattern specifications defined in FHIR

4. **Data Type Consistency**:
   - Assert that the mapped value maintains the same data type and temporal precision as the source
   - Verify that date/time formatting follows FHIR standards

### Test Cases

**Test Case 1: DateTime Mapping**
- Input: USCoreObservationPregnancyIntentProfile with `effectiveDateTime`
- Validation: Verify mapping to Event.occurrenceDateTime

**Test Case 2: Period Mapping**
- Input: USCoreObservationPregnancyIntentProfile with `effectivePeriod` 
- Validation: Verify mapping to Event.occurrencePeriod

**Test Case 3: Timing Mapping**
- Input: USCoreObservationPregnancyIntentProfile with `effectiveTiming`
- Validation: Verify mapping to Event.occurrenceTiming

**Test Case 4: Missing Effective Element**
- Input: USCoreObservationPregnancyIntentProfile without `effective[x]`
- Validation: Verify that mapping handles missing source element appropriately

### Pass/Fail Criteria

**Pass**: 
- All Observation resources conforming to USCoreObservationPregnancyIntentProfile correctly implement the Workflow Pattern mapping
- `Observation.effective[x]` values are accurately mapped to `Event.occurrence[x]` with preserved semantics
- Profile validation succeeds for all test instances

**Fail**:
- Any USCoreObservationPregnancyIntentProfile instance fails to correctly map `Observation.effective[x]` to `Event.occurrence[x]`
- Mapping loses temporal precision or semantics
- Profile validation fails for test instances

---

<a id='req-440'></a>

### REQ-440: The USCoreObservationPregnancyIntentProfile SHALL map the Observation.performer to Event.performer.actor.

**Text**: 

**Context**: Workflow Pattern mapping for USCoreObservationPregnancyIntentProfile.

**Actor**: USCoreObservationPregnancyIntentProfile

**Conformance**: SHALL

# Test Specification for REQ-440

## 1. Requirement ID
**REQ-440**: USCoreObservationPregnancyIntentProfile SHALL map Observation.performer to Event.performer.actor

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified programmatically by examining the structure and content of USCoreObservationPregnancyIntentProfile instances to ensure proper mapping between Observation.performer and Event.performer.actor fields.

### Complexity
**Simple** - The requirement involves a straightforward field mapping verification between two specific FHIR elements within a single profile.

### Prerequisites
- System must support US Core Observation Pregnancy Intent Profile
- Test data must include Observation resources conforming to USCoreObservationPregnancyIntentProfile
- System must support RESTful read operations for Observation resources
- Test data should include Observation instances with populated performer elements

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Observation resources conforming to US Core Observation Pregnancy Intent Profile (StructureDefinition-us-core-observation-pregnancyintent.html)
- Resources should contain populated `Observation.performer` elements
- Resources may reference Practitioner, PractitionerRole, Organization, or Patient resources as performers

**Expected Outputs:**
- Validation confirmation that performer mapping aligns with Workflow Pattern Event.performer.actor structure
- Verification that all performer references are properly structured and accessible

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required:

1. **GET /Observation/{id}** - Retrieve specific Observation resources conforming to US Core Observation Pregnancy Intent Profile
2. **GET /Observation?patient={patient}&category={category}** - Search for pregnancy intent observations by patient and category
3. **GET /Observation?patient={patient}&code={code}** - Search for specific pregnancy intent observations by patient and code

### Validation Criteria

#### Primary Assertions:
1. **Profile Conformance**: Verify that tested Observation resources conform to US Core Observation Pregnancy Intent Profile
2. **Performer Presence**: When `Observation.performer` is populated, validate that:
   - The performer element contains valid references to appropriate resource types (Practitioner, PractitionerRole, Organization, Patient, RelatedPerson, or CareTeam)
   - References are resolvable and point to valid FHIR resources
3. **Workflow Pattern Mapping**: Verify that the performer mapping structure aligns with Event.performer.actor pattern:
   - Performer references represent the actor(s) responsible for the observation
   - The mapping maintains semantic consistency between the Observation performer and the Event workflow pattern

#### Secondary Assertions:
1. **Reference Integrity**: Validate that performer references can be resolved to actual resources when dereferenced
2. **Data Type Conformance**: Ensure performer elements use appropriate FHIR data types and reference formats
3. **Cardinality Compliance**: Verify adherence to cardinality constraints for performer elements as defined in the profile

#### Test Execution Steps:
1. Retrieve Observation resources conforming to US Core Observation Pregnancy Intent Profile using supported search parameters
2. For each retrieved Observation resource:
   - Validate profile conformance
   - Extract and examine `Observation.performer` elements
   - Verify performer references are properly formatted
   - Confirm semantic alignment with Event.performer.actor mapping pattern
3. Generate test results indicating pass/fail status for each validation criterion

#### Success Criteria:
- All tested Observation resources properly map performer elements according to Workflow Pattern requirements
- All performer references are valid and semantically appropriate
- No mapping inconsistencies are detected between Observation.performer and Event.performer.actor pattern

---

<a id='req-441'></a>

### REQ-441: The USCoreObservationPregnancyIntentProfile SHALL map the Observation.status to < 445584004 Report by finality status in SNOMED CT.

**Text**: 

**Context**: SNOMED CT Concept Domain Binding for Observation.status in USCoreObservationPregnancyIntentProfile.

**Actor**: USCoreObservationPregnancyIntentProfile

**Conformance**: SHALL

# Test Specification for REQ-441

## 1. Requirement ID
REQ-441

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated programmatically by examining FHIR Observation resources that conform to the USCoreObservationPregnancyIntentProfile and verifying that the Observation.status values map correctly to the specified SNOMED CT concept domain.

### Complexity
**Simple** - The test involves straightforward validation of status code mappings against a defined SNOMED CT concept domain.

### Prerequisites
- System must support the USCoreObservationPregnancyIntentProfile
- Access to SNOMED CT terminology server or local terminology validation capabilities
- Test data containing Observation resources with pregnancy intent that conform to the US Core profile
- Knowledge of the SNOMED CT concept domain "< 445584004 Report by finality status"

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources conforming to USCoreObservationPregnancyIntentProfile
- **Terminology Resources**: Access to SNOMED CT concept "445584004 Report by finality status" and its hierarchy
- **Profile Definition**: USCoreObservationPregnancyIntentProfile structure definition

### Expected Outputs
- Validation results confirming that all Observation.status values in pregnancy intent observations map to concepts within the specified SNOMED CT domain
- Clear pass/fail indicators for each tested observation
- Documentation of any non-conformant status values found

### Required FHIR Operations
Based on the US Core Server Capability Statement:
- **GET /Observation** - Retrieve Observation resources (supported as part of US Core Server capabilities)
- **GET /metadata** - Retrieve server capability statement to confirm profile support
- **Terminology validation operations** (if supported) - Validate SNOMED CT concept mappings

### Validation Criteria

#### Primary Validation Checks:
1. **Profile Conformance Verification**
   - Confirm that test Observation resources declare conformance to USCoreObservationPregnancyIntentProfile via `meta.profile`
   - Validate that resources pass US Core Observation pregnancy intent profile validation

2. **Status Code Mapping Validation**
   - For each Observation.status value found in conforming resources:
     - Verify that the status code can be mapped to a concept within the SNOMED CT domain "< 445584004 Report by finality status"
     - Confirm that the mapping follows the binding requirements specified in the profile
     - Validate that no invalid or unmappable status codes are present

3. **Binding Compliance**
   - Verify that the Observation.status binding strength requirements are met
   - Confirm that all status values are from the allowed value set or can be appropriately mapped

#### Success Criteria:
- **PASS**: All Observation resources conforming to USCoreObservationPregnancyIntentProfile have status values that successfully map to concepts within the SNOMED CT domain "< 445584004 Report by finality status"
- **FAIL**: Any Observation resource conforming to the profile contains a status value that cannot be mapped to the specified SNOMED CT concept domain

#### Test Execution Steps:
1. Query the system for Observation resources that conform to USCoreObservationPregnancyIntentProfile
2. For each retrieved resource:
   - Validate profile conformance
   - Extract the Observation.status value
   - Verify the status value maps to a concept within SNOMED CT domain "< 445584004 Report by finality status"
3. Document all mapping validation results
4. Report overall conformance status with specific details of any failures

#### Edge Cases to Consider:
- Observation resources with missing status elements
- Status values using different code systems that require cross-system mapping
- Resources claiming profile conformance but failing other profile requirements

---

<a id='req-442'></a>

### REQ-442: The USCoreObservationPregnancyIntentProfile SHALL map the Observation.code to < 363787002 Observable entity OR < 386053000 Evaluation procedure in SNOMED CT.

**Text**: 

**Context**: SNOMED CT Concept Domain Binding for Observation.code in USCoreObservationPregnancyIntentProfile.

**Actor**: USCoreObservationPregnancyIntentProfile

**Conformance**: SHALL

# Test Specification for REQ-442

## 1. Requirement ID
REQ-442

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated through automated testing by examining the FHIR resource structure and verifying SNOMED CT code mappings against the specified concept domains.

### Complexity
**Simple** - The requirement involves straightforward validation of SNOMED CT codes against two specific concept hierarchies using standard terminology validation techniques.

### Prerequisites
- Access to a FHIR server implementing the US Core Server CapabilityStatement
- SNOMED CT terminology service or local SNOMED CT database for concept validation
- Test data containing Observation resources conforming to USCoreObservationPregnancyIntentProfile
- Ability to perform FHIR resource retrieval and terminology operations

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- One or more Observation resources that claim conformance to the USCoreObservationPregnancyIntentProfile
- Resources should contain populated `Observation.code` elements with SNOMED CT codes

**Expected Outputs:**
- Validation results indicating whether each `Observation.code` maps to the required SNOMED CT concept domains
- Pass/fail status for each tested Observation resource
- Detailed validation report showing which codes were validated and their relationship to the required concept hierarchies

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required:

1. **GET /Observation** - Retrieve Observation resources for testing
   - Supported search parameters: `patient`, `category`, `code`, `date`, `status`
   - Can use combinations like `patient+category` to filter for pregnancy intent observations

2. **GET /ValueSet/$expand** - Expand value sets if needed for code validation
   - Supported per the Capability Statement for ValueSet operations

3. **Terminology validation operations** (if available):
   - Concept lookup operations to verify SNOMED CT hierarchy membership
   - May require external terminology service if not available in the target system

### Validation Criteria

**Primary Validation Checks:**

1. **Profile Conformance Verification:**
   - Verify that test Observation resources declare conformance to USCoreObservationPregnancyIntentProfile
   - Check that `Observation.meta.profile` contains the correct profile URL

2. **SNOMED CT Code Domain Validation:**
   - For each `Observation.code.coding` element where `system` equals "http://snomed.info/sct":
     - Verify the code is a descendant of SNOMED CT concept `363787002` (Observable entity), OR
     - Verify the code is a descendant of SNOMED CT concept `386053000` (Evaluation procedure)
   - Use SNOMED CT subsumption testing or concept hierarchy traversal

3. **Terminology System Validation:**
   - Confirm that codes claiming to be SNOMED CT use the correct system URI: "http://snomed.info/sct"
   - Verify that SNOMED CT codes follow proper formatting (numeric format)

**Test Assertion Logic:**
```
FOR each Observation resource conforming to USCoreObservationPregnancyIntentProfile:
  FOR each Observation.code.coding where system = "http://snomed.info/sct":
    ASSERT (code subsumes-or-equals 363787002) OR (code subsumes-or-equals 386053000)
    IF assertion fails:
      RECORD failure with specific code and reason
    ELSE:
      RECORD success
  END FOR
END FOR
```

**Pass Criteria:**
- All SNOMED CT codes in `Observation.code` for USCoreObservationPregnancyIntentProfile resources must map to one of the specified concept domains
- At least one valid test case must be processed to demonstrate conformance

**Fail Criteria:**
- Any SNOMED CT code in `Observation.code` that does not map to either required concept domain
- Invalid SNOMED CT code format or system URI
- No test data available that exercises the requirement

**Test Report Elements:**
- Total number of USCoreObservationPregnancyIntentProfile Observation resources tested
- Number of SNOMED CT codes validated
- List of codes that passed validation with their mapped concept domain
- List of codes that failed validation with specific failure reasons
- Overall pass/fail status for the requirement

---

<a id='req-443'></a>

### REQ-443: The USCoreObservationPregnancyIntentProfile SHALL map the Observation.value[x] to < 441742003 Evaluation finding in SNOMED CT.

**Text**: 

**Context**: SNOMED CT Concept Domain Binding for Observation.value[x] in USCoreObservationPregnancyIntentProfile.

**Actor**: USCoreObservationPregnancyIntentProfile

**Conformance**: SHALL

# Test Specification for REQ-443

## 1. Requirement ID
REQ-443

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated validation of the SNOMED CT concept domain binding for the `Observation.value[x]` element in USCoreObservationPregnancyIntentProfile instances.

### Complexity
**Simple** - The test involves validating that the value element contains a concept that falls under the specified SNOMED CT concept domain (< 441742003 "Evaluation finding").

### Prerequisites
- Server implementing US Core Server CapabilityStatement with Observation resource support
- Access to SNOMED CT terminology service or local SNOMED CT concept hierarchy
- Test data containing USCoreObservationPregnancyIntentProfile instances
- Ability to validate SNOMED CT concept subsumption relationships

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- One or more `Observation` resources conforming to `USCoreObservationPregnancyIntentProfile`
- Each Observation must have a populated `value[x]` element (typically `valueCodeableConcept`)

**Expected Outputs:**
- Validation results indicating whether each `Observation.value[x]` concept is subsumed by SNOMED CT concept 441742003 "Evaluation finding"
- Clear pass/fail indication for each test instance

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are supported and may be used:

1. **GET /Observation/{id}** - Retrieve specific Observation instances for validation
2. **GET /Observation?category=social-history** - Search for pregnancy-related observations (if applicable)
3. **Terminology validation operations** (if supported by the server):
   - **POST /$validate-code** - Validate that codes are subsumed by the parent concept
   - **GET /ValueSet/$expand** - Expand value sets containing the concept domain

### Validation Criteria

**Primary Validation:**
1. **Profile Conformance**: Verify that each test Observation instance conforms to `USCoreObservationPregnancyIntentProfile`

2. **Value Element Presence**: Confirm that `Observation.value[x]` is present and populated

3. **SNOMED CT Concept Domain Validation**: For each `Observation.value[x]`:
   - Extract all SNOMED CT codes from the CodeableConcept
   - Validate that each SNOMED CT code is subsumed by (is a descendant of or equal to) SNOMED CT concept 441742003 "Evaluation finding"
   - This can be achieved through:
     - Direct concept hierarchy lookup
     - FHIR terminology service `$subsumes` operation
     - ValueSet expansion and membership testing

**Specific Assertions for Test Pass:**
- ✅ All Observation instances successfully validate against USCoreObservationPregnancyIntentProfile
- ✅ All `Observation.value[x]` elements contain at least one coding
- ✅ All SNOMED CT codes in `Observation.value[x]` are confirmed to be subsumed by 441742003
- ✅ No validation errors or warnings related to concept domain binding

**Test Failure Indicators:**
- ❌ Any Observation instance fails profile validation
- ❌ Any `Observation.value[x]` is missing or empty
- ❌ Any SNOMED CT code in `Observation.value[x]` is not subsumed by 441742003
- ❌ Use of non-SNOMED CT coding systems where SNOMED CT is required
- ❌ Terminology service returns errors for concept validation

**Implementation Notes:**
- The test should accommodate various data sets by validating whatever pregnancy intent observations are provided
- If terminology service operations are not available, the test may need to rely on pre-computed concept hierarchies or external SNOMED CT validation tools
- The test should handle multiple codings within a single CodeableConcept appropriately
- Consider that concept 441742003 "Evaluation finding" is a broad category, so many pregnancy intent-related evaluation findings should be valid descendants

---

<a id='req-444'></a>

### REQ-444: The USCoreObservationPregnancyIntentProfile SHALL map the Observation.interpretation to < 260245000 Findings values in SNOMED CT.

**Text**: 

**Context**: SNOMED CT Concept Domain Binding for Observation.interpretation in USCoreObservationPregnancyIntentProfile.

**Actor**: USCoreObservationPregnancyIntentProfile

**Conformance**: SHALL

# Test Specification for REQ-444

## 1. Requirement ID
REQ-444

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Automatically testable

This requirement can be automatically tested by validating that FHIR Observation resources conforming to USCoreObservationPregnancyIntentProfile have their `Observation.interpretation` field mapped to values under the SNOMED CT concept < 260245000 (Findings values).

### Complexity
**Level**: Simple

The test involves straightforward validation of SNOMED CT codes against a specific concept hierarchy. The verification requires checking that interpretation codes are descendants of or equivalent to the root concept 260245000.

### Prerequisites
- Access to a FHIR server implementing US Core Server CapabilityStatement
- SNOMED CT terminology server or local SNOMED CT subset for concept hierarchy validation
- Test data containing Observation resources that claim conformance to USCoreObservationPregnancyIntentProfile
- The system under test must support US Core Observation profiles as indicated in the capability statement

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources**:
- Observation resources that declare conformance to `http://hl7.org/fhir/us/core/StructureDefinition/us-core-observation-pregnancyintent` in their `meta.profile`
- Resources should contain populated `Observation.interpretation` elements with SNOMED CT codes

**Expected Outputs**:
- Validation results confirming all interpretation codes are valid SNOMED CT concepts under < 260245000
- Clear identification of any non-conformant codes

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are required:

1. **Resource Retrieval**: 
   - `GET /Observation/{id}` - Retrieve specific Observation resources
   - `GET /Observation?_profile=http://hl7.org/fhir/us/core/StructureDefinition/us-core-observation-pregnancyintent` - Search for pregnancy intent observations

2. **Terminology Operations** (if supported by server):
   - `GET /ValueSet/$expand` - Expand SNOMED CT concept hierarchy for < 260245000
   - `POST /CodeSystem/$subsumes` - Verify subsumption relationship between codes and root concept

### Validation Criteria

The test SHALL verify the following assertions for each USCoreObservationPregnancyIntentProfile resource:

1. **Profile Conformance Verification**:
   - Observation.meta.profile contains `http://hl7.org/fhir/us/core/StructureDefinition/us-core-observation-pregnancyintent`

2. **Interpretation Element Validation**:
   - If `Observation.interpretation` is present, each coding element SHALL:
     - Use SNOMED CT system (http://snomed.info/sct)
     - Contain a valid SNOMED CT code
     - The code SHALL be a descendant of or equivalent to concept 260245000 (Findings values)

3. **SNOMED CT Concept Hierarchy Check**:
   - For each interpretation code, verify subsumption relationship: code ⊆ 260245000
   - This can be validated through:
     - SNOMED CT terminology service subsumption testing
     - Local concept hierarchy lookup
     - ValueSet expansion containing descendants of 260245000

4. **Error Handling**:
   - Resources with interpretation codes that are NOT under < 260245000 SHALL be flagged as non-conformant
   - Resources with non-SNOMED CT interpretation codes SHALL be flagged as non-conformant
   - Resources with invalid SNOMED CT codes SHALL be flagged as non-conformant

**Test Pass Criteria**:
- All Observation resources claiming USCoreObservationPregnancyIntentProfile conformance have interpretation codes that are valid SNOMED CT concepts under the < 260245000 hierarchy
- No validation errors are reported for the SNOMED CT concept domain binding

**Test Fail Criteria**:
- Any Observation resource contains interpretation codes that are not descendants of SNOMED CT concept 260245000
- Any Observation resource contains interpretation codes from non-SNOMED CT code systems
- Any Observation resource contains invalid or inactive SNOMED CT codes in the interpretation field

---

<a id='req-445'></a>

### REQ-445: The USCoreObservationPregnancyIntentProfile SHALL map the Observation.identifier to OBX.21 in HL7 v2.

**Text**: 

**Context**: HL7 v2 mapping for USCoreObservationPregnancyIntentProfile.

**Actor**: USCoreObservationPregnancyIntentProfile

**Conformance**: SHALL

# Test Specification for REQ-445

## 1. Requirement ID
REQ-445

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Not testable via FHIR API testing

**Rationale**: This requirement specifies an HL7 v2 mapping relationship between FHIR Observation.identifier and HL7 v2 OBX.21 field. Since this is a data mapping specification for transformation between FHIR and HL7 v2 formats, it cannot be directly tested through FHIR RESTful API operations. The mapping would only be verifiable in systems that perform FHIR-to-HL7v2 or HL7v2-to-FHIR transformations, which is outside the scope of FHIR conformance testing.

### Complexity
**Classification**: Not Applicable (Not testable via FHIR API)

### Prerequisites
Not applicable - requirement cannot be tested through FHIR API operations.

## 3. Test Implementation Strategy

### Test Approach
This requirement cannot be implemented as a FHIR conformance test because:

1. **Scope Limitation**: The requirement addresses data mapping between FHIR and HL7 v2 formats, which is a transformation specification rather than a FHIR conformance requirement
2. **No FHIR API Surface**: There are no FHIR RESTful operations that would expose or validate this mapping relationship
3. **External System Dependency**: Testing would require access to HL7 v2 transformation engines or interfaces, which are not part of the US Core Server CapabilityStatement

### Alternative Testing Approaches
If this mapping requirement needs to be verified, it would require:

1. **Integration Testing**: Testing systems that perform FHIR-to-HL7v2 transformations to verify the Observation.identifier maps correctly to OBX.21
2. **Transformation Engine Testing**: Direct testing of transformation software/engines that handle the FHIR-to-HL7v2 conversion
3. **Documentation Review**: Verification that implementation documentation correctly specifies this mapping relationship

### Recommendation
This requirement should be reclassified as an **attestation** requirement where implementers must document and attest that their HL7 v2 transformation logic correctly maps USCoreObservationPregnancyIntentProfile.identifier to OBX.21 when performing FHIR-to-HL7v2 conversions.

### Required FHIR Operations
None - this requirement cannot be tested via FHIR RESTful operations.

### Validation Criteria
Not applicable for FHIR API testing.

---

<a id='req-446'></a>

### REQ-446: The USCoreObservationPregnancyIntentProfile SHALL map the Observation.status to OBX-11 in HL7 v2.

**Text**: 

**Context**: HL7 v2 mapping for USCoreObservationPregnancyIntentProfile.

**Actor**: USCoreObservationPregnancyIntentProfile

**Conformance**: SHALL

# Test Specification for REQ-446

## Requirement ID
REQ-446

## Requirement Analysis

### Testability Assessment
**Classification**: Not testable due to being too vague

**Rationale**: This requirement specifies that the USCoreObservationPregnancyIntentProfile SHALL map `Observation.status` to `OBX-11` in HL7 v2. However, this is a mapping specification requirement rather than a functional FHIR interoperability requirement. The requirement lacks sufficient detail about:
- What specific HL7 v2 transformation or conversion process should be tested
- Whether this is about data export, import, or bidirectional mapping
- What the expected mapping values should be between FHIR and HL7 v2
- How the mapping should be validated in a FHIR context

### Complexity
**Level**: Not Applicable

The requirement cannot be directly tested as a FHIR interoperability conformance test because it relates to HL7 v2 mapping specifications rather than FHIR API behavior or resource validation.

### Prerequisites
Not applicable for direct FHIR testing.

## Test Implementation Strategy

### Required Inputs
This requirement cannot be directly tested as a FHIR interoperability test because:

1. **Mapping Specification Nature**: The requirement describes how FHIR elements should map to HL7 v2 elements, which is a transformation/conversion specification rather than a FHIR API requirement.

2. **Missing Context**: The requirement lacks:
   - Specific transformation scenarios to test
   - Expected mapping value sets or conversion rules
   - Implementation context (export, import, etc.)

3. **Outside FHIR Scope**: Testing HL7 v2 mappings requires:
   - HL7 v2 message generation or parsing capabilities
   - Transformation engine testing
   - Comparison between FHIR resources and HL7 v2 messages

### Required FHIR Operations
None - this requirement cannot be tested through standard FHIR API operations as defined in the US Core Server Capability Statement.

### Validation Criteria
**Recommendation**: This requirement should be:

1. **Reclassified** as a mapping specification rather than a testable interoperability requirement
2. **Supplemented** with additional context about:
   - The specific transformation scenario
   - Expected value mappings between FHIR status codes and HL7 v2 OBX-11 values
   - Implementation requirements for systems that perform such transformations

3. **Tested indirectly** through:
   - Validation that USCoreObservationPregnancyIntentProfile instances have valid `Observation.status` values
   - Testing of any transformation systems that claim to implement this mapping specification
   - Documentation review to ensure mapping specifications are clearly defined

### Alternative Testing Approach

If this requirement must be tested, it would require:
1. A test system capable of both FHIR and HL7 v2 processing
2. Sample USCoreObservationPregnancyIntentProfile resources with various status values
3. HL7 v2 transformation capability
4. Verification that the OBX-11 field contains the correctly mapped status value

However, this would be testing a transformation system rather than FHIR interoperability conformance as defined by the US Core Implementation Guide.

---

<a id='req-447'></a>

### REQ-447: The USCoreObservationPregnancyIntentProfile SHALL map the Observation.code to OBX-3 in HL7 v2.

**Text**: 

**Context**: HL7 v2 mapping for USCoreObservationPregnancyIntentProfile.

**Actor**: USCoreObservationPregnancyIntentProfile

**Conformance**: SHALL

# Test Specification for REQ-447

## 1. Requirement ID
REQ-447

## 2. Requirement Analysis

### Testability Assessment
**Not testable** - This requirement specifies HL7 v2 mapping behavior for the USCoreObservationPregnancyIntentProfile, which is outside the scope of FHIR interoperability testing. HL7 v2 mapping is an implementation detail that occurs within systems during data transformation processes and cannot be validated through FHIR API interactions.

### Complexity
**Simple** - The requirement itself is straightforward (mapping Observation.code to OBX-3), but it addresses system-internal transformation logic rather than FHIR interface behavior.

### Prerequisites
- System implementing USCoreObservationPregnancyIntentProfile
- HL7 v2 transformation capability (internal system feature)
- Understanding that this is a mapping specification, not a FHIR API requirement

## 3. Test Implementation Strategy

### Required Inputs
This requirement cannot be tested through FHIR API interactions as it specifies internal HL7 v2 mapping behavior. The mapping of `Observation.code` to `OBX-3` occurs during data transformation processes within systems and is not observable through FHIR RESTful operations.

### Required FHIR Operations
**None** - No FHIR operations can validate HL7 v2 mapping behavior. The US Core Server Capability Statement defines FHIR RESTful capabilities but does not expose internal transformation processes.

### Validation Criteria
**Not applicable for FHIR interoperability testing** - This requirement addresses:
- Internal system transformation logic
- HL7 v2 message structure mapping
- Implementation-specific conversion processes

These aspects are not verifiable through the FHIR API endpoints defined in the US Core Server Capability Statement.

---

**Testing Recommendation**: This requirement should be verified through:
1. **Implementation documentation review** - Confirm the system documents proper mapping of Observation.code to OBX-3
2. **System attestation** - Implementer confirms the mapping is correctly implemented
3. **Internal system testing** - Verify HL7 v2 message generation includes proper OBX-3 mapping (outside FHIR scope)

**Note**: For FHIR interoperability testing purposes, focus should be on verifying that USCoreObservationPregnancyIntentProfile instances are properly created, retrieved, and conform to the profile structure through standard FHIR RESTful operations as defined in the US Core Server Capability Statement.

---

<a id='req-448'></a>

### REQ-448: The USCoreObservationPregnancyIntentProfile SHALL map the Observation.subject to PID-3 in HL7 v2.

**Text**: 

**Context**: HL7 v2 mapping for USCoreObservationPregnancyIntentProfile.

**Actor**: USCoreObservationPregnancyIntentProfile

**Conformance**: SHALL

# Test Specification for REQ-448

## 1. Requirement ID
**REQ-448**: USCoreObservationPregnancyIntentProfile SHALL map Observation.subject to PID-3 in HL7 v2

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Attestation

**Rationale**: This requirement specifies a mapping between FHIR R4 USCoreObservationPregnancyIntentProfile and HL7 v2 message format. Since this is a conceptual mapping specification rather than a runtime FHIR behavior, it cannot be directly tested through FHIR API interactions. The requirement would need to be verified through:
- Documentation review of implementation mapping specifications
- Attestation that systems performing FHIR-to-HL7v2 transformations implement this mapping correctly
- Testing of actual transformation outputs (if transformation capability exists)

### Complexity
**Level**: Moderate

**Justification**: While the mapping concept is straightforward (Observation.subject → PID-3), verifying correct implementation requires understanding of both FHIR and HL7 v2 standards, and access to transformation logic or outputs.

### Prerequisites
- System must support USCoreObservationPregnancyIntentProfile
- System must have FHIR-to-HL7v2 transformation capability (if testing actual transformation)
- Access to transformation documentation or mapping specifications
- Sample USCore Observation (Pregnancy Intent) resources with populated subject fields
- Understanding of HL7 v2 PID segment structure

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Valid USCoreObservationPregnancyIntentProfile instances with populated `Observation.subject` references
- Associated Patient resources that the Observation.subject references point to
- Patient resources should have various identifier types to test different PID-3 scenarios

**Expected Outputs:**
- Documentation or attestation confirming the mapping specification
- If transformation testing: HL7 v2 messages with correctly populated PID-3 fields corresponding to the FHIR Observation.subject values

### Required FHIR Operations
**Note**: Based on the US Core Server Capability Statement, the following operations are supported and may be used for setup/verification:

1. **GET /Observation** - Retrieve USCoreObservationPregnancyIntent instances
2. **GET /Patient** - Retrieve Patient resources referenced by Observation.subject
3. **GET /Observation?category=survey&code=http://loinc.org|76502-6** - Search for pregnancy intent observations (if supported)

### Validation Criteria

Since this is primarily an attestation requirement, the validation approach should include:

#### Primary Validation (Attestation-based):
1. **Documentation Review**:
   - Verify system documentation explicitly states that Observation.subject in USCoreObservationPregnancyIntentProfile maps to PID-3 in HL7 v2 transformations
   - Confirm mapping specification includes handling of different Patient identifier types
   - Validate that transformation logic preserves referential integrity between FHIR reference and HL7 v2 identifier

2. **Implementation Attestation**:
   - System implementer attests that FHIR-to-HL7v2 transformation logic correctly maps Observation.subject to PID-3
   - Attestation should confirm handling of various reference formats (relative, absolute, logical)

#### Secondary Validation (If Transformation Testing Available):
1. **Transformation Output Verification**:
   - Given a USCoreObservationPregnancyIntentProfile with `Observation.subject` reference to a specific Patient
   - When transformed to HL7 v2 format
   - Then the resulting message should contain PID-3 field(s) with identifiers corresponding to the referenced Patient

2. **Reference Resolution Validation**:
   - Verify that the Patient identifier(s) placed in PID-3 can be used to correctly identify the same patient referenced in the original FHIR Observation.subject
   - Confirm that multiple Patient identifiers are handled appropriately in PID-3 repetitions

#### Pass Criteria:
- **For Attestation**: Clear documentation and implementer confirmation of the mapping
- **For Transformation Testing**: Successful mapping of 100% of test cases where Observation.subject values correctly appear as corresponding PID-3 values in HL7 v2 output

#### Fail Criteria:
- Missing or incorrect documentation of the mapping specification
- Implementer cannot attest to proper mapping implementation
- Transformation output shows incorrect, missing, or mismatched Patient identifiers in PID-3 fields

**Note**: This requirement focuses on interoperability conformance for data mapping rather than functional testing, making attestation the most practical approach given the cross-standard nature of the requirement.

---

<a id='req-449'></a>

### REQ-449: The USCoreObservationPregnancyIntentProfile SHALL map the Observation.effective[x] to OBX-14, and/or OBX-19 after v2.4 in HL7 v2.

**Text**: 

**Context**: HL7 v2 mapping for USCoreObservationPregnancyIntentProfile.

**Actor**: USCoreObservationPregnancyIntentProfile

**Conformance**: SHALL

# Test Specification for REQ-449

## Requirement ID
REQ-449

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated testing by examining the HL7 v2 mapping metadata in the USCoreObservationPregnancyIntentProfile and validating that Observation.effective[x] is properly mapped to the specified OBX segments.

### Complexity
**Simple** - This is a straightforward mapping verification requirement that involves checking profile metadata for the presence of specific HL7 v2 mappings.

### Prerequisites
- Access to a US Core-compliant FHIR server supporting the USCoreObservationPregnancyIntentProfile
- Server must support Observation resource operations as defined in the Capability Statement
- Test system must have access to pregnancy intent observation data or ability to create such observations
- Understanding of HL7 v2 OBX segment structure and mapping conventions

## Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation instances conforming to USCoreObservationPregnancyIntentProfile
- **Profile Definition**: Access to the USCoreObservationPregnancyIntentProfile StructureDefinition
- **Test Data**: Pregnancy intent observations with various effective[x] datatypes (effectiveDateTime, effectivePeriod, effectiveInstant)

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required for testing:
- `GET [base]/Observation/[id]` - Read operation for retrieving observation instances
- `GET [base]/Observation?patient=[patient-id]&category=survey` - Search for pregnancy intent observations (using survey category as these are typically survey-based assessments)
- Profile introspection capabilities to examine mapping metadata

### Validation Criteria

#### Primary Validation Points:

1. **Profile Mapping Verification**
   - Verify that the USCoreObservationPregnancyIntentProfile StructureDefinition contains HL7 v2 mapping information
   - Confirm that Observation.effective[x] element has mapping annotations to OBX-14 and/or OBX-19
   - Validate that the mapping specifies applicability "after v2.4" for OBX-19

2. **Implementation Verification**
   - Test with Observation instances using different effective[x] variants:
     - effectiveDateTime
     - effectivePeriod  
     - effectiveInstant
   - Verify that all supported effective[x] variants maintain the mapping requirement

3. **Profile Conformance**
   - Ensure test observations conform to USCoreObservationPregnancyIntentProfile
   - Verify that observations include required elements for pregnancy intent context
   - Confirm proper use of pregnancy intent value sets and codes

#### Test Assertions:

**PASS Criteria:**
- USCoreObservationPregnancyIntentProfile contains explicit HL7 v2 mapping metadata
- Observation.effective[x] element mapping references OBX-14 and/or OBX-19 (post v2.4)
- Mapping documentation clearly indicates version dependency (OBX-19 after v2.4)
- All observation instances tested maintain profile conformance with mapping requirements
- Server can successfully retrieve and process pregnancy intent observations with effective[x] populated

**FAIL Criteria:**
- Missing HL7 v2 mapping information in the profile
- Observation.effective[x] not mapped to specified OBX segments
- Incorrect version specifications for OBX segment usage
- Profile non-conformance in test observation instances
- Server unable to handle effective[x] values consistently with mapping requirements

#### Additional Validation Considerations:

1. **Version Compatibility**: Verify that the mapping properly distinguishes between v2.4 and later versions for OBX-19 usage
2. **Data Type Handling**: Ensure that different FHIR effective[x] data types can be appropriately represented in the corresponding HL7 v2 OBX segments
3. **Completeness**: Validate that the mapping covers all supported effective[x] variants within the pregnancy intent observation context

---

<a id='req-450'></a>

### REQ-450: The USCoreObservationPregnancyIntentProfile SHALL map the Observation.performer to OBX.15 in HL7 v2.

**Text**: 

**Context**: HL7 v2 mapping for USCoreObservationPregnancyIntentProfile.

**Actor**: USCoreObservationPregnancyIntentProfile

**Conformance**: SHALL

# Test Specification for REQ-450

## Requirement ID
REQ-450

## Requirement Analysis

### Testability Assessment
**Classification**: Automatically testable

This requirement is automatically testable as it involves verifying a specific mapping between FHIR elements and HL7 v2 fields. The test can programmatically validate that the Observation.performer field in a USCoreObservationPregnancyIntentProfile resource correctly maps to the OBX.15 field in the corresponding HL7 v2 message.

### Complexity
**Level**: Moderate

The complexity is moderate because it requires:
- Understanding of both FHIR and HL7 v2 message structures
- Validation of data transformation between two different standards
- Knowledge of the specific pregnancy intent observation profile constraints

### Prerequisites
- System must support US Core Observation Pregnancy Intent Profile
- System must be capable of generating or processing HL7 v2 messages with OBX segments
- Test environment must have access to pregnancy intent observations with performer data
- Mapping functionality between FHIR and HL7 v2 must be implemented in the system under test

## Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- One or more Observation resources conforming to the US Core Observation Pregnancy Intent Profile
- Each observation must contain:
  - `Observation.performer` element populated with reference(s) to practitioner/organization
  - Valid pregnancy intent coding (e.g., from the appropriate value set)
  - Required US Core elements (patient, status, category, code)

**Expected Outputs:**
- Corresponding HL7 v2 message(s) containing OBX segment(s)
- OBX.15 field populated with data corresponding to the FHIR Observation.performer

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and may be used:

1. **GET /Observation** - Retrieve pregnancy intent observations
   - Supported search parameters: `patient`, `category`, `code`, `date`, `status`
   - Example: `GET /Observation?patient=[id]&category=survey&code=[pregnancy-intent-code]`

2. **GET /Observation/[id]** - Retrieve specific observation by ID

### Validation Criteria

**Primary Assertions:**
1. **Performer Presence Validation**:
   - Verify that when `Observation.performer` is present in the FHIR resource, the corresponding OBX.15 field is populated in the HL7 v2 message
   - Assert that OBX.15 is not empty or null when performer data exists

2. **Data Consistency Validation**:
   - Verify that the practitioner/organization referenced in `Observation.performer` correctly maps to the identifier/name in OBX.15
   - Assert that the data format in OBX.15 follows HL7 v2 standards for provider identification

3. **Profile Conformance**:
   - Confirm that the source Observation resource validates against the US Core Observation Pregnancy Intent Profile
   - Verify that all mandatory elements per the profile are present

**Secondary Assertions:**
1. **Multiple Performers Handling**:
   - When multiple performers are present in the FHIR resource, verify appropriate handling in OBX.15 (concatenation, repetition, etc.)

2. **Null/Empty Case Handling**:
   - When `Observation.performer` is absent or empty, verify that OBX.15 is appropriately handled (empty, default value, or omitted per implementation)

**Test Passing Criteria:**
- All observations with performer data successfully map to OBX.15
- Data integrity is maintained across the transformation
- No data loss or corruption occurs during mapping
- HL7 v2 message structure remains valid after mapping
- Mapping follows consistent patterns across all test observations

**Test Implementation Notes:**
- Tests should work with any valid pregnancy intent observations provided by the tester
- Validation should account for different performer types (Practitioner, PractitionerRole, Organization)
- Tests should verify bidirectional mapping consistency if the system supports both FHIR-to-v2 and v2-to-FHIR transformations

---

<a id='req-469'></a>

### REQ-469: US Core Average Blood Pressure Profile implementation

**Text**: 

**Context**: System conformance to US Core Average Blood Pressure Profile.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-469

## 1. Requirement ID
REQ-469: US Core Average Blood Pressure Profile implementation

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - The requirement can be verified through automated testing by validating server responses against the US Core Average Blood Pressure Profile structure and constraints.

### Complexity
**Moderate** - Requires validation of profile-specific constraints, Must Support elements, and proper FHIR resource structure, but follows standard US Core testing patterns.

### Prerequisites
- System must implement US Core Server capabilities as specified in the CapabilityStatement
- System must support Observation resource operations (read, search)
- System must have Average Blood Pressure observations available for testing
- System must support JSON format (required) and optionally XML format
- System must implement proper authentication and authorization mechanisms

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Observation resources conforming to US Core Average Blood Pressure Profile
- Patient resources referenced by the Observation resources
- Any referenced Encounter, Practitioner, or Organization resources as applicable

**Expected Outputs:**
- Valid FHIR Observation resources with proper profile conformance
- Correct HTTP status codes (200 for successful operations, 4xx for errors)
- Proper `meta.profile` declarations (recommended)
- JSON formatted responses (required), XML if supported

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations must be supported:

1. **GET [base]/Observation/[id]** - Read specific Average Blood Pressure observations
2. **GET [base]/Observation?patient=[reference]** - Search for Average Blood Pressure observations by patient
3. **GET [base]/Observation?category=vital-signs** - Search for vital signs observations
4. **GET [base]/Observation?code=[code]** - Search by specific blood pressure codes

### Validation Criteria

#### Profile Conformance Validation
- **PASS**: Observation resources validate successfully against the US Core Average Blood Pressure Profile
- **PASS**: All Must Support elements are present when data is available
- **PASS**: Required value sets and code systems are used correctly
- **PASS**: Data types and cardinalities conform to profile specifications

#### Resource Structure Validation
- **PASS**: Observation.status contains valid values from required value set
- **PASS**: Observation.category includes "vital-signs" coding
- **PASS**: Observation.code uses appropriate LOINC codes for average blood pressure
- **PASS**: Observation.subject references a valid Patient resource
- **PASS**: Observation.component contains systolic and diastolic components with proper codes
- **PASS**: Observation.effectiveDateTime or Observation.effectivePeriod is present

#### Search and Retrieval Validation
- **PASS**: Server responds with HTTP 200 for valid read operations
- **PASS**: Server responds with appropriate 4xx status codes for invalid requests
- **PASS**: Search operations return relevant Average Blood Pressure observations
- **PASS**: Returned resources include proper resource metadata

#### Format and Encoding Validation
- **PASS**: Server returns valid JSON responses (required)
- **PASS**: Server returns valid XML responses if XML support is claimed
- **PASS**: Content-Type headers are correctly set for response format

#### Security and Authorization Validation
- **PASS**: Server properly handles unauthorized requests with appropriate HTTP status codes (401, 403, or 404)
- **PASS**: Server enforces scope-based access controls where applicable

#### Reference Integrity Validation
- **PASS**: Patient references in Observation.subject resolve to valid US Core Patient resources
- **PASS**: All referenced resources conform to their respective US Core profiles
- **PASS**: Referenced resources are accessible through appropriate read operations

#### Must Support Compliance
- **PASS**: All Must Support elements defined in the US Core Average Blood Pressure Profile are populated when relevant data exists
- **PASS**: System can demonstrate capability to support all Must Support elements through available test data

**Overall Test Result:**
- **PASS**: All individual validation criteria pass
- **FAIL**: Any validation criteria fails, with specific failure details documented

---

<a id='req-470'></a>

### REQ-470: US Core Care Experience Preference Profile implementation

**Text**: 

**Context**: System conformance to US Core Care Experience Preference Profile.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-470

## 1. Requirement ID
**REQ-470**: US Core Care Experience Preference Profile implementation

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated testing by validating that the system correctly implements and supports the US Core Care Experience Preference Profile according to the specification.

### Complexity
**Moderate** - The test requires validation of profile conformance, Must Support elements, and proper FHIR resource handling, but follows standard US Core testing patterns.

### Prerequisites
- System must be configured as a US Core Server
- System must have Observation resources that conform to the US Core Care Experience Preference Profile available for testing
- System must support JSON format (SHALL requirement)
- Valid authentication credentials if security is implemented
- Test data should include Observation resources representing care experience preferences

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources conforming to the US Core Care Experience Preference Profile
- **System Endpoint**: Base FHIR server URL implementing US Core Server capabilities
- **Authentication**: Valid credentials if required by the system
- **Test Data**: Existing Observation resources in the system that represent care experience preferences

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations should be supported:

1. **GET /Observation/{id}** - Read individual Care Experience Preference observations
2. **GET /Observation?[search-parameters]** - Search for Care Experience Preference observations using supported search parameters
3. **GET /metadata** - Retrieve CapabilityStatement to verify profile support declaration

### Validation Criteria

#### Profile Conformance Validation
- **Assertion 1**: Retrieved Observation resources SHALL validate against the US Core Care Experience Preference Profile
- **Assertion 2**: Resources SHALL include `meta.profile` indicating conformance to `http://hl7.org/fhir/us/core/StructureDefinition/us-core-care-experience-preference` (SHOULD requirement)
- **Assertion 3**: All Must Support elements defined in the profile SHALL be present when the data exists

#### FHIR RESTful API Compliance
- **Assertion 4**: System SHALL return appropriate HTTP status codes:
  - 200 for successful requests
  - 400 for invalid parameters
  - 401/403 for unauthorized requests
  - 404 for unknown resources
- **Assertion 5**: System SHALL support JSON format for all interactions
- **Assertion 6**: Response resources SHALL contain all required elements as defined by the US Core Care Experience Preference Profile

#### CapabilityStatement Verification
- **Assertion 7**: Server CapabilityStatement SHALL declare support for the US Core Care Experience Preference Profile in the supported profiles list
- **Assertion 8**: CapabilityStatement SHALL indicate support for Observation resource operations consistent with the profile requirements

#### Must Support Compliance
- **Assertion 9**: System SHALL support all Must Support elements defined in the US Core Care Experience Preference Profile
- **Assertion 10**: When Must Support elements are present in the data, they SHALL be included in returned resources
- **Assertion 11**: System SHALL handle Must Support references to other US Core Profiles appropriately

#### Search Functionality (if applicable)
- **Assertion 12**: If the system supports Observation search, it SHALL support search parameters relevant to Care Experience Preference observations
- **Assertion 13**: Search results SHALL only return resources that conform to the expected profile when profile-specific searches are performed

#### Data Integrity
- **Assertion 14**: Retrieved resources SHALL maintain referential integrity for any references to other US Core profiles
- **Assertion 15**: Resource content SHALL be consistent with the semantic requirements of care experience preference data representation

### Test Execution Approach
1. **Discovery Phase**: Query the CapabilityStatement to verify declared support for the profile
2. **Resource Retrieval**: Attempt to read existing Care Experience Preference observations using various access patterns
3. **Profile Validation**: Validate each retrieved resource against the US Core Care Experience Preference Profile using FHIR validation tools
4. **Must Support Verification**: Confirm that all Must Support elements are properly handled
5. **Error Handling**: Verify appropriate error responses for invalid requests
6. **Format Compliance**: Ensure JSON format support and optional XML format support

This test specification follows a "bring your own data" approach by testing against existing resources in the system rather than requiring specific test fixtures, making it adaptable to different system implementations and datasets.

---

<a id='req-471'></a>

### REQ-471: US Core Observation ADI Documentation Profile implementation

**Text**: 

**Context**: System conformance to US Core Observation ADI Documentation Profile.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-471

## 1. Requirement ID
**REQ-471**: US Core Observation ADI Documentation Profile implementation

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Automatically testable

The requirement can be automatically tested by verifying that the system can create, store, and retrieve Observation resources that conform to the US Core Observation ADI Documentation Profile structure and constraints.

### Complexity
**Level**: Moderate

The test requires validation of profile conformance, data element requirements, and proper FHIR resource structure, but follows standard FHIR testing patterns.

### Prerequisites
- System must support FHIR R4
- System must implement US Core Server CapabilityStatement
- System must have capability to handle Observation resources
- Test data must include patient records with advance directive documentation
- System must support RESTful FHIR operations (CREATE, READ, SEARCH)

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources Needed**:
- Patient resource (as subject reference for Observations)
- Observation resources conforming to US Core Observation ADI Documentation Profile
- Any referenced DocumentReference or other supporting resources

**Expected Outputs**:
- Valid FHIR Observation resources conforming to the profile
- Appropriate HTTP response codes (200, 201, etc.)
- Proper FHIR Bundle responses for search operations

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations must be supported:

1. **CREATE** - `POST [base]/Observation`
   - Create new ADI Documentation Observations
   
2. **READ** - `GET [base]/Observation/[id]`
   - Retrieve specific ADI Documentation Observations
   
3. **SEARCH** - `GET [base]/Observation?[parameters]`
   - Search for ADI Documentation Observations using supported parameters
   - Common search parameters: `patient`, `category`, `code`, `date`

### Validation Criteria

#### Profile Conformance Validation
- **Assertion 1**: All Observation resources SHALL declare conformance to `http://hl7.org/fhir/us/core/StructureDefinition/us-core-observation-adi-documentation`
- **Assertion 2**: Resources SHALL pass FHIR validator checks against the US Core Observation ADI Documentation Profile
- **Assertion 3**: All required data elements per the profile SHALL be present and populated

#### Structural Validation
- **Assertion 4**: Observation.status SHALL be present with appropriate value from required value set
- **Assertion 5**: Observation.category SHALL include appropriate coding for advance directive documentation
- **Assertion 6**: Observation.code SHALL use appropriate terminology for advance directive types
- **Assertion 7**: Observation.subject SHALL reference a valid Patient resource
- **Assertion 8**: Observation.effectiveDateTime or Observation.effectivePeriod SHALL be present

#### Data Quality Validation
- **Assertion 9**: If Observation.valueCodeableConcept is used, it SHALL use appropriate terminology bindings
- **Assertion 10**: If Observation.component is present, components SHALL follow profile constraints
- **Assertion 11**: Any referenced resources (Patient, Practitioner, etc.) SHALL be valid and accessible

#### Interoperability Validation
- **Assertion 12**: CREATE operations SHALL return appropriate HTTP status codes (201 Created)
- **Assertion 13**: READ operations SHALL return the complete resource with all profile-required elements
- **Assertion 14**: SEARCH operations SHALL return relevant resources matching search criteria
- **Assertion 15**: All returned resources SHALL include proper resource metadata (id, meta.profile, etc.)

#### Test Cases

**Test Case 1: Profile Conformance Validation**
- Validate that created/retrieved Observation resources conform to the US Core ADI Documentation profile
- Verify all mandatory elements are present and correctly formatted

**Test Case 2: CRUD Operations Testing**
- Test Create: POST new ADI Documentation Observations
- Test Read: GET specific Observation by ID
- Test Search: Query for ADI Documentation Observations using various search parameters

**Test Case 3: Reference Integrity**
- Verify that all resource references (Patient, Practitioner, etc.) are valid and resolvable
- Ensure referential integrity is maintained across related resources

**Test Case 4: Terminology Validation**
- Validate that coded elements use appropriate value sets and code systems
- Verify terminology bindings match profile requirements

**Passing Criteria**: All assertions must pass, and the system must demonstrate ability to handle US Core Observation ADI Documentation Profile resources through standard FHIR operations while maintaining conformance to the profile specifications.

---

<a id='req-472'></a>

### REQ-472: US Core Observation Clinical Result Profile implementation

**Text**: 

**Context**: System conformance to US Core Observation Clinical Result Profile.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-472

## 1. Requirement ID
**REQ-472**: US Core Observation Clinical Result Profile implementation

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated testing by validating Observation resources against the US Core Clinical Result profile and testing FHIR operations support.

### Complexity
**Moderate** - Requires validation of profile conformance, Must Support elements, and RESTful operations support across multiple test scenarios.

### Prerequisites
- System must be configured as a US Core Server
- System must have Observation resources with clinical results data available
- System must support JSON format (required by US Core Server capability)
- System must implement proper authentication/authorization mechanisms
- Test client must have appropriate access credentials

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Observation resources that represent clinical results (laboratory values, vital signs measurements, diagnostic findings)
- Associated Patient resources referenced by the Observations
- Any referenced Practitioner, Organization, or Device resources as appropriate

**Expected Outputs:**
- Valid US Core Clinical Result Observation resources
- Proper HTTP response codes (200, 400, 401, 403, 404)
- JSON-formatted responses
- Correct FHIR meta.profile declarations (SHOULD)

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations must be supported:

1. **READ Operation**: `GET [base]/Observation/[id]`
2. **SEARCH Operations**: 
   - `GET [base]/Observation?[search parameters]`
   - Support for US Core defined search parameters for Observation resources
3. **Response Handling**: Support for required HTTP status codes

### Validation Criteria

#### Profile Conformance Validation
- **Assertion 1**: All returned Observation resources SHALL validate against the US Core Clinical Result Observation profile
- **Assertion 2**: All Must Support elements defined in the profile SHALL be present when the system has the data
- **Assertion 3**: All required terminology bindings SHALL be correctly applied
- **Assertion 4**: All cardinality constraints SHALL be satisfied

#### RESTful Operations Validation
- **Assertion 5**: READ operations SHALL return valid US Core Clinical Result Observation resources
- **Assertion 6**: SEARCH operations SHALL return valid US Core Clinical Result Observation resources that match search criteria
- **Assertion 7**: System SHALL support JSON format responses
- **Assertion 8**: System SHALL return appropriate HTTP status codes:
  - 200 for successful requests
  - 400 for invalid parameters
  - 401/4xx for unauthorized requests  
  - 403 for insufficient scopes
  - 404 for unknown resources

#### Must Support References Validation
- **Assertion 9**: All referenced resources (Patient, Practitioner, Organization, etc.) SHALL conform to their respective US Core profiles when present
- **Assertion 10**: All Must Support references SHALL be resolvable if the system has the referenced data

#### Metadata Validation
- **Assertion 11**: Resources SHOULD include the US Core Clinical Result profile URL in meta.profile element
- **Assertion 12**: CapabilityStatement SHALL declare support for US Core Clinical Result Observation profile

#### Security Validation
- **Assertion 13**: System SHALL properly handle unauthorized requests with appropriate HTTP error codes
- **Assertion 14**: System SHALL implement authentication mechanisms as defined in US Core security requirements

#### Format Support Validation
- **Assertion 15**: System SHALL support JSON format for all interactions
- **Assertion 16**: System SHOULD support XML format for all interactions (optional validation)

### Test Execution Approach

1. **Profile Validation Tests**: Use FHIR validation tools to verify each Observation resource against US Core Clinical Result profile
2. **API Interaction Tests**: Execute READ and SEARCH operations against available Observation resources
3. **Reference Integrity Tests**: Validate that all referenced resources are accessible and conform to appropriate profiles
4. **Error Handling Tests**: Test system responses to invalid requests, unauthorized access, and missing resources
5. **Format Tests**: Verify JSON support (required) and XML support (recommended)

### Success Criteria
The test passes when all assertions (1-16) are satisfied, demonstrating full conformance to the US Core Clinical Result Observation profile requirements and proper implementation of the supporting RESTful capabilities defined in the US Core Server CapabilityStatement.

---

<a id='req-473'></a>

### REQ-473: US Core Laboratory Result Observation Profile implementation

**Text**: 

**Context**: System conformance to US Core Laboratory Result Observation Profile.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-473

## 1. Requirement ID
**REQ-473**: US Core Laboratory Result Observation Profile implementation

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated through automated testing by verifying that Observation resources returned by the system conform to the US Core Laboratory Result Observation Profile structure and constraints.

### Complexity
**Moderate** - The test involves profile validation, specific element requirements, and terminology binding verification for laboratory observations.

### Prerequisites
- System must implement US Core Server CapabilityStatement
- System must have laboratory observation data available
- System must support Observation resource queries as specified in US Core Server capabilities
- Test environment must have access to US Core Laboratory Result Observation Profile definition for validation

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources of category "laboratory" from the system under test
- **Profile Definition**: US Core Laboratory Result Observation Profile (http://hl7.org/fhir/us/core/StructureDefinition/us-core-observation-lab)
- **Test Data**: System's existing laboratory observation data (bring your own data approach)

### Expected Outputs
- Valid Observation resources that conform to US Core Laboratory Result Observation Profile
- Appropriate HTTP response codes (200 for successful queries)
- FHIR-compliant JSON/XML responses

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations should be supported:

1. **GET /Observation** - Search for laboratory observations
2. **GET /Observation/[id]** - Read specific laboratory observation by ID
3. **GET /Observation?patient=[reference]** - Search laboratory observations by patient
4. **GET /Observation?category=laboratory** - Search observations by laboratory category

### Validation Criteria

#### Profile Conformance Validation
- **Assertion 1**: All returned Observation resources must validate against the US Core Laboratory Result Observation Profile
- **Assertion 2**: Resources must include the required profile declaration in `meta.profile`

#### Required Element Validation
- **Assertion 3**: Verify presence of required elements:
  - `status` (required)
  - `category` with laboratory coding (required)
  - `code` (required) 
  - `subject` referencing a Patient (required)
  - `effectiveDateTime` or `effectivePeriod` (required)
  - `value[x]` or `dataAbsentReason` (required)

#### Terminology Binding Validation
- **Assertion 4**: Verify `category` includes appropriate laboratory category coding from http://terminology.hl7.org/CodeSystem/observation-category
- **Assertion 5**: Verify `code` uses appropriate laboratory terminology (LOINC preferred)
- **Assertion 6**: Validate terminology bindings match profile requirements (extensible, required, or preferred as specified)

#### Cardinality and Constraint Validation
- **Assertion 7**: Verify cardinality constraints are met for all elements
- **Assertion 8**: Validate US Core specific constraints and invariants are satisfied

#### Data Type and Format Validation
- **Assertion 9**: Confirm all data types conform to FHIR R4 specifications
- **Assertion 10**: Validate that reference elements properly reference valid resources

#### Search Parameter Validation
- **Assertion 11**: Verify system supports required search parameters for laboratory observations as defined in US Core Server CapabilityStatement
- **Assertion 12**: Confirm search results return only laboratory category observations when filtered appropriately

#### Response Format Validation
- **Assertion 13**: Verify proper HTTP status codes for successful and error scenarios
- **Assertion 14**: Confirm proper FHIR Bundle structure for search operations
- **Assertion 15**: Validate proper content-type headers and FHIR version compatibility

### Test Execution Approach
1. Query the system for available laboratory observations using supported search parameters
2. Retrieve a representative sample of laboratory observation resources
3. Validate each resource against the US Core Laboratory Result Observation Profile using FHIR validation tools
4. Verify all mandatory elements, terminology bindings, and constraints
5. Confirm search functionality works correctly for laboratory-specific queries
6. Document any non-conformant resources or missing required capabilities

---

<a id='req-474'></a>

### REQ-474: US Core Observation Occupation Profile implementation

**Text**: 

**Context**: System conformance to US Core Observation Occupation Profile.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-474

## 1. Requirement ID
REQ-474: US Core Observation Occupation Profile implementation

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated through automated testing by verifying that the system correctly implements the US Core Observation Occupation Profile according to its structural and terminology constraints.

### Complexity
**Moderate** - The test requires validation of profile conformance including specific data elements, value sets, and constraints defined in the US Core Observation Occupation Profile, but does not involve complex workflow scenarios.

### Prerequisites
- System must support FHIR R4
- System must have US Core Server capability implemented
- System must have at least one Observation resource with occupation data available for testing
- System must support RESTful FHIR operations (read, search) as defined in the US Core Server CapabilityStatement

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- One or more Observation resources that claim conformance to the US Core Observation Occupation Profile
- Patient resource(s) referenced by the occupation observations (for context validation)

**Expected Outputs:**
- Valid FHIR Observation resources that successfully validate against the US Core Observation Occupation Profile
- Proper HTTP response codes (200 for successful operations)
- Resources that contain all required data elements as specified in the profile

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations should be supported:

1. **GET [base]/Observation/[id]** - Read specific occupation observation
2. **GET [base]/Observation?patient=[reference]** - Search for observations by patient
3. **GET [base]/Observation?category=social-history** - Search for social history observations (occupation falls under this category)
4. **GET [base]/Observation?code=[occupation-code]** - Search by specific occupation-related codes

### Validation Criteria

The following assertions must pass to demonstrate conformance:

#### Profile Conformance Validation
1. **Profile Declaration**: Each Observation resource must declare conformance to `http://hl7.org/fhir/us/core/StructureDefinition/us-core-observation-occupation` in its `meta.profile` element

2. **Required Elements Presence**:
   - `status` element must be present and contain a valid value
   - `category` element must be present with appropriate coding
   - `code` element must be present with occupation-related coding
   - `subject` element must be present and reference a Patient resource
   - `effectiveDateTime` or `effectivePeriod` must be present

3. **Terminology Validation**:
   - `category` must include coding from `http://terminology.hl7.org/CodeSystem/observation-category` with value "social-history"
   - `code` must use appropriate occupation classification system (e.g., SNOMED CT, local codes)
   - `status` must use values from the required ValueSet

4. **Data Type Validation**:
   - All elements must conform to their specified data types
   - Cardinalities must be respected (required elements present, optional elements within bounds)

#### Functional Validation
5. **Resource Integrity**: Referenced Patient resources must be accessible and valid

6. **Search Capability**: System must successfully return occupation observations when searched using supported parameters

7. **Content Validation**: 
   - Occupation data should be clinically meaningful and properly coded
   - Temporal information (effective date/period) should be present and reasonable

#### Technical Validation
8. **HTTP Compliance**: Proper HTTP status codes returned for all operations

9. **FHIR Compliance**: Resources must validate against FHIR R4 base specification

10. **Profile-Specific Constraints**: All constraints defined in the US Core Observation Occupation Profile must be satisfied

### Test Pass Criteria
A test passes when:
- All FHIR validation rules for the US Core Observation Occupation Profile are satisfied
- Required FHIR operations execute successfully with appropriate HTTP responses
- All mandatory data elements are present and valid according to the profile specifications
- Terminology bindings are correctly implemented
- Search operations return appropriate results when occupation observations exist

### Test Failure Criteria
A test fails when:
- FHIR validation against the profile fails
- Required elements are missing or invalid
- Incorrect terminology codes are used
- HTTP operations return unexpected error codes
- Search operations fail to return available occupation observation data
- Resources do not properly reference related Patient resources

---

<a id='req-475'></a>

### REQ-475: US Core Observation Pregnancy Intent Profile implementation

**Text**: 

**Context**: System conformance to US Core Observation Pregnancy Intent Profile.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-475

## 1. Requirement ID
**REQ-475**: US Core Observation Pregnancy Intent Profile implementation

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be tested through automated validation of FHIR resources against the US Core Observation Pregnancy Intent Profile specification and verification of proper profile declaration.

### Complexity
**Simple** - The requirement focuses on conformance to a specific US Core profile, which can be validated through standard FHIR validation mechanisms and profile compliance checks.

### Prerequisites
- System must support US Core Server capabilities as defined in the US Core Server CapabilityStatement
- System must have Observation resources that represent pregnancy intent data
- System must support JSON format (SHALL requirement from CapabilityStatement)
- System must implement proper security controls (authentication/authorization)

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources that claim conformance to the US Core Observation Pregnancy Intent Profile
- **Profile URL**: `http://hl7.org/fhir/us/core/StructureDefinition/us-core-observation-pregnancyintent`
- **Authentication credentials**: Valid credentials for system access
- **Search parameters**: Standard FHIR Observation search parameters as supported by the system

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are supported:
- **GET** `/Observation/{id}` - Retrieve specific Observation resources
- **GET** `/Observation` - Search for Observation resources using standard FHIR search parameters
- **Response format**: JSON (SHALL support), XML (SHOULD support)

### Validation Criteria

#### Primary Conformance Checks
1. **Profile Declaration Validation**
   - Verify that Observation resources claiming pregnancy intent conformance include the correct profile URL in `meta.profile`
   - Expected: `meta.profile` contains `http://hl7.org/fhir/us/core/StructureDefinition/us-core-observation-pregnancyintent`

2. **FHIR Profile Validation**
   - Validate retrieved Observation resources against the US Core Observation Pregnancy Intent Profile using FHIR validation
   - Expected: Resources pass validation without errors for all SHALL constraints
   - Expected: Resources pass validation without errors for all mandatory elements

3. **Must Support Element Verification**
   - Verify that all Must Support elements defined in the US Core Observation Pregnancy Intent Profile are present when data is available
   - Verify proper data types and value constraints for Must Support elements

#### API Conformance Checks
4. **Response Format Compliance**
   - Verify system returns valid JSON responses (SHALL requirement)
   - Verify system handles XML requests appropriately if supported (SHOULD requirement)

5. **HTTP Status Code Compliance**
   - Verify appropriate HTTP status codes are returned:
     - 200: Successful retrieval
     - 400: Invalid parameter (if applicable)
     - 401/403/404: Security-related responses as appropriate

6. **Security Compliance**
   - Verify system properly handles authentication and authorization
   - Verify unauthorized requests return appropriate HTTP status codes (401, 403, or 404)

#### Test Execution Steps
1. **Discovery Phase**
   - Query the system to identify Observation resources that claim conformance to the US Core Observation Pregnancy Intent Profile
   - Use search parameters to locate pregnancy intent observations in the system's data

2. **Resource Retrieval**
   - Retrieve individual Observation resources using GET `/Observation/{id}`
   - Retrieve collections using search operations

3. **Validation Phase**
   - Validate each retrieved resource against the US Core Observation Pregnancy Intent Profile
   - Check for proper profile declaration in `meta.profile`
   - Verify Must Support elements are present and properly formatted

4. **Compliance Verification**
   - Confirm JSON response format compliance
   - Verify appropriate HTTP status codes
   - Test security controls with invalid credentials

#### Success Criteria
- All Observation resources claiming pregnancy intent profile conformance successfully validate against the profile
- Profile URLs are correctly declared in `meta.profile` elements
- Must Support elements are properly implemented when data is available
- System demonstrates proper API behavior per US Core Server CapabilityStatement requirements
- Security controls function as specified

#### Failure Indicators
- Resources fail FHIR profile validation
- Missing or incorrect profile declarations
- Must Support elements are missing when data should be available
- Improper HTTP status codes or response formats
- Security vulnerabilities or improper access control responses

---

<a id='req-476'></a>

### REQ-476: The system SHALL map the Observation identifier to OBX.21 in HL7 v2.

**Text**: 

**Context**: Applies when transforming FHIR Observation resources to HL7 v2 messages per the HL7 v2 Mapping guidance; verifies correct population of OBX.21 from Observation.identifier.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-476

## 1. Requirement ID
REQ-476

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Automatically testable

This requirement is automatically testable as it specifies a concrete mapping behavior between FHIR Observation resources and HL7 v2 messages. The test can verify that the system correctly maps Observation.identifier values to the OBX.21 field in generated HL7 v2 messages.

### Complexity
**Level**: Moderate

The complexity is moderate because it requires:
- Understanding of both FHIR Observation structure and HL7 v2 OBX segment format
- Ability to trigger FHIR-to-HL7v2 transformation
- Validation of correct field mapping between different data formats
- Handling multiple identifier scenarios

### Prerequisites
- System must support FHIR Observation resources with US Core compliance
- System must have HL7 v2 transformation capability enabled
- System must be configured to transform FHIR Observations to HL7 v2 messages
- Test environment must support both FHIR API interactions and HL7 v2 message inspection
- System must have appropriate security credentials configured for FHIR operations

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources Needed**:
- FHIR Observation resources containing populated `identifier` elements with various scenarios:
  - Single identifier
  - Multiple identifiers
  - Identifiers with different systems and values
  - Identifiers with use codes (if present)

**Expected Outputs**:
- HL7 v2 messages containing OBX segments with properly populated OBX.21 fields
- OBX.21 should contain the mapped identifier information from the source FHIR Observation

### Required FHIR Operations
Based on the US Core Server Capability Statement, the following operations are supported and may be needed:

1. **GET /Observation/{id}** - To retrieve specific Observation resources for transformation testing
2. **GET /Observation?[search-parameters]** - To query for Observations meeting specific criteria
3. **System-specific transformation endpoint** - To trigger FHIR-to-HL7v2 conversion (implementation-specific)

*Note: The core FHIR operations are supported per the US Core Server capabilities. The actual transformation trigger mechanism may vary by implementation.*

### Validation Criteria

#### Primary Validation Checks:
1. **Identifier Presence Validation**:
   - Verify that when a FHIR Observation contains `identifier` elements, the resulting HL7 v2 OBX segment contains populated OBX.21 field(s)
   - Assert: `OBX.21 IS NOT NULL` when `Observation.identifier` exists

2. **Value Mapping Accuracy**:
   - Verify that the content of OBX.21 correctly represents the FHIR Observation.identifier values
   - Assert: OBX.21 content matches the expected format for the identifier system and value
   - Validate proper encoding of identifier components (system, value, use if applicable)

3. **Multiple Identifier Handling**:
   - When multiple identifiers exist in the FHIR Observation, verify appropriate handling in OBX.21
   - Assert: All relevant identifiers are represented in the HL7 v2 output according to HL7 v2 mapping specifications

4. **Data Type Consistency**:
   - Verify that the data type and format of OBX.21 conforms to HL7 v2 specifications
   - Assert: OBX.21 follows proper HL7 v2 encoding rules for the identifier data type

#### Test Scenarios:
1. **Single Identifier Test**:
   - Input: Observation with one identifier
   - Expected: OBX.21 populated with single identifier mapping

2. **Multiple Identifier Test**:
   - Input: Observation with multiple identifiers
   - Expected: OBX.21 appropriately represents all identifiers per HL7 v2 mapping rules

3. **Missing Identifier Test**:
   - Input: Observation without identifier elements
   - Expected: OBX.21 handling per HL7 v2 mapping guidance (may be empty/null)

4. **Complex Identifier Test**:
   - Input: Observation with identifiers containing various systems, values, and metadata
   - Expected: Correct preservation of identifier semantics in OBX.21 format

#### Success Criteria:
- All identifier values from FHIR Observation.identifier are correctly mapped to OBX.21
- HL7 v2 message structure remains valid after transformation
- No data loss occurs during the mapping process
- Mapping follows established HL7 v2 transformation guidelines

---

<a id='req-477'></a>

### REQ-477: The system SHALL map the Observation status to OBX-11 in HL7 v2.

**Text**: 

**Context**: Applies when transforming FHIR Observation resources to HL7 v2 messages per the HL7 v2 Mapping guidance; verifies correct population of OBX-11 from Observation.status.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-477

## 1. Requirement ID
REQ-477

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be automatically validated by:
- Parsing FHIR Observation resources from the system
- Verifying the system's HL7 v2 transformation output 
- Checking that Observation.status values are correctly mapped to OBX-11 fields

### Complexity
**Moderate** - The test involves:
- FHIR resource parsing and validation
- HL7 v2 message generation and parsing
- Cross-format data mapping verification
- Understanding of both FHIR and HL7 v2 standards

### Prerequisites
- System must support US Core Observation profiles
- System must have HL7 v2 transformation capability enabled
- Test data must include Observation resources with various status values
- Access to both FHIR API endpoints and HL7 v2 message output

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Observation resources conforming to US Core profiles with various status values including:
  - `registered`
  - `preliminary` 
  - `final`
  - `amended`
  - `corrected`
  - `cancelled`
  - `entered-in-error`
  - `unknown`

**Expected Outputs:**
- HL7 v2 messages containing OBX segments with populated OBX-11 fields
- Mapping documentation or transformation logs (if available)

### Required FHIR Operations
Based on the US Core Server Capability Statement, the following operations are supported and should be used:

1. **Resource Retrieval:**
   - `GET [base]/Observation/[id]` - Retrieve specific Observation resources
   - `GET [base]/Observation?[search parameters]` - Search for Observation resources

2. **Format Support:**
   - Request resources in JSON format (SHALL support per capability statement)
   - Optionally test XML format (SHOULD support per capability statement)

### Validation Criteria

**Primary Assertions:**
1. **Status Mapping Accuracy:** For each Observation resource processed:
   - Verify that the `Observation.status` value is correctly mapped to the corresponding OBX-11 field in the generated HL7 v2 message
   - Confirm mapping follows HL7 v2 standard value set for observation result status

2. **Status Value Preservation:** 
   - Ensure no status information is lost during transformation
   - Verify that all supported FHIR status values have appropriate HL7 v2 equivalents

3. **Message Structure Compliance:**
   - Validate that the OBX-11 field is populated (not empty) when Observation.status is present
   - Confirm OBX-11 follows HL7 v2 data type requirements (typically ID data type)

**Secondary Assertions:**
1. **Completeness:** All Observation resources with status values result in OBX segments with populated OBX-11 fields
2. **Consistency:** Same FHIR status values consistently map to the same HL7 v2 OBX-11 values across multiple transformations
3. **Standards Compliance:** Mapped values conform to HL7 v2.x observation result status value set

**Test Pass Criteria:**
- All Observation.status values are successfully mapped to OBX-11 fields
- Mapped values are valid according to HL7 v2 standards
- No data loss occurs during the mapping process
- Transformation maintains semantic meaning of the status information

**Test Fail Criteria:**
- Any Observation.status value is not mapped to OBX-11
- Invalid or non-standard values appear in OBX-11
- Status information is lost or incorrectly transformed
- System fails to generate HL7 v2 output for valid FHIR Observation input

---

<a id='req-478'></a>

### REQ-478: The system SHALL map the Observation code to OBX-3 in HL7 v2.

**Text**: 

**Context**: Applies when transforming FHIR Observation resources to HL7 v2 messages per the HL7 v2 Mapping guidance; verifies correct population of OBX-3 from Observation.code.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-478

## 1. Requirement ID
REQ-478

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified through automated testing by examining the transformation output of FHIR Observation resources to HL7 v2 messages and validating the correct mapping of Observation.code to OBX-3.

### Complexity
**Moderate** - The test requires understanding of both FHIR Observation structure and HL7 v2 OBX segment format, along with the ability to trigger or capture transformation processes.

### Prerequisites
- System must support FHIR to HL7 v2 transformation capabilities
- System must be configured to transform FHIR Observation resources
- Access to both FHIR Observation resources and resulting HL7 v2 messages
- Knowledge of the system's transformation trigger mechanism (API endpoint, message queue, etc.)

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- One or more FHIR Observation resources with populated `code` elements
- Observation resources should contain various code types to test different scenarios:
  - Simple CodeableConcept with single coding
  - CodeableConcept with multiple codings
  - CodeableConcept with text only
  - Different coding systems (LOINC, SNOMED CT, local codes, etc.)

**Expected Outputs:**
- HL7 v2 messages containing OBX segments corresponding to the input Observation resources
- Each OBX-3 field should contain the appropriately mapped code information from the source Observation.code

### Required FHIR Operations
Based on the US Core Server Capability Statement, the following operations may be needed:

1. **GET /Observation/{id}** - To retrieve specific Observation resources for transformation testing
2. **GET /Observation?[search parameters]** - To query for Observation resources meeting specific criteria
3. **System-specific transformation endpoint** - To trigger or access the FHIR to HL7 v2 transformation process (this would be implementation-specific and not part of standard FHIR operations)

*Note: The transformation itself is not a standard FHIR operation but rather a system-specific capability.*

### Validation Criteria

**Primary Validation Checks:**

1. **Code Presence Validation:**
   - Verify that each FHIR Observation.code element results in a populated OBX-3 field in the corresponding HL7 v2 message
   - Assert that no OBX-3 fields are empty when the source Observation.code is populated

2. **Code Value Mapping:**
   - Validate that the code value from Observation.code.coding[].code is correctly mapped to the appropriate component of OBX-3
   - Verify that the coding system from Observation.code.coding[].system is appropriately represented in OBX-3
   - Confirm that display text from Observation.code.coding[].display is correctly mapped when present

3. **Multiple Coding Handling:**
   - When Observation.code contains multiple coding elements, verify that the transformation follows documented precedence rules or includes all relevant codings as per implementation specifications
   - Assert that the primary or preferred coding is correctly identified and mapped

4. **Text-Only Code Handling:**
   - When Observation.code contains only text (no structured coding), verify that the text value is appropriately mapped to OBX-3
   - Ensure that the transformation handles cases where only Observation.code.text is present

5. **HL7 v2 Format Compliance:**
   - Validate that the OBX-3 field follows proper HL7 v2 formatting conventions
   - Verify that special characters are properly escaped according to HL7 v2 encoding rules
   - Confirm that component separators and field delimiters are used correctly

**Test Assertions:**

- **PASS Criteria:**
  - All Observation.code elements are successfully mapped to corresponding OBX-3 fields
  - Code values, systems, and display text are accurately preserved in the transformation
  - HL7 v2 message structure is valid and compliant
  - No data loss occurs during the code mapping process

- **FAIL Criteria:**
  - Any Observation.code element fails to populate the corresponding OBX-3 field
  - Code values are incorrectly transformed or truncated
  - HL7 v2 message structure is malformed
  - Critical coding information is lost during transformation

**Implementation Note:**
Since this requirement focuses on transformation capabilities rather than standard FHIR REST operations, the test implementation will need to work with the system's specific transformation interface or capture mechanism. The test should be designed to work with whatever Observation data is available in the system, following the "bring your own data" approach.

---

<a id='req-479'></a>

### REQ-479: The system SHALL map the Observation subject to PID-3 in HL7 v2.

**Text**: 

**Context**: Applies when transforming FHIR Observation resources to HL7 v2 messages per the HL7 v2 Mapping guidance; verifies correct population of PID-3 from Observation.subject.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-479

## 1. Requirement ID
REQ-479

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be tested through automated verification of the mapping between FHIR Observation.subject and HL7 v2 PID-3 segment during transformation processes.

### Complexity
**Moderate** - The test requires:
- FHIR Observation resources with valid subject references
- HL7 v2 transformation capability
- Verification of correct PID-3 population from the subject field
- Understanding of both FHIR and HL7 v2 message structures

### Prerequisites
- System must support FHIR to HL7 v2 transformation functionality
- System must have access to FHIR Observation resources with populated subject fields
- System must support US Core Observation profiles (as indicated by capability statement)
- Test environment must have patient data that can be referenced in Observation.subject
- HL7 v2 message generation/export capability must be available

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- One or more Observation resources that conform to US Core profiles
- Each Observation must have a populated `subject` field referencing a Patient resource
- Patient resources referenced by the Observations must have valid identifiers
- Observations should represent diverse clinical scenarios (vital signs, lab results, etc.) to ensure comprehensive coverage

**Expected Outputs:**
- HL7 v2 messages generated from the input FHIR Observation resources
- Each HL7 v2 message must contain a PID segment with populated PID-3 field
- The PID-3 values must correspond to the patient identifiers from the original FHIR Observation.subject references

### Required FHIR Operations
Based on the US Core Server Capability Statement, the following operations are supported and may be needed:

1. **GET /Observation/{id}** - Retrieve specific Observation resources for transformation testing
2. **GET /Observation?patient={patient-id}** - Retrieve Observations for specific patients
3. **GET /Patient/{id}** - Retrieve Patient resources referenced in Observation.subject fields
4. **System transformation operation** - The specific FHIR to HL7 v2 transformation endpoint (implementation-specific)

### Validation Criteria

**Primary Assertions:**
1. **Subject Reference Extraction**: Verify that the system correctly extracts the patient reference from `Observation.subject` field
2. **Patient Identifier Resolution**: Confirm that the system resolves the patient reference to retrieve the actual patient identifier(s)
3. **PID-3 Population**: Validate that the HL7 v2 PID-3 field is populated with the correct patient identifier from the resolved Patient resource
4. **Identifier Format Compliance**: Ensure the PID-3 field follows proper HL7 v2 formatting standards for patient identifiers
5. **Mapping Completeness**: Verify that every Observation with a subject reference results in a corresponding PID-3 entry in the transformed message

**Specific Test Steps:**
1. **Pre-transformation Validation**:
   - Confirm input Observation resources have valid `subject` references
   - Verify referenced Patient resources exist and have identifiers
   - Document the expected PID-3 values based on patient identifiers

2. **Transformation Execution**:
   - Execute the FHIR to HL7 v2 transformation process
   - Capture the generated HL7 v2 messages

3. **Post-transformation Validation**:
   - Parse the generated HL7 v2 messages
   - Extract PID-3 values from each message
   - Compare PID-3 values against the expected patient identifiers from the original FHIR resources
   - Verify proper HL7 v2 formatting of the PID-3 field

**Pass/Fail Criteria:**
- **PASS**: All generated HL7 v2 messages contain PID-3 fields that correctly correspond to the patient identifiers from the original FHIR Observation.subject references
- **FAIL**: Any HL7 v2 message is missing PID-3 data, contains incorrect patient identifiers, or fails to properly map the Observation.subject to PID-3

**Edge Cases to Consider:**
- Observations with subject references to different Patient identifier types (MRN, SSN, etc.)
- Observations where the referenced Patient has multiple identifiers
- Handling of relative vs. absolute references in Observation.subject
- Proper error handling when referenced Patient resources are not found

---

<a id='req-480'></a>

### REQ-480: The system SHALL map the Observation encounter to PV1 in HL7 v2.

**Text**: 

**Context**: Applies when transforming FHIR Observation resources to HL7 v2 messages per the HL7 v2 Mapping guidance; verifies correct population of PV1 fields from Observation.encounter.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-480

## 1. Requirement ID
**REQ-480**

## 2. Requirement Analysis

### Testability Assessment
**Not Testable** - This requirement is not testable in a FHIR conformance testing context for the following reasons:

1. **Out of Scope for FHIR Testing**: The requirement specifically addresses HL7 v2 message generation from FHIR resources, which is a transformation/mapping process that occurs outside the FHIR API layer
2. **Implementation-Specific**: The actual mapping logic from FHIR Observation.encounter to HL7 v2 PV1 fields is internal to the system and not observable through FHIR API interactions
3. **No FHIR API Validation Point**: There is no FHIR API endpoint or operation that would allow verification of the HL7 v2 mapping behavior
4. **Capability Statement Mismatch**: The relevant Capability Statement information provided focuses on US Core profiles and FHIR operations, but does not include any HL7 v2 transformation capabilities or operations

### Complexity
**N/A** - Not applicable due to non-testability

### Prerequisites
**N/A** - Not applicable due to non-testability

## 3. Test Implementation Strategy

### Required Inputs
**N/A** - This requirement cannot be tested through FHIR API conformance testing

### Required FHIR Operations
**N/A** - No FHIR operations can verify HL7 v2 transformation behavior

### Validation Criteria
**N/A** - No FHIR-based validation criteria can be established for HL7 v2 mapping requirements

## Alternative Testing Approaches

While this requirement cannot be tested through FHIR API conformance testing, it could potentially be verified through:

1. **Unit Testing**: Direct testing of the transformation code that converts FHIR Observation resources to HL7 v2 messages
2. **Integration Testing**: End-to-end testing that creates FHIR Observations with encounter references and verifies the resulting HL7 v2 messages contain properly populated PV1 segments
3. **Documentation Review**: Verification that the system's HL7 v2 mapping documentation properly describes how Observation.encounter values are mapped to PV1 fields

## Recommendation

This requirement should be:
- Reclassified as an implementation requirement rather than a FHIR API conformance requirement
- Tested through internal system testing rather than interoperability conformance testing
- Documented in the system's HL7 v2 transformation specifications
- Verified through attestation or code review rather than API testing

---

<a id='req-481'></a>

### REQ-481: The system SHALL map the Observation effective[x] to OBX-14 in HL7 v2.

**Text**: 

**Context**: Applies when transforming FHIR Observation resources to HL7 v2 messages per the HL7 v2 Mapping guidance; verifies correct population of OBX-14 from Observation.effective[x].

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-481

## 1. Requirement ID
REQ-481

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated testing by:
- Creating FHIR Observation resources with various effective[x] values
- Invoking the system's FHIR to HL7 v2 transformation capability
- Parsing the resulting HL7 v2 message to verify OBX-14 field population
- Comparing the mapped values against expected transformation rules

### Complexity
**Moderate** - The test requires:
- Understanding of FHIR Observation.effective[x] data types and their variations
- Knowledge of HL7 v2 OBX segment structure and OBX-14 field specifications
- Implementation of HL7 v2 message parsing capabilities
- Validation of data type transformations between FHIR and HL7 v2 formats

### Prerequisites
- System must support FHIR to HL7 v2 transformation functionality
- System must be capable of processing FHIR Observation resources
- Test environment must have access to HL7 v2 message output from the transformation
- Understanding of the specific HL7 v2 Mapping guidance referenced in the requirement

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Observation resources containing various effective[x] element types:
  - `effectiveDateTime` (instant in time)
  - `effectivePeriod` (time period with start/end)
  - `effectiveTiming` (recurring time pattern)
  - `effectiveInstant` (precise timestamp)

**Test Data Variations:**
- Observations with single point-in-time effective dates
- Observations with effective periods (start and end dates)
- Observations with complex timing patterns
- Observations with missing effective[x] elements (to test handling of optional fields)

### Required FHIR Operations
Based on the US Core Server Capability Statement, the following operations are supported and may be used:

1. **POST /Observation** - Create test Observation resources if needed for transformation
2. **GET /Observation/{id}** - Retrieve specific Observation resources for transformation
3. **System-specific transformation endpoint** - Invoke FHIR to HL7 v2 transformation (implementation-specific)

*Note: The specific transformation operation is not defined in the US Core Capability Statement as this is typically a custom implementation feature.*

### Expected Outputs
**HL7 v2 Messages:**
- HL7 v2 messages containing OBX segments with populated OBX-14 fields
- OBX-14 should contain appropriately transformed datetime values from the source FHIR Observation.effective[x]

### Validation Criteria

#### Primary Validation Checks:

1. **Mapping Presence Validation:**
   - Verify that when Observation.effective[x] is present, OBX-14 is populated in the resulting HL7 v2 message
   - Confirm that the transformation does not result in empty or null OBX-14 fields when source data exists

2. **Data Type Transformation Validation:**
   - **effectiveDateTime → OBX-14:** Validate that FHIR dateTime format is correctly transformed to HL7 v2 timestamp format (typically YYYYMMDDHHMMSS)
   - **effectivePeriod → OBX-14:** Verify appropriate handling of period ranges (may map start time, end time, or range representation based on implementation)
   - **effectiveInstant → OBX-14:** Confirm precise timestamp conversion maintains accuracy
   - **effectiveTiming → OBX-14:** Validate complex timing pattern representation in OBX-14

3. **Format Compliance Validation:**
   - Ensure OBX-14 values conform to HL7 v2 timestamp format specifications
   - Verify proper handling of timezone information during transformation
   - Confirm that date precision is maintained appropriately

4. **Consistency Validation:**
   - Compare source FHIR effective[x] values with resulting OBX-14 values to ensure semantic equivalence
   - Validate that multiple Observations in a single transformation maintain consistent mapping behavior

#### Test Assertions for Passing:

- **Assertion 1:** All FHIR Observation resources with populated effective[x] elements result in corresponding OBX-14 fields in the HL7 v2 output
- **Assertion 2:** The semantic meaning of the datetime information is preserved during transformation
- **Assertion 3:** OBX-14 values conform to HL7 v2 timestamp format requirements
- **Assertion 4:** Transformation handling is consistent across different effective[x] data types
- **Assertion 5:** When effective[x] is absent, OBX-14 handling follows appropriate HL7 v2 conventions (empty or not present)

#### Implementation Notes:
- The test should accommodate "bring your own data" by working with any valid Observation resources that contain effective[x] elements
- Test execution should not depend on specific fixture data but rather validate the transformation logic regardless of the specific datetime values used
- Consider testing with edge cases such as partial dates, different timezone representations, and various precision levels that may exist in real-world data

---

<a id='req-482'></a>

### REQ-482: The system SHALL map the Observation performer to OBX.15 in HL7 v2.

**Text**: 

**Context**: Applies when transforming FHIR Observation resources to HL7 v2 messages per the HL7 v2 Mapping guidance; verifies correct population of OBX.15 from Observation.performer.

**Actor**: System

**Conformance**: SHALL

# Test Specification: REQ-482

## 1. Requirement ID
REQ-482

## 2. Requirement Analysis

### Testability Assessment
**Complex** - This requirement is automatically testable but requires complex data transformation testing between FHIR R4 and HL7 v2 message formats.

### Complexity
**Complex** - Testing involves:
- FHIR Observation resource parsing
- HL7 v2 message generation and validation
- Cross-format data mapping verification
- Understanding of both FHIR and HL7 v2 data structures

### Prerequisites
- System must support FHIR Observation resources with performer elements
- System must support HL7 v2 message generation/transformation capabilities
- Test environment must have access to both FHIR and HL7 v2 message validation tools
- System must implement the HL7 v2 Mapping guidance referenced in the requirement

## 3. Test Implementation Strategy

### Required Inputs

**FHIR Resources:**
- Observation resources containing `performer` elements with various configurations:
  - Single performer (Practitioner reference)
  - Multiple performers
  - Organization as performer
  - PractitionerRole as performer
  - Mixed performer types
  - Observation without performer (edge case)

**Expected Outputs:**
- HL7 v2 messages with properly populated OBX segments
- OBX.15 field correctly mapped from Observation.performer data

### Required FHIR Operations

Based on the US Core Server Capability Statement, the following operations are supported and required:

1. **GET /Observation/{id}** - Retrieve specific Observation resources for transformation testing
2. **GET /Observation?[search-parameters]** - Search for Observations with performer data
3. **System transformation capability** - Convert FHIR Observation to HL7 v2 (system-specific implementation)

*Note: The capability statement supports Observation resource interactions as part of US Core profiles.*

### Validation Criteria

#### Primary Assertions:

1. **Performer Mapping Verification:**
   - When Observation.performer contains a Practitioner reference, verify OBX.15 is populated with corresponding practitioner identifier/name
   - When Observation.performer contains an Organization reference, verify OBX.15 is populated with organization identifier/name
   - When Observation.performer contains a PractitionerRole reference, verify OBX.15 is populated with appropriate role/practitioner information

2. **Data Integrity Checks:**
   - Verify all performer references from FHIR are represented in OBX.15
   - Confirm proper handling of multiple performers (multiple OBX segments or comma-separated values as per HL7 v2 implementation)
   - Validate that performer identifiers are correctly formatted according to HL7 v2 standards

3. **Edge Case Handling:**
   - When Observation.performer is empty or missing, verify OBX.15 handling per implementation requirements
   - Validate behavior with invalid or unresolvable performer references

#### Test Cases:

**Test Case 1: Single Practitioner Performer**
- Input: Observation with single Practitioner performer reference
- Expected: OBX.15 populated with practitioner identifier/name
- Assertion: OBX.15 field contains valid practitioner data

**Test Case 2: Organization Performer**
- Input: Observation with Organization performer reference
- Expected: OBX.15 populated with organization identifier/name
- Assertion: OBX.15 field contains valid organization data

**Test Case 3: Multiple Performers**
- Input: Observation with multiple performer references (mixed types)
- Expected: OBX.15 appropriately handles multiple performers
- Assertion: All performers represented in generated HL7 v2 message

**Test Case 4: PractitionerRole Performer**
- Input: Observation with PractitionerRole performer reference
- Expected: OBX.15 populated with role/practitioner information
- Assertion: OBX.15 field contains valid role-based data

**Test Case 5: Missing Performer**
- Input: Observation without performer element
- Expected: OBX.15 handling per system implementation (empty or omitted)
- Assertion: System handles missing performer gracefully without errors

#### Success Criteria:
- All performer data from FHIR Observation resources is correctly mapped to OBX.15 in generated HL7 v2 messages
- Generated HL7 v2 messages are syntactically valid
- No data loss occurs during transformation
- System handles various performer types and quantities consistently
- Transformation follows documented HL7 v2 Mapping guidance

#### Failure Indicators:
- OBX.15 field missing when Observation.performer is present
- Incorrect or incomplete performer data in OBX.15
- Invalid HL7 v2 message structure
- System errors during transformation process
- Inconsistent handling of different performer types

---

<a id='req-483'></a>

### REQ-483: Support for US Core Screening Assessment Observation Maximum Category

**Text**: 

**Context**: Applies to Observation.category in the US Core Observation Screening Assessment; verifies that the system supports use of codes from the specified value set.

**Actor**: Conformant system

**Conformance**: SHOULD

# Test Specification for REQ-483

## 1. Requirement ID
REQ-483: Support for US Core Screening Assessment Observation Maximum Category

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be tested programmatically by querying the system for US Core Observation Screening Assessment resources and validating that the `Observation.category` field contains codes from the specified value set.

### Complexity
**Simple** - The test involves straightforward validation of category codes against a defined value set for a specific observation profile.

### Prerequisites
- System must implement US Core Server CapabilityStatement
- System must support US Core Observation Screening Assessment profile
- System must have at least one Observation resource conforming to the US Core Observation Screening Assessment profile
- Access to the US Core Screening Assessment Observation Maximum Category value set definition

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: 
  - Observation resources that claim conformance to US Core Observation Screening Assessment profile
  - Access to ValueSet: US Core Screening Assessment Observation Maximum Category
- **System Configuration**: 
  - FHIR R4 server endpoint
  - Authentication credentials (if required)

### Expected Outputs
- Observation resources with valid `category` elements containing codes from the specified value set
- Validation results indicating conformance to the category requirements

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are needed:

1. **GET /Observation** - Search for Observation resources
   - Use search parameters to filter for screening assessment observations
   - Parameters may include: `category`, `patient`, `date`, etc.

2. **GET /Observation/[id]** - Read specific Observation resources
   - Retrieve individual observations for detailed validation

3. **GET /ValueSet** (if supported) - Retrieve value set definitions
   - Access the US Core Screening Assessment Observation Maximum Category value set

### Validation Criteria

The following assertions must be verified to indicate test passing:

#### Primary Validation
1. **Profile Conformance**: Retrieved Observation resources must declare conformance to the US Core Observation Screening Assessment profile in their `meta.profile` element

2. **Category Element Presence**: Each US Core Observation Screening Assessment resource must contain at least one `Observation.category` element

3. **Value Set Conformance**: All codes in `Observation.category` elements must be from the "US Core Screening Assessment Observation Maximum Category" value set

4. **Coding Structure**: Each category element must contain:
   - Valid `system` URI
   - Valid `code` value
   - Appropriate `display` text (recommended)

#### Conformance Level Validation
Since this is a "SHOULD" requirement:
- **Pass**: System demonstrates support by having screening assessment observations with proper category codes from the specified value set
- **Warning**: System has screening assessment observations but some category codes are not from the specified value set
- **Not Applicable**: System has no screening assessment observations to evaluate

#### Test Cases
1. **Positive Test**: Verify that existing screening assessment observations contain valid category codes
2. **Coverage Test**: Confirm that the system can represent multiple codes from the value set (if applicable to the data)
3. **Completeness Test**: Ensure all screening assessment observations have appropriate category classifications

#### Success Criteria
- At least one US Core Observation Screening Assessment resource is found
- All found resources have `category` elements with codes from the specified value set
- No validation errors are reported for the category elements
- The system demonstrates practical support for the value set in real-world screening assessment scenarios

---

<a id='req-510'></a>

### REQ-510: Servers SHALL document support for writing Observation resources.

**Text**: 

**Context**: US Core Vital Signs write capability – CapabilityStatement conformance declaration

**Actor**: Server

**Conformance**: SHALL

# Test Specification for REQ-510

## 1. Requirement ID
**REQ-510**: Servers SHALL document support for writing Observation resources

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Automatically testable

This requirement can be automatically verified by inspecting the server's CapabilityStatement to confirm that it declares support for write operations on Observation resources. The requirement focuses on documentation of capability rather than functional testing of the write operations themselves.

### Complexity
**Simple**

The test involves a straightforward inspection of the CapabilityStatement document to verify the presence of required declarations for Observation resource write operations.

### Prerequisites
- Server must expose a FHIR CapabilityStatement at the `/metadata` endpoint
- Server must be operational and accessible
- No specific data setup required as this is a capability documentation verification

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: None (capability inspection only)
- **Server Endpoint**: Base FHIR server URL
- **Expected Outputs**: CapabilityStatement resource containing Observation write capability declarations

### Required FHIR Operations
- `GET [base]/metadata` - Retrieve the server's CapabilityStatement

### Validation Criteria

The test SHALL verify that the server's CapabilityStatement contains the following elements:

1. **Resource Declaration**: 
   - Confirm presence of `CapabilityStatement.rest.resource` entry where `type = "Observation"`

2. **Write Operation Support**:
   - Verify that the Observation resource entry includes at least one of the following write operations in `CapabilityStatement.rest.resource.interaction`:
     - `create` (interaction.code = "create")
     - `update` (interaction.code = "update") 
     - `patch` (interaction.code = "patch")

3. **US Core Profile Context**:
   - If the server declares support for US Core profiles, verify that Observation resource declarations reference appropriate US Core Vital Signs profiles in `CapabilityStatement.rest.resource.supportedProfile`

### Test Assertions

**PASS Criteria**:
- CapabilityStatement is successfully retrieved from `/metadata` endpoint
- CapabilityStatement contains a resource entry for "Observation" 
- The Observation resource entry declares support for at least one write operation (create, update, or patch)

**FAIL Criteria**:
- CapabilityStatement cannot be retrieved
- No Observation resource entry exists in the CapabilityStatement
- Observation resource entry exists but contains no write operation declarations
- CapabilityStatement is malformed or invalid

### Implementation Notes
- This test verifies capability documentation compliance, not functional write capability
- The test accommodates various levels of write support (create-only, update-only, or full CRUD)
- No actual Observation resources need to be created or modified during testing
- The test should be implementation-agnostic and work regardless of the server's specific data content

---

<a id='req-521'></a>

### REQ-521: US Core Client SHALL fetch Observation resources.

**Text**: 

**Context**: US Core Client read interaction for Observation by id

**Actor**: US Core Client

**Conformance**: SHALL

# Test Specification for REQ-521

## Requirement ID
REQ-521

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be fully validated through automated testing by verifying that a US Core Client can successfully fetch Observation resources by ID using the FHIR read operation.

### Complexity
**Simple** - This is a straightforward FHIR read interaction that requires basic HTTP GET operations and response validation.

### Prerequisites
- US Core Server implementing the US Core Server CapabilityStatement
- At least one valid Observation resource available on the server that conforms to a US Core Observation profile
- US Core Client capable of making FHIR read requests
- Valid authentication/authorization credentials if required by the server
- Network connectivity between client and server

## Test Implementation Strategy

### Required Inputs
- **Base FHIR server URL** of the US Core Server
- **Valid Observation resource ID(s)** that exist on the server
- **Authentication credentials** (if server requires authentication)
- **Expected US Core Observation profile URL(s)** that the returned resources should conform to

### Required FHIR Operations
1. **HTTP GET /Observation/{id}** - FHIR read operation to fetch a specific Observation resource by its logical ID

### Validation Criteria

#### Test Case 1: Successful Observation Read
**Objective**: Verify the client can successfully fetch an Observation resource by ID

**Test Steps**:
1. Client performs HTTP GET request to `{base}/Observation/{id}` where `{id}` is a known valid Observation resource ID
2. Validate the server response

**Assertions for Pass Criteria**:
- HTTP response status code is 200 (OK)
- Response Content-Type header indicates FHIR JSON format (`application/fhir+json` or `application/json`)
- Response body contains a valid FHIR Observation resource
- Returned Observation resource has the correct `id` field matching the requested ID
- Returned Observation resource includes required US Core elements per the applicable US Core Observation profile
- If present, `meta.profile` element references a valid US Core Observation profile URL

#### Test Case 2: Error Handling for Invalid ID
**Objective**: Verify the client properly handles server error responses for invalid Observation IDs

**Test Steps**:
1. Client performs HTTP GET request to `{base}/Observation/{invalid-id}` where `{invalid-id}` is a non-existent resource ID
2. Validate the server response and client error handling

**Assertions for Pass Criteria**:
- HTTP response status code is 404 (Not Found)
- Client handles the 404 response appropriately without crashing
- If an OperationOutcome is returned, it should be a valid FHIR OperationOutcome resource

#### Test Case 3: Authentication/Authorization Handling
**Objective**: Verify the client properly handles authentication and authorization requirements

**Test Steps**:
1. If server requires authentication, client performs HTTP GET request to `{base}/Observation/{id}` without proper credentials
2. Client then retries with proper authentication credentials

**Assertions for Pass Criteria**:
- When authentication is required but not provided, server returns appropriate error status (401, 403, or 404)
- Client handles authentication errors appropriately
- When proper authentication is provided, client successfully retrieves the Observation resource
- Client includes proper authorization headers in subsequent requests

#### Test Case 4: Content Format Support
**Objective**: Verify the client can handle JSON format responses (required) and optionally XML format

**Test Steps**:
1. Client performs HTTP GET request to `{base}/Observation/{id}` with Accept header set to `application/fhir+json`
2. Optionally, repeat with Accept header set to `application/fhir+xml`

**Assertions for Pass Criteria**:
- Client successfully processes JSON format responses
- Response parsing produces a valid Observation resource object in the client
- If XML is supported by both client and server, client can also process XML format responses

## Additional Considerations

- Tests should accommodate various US Core Observation profiles (e.g., Vital Signs, Laboratory Results, Survey Instruments)
- Client should be tested with different types of Observation data to ensure broad compatibility
- Network timeout and connection error scenarios should be handled gracefully by the client
- The test should verify that the client can work with any valid Observation resource present on the server, supporting the "bring your own data" approach

---

<a id='req-533'></a>

### REQ-533: Observation resource containment rules

**Text**: 

**Context**: Applies to Observation resources when contained in another resource; also applicable to US Core Treatment Intervention Preference Observation profile

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-533

## 1. Requirement ID
REQ-533: Observation resource containment rules

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Not testable due to incomplete specification

**Rationale**: The requirement text is incomplete - it only states "Observation resource containment rules" without specifying what the actual containment rules are. The requirement lacks the necessary detail about:
- What specific containment rules apply
- Under what conditions containment is required or prohibited
- What validation criteria should be applied to contained Observation resources
- How the US Core Treatment Intervention Preference Observation profile factors into these rules

### Complexity
**Level**: Cannot be determined due to incomplete specification

### Prerequisites
Cannot be determined without complete requirement specification

## 3. Test Implementation Strategy

### Current Status
**Not Implementable**: This test specification cannot be completed as written because the requirement lacks essential implementation details.

### Required Information for Implementation
To create a testable specification, the following information would be needed:

1. **Specific Containment Rules**: What are the actual rules that govern when Observation resources can or must be contained?

2. **Profile-Specific Requirements**: How do the containment rules specifically apply to the US Core Treatment Intervention Preference Observation profile?

3. **Validation Criteria**: What constitutes conformance to these containment rules?

4. **Context Clarification**: What does "when contained in another resource" specifically mean in terms of:
   - Which parent resource types can contain Observations
   - What restrictions apply to the contained Observations
   - What additional requirements apply beyond standard FHIR containment rules

### Recommended Next Steps

1. **Requirement Clarification**: Request complete specification of the containment rules from the implementation guide authors

2. **Profile Analysis**: Review the US Core Treatment Intervention Preference Observation profile for any specific containment-related constraints

3. **Standard FHIR Containment Review**: Analyze base FHIR containment rules to understand what additional constraints this requirement might impose

### Capability Statement Alignment
The US Core Server Capability Statement supports Observation resources but does not provide specific guidance on containment rules. Once the requirement is clarified, verification should confirm that:
- Required containment patterns are supported by the server capabilities
- Any profile-specific containment requirements align with server implementation capabilities

---

**Note**: This requirement needs to be revised with complete specification details before a meaningful test can be implemented. The current text appears to be a placeholder or incomplete requirement statement.

---

<a id='req-534'></a>

### REQ-534: Observation resource reference rules

**Text**: 

**Context**: Applies to Observation resources when contained in another resource; also applicable to US Core Treatment Intervention Preference Observation profile

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-534: Observation Resource Reference Rules

## 1. Requirement ID
**REQ-534**: Observation resource reference rules

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Not testable due to incomplete requirement specification

**Rationale**: The requirement text is missing the actual rules or constraints that need to be tested. The requirement only provides context (applies to contained Observation resources and US Core Treatment Intervention Preference Observation profile) but does not specify what reference rules must be validated. Without the specific rules, it's impossible to create meaningful test assertions.

### Complexity
**Not Applicable** - Cannot assess complexity without complete requirement specification

### Prerequisites
**Cannot be determined** - Prerequisites depend on the specific reference rules that are not provided in the requirement text

## 3. Test Implementation Strategy

### Current Status
**Test cannot be implemented** due to incomplete requirement specification.

### Required Information to Proceed
To create a testable specification for REQ-534, the following information is needed:

1. **Specific Reference Rules**: What are the actual rules that govern references in Observation resources? Examples might include:
   - Required reference targets (e.g., subject must reference Patient)
   - Forbidden reference patterns
   - Cardinality constraints on references
   - Reference resolution requirements

2. **Containment Rules**: For contained Observation resources, what specific reference constraints apply?

3. **US Core Treatment Intervention Preference Profile Requirements**: What reference rules are specific to this profile?

### Recommended Actions
1. **Requirement Clarification**: Request complete requirement text that includes the specific reference rules to be validated
2. **Profile Analysis**: Review the US Core Treatment Intervention Preference Observation profile specification to identify reference constraints
3. **Containment Analysis**: Examine FHIR containment rules as they apply to Observation resources

### Potential Test Categories (Once Rules Are Specified)
Based on typical Observation reference requirements, tests might include:

- **Reference Target Validation**: Verify references point to appropriate resource types
- **Containment Compliance**: Validate contained resource reference patterns
- **Profile-Specific Rules**: Test US Core Treatment Intervention Preference profile reference requirements
- **Reference Resolution**: Confirm referenced resources can be resolved when not contained

### Required FHIR Operations
Cannot be determined without specific reference rules, but likely would include:
- `GET` operations to retrieve Observation resources
- Potential `GET` operations to resolve non-contained references
- Resource validation operations

---

**Note**: This test specification cannot be completed until the actual reference rules are provided in the requirement text. The current requirement (REQ-534) appears to be incomplete or truncated.

---

<a id='req-535'></a>

### REQ-535: Observation resource metadata rules

**Text**: 

**Context**: Applies to Observation resources when contained in another resource; also applicable to US Core Treatment Intervention Preference Observation profile

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-535

## 1. Requirement ID
REQ-535

## 2. Requirement Analysis

### Testability Assessment
**Not testable due to incomplete requirement specification**

The requirement text only states "Observation resource metadata rules" without specifying what those rules are. While it references the US Core Treatment Intervention Preference Observation profile and mentions it applies to contained Observation resources, no specific metadata rules are defined that can be tested.

### Complexity
**Cannot be determined** - The complexity cannot be assessed without knowing the specific metadata rules being referenced.

### Prerequisites
- System must support US Core Treatment Intervention Preference Observation profile
- System must be capable of handling contained resources
- Test data should include Observation resources both as standalone and contained within other resources

## 3. Test Implementation Strategy

### Required Inputs
**Cannot be specified** - Without knowing the specific metadata rules, the required test inputs cannot be determined. Generally would need:
- FHIR resources containing Observation resources
- Observation resources conforming to US Core Treatment Intervention Preference Profile
- Examples of contained Observation resources within other resource types

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for Observation resources:
- `GET [base]/Observation/[id]` (read)
- `GET [base]/Observation?[search parameters]` (search-type)
- Optional: `GET [base]/Observation/[id]/_history/[vid]` (vread)
- Optional: `GET [base]/Observation/[id]/_history` (history-instance)

### Validation Criteria
**Cannot be specified** - The specific validation criteria depend on the undefined metadata rules.

## Recommendation

This requirement needs clarification before a meaningful test specification can be created. The requirement should specify:

1. **What specific metadata rules** apply to Observation resources
2. **Which metadata elements** are subject to these rules (e.g., meta.profile, meta.tag, meta.security, etc.)
3. **What validation logic** should be applied to these metadata elements
4. **Whether the rules differ** between contained and standalone Observation resources
5. **How the rules specifically apply** to the US Core Treatment Intervention Preference Observation profile

Once these details are provided, a comprehensive test specification can be developed that includes:
- Specific validation checks for metadata elements
- Test cases for both contained and standalone Observation resources  
- Profile-specific validation for the US Core Treatment Intervention Preference profile
- Clear pass/fail criteria based on the defined rules

---

<a id='req-536'></a>

### REQ-536: Observation resource security label rules

**Text**: 

**Context**: Applies to Observation resources when contained in another resource; also applicable to US Core Treatment Intervention Preference Observation profile

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-536

## 1. Requirement ID
**REQ-536**: Observation resource security label rules

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Not testable due to being too vague

**Rationale**: The requirement text is incomplete and lacks specific details about what security label rules must be implemented. The requirement mentions "security label rules" but does not specify:
- What specific security labels are required
- How they should be applied
- What the validation criteria are
- What constitutes compliance with these rules

Without these details, it's impossible to create meaningful test assertions or validation criteria.

### Complexity
**Classification**: Cannot be determined due to insufficient requirement specification

### Prerequisites
Cannot be determined without complete requirement specification

## 3. Test Implementation Strategy

### Status
**NOT IMPLEMENTABLE** - This requirement cannot be tested in its current form.

### Required Information for Implementation
To make this requirement testable, the following information would be needed:

1. **Specific Security Label Requirements**:
   - Which security labels must be present (e.g., confidentiality codes, sensitivity labels)
   - Required value sets for security labels
   - Mandatory vs. optional security label elements

2. **Application Rules**:
   - When security labels must be applied (always, conditionally based on data type, etc.)
   - How labels should be inherited or propagated when resources are contained
   - Specific rules for US Core Treatment Intervention Preference Observation profile

3. **Validation Criteria**:
   - What constitutes proper security labeling
   - How to verify compliance
   - Expected behavior when security labels are missing or incorrect

### Recommended Actions
1. **Clarify Requirement**: Work with requirement authors to provide complete specification
2. **Reference Standards**: Identify specific security labeling standards or profiles being referenced
3. **Define Test Scenarios**: Once clarified, define specific test scenarios for different security label applications

### Potential Test Approach (Once Requirement is Clarified)
If the requirement were properly specified, the test implementation would likely involve:

**Required FHIR Operations**:
- `GET /Observation` (supported per Capability Statement)
- Validation of contained resources within other resource types

**Validation Criteria** (examples of what might be tested):
- Presence of required security labels in `meta.security` element
- Correct coding systems and values for security labels
- Proper inheritance of security labels in contained resources
- Compliance with US Core Treatment Intervention Preference Observation profile requirements

**Note**: This requirement should be revised with complete specifications before implementation and testing can proceed.

---

<a id='req-537'></a>

### REQ-537: Observation narrative requirement

**Text**: 

**Context**: Applies to Observation resources; also applicable to US Core Treatment Intervention Preference Observation profile

**Actor**: System

**Conformance**: SHOULD

# Test Specification for REQ-537

## 1. Requirement ID
REQ-537: Observation narrative requirement

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Not testable due to being too vague

**Rationale**: The requirement text is empty ("**Text**:") and provides no specific narrative requirements or constraints to test against. While the context indicates this applies to Observation resources and the US Core Treatment Intervention Preference Observation profile, without explicit narrative requirements, there are no testable criteria to validate.

### Complexity
**Classification**: Cannot be determined due to incomplete requirement specification

### Prerequisites
Cannot be determined due to incomplete requirement specification.

## 3. Test Implementation Strategy

### Current Status
**Test Implementation**: Not possible

**Reason**: The requirement lacks essential information needed to create a meaningful test:

1. **Missing Requirement Text**: The actual narrative requirement is not specified
2. **No Testable Criteria**: Without knowing what narrative requirements should be enforced, no validation criteria can be established
3. **Ambiguous Scope**: While the context mentions Observation resources and US Core Treatment Intervention Preference Observation profile, the specific narrative constraints are undefined

### Recommended Actions

To make this requirement testable, the following information would be needed:

1. **Complete Requirement Text**: The actual narrative requirements must be specified (e.g., "Observation.text must contain a human-readable summary of the observation value and clinical significance")

2. **Specific Constraints**: Clear criteria such as:
   - Required narrative elements
   - Formatting requirements
   - Content validation rules
   - Relationship between structured data and narrative

3. **Profile-Specific Requirements**: If there are specific narrative requirements for the US Core Treatment Intervention Preference Observation profile beyond base Observation requirements

### Potential Test Approach (If Requirements Were Complete)

If the requirement were properly specified, the test approach would likely include:

**Required FHIR Operations**:
- GET /Observation (supported per Capability Statement)
- GET /Observation?patient={id}&category={category} (supported per Capability Statement)

**Validation Criteria** (examples of what might be tested):
- Verification that Observation.text element is present and populated
- Validation of narrative content against specified requirements
- Consistency checks between structured data and narrative representation
- Profile-specific narrative requirements for Treatment Intervention Preference observations

**Test Data Requirements**:
- Observation resources conforming to US Core Treatment Intervention Preference Profile
- Patient resources to support observation queries
- Various observation scenarios to test narrative requirements comprehensively

---

**Note**: This requirement should be updated with complete specification details before test implementation can proceed. The SHOULD conformance level suggests these are recommended practices that should be validated when the actual requirements are clarified.

---

<a id='req-538'></a>

### REQ-538: Observation dataAbsentReason rules

**Text**: 

**Context**: Applies to Observation resources; also applicable to US Core Treatment Intervention Preference Observation profile

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-538

## 1. Requirement ID
REQ-538

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated validation of FHIR resource content and structure.

### Complexity
**Simple** - The requirement involves checking for the presence and proper use of the `dataAbsentReason` element in specific contexts.

### Prerequisites
- System must support US Core Observation profiles, particularly the US Core Treatment Intervention Preference Observation profile
- System must be capable of creating/storing Observation resources
- Test data must include Observation resources that either:
  - Have no value but have component observations
  - Have no value and no component observations
  - Have component observations without values

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources conforming to US Core profiles, specifically:
  - US Core Treatment Intervention Preference Profile instances
  - Other US Core Observation profile instances (as applicable)
- **Test Scenarios**: Observation resources representing various combinations of:
  - Observations without values but with components
  - Observations without values and without components
  - Component observations within parent observations that lack values

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for Observation resources:
- `GET [base]/Observation/[id]` (read operation)
- `GET [base]/Observation?[search parameters]` (search-type operation)

### Validation Criteria

#### Test Case 1: Observation without value and without components
**Assertion**: Any Observation resource that lacks both `Observation.value[x]` and `Observation.component` elements SHALL include `Observation.dataAbsentReason`.

**Validation Steps**:
1. Retrieve Observation resources from the system
2. For each Observation that has no `value[x]` element AND no `component` elements:
   - Verify that `dataAbsentReason` element is present
   - Verify that `dataAbsentReason` contains a valid code from the appropriate value set

#### Test Case 2: Observation without value but with components
**Assertion**: An Observation resource that lacks `Observation.value[x]` but contains `Observation.component` elements does NOT require `Observation.dataAbsentReason`.

**Validation Steps**:
1. Retrieve Observation resources from the system
2. For each Observation that has no `value[x]` element BUT has `component` elements:
   - Verify that the absence of `dataAbsentReason` does not violate conformance rules
   - This is a negative test - the requirement should be satisfied without `dataAbsentReason`

#### Test Case 3: Component observations without values
**Assertion**: Any `Observation.component` that lacks a `component.value[x]` element SHALL include `component.dataAbsentReason`.

**Validation Steps**:
1. Retrieve Observation resources from the system
2. For each Observation that contains `component` elements:
   - For each component that has no `value[x]` element:
     - Verify that `component.dataAbsentReason` element is present
     - Verify that `component.dataAbsentReason` contains a valid code from the appropriate value set

#### Test Case 4: US Core Treatment Intervention Preference Profile specific validation
**Assertion**: US Core Treatment Intervention Preference Observation resources follow the same dataAbsentReason rules as other Observation resources.

**Validation Steps**:
1. Retrieve Observation resources that conform to the US Core Treatment Intervention Preference Profile
2. Apply the same validation logic as Test Cases 1-3 to these specific profile instances
3. Verify profile-specific constraints are also met

### Expected Test Results
- **Pass**: All Observation resources without values (and without components) include appropriate `dataAbsentReason` elements
- **Pass**: All component observations without values include appropriate `component.dataAbsentReason` elements  
- **Pass**: Observations with components but no top-level values do not require top-level `dataAbsentReason`
- **Fail**: Any Observation or component observation lacking a value also lacks the required `dataAbsentReason` element

### Additional Validation Notes
- The test should accommodate systems that "never provide an observation without a value" as these systems are not required to support `Observation.dataAbsentReason`
- Similarly, systems that "never provide a component observation without a component value" are not required to support `Observation.component.dataAbsentReason`
- The test should validate that when `dataAbsentReason` is present, it uses appropriate codes from the bound value set
- The test should be agnostic to the specific clinical content and work with whatever Observation data the system under test contains

---

<a id='req-539'></a>

### REQ-539: Observation code and component code rules

**Text**: 

**Context**: Applies to Observation resources; also applicable to US Core Treatment Intervention Preference Observation profile

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-539

## Requirement ID
REQ-539

## Requirement Analysis

### Testability Assessment
**Not testable** - This requirement is too vague as it only provides a summary title "Observation code and component code rules" without specifying what the actual rules are. The requirement text is empty, making it impossible to determine what specific conformance criteria need to be tested.

### Complexity
**Cannot be determined** - Without specific requirement text, the complexity cannot be assessed.

### Prerequisites
**Cannot be determined** - Prerequisites cannot be identified without knowing the specific rules that need to be tested.

## Test Implementation Strategy

### Required Inputs
**Cannot be determined** - The specific inputs cannot be identified without knowing:
- What the "code and component code rules" actually are
- What validation criteria apply to Observation.code
- What validation criteria apply to Observation.component.code
- Whether these rules apply to all Observation profiles or specific ones like US Core Treatment Intervention Preference Profile

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for Observation resources:
- `GET [base]/Observation/[id]` (read)
- `GET [base]/Observation?[search_parameters]` (search-type)

However, without knowing the specific rules, it's unclear which operations would be needed for testing.

### Validation Criteria
**Cannot be determined** - Specific validation criteria cannot be established without knowing:
- The exact code and component code rules
- Whether these are structural constraints, terminology bindings, or business logic rules
- What constitutes a passing vs. failing test case

## Recommendation

This requirement needs to be clarified with specific details about:

1. **What are the specific code rules?** (e.g., required code systems, value sets, cardinality constraints)
2. **What are the specific component code rules?** 
3. **Do these rules apply to all Observation resources or specific profiles?**
4. **Are these rules already covered by FHIR validation?**
5. **What are the expected behaviors when rules are violated?**

Without this information, no meaningful test specification can be created. The requirement should be updated with explicit conformance criteria before test implementation can proceed.

---

<a id='req-540'></a>

### REQ-540: Observation status binding requirement

**Text**: 

**Context**: Applies to Observation.status element; also applicable to US Core Treatment Intervention Preference Observation profile

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-540: Observation Status Binding Requirement

## 1. Requirement ID
REQ-540

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be programmatically verified by checking that the Observation.status element contains values from the required value set binding.

### Complexity
**Simple** - This is a straightforward validation of a single element's value against a defined value set.

### Prerequisites
- System must support US Core Server capabilities as defined in the US Core Server CapabilityStatement
- System must have Observation resources available, specifically those conforming to the US Core Treatment Intervention Preference Observation profile
- Test client must have appropriate authentication/authorization to access Observation resources
- System must support FHIR R4

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources that claim conformance to the US Core Treatment Intervention Preference Observation profile
- **Profile URL**: `http://hl7.org/fhir/us/core/StructureDefinition/us-core-treatment-intervention-preference`
- **Expected Value Set**: ObservationStatus value set (http://hl7.org/fhir/ValueSet/observation-status)

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are supported and required for testing:

1. **GET /Observation** - Search for Observation resources
2. **GET /Observation/[id]** - Read specific Observation resources
3. **GET /Observation?patient=[id]** - Search for Observations by patient (if patient-specific testing is needed)

### Validation Criteria

#### Test Case 1: Validate Status Element Presence and Binding
**Objective**: Verify that all US Core Treatment Intervention Preference Observation resources have a valid status element

**Test Steps**:
1. Query the system for Observation resources that conform to the US Core Treatment Intervention Preference profile
2. For each returned Observation resource:
   - Verify the `meta.profile` contains the US Core Treatment Intervention Preference profile URL, OR
   - Verify the resource structure matches the profile requirements
3. Extract the `status` element value from each Observation
4. Validate that the status value is from the required ObservationStatus value set

**Pass Criteria**:
- All Observation resources claiming conformance to the US Core Treatment Intervention Preference profile SHALL have a `status` element
- The `status` element value SHALL be one of the following valid codes from the ObservationStatus value set:
  - `registered`
  - `preliminary` 
  - `final`
  - `amended`
  - `corrected`
  - `cancelled`
  - `entered-in-error`
  - `unknown`

**Failure Scenarios**:
- Observation resource is missing the `status` element
- `status` element contains a value not in the ObservationStatus value set
- `status` element is present but empty/null

#### Test Case 2: Profile Conformance Validation
**Objective**: Ensure resources claiming US Core Treatment Intervention Preference profile conformance properly implement the status requirement

**Test Steps**:
1. Identify Observation resources that explicitly declare conformance to the US Core Treatment Intervention Preference profile via `meta.profile`
2. For each identified resource, perform Test Case 1 validation
3. Cross-reference with FHIR validator results for profile conformance

**Pass Criteria**:
- 100% of resources explicitly claiming the profile SHALL pass the status binding validation
- No conformance errors related to status element binding when validated against the profile

#### Test Case 3: System-wide Status Consistency
**Objective**: Verify consistent application of status binding across all relevant Observation resources

**Test Steps**:
1. Retrieve a representative sample of Observation resources from the system
2. Filter for those that should conform to treatment intervention preference patterns
3. Apply status validation to the filtered set
4. Document any inconsistencies or patterns of non-conformance

**Pass Criteria**:
- All Observation resources that represent treatment intervention preferences SHALL have valid status values
- System demonstrates consistent implementation of the status binding requirement

### Expected Outputs
- **Pass**: All tested Observation resources have valid status elements conforming to the ObservationStatus value set
- **Fail**: One or more Observation resources have invalid, missing, or incorrectly bound status values
- **Test Report**: Summary of tested resources, validation results, and any non-conformant instances with specific details

### Implementation Notes
- Tests should be designed to work with existing system data rather than requiring specific test fixtures
- Consider using FHIR search parameters to efficiently locate relevant Observation resources
- Validation should account for both explicit profile declarations and implicit conformance based on resource content
- Test implementation should handle pagination for systems with large numbers of Observation resources

---

<a id='req-541'></a>

### REQ-541: Observation category binding preference

**Text**: 

**Context**: Applies to Observation.category element; also applicable to US Core Treatment Intervention Preference Observation profile

**Actor**: System

**Conformance**: SHOULD

# Test Specification for REQ-541: Observation Category Binding Preference

## 1. Requirement ID
REQ-541

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be systematically verified by examining Observation resources and their category bindings through FHIR API interactions.

### Complexity
**Simple** - The requirement focuses on a single element (Observation.category) and its binding conformance, which can be validated through straightforward resource inspection.

### Prerequisites
- System must support US Core Server CapabilityStatement conformance
- System must implement Observation resource support (as confirmed in capability statement section 14.3.3.20)
- System must support search operations on Observation resources
- Test data must include Observation resources, particularly those conforming to US Core Treatment Intervention Preference Profile
- System must support patient-based Observation searches (required capability)

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources Needed:**
  - Patient resources (for search context)
  - Observation resources with populated category elements
  - Specific focus on Observations conforming to US Core Treatment Intervention Preference Profile
  
- **Expected Outputs:**
  - Observation resources with properly bound category values
  - Validation results indicating SHOULD-level conformance compliance

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required:

1. **Search Operations:**
   - `GET [base]/Observation?patient=[patient-id]` (SHALL support per capability statement)
   - `GET [base]/Observation?patient=[patient-id]&category=[category-code]` (SHALL support per capability statement)
   
2. **Read Operations:**
   - `GET [base]/Observation/[id]` (SHALL support per capability statement)

3. **Search Parameter Requirements:**
   - Patient parameter (reference): Client SHALL provide at least ID value
   - Category parameter (token): Client SHALL provide at least code value

### Validation Criteria

#### Primary Validation Checks:

1. **Category Element Presence Validation:**
   - Verify that Observation resources include the `category` element
   - Document instances where category is absent (acceptable for SHOULD conformance)

2. **Binding Compliance Assessment:**
   - Examine category values against expected value set bindings
   - For US Core Treatment Intervention Preference Observations specifically:
     - Validate category codes align with profile-specific requirements
     - Check for appropriate code system usage

3. **SHOULD-Level Conformance Documentation:**
   - Track compliance rate across retrieved Observations
   - Generate conformance metrics showing percentage of resources with proper category bindings
   - Document any deviations with rationale

#### Specific Test Cases:

1. **General Observation Category Testing:**
   ```
   Test: Retrieve patient Observations and analyze category bindings
   Action: GET [base]/Observation?patient=[id]
   Validation: Check category element presence and binding compliance
   Pass Criteria: Category bindings follow expected value sets when present
   ```

2. **Treatment Intervention Preference Profile Testing:**
   ```
   Test: Focus on US Core Treatment Intervention Preference Observations
   Action: GET [base]/Observation?patient=[id]&category=[relevant-category-code]
   Validation: Verify profile-specific category requirements
   Pass Criteria: Treatment intervention preference observations have appropriate category values
   ```

3. **Search Functionality Validation:**
   ```
   Test: Verify category-based searching works correctly
   Action: GET [base]/Observation?patient=[id]&category=[test-category-code]
   Validation: Confirm search returns appropriate results
   Pass Criteria: Search results match category filter criteria
   ```

#### Conformance Assessment Approach:

- **For SHOULD conformance level:** Track and report compliance percentage
- **Passing threshold:** Document all deviations but don't fail test for SHOULD-level non-compliance
- **Reporting:** Generate summary showing:
  - Total Observations examined
  - Category binding compliance rate
  - Specific profile compliance (Treatment Intervention Preference)
  - Any systematic patterns in non-compliance

#### Success Metrics:
- System demonstrates understanding of category binding requirements
- Proper handling of SHOULD-level conformance expectations
- Appropriate category values used when element is populated
- Search functionality works correctly with category parameters

---

<a id='req-551'></a>

### REQ-551: Observation resource SHALL NOT contain nested Resources if it is contained in another resource.

**Text**: 

**Context**: Observation containment rules

**Actor**: Observation resource

**Conformance**: SHALL

# Test Specification for REQ-551

## 1. Requirement ID
**REQ-551**: Observation resource SHALL NOT contain nested Resources if it is contained in another resource.

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be programmatically validated by examining the structure of Observation resources when they appear as contained resources within other FHIR resources.

### Complexity
**Moderate** - The test requires:
- Identifying Observation resources that are contained within other resources
- Parsing the contained Observation resources to detect nested contained resources
- Validating the containment hierarchy rules

### Prerequisites
- FHIR server supporting US Core Observation profiles as specified in the Capability Statement
- Test data containing various resource types that may contain Observation resources
- Access to retrieve resources that may have contained Observation resources

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources Needed:**
- Any FHIR resources that contain Observation resources in their `contained` array
- Common parent resources that may contain Observations include:
  - DiagnosticReport resources
  - Patient resources  
  - Encounter resources
  - Any other resources with contained Observation resources

**Expected Outputs:**
- Pass: Contained Observation resources have no nested contained resources
- Fail: Contained Observation resources contain nested resources in their `contained` array

### Required FHIR Operations
Based on the Capability Statement, the following supported operations will be used:

1. **Search Operations for resources that may contain Observations:**
   - `GET [base]/DiagnosticReport?patient={id}` - Search for DiagnosticReports that may contain Observations
   - `GET [base]/Patient?_id={id}` - Retrieve Patient resources that may contain Observations
   - `GET [base]/Encounter?patient={id}` - Search for Encounters that may contain Observations

2. **Read Operations:**
   - `GET [base]/{ResourceType}/{id}` - Retrieve individual resources to examine their contained resources

### Validation Criteria

**Test Steps:**
1. **Discovery Phase:**
   - Search for or retrieve FHIR resources that potentially contain Observation resources
   - Identify resources with non-empty `contained` arrays

2. **Containment Analysis:**
   - For each resource with contained resources:
     - Filter contained resources to identify Observation resources (check `resourceType` = "Observation")
     - For each contained Observation resource, examine its structure

3. **Nested Containment Validation:**
   - For each contained Observation resource:
     - Check if the Observation has a `contained` array
     - If `contained` array exists, verify it is empty
     - If `contained` array contains any resources, mark as non-conformant

**Passing Criteria:**
- All contained Observation resources either:
  - Have no `contained` element, OR
  - Have an empty `contained` array (`"contained": []`)

**Failing Criteria:**
- Any contained Observation resource has a non-empty `contained` array with nested resources

**Assertions to Implement:**
```
For each resource R in test dataset:
  For each contained_resource in R.contained:
    If contained_resource.resourceType == "Observation":
      Assert: contained_resource.contained is null OR contained_resource.contained.length == 0
```

**Error Reporting:**
- Report the parent resource ID and type
- Report the contained Observation resource details
- List any nested contained resources found within the Observation
- Provide clear indication of which specific containment rule was violated

**Edge Cases to Consider:**
- Observation resources that are not contained (should be ignored by this test)
- Resources with complex containment hierarchies
- Empty contained arrays vs. missing contained elements (both should pass)

---

<a id='req-552'></a>

### REQ-552: Observation resource SHALL be referred to from elsewhere in the resource or refer to the containing resource if it is contained.

**Text**: 

**Context**: Observation containment reference integrity

**Actor**: Observation resource

**Conformance**: SHALL

# Test Specification for REQ-552

## 1. Requirement ID
**REQ-552**: Observation resource SHALL be referred to from elsewhere in the resource or refer to the containing resource if it is contained.

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Automatically testable

This requirement can be automatically verified by examining the structure and references within FHIR resources. The test can programmatically check for containment patterns and reference integrity in Observation resources.

### Complexity
**Complexity**: Moderate

The requirement involves understanding FHIR containment rules and reference patterns. It requires checking both inbound and outbound references when resources are contained, which adds moderate complexity to the validation logic.

### Prerequisites
- Test system must support US Core Observation profiles as specified in the Capability Statement
- Test data should include various Observation resources with different containment scenarios
- Access to retrieve referenced resources to validate reference integrity
- Understanding of FHIR containment rules (contained resources must be referenced from the containing resource)

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Observation resources (any of the US Core Observation profiles supported per Capability Statement)
- Any containing resources that have Observation resources in their `contained` array
- Referenced resources that may contain Observation resources

**Test Data Requirements:**
- Observation resources that are contained within other resources
- Observation resources that contain other resources
- Resources with valid and invalid reference patterns for containment scenarios

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and may be used:

1. **GET /Observation/[id]** - Read individual Observation resources
2. **GET /Observation?patient=[patient-id]** - Search for Observations by patient
3. **GET /[ResourceType]/[id]** - Read containing resources to verify containment patterns
4. **GET /[ResourceType]?_include=*** - Include related resources to validate references

### Validation Criteria

**Test Cases:**

#### Test Case 1: Contained Observation Resources
**Scenario**: Verify that when an Observation is contained within another resource, it is properly referenced from the containing resource.

**Validation Steps:**
1. Identify resources containing Observation resources in their `contained` array
2. For each contained Observation:
   - Verify the Observation has a local identifier (starts with '#')
   - Search the containing resource for references to this contained Observation
   - Assert that at least one reference exists within the containing resource that points to the contained Observation's local ID

**Pass Criteria**: All contained Observation resources are referenced from within their containing resource

#### Test Case 2: Observation Resources Containing Other Resources
**Scenario**: Verify that when an Observation contains other resources, all contained resources are properly referenced within the Observation.

**Validation Steps:**
1. Identify Observation resources that have a `contained` array
2. For each contained resource within the Observation:
   - Verify the contained resource has a local identifier (starts with '#')
   - Search the Observation resource fields for references to this contained resource
   - Assert that at least one reference exists within the Observation that points to the contained resource's local ID

**Pass Criteria**: All resources contained within Observation resources are referenced from within the containing Observation

#### Test Case 3: Reference Integrity Validation
**Scenario**: Ensure containment reference integrity is maintained across the resource structure.

**Validation Steps:**
1. For each Observation resource in the test dataset:
   - If the Observation is contained: verify it's referenced by its container
   - If the Observation contains resources: verify all contained resources are referenced
   - Check that no contained resources are referenced from outside their containing resource
   - Validate that reference formats follow FHIR containment rules (local references use '#' prefix)

**Pass Criteria**: All containment references follow proper FHIR patterns and maintain integrity

**Assertions for Test Success:**
- **Assertion 1**: Every contained Observation resource has at least one reference from its containing resource
- **Assertion 2**: Every resource contained within an Observation is referenced from within that Observation
- **Assertion 3**: All containment references use proper local reference syntax ('#' prefix)
- **Assertion 4**: No orphaned contained resources exist (contained but not referenced)
- **Assertion 5**: No external references to contained resources exist

**Failure Conditions:**
- Contained Observation resources that are not referenced from their container
- Resources contained within Observations that are not referenced from the Observation
- Improper reference syntax for contained resources
- External references to contained resources (violates containment rules)

---

<a id='req-553'></a>

### REQ-553: Observation resource SHALL NOT have a meta.versionId or a meta.lastUpdated if it is contained.

**Text**: 

**Context**: Observation containment metadata constraints

**Actor**: Observation resource

**Conformance**: SHALL

# Test Specification for REQ-553

## 1. Requirement ID
REQ-553

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified programmatically by examining the meta elements of contained Observation resources within FHIR responses.

### Complexity
**Simple** - The test involves straightforward validation of specific metadata elements within contained resources.

### Prerequisites
- FHIR server implementing US Core Observation profiles
- Test data containing resources with contained Observation resources
- Access to FHIR API endpoints that return resources with contained Observations

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Any FHIR resources that may contain Observation resources (e.g., DiagnosticReport, Bundle, Patient, etc.)
- **Test Data**: Existing data from the system under test that includes resources with contained Observations
- **No specific test fixtures required** - uses "bring your own data" approach

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for accessing resources that may contain Observations:

1. **READ Operations**:
   - `GET [base]/DiagnosticReport/[id]` - DiagnosticReports may contain Observations
   - `GET [base]/Bundle/[id]` - Bundles may contain Observations  
   - `GET [base]/Patient/[id]` - Less common but possible
   - `GET [base]/[ResourceType]/[id]` - Any resource type that might contain Observations

2. **SEARCH Operations**:
   - `GET [base]/DiagnosticReport?patient=[patient-id]`
   - `GET [base]/Bundle?[search-parameters]`
   - Any search operations that return resources potentially containing Observations

### Validation Criteria

The test SHALL verify the following for each contained Observation resource:

#### Primary Assertions:
1. **meta.versionId Absence**: 
   - Assert that `contained[].meta.versionId` is either:
     - Not present in the JSON/XML structure, OR
     - Present but with null/empty value
   - Fail if any contained Observation has a populated `meta.versionId`

2. **meta.lastUpdated Absence**:
   - Assert that `contained[].meta.lastUpdated` is either:
     - Not present in the JSON/XML structure, OR  
     - Present but with null/empty value
   - Fail if any contained Observation has a populated `meta.lastUpdated`

#### Test Execution Steps:
1. **Resource Discovery**: 
   - Execute READ/SEARCH operations to retrieve resources from the system
   - Filter results to identify resources containing Observation resources in their `contained` array

2. **Containment Validation**:
   - For each resource with a `contained` array:
     - Identify contained resources with `resourceType: "Observation"`
     - Verify each contained Observation conforms to US Core Observation profiles (per Capability Statement)

3. **Metadata Constraint Verification**:
   - For each contained Observation:
     - Check `meta.versionId` is absent or empty
     - Check `meta.lastUpdated` is absent or empty
     - Log any violations with resource ID and containment context

#### Pass Criteria:
- **PASS**: All contained Observation resources lack both `meta.versionId` and `meta.lastUpdated` elements (or have null/empty values)
- **FAIL**: Any contained Observation resource has either `meta.versionId` or `meta.lastUpdated` populated with non-empty values

#### Additional Validation Notes:
- Test should differentiate between contained vs. non-contained Observations (requirement only applies to contained)
- Test should handle multiple contained Observations within a single resource
- Test should validate across all supported US Core Observation profile variants listed in the Capability Statement
- Consider testing with different resource types that may contain Observations to ensure comprehensive coverage

---

<a id='req-554'></a>

### REQ-554: Observation resource SHALL NOT have a security label if it is contained.

**Text**: 

**Context**: Observation containment security label constraint

**Actor**: Observation resource

**Conformance**: SHALL

# Test Specification for REQ-554

## 1. Requirement ID
REQ-554

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be programmatically verified by examining the structure of Observation resources to check for the presence of security labels in contained Observation resources.

### Complexity
**Simple** - The test involves straightforward structural validation of FHIR resources to verify the absence of security labels in contained Observations.

### Prerequisites
- System must support US Core Observation profiles as specified in the Capability Statement
- Test data must include FHIR resources that contain Observation resources within other resources
- Access to retrieve Observation resources and any resources that may contain Observations

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Any resources that contain Observation resources (e.g., Bundle, Composition, or other domain resources with contained elements)
- **Search Parameters**: Patient identifier or other search criteria to retrieve resources that may contain Observations
- **Expected Outputs**: Validation results indicating whether contained Observation resources have security labels

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for Observation resources:
- `GET /Observation` (search with supported parameters: category, code, date, patient, status, etc.)
- `GET /[Resource]/[id]` for any resource type that may contain Observations
- Standard FHIR read operations to retrieve resources for analysis

### Validation Criteria

#### Test Case 1: Verify Contained Observations Lack Security Labels
**Objective**: Ensure that when an Observation resource is contained within another resource, it does not have any security labels.

**Test Steps**:
1. **Data Collection**:
   - Retrieve resources from the system that may contain Observation resources
   - This includes searching across resource types that commonly use containment (Bundle, Composition, etc.)
   - Use patient-based searches where applicable: `GET /Observation?patient=[patient-id]` to identify Observations that might be contained elsewhere

2. **Containment Analysis**:
   - For each retrieved resource, examine the `contained` array
   - Identify any Observation resources within the `contained` array
   - Extract the resource type by checking `contained[].resourceType = "Observation"`

3. **Security Label Validation**:
   - For each contained Observation resource, examine the `meta.security` element
   - Verify that `meta.security` is either:
     - Not present (undefined/null)
     - Present but empty (empty array)
   - Document any contained Observation that has populated `meta.security` as a conformance failure

4. **Cross-Reference Validation**:
   - Compare with standalone Observation resources to ensure the constraint only applies to contained resources
   - Verify that non-contained Observation resources may have security labels (to confirm the constraint is specific to containment)

**Assertion Criteria**:
- **PASS**: All contained Observation resources have no security labels (`meta.security` is absent or empty)
- **FAIL**: Any contained Observation resource has one or more security labels in `meta.security`

#### Test Case 2: Validate Containment Context
**Objective**: Ensure the security label constraint is correctly applied only in containment contexts.

**Test Steps**:
1. **Reference Validation**:
   - Identify standalone (non-contained) Observation resources
   - Verify these resources are allowed to have security labels
   - This serves as a control to ensure the constraint is contextually applied

2. **Containment Boundary Testing**:
   - Verify that the constraint applies regardless of the containing resource type
   - Test with different containing resource types (if available in test data)

**Assertion Criteria**:
- **PASS**: Only contained Observation resources are restricted from having security labels
- **FAIL**: The security label restriction is incorrectly applied to non-contained Observation resources OR contained Observations are found with security labels

#### Expected Test Results
- **Conformant System**: No contained Observation resources have security labels
- **Non-Conformant System**: One or more contained Observation resources have security labels populated
- **Test Report**: Summary of total contained Observations analyzed and count of conformance violations

#### Error Scenarios to Document
- Resources with malformed containment structures
- Observation resources incorrectly referenced instead of contained
- Systems that don't support resource containment
- Invalid or unrecognized security label formats

---

<a id='req-555'></a>

### REQ-555: Observation resource should have narrative for robust management.

**Text**: 

**Context**: Observation narrative presence recommendation

**Actor**: Observation resource

**Conformance**: SHOULD

# Test Specification for REQ-555

## 1. Requirement ID
REQ-555

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Automatically testable

This requirement can be automatically tested by programmatically checking for the presence of the `text` element (narrative) in Observation resources. The requirement has clear, objective criteria that can be verified through automated inspection of FHIR resource instances.

### Complexity
**Level**: Simple

The test involves a straightforward check for the presence of the `Observation.text` element in returned resources. No complex business logic, data transformation, or multi-step workflows are required.

### Prerequisites
- System under test must implement US Core Server CapabilityStatement
- System must support at least one of the US Core Observation profiles listed in the capability statement
- System must have Observation resources available for testing
- Test client must be able to perform FHIR RESTful read/search operations

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources Required**:
- One or more Observation resources conforming to any of the supported US Core Observation profiles:
  - US Core Laboratory Result Observation Profile
  - US Core Vital Signs Profile
  - US Core Simple Observation Profile
  - US Core Smoking Status Observation Profile
  - Any other supported US Core Observation profile variants

**Test Data Requirements**:
- Observation resources should represent realistic clinical data
- Resources should be valid according to their declared profiles
- Mix of different Observation types recommended to ensure comprehensive coverage

### Required FHIR Operations
Based on the capability statement, the following operations are supported and should be used:

1. **GET /Observation/[id]** - Direct resource retrieval by ID
2. **GET /Observation?patient=[patient-id]** - Search by patient
3. **GET /Observation?patient=[patient-id]&category=[category]** - Search by patient and category
4. **GET /Observation?patient=[patient-id]&code=[code]** - Search by patient and code

All operations listed are confirmed as supported in the US Core Server CapabilityStatement.

### Validation Criteria

**Primary Assertion**:
- **SHOULD-level conformance check**: For each Observation resource retrieved, verify that `Observation.text` element is present and populated

**Specific Validation Steps**:

1. **Narrative Presence Check**:
   - Assert that `Observation.text` element exists in the resource
   - Verify that `Observation.text.status` has a valid value (generated, extensions, additional, empty)
   - Verify that `Observation.text.div` contains narrative content (non-empty XHTML)

2. **Narrative Content Validation**:
   - Ensure `Observation.text.div` contains valid XHTML
   - Verify the narrative is not just empty tags or whitespace
   - Confirm the narrative provides human-readable content about the observation

**Pass Criteria**:
- Since this is a SHOULD requirement, the test should:
  - **PASS**: If narrative is present and properly formatted in retrieved Observations
  - **WARNING**: If narrative is missing or improperly formatted (log as conformance advisory)
  - **FAIL**: Only if there are technical errors in accessing/parsing the resources

**Test Execution Flow**:
1. Retrieve Observation resources using supported search parameters
2. For each returned Observation resource:
   - Check for presence of `text` element
   - Validate narrative structure and content
   - Record results with appropriate conformance level indicators
3. Generate summary report indicating:
   - Total Observations tested
   - Number with proper narratives
   - Number missing narratives
   - Any technical validation errors

**Expected Outcomes**:
- Test should provide clear feedback on narrative implementation patterns
- Results should indicate the level of narrative support across different Observation types
- Findings should help implementers understand robust management capabilities through narrative presence

---

<a id='req-556'></a>

### REQ-556: dataAbsentReason SHALL only be present if Observation.value[x] is not present.

**Text**: 

**Context**: Observation.value[x] vs dataAbsentReason constraint

**Actor**: Observation resource

**Conformance**: SHALL

# Test Specification for REQ-556

## 1. Requirement ID
REQ-556

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This constraint can be programmatically validated by checking the presence/absence of specific FHIR elements in Observation resources.

### Complexity
**Simple** - The test involves a straightforward boolean check of element presence across two mutually exclusive fields.

### Prerequisites
- Server implementing US Core Observation profiles (multiple variants as listed in Capability Statement)
- Access to Observation resources via FHIR REST API
- Test data containing Observation resources with various combinations of value[x] and dataAbsentReason elements

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources conforming to any US Core Observation profiles
- **Test Scenarios**: 
  - Observations with value[x] present and dataAbsentReason absent (valid)
  - Observations with value[x] absent and dataAbsentReason present (valid)  
  - Observations with both value[x] and dataAbsentReason present (invalid)
  - Observations with neither value[x] nor dataAbsentReason present (invalid per US Core guidance)

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for Observation resources:

**Primary Operations:**
- `GET [base]/Observation/[id]` (SHALL support read)
- `GET [base]/Observation?[search-parameters]` (SHALL support search-type)

**Recommended Search Parameters for Test Data Discovery:**
- `GET [base]/Observation?patient=[patient-id]&category=[category]` (SHALL support)
- `GET [base]/Observation?patient=[patient-id]&code=[code]` (SHALL support)

### Validation Criteria

**For each Observation resource retrieved, verify:**

1. **Valid Scenario 1**: If `Observation.value[x]` is present (any value type: valueQuantity, valueCodeableConcept, valueString, etc.)
   - **Assertion**: `Observation.dataAbsentReason` SHALL NOT be present
   - **Result**: PASS if dataAbsentReason is absent, FAIL if present

2. **Valid Scenario 2**: If `Observation.value[x]` is not present
   - **Assertion**: `Observation.dataAbsentReason` SHALL be present
   - **Result**: PASS if dataAbsentReason is present, FAIL if absent

3. **Invalid Scenario**: If both `Observation.value[x]` and `Observation.dataAbsentReason` are present
   - **Assertion**: This violates the constraint
   - **Result**: FAIL

4. **Edge Case**: If neither `Observation.value[x]` nor `Observation.dataAbsentReason` are present
   - **Assertion**: This violates US Core guidance (referenced in Capability Statement documentation)
   - **Result**: FAIL (unless component observations or references to grouped observations are present)

**Implementation Notes:**
- Test should iterate through all Observation resources available in the test dataset
- Consider all possible value[x] types (valueQuantity, valueCodeableConcept, valueString, valueBoolean, valueInteger, valueRange, valueRatio, valueSampledData, valueTime, valueDateTime, valuePeriod, etc.)
- The test should account for US Core's exception: "An Observation without a value, SHALL include a reason why the data is absent unless there are component observations, or references to other Observations that are grouped within it"
- Generate a summary report indicating total observations tested, number of constraint violations, and specific resources that failed validation

**Expected Test Outcomes:**
- **PASS**: All Observation resources conform to the mutual exclusivity constraint
- **FAIL**: One or more Observation resources violate the constraint by having both elements present or neither element present (without valid exceptions)

---

<a id='req-557'></a>

### REQ-557: If Observation.code is the same as an Observation.component.code, the value element associated with the code SHALL NOT be present.

**Text**: 

**Context**: Observation code/component mutual exclusivity constraint

**Actor**: Observation resource

**Conformance**: SHALL

# Test Specification for REQ-557

## 1. Requirement ID
**REQ-557**: Observation code/component mutual exclusivity constraint

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be programmatically verified by analyzing the structure of Observation resources to check for the presence of value elements when codes match between Observation.code and Observation.component.code.

### Complexity
**Simple** - The test involves straightforward structural validation of FHIR resources to verify that specific elements are absent under defined conditions.

### Prerequisites
- System must support the Observation resource type (confirmed in Capability Statement)
- System must have Observation resources with component data available
- Test system must be able to retrieve Observation resources using supported search parameters:
  - `patient+category` (SHALL support)
  - `patient+code` (SHALL support)
  - Individual `patient` searches (SHALL support)

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources that contain:
  - `Observation.code` element populated
  - `Observation.component` array with at least one component containing:
    - `Observation.component.code` element
    - Optionally `Observation.component.value[x]` elements
  - Optionally `Observation.value[x]` element

### Required FHIR Operations
Based on the Capability Statement, the following supported operations will be used:

1. **Search Operations** (all SHALL support):
   - `GET [base]/Observation?patient=[id]&category=[category]`
   - `GET [base]/Observation?patient=[id]&code=[code]`
   - `GET [base]/Observation?patient=[id]`

2. **Read Operations** (SHALL support):
   - `GET [base]/Observation/[id]`

### Validation Criteria

For each retrieved Observation resource, perform the following validation:

#### Test Case 1: Code Match Detection
**Assertion**: When `Observation.code` matches any `Observation.component.code`, verify mutual exclusivity constraint.

**Validation Steps**:
1. Extract the `Observation.code` value(s) (considering both code and system if present)
2. Extract all `Observation.component.code` values from each component
3. For each component where `component.code` matches `Observation.code`:
   - **PASS**: `Observation.value[x]` SHALL NOT be present (element must be absent or null)
   - **FAIL**: If `Observation.value[x]` is present when codes match

#### Test Case 2: No Code Match Scenario
**Assertion**: When `Observation.code` does not match any `Observation.component.code`, no constraint applies.

**Validation Steps**:
1. Extract the `Observation.code` value(s)
2. Extract all `Observation.component.code` values
3. If no matches exist between observation code and any component codes:
   - **PASS**: `Observation.value[x]` MAY be present or absent
   - Test is not applicable for this constraint

#### Test Case 3: Multiple Components Validation
**Assertion**: The constraint applies independently to each component with matching codes.

**Validation Steps**:
1. For each `Observation.component` in the array:
   - Check if `component.code` matches `Observation.code`
   - If match found: verify `Observation.value[x]` is not present
   - If no match: constraint does not apply
2. **PASS**: All matching components satisfy the mutual exclusivity constraint
3. **FAIL**: Any matching component where `Observation.value[x]` is present

#### Expected Test Results

**Conformant Behavior**:
- Observation resources with matching codes between `code` and `component.code` do not have a `value[x]` element at the root level
- The constraint only applies when there is an exact match between codes (considering both code value and system)
- Non-matching scenarios are allowed to have `Observation.value[x]` present

**Non-Conformant Behavior**:
- Observation resources that have both a matching `code`/`component.code` pair AND a populated `Observation.value[x]` element
- This violates the SHALL NOT constraint specified in the requirement

**Test Completion Criteria**:
- All retrieved Observation resources have been validated against the mutual exclusivity constraint
- Test results clearly identify any violations with specific resource IDs and the conflicting code values
- Test accommodates various code systems and coding patterns used in the implementation

---

<a id='req-558'></a>

### REQ-558: Observation.status codes SHALL be taken from ObservationStatus value set.

**Text**: 

**Context**: Observation.status required binding

**Actor**: Observation resource

**Conformance**: SHALL

# Test Specification for REQ-558

## 1. Requirement ID
REQ-558

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified programmatically by examining the `Observation.status` field values against the FHIR ObservationStatus value set.

### Complexity
**Simple** - The test involves validating that status codes match a predefined value set, which is a straightforward validation check.

### Prerequisites
- FHIR server implementing US Core Observation profiles
- Access to Observation resources via FHIR API
- Knowledge of the FHIR ObservationStatus value set (registered, preliminary, final, amended, corrected, cancelled, entered-in-error, unknown)

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources conforming to any of the US Core Observation profiles listed in the capability statement
- **Data Requirements**: Any existing Observation data in the system under test
- **Expected Outputs**: Validation results indicating whether all Observation.status values are from the ObservationStatus value set

### Required FHIR Operations
Based on the capability statement, the following operations are supported for Observation resources:
- **GET /Observation** (search interactions)
- **GET /Observation/[id]** (read interactions)

Specific search parameters that can be used:
- `patient` - to retrieve observations for specific patients
- `status` - to retrieve observations with specific status values
- `category` - to retrieve observations by category
- `code` - to retrieve observations by code
- `date` - to retrieve observations by date
- `_lastUpdated` - to retrieve recently updated observations

### Validation Criteria

#### Test Case 1: Validate Status Codes via Search
**Objective**: Verify that all accessible Observation resources have valid status codes

**Test Steps**:
1. Execute a search query to retrieve Observation resources: `GET /Observation?_count=100`
2. For each returned Observation resource, extract the `status` field value
3. Validate that each status value is one of the valid ObservationStatus codes:
   - `registered`
   - `preliminary` 
   - `final`
   - `amended`
   - `corrected`
   - `cancelled`
   - `entered-in-error`
   - `unknown`

**Pass Criteria**: All Observation.status values must be from the ObservationStatus value set

**Fail Criteria**: Any Observation.status contains a value not in the ObservationStatus value set

#### Test Case 2: Validate Status Codes via Individual Resource Retrieval
**Objective**: Verify status code conformance for individually retrieved Observation resources

**Test Steps**:
1. Identify Observation resource IDs through search or other means
2. Retrieve individual Observation resources: `GET /Observation/[id]`
3. For each retrieved resource, validate the `status` field against the ObservationStatus value set
4. Document any non-conformant status values

**Pass Criteria**: All individually retrieved Observation resources have valid status codes

**Fail Criteria**: Any retrieved Observation resource contains an invalid status code

#### Test Case 3: Status-Specific Search Validation
**Objective**: Verify that status-based searches return only resources with valid status codes

**Test Steps**:
1. Execute searches using the status parameter with valid ObservationStatus values:
   - `GET /Observation?status=final`
   - `GET /Observation?status=preliminary`
   - `GET /Observation?status=amended`
   - (Continue for other valid status values as applicable)
2. Verify that returned resources actually contain the queried status value
3. Confirm no resources are returned with invalid status codes

**Pass Criteria**: 
- Search results contain only Observations with the specified valid status
- No resources with invalid status codes are returned
- Status field in each returned resource matches the search parameter

**Fail Criteria**: 
- Resources returned contain status codes different from the search parameter
- Resources with invalid status codes are returned in search results

#### Assertions for Test Success
1. **Value Set Compliance**: Every Observation.status field contains only values from the ObservationStatus value set
2. **Data Consistency**: Status values are consistent between search parameters and actual resource content
3. **No Invalid Values**: Zero instances of status codes outside the defined value set
4. **Completeness**: All tested Observation resources (regardless of profile) comply with the status value set requirement

#### Error Handling Validation
- Verify that the system properly handles and reports any status validation errors
- Confirm that invalid status codes are not accepted during resource creation or updates (if write operations are supported)

---

<a id='req-559'></a>

### REQ-559: Observation.category codes SHOULD be taken from ObservationCategoryCodes value set.

**Text**: 

**Context**: Observation.category preferred binding

**Actor**: Observation resource

**Conformance**: SHOULD

# Test Specification for REQ-559

## 1. Requirement ID
**REQ-559**: Observation.category codes SHOULD be taken from ObservationCategoryCodes value set

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified programmatically by examining Observation resources returned by the system and validating that the category codes conform to the specified value set binding.

### Complexity
**Simple** - The test involves straightforward value set validation against a well-defined set of codes.

### Prerequisites
- System must support US Core Observation Profile(s) as specified in the Capability Statement
- System must have Observation resources available for testing
- Access to the ObservationCategoryCodes value set definition
- System must support the required FHIR search operations for Observation resources

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources conforming to any of the US Core Observation profiles supported by the system
- **Value Set**: ObservationCategoryCodes value set (http://hl7.org/fhir/ValueSet/observation-category)
- **Test Data**: Existing Observation resources in the system under test (bring your own data approach)

### Expected Outputs
- Observation resources with category elements populated
- Validation results indicating conformance level with the preferred binding

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and will be used:

1. **Patient Search** (to identify test patients):
   ```
   GET [base]/Patient?[search-parameters]
   ```

2. **Observation Search by Patient and Category**:
   ```
   GET [base]/Observation?patient=[patient-id]&category=[category-code]
   ```

3. **Observation Read**:
   ```
   GET [base]/Observation/[id]
   ```

4. **Observation Search by Patient** (to retrieve all observations for validation):
   ```
   GET [base]/Observation?patient=[patient-id]
   ```

### Validation Criteria

#### Primary Validation Checks

1. **Category Element Presence Validation**:
   - Verify that retrieved Observation resources contain the `category` element
   - Document any observations without category elements

2. **Value Set Conformance Validation**:
   - For each Observation.category coding:
     - Check if the code is from the ObservationCategoryCodes value set
     - Validate both `code` and `system` values where present
     - Record conformance statistics (percentage of compliant vs non-compliant codes)

3. **SHOULD Requirement Assessment**:
   - Calculate the percentage of Observation.category codes that conform to the ObservationCategoryCodes value set
   - Generate a conformance report indicating the level of adherence to the preferred binding
   - Flag any non-conformant codes for review (noting this is a SHOULD, not SHALL requirement)

#### Specific Assertions for Test Passing

**Test Result Categories**:

- **Full Conformance**: 100% of Observation.category codes are from the ObservationCategoryCodes value set
- **High Conformance**: ≥90% of Observation.category codes are from the ObservationCategoryCodes value set  
- **Partial Conformance**: 50-89% of Observation.category codes are from the ObservationCategoryCodes value set
- **Low Conformance**: <50% of Observation.category codes are from the ObservationCategoryCodes value set

**Pass Criteria**:
- Test passes if the system demonstrates any level of conformance (≥1% compliance)
- Test provides conformance percentage for transparency
- Non-conformant codes are documented but do not cause test failure (due to SHOULD conformance level)

#### Secondary Validation Checks

1. **Profile-Specific Category Validation**:
   - Verify category codes align with specific US Core Observation profile requirements
   - Check for profile-specific category code requirements (e.g., vital signs, laboratory results)

2. **Search Functionality Validation**:
   - Verify that category-based searches return appropriate results
   - Confirm search parameters work with both conformant and non-conformant category codes

3. **Data Quality Assessment**:
   - Report on missing category elements
   - Identify patterns in non-conformant codes
   - Provide recommendations for improved conformance

**Documentation Requirements**:
- List all unique category codes found in the system
- Categorize codes as conformant vs non-conformant
- Provide specific recommendations for achieving higher conformance levels
- Generate summary statistics on overall category code usage patterns

---

<a id='req-560'></a>

### REQ-560: Observation.code SHALL be supported and must use LOINC code 82810-3 for pregnancy status.

**Text**: 

**Context**: Pregnancy status Observation profile code constraint

**Actor**: Observation resource

**Conformance**: SHALL

# Test Specification for REQ-560

## 1. Requirement ID
**REQ-560**: Observation.code SHALL be supported and must use LOINC code 82810-3 for pregnancy status

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated programmatically by examining Observation resources that represent pregnancy status and verifying the specific LOINC code constraint.

### Complexity
**Simple** - The requirement involves checking a single field (Observation.code) for a specific LOINC code value in pregnancy status observations.

### Prerequisites
- System must support the US Core Observation Pregnancy Status Profile
- System must have Observation resources that represent pregnancy status available for testing
- System must support RESTful read/search operations for Observation resources
- Test data should include at least one Observation resource intended to represent pregnancy status

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources that are intended to represent pregnancy status (conforming to US Core Observation Pregnancy Status Profile)
- **System Capability**: US Core Server implementing Observation resource support as specified in the capability statement

### Expected Outputs
- Observation resources with `code.coding` containing LOINC code 82810-3
- Proper FHIR validation responses for conformant resources
- Error responses for non-conformant pregnancy status observations

### Required FHIR Operations
Based on the capability statement, the following supported operations will be used:
- **GET /Observation/{id}** - Retrieve specific Observation resources for validation
- **GET /Observation?patient={patient}&category={category}** - Search for observations by patient and category to identify pregnancy status observations
- **GET /Observation?patient={patient}&code=82810-3** - Search for observations with the specific LOINC code

### Validation Criteria

#### Primary Assertions (Must Pass):
1. **Code Presence Validation**: 
   - Each pregnancy status Observation resource SHALL have an `Observation.code` element present
   - The code element SHALL NOT be empty or null

2. **LOINC Code Validation**:
   - Each pregnancy status Observation resource SHALL contain `code.coding` with:
     - `system` = "http://loinc.org"
     - `code` = "82810-3"
   - The LOINC code 82810-3 SHALL be present in at least one coding within the code element

3. **Profile Conformance**:
   - Pregnancy status Observation resources SHALL validate against the US Core Observation Pregnancy Status Profile
   - Resources SHALL pass FHIR validation when tested against the profile

#### Test Execution Steps:
1. **Resource Identification**: Identify Observation resources that represent pregnancy status (either through profile declaration, category codes, or known test data markers)

2. **Code Element Verification**: For each identified pregnancy status Observation:
   - Verify `Observation.code` exists and is populated
   - Extract all `code.coding` entries

3. **LOINC Code Verification**: 
   - Verify at least one coding entry has system "http://loinc.org" and code "82810-3"
   - Confirm the coding is properly structured with required elements

4. **Profile Validation**:
   - Validate the complete Observation resource against US Core Observation Pregnancy Status Profile
   - Verify no validation errors related to code constraints

#### Success Criteria:
- **PASS**: All pregnancy status Observation resources contain the required LOINC code 82810-3 and validate successfully against the profile
- **FAIL**: Any pregnancy status Observation resource lacks the required LOINC code or fails profile validation due to code-related constraints

#### Edge Cases to Consider:
- Observations with multiple coding entries in the code element (verify 82810-3 is present among them)
- Observations that might represent pregnancy status but use different/additional codes (these should still include 82810-3)
- Proper handling of code.text elements alongside the required coding

---

<a id='req-561'></a>

### REQ-561: Observation.subject SHALL reference a US Core Patient Profile.

**Text**: 

**Context**: Pregnancy status Observation subject reference constraint

**Actor**: Observation resource

**Conformance**: SHALL

# Test Specification for REQ-561

## Requirement ID
REQ-561

## Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified programmatically by inspecting the `Observation.subject` reference and validating that it points to a resource conforming to the US Core Patient Profile.

### Complexity
**Simple** - The test involves a straightforward validation of a single reference field and profile conformance check.

### Prerequisites
- System under test must implement US Core Server capabilities
- System must support the Observation resource
- System must support the US Core Patient Profile
- Test data must include Observation resources with subject references
- Access to retrieve both Observation and referenced Patient resources

## Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- One or more Observation resources that contain a `subject` element
- Patient resources that are referenced by the Observation.subject elements

**Expected Outputs:**
- Confirmation that each Observation.subject reference resolves to a valid US Core Patient resource
- Validation that referenced Patient resources conform to the US Core Patient Profile

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are required:

1. **GET /Observation** - Retrieve Observation resources to examine subject references
2. **GET /Patient/[id]** - Retrieve Patient resources referenced by Observation.subject
3. **GET /Patient** - Alternative search operation if using search parameters to validate Patient resources

*Note: These operations align with the US Core Server CapabilityStatement requirement to support US Core Patient resource profile and additional resource profiles.*

### Validation Criteria

**Primary Assertions:**
1. **Reference Validity**: Each `Observation.subject` element SHALL contain a valid reference
   - Reference format follows FHIR specification (e.g., "Patient/123" or full URL)
   - Referenced resource exists and is accessible

2. **Profile Conformance**: Referenced Patient resource SHALL conform to US Core Patient Profile
   - Patient resource contains `meta.profile` indicating US Core Patient Profile conformance (recommended per CapabilityStatement)
   - Patient resource validates successfully against US Core Patient Profile constraints
   - All required US Core Patient Profile elements are present and valid

3. **Reference Resolution**: The reference in `Observation.subject` SHALL successfully resolve to the Patient resource
   - HTTP GET request to referenced Patient returns 200 status
   - Returned resource is of resourceType "Patient"

**Test Pass Criteria:**
- All Observation resources in the test dataset have valid subject references
- All referenced Patient resources conform to the US Core Patient Profile
- No validation errors occur when validating Patient resources against the profile
- All reference resolution attempts are successful

**Test Fail Criteria:**
- Any Observation.subject reference is missing, malformed, or unresolvable
- Any referenced Patient resource fails US Core Patient Profile validation
- Any referenced resource is not of resourceType "Patient"
- Any reference resolution returns an error status (4xx, 5xx)

**Implementation Notes:**
- Test should accommodate any existing Observation data in the system under test
- Test should work with the system's existing Patient data
- Validation should use the official US Core Patient Profile definition
- Test should handle both relative references (e.g., "Patient/123") and absolute URLs
- Consider testing with various Observation types that may reference patients to ensure broad coverage

---

<a id='req-562'></a>

### REQ-562: Observation.effective[x] SHALL be supported and use dateTime, Period, Timing, or instant data types.

**Text**: 

**Context**: Pregnancy status Observation effective[x] datatype constraint

**Actor**: Observation resource

**Conformance**: SHALL

# REQ-562 Test Specification

## Requirement ID
REQ-562

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be tested through automated validation by examining the data type of the `Observation.effective[x]` element in pregnancy status Observation resources. The FHIR specification defines clear data type validation rules that can be programmatically verified.

### Complexity
**Simple** - The requirement involves a straightforward data type constraint validation on a single element. It requires checking that the effective[x] element uses one of four specific FHIR data types.

### Prerequisites
- System must support US Core Server CapabilityStatement operations for Observation resources
- System must have pregnancy status Observation resources available for testing
- Test system must be able to retrieve and validate FHIR Observation resources
- Understanding of FHIR data types: dateTime, Period, Timing, and instant

## Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Observation resources that represent pregnancy status (conforming to US Core Observation Pregnancy Status Profile)
- Resources should include the `effective[x]` element populated with test data

**Expected Outputs:**
- Validation results confirming that `Observation.effective[x]` uses only the permitted data types
- Clear pass/fail determination for each tested Observation resource

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required:

1. **GET /Observation** - Retrieve Observation resources using supported search parameters:
   - `patient+category` (to find pregnancy status observations)
   - `patient+code` (to identify specific pregnancy status observations)
   - `category` (to filter for relevant observation categories)

2. **GET /Observation/{id}** - Retrieve specific Observation resources by ID for detailed validation

### Validation Criteria

**Primary Validation Checks:**

1. **Data Type Validation:**
   - Verify that `Observation.effective[x]` element is present (SHALL constraint)
   - Confirm the data type is one of the following:
     - `effectiveDateTime` (dateTime data type)
     - `effectivePeriod` (Period data type)  
     - `effectiveTiming` (Timing data type)
     - `effectiveInstant` (instant data type)

2. **Conformance Assertions:**
   - **PASS**: `Observation.effective[x]` is populated AND uses one of the four permitted data types
   - **FAIL**: `Observation.effective[x]` is missing (violates SHALL constraint)
   - **FAIL**: `Observation.effective[x]` uses a data type other than dateTime, Period, Timing, or instant
   - **FAIL**: Multiple effective[x] variants are present simultaneously (violates FHIR choice element rules)

**Test Execution Steps:**

1. Query the system for pregnancy status Observation resources using appropriate search parameters
2. For each retrieved Observation resource:
   - Parse the JSON/XML response
   - Locate the `effective[x]` element
   - Validate the presence of exactly one effective[x] variant
   - Verify the data type matches one of the four permitted types
   - Record validation results

**Success Criteria:**
- All pregnancy status Observation resources must have a populated `effective[x]` element
- The `effective[x]` element must use only dateTime, Period, Timing, or instant data types
- No pregnancy status Observation resources should fail the data type constraint validation

**Reporting:**
- Document the total number of pregnancy status Observations tested
- Report pass/fail counts with specific details for any failures
- Include examples of valid effective[x] usage patterns found during testing

---

<a id='req-563'></a>

### REQ-563: Observation.performer SHALL reference US Core Practitioner, Organization, Patient, PractitionerRole, CareTeam, or RelatedPerson profiles.

**Text**: 

**Context**: Pregnancy status Observation performer reference constraint

**Actor**: Observation resource

**Conformance**: SHALL

# Test Specification for REQ-563

## 1. Requirement ID
REQ-563

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified programmatically by analyzing the reference targets in Observation.performer elements and validating that they conform to the specified US Core profiles.

### Complexity
**Simple** - The requirement involves straightforward reference validation against a defined set of allowed profile types.

### Prerequisites
- System under test must support US Core Observation profiles (specifically the Pregnancy Status Observation profile based on context)
- System must support the referenced US Core profiles: Practitioner, Organization, Patient, PractitionerRole, CareTeam, and RelatedPerson
- Test data must include Observation resources with performer references

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Observation resources that conform to US Core Observation profiles (particularly Pregnancy Status Observation based on the requirement context)
- Referenced resources that the Observation.performer elements point to (Practitioner, Organization, Patient, PractitionerRole, CareTeam, or RelatedPerson)

**Expected Outputs:**
- Validation results confirming that all Observation.performer references target resources conforming to the specified US Core profiles
- Clear identification of any non-conforming references

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required:

1. **GET /Observation** - Retrieve Observation resources for analysis
   - Supported search parameters: `category`, `code`, `date`, `patient`, `status`
   - Use patient-based searches to retrieve relevant Observation resources

2. **GET /[ResourceType]/[id]** - Retrieve referenced resources to validate their profile conformance:
   - GET /Practitioner/[id] (supported with search by `_id`, `identifier`, `name`)
   - GET /Organization/[id] (supported with search by `address`, `name`)
   - GET /Patient/[id] (supported with search by `_id`, `birthdate`, `family`, `given`, `identifier`, `name`)
   - GET /PractitionerRole/[id] (supported with search by `practitioner`, `specialty`)
   - GET /CareTeam/[id] (supported with search by `patient`, `role`, `status`)
   - GET /RelatedPerson/[id] (supported with search by `_id`, `name`, `patient`)

### Validation Criteria

**Primary Assertions:**

1. **Performer Reference Existence Validation:**
   - IF an Observation resource has a performer element
   - THEN the performer element SHALL contain at least one reference

2. **Reference Target Type Validation:**
   - FOR each reference in Observation.performer
   - WHEN the reference is resolved
   - THEN the target resource SHALL be one of the following types:
     - Practitioner (conforming to US Core Practitioner Profile)
     - Organization (conforming to US Core Organization Profile)
     - Patient (conforming to US Core Patient Profile)
     - PractitionerRole (conforming to US Core PractitionerRole Profile)
     - CareTeam (conforming to US Core CareTeam Profile)
     - RelatedPerson (conforming to US Core RelatedPerson Profile)

3. **Profile Conformance Validation:**
   - FOR each referenced resource
   - WHEN the resource is retrieved and validated
   - THEN the resource SHALL conform to the corresponding US Core profile as indicated by:
     - Proper profile declaration in resource.meta.profile, OR
     - Successful validation against the appropriate US Core profile constraints

**Test Pass Criteria:**
- All Observation resources with performer elements have valid references
- All referenced resources exist and are accessible
- All referenced resources conform to their respective US Core profiles
- No references point to resource types outside the allowed set

**Test Fail Criteria:**
- Any Observation.performer reference points to a resource type not in the allowed list
- Any referenced resource cannot be retrieved or does not exist
- Any referenced resource fails validation against its corresponding US Core profile
- Any performer reference is malformed or invalid

**Test Implementation Notes:**
- Test should handle both internal references (within the same system) and external references appropriately
- Profile validation should use the official US Core StructureDefinition resources
- Consider testing with various combinations of performer reference types to ensure comprehensive coverage
- The test should work with any valid Observation data provided by the implementer, focusing on the structural conformance rather than specific clinical content

---

<a id='req-564'></a>

### REQ-564: Observation.value[x] SHALL be supported and use specified data types.

**Text**: 

**Context**: Pregnancy status Observation value[x] datatype constraint per profile

**Actor**: Observation resource

**Conformance**: SHALL

# Test Specification for REQ-564

## 1. Requirement ID
REQ-564

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be automatically tested through programmatic validation of Observation resources to verify that the value[x] element is present and uses the specified data types according to the pregnancy status observation profile constraints.

### Complexity
**Moderate** - The test requires understanding of FHIR data type constraints and profile-specific validation rules for pregnancy status observations, but follows standard FHIR validation patterns.

### Prerequisites
- System must support US Core Observation Pregnancy Status Profile
- System must have Observation resources with pregnancy status data available
- Test system must be able to retrieve and validate Observation resources
- Access to FHIR structure definitions for data type validation

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources conforming to the US Core Observation Pregnancy Status Profile
- **Profile Information**: US Core Observation Pregnancy Status Profile structure definition
- **Data Types**: Expected value[x] data types as defined in the profile (typically CodeableConcept for pregnancy status)

### Expected Outputs
- Validation results confirming Observation.value[x] presence
- Data type validation results for the value[x] element
- Conformance assessment against the pregnancy status profile constraints

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for Observation resources:

1. **GET /Observation?patient={patient-id}** - Retrieve patient's observations
2. **GET /Observation?patient={patient-id}&category=survey** - Retrieve survey-type observations (pregnancy status typically falls under survey category)
3. **GET /Observation/{observation-id}** - Retrieve specific observation by ID
4. **GET /Observation?patient={patient-id}&code={pregnancy-status-code}** - Search for pregnancy status observations using specific codes

### Validation Criteria

#### Primary Assertions (SHALL Requirements):
1. **Value[x] Presence Check**:
   - Assert that `Observation.value[x]` element is present in all pregnancy status observations
   - Verify that the element is not null or empty

2. **Data Type Validation**:
   - Assert that `Observation.value[x]` uses only the data types specified in the US Core Observation Pregnancy Status Profile
   - Typically this should be `valueCodeableConcept` for pregnancy status observations
   - Verify that no other value[x] variants (valueString, valueQuantity, etc.) are used inappropriately

3. **Profile Conformance**:
   - Validate that observations claiming conformance to the pregnancy status profile actually conform to all profile constraints
   - Ensure that value[x] constraints defined in the profile are enforced

#### Test Cases:
1. **Positive Test Cases**:
   - Retrieve pregnancy status observations and verify value[x] is present with correct data type
   - Validate against multiple pregnancy status observations if available
   - Confirm that valueCodeableConcept contains appropriate pregnancy status codes

2. **Validation Test Cases**:
   - Attempt to validate observations that should conform to pregnancy status profile
   - Verify that the FHIR validator accepts compliant observations
   - Confirm that profile-specific constraints on value[x] are properly enforced

#### Success Criteria:
- All pregnancy status Observation resources contain a non-empty Observation.value[x] element
- The value[x] element uses only the data types permitted by the US Core Observation Pregnancy Status Profile
- Resources pass FHIR profile validation for the pregnancy status profile
- No validation errors related to missing or incorrectly typed value[x] elements

#### Failure Scenarios:
- Observation.value[x] is missing or null in pregnancy status observations
- value[x] uses incorrect data types not permitted by the profile
- Resources fail profile validation due to value[x] constraint violations
- System returns pregnancy status observations that don't conform to the specified profile requirements

---

<a id='req-565'></a>

### REQ-565: Observation.value[x]:valueCodeableConcept codes SHOULD be taken from Pregnancy Status Observation value set.

**Text**: 

**Context**: Pregnancy status Observation valueCodeableConcept preferred binding

**Actor**: Observation resource

**Conformance**: SHOULD

# Test Specification for REQ-565

## 1. Requirement ID
REQ-565

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be programmatically verified by examining the valueCodeableConcept codes in Pregnancy Status Observation resources and checking if they conform to the specified value set binding.

### Complexity
**Simple** - The test involves straightforward validation of codes against a defined value set with a SHOULD conformance level.

### Prerequisites
- Access to a FHIR server supporting US Core Observation Pregnancy Status Profile
- Patient data with pregnancy status observations containing valueCodeableConcept elements
- Access to the Pregnancy Status Observation value set for validation
- FHIR client capable of performing GET operations on Observation resources

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Patient resources (as subjects for observations)
- Observation resources conforming to US Core Observation Pregnancy Status Profile with `value[x]:valueCodeableConcept` populated

**Expected Outputs:**
- List of Observation resources with pregnancy status observations
- Validation results showing conformance to the Pregnancy Status Observation value set
- Summary report indicating SHOULD-level conformance percentage

### Required FHIR Operations
Based on the Capability Statement, the following supported operations will be used:

1. **GET /Observation** - Search for pregnancy status observations
   - Supported search parameters: `patient`, `category`, `code`
   - Use `category` and/or `code` parameters to filter for pregnancy status observations

2. **GET /Observation/{id}** - Retrieve specific observation instances for detailed validation

3. **GET /Patient** - Retrieve patient resources if needed for context
   - Supported search parameters: `_id`, `identifier`, `name`

### Validation Criteria

**Primary Assertions:**
1. **Resource Profile Conformance**: Verify that retrieved Observation resources conform to the US Core Observation Pregnancy Status Profile
2. **Value Set Binding Check**: For each `Observation.value[x]:valueCodeableConcept`:
   - Extract all coding systems and codes
   - Validate that codes are from the Pregnancy Status Observation value set
   - Since this is a SHOULD requirement, calculate conformance percentage
3. **Data Structure Validation**: Ensure `valueCodeableConcept` is properly structured with valid coding elements

**Specific Test Steps:**

1. **Discovery Phase**:
   - Search for Observation resources using pregnancy status-related category or code filters
   - Filter results to identify observations with `valueCodeableConcept` elements

2. **Validation Phase**:
   - For each identified observation:
     - Verify the observation conforms to US Core Observation Pregnancy Status Profile
     - Extract `value[x]:valueCodeableConcept.coding` elements
     - Check if codes are from the Pregnancy Status Observation value set
     - Record conformant vs. non-conformant instances

3. **Reporting Phase**:
   - Calculate percentage of observations with codes from the preferred value set
   - Generate conformance report with:
     - Total observations tested
     - Number of conformant observations
     - Number of non-conformant observations
     - Conformance percentage
     - Details of any non-conformant codes found

**Success Criteria:**
- Test passes if the system demonstrates reasonable conformance to the SHOULD requirement
- For SHOULD requirements, a high percentage (e.g., >80%) of conformant observations indicates good implementation
- Non-conformant observations should be documented but do not constitute test failure
- All observations must be structurally valid even if codes are not from the preferred value set

**Expected Outcomes:**
- Conformance report showing adherence to the preferred value set binding
- Identification of any alternative coding systems used
- Documentation of implementation patterns for pregnancy status value reporting

---

<a id='req-573'></a>

### REQ-573: Observation resource containment rules

**Text**: 

**Context**: Applies when validating Observation resources that use contained resources; ensure no contained resource itself contains another contained resource.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-573

## 1. Requirement ID
REQ-573

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be validated through automated instance validation using FHIRPath expressions to check contained resource nesting patterns.

### Complexity
**Simple** - The requirement involves a straightforward structural validation rule that can be implemented as a single FHIRPath invariant check.

### Prerequisites
- System must support Observation resources
- System must be capable of creating or providing Observation resources that may contain contained resources
- Access to FHIR validation engine capable of executing FHIRPath expressions
- Test data should include Observation resources with various containment patterns

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Observation resources that contain one or more contained resources
- Test dataset should include:
  - Valid Observation resources with contained resources (single level only)
  - Invalid Observation resources with nested contained resources (contained resource containing another contained resource)
  - Observation resources without any contained resources (baseline case)

**Expected Outputs:**
- Validation results indicating conformance success/failure
- Specific error messages identifying any violations of the containment rule

### Required FHIR Operations
- **GET [base]/Observation/[id]** - Retrieve individual Observation resources for validation
- **GET [base]/Observation?[search-parameters]** - Search for Observation resources to validate (as supported per Capability Statement)
- No specific create/update operations required as this is a validation-focused test

### Validation Criteria

**Primary Assertion:**
For each Observation resource that contains contained resources, verify that none of the contained resources themselves contain other contained resources.

**Specific Validation Checks:**

1. **FHIRPath Invariant Implementation:**
   ```
   contained.contained.empty()
   ```
   This expression ensures that any contained resources within the Observation do not have their own contained resources.

2. **Test Cases to Validate:**

   **Pass Criteria:**
   - Observation resources with no contained resources
   - Observation resources with contained resources that have no nested contained resources
   - Validation engine returns no errors for the containment invariant

   **Fail Criteria:**
   - Observation resources where any contained resource has its own contained resources (nested containment)
   - Validation engine identifies invariant violations with appropriate error messages

3. **Validation Process:**
   - Apply the FHIRPath invariant `contained.contained.empty()` to each Observation resource
   - Verify that the validation engine correctly identifies violations
   - Confirm that error messages clearly indicate the containment rule violation

4. **Expected Validation Behavior:**
   - **Success**: All Observation resources pass the containment invariant check
   - **Failure**: Any Observation resource with nested contained resources triggers a validation error
   - **Error Messages**: Should clearly indicate "contained resource cannot contain another contained resource" or similar

**Conformance Verification:**
The test passes when all Observation resources in the test dataset comply with the containment rule, demonstrating that the system correctly implements and validates the "no nested contained resources" invariant as specified in the Observation resource profile.

---

<a id='req-574'></a>

### REQ-574: Reference requirement for contained resources

**Text**: 

**Context**: Applies to Observation instances with contained resources; verify each contained resource is referenced within the container or has a back-reference to the container.

**Actor**: System

**Conformance**: SHALL

# REQ-574 Test Specification

## 1. Requirement ID
**REQ-574**: Reference requirement for contained resources

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be fully validated through automated FHIRPath evaluation as specified in the requirement description.

### Complexity
**Moderate** - Requires parsing contained resources and validating reference relationships, but has well-defined validation logic.

### Prerequisites
- System must support US Core Observation profiles as indicated in the Capability Statement
- System must have Observation instances that contain nested resources (contained resources)
- Test environment must support FHIRPath evaluation capabilities
- System must support JSON format (SHALL per Capability Statement)

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Observation instances that contain one or more resources in the `contained` array
- Any US Core Observation profile variant that includes contained resources

**Expected Outputs:**
- Validation results indicating whether each contained resource is properly referenced
- Clear identification of any contained resources that violate the reference requirements

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for Observation resources:
- **GET** operations to retrieve Observation instances using supported search parameters:
  - `patient` - to retrieve observations for specific patients
  - `category` - to filter by observation category
  - `code` - to filter by observation code
  - `status` - to filter by observation status
  - `date` - to filter by observation date

### Validation Criteria

**Primary Assertions:**
1. **Contained Resource Reference Validation**: For each Observation with contained resources, verify that every resource in the `contained` array meets one of these conditions:
   - Is referenced by an element within the containing Observation resource, OR
   - Contains a back-reference to the containing Observation resource

2. **FHIRPath Evaluation**: Execute FHIRPath expressions to systematically check reference integrity:
   - Extract all contained resource IDs from `Observation.contained.id`
   - Extract all internal references within the Observation (elements with values starting with "#")
   - Verify bidirectional reference completeness

**Specific Validation Steps:**

1. **Identify Test Candidates**: 
   - Query for Observation resources that have non-empty `contained` arrays
   - Focus on observations that match US Core Observation profiles listed in the Capability Statement

2. **Reference Direction Validation**:
   - **Forward References**: Verify that references from the main Observation resource to contained resources use the format `#[contained-resource-id]`
   - **Back References**: Check that contained resources reference back to the container when applicable

3. **Completeness Check**:
   - Ensure no contained resource exists without being referenced
   - Ensure no dangling references point to non-existent contained resources

**Pass Criteria:**
- All contained resources within tested Observation instances are properly referenced according to FHIR containment rules
- No orphaned contained resources exist (resources in `contained` array that are neither referenced nor contain back-references)
- All internal references resolve to existing contained resources

**Fail Criteria:**
- Any contained resource exists without proper referencing
- Any internal reference points to a non-existent contained resource
- Violation of FHIR containment reference patterns

**Test Coverage:**
- Test with various US Core Observation profile types that support contained resources
- Include observations with different numbers of contained resources (single, multiple)
- Test different types of contained resources (Patient, Practitioner, Organization, etc.)
- Validate both simple and complex reference patterns within the same Observation

---

<a id='req-575'></a>

### REQ-575: Meta data constraints for contained resources

**Text**: 

**Context**: Applies to contained resources within an Observation; verify absence of meta.versionId and meta.lastUpdated on contained resources.

**Actor**: System

**Conformance**: SHALL

# REQ-575 Test Specification

## 1. Requirement ID
REQ-575

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be fully automated through FHIRPath validation and instance inspection.

### Complexity
**Simple** - The requirement involves straightforward validation of metadata absence on contained resources within Observation resources.

### Prerequisites
- Access to Observation resources that contain contained resources
- FHIR validation engine capable of executing FHIRPath expressions
- Test system configured to retrieve Observation resources via FHIR API

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources that include contained resources in their `contained` element
- **Test Data**: Any Observation instances from the system under test that have populated `contained` arrays
- **FHIRPath Engine**: Capability to execute FHIRPath expressions for validation

### Expected Outputs
- **Pass**: All contained resources within Observation instances lack both `meta.versionId` and `meta.lastUpdated` elements
- **Fail**: One or more contained resources have `meta.versionId` or `meta.lastUpdated` present

### Required FHIR Operations
Based on the Capability Statement, the following supported operations will be used:

1. **Observation Search Operations**:
   - `GET [base]/Observation?patient={id}` - Search for Observations by patient
   - `GET [base]/Observation?category={category}` - Search for Observations by category
   - `GET [base]/Observation?patient={id}&category={category}` - Combined search parameters
   - `GET [base]/Observation/{id}` - Direct resource retrieval by ID

2. **Resource Retrieval**:
   - Individual Observation resource retrieval to inspect contained resources

### Validation Criteria

#### Primary Validation - FHIRPath Invariant
Execute the following FHIRPath expression against each Observation resource:
```
contained.all(meta.versionId.exists().not() and meta.lastUpdated.exists().not())
```

#### Specific Assertions for Test Pass/Fail

**Test PASSES when**:
1. All Observation resources with contained elements satisfy the FHIRPath invariant
2. For each contained resource within any Observation:
   - `contained[*].meta.versionId` is not present (null/undefined)
   - `contained[*].meta.lastUpdated` is not present (null/undefined)
3. Empty contained arrays are acceptable (no contained resources to validate)

**Test FAILS when**:
1. Any contained resource within an Observation has `meta.versionId` present
2. Any contained resource within an Observation has `meta.lastUpdated` present
3. The FHIRPath invariant returns `false` for any Observation resource

#### Test Execution Steps

1. **Discovery Phase**:
   - Query the system for Observation resources using supported search parameters
   - Filter results to identify Observations that have non-empty `contained` arrays
   - If no Observations with contained resources exist, document this as a test limitation

2. **Validation Phase**:
   - For each Observation with contained resources:
     - Apply the FHIRPath invariant validation
     - Individually inspect each contained resource's meta element
     - Record any violations with specific resource identifiers

3. **Reporting Phase**:
   - Document total number of Observations tested
   - Report number of contained resources validated
   - List any specific violations found with resource paths
   - Provide summary pass/fail status

#### Edge Cases to Consider
- Observations with empty `contained` arrays (should pass)
- Observations with no `contained` element (should pass)
- Contained resources with empty `meta` elements (should pass)
- Contained resources with `meta` elements containing other properties but not `versionId` or `lastUpdated` (should pass)

#### Conformance Level
This test validates a **SHALL** requirement, meaning any failure constitutes a conformance violation that must be addressed for US Core compliance.

---

<a id='req-576'></a>

### REQ-576: Security label constraints for contained resources

**Text**: 

**Context**: Applies to contained resources within an Observation; confirm no security labels are present on contained resources.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-576

## 1. Requirement ID
**REQ-576**: Security label constraints for contained resources

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be fully automated through FHIRPath validation and instance inspection. The requirement explicitly mentions automated instance validation using FHIRPath invariant, making it ideal for programmatic testing.

### Complexity
**Simple** - The test involves checking for the absence of security labels on contained resources within Observation instances. This is a straightforward validation that can be performed through resource traversal and property inspection.

### Prerequisites
- System must support US Core Observation profiles
- System must be capable of returning Observation resources that may contain contained resources
- Test framework must support FHIRPath expression evaluation
- Access to Observation instances with contained resources (if any exist in the test dataset)

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Any Observation resources from the system under test that contain contained resources
- **Data Source**: System's existing Observation data (bring-your-own-data approach)
- **No specific fixtures required**: Test should work with whatever Observation data the system provides

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and should be used:

1. **Search Operations**:
   - `GET [base]/Observation` - Retrieve Observation resources
   - `GET [base]/Observation?[parameters]` - Search for specific Observations if needed
   
2. **Read Operations**:
   - `GET [base]/Observation/[id]` - Retrieve specific Observation instances

### Validation Criteria

#### Primary Validation
For each Observation resource retrieved from the system:

1. **Identify Contained Resources**:
   - Use FHIRPath: `Observation.contained` to locate all contained resources
   - If no contained resources exist, test passes for that Observation

2. **Security Label Validation**:
   - For each contained resource, validate using FHIRPath: `Observation.contained.meta.security.empty()`
   - Alternative FHIRPath expression: `Observation.contained.where(meta.security.exists()).empty()`

#### Specific Test Assertions

**PASS Conditions**:
- All Observation resources have no contained resources with security labels
- FHIRPath expression `Observation.contained.meta.security.empty()` evaluates to `true` for all contained resources
- If an Observation has no contained resources, it automatically passes this test

**FAIL Conditions**:
- Any contained resource within an Observation has `meta.security` populated
- FHIRPath expression `Observation.contained.where(meta.security.exists())` returns any results

#### Implementation Details

**Test Execution Steps**:
1. Query the system for Observation resources using supported search operations
2. For each returned Observation:
   - Check if `contained` element exists and is not empty
   - If contained resources exist, evaluate the FHIRPath invariant
   - Record validation results

**Result Reporting**:
- **Overall Result**: PASS if all tested Observations comply, FAIL if any violation is found
- **Detailed Results**: List each Observation tested and its compliance status
- **Violation Details**: For any failures, identify the specific contained resource and security label that caused the violation

**Edge Cases to Consider**:
- Observations with no contained resources (should pass)
- Observations with contained resources but no meta elements (should pass)
- Observations with contained resources having meta elements but no security labels (should pass)
- Empty security arrays (should be treated as no security labels present)

This test specification ensures compliance with the SHALL requirement that contained resources within Observations must not have security labels, supporting the system's conformance to the US Core implementation guide requirements.

---

<a id='req-577'></a>

### REQ-577: Narrative requirement for resources

**Text**: 

**Context**: Applies to Observation resources; verify presence of narrative (text.div).

**Actor**: System

**Conformance**: SHOULD

# Test Specification for REQ-577: Narrative Requirement for Resources

## 1. Requirement ID
REQ-577

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified through automated instance validation by checking for the presence of the `text.div` element in Observation resources.

### Complexity
**Simple** - The test involves a straightforward structural validation of a single element within FHIR resources.

### Prerequisites
- System must support at least one US Core Observation profile as indicated in the Capability Statement
- System must be able to return Observation resources in response to queries
- Test client must have appropriate authentication/authorization to access Observation resources

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Any existing Observation resources in the system under test that conform to supported US Core Observation profiles (as listed in the Capability Statement):
  - US Core Laboratory Result Observation Profile
  - US Core Vital Signs Profile
  - US Core Blood Pressure Profile
  - US Core Body Weight Profile
  - US Core Body Height Profile
  - US Core BMI Profile
  - US Core Heart Rate Profile
  - US Core Respiratory Rate Profile
  - US Core Body Temperature Profile
  - US Core Pulse Oximetry Profile
  - US Core Smoking Status Observation Profile
  - And other supported US Core Observation profiles

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for Observation resources:
- **GET /Observation/{id}** - Read specific Observation instances
- **GET /Observation?patient={patient-id}** - Search for Observations by patient
- **GET /Observation?category={category}** - Search for Observations by category
- **GET /Observation?code={code}** - Search for Observations by code
- **GET /Observation?patient={patient-id}&category={category}** - Combined search parameters

### Validation Criteria

#### Primary Test Cases

**Test Case 1: Direct Resource Retrieval**
1. Execute GET operations to retrieve individual Observation resources using supported search parameters
2. For each retrieved Observation resource:
   - **Assertion**: Verify that `resource.text` exists
   - **Assertion**: Verify that `resource.text.div` exists and is not null/empty
   - **Assertion**: Verify that `resource.text.div` contains valid XHTML content

**Test Case 2: Search-Based Resource Validation**
1. Execute search operations using supported search parameters (patient, category, code combinations)
2. For each Observation resource in the search results:
   - **Assertion**: Verify that `resource.text` exists
   - **Assertion**: Verify that `resource.text.div` exists and is not null/empty
   - **Assertion**: Verify that `resource.text.div` contains valid XHTML content

#### Conformance Validation
Since this is a **SHOULD** requirement:
- **Pass Criteria**: The majority of Observation resources contain the `text.div` element
- **Reporting**: Document any instances where `text.div` is missing, but do not fail the overall test suite
- **Advisory**: Generate warnings for missing narrative content rather than hard failures

#### Technical Validation Details
- **Structure Check**: `text.div` must be present as a direct child of the `text` element
- **Content Check**: The `div` element should contain meaningful XHTML content (not just empty tags)
- **XHTML Validation**: The content within `text.div` should be valid XHTML fragment
- **Encoding Check**: Ensure proper XML escaping within the narrative content

#### Expected Test Results
- **Success**: Test passes if narrative elements are present in retrieved Observation resources
- **Warning**: Generate advisory messages for resources missing narrative content
- **Failure**: Only fail if the system cannot retrieve Observation resources or returns malformed responses
- **Metrics**: Report percentage of resources with compliant narrative content for informational purposes

This test specification accommodates a "bring your own data" approach by working with whatever Observation resources exist in the system under test, using the search capabilities defined in the Capability Statement to discover and validate those resources.

---

<a id='req-578'></a>

### REQ-578: Data absent reason constraint

**Text**: 

**Context**: Applies to Observation.value[x] and Observation.dataAbsentReason; enforce mutual exclusivity.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-578

## Requirement ID
REQ-578

## Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be validated through automated instance validation using FHIRPath invariants as specified in the requirement.

### Complexity
**Simple** - The requirement involves checking mutual exclusivity between two specific elements using a straightforward logical constraint.

### Prerequisites
- FHIR server implementing US Core profiles that include Observation resources
- Test system capable of executing FHIRPath expressions
- Access to Observation instances with varying combinations of `value[x]` and `dataAbsentReason` elements

## Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Observation resources conforming to any US Core Observation profiles (as listed in the Capability Statement section 14.3.3.20)
- Test data should include Observation instances with the following scenarios:
  - Observations with `value[x]` present and `dataAbsentReason` absent
  - Observations with `value[x]` absent and `dataAbsentReason` present
  - Observations with both `value[x]` and `dataAbsentReason` present (invalid case)
  - Observations with neither `value[x]` nor `dataAbsentReason` present (invalid case unless component observations exist)

**Expected Outputs:**
- Validation results indicating conformance or non-conformance
- Specific error messages when mutual exclusivity constraint is violated

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for Observation resources:
- `GET [base]/Observation/[id]` - To retrieve individual Observation instances for validation
- `GET [base]/Observation?[search-parameters]` - To search for Observation resources meeting specific criteria

### Validation Criteria

**Primary Assertion:**
The FHIRPath invariant must enforce mutual exclusivity between `Observation.value[x]` and `Observation.dataAbsentReason`. The specific validation checks include:

1. **Valid Cases (Should Pass):**
   - `Observation.value[x]` is present AND `Observation.dataAbsentReason` is absent
   - `Observation.value[x]` is absent AND `Observation.dataAbsentReason` is present
   - `Observation.value[x]` is absent AND `Observation.dataAbsentReason` is absent BUT `Observation.component` exists with valid component observations

2. **Invalid Cases (Should Fail):**
   - `Observation.value[x]` is present AND `Observation.dataAbsentReason` is present simultaneously
   - Both `Observation.value[x]` and `Observation.dataAbsentReason` are absent AND no valid component observations exist

**Test Execution Steps:**
1. Retrieve Observation resources from the test system using supported search operations
2. Apply FHIRPath invariant validation to each Observation instance
3. Verify that the constraint properly identifies violations of mutual exclusivity
4. Confirm that valid combinations pass validation without errors

**Expected FHIRPath Expression Pattern:**
The invariant should evaluate to a pattern similar to:
`(value.exists() and dataAbsentReason.exists()).not()`

**Success Criteria:**
- All Observation instances with only `value[x]` present pass validation
- All Observation instances with only `dataAbsentReason` present pass validation
- All Observation instances with both `value[x]` and `dataAbsentReason` present fail validation with appropriate error messages
- The validation system correctly identifies and reports constraint violations
- No false positives or false negatives in constraint enforcement

---

<a id='req-579'></a>

### REQ-579: Observation code and component code constraint

**Text**: 

**Context**: Applies to Observation resources with components; prevent duplicative value when top-level code matches a component code.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-579

## 1. Requirement ID
REQ-579

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated through automated FHIRPath evaluation against Observation resources with components.

### Complexity
**Moderate** - The test requires:
- FHIRPath expression evaluation
- Comparison logic between top-level code and component codes
- Understanding of code equivalence across different coding systems

### Prerequisites
- System must support US Core Observation profiles (as indicated in Capability Statement)
- Test data must include Observation resources with components
- System must support read operations on Observation resources
- Access to Observation resources that contain both top-level code and component.code elements

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources Needed:**
- Observation resources with:
  - Populated `Observation.code` element
  - At least one `Observation.component` with populated `component.code` element
  - Mix of scenarios where codes match and don't match between top-level and component codes

**Data Requirements:**
- Observations with various coding systems (LOINC, SNOMED-CT, etc.)
- Observations where component codes may duplicate the top-level code
- Observations where component codes are distinct from the top-level code

### Required FHIR Operations
Based on the Capability Statement, the following supported operations will be used:

1. **Read Operation:** `GET [base]/Observation/[id]`
   - Supported as SHALL requirement in Capability Statement
   - Used to retrieve individual Observation resources for validation

2. **Search Operations:** `GET [base]/Observation?patient=[patient-id]`
   - Supported as SHALL requirement with patient parameter
   - Used to retrieve sets of Observation resources for comprehensive testing

### Validation Criteria

**Primary Validation Rule:**
For each Observation resource with components, verify that no component.code is equivalent to the top-level Observation.code.

**FHIRPath Expression:**
```
Observation.where(component.exists()).select(
  code.coding.code + code.coding.system + code.text
).intersect(
  component.code.coding.code + component.code.coding.system + component.code.text
).empty()
```

**Specific Validation Checks:**

1. **Code System Matching:**
   - Compare `Observation.code.coding.system` with `Observation.component.code.coding.system`
   - Compare `Observation.code.coding.code` with `Observation.component.code.coding.code`
   - Fail if same system and code combination exists in both locations

2. **Text Matching (if codes are not present):**
   - Compare `Observation.code.text` with `Observation.component.code.text`
   - Fail if identical text values exist in both locations

3. **Cross-System Code Equivalence:**
   - Check for known equivalent codes across different coding systems
   - Apply appropriate concept mapping when available

**Test Execution Steps:**

1. **Discovery Phase:**
   - Query for Observation resources using patient search parameter
   - Filter results to include only Observations with components: `component.exists() = true`

2. **Validation Phase:**
   - For each Observation with components:
     - Extract top-level code information (system, code, text)
     - Extract all component code information
     - Compare for duplicative values using the criteria above
     - Record any violations

3. **Result Assessment:**
   - **PASS:** No Observation resources contain duplicative codes between top-level and component levels
   - **FAIL:** One or more Observation resources contain duplicative codes
   - **NOT APPLICABLE:** No Observation resources with components found in test data

**Expected Assertions:**
- Assert that FHIRPath evaluation returns `true` for all Observations with components
- Assert that no code equivalence exists between `Observation.code` and any `Observation.component.code`
- Assert that validation messages clearly identify any violations with resource ID and specific codes involved

**Error Reporting:**
When violations are found, the test should report:
- Resource ID of the non-conformant Observation
- The duplicative code details (system, code, display)
- Location of duplication (top-level vs specific component index)

This test specification ensures comprehensive validation of the constraint while accommodating various coding systems and real-world data scenarios that implementers may encounter.

---

<a id='req-580'></a>

### REQ-580: Component or hasMember element constraint

**Text**: 

**Context**: Applies to Observation resources; ensures presence of a value or dataAbsentReason when neither components nor hasMembers exist.

**Actor**: System

**Conformance**: MUST

# REQ-580 Test Specification

## 1. Requirement ID
REQ-580

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be fully automated through FHIRPath invariant validation and structural analysis of Observation resources.

### Complexity
**Simple** - The requirement involves a straightforward structural validation of Observation resources to check the presence of specific elements based on conditional logic.

### Prerequisites
- System must support US Core Observation profiles as indicated in the Capability Statement
- Access to Observation resources through FHIR RESTful API
- Capability to retrieve and validate Observation instances
- FHIR validation engine supporting FHIRPath invariants

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources conforming to any of the US Core Observation profiles listed in the Capability Statement
- **Test Data**: Existing Observation resources from the system under test (bring your own data approach)
- **Validation Engine**: FHIR validator capable of executing FHIRPath expressions

### Expected Outputs
- **Validation Results**: Pass/fail status for each Observation resource tested
- **Conformance Report**: Summary of compliance with the constraint across all tested resources
- **Error Details**: Specific FHIRPath validation messages for non-conformant resources

### Required FHIR Operations
Based on the Capability Statement, the following supported operations will be used:

1. **Search Operations** (supported for Observation):
   - `GET [base]/Observation?patient=[id]` - Retrieve Observations for testing
   - `GET [base]/Observation?category=[category]` - Retrieve specific categories of Observations
   - `GET [base]/Observation?code=[code]` - Retrieve Observations by specific codes

2. **Read Operations**:
   - `GET [base]/Observation/[id]` - Retrieve individual Observation resources for validation

### Validation Criteria

The test must verify the following FHIRPath invariant for each Observation resource:

**Primary Constraint**: When an Observation has neither `component` nor `hasMember` elements, it MUST have either a `value[x]` or `dataAbsentReason`.

**FHIRPath Expression**:
```
(component.empty() and hasMember.empty()) implies (value.exists() or dataAbsentReason.exists())
```

**Specific Validation Checks**:

1. **Structure Analysis**:
   - Identify Observations without `component` elements (`component.empty() = true`)
   - Identify Observations without `hasMember` elements (`hasMember.empty() = true`)

2. **Value Presence Validation**:
   - For Observations meeting criteria in step 1, verify presence of `value[x]` element OR `dataAbsentReason` element
   - Accept any valid `value[x]` variant (valueQuantity, valueCodeableConcept, valueString, etc.)

3. **Pass Criteria**:
   - **PASS**: Observation has `component` elements present, OR
   - **PASS**: Observation has `hasMember` elements present, OR  
   - **PASS**: Observation has neither `component` nor `hasMember` but contains `value[x]`, OR
   - **PASS**: Observation has neither `component` nor `hasMember` but contains `dataAbsentReason`

4. **Fail Criteria**:
   - **FAIL**: Observation has neither `component` nor `hasMember` elements AND lacks both `value[x]` and `dataAbsentReason`

**Test Execution Approach**:
- Retrieve Observation resources using supported search parameters
- Apply FHIRPath invariant validation to each resource
- Generate conformance report indicating pass/fail status
- Document any non-conformant instances with specific details about missing elements

**Coverage Consideration**:
The test should aim to validate against all US Core Observation profiles supported by the system, including vital signs, laboratory results, clinical observations, and specialty observations as listed in the Capability Statement.

---

<a id='req-581'></a>

### REQ-581: Observation status codes requirement

**Text**: 

**Context**: Applies to Observation.status; enforce required binding to ObservationStatus value set.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-581

## 1. Requirement ID
**REQ-581**: Observation status codes requirement

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated validation of terminology bindings against the ObservationStatus value set.

### Complexity
**Simple** - The requirement involves straightforward validation of a single element's value against a well-defined FHIR value set.

### Prerequisites
- System under test must implement US Core Server capabilities for Observation resources
- System must support Observation resource creation, retrieval, or search operations
- Access to ObservationStatus value set (http://hl7.org/fhir/ValueSet/observation-status)
- Test data containing Observation resources with various status values

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Observation resources from the system under test containing populated `status` elements
- Resources may be obtained through any supported method (search, read, create operations)

**Expected Outputs:**
- Validation results confirming all Observation.status values conform to the required ObservationStatus value set
- Clear pass/fail indication for conformance to the required binding

### Required FHIR Operations
Based on US Core Server CapabilityStatement, the following operations can be used to obtain Observation resources for testing:

1. **Search Operations** (if supported by the system):
   - `GET [base]/Observation?patient={id}`
   - `GET [base]/Observation?category={category}`
   - `GET [base]/Observation?code={code}`

2. **Read Operations** (if specific Observation IDs are known):
   - `GET [base]/Observation/{id}`

3. **Create Operations** (for systems supporting write operations):
   - `POST [base]/Observation` (to test validation during resource creation)

### Validation Criteria

**Primary Assertions:**
1. **Value Set Compliance**: Every `Observation.status` value MUST be a valid code from the ObservationStatus value set
   - Valid codes include: `registered`, `preliminary`, `final`, `amended`, `corrected`, `cancelled`, `entered-in-error`, `unknown`

2. **Required Binding Enforcement**: Systems SHALL reject or flag Observation resources with invalid status codes
   - Test by attempting to create/update Observations with invalid status values (if write operations are supported)
   - Verify appropriate error responses (HTTP 400/422 with OperationOutcome)

**Test Cases:**

**Test Case 1: Valid Status Validation**
- **Objective**: Verify all existing Observation.status values are valid
- **Method**: Retrieve Observation resources and validate each status value
- **Pass Criteria**: All status values are members of the ObservationStatus value set

**Test Case 2: Invalid Status Rejection** (if write operations supported)
- **Objective**: Verify system rejects invalid status codes
- **Method**: Attempt to create/update Observation with invalid status (e.g., "invalid-status")
- **Pass Criteria**: System returns appropriate error response and does not persist invalid data

**Test Case 3: Terminology Server Validation**
- **Objective**: Confirm proper terminology validation implementation
- **Method**: Use FHIR terminology services to validate status codes
- **Pass Criteria**: System demonstrates consistent validation behavior with standard terminology services

**Assertion Results for Test Success:**
- **PASS**: All Observation.status values conform to required value set binding
- **FAIL**: Any Observation.status contains values outside the ObservationStatus value set
- **FAIL**: System accepts invalid status codes when binding should be enforced

**Additional Validation Points:**
- Verify status codes are properly formatted (lowercase, hyphen-separated where applicable)
- Confirm system handles edge cases appropriately (empty values, null handling)
- Validate consistency across different API operations (search results vs. direct reads)

---

<a id='req-582'></a>

### REQ-582: Observation category codes preference

**Text**: 

**Context**: Applies to Observation.category; preferred binding to ObservationCategoryCodes.

**Actor**: System

**Conformance**: SHOULD

# Test Specification for REQ-582

## 1. Requirement ID
REQ-582

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be tested through automated terminology validation by examining `Observation.category` values and verifying they conform to the preferred binding to ObservationCategoryCodes.

### Complexity
**Simple** - The test involves straightforward terminology validation against a known value set with preferred binding strength.

### Prerequisites
- System must support US Core Observation profiles as indicated in the Capability Statement
- System must have Observation resources available for testing
- Access to ObservationCategoryCodes value set for validation
- System must support the search operations for Observation resources as defined in the Capability Statement

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Observation resources conforming to any of the supported US Core Observation profiles listed in the Capability Statement
- The test should work with existing Observation data in the system being tested

**Expected Outputs:**
- List of Observation resources with their category codes
- Validation report indicating conformance status for each category code
- Summary of preferred binding compliance

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and should be used:

1. **Search Operations:**
   - `GET [base]/Observation?patient=[patient-id]&category=[category-code]` - to retrieve Observations by category
   - `GET [base]/Observation?patient=[patient-id]` - to retrieve all Observations for validation

2. **Read Operations:**
   - `GET [base]/Observation/[id]` - to retrieve specific Observation resources for detailed validation

### Validation Criteria

**Primary Assertions:**
1. **Category Presence Validation:**
   - Each Observation resource SHOULD have at least one `Observation.category` element populated
   - Document any Observation resources missing category codes

2. **Preferred Binding Validation:**
   - For each `Observation.category` code present:
     - Check if the code exists in the ObservationCategoryCodes value set
     - If code is from ObservationCategoryCodes: Mark as PREFERRED CONFORMANT
     - If code is from outside ObservationCategoryCodes: Mark as ACCEPTABLE (preferred binding allows other codes)
   - Calculate percentage of category codes that use preferred codes from ObservationCategoryCodes

3. **Code System Validation:**
   - Verify that category codes include both `system` and `code` values where possible
   - Validate that the code system URIs are resolvable and appropriate

4. **Reporting Requirements:**
   - Generate a report showing:
     - Total number of Observation resources examined
     - Number and percentage using ObservationCategoryCodes (preferred)
     - Number and percentage using other valid codes
     - List of any invalid or unresolvable codes
     - Specific code systems and codes used outside of the preferred value set

**Success Criteria:**
- **PASS:** System demonstrates support for ObservationCategoryCodes as the preferred binding, with clear reporting of usage patterns
- **CONDITIONAL PASS:** System uses valid category codes but primarily from outside ObservationCategoryCodes (acceptable due to preferred binding)
- **FAIL:** System uses invalid category codes or fails to provide adequate category coding

**Additional Validation:**
- Verify that the system can search Observations by category using codes from ObservationCategoryCodes
- Confirm that category codes are consistent with the specific US Core Observation profile being used
- Validate that multiple category codes per Observation (if present) are all appropriately coded

**Conformance Level:**
Since this is a SHOULD requirement with preferred binding, the test should focus on measuring and reporting compliance rather than strict pass/fail criteria. The key outcome is demonstrating that the system recognizes and prefers ObservationCategoryCodes while still accepting other valid terminology.

---

<a id='req-583'></a>

### REQ-583: Observation code binding

**Text**: 

**Context**: Applies to Observation.code; extensible binding to VSAC Vital Sign Result Type.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-583: Observation Code Binding

## 1. Requirement ID
REQ-583

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be automated through terminology validation against the VSAC Vital Sign Result Type value set with extensible binding semantics. Manual attestation is required only when codes fall outside the specified value set.

### Complexity
**Moderate** - The test requires:
- Automated terminology validation against VSAC value sets
- Understanding of extensible binding semantics (codes outside the value set are acceptable if they represent the same concept)
- Conditional manual attestation workflow for non-conforming codes

### Prerequisites
- Access to VSAC (Value Set Authority Center) terminology services or local terminology server with VSAC content
- US Core Server implementing Observation resource support
- Test system capable of FHIR terminology validation
- Manual review process for codes outside the bound value set

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Observation resources with populated `Observation.code` elements
- Mix of observations that should include:
  - Vital sign observations with codes from the VSAC Vital Sign Result Type value set
  - Vital sign observations with codes outside the value set but semantically equivalent
  - Non-vital sign observations (to verify appropriate scoping)

**Expected Outputs:**
- Validation results indicating conformance status for each Observation.code
- List of codes requiring manual attestation (those outside the value set)
- Attestation documentation for manually reviewed codes

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are supported and required:

1. **GET /Observation** - Retrieve observation resources for testing
2. **GET /Observation/{id}** - Retrieve specific observation instances
3. **Terminology validation operations** (if supported by server):
   - **GET /$validate-code** - Validate codes against the VSAC value set
   - **GET /ValueSet/$expand** - Expand the VSAC Vital Sign Result Type value set

### Validation Criteria

#### Automated Validation Assertions:
1. **Value Set Membership Check:**
   - For each `Observation.code`, verify if the code exists in the VSAC Vital Sign Result Type value set
   - **PASS:** Code is found in the value set
   - **CONDITIONAL:** Code is not in value set but test proceeds to extensible binding evaluation

2. **Extensible Binding Semantics Validation:**
   - For codes not in the value set, validate that they represent concepts that could reasonably be considered vital signs
   - **PASS:** Code represents a vital sign concept (extensible binding allows this)
   - **REQUIRES MANUAL ATTESTATION:** Code does not clearly represent a vital sign concept

3. **Code System Validation:**
   - Verify that `Observation.code.system` is a valid, resolvable URI
   - Verify that `Observation.code.code` is a valid code within the specified system
   - **PASS:** Code system and code are valid and resolvable

#### Manual Attestation Criteria:
For codes flagged as requiring manual review:

1. **Semantic Equivalence Assessment:**
   - Human reviewer validates that the code represents a vital sign measurement
   - Document rationale for acceptance or rejection
   - **PASS:** Code is semantically appropriate for vital signs context
   - **FAIL:** Code does not represent a vital sign concept

2. **Clinical Context Validation:**
   - Verify the code is being used in an appropriate clinical context
   - Confirm the code provides meaningful interoperability value
   - **PASS:** Code usage is clinically appropriate and supports interoperability

#### Overall Test Results:
- **PASS:** All Observation.code elements either:
  - Are found in the VSAC Vital Sign Result Type value set, OR
  - Are outside the value set but have been manually attested as semantically appropriate
- **FAIL:** Any Observation.code element:
  - Uses an invalid code system or malformed code, OR
  - Is outside the value set and fails manual attestation as inappropriate for vital signs context

#### Test Reporting Requirements:
1. Summary count of codes tested
2. Count of codes directly conforming to value set
3. Count of codes requiring and passing manual attestation
4. List of any non-conforming codes with failure reasons
5. Documentation of manual attestation decisions and rationale

---

<a id='req-584'></a>

### REQ-584: Observation effective time precision

**Text**: 

**Context**: Applies when Observation.effective[x] is dateTime; enforce minimum precision to day.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-584

## 1. Requirement ID
**REQ-584**: Observation effective time precision

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be fully automated using FHIRPath expressions to validate the precision of dateTime values in Observation.effective[x] elements.

### Complexity
**Simple** - The requirement involves a straightforward validation of dateTime precision using standard FHIRPath operations.

### Prerequisites
- System must support US Core Observation profiles
- System must have Observation resources with effective[x] elements populated as dateTime
- Test system must support FHIRPath evaluation capabilities
- Access to a FHIR server implementing the US Core Server CapabilityStatement

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Observation resources where `Observation.effective[x]` is of type `dateTime`
- Resources should represent the full range of Observation types supported by the system under test

**Expected Outputs:**
- Validation results indicating whether each dateTime value meets minimum day precision
- Clear pass/fail status for each evaluated Observation resource

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are supported and required for testing:

1. **GET [base]/Observation/[id]** - Retrieve individual Observation resources
2. **GET [base]/Observation** - Search for Observation resources with various parameters
3. **GET [base]/Patient/[id]/Observation** (if supported) - Retrieve Observations for specific patients

### Validation Criteria

#### Primary Validation Rule
For each Observation resource where `effective[x]` is of type `dateTime`:

**FHIRPath Expression:**
```
Observation.effective.where($this is dateTime).all(toString().matches('\\d{4}-\\d{2}-\\d{2}(T.*)?'))
```

**Alternative FHIRPath Expression:**
```
Observation.effective.where($this is dateTime).all(toString().length() >= 10)
```

#### Specific Assertions

1. **Minimum Precision Check:**
   - ASSERTION: All `Observation.effective` values of type `dateTime` SHALL have at least day-level precision (YYYY-MM-DD format)
   - PASS CONDITION: The dateTime string contains at least year, month, and day components
   - FAIL CONDITION: The dateTime string has only year or year-month precision

2. **Format Validation:**
   - ASSERTION: DateTime values follow ISO 8601 format with minimum day precision
   - PASS CONDITION: Pattern matches `YYYY-MM-DD` optionally followed by time components
   - FAIL CONDITION: Pattern matches only `YYYY` or `YYYY-MM` formats

3. **Data Type Verification:**
   - ASSERTION: Only dateTime instances of effective[x] are subject to this precision requirement
   - PASS CONDITION: Validation only applies when `effective[x]` is specifically of type `dateTime`
   - FAIL CONDITION: Test incorrectly evaluates other effective[x] types (Period, Timing, instant)

#### Test Execution Steps

1. **Resource Discovery:**
   - Query the system for available Observation resources using supported search parameters
   - Filter for resources where `effective[x]` is populated with dateTime values

2. **Precision Validation:**
   - Apply the FHIRPath expression to each qualifying Observation resource
   - Document any resources that fail the minimum day precision requirement

3. **Result Compilation:**
   - Generate a summary report showing:
     - Total number of Observation resources evaluated
     - Number of resources with compliant dateTime precision
     - Number of resources with non-compliant dateTime precision
     - Specific examples of non-compliant values (if any)

#### Expected Test Outcomes

**PASS Criteria:**
- All Observation resources with `effective[x]` as dateTime demonstrate minimum day-level precision
- FHIRPath validation returns `true` for all evaluated resources

**FAIL Criteria:**
- One or more Observation resources have `effective[x]` dateTime values with precision less than day level
- FHIRPath validation returns `false` for any evaluated resource

**Edge Cases to Consider:**
- Resources with multiple effective[x] values (if allowed by profile)
- Timezone specifications in dateTime values
- Resources where effective[x] uses other data types (should be excluded from validation)

---

<a id='req-585'></a>

### REQ-585: Observation value type requirement

**Text**: 

**Context**: Applies to Observation.value[x]; requires a single value of type PQ (Quantity in FHIR).

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-585

## Requirement ID
REQ-585: Observation value type requirement

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated through automated instance validation by examining the Observation resource structure and verifying the value[x] element conforms to the specified constraints.

### Complexity
**Simple** - The requirement has clear, specific constraints that can be verified through straightforward structural validation of FHIR resources.

### Prerequisites
- Access to a FHIR server implementing US Core Observation profiles
- Observation resources with value[x] elements present in the test data
- FHIR validation capabilities to check resource structure and data types

## Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Observation resources that implement any of the US Core Observation profiles listed in the Capability Statement, including:
  - US Core Laboratory Result Observation Profile
  - US Core Vital Signs Profile  
  - US Core Simple Observation Profile
  - Any other US Core Observation profiles that utilize quantitative measurements

**Expected Outputs:**
- Validation results confirming value[x] element compliance
- Clear pass/fail status for each tested Observation resource

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for Observation resources:

1. **READ Operation**: `GET [base]/Observation/[id]`
   - Retrieve individual Observation resources for validation

2. **SEARCH Operation**: `GET [base]/Observation?[parameters]`
   - Search parameters supported include:
     - `patient` (to retrieve Observations for specific patients)
     - `category` (to filter by observation category)
     - `code` (to filter by specific observation types)
     - `date` (to filter by observation date)
     - `status` (to filter by observation status)

### Validation Criteria

**Primary Assertions:**

1. **Value Element Presence Check**
   - Verify that when Observation.value[x] is present, it contains exactly one value
   - Assert cardinality constraint: value[x] 0..1 (single value only)

2. **Data Type Validation**
   - Verify that Observation.value[x], when present, uses the valueQuantity data type (FHIR equivalent of PQ/Quantity)
   - Reject Observations that use other value[x] variants (valueString, valueCodeableConcept, etc.) when the profile requires Quantity

3. **Quantity Structure Validation**
   - When valueQuantity is present, verify it contains valid Quantity elements:
     - Numeric value (Quantity.value)
     - Appropriate unit of measure (Quantity.unit and/or Quantity.code)
     - Valid system for units (Quantity.system) when coded units are used

**Test Cases:**

**Test Case 1: Valid Single Quantity Value**
- **Input**: Observation with valueQuantity containing valid numeric value and unit
- **Expected Result**: PASS - Resource validates successfully
- **Assertion**: value[x] element contains exactly one valueQuantity with proper structure

**Test Case 2: Missing Value Element**
- **Input**: Observation without any value[x] element
- **Expected Result**: PASS - Valid since cardinality is 0..1
- **Assertion**: Absence of value[x] is acceptable per cardinality constraint

**Test Case 3: Multiple Value Elements**
- **Input**: Observation with multiple value[x] elements or array values
- **Expected Result**: FAIL - Violates single value constraint
- **Assertion**: Only one value[x] element should be present

**Test Case 4: Wrong Data Type**
- **Input**: Observation with value[x] using non-Quantity type (e.g., valueString)
- **Expected Result**: FAIL - When Quantity is required by the profile
- **Assertion**: value[x] must be of type Quantity (valueQuantity) per requirement

**Test Case 5: Invalid Quantity Structure**
- **Input**: Observation with valueQuantity missing required sub-elements
- **Expected Result**: FAIL - Incomplete Quantity structure
- **Assertion**: valueQuantity must contain valid numeric value and appropriate unit information

**Pass Criteria:**
- All Observation resources with value[x] elements contain exactly one value of type Quantity
- Quantity values have valid structure with numeric values and appropriate units
- No Observation resources violate the single value constraint
- Profile-specific constraints for different US Core Observation types are respected

**Fail Criteria:**
- Any Observation contains multiple value[x] elements
- Any Observation uses incorrect data type for value[x] when Quantity is required
- Any valueQuantity lacks required structural components
- Any validation errors related to value[x] cardinality or type constraints

---

<a id='req-586'></a>

### REQ-586: Observation value system requirement

**Text**: 

**Context**: Applies to Observation.valueQuantity.system; must be fixed to UCUM system.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-586

## 1. Requirement ID
**REQ-586**: Observation value system requirement

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be validated through automated instance validation by checking that the `Observation.valueQuantity.system` field contains the fixed UCUM system URI.

### Complexity
**Simple** - This is a straightforward fixed value validation requiring a single field check against a known constant.

### Prerequisites
- System must support Observation resources with valueQuantity elements
- System must be capable of retrieving Observation resources via FHIR API
- Test data must include Observation resources that contain valueQuantity elements

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources containing `valueQuantity` elements
- **Expected System URI**: `http://unitsofmeasure.org` (UCUM system)
- **Test Data**: Any Observation resources from the system under test that include quantitative measurements

### Required FHIR Operations
Based on the US Core Server Capability Statement, the following operations are supported and can be used for testing:

1. **GET /Observation** - Search for Observation resources
2. **GET /Observation/[id]** - Read specific Observation resources by ID
3. **GET /Patient/[id]/Observation** - Search for Observations for a specific patient

### Validation Criteria

#### Test Case 1: Direct Resource Validation
**Objective**: Validate that all Observation resources with valueQuantity have the correct system URI

**Test Steps**:
1. Retrieve Observation resources from the system using supported search operations
2. Filter results to include only Observations with `valueQuantity` elements
3. For each Observation with valueQuantity:
   - Extract the `valueQuantity.system` value
   - Verify it equals `http://unitsofmeasure.org`

**Pass Criteria**:
- All Observation resources with valueQuantity MUST have `system` field set to `http://unitsofmeasure.org`
- No Observation with valueQuantity should have a different system URI or missing system field

**Fail Criteria**:
- Any Observation with valueQuantity has `system` field set to a value other than `http://unitsofmeasure.org`
- Any Observation with valueQuantity has missing `system` field
- Any Observation with valueQuantity has null or empty `system` field

#### Test Case 2: Resource Creation/Update Validation (if supported)
**Objective**: Verify system rejects or corrects Observation resources with incorrect system values

**Test Steps** (only if system supports POST/PUT operations):
1. Attempt to create/update an Observation with valueQuantity containing incorrect system URI
2. Verify system response and behavior

**Expected Behavior**:
- System should either reject the resource with appropriate error message, or
- System should automatically correct the system value to the required UCUM URI

#### Assertion Details
For each Observation resource tested:
```
ASSERT Observation.valueQuantity.system == "http://unitsofmeasure.org"
```

#### Error Reporting
For any non-conformant resources, report:
- Resource ID
- Current system value (if any)
- Resource type and profile information
- Specific field path: `Observation.valueQuantity.system`

### Implementation Notes
- This test can be implemented using any FHIR validation library or custom validation logic
- The test should work with any existing Observation data in the system (bring your own data approach)
- Consider testing across different Observation profiles that may use valueQuantity
- The test should handle cases where Observation resources may have multiple value types, focusing only on those with valueQuantity

---

<a id='req-587'></a>

### REQ-587: Observation value code requirement

**Text**: 

**Context**: Applies to Observation.valueQuantity.code; must be fixed to percent.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-587

## 1. Requirement ID
REQ-587

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement specifies a fixed value constraint on a specific FHIR element that can be validated programmatically through automated instance validation.

### Complexity
**Simple** - The requirement involves validating a single fixed value constraint on a well-defined FHIR element path.

### Prerequisites
- System under test must support Observation resources
- System must implement US Core Observation profiles that utilize valueQuantity
- Test data must include Observation resources with valueQuantity elements
- Access to FHIR validation engine or custom validation logic

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Observation resources that contain `Observation.valueQuantity` elements
- The Observation resources should represent various clinical scenarios where percentage values are appropriate (e.g., oxygen saturation, laboratory results expressed as percentages)

**Expected Outputs:**
- Validation results indicating conformance or non-conformance with the fixed value requirement
- Specific error messages for instances where `Observation.valueQuantity.code` is not set to "percent"

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for Observation resources:
- **GET /Observation** - Retrieve Observation resources for validation
- **GET /Observation/{id}** - Retrieve specific Observation instances
- **Search operations** using supported parameters:
  - `GET /Observation?patient={id}` - Retrieve patient-specific observations
  - `GET /Observation?category={category}` - Filter by observation category
  - `GET /Observation?code={code}` - Filter by observation code

### Validation Criteria

#### Primary Validation
For each Observation resource that contains a `valueQuantity` element:

1. **Fixed Value Validation:**
   - Assert that `Observation.valueQuantity.code` exists
   - Assert that `Observation.valueQuantity.code` equals "percent" (exact string match)
   - Verify case sensitivity - the value must be exactly "percent" (lowercase)

#### Secondary Validation
2. **Element Presence Validation:**
   - Verify that when `valueQuantity` is present, the `code` subelement is populated
   - Confirm that the validation applies only to observations using valueQuantity (not other value[x] types)

#### Test Execution Steps
1. **Resource Discovery:** Query the system for Observation resources using supported search parameters
2. **Resource Filtering:** Identify Observation instances that use `valueQuantity` as the value type
3. **Code Validation:** For each filtered Observation:
   - Extract the `valueQuantity.code` value
   - Compare against the required fixed value "percent"
   - Record validation results
4. **Result Aggregation:** Compile pass/fail results for each tested instance

#### Pass Criteria
- **PASS:** All Observation resources with `valueQuantity` elements have `code` set to "percent"
- **PASS:** No Observation resources exist with `valueQuantity.code` set to values other than "percent"

#### Fail Criteria
- **FAIL:** Any Observation resource with `valueQuantity.code` set to a value other than "percent"
- **FAIL:** Any Observation resource with `valueQuantity` present but `code` element missing
- **FAIL:** Any Observation resource with `valueQuantity.code` set to "PERCENT", "%", or other variations (case sensitivity)

#### Edge Cases to Consider
- Observations using other value[x] types (valueString, valueInteger, etc.) should not be subject to this validation
- Empty or null `valueQuantity.code` elements should be flagged as non-conformant
- Unicode or special character variations of "percent" should be flagged as non-conformant

---

<a id='req-588'></a>

### REQ-588: Observation data absent reason binding

**Text**: 

**Context**: Applies to Observation.dataAbsentReason; extensible binding to DataAbsentReason.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-588: Observation Data Absent Reason Binding

## 1. Requirement ID
REQ-588

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated terminology validation using FHIR validation tools and API calls to check binding conformance.

### Complexity
**Moderate** - Requires understanding of FHIR terminology bindings, extensible binding semantics, and the ability to validate codes against value sets.

### Prerequisites
- US Core Server implementing US Core Observation profiles
- Test system with access to FHIR terminology validation capabilities
- Access to DataAbsentReason value set (http://hl7.org/fhir/ValueSet/data-absent-reason)
- Observation resources that include `dataAbsentReason` elements in the test data

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources that contain `Observation.dataAbsentReason` elements
- **Value Set**: DataAbsentReason value set (http://hl7.org/fhir/ValueSet/data-absent-reason)
- **Test Data**: Mix of Observation resources with:
  - Valid codes from the DataAbsentReason value set
  - Valid codes outside the DataAbsentReason value set (to test extensible binding)
  - Invalid codes (for negative testing)

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required for testing:

1. **GET [base]/Observation/[id]** - Retrieve individual Observation resources
2. **GET [base]/Observation?patient=[id]&category=[category]** - Search for Observation resources
3. **GET [base]/ValueSet/$expand** - Expand the DataAbsentReason value set (if ValueSet operations are supported)

### Validation Criteria

#### Automated Terminology Validation Tests

**Test Case 1: Valid DataAbsentReason Codes**
- **Objective**: Verify that Observation resources with valid DataAbsentReason codes are accepted
- **Method**: 
  1. Retrieve Observation resources containing `dataAbsentReason` elements
  2. Validate each `dataAbsentReason.coding.code` against the DataAbsentReason value set
  3. Verify that codes from the core value set are accepted without validation errors
- **Pass Criteria**: All codes present in the DataAbsentReason value set validate successfully

**Test Case 2: Extensible Binding Validation**
- **Objective**: Verify that codes outside the DataAbsentReason value set are handled according to extensible binding semantics
- **Method**:
  1. Identify Observation resources with `dataAbsentReason` codes not in the core DataAbsentReason value set
  2. Validate these codes using FHIR terminology validation
  3. Check that the system accepts valid codes from other appropriate code systems
- **Pass Criteria**: 
  - Codes outside the value set that are valid terminologically are accepted
  - System provides appropriate warnings but not errors for extensible binding violations
  - System maintains semantic meaning for data absent reasons

**Test Case 3: Code System Validation**
- **Objective**: Ensure proper code system usage in dataAbsentReason coding
- **Method**:
  1. Examine `dataAbsentReason.coding.system` values in retrieved Observation resources
  2. Verify that code systems are appropriate for data absent reason concepts
  3. Check for proper use of standard code systems (e.g., http://terminology.hl7.org/CodeSystem/data-absent-reason)
- **Pass Criteria**: Code systems used are appropriate for representing data absent reasons

**Test Case 4: Binding Strength Compliance**
- **Objective**: Verify extensible binding behavior is correctly implemented
- **Method**:
  1. Test with codes that are clearly inappropriate for data absent reasons
  2. Validate server response to codes that violate semantic intent
  3. Check that the server provides appropriate feedback for binding violations
- **Pass Criteria**: 
  - Server accepts semantically appropriate codes even if not in the core value set
  - Server rejects or warns about codes that don't represent data absent reasons
  - Extensible binding semantics are properly enforced

#### Manual Attestation Tests

**Test Case 5: Clinical Appropriateness Review**
- **Objective**: Verify that codes outside the DataAbsentReason value set are clinically appropriate
- **Method**:
  1. Identify all `dataAbsentReason` codes used that are outside the core value set
  2. Manual review of each code for clinical appropriateness in representing data absence
  3. Verify that the semantic intent of "data absent reason" is maintained
- **Pass Criteria**: All codes used appropriately represent reasons why data is absent

**Test Case 6: Documentation Review**
- **Objective**: Ensure proper documentation of extended codes usage
- **Method**:
  1. Review system documentation for handling of dataAbsentReason codes
  2. Verify that any extensions to the core value set are documented
  3. Check that clinical users understand the meaning of extended codes
- **Pass Criteria**: 
  - Clear documentation exists for any codes used outside the core value set
  - Clinical staff can understand and appropriately use extended codes

### Error Handling Validation

**Test Case 7: Invalid Code Handling**
- **Objective**: Verify appropriate handling of invalid dataAbsentReason codes
- **Method**:
  1. Test with obviously invalid codes in `dataAbsentReason` elements
  2. Check server validation response and error messages
  3. Verify that invalid codes are properly rejected or flagged
- **Pass Criteria**: 
  - Invalid codes generate appropriate validation errors
  - Error messages are clear and actionable
  - System maintains data integrity when invalid codes are encountered

### Conformance Verification

**Test Case 8: Profile Compliance Check**
- **Objective**: Ensure dataAbsentReason usage aligns with US Core Observation profile requirements
- **Method**:
  1. Validate Observation resources against relevant US Core Observation profiles
  2. Check that `dataAbsentReason` is used appropriately when observations lack values
  3. Verify conformance with profile constraints on dataAbsentReason usage
- **Pass Criteria**: All Observation resources with dataAbsentReason elements conform to applicable US Core profiles

### Success Metrics
- **Automated Tests**: 100% of valid DataAbsentReason codes validate successfully
- **Extensible Binding**: Appropriate codes outside the core value set are accepted with proper validation feedback
- **Manual Attestation**: All extended codes are clinically appropriate and properly documented
- **Error Handling**: Invalid codes are properly rejected with clear error messages
- **Profile Conformance**: All resources conform to US Core Observation profile requirements for dataAbsentReason usage

---

<a id='req-589'></a>

### REQ-589: Observation interpretation codes binding

**Text**: 

**Context**: Applies to Observation.interpretation; extensible binding to ObservationInterpretationCodes.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-589

## 1. Requirement ID
REQ-589

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated through automated terminology validation using the FHIR Terminology Service operations and by examining the binding strength and value set compliance of Observation.interpretation codes.

### Complexity
**Moderate** - The test involves validating extensible binding semantics, which requires understanding of FHIR terminology binding rules and may involve fallback to manual attestation for codes outside the standard value set.

### Prerequisites
- System must support US Core Observation profiles as indicated in the Capability Statement
- System must have Observation resources with interpretation codes available for testing
- Access to terminology validation services or local value set expansion capabilities
- Understanding of extensible binding semantics (codes should be from the specified value set when applicable concepts exist, but may use other codes when no suitable concept exists)

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Observation resources that contain `interpretation` elements with coded values
- **Value Set**: ObservationInterpretationCodes value set (http://hl7.org/fhir/ValueSet/observation-interpretation)
- **Expected Outputs**: 
  - Validation results indicating conformance with extensible binding rules
  - Manual attestation documentation for any codes outside the value set (if applicable)

### Required FHIR Operations

1. **Search for Observations**: 
   ```
   GET [base]/Observation?patient=[patient-id]
   ```
   (Supported per Capability Statement: SHALL support search-type)

2. **Read Individual Observations**:
   ```
   GET [base]/Observation/[id]
   ```
   (Supported per Capability Statement: SHALL support read)

3. **ValueSet Expansion** (if supported by server):
   ```
   GET [base]/ValueSet/$expand?url=http://hl7.org/fhir/ValueSet/observation-interpretation
   ```

### Validation Criteria

#### Automated Validation Checks

1. **Presence Validation**:
   - Verify that Observation resources with interpretation codes are present in the test dataset
   - Assert that `Observation.interpretation` elements contain properly formatted CodeableConcept values

2. **Terminology Binding Validation**:
   - For each `Observation.interpretation.coding` entry:
     - Check if the code exists in the ObservationInterpretationCodes value set
     - Validate that codes from the standard value set use the correct system URI (http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation)
     - Verify that coding elements include both `system` and `code` components

3. **Extensible Binding Compliance**:
   - **PASS**: If all interpretation codes are from the ObservationInterpretationCodes value set
   - **PASS WITH ATTESTATION**: If some codes are outside the value set, but system can provide justification that no suitable codes exist in the standard value set
   - **FAIL**: If codes outside the value set are used when suitable standard codes are available

4. **Data Quality Checks**:
   - Verify that interpretation codes are clinically appropriate for the observation type
   - Check for proper use of multiple interpretation codes when applicable
   - Validate that text representations are present when using non-standard codes

#### Manual Attestation Requirements

When codes outside the ObservationInterpretationCodes value set are identified:

1. **Documentation Requirements**:
   - System must provide justification for why standard codes were insufficient
   - Document the clinical context requiring non-standard codes
   - Provide mapping or explanation of non-standard codes used

2. **Attestation Process**:
   - Clinical or technical stakeholder must attest that extensible binding semantics are properly understood
   - Confirm that standard codes were evaluated and found unsuitable
   - Verify that non-standard codes provide necessary clinical precision

#### Pass/Fail Criteria

**PASS**:
- All Observation.interpretation codes are from the ObservationInterpretationCodes value set, OR
- Non-standard codes are used only when no suitable standard codes exist, with proper attestation provided
- All codes include proper system and code components
- CodeableConcept structures are properly formatted

**FAIL**:
- Standard codes exist for the clinical concept but non-standard codes are used instead
- Interpretation codes lack required system or code components
- No attestation provided for justified use of non-standard codes
- Improper CodeableConcept structure or formatting

**MANUAL REVIEW REQUIRED**:
- Non-standard codes are present but clinical justification needs expert evaluation
- Complex clinical scenarios where standard code suitability is unclear
- Systems claim technical limitations prevent use of standard codes

---

<a id='req-590'></a>

### REQ-590: Observation component value type requirement

**Text**: 

**Context**: Applies to Observation.component.value[x]; requires a single value of type PQ (Quantity in FHIR).

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-590

## 1. Requirement ID
REQ-590: Observation component value type requirement

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified through automated validation of FHIR instance structure and data types.

### Complexity
**Simple** - The requirement involves straightforward validation of a single element's type and cardinality constraints.

### Prerequisites
- System must support US Core Observation profiles as indicated in the Capability Statement
- Test data must include Observation resources with component elements containing value[x] fields
- System must be capable of creating or retrieving Observation instances with components

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Observation resources that contain `Observation.component` elements
- The Observation resources should conform to one or more of the US Core Observation profiles supported by the system (as listed in the Capability Statement)

**Expected Outputs:**
- Validation results confirming type and cardinality constraints are met
- Error messages for non-conformant instances (if testing negative cases)

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for Observation resources:

**Primary Operations:**
- `GET [base]/Observation/[id]` - Read operation to retrieve Observation instances
- `GET [base]/Observation?[search-parameters]` - Search operation to find Observation resources with components

**Search Parameters (if needed for test data discovery):**
- `patient+category` - To find observations by patient and category
- `patient+code` - To find observations by patient and specific codes
- `patient+category+date` - To find observations within specific timeframes

### Validation Criteria

**Primary Validation Checks:**

1. **Type Validation:**
   - Verify that `Observation.component.value[x]` contains exactly one value
   - Confirm the value is of type Quantity (PQ in FHIR)
   - Validate that no other value[x] types are present simultaneously

2. **Cardinality Validation:**
   - Ensure each `Observation.component` element contains exactly one `value[x]` element when a value is present
   - Verify that multiple value types are not populated simultaneously

3. **Structure Validation:**
   - Confirm that when `Observation.component.valueQuantity` is present, it contains valid Quantity structure with:
     - Numeric value
     - Unit of measure (when applicable)
     - System and code for the unit (when structured units are used)

**Test Assertions for Passing Results:**

**For Conformant Instances:**
- `Observation.component.valueQuantity` is present and properly structured
- No other `value[x]` variants (valueString, valueBoolean, etc.) are present in the same component
- Quantity value contains valid numeric data
- Component structure adheres to US Core profile requirements

**For Non-Conformant Instances (if testing validation):**
- System properly rejects or flags instances with multiple value[x] types
- System identifies missing value when required
- System validates Quantity structure according to FHIR base specifications

**Implementation Notes:**
- Tests should work with any valid Observation data containing components with quantity values
- Focus on structural validation rather than clinical content validation
- Ensure tests cover various US Core Observation profiles that may use component values
- Validation should occur at both the FHIR resource level and the profile-specific level

---

<a id='req-591'></a>

### REQ-591: Observation component data absent reason binding

**Text**: 

**Context**: Applies to Observation.component.dataAbsentReason; extensible binding to DataAbsentReason.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-591

## 1. Requirement ID
REQ-591: Observation component data absent reason binding

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - The requirement specifies an extensible binding to the DataAbsentReason value set for `Observation.component.dataAbsentReason`, which can be validated through automated terminology validation. Manual attestation is only required if codes are used outside the value set.

### Complexity
**Moderate** - The test involves:
- Retrieving Observation resources with component data
- Validating terminology bindings with extensible semantics
- Handling cases where codes may be outside the defined value set

### Prerequisites
- FHIR server with Observation resources containing component elements
- Access to DataAbsentReason value set (http://hl7.org/fhir/ValueSet/data-absent-reason)
- Understanding of extensible binding validation rules
- Observation resources that include `component.dataAbsentReason` elements

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Observation resources with `component` elements that include `dataAbsentReason` fields
- Any of the supported US Core Observation profiles that contain component data

**Expected Outputs:**
- Validation results showing conformance to DataAbsentReason value set binding
- Clear identification of any codes outside the value set requiring manual attestation

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for Observation resources:

**Primary Operations:**
- `GET [base]/Observation/[id]` - Retrieve specific Observation resources
- `GET [base]/Observation?[search parameters]` - Search for Observation resources

**Recommended Search Parameters for Test Data Discovery:**
- `patient+category` (SHALL support)
- `patient+code` (SHALL support) 
- `patient+category+date` (SHALL support)

### Validation Criteria

#### Automated Validation Checks
1. **Terminology Binding Validation:**
   - For each `Observation.component.dataAbsentReason` element found:
     - Verify the code is from the DataAbsentReason value set (http://hl7.org/fhir/ValueSet/data-absent-reason)
     - Check that the coding includes proper system URI (http://terminology.hl7.org/CodeSystem/data-absent-reason)
     - Validate code format and structure

2. **Extensible Binding Compliance:**
   - Accept any code from the DataAbsentReason value set as valid
   - Flag codes from outside the value set for manual review (not automatic failure)
   - Ensure codes are properly structured with system and code values

3. **Data Structure Validation:**
   - Verify `dataAbsentReason` is only present when `component.value[x]` is absent
   - Confirm proper CodeableConcept structure for the dataAbsentReason element

#### Test Assertions for Passing Results
**PASS Conditions:**
- All `dataAbsentReason` codes found are from the DataAbsentReason value set, OR
- Any codes outside the value set are properly flagged for manual attestation
- No structural violations in the dataAbsentReason coding
- Appropriate use of dataAbsentReason only when component values are absent

**MANUAL ATTESTATION Required When:**
- Codes are used from outside the DataAbsentReason value set
- Custom codes are provided that extend the base value set
- Local terminology systems are referenced

#### Implementation Notes
1. **Extensible Binding Semantics:**
   - Do not fail validation for codes outside the value set
   - Generate warnings or attestation requirements instead
   - Document any non-standard codes for review

2. **Test Scope:**
   - Focus on component-level dataAbsentReason elements specifically
   - Test across different Observation profile types that use components
   - Validate both primary codes and additional codings if present

3. **Error Handling:**
   - Handle missing terminology services gracefully
   - Provide clear messaging when manual attestation is required
   - Report structural issues separately from terminology issues

---

<a id='req-592'></a>

### REQ-592: Observation.component SHALL support at least one value or a dataAbsentReason.

**Text**: 

**Context**: Applies to each Observation.component; enforce that either value[x] or dataAbsentReason is present within the component.

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-592

## Requirement ID
REQ-592

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated through automated instance validation using FHIRPath invariants as specified. The requirement has clear, objective criteria that can be programmatically verified.

### Complexity
**Simple** - The requirement involves checking for the presence of specific elements within each Observation.component, which is a straightforward validation task.

### Prerequisites
- FHIR server supporting US Core Observation profiles
- Test system capable of retrieving Observation resources with components
- FHIR validation engine supporting FHIRPath expressions
- Access to Observation resources that contain component elements

## Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Observation resources containing one or more `component` elements
- Resources should conform to any of the US Core Observation profiles listed in the Capability Statement

**Expected Outputs:**
- Validation results indicating conformance or non-conformance for each Observation.component
- Clear identification of which components pass or fail the requirement
- Specific error messages for non-conformant components

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required for testing:

1. **Search Operations:**
   - `GET [base]/Observation?patient=[id]` - to retrieve patient observations
   - `GET [base]/Observation?patient=[id]&category=[category]` - to filter by observation categories
   - `GET [base]/Observation?patient=[id]&code=[code]` - to filter by specific observation codes

2. **Read Operations:**
   - `GET [base]/Observation/[id]` - to retrieve specific observation instances

3. **Include Operations (if needed):**
   - Standard FHIR read operations are sufficient; no special includes required for this test

### Validation Criteria

**Primary Validation:**
For each `Observation.component` element, verify that **at least one** of the following conditions is met:
- `component.value[x]` is present AND has a non-null value
- `component.dataAbsentReason` is present AND has a valid value

**FHIRPath Expression:**
```
Observation.component.all(value.exists() or dataAbsentReason.exists())
```

**Specific Assertions:**

1. **Component Identification:**
   - Identify all Observation resources in the test dataset
   - For each Observation, identify all `component` elements
   - Log the total number of components to be validated

2. **Value Presence Check:**
   - For each component, check if any `value[x]` element exists (valueQuantity, valueCodeableConcept, valueString, valueBoolean, valueInteger, valueRange, valueRatio, valueSampledData, valueTime, valueDateTime, valuePeriod, etc.)
   - Record components that have value elements present

3. **DataAbsentReason Check:**
   - For components without value elements, verify that `dataAbsentReason` is present
   - Validate that `dataAbsentReason` contains a valid code from the appropriate value set

4. **Conformance Assessment:**
   - **PASS:** All components in all Observation resources have either a value[x] or dataAbsentReason present
   - **FAIL:** Any component lacks both value[x] and dataAbsentReason elements
   - **ERROR:** Observation resources cannot be retrieved or parsed

**Test Execution Steps:**
1. Query for Observation resources using supported search parameters
2. For each retrieved Observation resource:
   - Parse the resource structure
   - Locate all `component` elements
   - Apply the FHIRPath validation expression
   - Document results for each component
3. Aggregate results across all tested observations
4. Generate conformance report with specific details about any failures

**Expected Results:**
- **Conformant System:** All Observation.component elements contain either a value[x] or dataAbsentReason
- **Non-conformant System:** One or more Observation.component elements lack both value[x] and dataAbsentReason
- **Detailed Reporting:** Test results should identify specific Observation resources and component indices that fail the requirement

---



<a id='organization'></a>

## Organization

<a id='req-121'></a>

### REQ-121: Organization identifier must use NAIC Company Codes

**Text**: 

**Context**: 

**Actor**: Organization System

**Conformance**: SHALL

# Test Specification: REQ-121

## 1. Requirement ID
REQ-121

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be validated programmatically by examining Organization resource instances and verifying that identifier values conform to NAIC Company Code format and structure.

### Complexity
**Simple** - The test involves straightforward validation of identifier values against NAIC Company Code standards within Organization resources.

### Prerequisites
- Organization System must be capable of exposing Organization resources via FHIR API
- System must support FHIR R4 standard
- Organization resources must contain identifier elements
- Access to reference NAIC Company Code list or validation rules for format verification

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Organization resources that represent payer/insurance organizations
- Resources must contain `identifier` elements with values intended to be NAIC Company Codes

**Expected Outputs:**
- Organization resources with identifiers that use valid NAIC Company Code format
- Identifier system URI should appropriately reference NAIC coding system
- All NAIC Company Code identifiers must be properly formatted and valid

### Required FHIR Operations
Based on the US Core Server Capability Statement, the following operations are supported and required for testing:

1. **GET /Organization/[id]** - Retrieve specific Organization resources by ID
2. **GET /Organization?_id=[ids]** - Retrieve multiple Organization resources
3. **GET /Organization** - Search for Organization resources (if search parameters are supported)

*Note: The capability statement indicates support for RESTful operations on resources, though Organization-specific search parameters are not explicitly detailed in the provided capability information.*

### Validation Criteria

**Primary Assertions:**
1. **Identifier Presence Validation**
   - Organization resources SHALL contain at least one identifier element
   - At least one identifier SHALL use NAIC Company Code as the coding system

2. **NAIC Code Format Validation**
   - Identifier values intended as NAIC Company Codes SHALL conform to NAIC format requirements:
     - Typically 5-digit numeric codes
     - Valid range and format as per NAIC standards
   - Identifier system URI SHALL appropriately reference NAIC coding system (e.g., `http://hl7.org/fhir/sid/us-naic`)

3. **Data Integrity Validation**
   - All NAIC Company Code identifiers SHALL be valid and verifiable against NAIC registry
   - No duplicate or conflicting NAIC identifiers within the same Organization resource
   - Identifier use element SHOULD be appropriately set (e.g., "official" or "secondary")

**Test Execution Steps:**
1. Retrieve Organization resources from the system using supported FHIR operations
2. Extract all identifier elements from each Organization resource
3. Identify identifiers that are designated as NAIC Company Codes (by system URI or type)
4. Validate format conformance of each NAIC identifier value
5. Verify that at least one valid NAIC Company Code identifier exists per Organization
6. Confirm proper use of NAIC coding system URI in identifier.system element

**Pass Criteria:**
- All Organization resources representing payers contain at least one properly formatted NAIC Company Code identifier
- All NAIC identifiers use correct system URI and format
- No invalid or malformed NAIC Company Codes are present

**Failure Conditions:**
- Organization resources missing NAIC Company Code identifiers
- NAIC identifiers with incorrect format or invalid codes
- Improper use of identifier.system URI for NAIC codes
- Presence of malformed or non-standard NAIC identifier values

---

<a id='req-122'></a>

### REQ-122: Organization must be active

**Text**: 

**Context**: 

**Actor**: Organization System

**Conformance**: SHALL

# Test Specification for REQ-122

## 1. Requirement ID
**REQ-122**: Organization must be active

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Automatically testable

The requirement is clear and specific - it mandates that Organization resources must have an active status. This can be verified programmatically by checking the `active` field in Organization resources.

### Complexity
**Level**: Simple

This is a straightforward field validation check on a single element within Organization resources.

### Prerequisites
- Organization System must be operational and accessible
- Organization System must expose FHIR RESTful API endpoints
- System must support Organization resource queries
- Test client must have appropriate authentication/authorization to access Organization resources
- Organization data must exist in the system for testing

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Organization resources stored in the system (using "bring your own data" approach)
- No specific fixture data required - test will work with existing Organization resources in the system

**Expected Outputs:**
- All retrieved Organization resources must have `active` field set to `true`
- HTTP 200 responses for successful queries
- Valid FHIR Organization resources in response payloads

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are supported and will be used:

1. **GET [base]/Organization/[id]** - Read specific Organization resources
2. **GET [base]/Organization?[search-parameters]** - Search for Organization resources (if search capabilities are supported for Organization)

*Note: The provided CapabilityStatement excerpt focuses on general US Core requirements. Specific Organization search parameters would need to be confirmed from the complete CapabilityStatement.*

### Validation Criteria

**Primary Assertions:**
1. **Active Field Validation**: Every Organization resource retrieved must contain `Organization.active = true`
2. **Field Presence Check**: The `active` field must be present in all Organization resources (not null or missing)
3. **Data Type Validation**: The `active` field must be a valid boolean value

**Test Execution Steps:**
1. Query the system to retrieve Organization resources using available read/search operations
2. For each Organization resource in the response:
   - Verify the presence of the `active` field
   - Assert that `Organization.active` equals `true`
   - Validate that the field is a proper boolean type
3. Document any Organization resources that fail the active status requirement

**Pass Criteria:**
- 100% of Organization resources must have `active = true`
- All responses must conform to FHIR Organization resource structure
- HTTP response codes must be appropriate (200 for successful operations)

**Failure Scenarios:**
- Any Organization resource with `active = false`
- Any Organization resource missing the `active` field
- Any Organization resource with invalid data type for `active` field
- System errors preventing resource retrieval (unless properly handled with appropriate HTTP status codes per CapabilityStatement requirements)

**Additional Validation:**
- Verify that responses include proper FHIR metadata and conform to US Core Organization profile requirements
- Ensure JSON format support as mandated by the CapabilityStatement
- Validate appropriate HTTP status codes for error conditions (400, 401, 403, 404) as specified in the CapabilityStatement

---

<a id='req-123'></a>

### REQ-123: Organization type must be "Payer"

**Text**: 

**Context**: 

**Actor**: Organization System

**Conformance**: SHALL

# Test Specification for REQ-123

## 1. Requirement ID
**REQ-123**: Organization type must be "Payer"

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated by examining the Organization resource's `type` field to verify it contains the "Payer" value.

### Complexity
**Simple** - The test involves a straightforward validation of a single field value in an Organization resource.

### Prerequisites
- Organization System must be operational and accessible
- System must support US Core Organization Profile
- At least one Organization resource must exist in the system for testing
- System must support FHIR RESTful read operations for Organization resources

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Organization resource(s) that claim conformance to the requirement
- **Test Data**: Any existing Organization resources in the system under test (following "bring your own data" approach)
- **Profile**: US Core Organization Profile (http://hl7.org/fhir/us/core/StructureDefinition/us-core-organization)

### Expected Outputs
- Organization resource(s) with `type` field containing a CodeableConcept that represents "Payer"
- HTTP 200 response for successful resource retrieval
- Valid FHIR Organization resource structure

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for Organization resources:
- **GET** `/Organization/{id}` - Read specific Organization resource
- **GET** `/Organization?name={name}` - Search Organizations by name
- **GET** `/Organization?address={address}` - Search Organizations by address

### Validation Criteria

#### Primary Validation
1. **Type Field Presence**: Organization resource SHALL contain a `type` element
2. **Type Value Validation**: The `type` field SHALL contain a CodeableConcept with coding that represents "Payer"
3. **Accepted Payer Representations**: The type coding SHALL include one of the following:
   - System: `http://terminology.hl7.org/CodeSystem/organization-type`, Code: `pay` (Payer)
   - System: `http://terminology.hl7.org/CodeSystem/v3-RoleCode`, Code: `PAY` (Payor)
   - Text value indicating "Payer" or equivalent terminology

#### Secondary Validation
1. **Profile Conformance**: Organization resource SHOULD declare conformance to US Core Organization Profile in `meta.profile`
2. **Resource Structure**: Organization resource SHALL be valid according to FHIR R4 specification
3. **HTTP Response**: API calls SHALL return appropriate HTTP status codes (200 for success, 404 for not found, etc.)

#### Test Scenarios
1. **Scenario 1: Direct Resource Read**
   - Retrieve Organization resource by ID
   - Validate type field contains "Payer" designation
   - Assert: `Organization.type.coding` contains appropriate payer code

2. **Scenario 2: Search-based Validation**
   - Search for Organization resources using supported search parameters
   - For each returned Organization, validate type field
   - Assert: All Organizations claiming to be payers have correct type designation

3. **Scenario 3: Multiple Type Values**
   - If Organization has multiple type values, at least one SHALL be "Payer"
   - Assert: `Organization.type` array contains at least one payer-related coding

#### Pass/Fail Criteria
- **PASS**: All Organization resources tested contain appropriate "Payer" type designation
- **FAIL**: Any Organization resource lacks the required "Payer" type or contains incorrect type values
- **NOT APPLICABLE**: No Organization resources are available for testing or system doesn't support Organization resource operations

#### Error Handling
- System should gracefully handle invalid Organization IDs (return 404)
- System should return appropriate error responses for malformed requests
- Test should document any system limitations or unsupported operations

---

<a id='req-210'></a>

### REQ-210: The server must support a search on organization address fields.

**Text**: 

**Context**: 

**Actor**: Server

**Conformance**: MAY

# Test Specification for REQ-210

## 1. Requirement ID
**REQ-210**: Organization Address Search Support

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified through automated API calls to test search functionality on organization address fields.

### Complexity
**Moderate** - The test involves multiple address field variations and search parameter combinations, but follows standard FHIR search patterns.

### Prerequisites
- Server must have Organization resources with populated address fields
- Server must implement US Core Organization Profile
- Server must support FHIR R4 RESTful API
- Test client must have appropriate authorization/authentication credentials
- Server must return JSON format responses (as per US Core Server requirements)

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources Needed:**
- One or more Organization resources with populated address fields including:
  - `address.line` (street address)
  - `address.city`
  - `address.state`
  - `address.postalCode`
  - `address.country`

**Expected Outputs:**
- HTTP 200 responses for successful searches
- Bundle resources containing matching Organization resources
- Proper error responses (400, 401, 403, 404) for invalid requests as specified in capability statement

### Required FHIR Operations

**Primary Operations:**
1. `GET [base]/Organization?address=[value]` - Search by complete address
2. `GET [base]/Organization?address-city=[value]` - Search by city
3. `GET [base]/Organization?address-state=[value]` - Search by state
4. `GET [base]/Organization?address-postalcode=[value]` - Search by postal code
5. `GET [base]/Organization?address-country=[value]` - Search by country

**Note**: These operations align with the US Core Server CapabilityStatement's support for Organization resource searches.

### Validation Criteria

**Test Case 1: Basic Address Search Support**
- **Action**: Query existing Organization resources to identify available address data
- **Assertion**: Server responds with HTTP 200 and returns Organization resources
- **Purpose**: Establish baseline data availability

**Test Case 2: Address Field Search Functionality**
- **Action**: Execute search requests using various address parameters based on available data:
  - Search by city using a city value present in existing Organization data
  - Search by state using a state value present in existing Organization data  
  - Search by postal code using a postal code present in existing Organization data
- **Assertions**: 
  - Server responds with HTTP 200 for supported search parameters
  - Returned Bundle contains Organization resources matching the search criteria
  - Each returned Organization has address fields that match the search parameter
  - Response follows FHIR Bundle structure requirements

**Test Case 3: Partial Match and String Handling**
- **Action**: Execute searches with partial address strings (if supported by implementation)
- **Assertion**: Server handles partial matches appropriately or returns proper error responses

**Test Case 4: Invalid Search Parameter Handling**
- **Action**: Submit search with malformed address parameters
- **Assertion**: Server returns HTTP 400 (invalid parameter) as specified in capability statement

**Test Case 5: Authorization and Error Handling**
- **Action**: Test search with insufficient authorization (if applicable)
- **Assertion**: Server returns appropriate 4xx response (401, 403, or 404) as specified in capability statement

**Test Case 6: Response Format Compliance**
- **Action**: Verify all successful responses are in JSON format
- **Assertion**: Content-Type header indicates JSON format as required by US Core Server capabilities

**Pass Criteria Summary:**
- Server successfully processes at least one address field search parameter
- All responses conform to FHIR R4 specification
- Error handling aligns with US Core Server CapabilityStatement requirements
- JSON format support is demonstrated
- Since this is a MAY requirement, the test passes if the server either:
  - Successfully implements address search functionality, OR
  - Returns consistent "not supported" responses for address search parameters

**Note**: Given the "MAY" conformance level, servers are not required to implement this functionality. The test should verify that if implemented, it works correctly according to FHIR standards.

---

<a id='req-211'></a>

### REQ-211: The server may support multipleOr search parameter.

**Text**: 

**Context**: 

**Actor**: Server

**Conformance**: MAY

# Test Specification for REQ-211

## 1. Requirement ID
REQ-211

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Automatically testable

This requirement is testable through automated means by examining the SearchParameter definition and verifying the server's support for multipleOr functionality through test queries.

### Complexity
**Level**: Moderate

The test requires understanding of FHIR search parameter mechanics, specifically the multipleOr capability, and the ability to construct appropriate test queries that validate this functionality.

### Prerequisites
- Server must support the Organization resource and associated search parameters
- Server must have Organization resources available for testing
- The us-core-organization-address SearchParameter must be supported by the server
- Test data should include multiple Organization resources with different address values to enable meaningful multipleOr testing

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Organization resources with varied address fields (street, city, state, postal code components)
- **Search Parameter**: us-core-organization-address (string type)
- **Test Values**: Multiple distinct address string values that exist in the test data set

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required for testing:

1. **GET [base]/Organization?address=[value1],[value2]** - Test multipleOr search functionality
2. **GET [base]/Organization?address=[value1]** - Individual searches for comparison
3. **GET [base]/Organization?address=[value2]** - Individual searches for comparison
4. **GET [base]/Organization** - General search to identify available test data

### Validation Criteria

#### Test Case 1: Verify MultipleOr Support Declaration
**Objective**: Confirm that the SearchParameter definition indicates multipleOr support

**Steps**:
1. Retrieve the SearchParameter definition for us-core-organization-address
2. Verify that `multipleOr` element is present and set to `true` (or defaults to true if not explicitly stated)

**Expected Result**: SearchParameter supports multipleOr functionality as indicated in the definition

#### Test Case 2: Functional MultipleOr Search Testing
**Objective**: Verify that multipleOr search returns appropriate results

**Steps**:
1. Identify at least two distinct address values from available Organization resources
2. Perform individual searches: `GET [base]/Organization?address=[value1]` and `GET [base]/Organization?address=[value2]`
3. Record the Organization resources returned by each individual search
4. Perform multipleOr search: `GET [base]/Organization?address=[value1],[value2]`
5. Verify that the multipleOr search results contain all Organizations from both individual searches
6. Verify that no additional unexpected Organizations are returned

**Expected Result**: 
- MultipleOr search returns the union of results from individual searches
- No false positives or false negatives in the result set
- HTTP 200 response status
- Valid FHIR Bundle response format

#### Test Case 3: Edge Case Validation
**Objective**: Ensure proper behavior with edge cases

**Steps**:
1. Test with non-existent address values: `GET [base]/Organization?address=nonexistent1,nonexistent2`
2. Test with one valid and one invalid address value: `GET [base]/Organization?address=[valid_value],nonexistent`
3. Test with duplicate values in the multipleOr parameter: `GET [base]/Organization?address=[value1],[value1]`

**Expected Results**:
- Non-existent values return empty result set (HTTP 200 with empty Bundle)
- Mixed valid/invalid returns only results matching valid value
- Duplicate values handled gracefully without errors

#### Test Case 4: Integration with Other Parameters
**Objective**: Verify multipleOr works in combination with other search parameters

**Steps**:
1. Combine multipleOr address search with name parameter: `GET [base]/Organization?address=[value1],[value2]&name=[name_value]`
2. Verify results match both the multipleOr address criteria AND the name criteria

**Expected Result**: Combined search parameters work correctly with multipleOr functionality

### Assertions for Test Success
1. **Conformance**: Server SearchParameter definition supports multipleOr (MAY requirement satisfied)
2. **Functionality**: MultipleOr searches return expected union of results
3. **Format**: All responses conform to FHIR Bundle format
4. **Error Handling**: Appropriate handling of edge cases without server errors
5. **Integration**: MultipleOr works correctly with other search parameters

### Notes
- Since this is a MAY requirement, servers that do not support multipleOr should gracefully handle the comma-separated values (potentially treating as a single literal search value or returning appropriate error)
- Test should adapt to available data rather than requiring specific fixtures
- Test implementation should verify both the capability declaration and functional behavior

---

<a id='req-212'></a>

### REQ-212: The server may support multipleAnd search parameter.

**Text**: 

**Context**: 

**Actor**: Server

**Conformance**: MAY

# Test Specification for REQ-212

## Requirement ID
REQ-212

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated testing by examining the server's CapabilityStatement and testing search parameter behavior.

### Complexity
**Simple** - The requirement involves checking a single search parameter attribute (`multipleAnd`) for Organization address searches.

### Prerequisites
- Server must support US Core Organization Profile
- Server must support Organization search by address parameter
- Test data must include Organization resources with address information
- Server must expose a CapabilityStatement declaring search parameter capabilities

## Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Organization resources with populated address fields (address.line, address.city, address.state, address.postalCode, address.country)
- **Search Parameters**: Organization address search parameter with multipleAnd capability
- **CapabilityStatement**: Server's capability statement declaring search parameter support

### Required FHIR Operations
1. `GET [base]/metadata` - Retrieve server CapabilityStatement
2. `GET [base]/Organization?address=[value1]&address=[value2]` - Test multipleAnd search capability if supported
3. `GET [base]/Organization?address=[single-value]` - Baseline address search to verify basic functionality

### Validation Criteria

#### Primary Test Cases

**Test Case 1: CapabilityStatement Verification**
- Retrieve the server's CapabilityStatement
- Locate the Organization resource definition
- Find the address search parameter definition
- **Assertion**: If `multipleAnd` is declared as `true` for the address search parameter, the server claims support
- **Expected Result**: No failure if multipleAnd is not supported (MAY requirement), but if declared, it must be documented

**Test Case 2: MultipleAnd Functionality Test (Conditional)**
- **Precondition**: Only execute if CapabilityStatement indicates multipleAnd support for Organization.address
- Execute search with multiple address values: `GET [base]/Organization?address=[value1]&address=[value2]`
- **Assertion**: Server processes the request without error
- **Expected Result**: Returns Organizations matching ALL provided address criteria (AND logic)
- **Validation**: Response should contain only Organizations where the address matches all specified values

**Test Case 3: Baseline Address Search**
- Execute single address search: `GET [base]/Organization?address=[value]`
- **Assertion**: Server supports basic address searching
- **Expected Result**: Returns Organizations with addresses matching the search criteria
- **Validation**: Confirms basic address search functionality exists

#### Success Criteria
- **If multipleAnd is NOT supported**: Server may return HTTP 400 for multiple address parameters, or process only one parameter - both are acceptable for MAY requirement
- **If multipleAnd IS supported**: Server must successfully process multiple address parameters with AND logic
- Server's CapabilityStatement accurately reflects its multipleAnd support status

#### Failure Conditions
- Server crashes or returns HTTP 500 when processing multiple address parameters
- Server claims multipleAnd support in CapabilityStatement but fails to implement the functionality
- Server implements multipleAnd functionality but doesn't declare it in CapabilityStatement (inconsistency)

### Implementation Notes
1. This test accommodates the "bring your own data" approach by working with any Organization resources that have address information
2. The test gracefully handles servers that don't support multipleAnd (since it's a MAY requirement)
3. Focus is on conformance verification rather than exhaustive edge case testing
4. Test validates both capability declaration and actual implementation consistency

---

<a id='req-522'></a>

### REQ-522: US Core Client SHALL fetch Organization resources.

**Text**: 

**Context**: US Core Client read interaction for Organization by id

**Actor**: US Core Client

**Conformance**: SHALL

# Test Specification for REQ-522

## 1. Requirement ID
**REQ-522**: US Core Client SHALL fetch Organization resources

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Automatically testable

This requirement is clearly testable as it specifies a concrete interaction (read Organization by id) that can be verified through API calls and response validation.

### Complexity
**Level**: Simple

The requirement involves a straightforward FHIR read operation with clear success criteria.

### Prerequisites
- US Core Server implementing US Core Organization profile support
- Valid Organization resource IDs available in the test system
- Client system capable of making FHIR RESTful API calls
- Authentication/authorization configured if required by the server
- Network connectivity between client and server

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources Needed**:
- At least one Organization resource conforming to US Core Organization profile must exist on the server
- The Organization resource ID must be known to the test system

**Test Data Requirements**:
- Organization resource ID(s) from the target server's data set
- Valid authentication credentials (if required)
- Server base URL

### Expected Outputs
- HTTP 200 OK response for successful read operations
- Valid US Core Organization resource in response body
- Appropriate error responses (400, 401, 403, 404) for invalid requests

### Required FHIR Operations
Based on the Capability Statement analysis, the following operation is required:
- **GET [base]/Organization/[id]** - Read interaction for Organization resource

### Validation Criteria

#### Test Case 1: Successful Organization Read
**Objective**: Verify client can successfully fetch an Organization resource by ID

**Test Steps**:
1. Client performs GET request to `[base]/Organization/[valid-id]`
2. Verify HTTP response status is 200 OK
3. Validate response contains valid JSON (as JSON support is required per Capability Statement)
4. Verify returned resource is of resourceType "Organization"
5. Validate resource conforms to US Core Organization profile constraints
6. Verify resource contains required elements per US Core Organization profile

**Pass Criteria**:
- HTTP 200 status received
- Valid Organization resource returned
- Resource validates against US Core Organization profile
- All Must Support elements are present if populated in the source data

#### Test Case 2: Error Handling Validation
**Objective**: Verify appropriate error responses for invalid requests

**Test Steps**:
1. Client performs GET request to `[base]/Organization/[non-existent-id]`
2. Verify HTTP response status is 404 Not Found
3. If authentication is required, test with invalid/missing credentials
4. Verify appropriate 401/403 responses for unauthorized requests

**Pass Criteria**:
- HTTP 404 for non-existent resources
- HTTP 401/403 for unauthorized requests (if authentication required)
- Error responses follow FHIR OperationOutcome structure where applicable

#### Test Case 3: Response Format Validation
**Objective**: Verify response format compliance

**Test Steps**:
1. Client performs GET request with `Accept: application/fhir+json` header
2. Verify response Content-Type is appropriate FHIR JSON media type
3. Validate JSON structure follows FHIR specification
4. If server supports XML (SHOULD per Capability Statement), test with `Accept: application/fhir+xml`

**Pass Criteria**:
- JSON format support is demonstrated (SHALL requirement)
- Proper FHIR media types used in Content-Type headers
- Response structure follows FHIR specification

#### Test Case 4: Profile Conformance Validation
**Objective**: Verify returned Organization conforms to US Core profile

**Test Steps**:
1. Client performs successful Organization read
2. Validate resource against US Core Organization profile using FHIR validator
3. Check for presence of `meta.profile` indicating US Core Organization profile (SHOULD per Capability Statement)
4. Verify all Must Support elements are handled appropriately

**Pass Criteria**:
- Resource passes US Core Organization profile validation
- Must Support elements are present when data exists
- Profile declaration in meta.profile (if server implements this SHOULD requirement)

### Additional Considerations
- Tests should accommodate "bring your own data" approach by using existing Organization IDs from the target server
- Test execution should not require specific fixture data
- Authentication requirements should be configurable based on server security implementation
- Tests should verify the client's ability to process both success and error responses appropriately

---



<a id='patient'></a>

## Patient

<a id='req-054'></a>

### REQ-054: Patient SHALL have a medical record number.

**Text**: 

**Context**: 

**Actor**: Healthcare Provider

**Conformance**: SHALL

# Test Specification for REQ-054

## 1. Requirement ID
**REQ-054**: Patient SHALL have a medical record number.

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated programmatically by examining Patient resources to verify the presence of a medical record number identifier.

### Complexity
**Simple** - The test involves checking for the existence of an identifier with the appropriate type or system value within Patient resources.

### Prerequisites
- Access to Patient resources in the test system
- Understanding of how the system represents medical record numbers (typically as Patient.identifier elements)
- Knowledge of the identifier system/type used by the implementation for medical record numbers

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Patient resources from the system under test
- **System Configuration**: Knowledge of how medical record numbers are represented in the implementation (identifier.system URI or identifier.type coding)
- **Test Data**: Any Patient resources available in the system (bring your own data approach)

### Expected Outputs
- Confirmation that all Patient resources contain at least one identifier representing a medical record number
- Clear identification of any Patient resources that fail to meet this requirement

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported:
- **GET /Patient?[search-parameters]** - To retrieve Patient resources for testing
- **GET /Patient/[id]** - To retrieve specific Patient resources
- Supported search parameters for Patient include: `_id`, `birthdate`, `death-date`, `family`, `given`, `identifier`, `name`

### Validation Criteria

#### Primary Validation
1. **Identifier Presence Check**: Each Patient resource MUST contain at least one `Patient.identifier` element that represents a medical record number

2. **Medical Record Number Identification**: The medical record number can be identified through one of the following approaches:
   - **System-based identification**: `Patient.identifier.system` contains a URI that clearly indicates medical record numbers (e.g., organization-specific MRN system)
   - **Type-based identification**: `Patient.identifier.type` contains a coding that indicates medical record number (e.g., using standard codes like MR from HL7 identifier type codes)
   - **Use-based identification**: `Patient.identifier.use` is set to "usual" or "official" for the primary medical record identifier

#### Test Assertions
**PASS Criteria:**
- All Patient resources in the test dataset contain at least one identifier that can be reasonably identified as a medical record number
- The identifier has a non-empty `value` element
- The identifier includes appropriate metadata (system, type, or use) to clearly indicate it represents a medical record number

**FAIL Criteria:**
- Any Patient resource lacks an identifier that can be identified as a medical record number
- Patient resources have identifiers but none can be clearly identified as medical record numbers
- Medical record number identifiers have empty or missing `value` elements

#### Implementation Notes
1. **Flexibility in Implementation**: Different systems may use various approaches to denote medical record numbers (system URI, type coding, naming conventions)
2. **Multiple Identifiers**: Patient resources may have multiple identifiers; at least one must be identifiable as a medical record number
3. **Data Quality**: While the requirement mandates presence, the test should also verify that the medical record number has a meaningful value (not just empty or placeholder text)

#### Test Execution Steps
1. Retrieve Patient resources from the system using available search parameters
2. For each Patient resource, examine the `identifier` array
3. Apply identification logic to determine if at least one identifier represents a medical record number
4. Verify that the identified medical record number has a valid, non-empty value
5. Document any failures with specific details about missing or inadequate identifiers
6. Generate a compliance report indicating pass/fail status for each Patient resource

---

<a id='req-055'></a>

### REQ-055: Patient SHALL have contact details.

**Text**: 

**Context**: 

**Actor**: Healthcare Provider

**Conformance**: SHALL

# Test Specification for REQ-055

## 1. Requirement ID
**REQ-055**: Patient SHALL have contact details

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Automatically testable

The requirement can be objectively verified by examining Patient resources to confirm the presence of contact information fields. This is a structural validation that can be automated through FHIR resource inspection.

### Complexity
**Level**: Simple

This is a straightforward validation of data presence in specific FHIR elements within Patient resources.

### Prerequisites
- Access to a FHIR server implementing US Core Patient Profile
- Patient resources available for testing
- READ operation capability for Patient resources (as confirmed in Capability Statement)

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Patient resources conforming to US Core Patient Profile
- Resources should represent real-world patient data brought by the tester

**Expected Outputs:**
- Confirmation that each Patient resource contains at least one form of contact information
- Clear pass/fail results for each Patient resource tested

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are supported and required:

1. **Patient READ operations** using supported search parameters:
   - `GET /Patient?_id={id}`
   - `GET /Patient?identifier={identifier}`
   - `GET /Patient?name={name}`
   - `GET /Patient?family={family}`
   - `GET /Patient?given={given}`

2. **Patient search operations** with combinations:
   - `GET /Patient?birthdate={date}&name={name}`
   - `GET /Patient?death-date={date}&family={family}`
   - `GET /Patient?birthdate={date}&family={family}`

### Validation Criteria

For each Patient resource retrieved, verify that **at least one** of the following contact detail elements is present and populated:

#### Primary Contact Information Fields:
1. **Patient.telecom** - Communication details
   - Must contain at least one ContactPoint with:
     - `system` (phone, email, fax, etc.)
     - `value` (the actual contact value)
   - Verify telecom array is not empty

2. **Patient.address** - Physical addresses
   - Must contain at least one Address with populated fields
   - Check for presence of meaningful address components (line, city, state, postalCode, etc.)
   - Verify address array is not empty

#### Specific Assertions for Test Passing:
- **PASS**: Patient resource contains at least one populated `telecom` entry OR at least one populated `address` entry
- **FAIL**: Patient resource has both empty/missing `telecom` array AND empty/missing `address` array

#### Additional Validation Checks:
1. **Telecom Validation** (if present):
   - Verify `ContactPoint.system` is a valid code from ContactPointSystem value set
   - Verify `ContactPoint.value` contains actual contact information (not empty/null)

2. **Address Validation** (if present):
   - Verify Address contains at least one meaningful component (not all fields empty)
   - Check that address follows US Core Patient Profile constraints

#### Test Execution Flow:
1. Retrieve Patient resources using supported search parameters from Capability Statement
2. For each Patient resource returned:
   - Extract `telecom` and `address` elements
   - Apply validation criteria above
   - Record pass/fail status
3. Generate summary report of compliance across all tested Patient resources

#### Success Metrics:
- **Individual Resource Level**: Each Patient resource must have contact details present
- **Implementation Level**: All Patient resources in the system should demonstrate consistent contact information availability

This test specification ensures conformance with the "SHALL have contact details" requirement while leveraging the supported operations defined in the US Core Server CapabilityStatement.

---

<a id='req-192'></a>

### REQ-192: The system MAY support multiple AND conditions for the US Core Race search parameter.

**Text**: 

**Context**: 

**Actor**: System

**Conformance**: MAY

# Test Specification for REQ-192

## 1. Requirement ID
REQ-192

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated API testing by sending search requests with multiple AND conditions for the US Core Race search parameter and validating the server's response behavior.

### Complexity
**Simple** - The test involves straightforward HTTP GET requests with query parameters and response validation. No complex data manipulation or multi-step workflows are required.

### Prerequisites
- System under test must implement US Core Server capabilities
- System must have Patient resources with race information populated using US Core Race extension
- System must support the US Core Race search parameter
- Test data should include patients with multiple race values to enable meaningful testing of AND conditions

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Patient resources with US Core Race extension containing multiple race values
- **Search Parameters**: `race` parameter with multiple values using AND logic
- **Expected Outputs**: 
  - If supported: HTTP 200 response with filtered Patient bundle containing only patients matching ALL specified race conditions
  - If not supported: Any valid HTTP response (since this is a MAY requirement)

### Required FHIR Operations
- **GET /Patient**: Search operation with race parameter
- **Supported per Capability Statement**: Yes - Patient resource search is supported as part of US Core Server requirements

### Validation Criteria

#### Test Case 1: Multiple Race Values with AND Logic
**Test Steps:**
1. Identify available race values in the test dataset by performing exploratory searches
2. Construct search request: `GET /Patient?race=value1&race=value2`
3. Execute the search request
4. Validate response

**Acceptance Criteria:**
- **If server supports multiple AND conditions (optional behavior):**
  - Response status: HTTP 200
  - Response contains Bundle resource with Patient entries
  - All returned Patient resources must contain BOTH specified race values in their US Core Race extension
  - Bundle.total should reflect the count of patients meeting both criteria
  
- **If server does not support multiple AND conditions:**
  - Any valid HTTP response status (200, 400, etc.) is acceptable
  - Server behavior should be consistent and documented

#### Test Case 2: Verify AND Logic vs OR Logic
**Test Steps:**
1. Execute search with single race value: `GET /Patient?race=value1`
2. Execute search with different single race value: `GET /Patient?race=value2`
3. Execute search with both values: `GET /Patient?race=value1&race=value2`
4. Compare result sets

**Acceptance Criteria:**
- **If multiple AND conditions are supported:**
  - Results from step 3 should be a subset of results from both steps 1 and 2
  - Each patient in the AND result must appear in both individual search results
  - The AND result should contain fewer or equal patients compared to individual searches

#### Test Case 3: Edge Case - Same Race Value Multiple Times
**Test Steps:**
1. Execute search: `GET /Patient?race=value1&race=value1`
2. Compare with single parameter search: `GET /Patient?race=value1`

**Acceptance Criteria:**
- Results should be equivalent to single parameter search
- No duplicate entries in response
- Consistent server behavior

#### Test Case 4: Invalid Race Values in AND Conditions
**Test Steps:**
1. Execute search with one valid and one invalid race value: `GET /Patient?race=validValue&race=invalidValue`

**Acceptance Criteria:**
- Server responds with appropriate error handling
- Response should be consistent with server's general parameter validation approach
- No system errors or crashes

### Additional Validation Points
- Verify that the server's CapabilityStatement accurately reflects support for `multipleAnd` on the race parameter
- Ensure response times remain reasonable even with multiple AND conditions
- Validate that paging works correctly when AND conditions are applied
- Confirm that the search results maintain proper FHIR Bundle structure regardless of AND condition support

### Test Reporting
Document whether the system:
- Supports multiple AND conditions for US Core Race parameter
- Provides consistent behavior across different race value combinations  
- Handles edge cases appropriately
- Maintains expected performance characteristics

---

<a id='req-201'></a>

### REQ-201: Search for patients by ethnicity extension code

**Text**: 

**Context**: 

**Actor**: FHIR Server

**Conformance**: SHALL

# Test Specification for REQ-201

## 1. Requirement ID
**REQ-201**: Search for patients by ethnicity extension code

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be objectively verified through automated testing by executing search operations and validating responses.

### Complexity
**Moderate** - Requires understanding of US Core Patient profile extensions, search parameter usage, and validation of search results containing ethnicity information.

### Prerequisites
- FHIR Server implementing US Core Server CapabilityStatement
- Server must support US Core Patient resource profile with ethnicity extensions
- Test data should include Patient resources with US Core ethnicity extensions populated
- Server must support JSON format (required by US Core)
- Appropriate authentication/authorization configured if required

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources Needed:**
- Patient resources conforming to US Core Patient profile
- Patient resources must contain the `us-core-ethnicity` extension with coded values
- Mix of patients with different ethnicity codes and some without ethnicity data

**Search Parameters:**
- `ethnicity` search parameter as defined in US Core SearchParameter-us-core-ethnicity

### Required FHIR Operations
- **GET** `[base]/Patient?ethnicity=[code]` - Search patients by ethnicity code
- **GET** `[base]/Patient?ethnicity:text=[text]` - Search patients by ethnicity text (if supported)
- **GET** `[base]/metadata` - Verify server capabilities (optional verification)

### Expected Outputs
- HTTP 200 status code for valid searches
- Bundle resource containing matching Patient resources
- Each returned Patient must contain the queried ethnicity extension
- Proper FHIR Bundle structure with appropriate entry elements

### Validation Criteria

#### Test Case 1: Basic Ethnicity Code Search
**Test Steps:**
1. Execute search: `GET [base]/Patient?ethnicity=[known-ethnicity-code]`
2. Verify HTTP 200 response
3. Validate response is a Bundle resource
4. Confirm all returned Patient resources contain the `us-core-ethnicity` extension
5. Verify at least one ethnicity coding in each returned patient matches the search parameter

**Assertions:**
- Response status = 200
- Response.resourceType = "Bundle"
- Bundle.entry exists and contains Patient resources
- For each Patient in Bundle.entry:
  - Patient.extension where url = "http://hl7.org/fhir/us/core/StructureDefinition/us-core-ethnicity" exists
  - Extension contains ombCategory or detailed extension with coding.code matching search parameter

#### Test Case 2: Multiple Ethnicity Codes Search
**Test Steps:**
1. Execute search with multiple codes: `GET [base]/Patient?ethnicity=[code1],[code2]`
2. Verify HTTP 200 response
3. Validate all returned patients have ethnicity matching one of the specified codes

**Assertions:**
- Response status = 200
- Each returned Patient has ethnicity extension with coding matching at least one of the search codes

#### Test Case 3: Invalid Ethnicity Code Search
**Test Steps:**
1. Execute search with invalid/non-existent ethnicity code: `GET [base]/Patient?ethnicity=[invalid-code]`
2. Verify appropriate response (200 with empty results or 400 for invalid parameter)

**Assertions:**
- Response status = 200 OR 400
- If status = 200, then Bundle.total = 0 or Bundle.entry is empty
- If status = 400, response includes OperationOutcome with appropriate error message

#### Test Case 4: Search Parameter Existence Verification
**Test Steps:**
1. Verify the server declares support for ethnicity search parameter in CapabilityStatement
2. Execute `GET [base]/metadata`
3. Locate Patient resource in CapabilityStatement
4. Verify ethnicity search parameter is listed

**Assertions:**
- CapabilityStatement.rest.resource where type = "Patient" exists
- SearchParameter with name = "ethnicity" exists in the Patient resource definition

#### Test Case 5: Extension Structure Validation
**Test Steps:**
1. Execute ethnicity search returning at least one Patient
2. Validate the structure of the ethnicity extension in returned patients

**Assertions:**
- Extension.url = "http://hl7.org/fhir/us/core/StructureDefinition/us-core-ethnicity"
- Extension contains either:
  - ombCategory extension with ValueSet binding to OMB ethnicity codes, OR
  - detailed extension with appropriate ethnicity coding, OR
  - text extension with ethnicity description
- Extension structure conforms to US Core ethnicity extension definition

#### Error Handling Validation
**Test Steps:**
1. Test malformed search parameters
2. Test unauthorized access (if security implemented)

**Assertions:**
- Appropriate HTTP status codes returned (400 for bad requests, 401/403 for unauthorized)
- Error responses include OperationOutcome resources with meaningful error descriptions

---

<a id='req-202'></a>

### REQ-202: Support multiple OR conditions in ethnicity search

**Text**: 

**Context**: 

**Actor**: FHIR Server

**Conformance**: MAY

# Test Specification for REQ-202: Support Multiple OR Conditions in Ethnicity Search

## 1. Requirement ID
REQ-202

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be tested through automated API calls to verify server support for multiple OR conditions in ethnicity search parameters.

### Complexity
**Moderate** - Requires understanding of FHIR search parameter syntax for multiple OR conditions and the ability to construct and execute appropriate search queries against Patient resources.

### Prerequisites
- FHIR Server implementing US Core Patient Profile
- Patient resources with ethnicity data populated using US Core ethnicity extensions
- Server must support Patient search operations as specified in the Capability Statement
- Test data should include patients with various ethnicity values from the US Core ethnicity value sets

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Patient resources conforming to US Core Patient Profile with populated ethnicity extensions
- **Search Parameters**: Multiple ethnicity codes to test OR condition functionality
- **Expected Ethnicity Values**: Valid codes from US Core ethnicity value sets (OMB Race and Ethnicity Category Value Sets from Race & Ethnicity - CDC (CDCREC) code system)

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for Patient resources:
- `GET [base]/Patient?[search-parameters]` - Patient search-type operation (SHALL support)
- The server SHALL support Patient resource searches as documented in the capability statement

### Validation Criteria

#### Test Case 1: Basic Multiple OR Ethnicity Search
**Objective**: Verify server supports multiple ethnicity values in a single search using OR logic

**Test Steps**:
1. Identify at least 2 different ethnicity codes present in the test data
2. Execute search: `GET [base]/Patient?ethnicity=[code1],[code2]`
3. Verify response returns patients matching ANY of the specified ethnicity codes
4. Confirm returned patients have ethnicity values that match at least one of the search parameters

**Pass Criteria**:
- Server returns HTTP 200 status
- Response includes patients with ethnicity matching code1 OR code2
- No patients returned have ethnicity values outside the specified codes (unless they also have matching values)
- Response format conforms to FHIR Bundle structure

#### Test Case 2: Multiple OR with System and Code Values
**Objective**: Test OR conditions when providing both system and code values for ethnicity search

**Test Steps**:
1. Construct search with multiple ethnicity parameters including system: `GET [base]/Patient?ethnicity=http://cdcrec.ca.gov/codes|[code1],http://cdcrec.ca.gov/codes|[code2]`
2. Execute the search request
3. Validate response contains patients matching either ethnicity specification

**Pass Criteria**:
- Server processes the search successfully
- Results include patients with matching ethnicity codes from the specified system
- Response demonstrates OR logic (patients matching either condition are included)

#### Test Case 3: Mixed Format OR Conditions
**Objective**: Verify server handles mixed format ethnicity searches (code-only and system|code combinations)

**Test Steps**:
1. Execute search mixing formats: `GET [base]/Patient?ethnicity=[code1],http://cdcrec.ca.gov/codes|[code2]`
2. Verify server processes the mixed format correctly
3. Confirm results include patients matching either format

**Pass Criteria**:
- Server accepts and processes the mixed format search
- Results demonstrate proper OR logic across different parameter formats
- No server errors or unexpected behavior

#### Test Case 4: Edge Case - Empty Results
**Objective**: Verify server handles OR searches that return no matches gracefully

**Test Steps**:
1. Execute search with ethnicity codes not present in test data: `GET [base]/Patient?ethnicity=[nonexistent-code1],[nonexistent-code2]`
2. Verify server returns appropriate empty result set

**Pass Criteria**:
- Server returns HTTP 200 status
- Response is a valid FHIR Bundle with total count of 0
- No server errors occur

#### General Validation Requirements
For all test cases, verify:
- Server responses conform to FHIR R4 specification
- Returned Patient resources conform to US Core Patient Profile
- Ethnicity data in responses uses appropriate US Core extensions
- Search behavior demonstrates OR logic (union of results, not intersection)
- Server handles the search parameter as specified in SearchParameter-us-core-ethnicity.md

#### Error Handling Validation
- Verify server returns appropriate HTTP status codes for malformed requests
- Confirm server provides meaningful error messages for invalid ethnicity codes or formats
- Test server behavior with unsupported search parameter combinations

**Note**: Since this is a MAY requirement, servers that do not implement multiple OR conditions for ethnicity search should return appropriate responses (such as HTTP 400 with explanatory error messages) rather than producing incorrect results.

---

<a id='req-203'></a>

### REQ-203: Support multiple AND conditions in ethnicity search

**Text**: 

**Context**: 

**Actor**: FHIR Server

**Conformance**: MAY

# Test Specification for REQ-203

## 1. Requirement ID
REQ-203: Support multiple AND conditions in ethnicity search

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through API testing by executing search requests with multiple ethnicity parameters and validating the server's response and behavior.

### Complexity
**Moderate** - The test requires understanding of FHIR search parameter behavior, specifically the `multipleAnd` capability for token-type parameters, and validation of search result accuracy.

### Prerequisites
- FHIR Server implementing US Core Patient Profile with ethnicity extension support
- Patient resources with ethnicity data populated using the US Core Race and Ethnicity Extension
- Server must support the Patient resource type with search capabilities
- Test data should include patients with various ethnicity combinations to enable meaningful testing

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Patient resources with populated ethnicity extensions containing multiple ethnicity codes
- **Search Parameters**: 
  - `ethnicity` parameter with multiple values combined using AND logic
  - Patient identifier or other search criteria to establish baseline
- **Test Data Requirements**:
  - Patients with single ethnicity codes
  - Patients with multiple ethnicity codes
  - Patients with no ethnicity data
  - Mix of detailed and category ethnicity codes from the Race & Ethnicity - CDC (CDCREC) code system

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for Patient resources:
- `GET [base]/Patient?ethnicity=[code1]&ethnicity=[code2]` - Multiple AND ethnicity search
- `GET [base]/Patient?[baseline-criteria]` - Baseline search to establish expected results
- `GET [base]/Patient/[id]` - Individual patient retrieval for validation

### Validation Criteria

#### Test Case 1: Multiple AND Ethnicity Search Support
**Objective**: Verify server supports multiple ethnicity parameters with AND logic

**Test Steps**:
1. Execute search: `GET [base]/Patient?ethnicity=[ethnicity-code-1]&ethnicity=[ethnicity-code-2]`
2. Verify server responds with HTTP 200 status
3. Validate response is a valid FHIR Bundle
4. Confirm search did not result in an error indicating unsupported parameter usage

**Pass Criteria**: 
- Server processes the request without returning HTTP 400 (Bad Request) or similar error
- Response includes valid FHIR Bundle structure
- No error messages indicating multiple ethnicity parameters are unsupported

#### Test Case 2: Search Result Accuracy Validation
**Objective**: Verify search results contain only patients matching ALL specified ethnicity criteria

**Test Steps**:
1. Identify two distinct ethnicity codes present in test data
2. Execute individual searches for each ethnicity code to establish expected results
3. Execute combined AND search: `GET [base]/Patient?ethnicity=[code1]&ethnicity=[code2]`
4. Validate each returned patient contains BOTH ethnicity codes in their extension

**Pass Criteria**:
- All returned patients have ethnicity extensions containing both specified codes
- No patients returned that only match one of the specified ethnicity criteria
- Search results represent the intersection (AND logic) rather than union (OR logic) of individual searches

#### Test Case 3: Empty Result Set Handling
**Objective**: Verify proper handling when no patients match multiple ethnicity criteria

**Test Steps**:
1. Identify two ethnicity codes that do not co-exist in any patient record
2. Execute search: `GET [base]/Patient?ethnicity=[non-coexisting-code-1]&ethnicity=[non-coexisting-code-2]`
3. Validate response structure

**Pass Criteria**:
- Server returns HTTP 200 with empty Bundle (total=0)
- No errors or exceptions thrown
- Response maintains valid FHIR Bundle structure

#### Test Case 4: Parameter Format Validation
**Objective**: Verify server correctly handles different ethnicity parameter formats

**Test Steps**:
1. Test with system and code: `ethnicity=system|code`
2. Test with code only: `ethnicity=code`
3. Combine different formats in single AND search
4. Validate consistent behavior

**Pass Criteria**:
- Server processes both parameter formats correctly
- Mixed format searches work appropriately
- Results are consistent with individual format searches

### Expected Outputs
- HTTP 200 responses for valid searches
- FHIR Bundle resources containing Patient entries
- Accurate filtering based on AND logic for multiple ethnicity parameters
- Proper error handling for invalid parameter combinations
- Consistent behavior regardless of parameter format (system|code vs code-only)

### Notes
- This test verifies the `multipleAnd` capability for the ethnicity search parameter as referenced in the Capability Statement
- The requirement has MAY conformance, so servers are not required to support this functionality, but if supported, it must work correctly
- Test should accommodate various ethnicity coding systems and values present in the server's data
- Focus on interoperability compliance rather than exhaustive edge case testing

---

<a id='req-358'></a>

### REQ-358: The USCorePatientProfile SHALL map the patient identifier to the HL7 v2 PID-3 field.

**Text**: 

**Context**: Mappings for HL7 v2 for USCorePatientProfile

**Actor**: USCorePatientProfile

**Conformance**: SHALL

# Test Specification for REQ-358

## 1. Requirement ID
**REQ-358**: USCorePatientProfile SHALL map the patient identifier to the HL7 v2 PID-3 field

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified through automated testing by examining the mapping documentation and validating that US Core Patient profile instances correctly represent patient identifiers in a manner that would properly map to HL7 v2 PID-3.

### Complexity
**Simple** - This is a straightforward mapping verification that requires checking the presence and structure of patient identifiers in US Core Patient profiles.

### Prerequisites
- US Core Server supporting US Core Patient profile (as required by Capability Statement)
- Patient resources with identifiers available in the system under test
- Understanding of HL7 v2 PID-3 field requirements (patient identifier list)
- Access to US Core Patient profile mapping documentation

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: US Core Patient profile instances with populated identifier elements
- **System Access**: Read access to Patient resources via FHIR API
- **Documentation**: US Core Patient profile mapping specifications for HL7 v2

### Expected Outputs
- Patient resources conforming to US Core Patient profile
- Patient.identifier elements that can be properly mapped to HL7 v2 PID-3 structure
- Validation that identifier structure supports the required HL7 v2 PID-3 mapping

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required:

1. **GET /Patient/[id]** - Retrieve specific Patient resources
2. **GET /Patient?[search-parameters]** - Search for Patient resources (as supported by US Core Server capabilities)

### Validation Criteria

#### Primary Validation Checks:

1. **Profile Conformance Validation**
   - Verify that Patient resources declare conformance to US Core Patient profile
   - Check `meta.profile` contains `http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient`

2. **Identifier Structure Validation**
   - Verify that `Patient.identifier` elements are present and properly structured
   - Validate that identifier elements contain the necessary components that map to PID-3:
     - `identifier.value` (maps to PID-3.1 - ID Number)
     - `identifier.type` or `identifier.system` (maps to PID-3.5 - Identifier Type Code)
     - `identifier.assigner` if present (maps to PID-3.4 - Assigning Authority)

3. **Mapping Compatibility Validation**
   - Verify that identifier structure supports HL7 v2 PID-3 field mapping requirements
   - Confirm that required PID-3 components can be derived from the FHIR identifier structure
   - Validate that identifier.system URIs are appropriate and mappable to HL7 v2 identifier types

#### Test Pass Criteria:
- Patient resources successfully conform to US Core Patient profile
- All Patient.identifier elements contain sufficient data to support PID-3 mapping
- Identifier structure follows FHIR R4 specifications and US Core requirements
- No validation errors when checking mapping compatibility

#### Test Fail Criteria:
- Patient resources do not conform to US Core Patient profile
- Patient.identifier elements are missing required components for PID-3 mapping
- Identifier structure cannot support proper HL7 v2 PID-3 field population
- FHIR validation errors related to identifier elements

### Implementation Notes:
- This test should work with any Patient data in the system, following the "bring your own data" approach
- Focus on structural validation rather than specific identifier values
- Test should verify the mapping capability rather than actual HL7 v2 message generation
- Consider testing multiple Patient resources to ensure consistent mapping support across different identifier types and patterns

---

<a id='req-359'></a>

### REQ-359: The USCorePatientProfile SHALL map the patient name to the HL7 v2 PID-5 and PID-9 fields.

**Text**: 

**Context**: Mappings for HL7 v2 for USCorePatientProfile

**Actor**: USCorePatientProfile

**Conformance**: SHALL

# Test Specification for REQ-359

## 1. Requirement ID
**REQ-359**: USCorePatientProfile SHALL map patient name to HL7 v2 PID-5 and PID-9 fields

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Automatically testable

This requirement can be automatically tested by validating that Patient resources conforming to the USCorePatientProfile properly structure name data in a way that can be mapped to HL7 v2 PID-5 (Patient Name) and PID-9 (Patient Alias) fields. The test focuses on verifying the presence and structure of name elements rather than the actual mapping transformation.

### Complexity
**Level**: Simple

The requirement involves straightforward validation of FHIR Patient.name elements and their alignment with HL7 v2 mapping expectations.

### Prerequisites
- US Core Server implementation supporting USCorePatientProfile
- Patient resources with name data available in the system
- Access to Patient resources via FHIR REST API

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources**:
- Patient resources conforming to USCorePatientProfile with populated name elements

**Expected Outputs**:
- Patient resources containing properly structured name data that supports HL7 v2 PID-5 and PID-9 mapping requirements
- Validation confirmation that name structures align with mapping specifications

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required:

1. **GET /Patient/[id]** - Retrieve specific Patient resources
2. **GET /Patient?[search-parameters]** - Search for Patient resources
   - The Capability Statement confirms support for US Core Patient resource profile

### Validation Criteria

#### Primary Validation Checks:

1. **Profile Conformance Validation**:
   - Verify Patient resource declares conformance to USCorePatientProfile via `meta.profile`
   - Confirm resource passes USCorePatientProfile validation

2. **Name Structure Validation for PID-5 Mapping**:
   - Verify `Patient.name` array contains at least one HumanName element
   - For each name element that would map to PID-5:
     - Validate presence of name components (family, given, prefix, suffix as applicable)
     - Confirm `name.use` values are appropriate for primary patient identification
     - Verify name structure supports standard HL7 v2 PID-5 component mapping

3. **Name Structure Validation for PID-9 Mapping** (if applicable):
   - If Patient has multiple names or aliases:
     - Verify additional name entries have appropriate `name.use` values (e.g., 'old', 'maiden', 'nickname')
     - Confirm alias names maintain proper structure for PID-9 mapping
     - Validate that alias names are distinguishable from primary names

4. **Data Quality Checks**:
   - Verify name elements contain actual values (not empty strings)
   - Confirm name components are properly populated according to US Core requirements
   - Validate that name structure supports bidirectional mapping integrity

#### Test Execution Steps:

1. **Resource Retrieval**:
   ```
   GET /Patient/[patient-id]
   Accept: application/fhir+json
   ```

2. **Profile Validation**:
   - Confirm `meta.profile` includes US Core Patient profile URL
   - Validate resource against USCorePatientProfile schema

3. **Name Mapping Validation**:
   - Extract `Patient.name` elements
   - For primary name (typically `use="official"` or first name without specific use):
     - Verify structure supports PID-5 mapping (family name, given names, etc.)
   - For additional names:
     - Verify structure supports PID-9 mapping if applicable
     - Confirm appropriate use codes for alias identification

4. **Conformance Verification**:
   - Assert that name data structure enables complete and accurate mapping to HL7 v2 PID-5 and PID-9 fields
   - Verify no data loss would occur in the mapping process
   - Confirm mapping alignment with HL7 v2 specifications

#### Success Criteria:
- Patient resource successfully validates against USCorePatientProfile
- Name elements are structured to support complete HL7 v2 PID-5 mapping
- If multiple names present, structure supports PID-9 mapping for aliases
- All name components maintain data integrity for bidirectional mapping
- No validation errors related to name structure or mapping requirements

#### Failure Conditions:
- Patient resource does not conform to USCorePatientProfile
- Missing or improperly structured name elements
- Name structure insufficient for HL7 v2 PID-5/PID-9 mapping requirements
- Data integrity issues that would prevent accurate mapping

---

<a id='req-360'></a>

### REQ-360: The USCorePatientProfile SHALL map the patient gender to the HL7 v2 PID-8 field.

**Text**: 

**Context**: Mappings for HL7 v2 for USCorePatientProfile

**Actor**: USCorePatientProfile

**Conformance**: SHALL

# Test Specification for REQ-360

## 1. Requirement ID
REQ-360

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated validation of FHIR Patient resource instances against the mapping specification between FHIR gender field and HL7 v2 PID-8 field.

### Complexity
**Simple** - The requirement involves a direct field mapping validation between two well-defined data elements with established value sets.

### Prerequisites
- FHIR server implementing US Core Patient Profile
- Patient resources with populated gender field
- Knowledge of HL7 v2 PID-8 field specifications and valid values
- Understanding of FHIR to HL7 v2 gender mapping rules

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Patient resources conforming to US Core Patient Profile with gender field populated
- **Reference Data**: HL7 v2 PID-8 field value specifications and mapping table between FHIR gender codes and HL7 v2 PID-8 values

### Expected Outputs
- Validation confirmation that gender values in Patient resources can be appropriately mapped to valid HL7 v2 PID-8 field values
- Documentation of any mapping discrepancies or invalid gender values

### Required FHIR Operations
- **GET /Patient** - Retrieve Patient resources to validate gender field mapping
- **GET /Patient/[id]** - Retrieve specific Patient instances for detailed validation

### Validation Criteria

#### Primary Validation Checks:

1. **Gender Field Presence Validation**
   - Verify that Patient resources contain the gender field when required
   - Assert that gender field follows FHIR Patient.gender cardinality requirements

2. **Mapping Value Validation** 
   - For each Patient resource with a populated gender field:
     - Assert that the FHIR gender value (male, female, other, unknown) maps to a valid HL7 v2 PID-8 value
     - Verify mapping follows established FHIR to HL7 v2 conversion rules:
       - `male` → `M`
       - `female` → `F` 
       - `other` → `O`
       - `unknown` → `U`

3. **Profile Conformance Validation**
   - Assert that Patient resources claiming conformance to US Core Patient Profile properly implement the gender mapping requirement
   - Verify that meta.profile includes the US Core Patient Profile URL when present

#### Test Execution Steps:

1. **Resource Discovery**
   - Query for Patient resources using supported search parameters
   - Identify resources that claim conformance to US Core Patient Profile

2. **Gender Field Analysis**
   - Extract gender values from each Patient resource
   - Validate against FHIR gender value set (http://hl7.org/fhir/ValueSet/administrative-gender)

3. **Mapping Verification**
   - Apply FHIR to HL7 v2 PID-8 mapping rules to each gender value
   - Confirm successful mapping to valid PID-8 values
   - Document any unmappable or invalid gender values

4. **Conformance Assertion**
   - Assert that all Patient resources claiming US Core Patient Profile conformance successfully map gender values to HL7 v2 PID-8 format
   - Report any mapping failures as conformance violations

#### Pass Criteria:
- All Patient resources with populated gender fields can be successfully mapped to valid HL7 v2 PID-8 values
- No invalid or unmappable gender values are present in US Core Patient Profile conformant resources
- Gender field mapping follows the established FHIR to HL7 v2 conversion specification

#### Fail Criteria:
- Any Patient resource contains gender values that cannot be mapped to valid HL7 v2 PID-8 values
- Missing gender fields where required by the mapping specification
- Incorrect mapping implementation that violates the FHIR to HL7 v2 conversion rules

---

<a id='req-361'></a>

### REQ-361: The USCorePatientProfile SHALL map the patient birth date to the HL7 v2 PID-7 field.

**Text**: 

**Context**: Mappings for HL7 v2 for USCorePatientProfile

**Actor**: USCorePatientProfile

**Conformance**: SHALL

# Test Specification for REQ-361

## 1. Requirement ID
**REQ-361**: USCorePatientProfile SHALL map the patient birth date to the HL7 v2 PID-7 field

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Attestation

**Rationale**: This requirement pertains to data mapping between FHIR USCorePatientProfile and HL7 v2 PID-7 field, which is an internal implementation detail of how systems transform data between formats. The actual mapping logic cannot be directly tested through FHIR API interactions alone, as it requires verification of the transformation process from FHIR to HL7 v2 format.

### Complexity
**Moderate** - While the concept is straightforward (birth date mapping), it requires understanding of both FHIR Patient resource structure and HL7 v2 PID segment format, plus verification of the mapping implementation.

### Prerequisites
- System under test must support US Core Patient Profile
- System must have capability to generate or export HL7 v2 messages containing PID segments
- Test data must include Patient resources with birth dates populated
- Access to both FHIR Patient data and corresponding HL7 v2 PID output for comparison

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources**:
- Patient resources conforming to US Core Patient Profile with populated `birthDate` elements
- Patient resources should include various birth date formats and edge cases (partial dates, different precision levels)

**Expected Outputs**:
- Corresponding HL7 v2 messages containing PID segments with PID-7 field populated
- Documentation or system logs demonstrating the mapping implementation

### Required FHIR Operations
- **GET /Patient/[id]** - Retrieve Patient resources to verify birth date values
- **GET /Patient?[search parameters]** - Search for Patient resources (supported per US Core Server Capability Statement)

### Validation Criteria

#### Primary Assertions
1. **Mapping Completeness**: For each Patient resource with a populated `birthDate`, verify that the corresponding HL7 v2 PID-7 field contains the birth date information
2. **Data Fidelity**: Verify that the birth date value in FHIR `Patient.birthDate` correctly corresponds to the value in HL7 v2 PID-7, accounting for format differences
3. **Format Compliance**: Ensure HL7 v2 PID-7 follows the appropriate HL7 v2 date format specifications (YYYYMMDD or variations with time if applicable)

#### Test Scenarios
1. **Complete Birth Dates**: Test patients with full birth dates (YYYY-MM-DD format in FHIR)
2. **Partial Birth Dates**: Test patients with partial birth dates (YYYY-MM or YYYY only in FHIR)
3. **Missing Birth Dates**: Verify that patients without birth dates result in empty or appropriately handled PID-7 fields
4. **Edge Cases**: Test boundary dates (e.g., leap year dates, century boundaries)

#### Attestation Requirements
Since this is primarily an attestation-based test, implementers must provide:
1. **Documentation**: Written documentation describing how birth date mapping is implemented
2. **Sample Mappings**: Provide examples showing FHIR Patient birth dates and their corresponding HL7 v2 PID-7 representations
3. **Code Review Evidence**: If applicable, provide code snippets or configuration showing the mapping logic
4. **Test Results**: Demonstrate successful mapping through sample data transformations

#### Pass/Fail Criteria
**PASS**: 
- All Patient birth dates are correctly mapped to PID-7 fields
- Documentation clearly describes the mapping implementation
- Sample data demonstrates consistent and accurate transformation
- No birth date information is lost or corrupted during mapping

**FAIL**:
- Birth date information is missing from PID-7 when present in FHIR Patient
- Birth date values are incorrectly transformed or corrupted
- Inconsistent mapping behavior across different date formats
- Lack of adequate documentation or evidence of proper mapping implementation

### Implementation Notes
- This test requires coordination between FHIR API testing and HL7 v2 message verification
- Testers should use their own patient data but ensure it includes various birth date scenarios
- The test may require additional tooling to capture and analyze HL7 v2 message output
- Consider testing both real-time transformations and batch export scenarios if applicable

---

<a id='req-362'></a>

### REQ-362: The USCorePatientProfile SHALL map the patient address to the HL7 v2 PID-11 field.

**Text**: 

**Context**: Mappings for HL7 v2 for USCorePatientProfile

**Actor**: USCorePatientProfile

**Conformance**: SHALL

# Test Specification for REQ-362

## 1. Requirement ID
REQ-362

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be tested programmatically by examining FHIR Patient resources that conform to the USCorePatientProfile and verifying that address data is properly structured according to the HL7 v2 PID-11 mapping specification.

### Complexity
**Simple** - This is a straightforward mapping verification requirement that involves checking the presence and structure of address fields in Patient resources.

### Prerequisites
- US Core Server implementing USCorePatientProfile
- Patient resources with address information available in the system
- Access to US Core Patient profile specification and HL7 v2 PID-11 field mapping documentation
- Valid authentication credentials for server access

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Patient resources conforming to USCorePatientProfile that contain address information
- **Server Endpoint**: US Core compliant FHIR server
- **Authentication**: Valid credentials/tokens for server access

### Expected Outputs
- Patient resources with properly mapped address fields that align with HL7 v2 PID-11 structure
- Validation confirmation that address elements are present and correctly formatted

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required for testing:
- **GET /Patient/[id]** - Retrieve specific Patient resources
- **GET /Patient?[search-parameters]** - Search for Patient resources with address information

### Validation Criteria

#### Primary Assertions
1. **Profile Conformance**: Retrieved Patient resources SHALL declare conformance to USCorePatientProfile in `meta.profile`
2. **Address Presence**: Patient resources with addresses SHALL include the `address` element
3. **Address Structure Mapping**: Address elements SHALL be structured to support HL7 v2 PID-11 mapping requirements:
   - Address lines (street address components)
   - City
   - State/Province
   - Postal code
   - Country
   - Address type and use indicators

#### Specific Validation Steps
1. **Resource Retrieval Test**:
   - Retrieve Patient resources using supported search parameters
   - Verify HTTP 200 response status
   - Confirm JSON format compliance (required by Capability Statement)

2. **Profile Declaration Test**:
   - Verify `meta.profile` contains USCorePatientProfile canonical URL
   - Confirm resource validates against USCorePatientProfile

3. **Address Mapping Validation Test**:
   - For each Patient resource with address data:
     - Verify `address` array exists when address information is present
     - Check that address components align with PID-11 field structure:
       - `line` elements for street address (PID-11.1, PID-11.2)
       - `city` for city (PID-11.3)
       - `district` for county/parish (PID-11.4) if applicable
       - `state` for state/province (PID-11.5)
       - `postalCode` for ZIP code (PID-11.6)
       - `country` for country (PID-11.7)
       - `type` and `use` for address type classification
   - Verify address data types and cardinalities match FHIR Address datatype requirements

4. **Error Handling Test**:
   - Confirm appropriate HTTP status codes for invalid requests (400, 401, 403, 404 as specified in Capability Statement)

#### Success Criteria
- All retrieved Patient resources declare USCorePatientProfile conformance
- Address elements, when present, are structured in a manner that supports HL7 v2 PID-11 field mapping
- No validation errors when validating resources against USCorePatientProfile
- Server responses comply with US Core Server CapabilityStatement requirements

#### Failure Indicators
- Patient resources missing required profile declaration
- Address information present but not structured to support PID-11 mapping
- Resources fail validation against USCorePatientProfile
- Server responses not compliant with declared capabilities

---

<a id='req-363'></a>

### REQ-363: The USCorePatientProfile SHALL map the patient marital status to the HL7 v2 PID-16 field.

**Text**: 

**Context**: Mappings for HL7 v2 for USCorePatientProfile

**Actor**: USCorePatientProfile

**Conformance**: SHALL

# Test Specification for REQ-363

## Requirement ID
REQ-363

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified by examining FHIR Patient resource instances that conform to USCorePatientProfile and validating that the marital status field properly maps to HL7 v2 PID-16 format and values.

### Complexity
**Simple** - The requirement involves validating a single field mapping between FHIR and HL7 v2 formats, with well-defined value sets and mapping specifications.

### Prerequisites
- Test system must support US Core Server capabilities as defined in the CapabilityStatement
- Test system must have Patient resources conforming to USCorePatientProfile
- Test system must support JSON format (required) and optionally XML format
- Patient resources should include marital status data for meaningful testing
- Understanding of HL7 v2 PID-16 field specifications and valid values

## Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Patient resources conforming to USCorePatientProfile that contain marital status information
- Patient resources should represent various marital status values to test comprehensive mapping

**Expected Outputs:**
- Validation that Patient.maritalStatus values properly correspond to HL7 v2 PID-16 acceptable values
- Confirmation that the mapping preserves semantic meaning between FHIR and HL7 v2 representations

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are supported and required:

1. **GET /Patient/[id]** - Retrieve specific Patient resources to examine marital status mapping
2. **GET /Patient?[search-parameters]** - Search for Patient resources with marital status criteria
3. **GET /Patient** - Retrieve Patient resources for batch validation

*Note: All operations must support JSON format (SHALL requirement) and may support XML format (SHOULD requirement)*

### Validation Criteria

**Primary Assertions:**
1. **Marital Status Presence Validation:**
   - When Patient.maritalStatus is present, verify the value can be appropriately mapped to HL7 v2 PID-16
   - Ensure the mapping maintains semantic equivalence between FHIR and HL7 v2 representations

2. **Value Set Compliance:**
   - Validate that Patient.maritalStatus values conform to the expected FHIR marital status value set
   - Confirm that mapped values are valid for HL7 v2 PID-16 field specifications

3. **Data Type Mapping:**
   - Verify that FHIR CodeableConcept structure for maritalStatus appropriately maps to HL7 v2 PID-16 coded element format
   - Ensure code, display, and system values are preserved or appropriately transformed

4. **Profile Conformance:**
   - Confirm Patient resources declare conformance to USCorePatientProfile via meta.profile
   - Validate overall resource structure meets US Core Patient profile requirements

**Test Scenarios:**
1. **Standard Marital Status Values:** Test common values (married, single, divorced, widowed, etc.)
2. **Null/Missing Values:** Verify appropriate handling when marital status is not provided
3. **Multiple Coding Systems:** Test resources that may use different coding systems for marital status
4. **Edge Cases:** Validate handling of unknown or system-specific marital status codes

**Pass Criteria:**
- All Patient resources with marital status successfully demonstrate valid HL7 v2 PID-16 mapping
- No semantic data loss occurs during the mapping process
- All mapped values comply with both FHIR US Core and HL7 v2 specifications
- Resources properly validate against USCorePatientProfile requirements

**Failure Indicators:**
- Marital status values that cannot be mapped to valid HL7 v2 PID-16 values
- Loss of semantic meaning during mapping
- Invalid or non-conformant marital status representations
- Resources that fail USCorePatientProfile validation when marital status is present

---

<a id='req-364'></a>

### REQ-364: The USCorePatientProfile SHALL map the patient multiple birth indicator to the HL7 v2 PID-24 field.

**Text**: 

**Context**: Mappings for HL7 v2 for USCorePatientProfile (multiple birth indicator)

**Actor**: USCorePatientProfile

**Conformance**: SHALL

# Test Specification for REQ-364

## Requirement ID
REQ-364

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement involves verifying that a FHIR Patient resource conforming to USCorePatientProfile correctly maps the `multipleBirth[x]` element to the HL7 v2 PID-24 field. This can be tested by examining the resource structure and validating the mapping logic.

### Complexity
**Simple** - The requirement focuses on a single field mapping validation between FHIR and HL7 v2 formats.

### Prerequisites
- System must support US Core Patient Profile
- System must be capable of HL7 v2 to FHIR transformation or vice versa
- Test data must include Patient resources with multiple birth information
- Access to Patient resources that contain `multipleBirth[x]` elements

## Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Patient resources conforming to USCorePatientProfile that contain `multipleBirth[x]` elements
- Expected variations:
  - `multipleBirthBoolean`: true/false values indicating multiple birth status
  - `multipleBirthInteger`: integer values indicating birth order in multiple births

**Expected Outputs:**
- Confirmation that the `multipleBirth[x]` element values correctly correspond to HL7 v2 PID-24 field specifications
- Validation that the mapping preserves semantic meaning between formats

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required:

1. **GET /Patient/{id}** - Retrieve individual Patient resources to examine multiple birth elements
2. **GET /Patient?[search-parameters]** - Search for Patient resources (if specific multiple birth searches are needed)

*Note: These operations align with the US Core Server capability requirements for supporting Patient resource profiles.*

### Validation Criteria

**Primary Assertions:**

1. **Element Presence Validation:**
   - When a Patient resource contains `multipleBirthBoolean`, verify it maps to PID-24 as a boolean indicator (Y/N)
   - When a Patient resource contains `multipleBirthInteger`, verify it maps to PID-24 as the birth order number

2. **Data Type Consistency:**
   - `multipleBirthBoolean = true` should map to PID-24 = "Y" 
   - `multipleBirthBoolean = false` should map to PID-24 = "N"
   - `multipleBirthInteger` values should map directly to PID-24 as numeric values (1, 2, 3, etc.)

3. **Mapping Completeness:**
   - All Patient resources with multiple birth data must have the mapping applied
   - No multiple birth information should be lost or incorrectly transformed

**Test Pass Criteria:**
- All Patient resources with `multipleBirth[x]` elements demonstrate correct mapping to PID-24 field specifications
- Data type transformations maintain semantic accuracy
- No mapping errors or data loss occurs during transformation

**Test Fail Criteria:**
- Any Patient resource with `multipleBirth[x]` element fails to map correctly to PID-24
- Data type mismatches (e.g., boolean mapped as integer or vice versa)
- Missing or incomplete mapping implementation
- Semantic meaning altered during transformation process

---

<a id='req-365'></a>

### REQ-365: The USCorePatientProfile SHALL map the patient multiple birth order number to the HL7 v2 PID-25 field.

**Text**: 

**Context**: Mappings for HL7 v2 for USCorePatientProfile (multiple birth order)

**Actor**: USCorePatientProfile

**Conformance**: SHALL

# Test Specification for REQ-365

## 1. Requirement ID
REQ-365

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement involves verifying that a specific FHIR element (Patient.multipleBirthInteger) correctly maps to an HL7 v2 field (PID-25). The mapping can be validated through automated testing by examining Patient resources that contain multiple birth order information.

### Complexity
**Simple** - The requirement involves a straightforward field mapping verification between FHIR and HL7 v2 formats. The test needs to verify that when a Patient resource contains multiple birth order data, it properly represents the HL7 v2 PID-25 field semantics.

### Prerequisites
- US Core Server implementing USCorePatientProfile
- Patient resources containing multiple birth order information (Patient.multipleBirthInteger populated)
- Server capability to return Patient resources via FHIR RESTful operations
- Understanding of HL7 v2 PID-25 field specifications for multiple birth order

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Patient resources conforming to USCorePatientProfile that include:
  - `Patient.multipleBirthInteger` element populated with integer values representing birth order
  - Patient resources where multiple birth order is relevant (twins, triplets, etc.)

**Expected Outputs:**
- Patient resources with correctly mapped multiple birth order values
- Proper representation of HL7 v2 PID-25 semantics in FHIR Patient.multipleBirthInteger

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are supported and required:

1. **Patient Read Operation**: `GET [base]/Patient/[id]`
   - Retrieve specific Patient resources to examine multiple birth order mapping

2. **Patient Search Operations**: `GET [base]/Patient?[parameters]`
   - Search for Patient resources to identify those with multiple birth information
   - Use appropriate search parameters to locate relevant test data

### Validation Criteria

The following checks must be performed to verify conformance:

#### Primary Validation Assertions:

1. **Presence Validation**:
   - ASSERT: Patient resources with multiple birth scenarios contain `Patient.multipleBirthInteger` element
   - ASSERT: The element is properly populated with integer values

2. **Data Type Validation**:
   - ASSERT: `Patient.multipleBirthInteger` contains integer values only
   - ASSERT: Values are positive integers (1, 2, 3, etc.) representing birth order

3. **Semantic Mapping Validation**:
   - ASSERT: Integer values correctly represent HL7 v2 PID-25 semantics:
     - Value "1" indicates first-born of multiple birth
     - Value "2" indicates second-born of multiple birth
     - And so forth for higher-order multiples

4. **Profile Conformance**:
   - ASSERT: Patient resources validate against USCorePatientProfile
   - ASSERT: Resources include proper `meta.profile` reference to USCorePatientProfile (recommended per CapabilityStatement)

#### Supporting Validation Checks:

5. **Consistency Validation**:
   - ASSERT: When `Patient.multipleBirthInteger` is present, it should be consistent with `Patient.multipleBirthBoolean` if also present
   - ASSERT: Multiple birth order values are logical (no order value exceeds reasonable multiple birth scenarios)

6. **Format Compliance**:
   - ASSERT: Resources return in JSON format (required by CapabilityStatement)
   - ASSERT: Proper HTTP response codes for successful retrievals (200 OK)

#### Test Execution Flow:

1. **Discovery Phase**:
   - Search for Patient resources using appropriate parameters
   - Identify resources with multiple birth information

2. **Retrieval Phase**:
   - Retrieve identified Patient resources
   - Verify successful HTTP responses

3. **Validation Phase**:
   - Validate resources against USCorePatientProfile
   - Check presence and format of `Patient.multipleBirthInteger`
   - Verify integer values represent proper birth order semantics
   - Confirm HL7 v2 PID-25 mapping compliance

#### Pass/Fail Criteria:

- **PASS**: All Patient resources with multiple birth scenarios properly map multiple birth order to `Patient.multipleBirthInteger` with correct integer values representing HL7 v2 PID-25 semantics
- **FAIL**: Any Patient resource fails to properly represent multiple birth order mapping, contains invalid data types, or violates USCorePatientProfile requirements

---

<a id='req-366'></a>

### REQ-366: The USCorePatientProfile SHALL map the patient communication language to the HL7 v2 PID-15 and LAN-2 fields.

**Text**: 

**Context**: Mappings for HL7 v2 for USCorePatientProfile (communication)

**Actor**: USCorePatientProfile

**Conformance**: SHALL

# Test Specification for REQ-366

## 1. Requirement ID
REQ-366

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be validated programmatically by examining FHIR Patient resources that contain communication elements and verifying the presence of appropriate mapping documentation or implementation behavior that demonstrates compliance with the HL7 v2 PID-15 and LAN-2 field mappings.

### Complexity
**Moderate** - The test requires understanding of both FHIR Patient resource structure and HL7 v2 message format mappings. It involves validating that communication language data can be appropriately mapped between these two standards.

### Prerequisites
- System must support US Core Patient Profile
- Test data must include Patient resources with communication language information
- Access to system documentation or implementation details regarding HL7 v2 mapping capabilities
- Understanding of HL7 v2 PID-15 (Primary Language) and LAN-2 (Language Code) field specifications

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Patient resources conforming to US Core Patient Profile that contain `communication` elements with language information
- Resources should include various scenarios:
  - Patients with single communication language
  - Patients with multiple communication languages
  - Patients with communication preferences (preferred language)

**Expected Outputs:**
- Verification that communication language data structure supports mapping to HL7 v2 PID-15 and LAN-2
- Confirmation that language codes are compatible with HL7 v2 requirements
- Documentation or evidence of mapping implementation

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required:

1. **GET /Patient/[id]** - Retrieve specific Patient resources to examine communication elements
2. **GET /Patient?[search-parameters]** - Search for Patient resources with communication data
3. **GET /Patient** - Retrieve Patient resources for bulk analysis of communication patterns

### Validation Criteria

**Primary Assertions:**
1. **Communication Element Structure Validation:**
   - Verify that Patient resources contain `communication` elements when language information is present
   - Confirm `communication.language` uses appropriate coding system (e.g., urn:ietf:bcp:47)
   - Validate that language codes are structured to support HL7 v2 PID-15 mapping requirements

2. **Language Code Compatibility:**
   - Ensure language codes in `communication.language.coding.code` can be mapped to HL7 v2 LAN-2 format
   - Verify language codes follow standards that are compatible with HL7 v2 requirements
   - Confirm primary language designation supports PID-15 mapping

3. **Communication Preference Mapping:**
   - When `communication.preferred` is true, verify this can map to HL7 v2 PID-15 (Primary Language)
   - Validate that multiple communication entries can be appropriately prioritized for HL7 v2 mapping

4. **Data Completeness for Mapping:**
   - Confirm that communication language data includes sufficient information for complete HL7 v2 mapping
   - Verify that language representation supports both PID-15 and LAN-2 field requirements

**Specific Test Cases:**

**Test Case 1: Single Primary Language Mapping**
- Retrieve Patient resources with single communication language
- Assert: `communication.language` is present and uses valid coding
- Assert: Language code format is compatible with HL7 v2 PID-15 mapping
- Assert: If `communication.preferred` is true, it represents the primary language for PID-15

**Test Case 2: Multiple Language Mapping**
- Retrieve Patient resources with multiple communication entries  
- Assert: Each `communication.language` entry can be mapped to LAN-2 format
- Assert: Primary language (preferred=true) can be identified for PID-15 mapping
- Assert: Secondary languages are structured for appropriate LAN segment mapping

**Test Case 3: Language Code Standard Compliance**
- Examine language coding systems used in communication elements
- Assert: Language codes use standards compatible with HL7 v2 requirements
- Assert: Code values can be transformed/mapped to HL7 v2 expected formats

**Success Criteria:**
- All Patient resources with communication data demonstrate structure that supports HL7 v2 PID-15 and LAN-2 mapping
- Language codes are formatted in a way that enables conversion to HL7 v2 requirements  
- Primary language designation is clearly identifiable for PID-15 mapping
- Multiple language support enables appropriate LAN segment population

**Failure Indicators:**
- Communication language data uses coding systems incompatible with HL7 v2 mapping
- Missing or inadequate language information that prevents complete HL7 v2 mapping
- Inability to identify primary language for PID-15 field population
- Language code formats that cannot be transformed to meet HL7 v2 LAN-2 requirements

---

<a id='req-367'></a>

### REQ-367: The USCorePatientProfile SHALL map the patient preferred language to the HL7 v2 PID-15 field.

**Text**: 

**Context**: Mappings for HL7 v2 for USCorePatientProfile (communication)

**Actor**: USCorePatientProfile

**Conformance**: SHALL

# Test Specification for REQ-367

## 1. Requirement ID
REQ-367

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement involves verifying that the USCorePatientProfile correctly maps patient preferred language data to HL7 v2 PID-15 field format, which can be validated through automated inspection of FHIR Patient resource structure and content.

### Complexity
**Simple** - The test involves validating the presence and format of communication elements in a Patient resource according to the US Core Patient profile specification.

### Prerequisites
- Test system must support US Core Server capabilities as defined in the Capability Statement
- Test system must have Patient resources that contain communication/language preference data
- Test system must support JSON format (required) and optionally XML format
- Valid authentication/authorization credentials for accessing Patient resources

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Patient resources conforming to USCorePatientProfile that contain communication language preferences
- **System Endpoint**: FHIR server base URL supporting US Core Server capabilities
- **Authentication**: Valid credentials/tokens as per system security requirements

### Expected Outputs
- Patient resource(s) with properly structured `communication` elements
- Each communication element should contain appropriate language coding that can be mapped to HL7 v2 PID-15 format
- Resources should validate against the USCorePatientProfile

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required for testing:

1. **GET /Patient/[id]** - Retrieve specific Patient resource by ID
2. **GET /Patient?[search parameters]** - Search for Patient resources (using US Core supported search parameters)

### Validation Criteria

#### Primary Validation Checks:
1. **Profile Conformance**: Retrieved Patient resources SHALL conform to the USCorePatientProfile
   - Verify `meta.profile` contains the US Core Patient profile URL (if present)
   - Resource passes validation against USCorePatientProfile constraints

2. **Communication Element Structure**: For Patient resources containing language preferences:
   - `Patient.communication` element is present when language preference data exists
   - `Patient.communication.language` contains a valid coding from an appropriate value set
   - The language coding structure supports mapping to HL7 v2 PID-15 field requirements

3. **Data Mapping Compatibility**: Language preference data structure SHALL be compatible with HL7 v2 PID-15 mapping:
   - Language codes follow standard coding systems (e.g., ISO 639-1, ISO 639-2)
   - Communication element includes sufficient detail for HL7 v2 mapping
   - Preferred language indicator is appropriately represented (via `communication.preferred` if applicable)

#### Secondary Validation Checks:
1. **Response Format**: Server returns valid JSON (required) or XML (optional) format
2. **HTTP Status Codes**: Appropriate response codes (200 for success, 404 for not found, etc.)
3. **Security Compliance**: Proper handling of authentication/authorization as per Capability Statement requirements

#### Test Execution Steps:
1. **Discovery Phase**: Query the server for Patient resources containing communication data
2. **Retrieval Phase**: Retrieve Patient resources using supported FHIR operations
3. **Validation Phase**: 
   - Validate each Patient resource against USCorePatientProfile
   - Verify communication language structure and coding
   - Confirm mapping compatibility with HL7 v2 PID-15 requirements
4. **Conformance Assessment**: Document any deviations from expected mapping structure

#### Pass/Fail Criteria:
- **PASS**: All Patient resources with language preferences contain properly structured communication elements that support HL7 v2 PID-15 mapping
- **FAIL**: Any Patient resource with language preference data lacks proper communication element structure or contains language coding incompatible with HL7 v2 PID-15 mapping requirements
- **N/A**: No Patient resources contain language preference data (test cannot be executed)

---

<a id='req-500'></a>

### REQ-500: The extension must only be used on email contact points.

**Text**: 

**Context**: US Core Direct Email Extension – applicable ContactPoint.system constraint

**Actor**: FHIR Implementer

**Conformance**: SHALL

# Test Specification for REQ-500

## 1. Requirement ID
**REQ-500**: US Core Direct Email Extension – ContactPoint.system constraint

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified programmatically by examining FHIR resources that contain the US Core Direct Email Extension and validating that it only appears on ContactPoint elements where the system value is "email".

### Complexity
**Simple** - The test involves a straightforward validation of extension usage context within ContactPoint elements.

### Prerequisites
- FHIR server implementing US Core profiles that support the US Core Direct Email Extension
- Test data containing Patient or other resources with ContactPoint elements
- Access to resources that may contain the US Core Direct Email Extension (`http://hl7.org/fhir/us/core/StructureDefinition/us-core-direct`)

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Any US Core resources that contain ContactPoint elements (e.g., Patient, Practitioner, PractitionerRole, Organization, Location)
- Resources should include various ContactPoint configurations:
  - ContactPoint elements with system = "email" 
  - ContactPoint elements with system values other than "email" (phone, fax, url, sms, other)
  - ContactPoint elements that may contain the US Core Direct Email Extension

**Expected Outputs:**
- Validation results indicating whether the US Core Direct Email Extension is properly constrained to email ContactPoints only
- Clear identification of any violations where the extension appears on non-email ContactPoints

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are supported and required for this test:

1. **Patient read/search operations** - to retrieve Patient resources with ContactPoint elements
2. **Organization read/search operations** - to retrieve Organization resources with ContactPoint elements  
3. **Practitioner read/search operations** - to retrieve Practitioner resources with ContactPoint elements
4. **PractitionerRole read/search operations** - to retrieve PractitionerRole resources with ContactPoint elements
5. **Location read/search operations** - to retrieve Location resources with ContactPoint elements

All operations must support JSON format as required by the CapabilityStatement.

### Validation Criteria

**Primary Assertions:**
1. **Extension Context Validation**: For every instance of the US Core Direct Email Extension (`http://hl7.org/fhir/us/core/StructureDefinition/us-core-direct`) found in any resource:
   - Assert that the extension appears only within ContactPoint elements
   - Assert that the parent ContactPoint element has `system = "email"`

2. **Constraint Compliance**: For every ContactPoint element with `system != "email"`:
   - Assert that the US Core Direct Email Extension is NOT present

3. **Valid Email ContactPoints**: For ContactPoint elements with `system = "email"`:
   - The US Core Direct Email Extension MAY be present (not required, but if present, must be valid)
   - If the extension is present, validate that it contains appropriate boolean value

**Test Pass Criteria:**
- No instances of the US Core Direct Email Extension found on ContactPoint elements where system is not "email"
- All instances of the extension are properly structured and contain valid boolean values
- Server responses conform to US Core CapabilityStatement requirements (JSON format, appropriate HTTP status codes)

**Test Fail Criteria:**
- Any instance of the US Core Direct Email Extension found on a ContactPoint where `system != "email"`
- Extension present but malformed or containing invalid data types
- Server returns unexpected HTTP status codes or non-conformant responses

**Implementation Notes:**
- The test should accommodate "bring your own data" by scanning all available resources for ContactPoint elements rather than requiring specific test fixtures
- The test should handle cases where no US Core Direct Email Extensions are present (this is a valid state)
- Validation should be performed across all resource types that can contain ContactPoint elements, not limited to Patient resources only

---

<a id='req-505'></a>

### REQ-505: The US Core Sex Extension URL requirement

**Text**: 

**Context**: US Core Sex Extension – fixed URL constraint

**Actor**: System implementing the US Core Sex Extension

**Conformance**: SHALL

# Test Specification for REQ-505: US Core Sex Extension URL Requirement

## 1. Requirement ID
**REQ-505**: The US Core Sex Extension URL requirement

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be validated through automated inspection of FHIR resources containing the US Core Sex Extension to verify the extension URL matches the expected fixed value.

### Complexity
**Simple** - The test involves a straightforward string comparison of the extension URL against the expected canonical URL for the US Core Sex Extension.

### Prerequisites
- System must implement US Core Patient resource profile (as mandated by the Capability Statement)
- System must have Patient resources that contain the US Core Sex Extension
- Test system must have access to retrieve Patient resources via FHIR RESTful operations
- System must support JSON format (required by Capability Statement)

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Patient resources that contain the US Core Sex Extension
- **Expected Extension URL**: `http://hl7.org/fhir/us/core/StructureDefinition/us-core-sex` (standard US Core Sex Extension canonical URL)
- **System Endpoint**: FHIR server base URL implementing US Core Server capabilities

### Required FHIR Operations
Based on the Capability Statement requirements:
- **GET** `/Patient` - Search for Patient resources (supported as part of US Core Patient profile requirement)
- **GET** `/Patient/{id}` - Read specific Patient resources (supported as part of US Core Patient profile requirement)

### Validation Criteria

#### Primary Validation
1. **Extension URL Verification**: For each Patient resource containing a sex extension:
   - Locate all extensions with type/category related to sex
   - Verify that the `Extension.url` field exactly matches: `http://hl7.org/fhir/us/core/StructureDefinition/us-core-sex`
   - **Pass Condition**: All sex extensions use the correct canonical URL
   - **Fail Condition**: Any sex extension uses an incorrect, non-canonical, or malformed URL

#### Secondary Validations
2. **Extension Structure Validation**: 
   - Verify the extension follows proper FHIR Extension structure
   - Confirm the extension appears in the correct location within the Patient resource
   - **Pass Condition**: Extension is properly structured and located
   - **Fail Condition**: Extension is malformed or incorrectly placed

3. **Resource Profile Compliance**:
   - Verify Patient resources declare conformance to US Core Patient profile via `meta.profile`
   - **Pass Condition**: Resources properly declare US Core profile conformance
   - **Fail Condition**: Resources missing required profile declarations

#### Test Execution Flow
1. **Discovery Phase**: Query the system for Patient resources containing sex extensions
2. **Collection Phase**: Retrieve a representative sample of Patient resources with sex extensions
3. **Validation Phase**: Inspect each extension URL for exact match with canonical URL
4. **Reporting Phase**: Document any non-conformant extension URLs with specific resource identifiers

#### Error Handling Validation
- Verify system returns appropriate HTTP status codes (400, 401/4xx, 403, 404) as specified in Capability Statement
- Ensure JSON format responses are properly structured
- Validate that unauthorized requests are properly rejected

#### Success Metrics
- **100% Compliance**: All discovered US Core Sex Extensions use the correct canonical URL
- **Resource Coverage**: Test executes against sufficient sample size of Patient resources to demonstrate consistent implementation
- **Format Compliance**: All responses follow required JSON formatting standards

---

<a id='req-506'></a>

### REQ-506: The US Core Sex Extension value requirement

**Text**: 

**Context**: US Core Sex Extension – value type and binding conformance

**Actor**: System implementing the US Core Sex Extension

**Conformance**: SHALL

# Test Specification for REQ-506

## 1. Requirement ID
**REQ-506**: US Core Sex Extension value requirement

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated through automated inspection of FHIR resources containing the US Core Sex Extension to verify the value type and binding conformance.

### Complexity
**Simple** - The test involves straightforward validation of extension value type and conformance to the specified binding.

### Prerequisites
- System must implement US Core profiles that support the US Core Sex Extension
- Test data must include FHIR resources with the US Core Sex Extension populated
- Access to the US Core Sex Extension definition and value set binding requirements
- FHIR R4 validation capabilities

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Any FHIR resources that contain the US Core Sex Extension (typically Patient resources)
- Resources should represent real-world usage patterns with the extension populated

**Expected Outputs:**
- Validation results confirming extension value type compliance
- Verification of value set binding conformance
- Pass/fail status for each tested resource

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are supported and can be used for testing:

- **GET** operations on resources containing the US Core Sex Extension
- **Search** operations to retrieve resources with the extension for validation
- Standard FHIR **read** operations for individual resource validation

### Validation Criteria

The following assertions must pass to demonstrate conformance:

1. **Extension Structure Validation:**
   - Verify that the US Core Sex Extension is present in the expected location within the resource
   - Confirm the extension URL matches the official US Core Sex Extension URL

2. **Value Type Conformance:**
   - Validate that the extension.value[x] element uses the correct data type as specified in the US Core Sex Extension definition
   - Ensure the value element is populated (not empty or null)

3. **Value Set Binding Compliance:**
   - Verify that the extension value conforms to the bound value set requirements
   - Confirm the coded value (if applicable) is from the specified value set
   - Validate that the binding strength requirements (SHALL/SHOULD/MAY) are met

4. **Cardinality Compliance:**
   - Ensure the extension appears with the correct cardinality as defined in the US Core specification
   - Verify no violations of minimum or maximum occurrence rules

**Test Pass Criteria:**
- All extension instances found in the test data pass structural validation
- All extension values conform to the specified data type requirements
- All extension values comply with the bound value set constraints
- No cardinality violations are detected

**Test Fail Criteria:**
- Any extension instance fails structural validation
- Extension values use incorrect data types
- Extension values violate value set binding requirements
- Cardinality constraints are violated

The test should be executed against all available resources containing the US Core Sex Extension in the test dataset to ensure comprehensive coverage of the implementation's conformance to this requirement.

---

<a id='req-507'></a>

### REQ-507: Extensible binding requirement for the US Core Sex Extension

**Text**: 

**Context**: US Core Sex Extension – extensible binding behavior

**Actor**: System implementing the US Core Sex Extension

**Conformance**: SHALL

# Test Specification for REQ-507

## 1. Requirement ID
**REQ-507**: Extensible binding requirement for the US Core Sex Extension

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be automatically validated by examining FHIR resources containing the US Core Sex Extension and verifying that the extension values conform to extensible binding rules.

### Complexity
**Simple** - The test involves validating extension values against a known value set with extensible binding semantics.

### Prerequisites
- System must implement US Core Server capabilities as defined in the CapabilityStatement
- System must support resources that can contain the US Core Sex Extension
- Test data must include resources with the US Core Sex Extension populated
- Access to the US Core Sex value set for validation

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Any FHIR resource containing the US Core Sex Extension (`http://hl7.org/fhir/us/core/StructureDefinition/us-core-sex`)
- Common resources that may contain this extension include:
  - Patient resources
  - RelatedPerson resources
  - Practitioner resources

**Expected Outputs:**
- Validation results indicating conformance to extensible binding requirements
- List of any extension values that fall outside the core value set (should include appropriate coding system)

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are supported and may be used:

1. **GET operations** for retrieving resources containing the extension:
   - `GET [base]/Patient/{id}`
   - `GET [base]/RelatedPerson/{id}`
   - `GET [base]/Practitioner/{id}`
   - Search operations as supported by the capability statement

2. **Search operations** to identify resources with the sex extension:
   - Patient search with various parameters
   - RelatedPerson search with various parameters
   - Practitioner search with various parameters

### Validation Criteria

The test SHALL verify the following assertions for extensible binding conformance:

#### Primary Assertions:
1. **Extension Structure Validation**:
   - Verify that the US Core Sex Extension uses the correct canonical URL: `http://hl7.org/fhir/us/core/StructureDefinition/us-core-sex`
   - Verify that the extension.valueCodeableConcept is properly structured

2. **Extensible Binding Validation**:
   - **For values from the core value set**: Verify that codes from the AdministrativeGender value set (`http://hl7.org/fhir/ValueSet/administrative-gender`) are used correctly
   - **For values outside the core value set**: When systems use codes not in the core value set, verify that:
     - The coding includes an appropriate code system URI
     - The coding includes a valid code value
     - The coding includes appropriate display text when available
     - The additional codes represent valid sex/gender concepts

3. **Data Type Conformance**:
   - Verify that extension values use CodeableConcept data type
   - Verify proper structure of coding elements within CodeableConcept

#### Passing Criteria:
- **PASS**: All extension instances conform to extensible binding rules:
  - Core value set codes are used correctly when applicable, OR
  - External codes are properly structured with valid code systems and represent appropriate concepts
- **FAIL**: Any extension instance violates extensible binding rules:
  - Uses malformed coding structures
  - Uses inappropriate or invalid code systems
  - Uses codes that don't represent sex/gender concepts
  - Missing required coding elements for external codes

#### Test Execution Approach:
1. Query the system for resources containing the US Core Sex Extension using supported operations from the CapabilityStatement
2. Extract all instances of the sex extension from returned resources
3. For each extension instance:
   - Validate the extension URL
   - Validate the CodeableConcept structure
   - Check if codes are from the core AdministrativeGender value set
   - For external codes, validate proper coding structure and semantic appropriateness
4. Report conformance results with specific details about any non-conformant instances

**Note**: This test accommodates a "bring your own data" approach by validating whatever sex extension data exists in the system under test, without requiring specific test fixtures or predetermined data sets.

---

<a id='req-508'></a>

### REQ-508: The value of the extension must be from a specified value set.

**Text**: 

**Context**: US Core Birth Sex Extension – required binding to Birth Sex value set

**Actor**: Implementer

**Conformance**: SHALL

# Test Specification for REQ-508

## 1. Requirement ID
REQ-508

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be automatically tested by validating that the extension value conforms to the specified Birth Sex value set binding.

### Complexity
**Simple** - The test involves straightforward value set validation against a well-defined set of permitted values.

### Prerequisites
- US Core Server implementation supporting Patient resources with US Core Patient profile
- Test system capable of retrieving Patient resources and validating extensions
- Access to the Birth Sex value set definition (http://hl7.org/fhir/us/core/ValueSet/birthsex)
- Patient resources containing the US Core Birth Sex Extension in the test dataset

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Patient resources that contain the US Core Birth Sex Extension (`http://hl7.org/fhir/us/core/StructureDefinition/us-core-birthsex`)
- **Value Set**: Birth Sex value set (http://hl7.org/fhir/us/core/ValueSet/birthsex) containing valid codes:
  - `F` (Female)
  - `M` (Male) 
  - `UNK` (Unknown)

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required for testing:

1. **Patient Search Operations**:
   - `GET [base]/Patient` - Search for patients to identify test candidates
   - `GET [base]/Patient/[id]` - Retrieve specific patient resources for validation

2. **Format Support**:
   - JSON format (SHALL be supported per Capability Statement)
   - XML format (SHOULD be supported per Capability Statement)

### Expected Outputs
- Patient resources with Birth Sex extensions that have values conforming to the Birth Sex value set
- Validation results confirming extension values are from the specified value set

### Validation Criteria

#### Test Case 1: Valid Birth Sex Extension Values
**Objective**: Verify that Patient resources with Birth Sex extensions contain only valid values from the Birth Sex value set.

**Test Steps**:
1. Retrieve Patient resources from the server that contain the US Core Birth Sex Extension
2. For each Patient resource found:
   - Locate the extension with URL `http://hl7.org/fhir/us/core/StructureDefinition/us-core-birthsex`
   - Extract the `valueCode` from the extension
   - Validate that the code is one of the permitted values: `F`, `M`, or `UNK`

**Pass Criteria**:
- All Birth Sex extension values found in Patient resources are from the Birth Sex value set (`F`, `M`, or `UNK`)
- No invalid or non-conformant values are present in the extension

**Fail Criteria**:
- Any Birth Sex extension contains a value not in the Birth Sex value set
- Extension values are of incorrect data type (not `valueCode`)

#### Test Case 2: Extension Structure Validation
**Objective**: Verify that the Birth Sex extension is properly structured when present.

**Test Steps**:
1. For Patient resources containing the Birth Sex extension:
   - Verify the extension URL is exactly `http://hl7.org/fhir/us/core/StructureDefinition/us-core-birthsex`
   - Confirm the extension uses `valueCode` element (not other value[x] variants)
   - Validate that the extension structure follows FHIR extension patterns

**Pass Criteria**:
- Extension URL matches the expected US Core Birth Sex Extension URL
- Extension value is provided as `valueCode`
- Extension structure conforms to FHIR extension requirements

**Fail Criteria**:
- Incorrect extension URL
- Missing or incorrectly typed value element
- Malformed extension structure

#### Test Case 3: Server Response Validation
**Objective**: Ensure the server properly returns Patient resources with valid Birth Sex extensions.

**Test Steps**:
1. Query for Patient resources using supported search parameters
2. Verify server returns appropriate HTTP status codes (200 for successful retrieval)
3. Validate that returned resources maintain extension integrity across different format requests (JSON/XML if supported)

**Pass Criteria**:
- Server returns HTTP 200 for valid Patient resource requests
- Birth Sex extensions are consistently represented across supported formats
- All security and authorization requirements from Capability Statement are met

**Fail Criteria**:
- Server returns inappropriate error codes for valid requests
- Extension data is corrupted or inconsistent between formats
- Security requirements are not properly enforced

#### Assertions for Test Validation
1. **Value Set Conformance**: `extension.where(url='http://hl7.org/fhir/us/core/StructureDefinition/us-core-birthsex').valueCode in ('F' | 'M' | 'UNK')`
2. **Extension Presence**: When Birth Sex extension is present, it contains a valid valueCode
3. **Data Type Validation**: Birth Sex extension uses `valueCode` and not other value[x] variants
4. **Server Capability**: Server successfully processes Patient resource requests as specified in the Capability Statement

---

<a id='req-513'></a>

### REQ-513: Codes for the extension value must be taken from a specified value set.

**Text**: 

**Context**: US Core Gender Identity Extension – extensible binding to Gender Identity value set

**Actor**: Implementer

**Conformance**: SHALL

# Test Specification for REQ-513

## 1. Requirement ID
REQ-513

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated programmatically by examining the extension values and verifying they conform to the specified Gender Identity value set binding.

### Complexity
**Simple** - The test involves straightforward validation of extension values against a defined value set with extensible binding rules.

### Prerequisites
- System must support US Core Patient Profile
- System must implement the US Core Gender Identity Extension
- Test data must include Patient resources with gender identity extensions
- Access to the Gender Identity value set for validation
- System must support FHIR JSON format (as per capability statement)

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Patient resources that include the US Core Gender Identity Extension
- The resources should represent realistic patient data scenarios where gender identity is captured

**Expected Outputs:**
- Validation results indicating conformance to the Gender Identity value set
- Clear pass/fail status for each tested extension value
- Identification of any non-conformant extension values

### Required FHIR Operations
Based on the capability statement, the following operations are supported and required:

1. **Patient Read Operation** (`GET /Patient/{id}`)
   - Retrieve individual Patient resources containing gender identity extensions
   - Verify server returns status 200 for valid requests
   - Verify server returns appropriate error codes (400, 401, 403, 404) for invalid requests

2. **Patient Search Operation** (`GET /Patient`)
   - Search for Patient resources using supported search parameters
   - Use parameters like `_id`, `birthdate`, `family`, `given`, `identifier`, or `name`
   - Retrieve multiple patients to test extension validation across different resources

### Validation Criteria

**Primary Assertions:**
1. **Extension Presence Validation:**
   - Verify that when the US Core Gender Identity Extension is present, it contains a value in `Extension.value[x]`

2. **Value Set Conformance:**
   - For each gender identity extension value, verify it is either:
     - A code from the specified Gender Identity value set, OR
     - An appropriate alternative code (due to extensible binding rules)

3. **Extensible Binding Rules:**
   - If a code from outside the Gender Identity value set is used, verify it represents a valid gender identity concept
   - Ensure the alternative code has appropriate semantic meaning for gender identity

4. **Data Type Validation:**
   - Confirm that `Extension.value[x]` uses the correct data type as specified in the extension definition
   - Typically this would be `valueCodeableConcept`

**Secondary Assertions:**
1. **Extension Structure:**
   - Verify the extension URL correctly references the US Core Gender Identity Extension
   - Confirm proper FHIR extension structure and syntax

2. **Profile Conformance:**
   - Validate that Patient resources conform to the US Core Patient Profile
   - Ensure `meta.profile` references the US Core Patient Profile (recommended per capability statement)

**Test Pass Conditions:**
- All gender identity extension values conform to extensible binding rules
- No validation errors are raised for the extension values
- Extension structure follows FHIR standards
- Patient resources maintain overall profile conformance

**Test Fail Conditions:**
- Extension values that are neither from the Gender Identity value set nor semantically appropriate alternatives
- Malformed extension structure
- Invalid data types in extension values
- Missing required extension components when the extension is present

**Error Handling Verification:**
- Verify appropriate HTTP status codes are returned per capability statement requirements
- Confirm JSON format support as mandated
- Test server behavior with invalid patient IDs or unauthorized requests

---

<a id='req-523'></a>

### REQ-523: US Core Client SHALL fetch Patient resources.

**Text**: 

**Context**: US Core Client read interaction for Patient by id

**Actor**: US Core Client

**Conformance**: SHALL

# Test Specification for REQ-523

## 1. Requirement ID
REQ-523

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be objectively verified through automated testing by performing read operations on Patient resources and validating the responses.

### Complexity
**Simple** - This is a straightforward FHIR read interaction that requires basic API calls and response validation.

### Prerequisites
- A US Core Server implementation that supports Patient resources
- At least one valid Patient resource available on the server with a known resource ID
- Authentication credentials/tokens if security is implemented
- Network connectivity to the FHIR server endpoint

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Server Base URL**: The endpoint URL of the US Core Server being tested
- **Patient Resource ID(s)**: One or more valid Patient resource identifiers that exist on the server
- **Authentication Information**: Access tokens, API keys, or other security credentials as required by the server
- **Expected Patient Data**: Knowledge of what Patient resources should be available for testing

### Required FHIR Operations
Based on the Capability Statement analysis, the following operations are required:
- **GET [base]/Patient/[id]** - Read interaction for Patient resources by ID
- The server SHALL support JSON format responses
- The server SHOULD support XML format responses

### Validation Criteria

#### Primary Validation Checks:
1. **Successful Read Operation**:
   - HTTP GET request to `[base]/Patient/[id]` returns HTTP status 200 (OK)
   - Response contains a valid FHIR Patient resource
   - Response content-type matches requested format (JSON required, XML optional)

2. **Resource Structure Validation**:
   - Returned resource has `resourceType` of "Patient"
   - Resource contains required elements per US Core Patient profile
   - Resource structure validates against FHIR R4 specification
   - If present, `meta.profile` should reference US Core Patient profile

3. **US Core Profile Conformance**:
   - Patient resource conforms to US Core Patient profile requirements
   - All Must Support elements that are present in the data are properly formatted
   - Required elements per US Core Patient profile are present

4. **Response Format Support**:
   - Server successfully returns Patient resource in JSON format
   - If XML is supported, server successfully returns Patient resource in XML format when requested

#### Error Handling Validation:
1. **Invalid Resource ID**:
   - Request for non-existent Patient ID returns HTTP 404 (Not Found)
   - Error response includes appropriate OperationOutcome resource

2. **Security Validation** (if applicable):
   - Unauthorized requests return HTTP 401 (Unauthorized) or HTTP 403 (Forbidden)
   - Invalid authentication returns appropriate error status

#### Secondary Validation Checks:
1. **Performance Considerations**:
   - Response time is within acceptable limits for production use
   - Server handles multiple concurrent read requests appropriately

2. **Data Integrity**:
   - Retrieved Patient resource contains expected data elements
   - Resource ID in response matches requested ID
   - Data consistency across multiple read operations for same resource

### Test Execution Steps:
1. Identify available Patient resource IDs on the test server
2. Execute GET request for each Patient ID with JSON Accept header
3. Validate response status, structure, and content
4. If server supports XML, repeat test with XML Accept header
5. Test error scenarios with invalid Patient IDs
6. Verify security responses if authentication is required
7. Document all results and any conformance issues identified

### Pass/Fail Criteria:
- **PASS**: All valid Patient IDs return HTTP 200 with properly formatted US Core Patient resources
- **FAIL**: Any valid Patient ID fails to return expected resource or returns malformed data
- **PARTIAL**: Some Patient resources are retrieved successfully but others fail, indicating inconsistent implementation

---



<a id='practitioner'></a>

## Practitioner

<a id='req-329'></a>

### REQ-329: The USCorePractitionerProfile SHALL map the identifier to PRD-7 or XCN.1 in HL7 v2.

**Text**: 

**Context**: Mappings for HL7 v2 for USCorePractitionerProfile

**Actor**: USCorePractitionerProfile

**Conformance**: SHALL

# Test Specification for REQ-329

## 1. Requirement ID
REQ-329: USCorePractitionerProfile identifier mapping to HL7 v2

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Attestation

This requirement is primarily an attestation test because:
- The requirement specifies a mapping between FHIR USCorePractitionerProfile.identifier and HL7 v2 fields (PRD-7 or XCN.1)
- Testing would require verification that systems correctly implement this mapping during data transformation/exchange
- Direct automated testing would require access to both FHIR and HL7 v2 message formats from the same system
- The actual mapping logic is implementation-specific and occurs during message transformation

### Complexity
**Simple**

The requirement is straightforward - it specifies a direct mapping between specific data elements in two different standards.

### Prerequisites
- System under test must support USCorePractitionerProfile
- System must support HL7 v2 message generation or transformation
- Access to both FHIR Practitioner resources and corresponding HL7 v2 messages
- Understanding of HL7 v2 PRD and XCN segment structures

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: USCorePractitionerProfile-conformant Practitioner resources with populated identifier elements
- **HL7 v2 Messages**: Corresponding HL7 v2 messages containing PRD segments (with PRD-7) or XCN data types (with XCN.1)
- **System Configuration**: Access to the transformation/mapping engine or documentation

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported:
- **GET /Practitioner/[id]**: Retrieve specific Practitioner resources to examine identifier elements
- **GET /Practitioner**: Search for Practitioner resources (if search parameters are supported)

Note: The Capability Statement indicates support for US Core profiles but specific Practitioner operations would need to be verified in the complete capability statement.

### Validation Criteria

#### Test Case 1: Mapping Documentation Verification
**Objective**: Verify that the system documents the correct mapping between USCorePractitionerProfile.identifier and HL7 v2 fields

**Steps**:
1. Review system documentation or configuration
2. Verify that identifier mapping is documented to map to either:
   - PRD-7 (Provider Identifiers) in PRD segments, OR
   - XCN.1 (Person Identifier) in XCN data types

**Pass Criteria**:
- System documentation explicitly states the mapping of USCorePractitionerProfile.identifier to PRD-7 or XCN.1
- Mapping specification is consistent with HL7 v2 field definitions

#### Test Case 2: Actual Mapping Implementation Verification
**Objective**: Verify that the system correctly implements the identifier mapping during transformation

**Steps**:
1. Retrieve a Practitioner resource with identifier(s) populated
2. Obtain the corresponding HL7 v2 message generated by the system
3. Compare the FHIR identifier values with the HL7 v2 field values

**Pass Criteria**:
- Each value in USCorePractitionerProfile.identifier appears in the corresponding HL7 v2 message in either:
  - PRD-7 field(s), OR
  - XCN.1 field(s)
- Identifier values are preserved accurately during transformation
- System maintains identifier context/type information where applicable

#### Test Case 3: Multiple Identifier Handling
**Objective**: Verify correct handling when multiple identifiers are present

**Steps**:
1. Use a Practitioner resource with multiple identifier elements
2. Generate or retrieve corresponding HL7 v2 message
3. Verify all identifiers are properly mapped

**Pass Criteria**:
- All identifier values from the FHIR resource are represented in the HL7 v2 message
- Mapping maintains the integrity of each identifier
- No identifier data is lost during transformation

#### Attestation Requirements
Since this is primarily an attestation test, implementers must provide:

1. **Documentation Evidence**: System specification or configuration showing the mapping implementation
2. **Sample Data**: Examples of FHIR Practitioner resources and corresponding HL7 v2 messages demonstrating the mapping
3. **Transformation Logic**: Description or code showing how identifier elements are mapped between formats

**Overall Pass Criteria**: The system demonstrates consistent and accurate mapping of USCorePractitionerProfile.identifier elements to the appropriate HL7 v2 fields (PRD-7 or XCN.1) as specified in the requirement.

---

<a id='req-330'></a>

### REQ-330: The USCorePractitionerProfile SHALL map the system to CX.4 or EI-2-4 in HL7 v2.

**Text**: 

**Context**: Mappings for HL7 v2 for USCorePractitionerProfile

**Actor**: USCorePractitionerProfile

**Conformance**: SHALL

# Test Specification for REQ-330

## 1. Requirement ID
REQ-330

## 2. Requirement Analysis

### Testability Assessment
**Not testable due to being too vague**

This requirement specifies a mapping between FHIR USCorePractitionerProfile system elements and HL7 v2 CX.4 or EI-2-4 fields. However, the requirement lacks sufficient detail for automated testing:
- No specification of which FHIR element(s) contain the "system" that should map
- No definition of the expected mapping values or transformation rules
- No context for when CX.4 vs EI-2-4 should be used
- The requirement appears to be documentation of a theoretical mapping rather than a testable behavior

### Complexity
**Not Applicable** - Cannot be tested as specified

### Prerequisites
**Not Applicable** - Requirement cannot be meaningfully tested without additional clarification

## 3. Test Implementation Strategy

### Required Inputs
**Cannot be determined** - The requirement does not specify:
- Which FHIR Practitioner elements contain the referenced "system"
- What the expected mapping output should be
- Under what conditions the mapping should occur

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations would typically be available for Practitioner resources:
- `GET /Practitioner/{id}` - Read individual Practitioner
- `GET /Practitioner` - Search Practitioner resources

However, these operations cannot be meaningfully applied to test this requirement as currently specified.

### Validation Criteria
**Cannot be established** - The requirement lacks:
- Clear definition of the mapping source (FHIR elements)
- Clear definition of the mapping target format
- Specific transformation rules or expected values
- Conditions under which the mapping should be applied

## Recommendation

This requirement needs significant clarification before it can be tested. The following information would be needed:

1. **Source Specification**: Which specific FHIR Practitioner profile elements contain the "system" referenced
2. **Target Specification**: Clear definition of CX.4 and EI-2-4 formats and when each should be used
3. **Mapping Rules**: Explicit transformation logic between FHIR and HL7 v2 formats
4. **Implementation Context**: Whether this is a data transformation requirement, documentation requirement, or runtime behavior requirement

Without these clarifications, this requirement represents documentation of a theoretical mapping rather than a testable conformance criterion.

---

<a id='req-331'></a>

### REQ-331: The USCorePractitionerProfile SHALL map the value to CX.1 or EI.1 in HL7 v2.

**Text**: 

**Context**: Mappings for HL7 v2 for USCorePractitionerProfile

**Actor**: USCorePractitionerProfile

**Conformance**: SHALL

# Test Specification for REQ-331

## 1. Requirement ID
REQ-331

## 2. Requirement Analysis

### Testability Assessment
**Not testable due to insufficient specification**

This requirement lacks the necessary detail to create an implementable test. The requirement states "The USCorePractitionerProfile SHALL map the value to CX.1 or EI.1 in HL7 v2" but fails to specify:
- Which specific field/element in USCorePractitionerProfile should be mapped
- What "the value" refers to
- Under what circumstances this mapping should occur
- Whether this is for inbound v2 to FHIR conversion, outbound FHIR to v2 conversion, or both

### Complexity
**Cannot be determined** - Insufficient information provided

### Prerequisites
**Cannot be determined** - The requirement lacks sufficient detail to identify what system configurations, data, or setup would be needed.

## 3. Test Implementation Strategy

### Required Inputs
**Cannot be specified** - The requirement does not provide enough information to determine:
- Which FHIR Practitioner profile elements are subject to this mapping requirement
- What constitutes valid test data
- Expected input/output scenarios

### Required FHIR Operations
**Cannot be determined** - Without knowing the specific mapping context (inbound conversion, outbound conversion, or data validation), it's impossible to specify which FHIR operations would be needed.

### Validation Criteria
**Cannot be established** - The requirement lacks sufficient detail to create meaningful validation criteria.

## Recommendation

This requirement needs clarification before a test specification can be created. The requirement should be enhanced to include:

1. **Specific field mapping**: Which exact element(s) in USCorePractitionerProfile are subject to this mapping requirement
2. **Mapping direction**: Whether this applies to v2-to-FHIR conversion, FHIR-to-v2 conversion, or both
3. **Mapping context**: When and under what conditions this mapping should occur
4. **Value specification**: What "the value" refers to specifically
5. **CX.1/EI.1 context**: Under what circumstances CX.1 versus EI.1 should be used

Without these clarifications, this requirement cannot be meaningfully tested for conformance.

---

<a id='req-332'></a>

### REQ-332: The USCorePractitionerProfile SHALL map the period to CX.7 + CX.8 in HL7 v2.

**Text**: 

**Context**: Mappings for HL7 v2 for USCorePractitionerProfile

**Actor**: USCorePractitionerProfile

**Conformance**: SHALL

# Test Specification for REQ-332

## 1. Requirement ID
**REQ-332**: USCorePractitionerProfile SHALL map the period to CX.7 + CX.8 in HL7 v2

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Attestation

This requirement is not directly automatically testable through FHIR API interactions because it specifies an HL7 v2 mapping requirement rather than FHIR resource behavior. The requirement defines how FHIR USCorePractitionerProfile period elements should map to specific HL7 v2 CX segment fields (CX.7 + CX.8) during transformation processes. This mapping logic is internal to the implementation and cannot be verified through standard FHIR REST operations.

### Complexity
**Level**: Moderate

While the requirement itself is straightforward in stating the mapping rule, testing it requires:
- Understanding of both FHIR USCorePractitionerProfile structure and HL7 v2 CX segment format
- Access to transformation/mapping functionality or documentation
- Verification that the implementation correctly handles period-to-CX field mapping

### Prerequisites
- Implementation must support USCorePractitionerProfile
- System must have HL7 v2 transformation capabilities or documented mapping specifications
- Access to system documentation or configuration showing HL7 v2 mapping rules
- Test data containing Practitioner resources with period elements

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources**:
- Practitioner resources conforming to USCorePractitionerProfile that contain period elements
- Resources should include various period scenarios:
  - Complete periods (with both start and end dates)
  - Open-ended periods (start date only)
  - Periods with different date formats and precision levels

**Expected Outputs**:
- Documentation or system configuration demonstrating the mapping rule
- HL7 v2 message examples showing CX.7 and CX.8 populated from FHIR period data
- Implementation evidence showing adherence to the specified mapping

### Required FHIR Operations
**Primary Operations** (supported by US Core Server CapabilityStatement):
- `GET /Practitioner/{id}` - Retrieve specific Practitioner resources to examine period elements
- `GET /Practitioner?_format=xml` or `GET /Practitioner?_format=json` - Retrieve Practitioner resources in different formats to verify period structure

**Note**: The actual HL7 v2 transformation is not a FHIR operation but an implementation-specific process.

### Validation Criteria

**Attestation Requirements**:

1. **Mapping Documentation Verification**:
   - System documentation explicitly states that USCorePractitionerProfile period elements map to CX.7 + CX.8
   - Mapping specification clearly defines how period.start maps to CX.7 and period.end maps to CX.8

2. **Implementation Evidence**:
   - Provide examples of HL7 v2 messages generated from USCorePractitionerProfile resources showing:
     - FHIR period.start correctly populated in CX.7
     - FHIR period.end correctly populated in CX.8
     - Proper handling of missing period elements (empty CX fields when period data is absent)

3. **Conformance Validation**:
   - Demonstrate that the implementation handles various period scenarios:
     - Complete periods map both CX.7 and CX.8
     - Incomplete periods (start only) map CX.7 and leave CX.8 appropriately empty
     - Missing periods result in empty CX.7 and CX.8 fields

4. **Configuration Verification**:
   - Show system configuration or mapping rules that enforce this specific mapping
   - Demonstrate that the mapping is consistently applied across all USCorePractitionerProfile transformations

**Success Criteria**:
The test passes when the implementation provides sufficient evidence (documentation, examples, or configuration) demonstrating that USCorePractitionerProfile period elements are consistently and correctly mapped to CX.7 + CX.8 in HL7 v2 transformations according to the specified requirement.

---

<a id='req-333'></a>

### REQ-333: The USCorePractitionerProfile SHALL map the assigner to CX.4 or (CX.4,CX.9,CX.10) in HL7 v2.

**Text**: 

**Context**: Mappings for HL7 v2 for USCorePractitionerProfile

**Actor**: USCorePractitionerProfile

**Conformance**: SHALL

# Test Specification for REQ-333

## 1. Requirement ID
**REQ-333**: USCorePractitionerProfile SHALL map the assigner to CX.4 or (CX.4,CX.9,CX.10) in HL7 v2

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Attestation

**Rationale**: This requirement specifies HL7 v2 mapping behavior for the USCorePractitionerProfile, which is a transformation/mapping specification rather than a FHIR API behavior that can be directly tested through FHIR operations. The requirement validates that systems correctly map FHIR Practitioner.identifier.assigner elements to specific HL7 v2 CX segment fields during v2 message generation.

### Complexity
**Level**: Moderate

**Rationale**: While the mapping concept is straightforward, testing requires:
- Understanding of both FHIR and HL7 v2 structures
- Verification of transformation logic between different standards
- Knowledge of CX segment field mappings

### Prerequisites
- System must support USCorePractitionerProfile
- System must have HL7 v2 message generation capability
- System must support transformation from FHIR to HL7 v2
- Test data must include Practitioner resources with identifier.assigner populated
- Access to generated HL7 v2 messages for verification

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Practitioner resources conforming to USCorePractitionerProfile
- Resources must contain `identifier` elements with `assigner` populated
- Variety of assigner configurations:
  - Simple Organization reference
  - Organization with identifier
  - Organization with name and identifier

**Expected Outputs:**
- HL7 v2 messages containing CX segments
- Documentation or attestation of mapping implementation
- Mapping configuration or transformation rules

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations should be supported:
- `GET /Practitioner/{id}` - Read specific Practitioner resources
- `GET /Practitioner?_id={id1,id2,...}` - Read multiple Practitioner resources
- Standard search parameters as defined in the capability statement

### Validation Criteria

#### Primary Validation Points:

1. **Mapping Completeness Verification**
   - **Assertion**: All Practitioner.identifier.assigner elements are mapped to HL7 v2 CX segments
   - **Expected Result**: No assigner data is lost during transformation

2. **CX.4 Field Mapping**
   - **Assertion**: Practitioner.identifier.assigner maps to CX.4 (Assigning Authority)
   - **Expected Result**: CX.4 contains appropriate assigner identification

3. **Extended Mapping Verification (CX.4, CX.9, CX.10)**
   - **Assertion**: When additional assigner details are present, mapping utilizes CX.4, CX.9 (Assigning Jurisdiction), and CX.10 (Assigning Agency or Department)
   - **Expected Result**: Complex assigner information is properly distributed across the three CX fields

4. **Data Integrity Check**
   - **Assertion**: Mapped assigner data maintains semantic meaning and reference integrity
   - **Expected Result**: Generated HL7 v2 messages preserve the original assigner context

#### Test Cases:

**Test Case 1: Simple Assigner Mapping**
- Input: Practitioner with identifier.assigner containing basic organization reference
- Validation: Verify CX.4 contains the assigner information

**Test Case 2: Complex Assigner Mapping**
- Input: Practitioner with identifier.assigner containing detailed organization information
- Validation: Verify appropriate distribution across CX.4, CX.9, and CX.10

**Test Case 3: Multiple Identifiers**
- Input: Practitioner with multiple identifiers, each with different assigners
- Validation: Verify each identifier's assigner is correctly mapped in corresponding CX segments

#### Pass/Fail Criteria:
- **PASS**: All identifier.assigner elements are successfully mapped to the specified CX fields with data integrity maintained
- **FAIL**: Any assigner data is missing, incorrectly mapped, or semantically altered in the HL7 v2 output

#### Documentation Requirements:
- Mapping specification document
- Sample input/output pairs demonstrating the transformation
- Attestation of conformance to the mapping requirement

---

<a id='req-334'></a>

### REQ-334: The USCorePractitionerProfile SHALL map the name to XCN Components in HL7 v2.

**Text**: 

**Context**: Mappings for HL7 v2 for USCorePractitionerProfile

**Actor**: USCorePractitionerProfile

**Conformance**: SHALL

# Test Specification for REQ-334

## 1. Requirement ID
**REQ-334**: USCorePractitionerProfile SHALL map the name to XCN Components in HL7 v2

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Attestation

**Rationale**: This requirement mandates a specific mapping between FHIR USCorePractitionerProfile name elements and HL7 v2 XCN (Extended Composite ID Number and Name for Persons) components. This is primarily a structural/semantic mapping requirement that cannot be directly tested through FHIR API interactions alone, as it relates to how systems internally handle data transformation between FHIR and HL7 v2 formats.

### Complexity
**Complex**

**Rationale**: 
- Requires understanding of both FHIR USCorePractitionerProfile structure and HL7 v2 XCN component specifications
- Involves verification of bidirectional mapping capabilities
- May require testing multiple name variations and edge cases
- Depends on system's internal mapping implementation

### Prerequisites
- System under test must support USCorePractitionerProfile
- System must have HL7 v2 integration capabilities or demonstrate mapping knowledge
- Test data should include Practitioner resources with various name formats
- Access to system documentation describing the HL7 v2 XCN mapping implementation

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- USCorePractitionerProfile instances with populated `name` elements containing:
  - Various combinations of name components (family, given, prefix, suffix)
  - Multiple name entries (official, usual, maiden names)
  - Names with different use contexts
  - Edge cases such as mononymous names, names with special characters

**Expected Outputs:**
- System attestation or documentation demonstrating XCN component mapping
- Evidence of successful HL7 v2 message generation/processing with correct XCN population
- Mapping specification document or configuration showing FHIR to XCN field correlations

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and may be used:

1. **GET /Practitioner/[id]** - Retrieve specific Practitioner resources for mapping verification
2. **GET /Practitioner** - Search for Practitioner resources to test various name scenarios
3. **Standard search parameters** as defined in FHIR specification for Practitioner resources

### Validation Criteria

#### Primary Validation (Attestation Required):
1. **Mapping Documentation Verification**:
   - System provides documented mapping between USCorePractitionerProfile.name elements and HL7 v2 XCN components
   - Mapping covers all relevant FHIR name sub-elements (family, given, prefix, suffix, use, period)
   - Documentation specifies which XCN components correspond to each FHIR name element

2. **Implementation Evidence**:
   - System demonstrates ability to generate HL7 v2 messages with properly populated XCN segments from FHIR Practitioner data
   - System shows capability to consume HL7 v2 XCN data and correctly populate USCorePractitionerProfile name elements
   - Evidence of successful round-trip conversion maintaining data integrity

#### Secondary Validation (API-based verification):
1. **FHIR Profile Compliance**:
   - Retrieved Practitioner resources conform to USCorePractitionerProfile constraints
   - Name elements are populated according to US Core requirements
   - Resources include appropriate `meta.profile` references to US Core profiles (as recommended in Capability Statement)

2. **Data Integrity Verification**:
   - Practitioner resources contain well-formed name structures suitable for XCN mapping
   - Multiple name entries are handled appropriately
   - Special characters and international names are processed correctly

#### Specific Test Assertions:
- **ASSERTION 1**: System provides written attestation of XCN mapping implementation
- **ASSERTION 2**: Mapping documentation covers all USCorePractitionerProfile.name sub-elements
- **ASSERTION 3**: System demonstrates successful HL7 v2 XCN generation from FHIR data
- **ASSERTION 4**: Retrieved Practitioner resources validate against USCorePractitionerProfile
- **ASSERTION 5**: Name data maintains consistency through any demonstrated conversion processes

#### Pass Criteria:
The test passes when the system provides:
1. Complete attestation of XCN mapping compliance
2. Supporting documentation or evidence of implementation
3. Successful retrieval of conformant USCorePractitionerProfile instances
4. Demonstration that name data can be appropriately transformed to/from HL7 v2 XCN format

This test specification focuses on conformance verification rather than exhaustive functional testing, accommodating various implementation approaches while ensuring the core mapping requirement is met.

---

<a id='req-335'></a>

### REQ-335: The USCorePractitionerProfile SHALL map the telecom system to XTN.3 in HL7 v2.

**Text**: 

**Context**: Mappings for HL7 v2 for USCorePractitionerProfile (telecom)

**Actor**: USCorePractitionerProfile

**Conformance**: SHALL

# Test Specification for REQ-335

## 1. Requirement ID
**REQ-335**: USCorePractitionerProfile telecom system mapping to HL7 v2 XTN.3

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Not directly testable via FHIR API operations

**Rationale**: This requirement specifies an HL7 v2 mapping constraint that defines how FHIR telecom.system values should map to XTN.3 field codes when transforming to HL7 v2 format. This is a structural mapping requirement that cannot be directly validated through FHIR REST API calls, as it pertains to data transformation rather than FHIR resource validation.

### Complexity
**Simple** - The requirement involves a straightforward field mapping verification between FHIR and HL7 v2 formats.

### Prerequisites
- Access to USCorePractitionerProfile instances with telecom data
- Understanding of HL7 v2 XTN.3 field value mappings
- System capability to demonstrate or document the mapping transformation
- Knowledge of expected telecom.system to XTN.3 value mappings per US Core specifications

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources**:
- One or more Practitioner resources conforming to USCorePractitionerProfile
- Resources must contain telecom elements with various system values (phone, fax, email, pager, url, sms, other)

**Expected Outputs**:
- Documentation or demonstration showing the corresponding XTN.3 values for each telecom.system value
- Evidence that the mapping follows HL7 v2 specifications for XTN.3 field codes

### Required FHIR Operations
Since this is a mapping requirement rather than a functional API requirement, standard FHIR operations are used for data retrieval:

- **GET /Practitioner/{id}** - Retrieve specific Practitioner resources (supported per US Core Server CapabilityStatement)
- **GET /Practitioner** - Search for Practitioner resources with telecom data (supported per US Core Server CapabilityStatement)

### Validation Criteria

**Test Case 1: Telecom System Mapping Verification**
1. **Retrieve Practitioner Data**: Obtain USCorePractitionerProfile instances containing telecom elements
2. **Document Mapping Implementation**: For each telecom.system value found, verify the corresponding XTN.3 mapping:
   - `phone` → XTN.3 = "PH" (Telephone)
   - `fax` → XTN.3 = "FX" (Fax)
   - `email` → XTN.3 = "Internet" (Email)
   - `pager` → XTN.3 = "BP" (Beeper/Pager)
   - `url` → XTN.3 = "Internet" (Web)
   - `sms` → XTN.3 = "PH" (Telephone - SMS)
   - `other` → XTN.3 = appropriate context-specific code

**Assertions for Passing**:
- System demonstrates or documents that each telecom.system value maps to the correct XTN.3 field code according to HL7 v2 specifications
- Mapping documentation is consistent with US Core Implementation Guide requirements
- All telecom.system values present in test data have documented XTN.3 mappings

**Test Case 2: Mapping Completeness**
1. **Coverage Assessment**: Verify that the system's mapping covers all possible telecom.system values that may appear in USCorePractitionerProfile
2. **Documentation Review**: Confirm that mapping logic is properly documented and accessible

**Assertions for Passing**:
- All standard telecom.system codes have documented XTN.3 mappings
- System provides clear guidance for handling edge cases or non-standard system values
- Mapping implementation aligns with both FHIR R4 and HL7 v2 specifications

**Note**: This requirement is best verified through implementation documentation review, transformation testing with sample data, or attestation by the implementing system, as it pertains to data transformation logic rather than FHIR API behavior.

---

<a id='req-336'></a>

### REQ-336: The USCorePractitionerProfile SHALL map the telecom value to XTN.1 or XTN.12 in HL7 v2.

**Text**: 

**Context**: Mappings for HL7 v2 for USCorePractitionerProfile (telecom)

**Actor**: USCorePractitionerProfile

**Conformance**: SHALL

# Test Specification for REQ-336

## 1. Requirement ID
REQ-336

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Not directly testable through FHIR API operations

**Rationale**: This requirement specifies an HL7 v2 mapping constraint for the USCorePractitionerProfile telecom element. Since this is a mapping specification rather than a FHIR resource validation rule, it cannot be directly tested through FHIR API interactions. The requirement addresses how telecom values should be mapped when converting between FHIR and HL7 v2 formats, which is an implementation detail of interface engines or conversion utilities rather than something that can be validated through standard FHIR operations.

### Complexity
**Simple** - The requirement is straightforward in its specification but requires specialized mapping validation tools rather than standard FHIR testing approaches.

### Prerequisites
- System that implements HL7 v2 to FHIR conversion or vice versa
- Access to both FHIR USCorePractitionerProfile instances and corresponding HL7 v2 messages
- Mapping validation capabilities or documentation review process
- Understanding of HL7 v2 XTN segment structure (XTN.1 = Telephone Number, XTN.12 = Unformatted Telephone Number)

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: USCorePractitionerProfile instances with populated telecom elements
- **HL7 v2 Messages**: Corresponding HL7 v2 messages (typically ADT, ORU, or other messages containing practitioner information)
- **Mapping Documentation**: System documentation describing HL7 v2 to FHIR mapping implementation

### Required FHIR Operations
**Note**: Standard FHIR operations cannot directly test this mapping requirement. However, related operations include:

- `GET /Practitioner` - To retrieve USCorePractitionerProfile instances for validation
- `GET /Practitioner/[id]` - To retrieve specific practitioner resources

*These operations are supported based on the US Core Server CapabilityStatement which includes Practitioner resource support.*

### Validation Criteria

Since this requirement cannot be automatically tested through FHIR API operations, validation must be performed through:

#### 1. Documentation Review
- **Assertion**: System documentation SHALL explicitly state that USCorePractitionerProfile telecom values are mapped to XTN.1 or XTN.12 in HL7 v2 messages
- **Expected Result**: Clear mapping specification in implementation documentation

#### 2. Interface Engine Configuration Review
- **Assertion**: Mapping configuration files or transformation rules SHALL demonstrate telecom value mapping to XTN.1 or XTN.12
- **Expected Result**: Verifiable mapping rules in system configuration

#### 3. Sample Message Analysis (if available)
- **Assertion**: For any USCorePractitionerProfile with telecom data, the corresponding HL7 v2 message SHALL populate either XTN.1 or XTN.12 with the telecom value
- **Expected Result**: Consistent mapping evidence in sample message pairs

#### 4. Attestation-Based Validation
- **Process**: System implementer provides attestation that mapping follows the specified requirement
- **Documentation**: Written confirmation of conformance with supporting evidence

### Alternative Testing Approach
If the system provides both FHIR and HL7 v2 interfaces:

1. **Round-trip Testing**:
   - Send HL7 v2 message with practitioner telecom in XTN.1 or XTN.12
   - Retrieve corresponding FHIR USCorePractitionerProfile
   - Verify telecom element contains expected value
   - Convert back to HL7 v2 and verify XTN field population

2. **Cross-format Validation**:
   - Compare telecom values between FHIR and HL7 v2 representations
   - Verify consistency and proper mapping

### Test Outcome Classification
- **PASS**: Mapping implementation demonstrates conformance with requirement through documentation, configuration review, or cross-format validation
- **FAIL**: Mapping does not follow specified XTN.1 or XTN.12 mapping rule
- **NOT APPLICABLE**: System does not implement HL7 v2 to FHIR mapping functionality

---

<a id='req-337'></a>

### REQ-337: The USCorePractitionerProfile SHALL map the address use to XAD.7 in HL7 v2.

**Text**: 

**Context**: Mappings for HL7 v2 for USCorePractitionerProfile (address)

**Actor**: USCorePractitionerProfile

**Conformance**: SHALL

# Test Specification for REQ-337

## 1. Requirement ID
**REQ-337**: USCorePractitionerProfile SHALL map the address use to XAD.7 in HL7 v2

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Not testable through automated FHIR API testing

**Rationale**: This requirement specifies a mapping between FHIR USCorePractitionerProfile address.use element and HL7 v2 XAD.7 field. This is a data transformation/mapping specification that would be tested during integration scenarios where FHIR data is converted to/from HL7 v2 messages, not through standard FHIR REST API operations.

### Complexity
**Simple** - The requirement is straightforward but requires access to HL7 v2 transformation capabilities.

### Prerequisites
- System capable of transforming between FHIR R4 and HL7 v2 formats
- USCorePractitionerProfile instances with populated address.use elements
- HL7 v2 message generation/parsing capabilities
- Access to both FHIR and HL7 v2 representations of the same practitioner data

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources**:
- USCorePractitionerProfile instances containing:
  - At least one address element with populated `use` field
  - Valid address.use values from the required ValueSet (home, work, temp, old, billing)

**Expected Outputs**:
- HL7 v2 messages (likely PRT, ROL, or other segments containing practitioner information)
- XAD.7 field populated with correctly mapped address use values

### Required FHIR Operations
**Note**: Standard FHIR REST operations are not sufficient for this requirement. The test requires:

1. **GET /Practitioner/[id]** - Retrieve USCorePractitionerProfile instances (supported per Capability Statement)
2. **Transformation Service** - Convert FHIR to HL7 v2 (system-specific, not standard FHIR)
3. **HL7 v2 Message Parsing** - Extract and validate XAD.7 values (system-specific)

### Validation Criteria

**Mapping Verification**:
1. **Address Use Mapping Accuracy**:
   - FHIR `address.use` = "home" maps to appropriate XAD.7 value
   - FHIR `address.use` = "work" maps to appropriate XAD.7 value  
   - FHIR `address.use` = "temp" maps to appropriate XAD.7 value
   - FHIR `address.use` = "old" maps to appropriate XAD.7 value
   - FHIR `address.use` = "billing" maps to appropriate XAD.7 value

2. **Completeness Check**:
   - All FHIR practitioner addresses with populated `use` elements result in corresponding XAD segments with populated XAD.7 fields
   - No address.use values are lost during transformation

3. **Data Integrity**:
   - XAD.7 values conform to HL7 v2 specification requirements
   - Mapping is consistent across multiple practitioner instances

**Test Procedure**:
1. Retrieve USCorePractitionerProfile instances with various address.use values
2. Transform FHIR data to HL7 v2 format using system transformation service
3. Parse resulting HL7 v2 messages to extract XAD.7 values
4. Verify correct mapping between FHIR address.use and HL7 v2 XAD.7
5. Confirm no data loss or corruption during transformation

**Alternative Testing Approach**:
If direct HL7 v2 transformation testing is not feasible, this requirement should be verified through:
- **Documentation Review**: Confirm mapping tables/specifications exist
- **Attestation**: System implementer confirms correct mapping implementation
- **Integration Testing**: Verify in end-to-end scenarios with trading partners using HL7 v2

---

<a id='req-338'></a>

### REQ-338: The USCorePractitionerProfile SHALL map the address type to XAD.18 in HL7 v2.

**Text**: 

**Context**: Mappings for HL7 v2 for USCorePractitionerProfile (address)

**Actor**: USCorePractitionerProfile

**Conformance**: SHALL

# Test Specification for REQ-338

## 1. Requirement ID
**REQ-338**: USCorePractitionerProfile SHALL map the address type to XAD.18 in HL7 v2

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Not testable via automated FHIR testing

**Rationale**: This requirement specifies an HL7 v2 mapping for FHIR data elements, which is implementation-specific behavior that occurs during data transformation processes. The mapping from FHIR Practitioner.address.type to HL7 v2 XAD.18 cannot be directly tested through FHIR API interactions, as it requires:
- Access to the actual HL7 v2 transformation engine
- Ability to trigger and observe v2 message generation
- Comparison of FHIR input data with resulting v2 message content

This requirement would be better addressed through:
- Implementation documentation review/attestation
- Integration testing with actual v2 message generation
- Code review of transformation logic

### Complexity
**Level**: Not Applicable (Cannot be tested via FHIR API)

### Prerequisites
Not applicable for FHIR API-based testing.

## 3. Test Implementation Strategy

### Required Inputs
This requirement cannot be tested through standard FHIR API operations as outlined in the US Core Server Capability Statement. The Capability Statement defines RESTful FHIR operations (create, read, update, delete, search) but does not include v2 message generation capabilities.

### Required FHIR Operations
None - the US Core Server Capability Statement does not define any operations that would expose HL7 v2 mapping behavior.

### Validation Criteria
**Primary Recommendation**: This requirement should be verified through **attestation** rather than automated testing.

**Attestation Criteria**:
1. Implementation documentation must demonstrate that when USCorePractitionerProfile instances are converted to HL7 v2 messages, the FHIR `Practitioner.address.type` element is correctly mapped to the XAD.18 field
2. Code review or architectural documentation should show the mapping logic implementation
3. Integration test evidence showing sample FHIR Practitioner resources with various address types correctly transformed to v2 messages with appropriate XAD.18 values

**Alternative Testing Approach**:
If the implementation provides custom endpoints or operations for v2 message generation (beyond the standard US Core Capability Statement), those could be tested directly, but such endpoints would be implementation-specific and not part of standard US Core conformance testing.

### Recommendation
Reclassify this requirement as an **attestation-based** requirement rather than a testable requirement, as it pertains to data transformation logic that is not exposed through the standard FHIR RESTful API operations defined in the US Core Server Capability Statement.

---

<a id='req-339'></a>

### REQ-339: The USCorePractitionerProfile SHALL map the address text to XAD.1 + XAD.2 + XAD.3 + XAD.4 + XAD.5 + XAD.6 in HL7 v2.

**Text**: 

**Context**: Mappings for HL7 v2 for USCorePractitionerProfile (address)

**Actor**: USCorePractitionerProfile

**Conformance**: SHALL

# Test Specification for REQ-339

## 1. Requirement ID
REQ-339

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Not testable through standard FHIR API testing

**Rationale**: This requirement specifies a mapping between FHIR and HL7 v2 message formats, which is an implementation detail that occurs during message transformation/translation processes. The mapping itself cannot be validated through FHIR REST API interactions, as it defines how data should be converted when transforming from FHIR to HL7 v2 format.

### Complexity
**Complex** - Requires understanding of both FHIR and HL7 v2 message structures, access to transformation engines, and the ability to validate cross-format mappings.

### Prerequisites
- Access to a system that performs FHIR to HL7 v2 transformations
- USCorePractitionerProfile instances with populated address fields
- HL7 v2 message generation capability
- Knowledge of HL7 v2 XAD segment structure (XAD.1 through XAD.6 fields)
- Understanding of address.text field content in FHIR

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: USCorePractitionerProfile instances with:
  - `address.text` field populated with complete address information
  - Various address formats to test mapping comprehensiveness
- **Expected Outputs**: 
  - HL7 v2 messages containing XAD segments with properly mapped address components
  - Validation that address.text content is appropriately distributed across XAD.1 through XAD.6

### Required FHIR Operations
**Note**: This requirement cannot be tested through standard FHIR REST operations as defined in the Capability Statement, since it involves cross-format mapping rather than FHIR API interactions.

**Alternative Testing Approach Required**:
- Access to transformation/integration engine logs
- Direct examination of generated HL7 v2 messages
- Comparison of input FHIR data with output HL7 v2 data

### Validation Criteria

**Primary Assertions**:
1. **Mapping Completeness**: Verify that all content from `Practitioner.address.text` appears in the concatenated XAD fields (XAD.1 + XAD.2 + XAD.3 + XAD.4 + XAD.5 + XAD.6)

2. **Content Preservation**: Confirm that no address information from the source FHIR `address.text` field is lost during the transformation

3. **Field Distribution**: Validate that the address text is appropriately distributed across the six XAD components according to HL7 v2 standards:
   - XAD.1: Street Address
   - XAD.2: Other Designation  
   - XAD.3: City
   - XAD.4: State or Province
   - XAD.5: Zip or Postal Code
   - XAD.6: Country

**Secondary Assertions**:
1. **Character Encoding**: Ensure proper character encoding is maintained during transformation
2. **Field Length Limits**: Verify compliance with HL7 v2 field length restrictions for XAD components
3. **Special Character Handling**: Confirm appropriate handling of special characters and escape sequences

### Test Execution Recommendations

Since this requirement cannot be validated through standard FHIR API testing, implementers should:

1. **Attestation-Based Validation**: Document the mapping logic and provide evidence that the transformation correctly maps address.text to the specified XAD fields

2. **Integration Testing**: Create end-to-end test scenarios that generate HL7 v2 messages from FHIR USCorePractitionerProfile instances and validate the mapping

3. **Transformation Engine Testing**: If using commercial or open-source transformation engines, verify that the mapping configuration correctly implements this requirement

**Note**: This requirement represents a conformance expectation for systems that perform FHIR-to-HL7v2 transformations rather than a testable API behavior through the US Core Server Capability Statement.

---

<a id='req-340'></a>

### REQ-340: The USCorePractitionerProfile SHALL map the address line to XAD.1 + XAD.2 in HL7 v2.

**Text**: 

**Context**: Mappings for HL7 v2 for USCorePractitionerProfile (address)

**Actor**: USCorePractitionerProfile

**Conformance**: SHALL

# Test Specification for REQ-340

## 1. Requirement ID
**REQ-340**: USCorePractitionerProfile SHALL map address line to XAD.1 + XAD.2 in HL7 v2

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Attestation

**Rationale**: This requirement specifies a mapping between FHIR and HL7 v2 formats that occurs during data transformation/interoperability scenarios. It cannot be directly tested through FHIR API operations alone, as it requires verification of the actual mapping implementation during FHIR-to-HL7v2 conversion processes.

### Complexity
**Level**: Moderate

**Justification**: While the mapping concept is straightforward (FHIR address.line maps to HL7 v2 XAD.1 + XAD.2), testing requires understanding of both FHIR and HL7 v2 standards, access to conversion processes, and validation of the mapping accuracy across different address line configurations.

### Prerequisites
- System must support USCorePractitionerProfile
- System must have FHIR-to-HL7v2 conversion capability
- Access to both FHIR input data and resulting HL7 v2 output
- Understanding of HL7 v2 XAD segment structure (XAD.1 = Street Address, XAD.2 = Other Designation)

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources**:
- USCorePractitionerProfile instances with various address line configurations:
  - Single address line
  - Multiple address lines (2+ lines)
  - Address with special characters or formatting
  - Empty/null address lines

**Expected Outputs**:
- Corresponding HL7 v2 messages with properly mapped XAD segments
- Documentation or attestation of mapping implementation

### Required FHIR Operations
Since this is a mapping requirement rather than a direct FHIR API requirement, the primary operations are:

1. **GET /Practitioner/{id}** - Retrieve USCorePractitionerProfile instances
   - *Note: This operation is supported based on the US Core Server capability to support US Core profiles*
2. **System conversion process** - Transform FHIR to HL7 v2 (implementation-specific)

### Validation Criteria

#### Test Case 1: Single Address Line Mapping
**Given**: USCorePractitionerProfile with `address.line[0] = "123 Main Street"`
**When**: FHIR data is converted to HL7 v2
**Then**: 
- XAD.1 contains "123 Main Street"
- XAD.2 is empty or null

#### Test Case 2: Multiple Address Lines Mapping
**Given**: USCorePractitionerProfile with:
- `address.line[0] = "123 Main Street"`
- `address.line[1] = "Suite 456"`
**When**: FHIR data is converted to HL7 v2
**Then**:
- XAD.1 contains "123 Main Street"
- XAD.2 contains "Suite 456"

#### Test Case 3: Three or More Address Lines
**Given**: USCorePractitionerProfile with:
- `address.line[0] = "123 Main Street"`
- `address.line[1] = "Suite 456"`
- `address.line[2] = "Floor 2"`
**When**: FHIR data is converted to HL7 v2
**Then**:
- XAD.1 contains "123 Main Street"
- XAD.2 contains "Suite 456" (or concatenated "Suite 456 Floor 2" if system design requires)
- System documentation specifies handling of additional lines

#### Test Case 4: Empty Address Lines
**Given**: USCorePractitionerProfile with empty or missing address.line elements
**When**: FHIR data is converted to HL7 v2
**Then**:
- XAD.1 and XAD.2 are appropriately empty/null
- No mapping errors occur

#### Attestation Requirements
Since direct automated testing may not be feasible, the following attestation evidence should be provided:

1. **Mapping Documentation**: Clear specification of how address.line elements map to XAD.1 and XAD.2
2. **Sample Conversions**: Examples showing input FHIR data and output HL7 v2 messages
3. **Edge Case Handling**: Documentation of how the system handles multiple address lines, special characters, and empty values
4. **Compliance Statement**: Formal attestation that the mapping follows the specified requirement

#### Pass/Fail Criteria
**PASS**: System demonstrates correct mapping of FHIR address.line to HL7 v2 XAD.1 + XAD.2 according to the specification, with proper handling of various address line configurations.

**FAIL**: Any of the following conditions:
- address.line[0] is not mapped to XAD.1
- address.line[1] is not mapped to XAD.2 (when present)
- Mapping introduces data corruption or loss
- System fails to handle standard address line variations
- No adequate documentation or attestation of mapping implementation is provided

---

<a id='req-341'></a>

### REQ-341: The USCorePractitionerProfile SHALL map the address city to XAD.3 in HL7 v2.

**Text**: 

**Context**: Mappings for HL7 v2 for USCorePractitionerProfile (address)

**Actor**: USCorePractitionerProfile

**Conformance**: SHALL

# Test Specification: REQ-341

## 1. Requirement ID
**REQ-341**: USCorePractitionerProfile SHALL map the address city to XAD.3 in HL7 v2

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Not testable through automated FHIR conformance testing

**Rationale**: This requirement specifies a mapping between FHIR US Core Practitioner Profile address.city field and HL7 v2 XAD.3 field. This is a data transformation specification that occurs during interface conversions between FHIR and HL7 v2 formats. Testing this requirement would require:
- Access to both FHIR and HL7 v2 message formats
- A system that performs bidirectional transformation between formats
- Verification of mapping accuracy during conversion

This falls outside the scope of standard FHIR conformance testing, which focuses on FHIR resource validation, API interactions, and profile compliance within the FHIR ecosystem.

### Complexity
**Simple** - The mapping itself is straightforward (direct field-to-field mapping), but requires specialized testing infrastructure.

### Prerequisites
- System capable of FHIR to HL7 v2 message transformation
- US Core Practitioner Profile resources with populated address.city elements
- HL7 v2 message generation capability
- Access to both input FHIR resources and output HL7 v2 messages

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: US Core Practitioner Profile instances with various address configurations:
  - Single address with city populated
  - Multiple addresses with cities populated
  - Addresses with missing city elements
  - Addresses with empty/null city values

### Required FHIR Operations
**Note**: Standard FHIR REST operations are not directly applicable for testing this mapping requirement. The Capability Statement supports standard CRUD operations, but this requirement tests transformation logic outside the FHIR API scope.

If testing within a FHIR-capable system that also supports HL7 v2 transformation:
- `GET /Practitioner/{id}` - Retrieve source FHIR Practitioner resources
- Custom transformation endpoints (if available) to trigger FHIR-to-v2 conversion

### Validation Criteria

**Primary Validation**:
1. **Direct Field Mapping**: For each Practitioner.address.city value in the source FHIR resource, verify the corresponding XAD.3 field in the generated HL7 v2 message contains the identical value

2. **Multiple Address Handling**: When multiple addresses exist, verify each address.city maps to the corresponding XAD segment's .3 component in the correct order

3. **Null/Empty Value Handling**: Verify that missing or empty city values in FHIR result in appropriate handling in XAD.3 (empty field or omitted segment as per v2 specifications)

**Secondary Validation**:
1. **Data Integrity**: Ensure no data truncation or encoding issues during the mapping process
2. **Character Set Preservation**: Verify special characters, unicode, or extended character sets are properly preserved
3. **Cardinality Compliance**: Ensure the mapping respects both FHIR and HL7 v2 cardinality constraints

**Test Assertions**:
- Each non-empty `Practitioner.address.city` value SHALL have a corresponding populated `XAD.3` field
- The string values SHALL match exactly (accounting for any required encoding differences)
- Empty or missing city values SHALL result in appropriate v2 field handling
- Multiple addresses SHALL maintain proper sequence and association

**Recommended Testing Approach**:
Given the specialized nature of this requirement, this test would be most appropriate as:
1. **Integration Test**: Within systems that perform FHIR-to-v2 transformation
2. **Attestation**: Vendor confirmation of proper mapping implementation
3. **Reference Implementation Test**: Using dedicated transformation tools/libraries

---

<a id='req-342'></a>

### REQ-342: The USCorePractitionerProfile SHALL map the address state to XAD.4 in HL7 v2.

**Text**: 

**Context**: Mappings for HL7 v2 for USCorePractitionerProfile (address)

**Actor**: USCorePractitionerProfile

**Conformance**: SHALL

# Test Specification for REQ-342

## 1. Requirement ID
REQ-342

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Automatically testable

This requirement can be automatically tested by:
- Retrieving USCorePractitionerProfile resources from a FHIR server
- Extracting address.state values from the FHIR resources
- Converting the FHIR resources to HL7 v2 format using the specified mapping
- Verifying that the address.state values are correctly mapped to XAD.4 in the resulting HL7 v2 message

### Complexity
**Level**: Moderate

The test requires:
- FHIR resource retrieval and parsing
- HL7 v2 message generation or mapping validation
- Cross-format data mapping verification
- Understanding of both FHIR and HL7 v2 address structures

### Prerequisites
- US Core Server supporting Practitioner resources
- Test system capable of FHIR-to-HL7v2 conversion or mapping validation
- Access to Practitioner resources with populated address.state fields
- Understanding of HL7 v2 XAD segment structure

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources**:
- USCorePractitionerProfile resources containing address elements with populated state fields
- Resources should include various state representations (abbreviations, full names, international addresses)

**Expected Outputs**:
- HL7 v2 messages or mapping results showing XAD.4 fields populated with corresponding state values
- Validation confirmation that mapping preserves data integrity and format requirements

### Required FHIR Operations
Based on the US Core Server Capability Statement:

1. **GET /Practitioner/[id]** - Retrieve specific Practitioner resources
2. **GET /Practitioner?[search-parameters]** - Search for Practitioner resources with addresses
   - Supported search parameters as defined in US Core Practitioner profile
   - JSON format (SHALL be supported)
   - XML format (SHOULD be supported, test if available)

### Validation Criteria

**Primary Assertions**:
1. **Address State Mapping Verification**:
   - For each USCorePractitionerProfile.address.state value in the FHIR resource
   - Verify corresponding XAD.4 field in HL7 v2 contains the same state value
   - Confirm 1:1 mapping relationship between FHIR address.state and HL7 v2 XAD.4

2. **Data Integrity Checks**:
   - State values must be preserved exactly as they appear in the FHIR resource
   - No data loss or corruption during mapping process
   - Proper handling of multiple addresses (each address.state maps to corresponding XAD.4)

3. **Format Compliance**:
   - HL7 v2 XAD.4 field follows proper HL7 v2 formatting rules
   - State values conform to expected HL7 v2 data types and length restrictions

**Test Passing Criteria**:
- All address.state values from USCorePractitionerProfile are successfully mapped to XAD.4
- No missing or incorrectly mapped state values
- HL7 v2 message structure remains valid after mapping
- Mapping process handles edge cases appropriately (empty states, multiple addresses, international formats)

**Failure Conditions**:
- Any address.state value that fails to map to XAD.4
- Data corruption or loss during mapping process
- Invalid HL7 v2 message structure resulting from mapping
- Inconsistent mapping behavior across different Practitioner resources

---

<a id='req-343'></a>

### REQ-343: The USCorePractitionerProfile SHALL map the address postalCode to XAD.5 in HL7 v2.

**Text**: 

**Context**: Mappings for HL7 v2 for USCorePractitionerProfile (address)

**Actor**: USCorePractitionerProfile

**Conformance**: SHALL

# Test Specification for REQ-343

## 1. Requirement ID
REQ-343: USCorePractitionerProfile SHALL map address postalCode to XAD.5 in HL7 v2

## 2. Requirement Analysis

### Testability Assessment
**Attestation** - This requirement specifies a mapping between FHIR elements and HL7 v2 fields, which cannot be directly tested through FHIR API interactions alone. Testing requires verification that systems correctly transform FHIR postalCode data to HL7 v2 XAD.5 format during interoperability exchanges.

### Complexity
**Moderate** - While the mapping itself is straightforward (single field mapping), testing requires:
- Verification of bidirectional transformation capabilities
- Understanding of both FHIR and HL7 v2 message structures
- Validation of data preservation during format conversion

### Prerequisites
- System must support USCorePractitionerProfile
- System must have HL7 v2 transformation/mapping capabilities
- Test data must include Practitioner resources with populated address.postalCode elements
- Access to both FHIR and HL7 v2 message formats for comparison

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Practitioner resources conforming to USCorePractitionerProfile
- Practitioner.address elements with populated postalCode values
- Test data should include various postal code formats (US ZIP codes, ZIP+4, international formats)

**Expected Outputs:**
- HL7 v2 messages containing equivalent practitioner data
- XAD.5 field populated with corresponding postal code values
- Demonstration of accurate data transformation

### Required FHIR Operations
Based on the US Core Server Capability Statement:
- **GET /Practitioner/{id}** - Retrieve specific Practitioner resources for mapping verification
- **GET /Practitioner** - Search for Practitioner resources with address data
- Systems may also need to support export/transformation operations to generate HL7 v2 messages

### Validation Criteria

#### Primary Validation
1. **Mapping Accuracy Verification:**
   - For each Practitioner.address.postalCode value in FHIR format
   - Verify corresponding XAD.5 field contains identical postal code value
   - Confirm no data loss or corruption during transformation

#### Secondary Validation
2. **Data Type Consistency:**
   - Verify postal code maintains string data type characteristics
   - Confirm special characters and formatting are preserved
   - Validate handling of empty/null postal code values

3. **Multiple Address Handling:**
   - When Practitioner has multiple addresses with postal codes
   - Verify each address maps to corresponding XAD segments
   - Confirm postal codes map to correct XAD.5 positions

#### Test Assertions
- **PASS**: All Practitioner.address.postalCode values correctly appear in corresponding XAD.5 fields
- **PASS**: Data integrity maintained during FHIR to HL7 v2 transformation
- **PASS**: Multiple addresses handled correctly with proper segment mapping
- **FAIL**: Any postal code value missing, corrupted, or incorrectly positioned in HL7 v2 output
- **FAIL**: Data type or format changes that affect postal code integrity

#### Documentation Requirements
- Systems should provide mapping documentation demonstrating XAD.5 correspondence
- Test evidence should include before/after message samples
- Any transformation rules or business logic should be documented

**Note:** This test requires systems to demonstrate their mapping implementation through sample transformations or documentation, as the actual HL7 v2 message generation may occur outside the FHIR API scope covered by the Capability Statement.

---

<a id='req-344'></a>

### REQ-344: The USCorePractitionerProfile SHALL map the address country to XAD.6 in HL7 v2.

**Text**: 

**Context**: Mappings for HL7 v2 for USCorePractitionerProfile (address)

**Actor**: USCorePractitionerProfile

**Conformance**: SHALL

# Test Specification for REQ-344

## 1. Requirement ID
**REQ-344**: USCorePractitionerProfile SHALL map the address country to XAD.6 in HL7 v2

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Attestation

**Rationale**: This requirement specifies an HL7 v2 mapping constraint for the USCorePractitionerProfile address.country field. Since this involves:
- Data transformation between FHIR and HL7 v2 formats
- Internal system mapping logic that is not directly observable via FHIR API interactions
- Implementation-specific conversion processes

This requirement cannot be automatically tested through FHIR API calls alone and requires implementer attestation that the mapping is correctly implemented in their system.

### Complexity
**Simple** - The requirement is straightforward in its specification of a single field mapping.

### Prerequisites
- System must support USCorePractitionerProfile
- System must perform HL7 v2 message generation/transformation
- System must have Practitioner resources with address information including country data
- Access to both FHIR representation and generated HL7 v2 messages for comparison

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: 
  - One or more Practitioner resources conforming to USCorePractitionerProfile
  - Practitioner resources must contain address elements with country information populated
- **System Capabilities**:
  - Ability to generate HL7 v2 messages from FHIR Practitioner resources
  - Access to view or export the generated HL7 v2 message content

### Required FHIR Operations
- **GET** `/Practitioner/{id}` - Retrieve Practitioner resources for verification
- **GET** `/Practitioner` - Search for Practitioner resources with address data
- No specific FHIR operations are required beyond basic read access, as this is primarily a mapping verification

### Validation Criteria

#### Attestation-Based Validation
Since this is an internal mapping requirement, the test requires implementer attestation with the following verification steps:

1. **Source Data Verification**:
   - Confirm that Practitioner resources contain `address.country` elements
   - Verify the country values are properly populated in the FHIR representation

2. **Mapping Implementation Attestation**:
   - Implementer must attest that their system correctly maps `Practitioner.address.country` to the XAD.6 field in HL7 v2 messages
   - Provide evidence (documentation, code samples, or message examples) demonstrating the mapping implementation

3. **Functional Verification** (if possible):
   - If system provides access to generated HL7 v2 messages, verify that:
     - The XAD.6 field in generated HL7 v2 messages contains the same country value as the source FHIR `address.country`
     - The mapping preserves data integrity and format appropriately
     - Multiple address entries are handled correctly if present

#### Passing Criteria
- **Primary**: Written attestation from implementer confirming the mapping is implemented according to the specification
- **Supporting Evidence**: Any available documentation, configuration settings, or sample message comparisons demonstrating correct mapping implementation
- **Data Consistency**: If both FHIR and HL7 v2 representations are available, country values must match between `Practitioner.address.country` and XAD.6 fields

#### Failure Conditions
- Implementer cannot provide attestation of mapping implementation
- Available evidence shows country data is not being mapped to XAD.6
- Inconsistency between FHIR country values and HL7 v2 XAD.6 field content when both representations are accessible

---

<a id='req-345'></a>

### REQ-345: The USCorePractitionerProfile SHALL map the gender to STF-5 in HL7 v2.

**Text**: 

**Context**: Mappings for HL7 v2 for USCorePractitionerProfile (demographics)

**Actor**: USCorePractitionerProfile

**Conformance**: SHALL

# Test Specification for REQ-345

## 1. Requirement ID
REQ-345

## 2. Requirement Analysis

### Testability Assessment
**Attestation** - This requirement specifies a mapping between FHIR USCorePractitionerProfile gender field and HL7 v2 STF-5 field. Since this is a data transformation/mapping requirement rather than a FHIR API behavior requirement, it requires attestation that the implementation correctly maps the gender field when converting between FHIR and HL7 v2 formats.

### Complexity
**Simple** - The requirement involves a straightforward field mapping between two well-defined data elements with clear semantics.

### Prerequisites
- System must support USCorePractitionerProfile 
- System must support HL7 v2 STF (Staff Identification) segment processing
- System must have capability to convert between FHIR and HL7 v2 formats
- Test data must include Practitioner resources with gender values
- Access to both FHIR format and corresponding HL7 v2 format representations

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Practitioner resources conforming to USCorePractitionerProfile with populated `gender` field
- Test should include practitioners with various gender values:
  - `male`
  - `female` 
  - `other`
  - `unknown`
  - Resources with missing/null gender values

**Expected Outputs:**
- Corresponding HL7 v2 messages containing STF segments with STF-5 field populated according to the mapping
- Documentation or attestation demonstrating the mapping implementation

### Required FHIR Operations
Based on the US Core Server Capability Statement, the following operations should be supported for obtaining test data:

- `GET /Practitioner/{id}` - Retrieve specific Practitioner resources
- `GET /Practitioner?_profile=http://hl7.org/fhir/us/core/StructureDefinition/us-core-practitioner` - Search for practitioners conforming to US Core profile
- Any additional search parameters supported by the implementation for Practitioner resources

**Note:** The core testing focus is on the mapping attestation rather than FHIR API operations, as the mapping occurs during format conversion processes.

### Validation Criteria

#### Primary Validation (Attestation Required):
1. **Mapping Accuracy Attestation:**
   - Implementer must demonstrate that when a FHIR Practitioner.gender value is processed, it is correctly mapped to the corresponding HL7 v2 STF-5 field
   - Provide evidence of the mapping implementation (code, configuration, or documentation)

2. **Value Mapping Verification:**
   - `Practitioner.gender = "male"` maps to appropriate STF-5 value per HL7 v2 specification
   - `Practitioner.gender = "female"` maps to appropriate STF-5 value per HL7 v2 specification  
   - `Practitioner.gender = "other"` maps to appropriate STF-5 value per HL7 v2 specification
   - `Practitioner.gender = "unknown"` maps to appropriate STF-5 value per HL7 v2 specification
   - Missing/null gender values are handled appropriately in STF-5

3. **Profile Conformance:**
   - Verify that source FHIR resources conform to USCorePractitionerProfile
   - Confirm that gender field usage aligns with US Core profile requirements

#### Supporting Validation:
1. **Data Consistency:**
   - Demonstrate that the same practitioner data maintains gender mapping consistency across multiple conversions
   - Show that the mapping process preserves data integrity

2. **Implementation Documentation:**
   - Provide clear documentation of how the mapping is implemented
   - Demonstrate understanding of both USCorePractitionerProfile gender semantics and HL7 v2 STF-5 requirements

#### Test Pass Criteria:
- Implementer provides satisfactory attestation demonstrating correct gender mapping implementation
- Mapping handles all supported gender values appropriately
- Implementation maintains data consistency and integrity during conversion
- Documentation clearly describes the mapping process and any implementation-specific considerations

#### Test Fail Criteria:
- Unable to demonstrate correct mapping between Practitioner.gender and STF-5
- Mapping implementation shows data loss or corruption
- Implementation does not handle all required gender values
- Insufficient documentation or evidence of proper mapping implementation

---

<a id='req-346'></a>

### REQ-346: The USCorePractitionerProfile SHALL map the birthDate to STF-6 in HL7 v2.

**Text**: 

**Context**: Mappings for HL7 v2 for USCorePractitionerProfile (demographics)

**Actor**: USCorePractitionerProfile

**Conformance**: SHALL

# Test Specification for REQ-346

## 1. Requirement ID
REQ-346

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified programmatically by examining FHIR Practitioner resources that conform to the USCorePractitionerProfile and validating the presence and format of the birthDate field, which maps to STF-6 in HL7 v2.

### Complexity
**Simple** - The test involves straightforward validation of a single data element mapping and its presence in FHIR resources.

### Prerequisites
- Server implementing US Core Server CapabilityStatement with Practitioner resource support
- Test data containing Practitioner resources conforming to USCorePractitionerProfile
- Access to retrieve Practitioner resources via FHIR RESTful API
- Understanding of HL7 v2 STF-6 field requirements (Staff Birth Date/Time)

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Practitioner resources that claim conformance to USCorePractitionerProfile (indicated by `meta.profile` containing the US Core Practitioner profile URL)
- **Expected Outputs**: Validation results confirming birthDate element presence and proper mapping capability to HL7 v2 STF-6 field

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported:
- **GET /Practitioner/[id]** - Retrieve specific Practitioner resources
- **GET /Practitioner** - Search for Practitioner resources (if search parameters are supported)

### Validation Criteria

#### Primary Assertions
1. **Profile Conformance Validation**:
   - Verify that Practitioner resources claiming USCorePractitionerProfile conformance include the profile URL in `meta.profile`
   - Confirm resources pass FHIR validation against the USCorePractitionerProfile

2. **birthDate Element Mapping Validation**:
   - **Presence Check**: Verify that `Practitioner.birthDate` element is present when demographic data is included
   - **Data Type Validation**: Confirm `birthDate` conforms to FHIR `date` data type (YYYY, YYYY-MM, or YYYY-MM-DD format)
   - **Mapping Compatibility**: Validate that the birthDate format is compatible with HL7 v2 STF-6 field requirements (timestamp format in STF-6)

3. **Conformance Level Validation**:
   - Since this is a SHALL requirement, verify that systems claiming USCorePractitionerProfile conformance consistently include birthDate when practitioner demographic data is present

#### Test Execution Steps
1. **Resource Discovery**: Identify all Practitioner resources in the test dataset that claim conformance to USCorePractitionerProfile
2. **Element Validation**: For each identified resource, validate the presence and format of the `birthDate` element
3. **Mapping Verification**: Confirm that the birthDate value can be appropriately mapped to HL7 v2 STF-6 format
4. **Conformance Assessment**: Report any instances where birthDate is missing or improperly formatted in resources claiming profile conformance

#### Pass Criteria
- All Practitioner resources claiming USCorePractitionerProfile conformance that include demographic data contain a valid `birthDate` element
- All birthDate values conform to FHIR date format specifications
- birthDate values are suitable for mapping to HL7 v2 STF-6 field format

#### Failure Conditions
- Any Practitioner resource claiming USCorePractitionerProfile conformance lacks a `birthDate` element when demographic data is present
- birthDate values that do not conform to FHIR date format
- birthDate values that cannot be appropriately mapped to HL7 v2 STF-6 format requirements

---

<a id='req-347'></a>

### REQ-347: The USCorePractitionerProfile SHALL map the communication to PID-15, NK1-20, LAN-2 in HL7 v2.

**Text**: 

**Context**: Mappings for HL7 v2 for USCorePractitionerProfile (communication)

**Actor**: USCorePractitionerProfile

**Conformance**: SHALL

# Test Specification for REQ-347

## 1. Requirement ID
**REQ-347**: USCorePractitionerProfile Communication HL7 v2 Mapping

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Not testable due to being covered by the validator

**Rationale**: This requirement specifies a mapping between FHIR USCorePractitionerProfile.communication element and specific HL7 v2 segments (PID-15, NK1-20, LAN-2). This is a structural mapping specification that defines how data should be transformed between formats, not a behavioral requirement that can be tested through FHIR API interactions. The correct mapping implementation would be validated through:
- FHIR profile validation tools that verify the USCorePractitionerProfile structure
- HL7 v2 to FHIR transformation validation tools
- Static code analysis of mapping implementations

### Complexity
**Level**: N/A (Not testable through API testing)

### Prerequisites
N/A - This requirement cannot be tested through FHIR API interactions as it defines data transformation mappings rather than API behavior.

## 3. Test Implementation Strategy

### Required Inputs
This requirement cannot be implemented as a FHIR API test because:

1. **Mapping Specification Nature**: The requirement defines how data elements should be mapped during transformation between HL7 v2 and FHIR formats, not how a FHIR server should behave when processing requests.

2. **No Observable API Behavior**: There is no specific FHIR operation or server behavior that can be tested to verify this mapping requirement through API calls.

3. **Transformation Logic**: The mapping logic exists in transformation engines/middleware, not in the FHIR server's API responses.

### Required FHIR Operations
N/A - No FHIR operations can directly test mapping specifications.

### Validation Criteria
This requirement should be validated through:

1. **Profile Validation**: Verify that Practitioner resources conform to the USCorePractitionerProfile structure, including the presence and format of the `communication` element
2. **Transformation Testing**: Test HL7 v2 to FHIR transformation tools to ensure PID-15, NK1-20, and LAN-2 segments are correctly mapped to the `communication` element
3. **Documentation Review**: Verify that implementation documentation correctly specifies the mapping relationships

### Recommendation
This requirement should be reclassified as a **documentation/implementation guidance requirement** rather than a testable conformance requirement. Testing should focus on:
- Validating that USCorePractitionerProfile resources contain properly formatted `communication` elements
- Ensuring transformation tools correctly implement the specified mappings
- Verifying that implementer documentation accurately describes the mapping relationships

The actual interoperability testing should focus on whether systems can successfully exchange and process USCorePractitionerProfile resources with communication data, rather than testing the specific HL7 v2 mapping implementation details.

---

<a id='req-524'></a>

### REQ-524: US Core Client SHALL fetch Practitioner resources.

**Text**: 

**Context**: US Core Client read interaction for Practitioner by id

**Actor**: US Core Client

**Conformance**: SHALL

# Test Specification for REQ-524

## 1. Requirement ID
REQ-524: US Core Client SHALL fetch Practitioner resources

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement involves a specific FHIR REST API operation (read by id) that can be programmatically tested through standard HTTP interactions.

### Complexity
**Simple** - The requirement involves a single, well-defined FHIR operation (read interaction) with clear success/failure criteria.

### Prerequisites
- US Core Server implementing the US Core Practitioner profile
- At least one valid Practitioner resource available on the server with a known resource ID
- Client system capable of making FHIR REST API calls
- Appropriate authentication/authorization credentials if required by the server
- Network connectivity between client and server

## 3. Test Implementation Strategy

### Required Inputs
- **Server Base URL**: The FHIR server endpoint URL
- **Practitioner Resource ID**: A valid identifier for an existing Practitioner resource on the server
- **Authentication credentials** (if required by server security implementation)

### Required FHIR Operations
- **GET /Practitioner/{id}** - Read interaction to fetch a specific Practitioner resource by its logical ID

### Validation Criteria

#### Primary Success Criteria
1. **HTTP Response Status**: Server returns HTTP 200 (OK) status code
2. **Response Content Type**: Server returns `application/fhir+json` or `application/json` content type (JSON support is required per Capability Statement)
3. **Resource Type Validation**: Response body contains a valid FHIR Practitioner resource
4. **Resource ID Match**: The returned resource's `id` field matches the requested ID
5. **Profile Conformance**: The returned Practitioner resource conforms to the US Core Practitioner profile requirements

#### Secondary Validation Criteria
1. **Meta Profile Declaration**: If present, `meta.profile` should reference the US Core Practitioner profile
2. **Must Support Elements**: All populated elements marked as "Must Support" in the US Core Practitioner profile should be properly formatted and valid
3. **FHIR Version**: Response should be consistent with FHIR R4 specification

#### Error Handling Validation
Test should verify appropriate error responses for invalid scenarios:
1. **HTTP 404**: When requesting a non-existent Practitioner ID
2. **HTTP 401/403**: When authentication/authorization fails (if security is implemented)
3. **HTTP 400**: When providing malformed request parameters

#### Test Assertions
- **Assert**: HTTP status code equals 200
- **Assert**: Response content-type contains "json"
- **Assert**: Response body parses as valid JSON
- **Assert**: JSON contains `resourceType` field with value "Practitioner"
- **Assert**: JSON contains `id` field matching the requested ID
- **Assert**: Resource validates against FHIR R4 Practitioner structure definition
- **Assert**: Resource validates against US Core Practitioner profile constraints

### Test Execution Flow
1. **Setup**: Verify server availability and obtain valid Practitioner ID
2. **Execute**: Perform GET request to `/Practitioner/{id}` endpoint
3. **Validate Response**: Check HTTP status, headers, and response body structure
4. **Profile Validation**: Validate returned resource against US Core Practitioner profile
5. **Cleanup**: No cleanup required for read operations

### Expected Outputs
- **Success Case**: Valid US Core Practitioner resource in JSON format with HTTP 200 status
- **Failure Cases**: Appropriate HTTP error status codes with OperationOutcome resources explaining the error when applicable

---



<a id='practitionerrole'></a>

## PractitionerRole

<a id='req-215'></a>

### REQ-215: The USCorePractitionerRoleProfile SHALL map the during to .effectiveTime in RIM Mapping.

**Text**: 

**Context**: 

**Actor**: USCorePractitionerRoleProfile

**Conformance**: SHALL

# Test Specification for REQ-215

## 1. Requirement ID
REQ-215

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Not testable due to being too vague and covered by the validator

**Rationale**: This requirement specifies a RIM (Reference Information Model) mapping between USCorePractitionerRoleProfile's "during" element and RIM's ".effectiveTime". RIM mappings are:
- Implementation-specific transformations that occur internally within systems
- Not exposed through FHIR API interactions
- Conceptual mappings for implementer guidance rather than testable behaviors
- Already validated by the FHIR validator if the profile correctly defines the mapping

### Complexity
**Simple** - The mapping itself is straightforward, but the testability is the primary concern.

### Prerequisites
- System implementing USCorePractitionerRoleProfile
- PractitionerRole resources with period/timing information
- Understanding that this tests the profile structure rather than runtime behavior

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources**:
- PractitionerRole resources conforming to USCorePractitionerRoleProfile
- Resources should include period elements that would map to the "during" concept

**Expected Outputs**:
- Profile validation confirmation
- Structural verification that the mapping is properly defined in the profile

### Required FHIR Operations
Based on the US Core Server CapabilityStatement:
- **GET** operations for PractitionerRole resources (if supported by the server's capability statement)
- **Profile validation** operations

*Note: The specific FHIR operations depend on whether PractitionerRole is supported in the server's capability statement, which should be verified.*

### Validation Criteria

**Primary Validation**:
1. **Profile Structure Validation**: Verify that the USCorePractitionerRoleProfile correctly defines the RIM mapping in its structure definition
2. **Mapping Documentation**: Confirm that the profile metadata includes the specified RIM mapping for the "during" element to ".effectiveTime"

**Secondary Validation** (if testable):
1. **Resource Conformance**: Validate that PractitionerRole instances conform to the USCorePractitionerRoleProfile
2. **Element Presence**: Verify that resources contain the temporal/period elements that correspond to the "during" concept

**Test Passing Criteria**:
- The USCorePractitionerRoleProfile structure definition contains the RIM mapping specification
- FHIR validator confirms profile conformance for test resources
- No validation errors related to the mapping structure

**Important Note**: This requirement primarily concerns profile definition and conceptual mapping rather than runtime API behavior. The actual verification may be limited to structural validation of the profile definition itself, as RIM mappings are not directly testable through FHIR API interactions.

---

<a id='req-216'></a>

### REQ-216: The USCorePractitionerRoleProfile SHALL map the availabilityExceptions to .effectiveTime in RIM Mapping.

**Text**: 

**Context**: 

**Actor**: USCorePractitionerRoleProfile

**Conformance**: SHALL

# Test Specification for REQ-216

## 1. Requirement ID
**REQ-216**: USCorePractitionerRoleProfile SHALL map availabilityExceptions to .effectiveTime in RIM Mapping

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Not testable - Covered by validator

**Rationale**: This requirement specifically addresses RIM (Reference Information Model) mapping requirements, which are structural mapping specifications that define how FHIR elements correspond to HL7 RIM attributes. RIM mappings are:
- Metadata annotations within the FHIR profile structure
- Validated through profile validation tools
- Not testable through runtime API interactions
- Design-time constraints rather than runtime behaviors

The requirement ensures that the `availabilityExceptions` element in the USCorePractitionerRoleProfile has the correct RIM mapping to `.effectiveTime`, which is a structural validation concern handled by FHIR validators and profile validation tools.

### Complexity
**Level**: Simple (if it were testable)

The requirement addresses a single mapping relationship between one FHIR element and one RIM attribute.

### Prerequisites
Not applicable - this requirement is validated through profile structure validation rather than runtime testing.

## 3. Test Implementation Strategy

### Required Inputs
Not applicable - RIM mapping validation does not require runtime data or API interactions.

### Required FHIR Operations
Not applicable - no FHIR API operations are needed to validate RIM mappings.

### Validation Criteria
**Alternative Validation Approach**: Since this requirement cannot be tested through API interactions, conformance should be verified through:

1. **Profile Structure Validation**:
   - Verify the USCorePractitionerRoleProfile definition contains the correct RIM mapping annotation
   - Confirm `availabilityExceptions` element includes `mapping.identity = "rim"` and `mapping.map = "effectiveTime"`

2. **FHIR Validator Confirmation**:
   - Use official FHIR validation tools to confirm profile structure compliance
   - Verify no validation errors related to RIM mapping requirements

**Note**: This requirement falls outside the scope of interoperability testing through API interactions and should be addressed through profile validation and structural conformance verification tools rather than runtime testing scenarios.

---

<a id='req-217'></a>

### REQ-217: The USCorePractitionerRoleProfile SHALL map the identifier to ./Identifiers in ServD Mapping.

**Text**: 

**Context**: 

**Actor**: USCorePractitionerRoleProfile

**Conformance**: SHALL

# Test Specification for REQ-217

## 1. Requirement ID
REQ-217

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement involves verifying that the USCorePractitionerRoleProfile correctly maps the identifier field to the ServD Mapping specification. This can be validated through automated testing by examining the resource structure and identifier mappings.

### Complexity
**Simple** - The requirement focuses on a specific field mapping verification which involves straightforward structural validation of the identifier field in PractitionerRole resources.

### Prerequisites
- FHIR server implementing US Core PractitionerRole Profile
- Test system capable of retrieving PractitionerRole resources
- Understanding of ServD Mapping specification for identifier field mapping
- PractitionerRole resources with populated identifier fields in the test dataset

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: PractitionerRole resources conforming to US Core PractitionerRole Profile
- **Test Data**: PractitionerRole instances with various identifier types and values
- **Reference Documentation**: ServD Mapping specification defining the expected ./Identifiers mapping structure

### Expected Outputs
- Validation confirmation that identifier fields in PractitionerRole resources are properly mapped according to ServD specification
- Test results indicating conformance or non-conformance with the mapping requirements

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for PractitionerRole:
- **GET /PractitionerRole/{id}** - Retrieve specific PractitionerRole resources
- **GET /PractitionerRole?practitioner={practitioner_id}** - Search PractitionerRole by practitioner
- **GET /PractitionerRole?specialty={specialty_code}** - Search PractitionerRole by specialty
- **GET /PractitionerRole?_include=PractitionerRole:endpoint** - Include related endpoint resources
- **GET /PractitionerRole?_include=PractitionerRole:practitioner** - Include related practitioner resources

### Validation Criteria

#### Primary Assertions
1. **Identifier Structure Validation**:
   - Verify that PractitionerRole.identifier field exists when identifiers are present
   - Confirm identifier array structure matches FHIR specification
   - Validate that identifier elements contain required sub-elements (system, value, use, type as applicable)

2. **ServD Mapping Compliance**:
   - Verify that the identifier field maps correctly to ./Identifiers in the ServD specification
   - Confirm that identifier values are properly formatted according to ServD requirements
   - Validate that identifier system URIs are appropriate and recognized
   - Ensure identifier use codes align with ServD mapping expectations

3. **Profile Conformance**:
   - Confirm that retrieved PractitionerRole resources declare conformance to US Core PractitionerRole Profile in meta.profile
   - Validate that identifier field follows US Core PractitionerRole Profile constraints
   - Verify that any required identifier elements per the profile are present

#### Test Execution Steps
1. **Resource Retrieval**: Use supported search operations to retrieve PractitionerRole resources from the test dataset
2. **Profile Validation**: Confirm each resource declares US Core PractitionerRole Profile conformance
3. **Identifier Analysis**: Extract and examine identifier fields from retrieved resources
4. **Mapping Verification**: Validate that identifier structure and content align with ServD ./Identifiers mapping requirements
5. **Compliance Assessment**: Determine pass/fail status based on mapping conformance

#### Success Criteria
- All PractitionerRole resources with identifiers successfully map identifier field to ./Identifiers per ServD specification
- Identifier structure conforms to both FHIR standard and US Core profile requirements
- No mapping inconsistencies or structural violations detected
- Retrieved resources properly declare US Core PractitionerRole Profile conformance

#### Failure Conditions
- PractitionerRole resources fail to map identifier field correctly to ServD ./Identifiers specification
- Identifier structure does not conform to expected format
- Missing required identifier elements as defined by ServD mapping
- Resources do not declare proper US Core profile conformance

---

<a id='req-218'></a>

### REQ-218: The USCorePractitionerRoleProfile SHALL map the specialty to ./Specialty in ServD Mapping.

**Text**: 

**Context**: 

**Actor**: USCorePractitionerRoleProfile

**Conformance**: SHALL

# Test Specification for REQ-218

## 1. Requirement ID
REQ-218

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Automatically testable

This requirement is testable through automated validation of FHIR resource structure and mapping verification. The requirement specifies a concrete mapping rule that can be validated by examining PractitionerRole resources conforming to the US Core PractitionerRole Profile and verifying that specialty information is properly mapped to the `.specialty` element as defined in ServD mapping specifications.

### Complexity
**Simple**

The requirement involves a straightforward field mapping validation within a single FHIR resource profile. It requires checking that specialty data in US Core PractitionerRole instances is correctly populated in the `.specialty` element according to ServD mapping rules.

### Prerequisites
- FHIR server implementing US Core PractitionerRole Profile
- Test data containing PractitionerRole resources with specialty information
- Access to ServD mapping specifications for validation reference
- FHIR client capable of retrieving and parsing PractitionerRole resources

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- PractitionerRole resources conforming to US Core PractitionerRole Profile
- Resources should contain specialty information to enable mapping validation

**Expected Outputs:**
- Validation results confirming specialty data is mapped to `.specialty` element
- Confirmation that mapping follows ServD specification requirements

### Required FHIR Operations
Based on the Capability Statement, the following supported operations will be used:

1. **Search PractitionerRole by specialty:**
   ```
   GET [base]/PractitionerRole?specialty=[code]
   ```

2. **Search PractitionerRole by practitioner:**
   ```
   GET [base]/PractitionerRole?practitioner=[reference]
   ```

3. **Retrieve specific PractitionerRole:**
   ```
   GET [base]/PractitionerRole/[id]
   ```

4. **Include related resources (if needed):**
   ```
   GET [base]/PractitionerRole?_include=PractitionerRole:practitioner
   GET [base]/PractitionerRole?_include=PractitionerRole:endpoint
   ```

### Validation Criteria

**Primary Assertions:**

1. **Profile Conformance Validation:**
   - Verify that retrieved PractitionerRole resources declare conformance to US Core PractitionerRole Profile in `meta.profile`
   - Ensure resources pass US Core PractitionerRole Profile validation

2. **Specialty Element Presence:**
   - Confirm that PractitionerRole resources contain the `.specialty` element when specialty information is available
   - Verify `.specialty` is properly structured according to FHIR specifications

3. **ServD Mapping Compliance:**
   - Validate that specialty information is correctly mapped to the `.specialty` element as required by ServD mapping
   - Verify coding systems and values used in `.specialty` align with ServD specifications
   - Ensure no specialty information is lost or incorrectly mapped

4. **Search Functionality Verification:**
   - Confirm that searching by specialty parameter returns appropriate PractitionerRole resources
   - Verify search results contain resources with matching specialty values in the `.specialty` element

**Test Execution Steps:**

1. Query the FHIR server for PractitionerRole resources using supported search parameters
2. Retrieve a sample of PractitionerRole resources that contain specialty information
3. For each retrieved resource:
   - Validate profile conformance to US Core PractitionerRole Profile
   - Check presence and structure of `.specialty` element
   - Verify specialty data mapping follows ServD specifications
   - Confirm search functionality works correctly with specialty parameters

**Success Criteria:**
- All PractitionerRole resources conform to US Core PractitionerRole Profile
- Specialty information is consistently and correctly mapped to `.specialty` element
- Search by specialty returns accurate and complete results
- No specialty data is missing or incorrectly mapped according to ServD specifications

**Failure Scenarios:**
- PractitionerRole resources missing `.specialty` element when specialty data should be present
- Incorrect coding systems or values used in `.specialty` element
- Search by specialty parameter fails or returns incomplete results
- Profile validation failures for US Core PractitionerRole Profile conformance

---

<a id='req-219'></a>

### REQ-219: The USCorePractitionerRoleProfile SHALL map the telecom system to ./ContactPointType in ServD Mapping.

**Text**: 

**Context**: 

**Actor**: USCorePractitionerRoleProfile

**Conformance**: SHALL

# Test Specification for REQ-219

## 1. Requirement ID
REQ-219

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be automatically tested by examining the mapping of telecom system values to ServD ContactPointType in USCorePractitionerRole profile instances.

### Complexity
**Simple** - The requirement focuses on a specific mapping validation between a single element (telecom.system) and its corresponding ServD mapping representation.

### Prerequisites
- Test system must support US Core Server capabilities as defined in the Capability Statement
- Test system must have USCorePractitionerRole resources available with telecom elements populated
- Access to ServD mapping documentation/schema for ContactPointType validation
- JSON format support (SHALL per Capability Statement)

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- USCorePractitionerRole resources containing telecom elements with populated system values
- Resources should include various telecom system types (phone, fax, email, pager, url, sms, other)

**Expected Outputs:**
- Validation that each telecom.system value correctly maps to the appropriate ServD ContactPointType
- Confirmation that all telecom system mappings are present and accurate in the ServD representation

### Required FHIR Operations
Based on the US Core Server Capability Statement:
- **GET** operations to retrieve USCorePractitionerRole resources
- **Search** operations using supported search parameters for PractitionerRole resources
- Support for JSON format (required per Capability Statement)

### Validation Criteria

#### Primary Assertions:
1. **Mapping Completeness**: For each USCorePractitionerRole resource with telecom elements:
   - Verify that every telecom.system value has a corresponding mapping to ServD ContactPointType
   - Ensure no telecom.system values are unmapped or missing from the ServD representation

2. **Mapping Accuracy**: For each telecom system type:
   - `phone` → maps to appropriate ServD ContactPointType for phone
   - `fax` → maps to appropriate ServD ContactPointType for fax
   - `email` → maps to appropriate ServD ContactPointType for email
   - `pager` → maps to appropriate ServD ContactPointType for pager
   - `url` → maps to appropriate ServD ContactPointType for url
   - `sms` → maps to appropriate ServD ContactPointType for sms
   - `other` → maps to appropriate ServD ContactPointType for other

3. **Profile Conformance**: 
   - Validate that tested resources conform to USCorePractitionerRole profile
   - Verify meta.profile includes US Core PractitionerRole profile URI (if present, per Capability Statement recommendation)

#### Test Execution Steps:
1. **Resource Retrieval**: Query the test system for USCorePractitionerRole resources containing telecom elements
2. **Data Extraction**: Extract all telecom.system values from retrieved resources
3. **Mapping Validation**: For each telecom.system value, verify the corresponding ServD ContactPointType mapping exists and is correct
4. **Completeness Check**: Ensure all telecom.system values are accounted for in the mapping
5. **Format Compliance**: Verify responses are in JSON format as required

#### Pass/Fail Criteria:
- **Pass**: All telecom.system values in USCorePractitionerRole resources correctly map to their corresponding ServD ContactPointType values with 100% accuracy and completeness
- **Fail**: Any telecom.system value is unmapped, incorrectly mapped, or missing from the ServD ContactPointType representation

#### Error Handling Validation:
- Test system should return appropriate HTTP status codes as specified in Capability Statement (400, 401, 403, 404)
- Verify unauthorized requests are properly rejected per security requirements

---

<a id='req-220'></a>

### REQ-220: The USCorePractitionerRoleProfile SHALL map the telecom value to ./Value in ServD Mapping.

**Text**: 

**Context**: 

**Actor**: USCorePractitionerRoleProfile

**Conformance**: SHALL

# Test Specification for REQ-220

## 1. Requirement ID
**REQ-220**: USCorePractitionerRoleProfile SHALL map the telecom value to ./Value in ServD Mapping

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Attestation

**Rationale**: This requirement concerns the mapping specification between US Core PractitionerRole profile and ServD (a service directory mapping standard). This is a documentation/specification mapping requirement rather than a runtime behavior that can be automatically validated through FHIR operations. The actual mapping logic would be implemented within the server's internal data transformation processes and cannot be directly observed or tested through standard FHIR API interactions.

### Complexity
**Simple** - The requirement is straightforward in its intent (mapping telecom values), though testing it requires attestation rather than automated verification.

### Prerequisites
- System must support US Core PractitionerRole profile
- System must implement or document ServD mapping capabilities
- Access to system documentation or mapping specifications
- PractitionerRole resources with telecom elements available in the test system

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: PractitionerRole resources conforming to US Core PractitionerRole profile that contain telecom elements
- **Documentation**: System's ServD mapping specification or implementation documentation
- **Expected Outputs**: Attestation or documentation evidence that telecom values are mapped to ./Value in ServD format

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and may be used to gather test data:
- **READ**: Retrieve specific PractitionerRole resources to examine telecom structure
- **SEARCH**: Query for PractitionerRole resources with telecom elements
  - Standard FHIR search parameters as referenced in the Capability Statement
- **Response Format**: JSON (SHALL be supported), XML (SHOULD be supported)

### Validation Criteria

#### Primary Validation (Attestation-based):
1. **Mapping Documentation Review**:
   - Verify that system documentation explicitly states that US Core PractitionerRole.telecom values are mapped to ./Value in ServD mapping
   - Confirm that the mapping specification addresses the complete telecom element structure

2. **Implementation Evidence**:
   - Review system configuration or code that demonstrates the telecom to ./Value mapping
   - Validate that the mapping preserves the semantic meaning of telecom data

#### Supporting Technical Validation:
1. **Profile Conformance**:
   - Verify that PractitionerRole resources conform to US Core PractitionerRole profile
   - Confirm that telecom elements are present and properly structured according to US Core requirements

2. **Data Structure Verification**:
   - Examine sample PractitionerRole resources to ensure telecom elements contain appropriate values
   - Verify that telecom structure follows FHIR ContactPoint datatype specifications

#### Test Pass Criteria:
- **Primary**: System documentation or attestation confirms that telecom values are mapped to ./Value in ServD mapping
- **Supporting**: Retrieved PractitionerRole resources demonstrate proper US Core profile conformance with valid telecom elements
- **Response Handling**: System returns appropriate HTTP status codes as specified in Capability Statement (400, 401, 403, 404 for error conditions)

#### Test Fail Criteria:
- Documentation does not specify or contradicts the required telecom to ./Value mapping
- System cannot provide evidence of ServD mapping implementation
- Retrieved PractitionerRole resources do not conform to US Core profile requirements
- System fails to return appropriate HTTP responses for valid/invalid requests

### Additional Considerations:
- This test requires coordination between technical testing and documentation review
- The "bring your own data" approach means testers should use their existing PractitionerRole resources with telecom elements
- Testing should focus on the mapping specification rather than exhaustive data validation
- Consider requesting sample ServD output to verify the mapping implementation if available

---

<a id='req-221'></a>

### REQ-221: The USCorePractitionerRoleProfile SHALL map the telecom use to ./ContactPointPurpose in ServD Mapping.

**Text**: 

**Context**: 

**Actor**: USCorePractitionerRoleProfile

**Conformance**: SHALL

# Test Specification for REQ-221

## 1. Requirement ID
REQ-221

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified through automated testing by examining the mapping of telecom.use values to ContactPointPurpose in ServD format within USCorePractitionerRoleProfile instances.

### Complexity
**Simple** - The test involves straightforward validation of data mapping between two specific fields in a well-defined profile.

### Prerequisites
- Access to a FHIR server implementing US Core Server CapabilityStatement
- PractitionerRole resources conforming to USCorePractitionerRoleProfile
- PractitionerRole resources containing telecom elements with use values
- Understanding of ServD mapping specifications for ContactPointPurpose

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- One or more PractitionerRole resources that:
  - Conform to USCorePractitionerRoleProfile
  - Contain `telecom` elements with populated `use` values
  - Have been processed through ServD mapping

**Expected Outputs:**
- Mapped representation showing telecom.use values correctly translated to ContactPointPurpose in ServD format
- Confirmation that all telecom.use values have corresponding ContactPointPurpose mappings

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are supported and required:

1. **GET /PractitionerRole/[id]** - Retrieve specific PractitionerRole resources
2. **GET /PractitionerRole?[search-parameters]** - Search for PractitionerRole resources (if search parameters are supported for PractitionerRole)

### Validation Criteria

**Primary Assertions:**
1. **Profile Conformance**: Verify that the PractitionerRole resource conforms to USCorePractitionerRoleProfile
2. **Telecom Presence**: Confirm that the resource contains at least one `telecom` element with a populated `use` value
3. **ServD Mapping Verification**: Validate that each `telecom.use` value is correctly mapped to the corresponding `ContactPointPurpose` in the ServD mapping representation
4. **Completeness**: Ensure no `telecom.use` values are left unmapped in the ServD representation

**Specific Test Steps:**
1. Retrieve PractitionerRole resource(s) from the server using supported FHIR operations
2. Validate the resource conforms to USCorePractitionerRoleProfile using the meta.profile assertion or structural validation
3. Extract all `telecom` elements that contain a `use` value
4. For each `telecom.use` value, verify the ServD mapping contains the appropriate `ContactPointPurpose` entry
5. Confirm the mapping follows the ServD specification requirements for ContactPointPurpose values

**Pass Criteria:**
- All PractitionerRole resources conform to USCorePractitionerRoleProfile
- Every `telecom.use` value present in the resource has a corresponding `ContactPointPurpose` mapping in ServD format
- The mapping values are valid according to ServD ContactPointPurpose specifications
- No telecom.use values are missing from the ServD mapping representation

**Failure Conditions:**
- PractitionerRole resource does not conform to USCorePractitionerRoleProfile
- One or more `telecom.use` values are not mapped to ContactPointPurpose in ServD
- Mapping contains invalid ContactPointPurpose values according to ServD specifications
- Server returns error responses (400, 401, 403, 404) when attempting to retrieve conforming resources

---

<a id='req-222'></a>

### REQ-222: The USCorePractitionerRoleProfile SHALL map the period to ./StartDate and ./EndDate in ServD Mapping.

**Text**: 

**Context**: 

**Actor**: USCorePractitionerRoleProfile

**Conformance**: SHALL

# Test Specification for REQ-222

## 1. Requirement ID
REQ-222

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated testing by examining the mapping of FHIR PractitionerRole.period elements to ServD StartDate and EndDate fields.

### Complexity
**Simple** - The requirement involves straightforward field mapping validation between FHIR elements and ServD fields.

### Prerequisites
- System must support US Core PractitionerRole Profile
- System must implement ServD mapping functionality
- Test data must include PractitionerRole resources with period elements populated
- Access to both FHIR API and ServD mapping output/configuration

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- PractitionerRole resources conforming to US Core PractitionerRole Profile
- Resources must contain populated `period` elements with:
  - `period.start` (mapped to ServD StartDate)
  - `period.end` (mapped to ServD EndDate) 
  - Resources with only `period.start` populated
  - Resources with only `period.end` populated
  - Resources with both start and end dates

**Expected Outputs:**
- ServD mapping output showing StartDate and EndDate fields populated according to the FHIR period values
- Mapping documentation or configuration demonstrating the field relationships

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for PractitionerRole:

1. **Search Operations:**
   - `GET [base]/PractitionerRole?practitioner=[id]`
   - `GET [base]/PractitionerRole?specialty=[code]`

2. **Read Operations:**
   - `GET [base]/PractitionerRole/[id]`

3. **Include Operations:**
   - `GET [base]/PractitionerRole?_include=PractitionerRole:endpoint`
   - `GET [base]/PractitionerRole?_include=PractitionerRole:practitioner`

### Validation Criteria

**Primary Validation Checks:**

1. **Period Start Mapping Verification:**
   - ASSERTION: When PractitionerRole.period.start is present, it SHALL be mapped to ServD StartDate
   - VERIFICATION: Compare PractitionerRole.period.start value with corresponding ServD StartDate field
   - EXPECTED RESULT: Values must match exactly (accounting for date/datetime format conversions)

2. **Period End Mapping Verification:**
   - ASSERTION: When PractitionerRole.period.end is present, it SHALL be mapped to ServD EndDate
   - VERIFICATION: Compare PractitionerRole.period.end value with corresponding ServD EndDate field
   - EXPECTED RESULT: Values must match exactly (accounting for date/datetime format conversions)

3. **Null Value Handling:**
   - ASSERTION: When PractitionerRole.period.start is absent, ServD StartDate should be null/empty
   - ASSERTION: When PractitionerRole.period.end is absent, ServD EndDate should be null/empty
   - VERIFICATION: Check ServD fields remain unpopulated when corresponding FHIR elements are missing

4. **Data Type Consistency:**
   - ASSERTION: Date/datetime formats are consistently handled in the mapping
   - VERIFICATION: Ensure proper conversion between FHIR date/dateTime types and ServD date formats
   - EXPECTED RESULT: No data loss or format corruption in the mapping process

**Test Execution Steps:**

1. Retrieve PractitionerRole resources using supported search parameters
2. Extract period.start and period.end values from each resource
3. Access corresponding ServD mapping output for the same practitioner roles
4. Verify that FHIR period.start values correctly map to ServD StartDate
5. Verify that FHIR period.end values correctly map to ServD EndDate
6. Confirm proper handling of missing/null period values
7. Validate data type conversions and format consistency

**Pass Criteria:**
- All period.start values are correctly mapped to ServD StartDate
- All period.end values are correctly mapped to ServD EndDate  
- Missing period elements result in appropriate null/empty ServD fields
- No data corruption occurs during the mapping process
- Mapping is consistent across all test PractitionerRole resources

---

<a id='req-223'></a>

### REQ-223: The USCorePractitionerRoleProfile SHALL map the identifier to FiveWs.identifier in FiveWs Pattern Mapping.

**Text**: 

**Context**: 

**Actor**: USCorePractitionerRoleProfile

**Conformance**: SHALL

# Test Specification for REQ-223

## 1. Requirement ID
**REQ-223**: USCorePractitionerRoleProfile SHALL map the identifier to FiveWs.identifier in FiveWs Pattern Mapping

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Automatically testable

This requirement is automatically testable as it involves verifying a specific structural mapping within a FHIR profile. The test can programmatically verify that the USCorePractitionerRoleProfile correctly maps the `identifier` element to the `FiveWs.identifier` pattern mapping.

### Complexity
**Level**: Simple

The requirement focuses on a single, well-defined structural mapping validation that can be verified through profile inspection and resource validation.

### Prerequisites
- Access to a FHIR server supporting US Core PractitionerRole Profile
- US Core PractitionerRole resources available in the test system
- FHIR validation capabilities to verify profile conformance
- Access to the US Core PractitionerRole StructureDefinition to verify mapping declarations

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources**:
- One or more PractitionerRole resources conforming to the US Core PractitionerRole Profile
- The resources should contain `identifier` elements with various identifier types (NPI, state license numbers, etc.)

**Expected Outputs**:
- Confirmation that the USCorePractitionerRoleProfile StructureDefinition contains the correct FiveWs pattern mapping
- Validation that PractitionerRole resources with identifiers conform to the profile requirements

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required:

1. **GET /PractitionerRole** - Retrieve PractitionerRole resources
2. **GET /PractitionerRole?practitioner=[id]** - Search PractitionerRole by practitioner
3. **GET /PractitionerRole?specialty=[code]** - Search PractitionerRole by specialty
4. **GET /metadata** - Retrieve server capability statement to confirm profile support

### Validation Criteria

**Profile Structure Validation**:
1. **Mapping Declaration Check**: Verify that the US Core PractitionerRole StructureDefinition contains a mapping entry where:
   - The `identity` is "FiveWs" 
   - The `map` for the `identifier` element is "FiveWs.identifier"

**Resource Instance Validation**:
2. **Profile Conformance**: Validate that PractitionerRole resources declare conformance to `http://hl7.org/fhir/us/core/StructureDefinition/us-core-practitionerrole` in their `meta.profile`

3. **Identifier Element Presence**: For PractitionerRole resources that contain `identifier` elements, verify:
   - The `identifier` element is properly structured according to the Identifier datatype
   - The identifier contains required elements (system and value)
   - The identifier conforms to US Core requirements for practitioner identifiers

**Test Assertions for Pass Criteria**:
- ✅ **PASS**: The US Core PractitionerRole StructureDefinition contains the FiveWs mapping for identifier
- ✅ **PASS**: Retrieved PractitionerRole resources successfully validate against the US Core PractitionerRole Profile
- ✅ **PASS**: PractitionerRole resources with identifiers demonstrate proper identifier structure consistent with FiveWs pattern expectations
- ❌ **FAIL**: Missing or incorrect FiveWs mapping in the profile definition
- ❌ **FAIL**: PractitionerRole resources fail validation against the US Core profile
- ❌ **FAIL**: Identifier elements do not conform to expected structure or requirements

**Additional Validation Steps**:
4. **Cross-Reference Validation**: If the test system supports `_include` operations, verify that included PractitionerRole resources (via `PractitionerRole:practitioner` includes) also maintain proper identifier mapping conformance

5. **Search Parameter Validation**: Confirm that identifier-based searches return properly conformant resources when supported search parameters are used

This test specification ensures that the FiveWs pattern mapping requirement is properly implemented and that PractitionerRole resources maintain interoperability standards for identifier handling across US Core implementations.

---

<a id='req-224'></a>

### REQ-224: The USCorePractitionerRoleProfile SHALL map the active status to FiveWs.status in FiveWs Pattern Mapping.

**Text**: 

**Context**: 

**Actor**: USCorePractitionerRoleProfile

**Conformance**: SHALL

# Test Specification for REQ-224

## 1. Requirement ID
REQ-224

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated programmatically by examining the structure definition mapping metadata and verifying the correct mapping implementation in PractitionerRole instances.

### Complexity
**Simple** - The requirement focuses on a specific mapping validation between the `active` element and the FiveWs pattern mapping for `status`.

### Prerequisites
- Access to US Core PractitionerRole Profile structure definition
- Access to PractitionerRole instances that implement the US Core profile
- Understanding of FHIR FiveWs pattern mapping concepts
- Test system capable of reading FHIR structure definitions and validating mappings

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources:**
  - US Core PractitionerRole Profile structure definition (StructureDefinition resource)
  - One or more PractitionerRole resource instances conforming to US Core PractitionerRole Profile
  - The instances should include the `active` element with various values (true/false)

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for PractitionerRole:
- **GET** `/PractitionerRole?practitioner={practitioner-id}` - Search by practitioner
- **GET** `/PractitionerRole?specialty={specialty-code}` - Search by specialty  
- **GET** `/PractitionerRole/{id}` - Read specific PractitionerRole instance
- **GET** `/metadata` - Retrieve CapabilityStatement to confirm profile support

### Validation Criteria

#### Test Case 1: Structure Definition Mapping Validation
**Objective:** Verify that the US Core PractitionerRole Profile correctly maps the `active` element to FiveWs.status

**Steps:**
1. Retrieve the US Core PractitionerRole Profile structure definition
2. Locate the `active` element definition within the profile
3. Examine the mapping metadata for the `active` element
4. Verify that there exists a mapping entry for the FiveWs pattern
5. Confirm that the mapping target is specifically `FiveWs.status`

**Pass Criteria:**
- The structure definition contains a mapping for the `active` element
- The mapping identity references the FiveWs pattern
- The mapping target is explicitly set to `FiveWs.status`
- The mapping is marked as required (SHALL level conformance)

#### Test Case 2: Instance-Level Mapping Validation
**Objective:** Verify that PractitionerRole instances correctly implement the active status mapping

**Steps:**
1. Retrieve PractitionerRole instances using supported search parameters
2. For each instance, verify it conforms to the US Core PractitionerRole Profile
3. Check that instances with `active` element present can be conceptually mapped to FiveWs.status
4. Validate that the `active` element values are appropriate boolean values
5. Ensure the mapping is consistent across different instances

**Pass Criteria:**
- All retrieved PractitionerRole instances conform to the US Core profile
- Instances containing the `active` element have valid boolean values
- The semantic meaning of `active` aligns with the FiveWs.status concept
- No instances violate the mapping requirement

#### Test Case 3: Profile Conformance Validation
**Objective:** Ensure the mapping requirement is enforced at the profile level

**Steps:**
1. Validate that the US Core PractitionerRole Profile declares conformance to the FiveWs pattern mapping
2. Check that the profile metadata indicates the SHALL conformance level for this mapping
3. Verify that validation tools recognize and enforce this mapping requirement

**Pass Criteria:**
- Profile metadata correctly declares the FiveWs pattern mapping requirement
- Conformance level is appropriately set to SHALL
- The mapping is enforceable through standard FHIR validation mechanisms

### Expected Test Results

**Passing Test Indicators:**
- Structure definition contains valid FiveWs.status mapping for active element
- All PractitionerRole instances demonstrate proper active status implementation
- Profile validation confirms SHALL-level conformance to the mapping requirement
- No validation errors related to FiveWs pattern mapping

**Failing Test Indicators:**
- Missing or incorrect mapping definition in the structure definition
- PractitionerRole instances that don't properly implement the active status
- Validation errors indicating non-conformance to FiveWs pattern mapping
- Inconsistent implementation of the mapping across instances

---

<a id='req-225'></a>

### REQ-225: The USCorePractitionerRoleProfile SHALL map the period to FiveWs.done[x] in FiveWs Pattern Mapping.

**Text**: 

**Context**: 

**Actor**: USCorePractitionerRoleProfile

**Conformance**: SHALL

# Test Specification for REQ-225

## 1. Requirement ID
REQ-225

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Automatically testable

This requirement is automatically testable as it involves verifying a specific mapping between the `period` element in USCorePractitionerRoleProfile and the `FiveWs.done[x]` element in the FiveWs Pattern Mapping. The mapping can be validated through structural analysis of FHIR resources.

### Complexity
**Level**: Simple

The requirement involves a straightforward mapping verification between two well-defined FHIR elements within a single profile.

### Prerequisites
- System must support US Core PractitionerRole Profile
- System must implement FiveWs Pattern Mapping
- Test system must have access to PractitionerRole resources with populated `period` elements
- FHIR validation capabilities must be available

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources**:
- PractitionerRole resources that conform to USCorePractitionerRoleProfile
- Resources should include populated `period` elements with start and/or end dates
- Resources should demonstrate the FiveWs pattern mapping implementation

**Expected Data Elements**:
- `PractitionerRole.period.start` (optional but recommended for comprehensive testing)
- `PractitionerRole.period.end` (optional but recommended for comprehensive testing)
- Corresponding FiveWs.done[x] mappings

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for PractitionerRole:

1. **Search Operations**:
   - `GET [base]/PractitionerRole?practitioner=[id]`
   - `GET [base]/PractitionerRole?specialty=[code]`

2. **Read Operations**:
   - `GET [base]/PractitionerRole/[id]`

3. **Include Operations**:
   - `GET [base]/PractitionerRole?_include=PractitionerRole:endpoint`
   - `GET [base]/PractitionerRole?_include=PractitionerRole:practitioner`

### Validation Criteria

**Primary Assertions**:

1. **Period Element Presence Validation**:
   - Verify that when `PractitionerRole.period` is present, it correctly maps to `FiveWs.done[x]`
   - Assert that the mapping maintains semantic equivalence between the source and target elements

2. **Mapping Accuracy Validation**:
   - When `PractitionerRole.period.start` is populated, verify it maps appropriately to the FiveWs pattern
   - When `PractitionerRole.period.end` is populated, verify it maps appropriately to the FiveWs pattern
   - When both start and end dates are present, verify the complete period mapping

3. **Data Type Consistency**:
   - Verify that the data types used in the mapping are consistent with FiveWs pattern requirements
   - Assert that date/dateTime values are properly formatted and valid

4. **Conformance Validation**:
   - Validate that PractitionerRole resources conform to USCorePractitionerRoleProfile
   - Verify that the FiveWs mapping implementation follows the specified pattern

**Test Scenarios**:

1. **Complete Period Mapping**:
   - Test PractitionerRole with both start and end dates in period
   - Verify complete mapping to FiveWs.done[x]

2. **Partial Period Mapping**:
   - Test PractitionerRole with only start date
   - Test PractitionerRole with only end date
   - Verify appropriate partial mapping handling

3. **Missing Period Handling**:
   - Test PractitionerRole without period element
   - Verify that absence doesn't break FiveWs mapping implementation

**Success Criteria**:
- All PractitionerRole resources that include a `period` element successfully map to `FiveWs.done[x]`
- Mapping maintains data integrity and semantic meaning
- No validation errors occur during the mapping process
- Resources continue to validate against USCorePractitionerRoleProfile after mapping implementation

**Failure Indicators**:
- Period data is lost or corrupted during mapping
- Invalid or improperly formatted FiveWs.done[x] values
- Validation errors against USCorePractitionerRoleProfile
- Inconsistent mapping behavior across different period configurations

---

<a id='req-226'></a>

### REQ-226: The USCorePractitionerRoleProfile SHALL map the location to FiveWs.where[x] in FiveWs Pattern Mapping.

**Text**: 

**Context**: 

**Actor**: USCorePractitionerRoleProfile

**Conformance**: SHALL

# Test Specification for REQ-226

## 1. Requirement ID
**REQ-226**: USCorePractitionerRoleProfile SHALL map the location to FiveWs.where[x] in FiveWs Pattern Mapping

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Not testable due to being covered by the validator

**Rationale**: This requirement specifies a FiveWs pattern mapping constraint that should be enforced through the FHIR profile definition itself. The mapping of `PractitionerRole.location` to `FiveWs.where[x]` is a structural constraint that would be validated by FHIR validators when validating instances against the US Core PractitionerRole Profile. This is not an interoperability behavior that can be tested through API interactions.

### Complexity
**Simple** - The requirement is straightforward but represents a structural validation concern rather than a testable interoperability requirement.

### Prerequisites
- US Core PractitionerRole Profile implementation
- FHIR R4 validation capability
- Access to PractitionerRole resources that include location references

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: PractitionerRole instances that conform to the US Core PractitionerRole Profile
- **Expected Outputs**: Profile validation results confirming proper mapping structure

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for PractitionerRole:
- **GET** `/PractitionerRole/{id}` - Retrieve specific PractitionerRole instances
- **GET** `/PractitionerRole?practitioner={id}` - Search by practitioner
- **GET** `/PractitionerRole?specialty={code}` - Search by specialty
- **GET** `/PractitionerRole?_include=PractitionerRole:endpoint` - Include related endpoints
- **GET** `/PractitionerRole?_include=PractitionerRole:practitioner` - Include related practitioners

### Validation Criteria

Since this requirement is handled by FHIR profile validation rather than API behavior testing, the validation approach would be:

1. **Profile Validation Check**:
   - Verify that PractitionerRole instances retrieved from the system validate successfully against the US Core PractitionerRole Profile
   - Confirm that the profile definition correctly maps `location` elements to the FiveWs pattern `where[x]` field

2. **Structural Validation**:
   - When PractitionerRole resources contain location references, verify they are properly structured according to the FiveWs mapping pattern
   - Validate that location data is accessible through the expected FiveWs pattern interface

### Test Execution Note
This requirement is primarily a profile conformance concern that should be validated through:
- FHIR profile validation tools
- StructureDefinition analysis to confirm mapping declarations
- Instance validation against the US Core PractitionerRole Profile

The requirement does not define testable interoperability behavior through API interactions, but rather ensures proper profile structure and mapping compliance which is enforced by FHIR validation mechanisms.

---

<a id='req-525'></a>

### REQ-525: US Core Client SHALL fetch PractitionerRole resources.

**Text**: 

**Context**: US Core Client read interaction for PractitionerRole by id

**Actor**: US Core Client

**Conformance**: SHALL

# Test Specification for REQ-525

## 1. Requirement ID
**REQ-525**: US Core Client SHALL fetch PractitionerRole resources

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified through automated testing by performing read operations and validating the response structure and conformance.

### Complexity
**Simple** - This is a straightforward FHIR read operation that requires basic RESTful API interaction and response validation.

### Prerequisites
- US Core Server with PractitionerRole resources available
- Valid PractitionerRole resource IDs for testing
- Client system capable of making FHIR REST API calls
- Authentication credentials (if required by the server)
- Network connectivity between client and server

## 3. Test Implementation Strategy

### Required Inputs
- **Server Base URL**: FHIR server endpoint implementing US Core
- **PractitionerRole Resource IDs**: One or more valid PractitionerRole resource identifiers existing on the server
- **Authentication Tokens**: Valid credentials if server requires authorization
- **Expected Format**: JSON (required) and optionally XML support

### Required FHIR Operations
Based on the Capability Statement, the following operation is required:
- **GET [base]/PractitionerRole/[id]** - Read interaction to fetch a specific PractitionerRole resource by its logical ID

### Validation Criteria

#### Test Case 1: Successful PractitionerRole Read
**Objective**: Verify client can successfully fetch PractitionerRole resources by ID

**Test Steps**:
1. Client performs GET request to `[base]/PractitionerRole/[valid-id]`
2. Validate HTTP response status code is 200 (OK)
3. Validate response contains valid JSON format
4. Validate response contains a PractitionerRole resource
5. Validate resource conforms to US Core PractitionerRole profile
6. Validate resource contains required elements as defined by US Core Must Support requirements

**Passing Criteria**:
- HTTP 200 status received
- Valid FHIR PractitionerRole resource returned in JSON format
- Resource validates against US Core PractitionerRole profile
- All Must Support elements are present if data exists
- Resource includes `meta.profile` referencing US Core PractitionerRole profile (SHOULD)

#### Test Case 2: Error Handling for Invalid Resource ID
**Objective**: Verify client properly handles error responses for non-existent resources

**Test Steps**:
1. Client performs GET request to `[base]/PractitionerRole/[invalid-id]`
2. Validate HTTP response status code is 404 (Not Found)
3. Validate error response format follows FHIR OperationOutcome structure

**Passing Criteria**:
- HTTP 404 status received for non-existent resource
- OperationOutcome returned explaining the error
- Client handles the error appropriately without crashing

#### Test Case 3: Authorization Handling (if applicable)
**Objective**: Verify client handles authorization requirements properly

**Test Steps**:
1. Client performs GET request without valid authorization
2. Validate server returns appropriate error status (401, 403, or 404 per Capability Statement)
3. Client performs GET request with valid authorization
4. Validate successful response

**Passing Criteria**:
- Unauthorized requests return HTTP 401, 403, or 404 as appropriate
- Authorized requests succeed with HTTP 200
- Client properly manages authentication flow

#### Test Case 4: Content Negotiation (JSON Support)
**Objective**: Verify client supports required JSON format

**Test Steps**:
1. Client performs GET request with `Accept: application/fhir+json` header
2. Validate response is returned in JSON format
3. Validate Content-Type header indicates JSON format

**Passing Criteria**:
- JSON response received and properly parsed
- Response Content-Type header indicates FHIR JSON format
- Client can process JSON response correctly

#### Test Case 5: Optional XML Support
**Objective**: Verify client supports optional XML format (if server supports it)

**Test Steps**:
1. Client performs GET request with `Accept: application/fhir+xml` header
2. If server supports XML, validate response format
3. If server doesn't support XML, validate appropriate error handling

**Passing Criteria**:
- If XML supported: Valid XML response received and processed
- If XML not supported: Appropriate error handling without client failure
- Client demonstrates format negotiation capability

### Additional Validation Points
- Verify client follows US Core General Requirements for interactions
- Confirm client properly handles FHIR Bundle responses if applicable
- Validate client respects server's security requirements
- Ensure client properly processes FHIR resource references within PractitionerRole
- Verify client maintains appropriate logging and audit trails for the interactions

### Test Data Considerations
- Tests should work with any valid PractitionerRole resources present on the server
- No specific fixture data is required - tests adapt to available server data
- Testers should ensure at least one valid PractitionerRole ID is available for positive testing
- Invalid ID can be any non-existent identifier (e.g., "invalid-test-id")

---

<a id='req-547'></a>

### REQ-547: PractitionerRole resource must have contact information or a reference to an Endpoint.

**Text**: 

**Context**: PractitionerRole profile constraint pd-1

**Actor**: PractitionerRole resource

**Conformance**: SHALL

# Test Specification for REQ-547

## 1. Requirement ID
**REQ-547**: PractitionerRole resource must have contact information or a reference to an Endpoint.

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated through automated testing by examining the structure and content of PractitionerRole resources to verify the presence of either contact information (telecom) or endpoint references.

### Complexity
**Simple** - The test involves checking for the presence of specific fields in a FHIR resource, which is a straightforward structural validation.

### Prerequisites
- Access to a FHIR server implementing the US Core PractitionerRole Profile
- Valid authentication credentials for server access
- PractitionerRole resources available in the test system
- Server must support PractitionerRole resource queries as specified in the Capability Statement

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: PractitionerRole resources conforming to the US Core PractitionerRole Profile
- **Server Endpoint**: Base URL of the FHIR server under test
- **Authentication**: Valid access tokens or credentials

### Expected Outputs
- **Pass**: Each PractitionerRole resource contains either:
  - Contact information in the `telecom` field, OR
  - Reference(s) to Endpoint resource(s) in the `endpoint` field
- **Fail**: Any PractitionerRole resource lacks both contact information and endpoint references

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for PractitionerRole:

1. **Search PractitionerRole resources**:
   - `GET [base]/PractitionerRole?practitioner=[practitioner-id]`
   - `GET [base]/PractitionerRole?specialty=[specialty-code]`
   - `GET [base]/PractitionerRole` (general search)

2. **Read specific PractitionerRole resources**:
   - `GET [base]/PractitionerRole/[id]`

3. **Include related Endpoint resources** (as supported by Capability Statement):
   - `GET [base]/PractitionerRole?_include=PractitionerRole:endpoint`

### Validation Criteria

#### Primary Validation (pd-1 Constraint)
For each PractitionerRole resource retrieved:

1. **Contact Information Check**:
   - Verify if `PractitionerRole.telecom` field is present and populated
   - If present, validate that at least one telecom entry contains valid contact information

2. **Endpoint Reference Check**:
   - Verify if `PractitionerRole.endpoint` field is present and populated
   - If present, validate that references point to valid Endpoint resources

3. **Constraint Satisfaction**:
   - **PASS**: If either condition is met:
     - `PractitionerRole.telecom` exists and contains valid contact information, OR
     - `PractitionerRole.endpoint` exists and contains valid endpoint references
   - **FAIL**: If both conditions are false:
     - No `telecom` field or empty `telecom` field, AND
     - No `endpoint` field or empty `endpoint` field

#### Secondary Validations
1. **Profile Conformance**:
   - Verify that each PractitionerRole resource declares conformance to US Core PractitionerRole Profile in `meta.profile`

2. **Reference Integrity** (when endpoint references exist):
   - Validate that referenced Endpoint resources are accessible
   - Confirm endpoint references use valid FHIR reference format

#### Test Execution Steps
1. Query the server for PractitionerRole resources using supported search parameters
2. For each returned PractitionerRole resource:
   - Extract and examine the `telecom` field
   - Extract and examine the `endpoint` field
   - Apply the pd-1 constraint validation logic
   - Record pass/fail status for each resource
3. If using `_include=PractitionerRole:endpoint`, validate the included Endpoint resources
4. Generate test report with:
   - Total number of PractitionerRole resources tested
   - Number of resources passing/failing the pd-1 constraint
   - Details of any constraint violations
   - Summary of conformance status

#### Assertion Results
- **Test PASSES** when: All retrieved PractitionerRole resources satisfy the pd-1 constraint (have either contact information or endpoint references)
- **Test FAILS** when: Any PractitionerRole resource violates the pd-1 constraint (lacks both contact information and endpoint references)
- **Test is INCONCLUSIVE** when: No PractitionerRole resources are available for testing or server errors prevent validation

---

<a id='req-548'></a>

### REQ-548: PractitionerRole resource must have a practitioner, an organization, a healthcare service, or a location.

**Text**: 

**Context**: PractitionerRole profile constraint us-core-13

**Actor**: PractitionerRole resource

**Conformance**: SHALL

# Test Specification for REQ-548

## 1. Requirement ID
**REQ-548**: PractitionerRole resource must have a practitioner, an organization, a healthcare service, or a location.

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This constraint can be verified programmatically by checking the presence of at least one of the four required references in PractitionerRole resource instances.

### Complexity
**Simple** - The test involves straightforward validation of resource element presence without complex business logic or cross-resource validation.

### Prerequisites
- Server implementing US Core PractitionerRole Profile
- Access to PractitionerRole resources via FHIR API
- Server supports the search parameters defined in the capability statement for PractitionerRole (`practitioner`, `specialty`)
- Authentication/authorization configured for accessing PractitionerRole resources

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: PractitionerRole resources conforming to US Core PractitionerRole Profile
- **Search Capabilities**: Server must support PractitionerRole search operations as defined in capability statement
- **Data Requirements**: Test should work with any existing PractitionerRole data in the system (bring your own data approach)

### Expected Outputs
- PractitionerRole resource instances that contain at least one of:
  - `practitioner` reference
  - `organization` reference  
  - `healthcareService` reference
  - `location` reference

### Required FHIR Operations
Based on the capability statement, the following operations are supported and will be used:

1. **Search PractitionerRole by practitioner**:
   ```
   GET [base]/PractitionerRole?practitioner=[reference]
   ```

2. **Search PractitionerRole by specialty**:
   ```
   GET [base]/PractitionerRole?specialty=[code]
   ```

3. **Read specific PractitionerRole**:
   ```
   GET [base]/PractitionerRole/[id]
   ```

4. **Include operations** (as supported per capability statement):
   ```
   GET [base]/PractitionerRole?_include=PractitionerRole:endpoint
   GET [base]/PractitionerRole?_include=PractitionerRole:practitioner
   ```

### Validation Criteria

#### Test Case 1: Search-based Validation
**Objective**: Verify that all PractitionerRole resources returned by searches satisfy the constraint

**Steps**:
1. Execute search for PractitionerRole resources using supported search parameters
2. For each returned PractitionerRole resource, verify constraint compliance
3. Check that at least one of the following elements is present and contains a valid reference:
   - `practitioner`
   - `organization`
   - `healthcareService`  
   - `location`

**Assertions**:
- Each PractitionerRole resource MUST have at least one of the four required reference elements populated
- Referenced elements MUST contain valid FHIR references (not empty or null)
- Resource MUST conform to US Core PractitionerRole Profile as indicated by `meta.profile`

#### Test Case 2: Direct Read Validation  
**Objective**: Verify constraint compliance for directly accessed PractitionerRole resources

**Steps**:
1. Identify PractitionerRole resource IDs from search results or system data
2. Perform direct read operations on individual PractitionerRole resources
3. Validate each resource against the constraint

**Assertions**:
- Same validation criteria as Test Case 1
- Successful HTTP 200 response for valid resource reads
- Resource structure validates against US Core PractitionerRole Profile

#### Test Case 3: Include Operation Validation
**Objective**: Verify constraint compliance when PractitionerRole resources are returned via include operations

**Steps**:
1. Execute searches with `_include=PractitionerRole:practitioner` or `_include=PractitionerRole:endpoint`
2. Extract PractitionerRole resources from the Bundle response
3. Validate each included PractitionerRole resource against the constraint

**Assertions**:
- All included PractitionerRole resources satisfy the constraint
- Include operations return complete and valid resource representations

#### Pass/Fail Criteria

**Pass**: 
- All retrieved PractitionerRole resources contain at least one of: practitioner, organization, healthcareService, or location reference
- All references are valid FHIR references (proper format and not empty)
- Resources conform to US Core PractitionerRole Profile

**Fail**:
- Any PractitionerRole resource lacks all four reference types (practitioner, organization, healthcareService, location)
- Any required reference element is present but empty/null
- Resource does not conform to US Core PractitionerRole Profile constraints

#### Error Handling
- Test should handle HTTP error responses appropriately (400, 401, 403, 404 as defined in capability statement)
- Invalid or malformed resources should be reported as test failures
- Network or server errors should be distinguished from conformance failures

---

<a id='req-549'></a>

### REQ-549: Support searching practitioner role by specialty using the specialty search parameter.

**Text**: 

**Context**: PractitionerRole mandatory server search capability

**Actor**: Server

**Conformance**: SHALL

# Test Specification for REQ-549

## 1. Requirement ID
REQ-549

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through direct API calls to test the server's search functionality using the specialty parameter on PractitionerRole resources.

### Complexity
**Simple** - The requirement involves a straightforward search parameter test against a single resource type with clear success/failure criteria.

### Prerequisites
- Server must support PractitionerRole resources as specified in the US Core Server CapabilityStatement
- Server must have PractitionerRole resources available with specialty data populated
- Test client must have appropriate authentication/authorization to perform search operations
- Server must implement the US Core PractitionerRole Profile

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- PractitionerRole resources with populated `specialty` elements using coded values (typically from specialty code systems like SNOMED CT or NUCC Provider Taxonomy)

**Search Parameters:**
- `specialty` parameter with various coded values representing different medical specialties

### Required FHIR Operations
Based on the Capability Statement, the following operation is required:
- **GET [base]/PractitionerRole?specialty=[code]** - Search PractitionerRole resources by specialty parameter

### Validation Criteria

#### Test Case 1: Basic Specialty Search
**Objective:** Verify server supports searching PractitionerRole by specialty parameter

**Steps:**
1. Execute search: `GET [base]/PractitionerRole?specialty=[valid-specialty-code]`
2. Verify HTTP 200 response
3. Verify response is a valid FHIR Bundle
4. Verify all returned PractitionerRole resources contain the specified specialty code in their `specialty` element

**Assertions:**
- Response status code is 200
- Response content-type is `application/fhir+json` or `application/fhir+xml`
- Response body is a valid Bundle resource
- Bundle.entry contains only PractitionerRole resources
- Each returned PractitionerRole has at least one specialty matching the search parameter
- All returned resources conform to US Core PractitionerRole Profile

#### Test Case 2: Multiple Specialty Codes Search
**Objective:** Verify server handles multiple specialty code values in search

**Steps:**
1. Execute search with multiple values: `GET [base]/PractitionerRole?specialty=[code1],[code2]`
2. Verify response contains PractitionerRole resources matching any of the specified specialty codes

**Assertions:**
- Response status code is 200
- Each returned PractitionerRole contains at least one specialty matching one of the search parameter values

#### Test Case 3: No Results Scenario
**Objective:** Verify server handles searches with no matching results appropriately

**Steps:**
1. Execute search with specialty code that should not exist: `GET [base]/PractitionerRole?specialty=[non-existent-code]`
2. Verify server returns empty Bundle rather than error

**Assertions:**
- Response status code is 200
- Response is a valid Bundle with Bundle.total = 0 or Bundle.entry is empty

#### Test Case 4: Invalid Specialty Code Format
**Objective:** Verify server handles malformed specialty parameter appropriately

**Steps:**
1. Execute search with invalid parameter format: `GET [base]/PractitionerRole?specialty=[invalid-format]`
2. Verify server response (may return 400 Bad Request or empty results depending on server implementation)

**Assertions:**
- Response status code is either 200 (with empty results) or 4xx (with OperationOutcome explaining the error)
- If 4xx response, includes valid OperationOutcome resource

#### Test Case 5: Combination with Other Parameters
**Objective:** Verify specialty parameter works in combination with other supported search parameters

**Steps:**
1. Execute combined search: `GET [base]/PractitionerRole?specialty=[code]&practitioner=[practitioner-id]`
2. Verify results satisfy both search criteria

**Assertions:**
- Response status code is 200
- Each returned PractitionerRole matches both the specialty and practitioner criteria
- Results conform to both search parameter constraints

### Additional Validation Points
- Verify the server supports both system|code and code-only formats for the specialty parameter
- Confirm that the search is case-insensitive where appropriate according to the code system
- Validate that the server properly handles URL encoding of specialty codes
- Ensure the server returns appropriate HTTP headers including proper FHIR version declaration

### Success Criteria
The test passes when:
1. All search requests return valid HTTP responses
2. Returned resources match the specialty search criteria
3. Response format conforms to FHIR Bundle structure
4. All returned PractitionerRole resources conform to US Core PractitionerRole Profile
5. Server demonstrates consistent behavior across different specialty code values

---

<a id='req-550'></a>

### REQ-550: Support searching practitioner role by practitioner name and identifier using chained parameters.

**Text**: 

**Context**: PractitionerRole mandatory server search capability using chained parameters

**Actor**: Server

**Conformance**: SHALL

# Test Specification for REQ-550

## 1. Requirement ID
REQ-550

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified through automated API calls using chained search parameters to query PractitionerRole resources by practitioner name and identifier.

### Complexity
**Moderate** - Requires understanding of FHIR chained parameter syntax and validation of search result accuracy across multiple resource relationships.

### Prerequisites
- Server must have PractitionerRole resources with associated Practitioner resources
- Practitioner resources must have populated name and identifier elements
- Server must support the US Core PractitionerRole Profile and US Core Practitioner Profile
- Test environment must have at least one PractitionerRole linked to a Practitioner with known name and identifier values

## 3. Test Implementation Strategy

### Required Inputs
- **Test Data Requirements:**
  - At least one PractitionerRole resource conforming to US Core PractitionerRole Profile
  - Associated Practitioner resource(s) conforming to US Core Practitioner Profile with:
    - Populated `name` element (family and/or given names)
    - Populated `identifier` element with system and value
  - The PractitionerRole must reference the Practitioner via `practitioner` element

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and required:

1. **GET /PractitionerRole?practitioner.name=[name_value]**
   - Chain search using practitioner name parameter

2. **GET /PractitionerRole?practitioner.identifier=[identifier_value]**
   - Chain search using practitioner identifier parameter

3. **GET /PractitionerRole?practitioner.name=[name_value]&practitioner.identifier=[identifier_value]**
   - Combined chain search using both parameters

### Validation Criteria

#### Test Case 1: Chain Search by Practitioner Name
**Objective:** Verify server supports searching PractitionerRole by chained practitioner name parameter

**Test Steps:**
1. Identify a Practitioner resource with a known name value from existing test data
2. Execute search: `GET /PractitionerRole?practitioner.name=[known_name_value]`
3. Validate response contains PractitionerRole resources where the referenced Practitioner has the specified name

**Pass Criteria:**
- HTTP 200 response status
- Response bundle contains PractitionerRole resources
- Each returned PractitionerRole references a Practitioner whose name matches the search parameter
- Response conforms to FHIR Bundle structure
- All returned PractitionerRole resources conform to US Core PractitionerRole Profile

#### Test Case 2: Chain Search by Practitioner Identifier
**Objective:** Verify server supports searching PractitionerRole by chained practitioner identifier parameter

**Test Steps:**
1. Identify a Practitioner resource with a known identifier value from existing test data
2. Execute search: `GET /PractitionerRole?practitioner.identifier=[known_identifier_value]`
3. Validate response contains PractitionerRole resources where the referenced Practitioner has the specified identifier

**Pass Criteria:**
- HTTP 200 response status
- Response bundle contains PractitionerRole resources
- Each returned PractitionerRole references a Practitioner whose identifier matches the search parameter
- Response conforms to FHIR Bundle structure
- All returned PractitionerRole resources conform to US Core PractitionerRole Profile

#### Test Case 3: Combined Chain Search
**Objective:** Verify server supports searching PractitionerRole using multiple chained practitioner parameters

**Test Steps:**
1. Identify a Practitioner resource with both known name and identifier values from existing test data
2. Execute search: `GET /PractitionerRole?practitioner.name=[known_name]&practitioner.identifier=[known_identifier]`
3. Validate response contains PractitionerRole resources where the referenced Practitioner matches both criteria

**Pass Criteria:**
- HTTP 200 response status
- Response bundle contains PractitionerRole resources
- Each returned PractitionerRole references a Practitioner whose name AND identifier match the search parameters
- Response conforms to FHIR Bundle structure
- All returned PractitionerRole resources conform to US Core PractitionerRole Profile

#### Test Case 4: Chain Search with No Results
**Objective:** Verify server handles chained searches that return no results appropriately

**Test Steps:**
1. Execute search with a practitioner name/identifier that does not exist: `GET /PractitionerRole?practitioner.name=NonexistentPractitioner`
2. Validate appropriate empty result response

**Pass Criteria:**
- HTTP 200 response status
- Response bundle with total count of 0
- Empty entry array in bundle
- Response conforms to FHIR Bundle structure

#### Error Handling Validation
**Objective:** Verify server handles malformed chained search parameters appropriately

**Test Steps:**
1. Execute search with invalid chain syntax: `GET /PractitionerRole?practitioner.invalid=[value]`
2. Validate appropriate error response

**Pass Criteria:**
- HTTP 400 response status for invalid parameters
- OperationOutcome resource explaining the error
- Error message indicates unsupported search parameter

#### Additional Validation Requirements
- All responses must include appropriate HTTP headers
- All PractitionerRole resources in responses must be valid according to US Core PractitionerRole Profile
- Referenced Practitioner resources (when included) must be valid according to US Core Practitioner Profile
- Chained parameter searches must respect any access control or security constraints
- Pagination must be handled correctly if result sets are large

---



<a id='procedure'></a>

## Procedure

<a id='req-002'></a>

### REQ-002: The Procedure resource SHALL have a status of "Completed".

**Text**: 

**Context**: 

**Actor**: Procedure Resource

**Conformance**: SHALL

# Test Specification for REQ-002

## 1. Requirement ID
**REQ-002**

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified programmatically by examining the `status` field of Procedure resources to ensure it contains the value "completed".

### Complexity
**Simple** - This is a straightforward field value validation that requires checking a single element against a specific required value.

### Prerequisites
- System must support the US Core Procedure Profile as indicated in the Capability Statement
- System must have Procedure resources available for testing
- Test client must have appropriate permissions to read Procedure resources
- System must support JSON format (required per Capability Statement)

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: One or more Procedure resources that conform to the US Core Procedure Profile
- **Test Data**: Any existing Procedure resources in the system under test (following "bring your own data" approach)
- **Authentication**: Valid credentials/tokens if required by the system

### Expected Outputs
- **Primary Output**: Confirmation that all tested Procedure resources have `status` field set to "completed"
- **Secondary Output**: HTTP response codes indicating successful resource retrieval (200 OK)

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for Procedure resources:

1. **READ Operation**: `GET [base]/Procedure/[id]` 
   - To retrieve specific Procedure resources for validation
   
2. **SEARCH Operations** (any of the supported search parameters):
   - `GET [base]/Procedure?patient=[patient-id]` - Search by patient
   - `GET [base]/Procedure?status=completed` - Search by status
   - `GET [base]/Procedure?patient=[patient-id]&status=completed` - Combined search
   - `GET [base]/Procedure?code=[code]` - Search by procedure code
   - `GET [base]/Procedure?date=[date]` - Search by date

### Validation Criteria

#### Primary Validation Checks
1. **Status Field Presence**: Verify that each Procedure resource contains a `status` element
2. **Status Value Validation**: Confirm that the `status` field value equals "completed" (case-sensitive)
3. **Resource Profile Conformance**: Ensure resources declare conformance to US Core Procedure Profile in `meta.profile`

#### Test Assertions for Passing Results
- **Assertion 1**: `Procedure.status` field exists and is not null/empty
- **Assertion 2**: `Procedure.status` value equals exactly "completed"
- **Assertion 3**: HTTP response status is 200 OK for successful resource retrieval
- **Assertion 4**: Retrieved resources conform to US Core Procedure Profile structure

#### Test Cases to Execute
1. **Single Resource Test**: Retrieve individual Procedure resources and validate status
2. **Search-based Test**: Use supported search parameters to retrieve Procedure resources and validate all returned resources
3. **Patient-specific Test**: Search for Procedures by patient and validate status of all returned resources
4. **Status-specific Test**: Search explicitly for Procedures with status="completed" and verify results

#### Failure Conditions
- Any Procedure resource with `status` field missing
- Any Procedure resource with `status` value other than "completed"
- HTTP error responses (4xx, 5xx) when attempting to retrieve resources
- Resources that do not conform to the US Core Procedure Profile structure

#### Additional Considerations
- Test should handle empty result sets gracefully (no Procedure resources found is not a failure)
- Test should validate against any Procedure resources present in the system, regardless of their clinical content
- Test should verify that error handling follows the Capability Statement requirements (appropriate HTTP status codes)

---

<a id='req-306'></a>

### REQ-306: Inclusion of SNOMED CT procedure codes

**Text**: 

**Context**: 

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-306

## 1. Requirement ID
REQ-306

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Automatically testable

The requirement for inclusion of SNOMED CT procedure codes can be validated by examining FHIR resources that contain procedure information and verifying that they use appropriate SNOMED CT codes from the procedure hierarchy.

### Complexity
**Level**: Moderate

This requirement involves:
- Identifying resources that contain procedure codes
- Validating that codes come from SNOMED CT
- Ensuring codes are from the appropriate procedure domain within SNOMED CT
- Handling multiple coding systems that may be present alongside SNOMED CT

### Prerequisites
- System must support US Core Server capabilities as defined in the CapabilityStatement
- System must have procedure-related data available for testing
- Access to SNOMED CT terminology validation capabilities
- Understanding of SNOMED CT procedure code hierarchy (descendants of 71388002 "Procedure")

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources**: Any resources containing procedure codes, primarily:
- `Procedure` resources
- `DiagnosticReport` resources (when they reference procedures)
- `Encounter` resources (with procedure-related codes)
- `ServiceRequest` resources
- Other resources with procedure-related CodeableConcept fields

**Expected Outputs**:
- Identification of all procedure-related CodeableConcept elements
- Validation that SNOMED CT procedure codes are present where required
- Confirmation that SNOMED CT codes belong to the procedure hierarchy

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations will be used:

1. **Resource Retrieval Operations**:
   - `GET [base]/Procedure` - Retrieve procedure resources
   - `GET [base]/DiagnosticReport` - Retrieve diagnostic reports that may contain procedure codes
   - `GET [base]/Encounter` - Retrieve encounters that may contain procedure codes
   - `GET [base]/ServiceRequest` - Retrieve service requests

2. **Search Operations** (as supported by US Core):
   - `GET [base]/Procedure?patient=[id]` - Search procedures by patient
   - `GET [base]/DiagnosticReport?patient=[id]` - Search diagnostic reports by patient

### Validation Criteria

#### Primary Validation Checks:

1. **SNOMED CT Code Presence Validation**:
   - For each procedure-related CodeableConcept in the retrieved resources
   - Verify that at least one Coding element has `system = "http://snomed.info/sct"`
   - **Assertion**: `CodeableConcept.coding.where(system = 'http://snomed.info/sct').exists()`

2. **SNOMED CT Procedure Hierarchy Validation**:
   - For each SNOMED CT code found in procedure contexts
   - Validate that the code is a descendant of SNOMED CT concept 71388002 "Procedure"
   - **Assertion**: SNOMED CT code validation confirms code is within procedure hierarchy

3. **Code System URI Validation**:
   - Verify correct SNOMED CT system URI format
   - **Assertion**: `system = "http://snomed.info/sct"` (exact match)

4. **Resource Context Validation**:
   - Ensure procedure codes appear in appropriate resource elements:
     - `Procedure.code`
     - `DiagnosticReport.code` (when procedure-related)
     - `Encounter.type` (when procedure-related)
     - `ServiceRequest.code`

#### Secondary Validation Checks:

1. **Code Completeness Check**:
   - Verify that SNOMED CT codes include both code and display values where available
   - **Assertion**: `coding.code.exists() and coding.display.exists()`

2. **Multiple Coding Systems Support**:
   - When multiple coding systems are present, ensure SNOMED CT is included alongside others
   - **Assertion**: Resources may contain additional coding systems (CPT, ICD-10-PCS) but must include SNOMED CT

#### Test Pass Criteria:

**Test PASSES when**:
- All procedure-related CodeableConcept elements contain at least one valid SNOMED CT procedure code
- All SNOMED CT codes use the correct system URI
- All SNOMED CT procedure codes are verified as descendants of 71388002 "Procedure"
- Resources are successfully retrieved using supported US Core operations

**Test FAILS when**:
- Procedure-related data exists but lacks SNOMED CT coding
- SNOMED CT codes are present but use incorrect system URI format
- SNOMED CT codes are not from the procedure hierarchy
- Required operations are not supported per the CapabilityStatement

#### Implementation Notes:

1. **Data Agnostic Approach**: The test should work with any procedure data present in the system, focusing on the coding standards rather than specific clinical content

2. **Terminology Validation**: Implementation should include SNOMED CT terminology server access or local validation capabilities to verify procedure code hierarchy membership

3. **Resource Coverage**: Test should examine all US Core supported resources that may contain procedure codes, not just Procedure resources

4. **Error Handling**: Test should gracefully handle cases where no procedure data is available and report this as a limitation rather than a failure

---

<a id='req-308'></a>

### REQ-308: Inclusion of all ICD-10-PCS codes in the value set

**Text**: 

**Context**: 

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-308

## 1. Requirement ID
REQ-308: Inclusion of all ICD-10-PCS codes in the value set

## 2. Requirement Analysis

### Testability Assessment
**Not Testable** - This requirement is too vague for automated testing as it lacks critical implementation details:
- No specification of which value set should contain ICD-10-PCS codes
- No identification of which FHIR resources or elements should reference this value set
- No clear validation criteria for what constitutes "all" ICD-10-PCS codes
- The requirement text is empty, providing no additional context

### Complexity
**Complex** - If testable, this would require:
- Comprehensive knowledge of the complete ICD-10-PCS code system
- Validation against authoritative ICD-10-PCS sources
- Cross-referencing with FHIR terminology services

### Prerequisites
Cannot be determined due to insufficient requirement specification. Would potentially require:
- Access to authoritative ICD-10-PCS code listings
- Identification of the target FHIR value set(s)
- System supporting FHIR terminology operations

## 3. Test Implementation Strategy

### Required Inputs
**Cannot be specified** due to incomplete requirement definition. The following information would be needed to make this testable:

1. **Target Value Set Identification**: Which specific FHIR ValueSet resource should contain ICD-10-PCS codes
2. **Scope Definition**: Which subset of ICD-10-PCS codes (if not truly "all")
3. **Version Specification**: Which version(s) of ICD-10-PCS should be supported
4. **Resource Context**: Which FHIR resources/elements should reference this value set

### Required FHIR Operations
Cannot be determined without knowing the target value set. Potentially would include:
- `GET /ValueSet/{id}` (if testing a specific ValueSet resource)
- `GET /ValueSet/{id}/$expand` (to expand and validate contents)
- `GET /CodeSystem/icd-10-pcs` (if testing CodeSystem completeness)

**Note**: The US Core Server Capability Statement does not explicitly require support for terminology operations beyond basic CRUD operations.

### Validation Criteria
Cannot be established due to incomplete requirement specification. Would potentially include:
- Verification that the target value set includes all required ICD-10-PCS codes
- Validation against authoritative ICD-10-PCS code listings
- Confirmation that code system references are correct

## Recommendation

This requirement needs significant clarification before it can be tested effectively. The requirement should be updated to specify:

1. **Target Value Set**: The specific FHIR ValueSet resource that should contain ICD-10-PCS codes
2. **Scope**: Whether "all" truly means the complete ICD-10-PCS code system or a specific subset
3. **Context**: Which FHIR resources or use cases require this value set
4. **Version**: Which version(s) of ICD-10-PCS should be supported
5. **Implementation**: How systems should expose or validate this requirement

Until these details are provided, this requirement cannot be meaningfully tested for conformance.

---

<a id='req-526'></a>

### REQ-526: US Core Client SHALL fetch Procedure resources.

**Text**: 

**Context**: US Core Client read interaction for Procedure by id

**Actor**: US Core Client

**Conformance**: SHALL

# Test Specification for REQ-526

## 1. Requirement ID
REQ-526

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be fully automated through FHIR RESTful API testing. The requirement specifies a concrete interaction (read Procedure by id) that can be verified through HTTP requests and response validation.

### Complexity
**Simple** - This is a straightforward FHIR read operation that requires basic HTTP GET request and response validation against US Core Procedure profile requirements.

### Prerequisites
- US Core Client system under test must be operational
- US Core Server endpoint must be available and accessible
- Valid Procedure resource IDs must be available in the target system
- Appropriate authentication credentials/tokens if required
- Client must support JSON format (required by US Core)

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- One or more valid Procedure resource IDs that exist on the target US Core Server
- Authentication credentials (if applicable)
- Base FHIR server URL

**Expected Outputs:**
- HTTP 200 response with valid US Core Procedure resource
- Proper HTTP error responses for invalid scenarios (400, 401, 403, 404)

### Required FHIR Operations
Based on the Capability Statement, the following operations are required:
- **READ**: `GET [base]/Procedure/[id]` - Core operation being tested
- The operation must support JSON response format (SHALL requirement)
- Optional: XML response format (SHOULD requirement)

### Validation Criteria

#### Primary Success Criteria (SHALL requirements):
1. **HTTP Response Validation:**
   - Client successfully sends GET request to `[base]/Procedure/[id]`
   - Server returns HTTP 200 status code for valid requests
   - Response Content-Type is `application/fhir+json` (or `application/json`)

2. **Resource Validation:**
   - Response body contains a valid FHIR Procedure resource
   - Resource conforms to US Core Procedure profile
   - Resource has proper `resourceType: "Procedure"`
   - Resource includes required US Core Procedure elements per Must Support requirements

3. **Error Handling Validation:**
   - Client properly handles HTTP 400 (invalid parameter) responses
   - Client properly handles HTTP 401/4xx (unauthorized) responses  
   - Client properly handles HTTP 403 (insufficient scopes) responses
   - Client properly handles HTTP 404 (unknown resource) responses

#### Secondary Success Criteria (SHOULD requirements):
1. **Format Support:**
   - Client can request and handle XML format responses (Accept: application/fhir+xml)

2. **Profile Declaration:**
   - Returned Procedure resource includes `meta.profile` referencing US Core Procedure profile

#### Test Cases:
1. **Valid Read Test:**
   - Execute GET request with valid Procedure ID
   - Verify successful response and resource conformance

2. **Invalid ID Test:**
   - Execute GET request with non-existent Procedure ID
   - Verify appropriate 404 error response

3. **Authentication Test (if applicable):**
   - Execute GET request without proper authentication
   - Verify appropriate 401/403 error response

4. **Format Negotiation Test:**
   - Execute GET request with Accept header for JSON
   - Verify JSON response format
   - (Optional) Execute with Accept header for XML and verify XML response

#### Pass/Fail Criteria:
- **PASS**: Client successfully fetches Procedure resources with valid IDs, receives proper HTTP 200 responses with conformant US Core Procedure resources, and handles error conditions appropriately
- **FAIL**: Client fails to complete read operations, receives malformed responses, or does not handle required error conditions properly

---



<a id='provenance'></a>

## Provenance

<a id='req-527'></a>

### REQ-527: US Core Client SHALL fetch Provenance resources.

**Text**: 

**Context**: US Core Client read interaction for Provenance by id

**Actor**: US Core Client

**Conformance**: SHALL

# REQ-527 Test Specification

## Requirement ID
REQ-527

## Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be fully automated as it involves testing a specific FHIR read interaction that produces measurable, verifiable outcomes.

### Complexity
**Simple** - This is a straightforward read operation test that requires basic FHIR RESTful API interaction and response validation.

### Prerequisites
- US Core Client system under test must be configured and operational
- Access to a US Core Server with Provenance resources available
- Client system must have appropriate authentication/authorization configured
- Network connectivity between client and server
- At least one valid Provenance resource ID available for testing

## Test Implementation Strategy

### Required Inputs
- **Test Client**: US Core Client system under test
- **Target Server**: US Core compliant FHIR server
- **Provenance Resource ID**: Valid identifier for an existing Provenance resource on the target server
- **Authentication Credentials**: Valid credentials for client authentication (if required)

### Expected Outputs
- **Primary Output**: Successfully retrieved Provenance resource in JSON format
- **HTTP Response**: Status code 200 (OK) for successful retrieval
- **Content Validation**: Returned resource conforms to US Core Provenance profile requirements

### Required FHIR Operations
- **GET [base]/Provenance/[id]** - Read interaction to fetch Provenance resource by identifier

*Note: This operation is supported as part of the general RESTful capabilities outlined in the US Core Server CapabilityStatement, which requires support for standard FHIR read interactions.*

### Validation Criteria

#### Test Case 1: Successful Provenance Resource Retrieval
**Test Steps:**
1. Client initiates GET request to `[base]/Provenance/[valid-id]`
2. Monitor HTTP response and payload

**Pass Criteria:**
- HTTP status code is 200 (OK)
- Response Content-Type header is `application/fhir+json` or `application/json`
- Response body contains a valid FHIR Provenance resource
- Resource.resourceType equals "Provenance"
- Resource.id matches the requested identifier
- Resource validates against US Core Provenance profile (if specified in meta.profile)

#### Test Case 2: Error Handling for Non-Existent Resource
**Test Steps:**
1. Client initiates GET request to `[base]/Provenance/[non-existent-id]`
2. Monitor HTTP response

**Pass Criteria:**
- HTTP status code is 404 (Not Found)
- Response includes appropriate FHIR OperationOutcome resource explaining the error

#### Test Case 3: Authorization Error Handling
**Test Steps:**
1. Client initiates GET request with invalid/missing credentials to `[base]/Provenance/[valid-id]`
2. Monitor HTTP response

**Pass Criteria:**
- HTTP status code is 401 (Unauthorized), 403 (Forbidden), or 404 (Not Found) per US Core Server requirements
- Client properly handles the authentication error response

#### Test Case 4: JSON Format Support Verification
**Test Steps:**
1. Client initiates GET request to `[base]/Provenance/[valid-id]` with Accept header set to `application/fhir+json`
2. Monitor HTTP response and payload

**Pass Criteria:**
- Server returns response in JSON format as required by US Core Server capabilities
- Response is valid JSON and valid FHIR resource structure
- Client successfully parses and processes the JSON response

#### Overall Conformance Validation
**The client demonstrates conformance by:**
- Successfully executing read operations against Provenance resources
- Properly handling both success and error scenarios
- Processing JSON formatted responses as mandated by US Core
- Implementing appropriate error handling for authorization failures
- Demonstrating ability to work with any available Provenance resource data (bring your own data approach)

---



<a id='questionnaire'></a>

## Questionnaire

<a id='req-227'></a>

### REQ-227: Questionnaire item /88122-7 must allow specific answer options.

**Text**: 

**Context**: 

**Actor**: Questionnaire Implementer

**Conformance**: SHALL

# Test Specification: REQ-227

## 1. Requirement ID
REQ-227

## 2. Requirement Analysis

### Testability Assessment
**Not testable due to being too vague**

The requirement lacks critical details necessary for automated testing:
- No specification of what the "specific answer options" should be
- LOINC code 88122-7 context is not provided 
- No definition of acceptable answer formats or values
- Missing reference to the governing structure or profile that defines the allowed options

### Complexity
**Simple** (if proper specifications were provided)

### Prerequisites
- Access to the complete Implementation Guide documentation that defines the allowed answer options for LOINC code 88122-7
- A FHIR server implementing the Questionnaire resource
- Sample Questionnaire resources containing item 88122-7 with various answer options

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Questionnaire resources containing items with linkId or code matching 88122-7
- The complete Implementation Guide specification defining allowed answer options for 88122-7

**Expected Outputs:**
- Validation results indicating whether the answer options conform to the specified requirements
- Clear indication of which answer options are valid/invalid

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations would be needed:
- `GET /Questionnaire` - to retrieve questionnaire resources for validation
- `GET /Questionnaire/{id}` - to retrieve specific questionnaire instances

*Note: The provided Capability Statement focuses on US Core Server capabilities but does not explicitly mention Questionnaire resource support. Verification of Questionnaire resource support in the actual implementation would be required.*

### Validation Criteria

**To make this requirement testable, the following information must be provided:**

1. **Answer Option Specification**: The Implementation Guide must clearly define:
   - Allowed answer value types (Coding, string, integer, etc.)
   - Specific permitted values or value sets
   - Required answer option properties (value, display, system, etc.)

2. **Test Assertions** (once specifications are available):
   - Verify that Questionnaire.item where code = '88122-7' contains only allowed answerOption values
   - Validate that each answerOption conforms to the specified format and constraints
   - Confirm that all required answer options are present (if any are mandated)
   - Ensure no prohibited answer options are included

**Recommended Actions:**
1. Locate the complete specification for LOINC code 88122-7 requirements in the Implementation Guide
2. Identify the specific profile or structure definition that governs this requirement
3. Update the requirement with explicit references to the governing specifications
4. Define clear pass/fail criteria based on the complete requirements

**Current Status**: This requirement cannot be implemented as an automated test without additional specification details.

---

<a id='req-228'></a>

### REQ-228: Questionnaire item /88123-5 must allow specific answer options.

**Text**: 

**Context**: 

**Actor**: Questionnaire Implementer

**Conformance**: SHALL

# REQ-228 Test Specification

## 1. Requirement ID
**REQ-228**: Questionnaire item /88123-5 must allow specific answer options

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Automatically testable

This requirement is automatically testable as it involves verifying that a specific Questionnaire item (identified by linkId /88123-5) contains the required answer options in its structure. The test can programmatically validate the presence and configuration of answer options within the Questionnaire resource.

### Complexity
**Complexity Level**: Simple

The test involves straightforward validation of a single Questionnaire item's answer options structure, which can be verified through direct resource inspection.

### Prerequisites
- Access to a FHIR server that supports Questionnaire resources
- At least one Questionnaire resource containing an item with linkId "/88123-5"
- Server must implement the SDC Base Questionnaire Profile as indicated in the Capability Statement

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources Required:**
- Questionnaire resource(s) containing an item with linkId "/88123-5"

**Expected Outputs:**
- Validation confirmation that the specified Questionnaire item contains properly configured answer options
- Identification of any missing or incorrectly configured answer options

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported:

1. **GET /Questionnaire/{id}** - Retrieve specific Questionnaire resource for validation
2. **GET /Questionnaire** - Search for Questionnaire resources (if search parameters are needed)

Note: The Capability Statement indicates that Questionnaire resources are supported but no specific search parameters are defined, so direct resource retrieval by ID is the primary supported operation.

### Validation Criteria

The test SHALL verify the following assertions for the Questionnaire item with linkId "/88123-5":

#### Primary Assertions:
1. **Item Existence**: Verify that an item with linkId "/88123-5" exists in the Questionnaire
2. **Answer Options Present**: Confirm that the item contains an `answerOption` or `answerValueSet` element
3. **Answer Options Structure**: Validate that answer options are properly structured according to FHIR specification

#### Specific Validation Checks:
1. **Item Identification**:
   - `item.linkId` equals "/88123-5"

2. **Answer Options Configuration**:
   - If using `answerOption`: Verify array contains at least one option with valid value structure
   - If using `answerValueSet`: Verify reference points to a valid ValueSet
   - Ensure answer options are appropriate for the item type

3. **Conformance to SDC Base Profile**:
   - Validate that the Questionnaire conforms to the SDC Base Questionnaire Profile
   - Verify any additional constraints imposed by the profile are met

#### Test Pass Criteria:
- The Questionnaire item "/88123-5" exists
- The item contains properly configured answer options (either `answerOption` elements or `answerValueSet` reference)
- All answer options follow FHIR structural requirements
- The overall Questionnaire resource validates against the SDC Base Questionnaire Profile

#### Test Fail Criteria:
- No item with linkId "/88123-5" found in any available Questionnaire
- The item exists but lacks answer options configuration
- Answer options are malformed or do not meet FHIR requirements
- The Questionnaire fails validation against the SDC Base Questionnaire Profile

### Test Execution Approach:
1. Retrieve all available Questionnaire resources from the test system
2. For each Questionnaire, search for items with linkId "/88123-5"
3. When found, validate the answer options configuration
4. Report validation results indicating conformance status

This approach accommodates a "bring your own data" methodology by testing whatever Questionnaire resources are available in the system under test, while specifically focusing on the conformance requirement for item "/88123-5".

---

<a id='req-229'></a>

### REQ-229: Questionnaire item /88124-3 must allow specific answer options.

**Text**: 

**Context**: 

**Actor**: Questionnaire Implementer

**Conformance**: SHALL

# Test Specification for REQ-229

## 1. Requirement ID
REQ-229

## 2. Requirement Analysis

### Testability Assessment
**Not Testable** - The requirement is too vague as currently specified. The requirement states that "Questionnaire item /88124-3 must allow specific answer options" but does not define:
- What the specific required answer options are
- The context or profile that defines these constraints
- The validation criteria for determining compliance

This requirement would need additional specification details to become testable.

### Complexity
**N/A** - Cannot assess complexity due to insufficient requirement specification.

### Prerequisites
**N/A** - Cannot determine prerequisites without complete requirement specification.

## 3. Test Implementation Strategy

### Current Limitations
This requirement cannot be implemented as a test specification in its current form due to the following missing information:

1. **Missing Answer Options**: The requirement does not specify what the "specific answer options" are that must be allowed for item /88124-3
2. **Missing Context**: No reference to which Questionnaire profile, ValueSet, or constraint defines these required options
3. **Missing Source Reference**: While the source is listed as "Structure," no specific StructureDefinition or profile is referenced

### Required Information for Testability
To make this requirement testable, the following information would be needed:

1. **Specific Answer Options**: A complete list or reference to the allowed answer values for item /88124-3
2. **Profile Reference**: The specific FHIR profile or StructureDefinition that constrains this item
3. **ValueSet Reference**: If applicable, the ValueSet that defines the allowed answers
4. **Validation Context**: Whether this applies to Questionnaire definition, QuestionnaireResponse validation, or both

### Potential Test Implementation (if requirements were complete)
If the requirement were properly specified, the test implementation would likely include:

**Required FHIR Operations:**
- `GET /Questionnaire` - To retrieve questionnaire definitions (supported per Capability Statement)
- `POST /QuestionnaireResponse` - To test response validation (supported per Capability Statement)

**Required Inputs:**
- Questionnaire resource containing item /88124-3
- Test QuestionnaireResponse instances with various answer values

**Validation Criteria:**
- Verify that the Questionnaire item /88124-3 defines the required answer options
- Validate that QuestionnaireResponse instances with allowed answers are accepted
- Confirm that QuestionnaireResponse instances with disallowed answers are rejected

## Recommendation
This requirement should be revised to include:
1. The complete list of required answer options for item /88124-3
2. Reference to the constraining profile or ValueSet
3. Clear acceptance criteria for compliance testing

Without these details, the requirement cannot be reliably tested for conformance.

---

<a id='req-259'></a>

### REQ-259: The questionnaire SHALL include a question about the number of times a person has had X or more drinks in a day in the past year.

**Text**: 

**Context**: 

**Actor**: Questionnaire Implementer

**Conformance**: SHALL

# Test Specification for REQ-259

## 1. Requirement ID
**REQ-259**

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified programmatically by examining the Questionnaire resource structure and validating the presence of a specific question with appropriate characteristics.

### Complexity
**Simple** - The requirement focuses on verifying the presence of a single, well-defined question within a Questionnaire resource.

### Prerequisites
- Access to a FHIR server implementing US Core Server CapabilityStatement
- Questionnaire resource(s) available for testing that should contain alcohol consumption questions
- The system under test must support Questionnaire resource retrieval operations

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Questionnaire resource(s) that are expected to contain alcohol consumption screening questions
- **Context Information**: The source reference "/68517-2" suggests this relates to a specific LOINC code (68517-2) which corresponds to alcohol use screening questionnaires
- **Test Data**: Any existing Questionnaire instances in the system that should comply with this requirement

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations should be supported:
- `GET [base]/Questionnaire/{id}` - Retrieve specific Questionnaire by ID
- `GET [base]/Questionnaire?_id={id}` - Search for Questionnaire by ID
- Additional search parameters as supported by the server's CapabilityStatement

### Validation Criteria

#### Primary Validation Checks:
1. **Question Existence**: Verify that the Questionnaire contains at least one question that addresses the frequency of heavy drinking episodes in the past year

2. **Question Content Validation**: The identified question should:
   - Reference or relate to drinking behavior frequency
   - Include time frame specification (past year/12 months)
   - Address the concept of "X or more drinks in a day" (where X represents a threshold number)
   - Capture frequency or count of occurrences

3. **Question Structure Validation**: The question should be properly structured as a Questionnaire.item with:
   - Appropriate `linkId` for identification
   - Proper `type` (e.g., integer, choice, string)
   - Clear `text` that conveys the intended question
   - Optional but recommended: `code` element referencing relevant terminology (e.g., LOINC)

#### Specific Assertions for Test Passing:
- **PASS**: Questionnaire contains a question that clearly asks about the frequency/number of times a person consumed X or more drinks in a day within the past year
- **PASS**: The question text or associated metadata indicates it captures heavy drinking episodes over a 12-month period
- **PASS**: The question allows for appropriate response types (numeric count, frequency categories, etc.)

#### Implementation Notes:
- The test should be flexible enough to accommodate different phrasings of the same concept (e.g., "binge drinking episodes," "heavy drinking days," "X or more drinks in one day")
- The specific number "X" may vary by implementation (commonly 4-5 drinks) but should be clearly specified in the question
- The test should work with various Questionnaire structures and formats while maintaining focus on the core requirement

#### Expected Test Outcomes:
- **PASS**: When a qualifying question about past-year heavy drinking frequency is present in the Questionnaire
- **FAIL**: When no such question exists in the Questionnaire
- **INCONCLUSIVE**: When questions exist but are ambiguous about timeframe, drink threshold, or frequency measurement

This test specification supports a "bring your own data" approach by focusing on structural and content validation rather than specific fixture requirements, allowing implementers to test against their own Questionnaire resources while ensuring conformance to the requirement.

---

<a id='req-260'></a>

### REQ-260: The questionnaire SHALL display a help text specifying the value of X for men and women.

**Text**: 

**Context**: 

**Actor**: Questionnaire Implementer

**Conformance**: SHALL

# Test Specification for REQ-260

## 1. Requirement ID
REQ-260

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Attestation

**Rationale**: This requirement focuses on user interface display behavior (showing help text) which cannot be automatically validated through FHIR API calls. The requirement tests the human-readable presentation layer rather than the underlying FHIR data structure or API conformance. Testing this requirement requires manual verification of the questionnaire's user interface to confirm that appropriate help text is displayed.

### Complexity
**Simple**

The requirement has a single, clear expectation: verify that help text specifying values for men and women is displayed in the questionnaire interface.

### Prerequisites
- Access to a questionnaire implementation that renders FHIR Questionnaire resources
- A FHIR Questionnaire resource containing the item referenced by the source path (/68517-2-help)
- The questionnaire must be in a displayable/rendered state
- Access to view the user interface where the questionnaire is presented

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources**:
- A FHIR Questionnaire resource that contains:
  - An item with linkId "68517-2-help" or similar identifier
  - Help text elements that specify different values for men and women
  - Proper text or extension elements containing the gender-specific help information

**Expected Outputs**:
- Visual confirmation that help text is displayed in the questionnaire interface
- The help text must clearly specify different values of "X" for men and women
- Documentation or screenshots showing the help text presentation

### Required FHIR Operations
**Note**: Based on the US Core Server Capability Statement provided, standard FHIR read operations would be supported, but this requirement primarily tests presentation layer compliance rather than API operations.

**Potential Supporting Operations** (if automated retrieval is needed):
- `GET [base]/Questionnaire/[id]` - to retrieve the questionnaire resource
- Standard FHIR read operations as supported by US Core Server capabilities

### Validation Criteria

**Manual Verification Steps**:

1. **Questionnaire Access Verification**
   - Confirm the questionnaire can be accessed and rendered in the implementation
   - Verify the questionnaire contains the referenced item (68517-2-help)

2. **Help Text Display Verification**
   - **Pass Criteria**: Help text is visibly displayed in the questionnaire interface
   - **Pass Criteria**: Help text explicitly mentions or specifies values for both "men" and "women"
   - **Pass Criteria**: The help text clearly indicates different values of "X" for each gender
   - **Pass Criteria**: Help text is accessible and readable to users

3. **Content Accuracy Verification**
   - **Pass Criteria**: The displayed help text matches the content stored in the FHIR Questionnaire resource
   - **Pass Criteria**: Gender-specific values are clearly distinguished and accurate

**Attestation Requirements**:
- Implementer must provide evidence (screenshots, documentation, or demonstration) showing:
  - The questionnaire interface with help text visible
  - Clear identification of the gender-specific values for "X"
  - Confirmation that the help text meets the requirement's intent

**Failure Criteria**:
- Help text is not displayed when the questionnaire is rendered
- Help text does not specify values for both men and women
- Help text is unclear about gender-specific differences
- Values for "X" are not clearly indicated in the help text

---

<a id='req-261'></a>

### REQ-261: The questionnaire SHALL include a question about the number of standard drinks containing alcohol consumed on a typical day.

**Text**: 

**Context**: 

**Actor**: Questionnaire Implementer

**Conformance**: SHALL

# Test Specification for REQ-261

## 1. Requirement ID
**REQ-261**

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be programmatically validated by examining the structure and content of a Questionnaire resource to verify the presence of a question about daily alcohol consumption measured in standard drinks.

### Complexity
**Simple** - The requirement involves checking for the existence of a specific question type within a Questionnaire resource structure.

### Prerequisites
- Access to a FHIR server implementing US Core Server capabilities
- At least one Questionnaire resource available for testing that should contain alcohol consumption questions
- The Questionnaire should reference or be related to LOINC code 68519-8 (based on the source context)

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- `Questionnaire` resource(s) that are expected to contain alcohol consumption questions
- The Questionnaire should be accessible via the FHIR server

**Expected Outputs:**
- Validation results indicating whether the Questionnaire contains the required alcohol consumption question
- Identification of the specific question item that addresses standard drinks per day

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations should be supported:

1. **GET /Questionnaire/[id]** - Retrieve specific Questionnaire resource
2. **GET /Questionnaire?_id=[id]** - Search for Questionnaire by ID
3. Alternative search operations if supported by the server implementation

*Note: The specific Questionnaire operations depend on the server's implementation of the US Core CapabilityStatement. If Questionnaire is not explicitly supported, the test may need to work with available resources that contain the questionnaire data.*

### Validation Criteria

The test SHALL verify the following assertions to indicate a passing result:

1. **Questionnaire Structure Validation:**
   - The Questionnaire resource contains at least one `item` element
   - The Questionnaire structure is valid according to FHIR R4 specifications

2. **Alcohol Consumption Question Presence:**
   - At least one question item exists that addresses alcohol consumption on a typical day
   - The question specifically asks about "standard drinks" or equivalent terminology
   - The question is structured to capture numeric/quantitative responses

3. **Question Content Validation:**
   - The question text, linkId, or code should clearly indicate it relates to daily alcohol consumption
   - The question type should be appropriate for capturing numeric data (e.g., `type: integer`, `type: decimal`, or `type: quantity`)
   - If LOINC codes are used, verify association with alcohol consumption concepts

4. **Conformance Indicators:**
   - **PASS**: Questionnaire contains a clearly identifiable question about the number of standard drinks consumed on a typical day
   - **FAIL**: Questionnaire lacks any question addressing daily alcohol consumption in standard drinks
   - **INCONCLUSIVE**: Question exists but terminology or structure is ambiguous regarding standard drinks measurement

### Test Execution Steps

1. Retrieve the target Questionnaire resource(s) from the FHIR server
2. Parse the Questionnaire structure and examine all `item` elements
3. Identify questions related to alcohol consumption using text analysis and/or coding systems
4. Verify that at least one identified question specifically addresses:
   - Daily/typical day consumption frequency
   - Measurement in "standard drinks" units
   - Appropriate data type for numeric response
5. Document findings and determine pass/fail status based on validation criteria

### Additional Considerations

- The test should accommodate various phrasings of the alcohol consumption question while maintaining the core requirement of measuring "standard drinks" per "typical day"
- If multiple alcohol-related questions exist, at least one must meet the specific requirement
- The test should be flexible enough to work with different Questionnaire implementations while maintaining the core conformance validation

---

<a id='req-262'></a>

### REQ-262: The questionnaire SHALL include a question about the frequency of consuming 6 or more drinks on one occasion.

**Text**: 

**Context**: 

**Actor**: Questionnaire Implementer

**Conformance**: SHALL

# Test Specification for REQ-262

## 1. Requirement ID
**REQ-262**

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified through automated inspection of Questionnaire resources to confirm the presence of a specific question about alcohol consumption frequency (6 or more drinks on one occasion).

### Complexity
**Simple** - The test involves straightforward validation of Questionnaire content for the presence of a specific question type.

### Prerequisites
- Access to Questionnaire resources that implement the specified structure (/68520-6)
- Understanding of LOINC code 68520-6 which relates to alcohol consumption screening
- System must support Questionnaire resource retrieval as specified in the US Core Server CapabilityStatement

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Questionnaire resources that claim conformance to the implementation guide
- **Test Data**: Any Questionnaire resources available in the test system (bring your own data approach)
- **Reference Information**: LOINC code 68520-6 definition and related alcohol consumption screening questions

### Expected Outputs
- Validation results confirming presence of required question about frequency of consuming 6 or more drinks on one occasion
- Clear pass/fail status for each tested Questionnaire resource

### Required FHIR Operations
Based on the US Core Server CapabilityStatement capabilities:
1. **GET /Questionnaire** - Retrieve Questionnaire resources for testing
2. **GET /Questionnaire/[id]** - Retrieve specific Questionnaire instances
3. **Search operations** on Questionnaire resources if supported by the server

### Validation Criteria

#### Primary Assertions:
1. **Question Presence Validation**:
   - Questionnaire SHALL contain at least one item (question) that addresses the frequency of consuming 6 or more drinks on one occasion
   - The question content should be semantically equivalent to asking about binge drinking frequency

2. **Content Validation**:
   - Verify that the question text, coding, or linkId clearly relates to alcohol consumption frequency
   - Check for appropriate question type (choice, integer, etc.) that allows capturing frequency information
   - Validate that response options (if provided) are appropriate for frequency measurement

3. **Structure Validation**:
   - Confirm the Questionnaire resource is valid FHIR and conforms to base Questionnaire profile requirements
   - Verify proper use of Questionnaire.item elements to represent the required question

#### Test Cases:
1. **Positive Test Cases**:
   - Questionnaire contains explicit question about "6 or more drinks on one occasion"
   - Questionnaire contains semantically equivalent questions (e.g., "binge drinking frequency")
   - Question includes appropriate response value sets or input types

2. **Negative Test Cases**:
   - Questionnaire missing any alcohol consumption frequency questions
   - Questionnaire contains only general alcohol consumption questions without frequency specificity
   - Question present but lacks proper structure or response mechanisms

#### Pass Criteria:
- Test PASSES if the Questionnaire contains at least one item that clearly addresses the frequency of consuming 6 or more alcoholic drinks on a single occasion
- The question must be implementable (have proper FHIR structure) and answerable

#### Fail Criteria:
- Test FAILS if no question about frequency of consuming 6+ drinks on one occasion is present
- Test FAILS if the question is present but structurally invalid or not answerable
- Test FAILS if the question content is too vague or doesn't specifically address the 6+ drinks threshold

#### Implementation Notes:
- The test should accommodate various phrasings and question formats as long as the semantic meaning aligns with the requirement
- Consider cultural and clinical variations in how binge drinking questions may be presented
- The test should work with any conformant Questionnaire data provided by the implementer
- Validation should focus on interoperability compliance rather than clinical appropriateness

---

<a id='req-264'></a>

### REQ-264: The questionnaire SHALL display a help text explaining the scoring system for AUDIT-C.

**Text**: 

**Context**: 

**Actor**: Questionnaire Implementer

**Conformance**: SHALL

# Test Specification for REQ-264

## 1. Requirement ID
**REQ-264**

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated inspection of the FHIR Questionnaire resource structure to confirm the presence of help text for the AUDIT-C scoring system.

### Complexity
**Simple** - The test involves checking for the existence and appropriate placement of help text within a specific Questionnaire resource structure.

### Prerequisites
- Access to FHIR server implementing US Core Server capabilities
- FHIR Questionnaire resource containing AUDIT-C questions (specifically item with linkId "75626-2" based on the source reference)
- Server must support Questionnaire resource retrieval operations as defined in the US Core Server CapabilityStatement

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Questionnaire resource containing AUDIT-C screening questions
- **Expected Outputs**: Confirmation that help text explaining the AUDIT-C scoring system is present and properly associated with the questionnaire

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations should be supported:
- `GET /Questionnaire/{id}` - Retrieve specific Questionnaire resource
- `GET /Questionnaire` - Search for Questionnaire resources (if searching by criteria is needed)

*Note: The specific FHIR operations will depend on the actual Questionnaire resource support defined in the implementing server's capability statement, as Questionnaire is not explicitly detailed in the provided US Core Server CapabilityStatement excerpt.*

### Validation Criteria

The test SHALL verify the following assertions to indicate a passing result:

1. **Help Text Presence**: The Questionnaire resource contains help text that explains the AUDIT-C scoring system
   - Verify that help text is present in one of the following locations:
     - `Questionnaire.item.text` (for item-level help)
     - `Questionnaire.item._text.extension` (for extended text with additional formatting)
     - `Questionnaire.description` (for questionnaire-level help)
     - `Questionnaire.item.extension` where extension URL indicates help or guidance text

2. **Content Validation**: The help text content addresses AUDIT-C scoring
   - Text should contain references to AUDIT-C scoring methodology
   - Text should provide guidance on how the scoring system works
   - Text should be human-readable and clinically meaningful

3. **Proper Association**: The help text is properly associated with the AUDIT-C questionnaire structure
   - If item-level help text, it should be associated with the appropriate AUDIT-C question items
   - If questionnaire-level help text, it should be clearly positioned for user visibility

4. **FHIR Conformance**: The help text implementation follows FHIR R4 structural requirements
   - Proper use of FHIR data types (string, markdown, etc.)
   - Valid extension usage if extensions are employed
   - Compliance with any applicable FHIR profiles or implementation guides

**Test Execution Approach**:
- Retrieve the Questionnaire resource(s) containing AUDIT-C content
- Parse the resource structure to locate help text elements
- Validate that help text content appropriately describes the AUDIT-C scoring system
- Confirm that the help text is structured according to FHIR specifications
- Verify that the help text would be displayable by consuming applications

**Pass Criteria**: All validation assertions are met, demonstrating that the questionnaire properly displays help text explaining the AUDIT-C scoring system in accordance with the SHALL requirement.

---

<a id='req-509'></a>

### REQ-509: The extension URL is fixed to a specific value.

**Text**: 

**Context**: US Core Questionnaire URI Extension – fixed URL constraint

**Actor**: Implementer

**Conformance**: Fixed

# Test Specification for REQ-509

## 1. Requirement ID
REQ-509

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated programmatically by checking that the extension URL matches the expected fixed value defined in the US Core Questionnaire URI Extension profile.

### Complexity
**Simple** - This is a straightforward validation of a fixed URL value in an extension element.

### Prerequisites
- Access to FHIR resources containing the US Core Questionnaire URI Extension
- Knowledge of the specific fixed URL value defined in the US Core profile specification
- FHIR validation capabilities to check extension structure and URL values

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Any FHIR resource instances that contain the US Core Questionnaire URI Extension
- **Profile Definition**: The US Core Questionnaire URI Extension profile specification containing the fixed URL value
- **Test Data**: Implementer's own FHIR resource instances that claim to use this extension

### Expected Outputs
- **Pass**: Extension URL matches the fixed value specified in the profile
- **Fail**: Extension URL does not match the fixed value or is missing when the extension is present

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported:
- **GET** operations to retrieve resources containing the extension
- **JSON format support** (SHALL be supported per Capability Statement)
- **XML format support** (SHOULD be supported per Capability Statement)

### Validation Criteria

#### Primary Validation Checks:
1. **Extension Presence Validation**
   - When a resource claims to contain the US Core Questionnaire URI Extension, verify the extension is present
   - Check that the extension structure follows FHIR Extension requirements

2. **Fixed URL Validation**
   - Verify that `Extension.url` matches the exact fixed URL value specified in the US Core Questionnaire URI Extension profile
   - Ensure the URL is not null, empty, or contains any variations from the fixed value

3. **Profile Conformance Validation**
   - Validate that resources containing this extension properly declare conformance to the relevant US Core profile in `meta.profile` (as recommended in the Capability Statement)

#### Test Assertions:
- **ASSERT**: `Extension.url` equals the fixed URL value defined in the US Core profile
- **ASSERT**: Extension URL is present when the extension is used
- **ASSERT**: Extension URL contains no additional query parameters, fragments, or modifications
- **ASSERT**: Extension URL uses the correct protocol scheme and formatting

#### Implementation Notes:
- Test should accommodate "bring your own data" approach by testing against any resource instances provided by the implementer that contain this extension
- Validation should work with both JSON and XML formats as specified in the Capability Statement
- Test should fail gracefully if the fixed URL value cannot be determined from the profile specification
- Consider case sensitivity in URL comparison
- Verify URL encoding is handled correctly

#### Success Criteria:
The test passes when all instances of the US Core Questionnaire URI Extension in the provided test data have an Extension.url that exactly matches the fixed value specified in the profile definition, with no deviations or variations.

---

<a id='req-528'></a>

### REQ-528: US Core Client SHALL fetch Questionnaire resources.

**Text**: 

**Context**: US Core Client read interaction for Questionnaire by id

**Actor**: US Core Client

**Conformance**: SHALL

# Test Specification for REQ-528

## 1. Requirement ID
**REQ-528**: US Core Client SHALL fetch Questionnaire resources

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement specifies a concrete FHIR read interaction that can be programmatically validated through API calls and response verification.

### Complexity
**Simple** - This is a straightforward FHIR read operation requiring basic HTTP GET request validation and response conformance checking.

### Prerequisites
- US Core Client system under test with FHIR R4 capability
- US Core Server with available Questionnaire resources
- Valid authentication credentials/tokens (if required by server security)
- Network connectivity between client and server
- At least one Questionnaire resource available on the server for testing

## 3. Test Implementation Strategy

### Required Inputs
**Test Data Requirements:**
- Valid Questionnaire resource ID(s) available on the target FHIR server
- Server base URL/endpoint
- Authentication credentials (if required)

**Expected Outputs:**
- HTTP 200 response for successful reads
- Valid FHIR Questionnaire resource in JSON format
- Appropriate HTTP error responses (400, 401, 403, 404) for invalid requests

### Required FHIR Operations
- **READ operation**: `GET [base]/Questionnaire/[id]`
  - This operation is supported as part of standard FHIR RESTful capabilities
  - The Capability Statement indicates support for JSON format (required) and potentially XML format (should)

### Validation Criteria

#### Primary Success Criteria:
1. **Successful Read Operation**
   - Client successfully executes `GET [base]/Questionnaire/[id]` request
   - Server returns HTTP 200 status code
   - Response body contains valid FHIR Questionnaire resource
   - Response Content-Type header indicates `application/fhir+json`

2. **Resource Validation**
   - Returned resource has `resourceType: "Questionnaire"`
   - Resource contains required FHIR Questionnaire elements per base specification
   - Resource structure passes FHIR validation
   - If present, `meta.profile` should reference appropriate US Core or base FHIR Questionnaire profile

#### Error Handling Criteria:
1. **Invalid Resource ID**
   - Client request with non-existent Questionnaire ID returns HTTP 404
   - Error response includes appropriate OperationOutcome resource

2. **Authentication/Authorization** (if applicable)
   - Unauthorized requests return HTTP 401, 403, or 404 per server security policy
   - Client properly handles authentication challenges

3. **Invalid Parameters**
   - Malformed requests return HTTP 400 with descriptive error information

#### Format Support Criteria:
1. **JSON Support** (Required)
   - Client successfully processes JSON-formatted Questionnaire responses
   - Client sends appropriate `Accept: application/fhir+json` header

2. **XML Support** (Optional - Should)
   - If server supports XML, client should handle `Accept: application/fhir+xml` requests appropriately

#### Test Case Framework:

**Test Case 1: Valid Questionnaire Read**
- Execute read operation with known valid Questionnaire ID
- Verify HTTP 200 response and valid resource structure

**Test Case 2: Non-existent Resource Handling**
- Execute read operation with invalid/non-existent Questionnaire ID
- Verify appropriate error response (HTTP 404)

**Test Case 3: Authentication Handling** (if security enabled)
- Execute read operation without proper credentials
- Verify appropriate security error response

**Test Case 4: Format Negotiation**
- Execute read operation with JSON Accept header
- Verify JSON response format
- Optionally test XML format if supported by server

**Assertions for Passing Tests:**
- HTTP status codes match expected values (200 for success, 4xx for errors)
- Response payloads contain structurally valid FHIR resources
- Client successfully parses and processes returned Questionnaire resources
- Error responses include meaningful diagnostic information
- All requests include appropriate FHIR headers and follow RESTful conventions

---



<a id='questionnaireresponse'></a>

## QuestionnaireResponse

<a id='req-199'></a>

### REQ-199: The QuestionnaireResponse resource SHALL include a linkID.

**Text**: 

**Context**: 

**Actor**: QuestionnaireResponse resource

**Conformance**: SHALL

# Test Specification for REQ-199

## 1. Requirement ID
REQ-199

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated through automated inspection of QuestionnaireResponse resources to verify the presence of the `linkId` element in item elements.

### Complexity
**Simple** - This is a straightforward structural validation that checks for the presence of a required field.

### Prerequisites
- System must support QuestionnaireResponse resources as indicated in the Capability Statement
- Test system must have access to existing QuestionnaireResponse resources or the ability to retrieve them
- QuestionnaireResponse resources should contain item elements (since linkId is a property of items within QuestionnaireResponse)

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: One or more QuestionnaireResponse resources that contain item elements
- **Test Data Source**: "Bring your own data" approach using existing QuestionnaireResponse instances in the test system
- **Resource Access**: Ability to retrieve QuestionnaireResponse resources via supported search parameters

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for QuestionnaireResponse:

1. **Search Operations**:
   - `GET [base]/QuestionnaireResponse?patient={patient_id}` - Search by patient
   - `GET [base]/QuestionnaireResponse?_id={id}` - Search by ID
   - `GET [base]/QuestionnaireResponse?authored={date}` - Search by authored date
   - `GET [base]/QuestionnaireResponse?questionnaire={questionnaire_ref}` - Search by questionnaire
   - `GET [base]/QuestionnaireResponse?status={status}` - Search by status

2. **Read Operations**:
   - `GET [base]/QuestionnaireResponse/{id}` - Direct resource retrieval

### Validation Criteria

For each QuestionnaireResponse resource tested, the following assertions must pass:

1. **Primary Validation**:
   - Every `item` element within the QuestionnaireResponse SHALL contain a `linkId` element
   - The `linkId` element SHALL have a non-empty string value

2. **Structural Validation**:
   - Verify that the QuestionnaireResponse resource is structurally valid
   - Confirm that the resource contains at least one `item` element (if no items exist, the linkId requirement is not applicable)

3. **Nested Item Validation**:
   - For any nested `item` elements within QuestionnaireResponse items, each SHALL also contain a `linkId` element
   - Apply the linkId validation recursively to all item levels

4. **Test Pass Criteria**:
   - **PASS**: All item elements (at all nesting levels) within the QuestionnaireResponse contain a non-empty `linkId` element
   - **FAIL**: Any item element lacks a `linkId` element or contains an empty `linkId` value
   - **NOT APPLICABLE**: QuestionnaireResponse contains no item elements

5. **Test Coverage Requirements**:
   - Test should be executed against multiple QuestionnaireResponse instances to ensure comprehensive coverage
   - Include QuestionnaireResponse resources with different structures (simple items, nested items, various item types) if available
   - Test should validate both simple and complex QuestionnaireResponse structures

The test implementation should iterate through all available QuestionnaireResponse resources in the system and perform the validation on each, reporting results for individual resources as well as providing an overall compliance assessment.

---

<a id='req-200'></a>

### REQ-200: The QuestionnaireResponse resource SHALL include text for each item.

**Text**: 

**Context**: 

**Actor**: QuestionnaireResponse resource

**Conformance**: SHALL

# Test Specification for REQ-200

## Requirement ID
REQ-200

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated validation by checking that each item in a QuestionnaireResponse resource contains text content.

### Complexity
**Simple** - The requirement involves a straightforward structural validation of QuestionnaireResponse resources to ensure text is present for each item.

### Prerequisites
- FHIR server implementing US Core QuestionnaireResponse Profile
- Access to QuestionnaireResponse resources with item elements
- Server must support QuestionnaireResponse read operations as specified in the Capability Statement

## Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- One or more QuestionnaireResponse resources that contain `item` elements
- Resources should represent real-world scenarios with various item types and structures

**Expected Outputs:**
- Validation results confirming each item contains text
- Clear pass/fail status for each QuestionnaireResponse tested

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for QuestionnaireResponse:

1. **READ operation**: `GET [base]/QuestionnaireResponse/[id]`
2. **SEARCH operations**: 
   - `GET [base]/QuestionnaireResponse?patient=[patient-id]`
   - `GET [base]/QuestionnaireResponse?_id=[id]`
   - `GET [base]/QuestionnaireResponse?authored=[date]`
   - `GET [base]/QuestionnaireResponse?questionnaire=[questionnaire-id]`
   - `GET [base]/QuestionnaireResponse?status=[status]`

### Validation Criteria

**Primary Assertions:**
1. **Item Existence Check**: Verify that the QuestionnaireResponse resource contains at least one `item` element
2. **Text Presence Validation**: For each `item` in the QuestionnaireResponse:
   - Assert that `item.text` element is present
   - Assert that `item.text` contains non-empty string content
   - Assert that `item.text` is not just whitespace

**Nested Item Validation:**
3. **Recursive Text Check**: For items that contain nested `item` elements (sub-items):
   - Apply the same text validation rules recursively to all nested items
   - Ensure every level of item hierarchy includes required text

**Test Cases to Execute:**

1. **Single-Level Items Test**
   - Retrieve QuestionnaireResponse with simple, non-nested items
   - Validate each item has text content

2. **Multi-Level Items Test**
   - Retrieve QuestionnaireResponse with nested item structures
   - Validate text presence at all hierarchical levels

3. **Mixed Content Test**
   - Test QuestionnaireResponse with various item types (choice, text, boolean, etc.)
   - Ensure text requirement applies regardless of answer type

**Success Criteria:**
- All items at every level contain non-empty text elements
- No items are found without text content
- Text content contains meaningful, non-whitespace characters

**Failure Scenarios:**
- Any item missing the `text` element
- Any item with empty or whitespace-only text content
- Nested items missing text at any hierarchical level

---

<a id='req-263'></a>

### REQ-263: The questionnaire SHALL calculate a total score for AUDIT-C.

**Text**: 

**Context**: 

**Actor**: Questionnaire Implementer

**Conformance**: SHALL

# Test Specification for REQ-263

## 1. Requirement ID
REQ-263

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be programmatically verified by examining the Questionnaire structure and validating that it includes calculation logic for AUDIT-C total scoring.

### Complexity
**Moderate** - The test requires understanding of FHIR Questionnaire structure, AUDIT-C scoring methodology, and validation of calculated expressions or enableWhen logic.

### Prerequisites
- System must support FHIR R4 Questionnaire resource
- Test system should have access to AUDIT-C questionnaires (LOINC code 75626-2)
- Understanding of AUDIT-C scoring rules:
  - Questions 1-3 of AUDIT-C
  - Each question scored 0-4 points
  - Total score range: 0-12 points
- System must implement questionnaire calculation capabilities (either through calculated expressions or post-processing)

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- `Questionnaire` resource with LOINC code 75626-2 (AUDIT-C)
- The Questionnaire should contain the three AUDIT-C questions with appropriate answer options
- Questionnaire must include calculation logic for total score computation

**Expected Outputs:**
- Questionnaire resource that demonstrates total score calculation capability
- Evidence that the total score is computed from the three AUDIT-C question responses
- Validation that the calculation follows AUDIT-C scoring methodology

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations should be supported:

1. **GET /Questionnaire/[id]** - Retrieve specific AUDIT-C questionnaire
2. **GET /Questionnaire?code=75626-2** - Search for AUDIT-C questionnaires by LOINC code
3. **Questionnaire structure analysis** - Examine the questionnaire definition for calculation logic

*Note: The US Core Server CapabilityStatement provided focuses on core clinical data access. Questionnaire-specific operations may need to be verified against the actual server's CapabilityStatement for questionnaire support.*

### Validation Criteria

**Primary Assertions:**
1. **Questionnaire Structure Validation:**
   - Questionnaire.code contains LOINC 75626-2
   - Questionnaire contains exactly 3 items corresponding to AUDIT-C questions
   - Each question item has appropriate answerOption with values 0-4

2. **Calculation Logic Validation:**
   - Questionnaire includes a calculated item for total score, OR
   - Questionnaire.item contains calculation expressions using FHIR expression language, OR
   - Documentation/extension indicates how total score calculation is implemented

3. **Score Calculation Verification:**
   - Verify that the calculation method can produce scores in the range 0-12
   - Confirm that the calculation sums the values from the three AUDIT-C questions
   - Validate that the calculation logic is mathematically correct (sum of Q1 + Q2 + Q3)

**Test Cases:**
1. **Questionnaire Retrieval Test:**
   - Retrieve AUDIT-C questionnaire and verify its structure
   - Confirm presence of calculation logic for total scoring

2. **Calculation Logic Test:**
   - Analyze questionnaire definition for:
     - `Questionnaire.item.extension` with calculation URLs
     - `Questionnaire.item.type` = "decimal" or "integer" for calculated fields
     - FHIR expression language usage for calculations
     - Appropriate linkId references between calculation item and source questions

3. **Score Range Validation:**
   - Verify that the implemented calculation can handle:
     - Minimum score scenario (all answers = 0, total = 0)
     - Maximum score scenario (all answers = 4, total = 12)
     - Mixed score scenarios (various combinations totaling between 0-12)

**Passing Criteria:**
- Questionnaire successfully demonstrates total score calculation capability
- Calculation method is clearly defined and implementable
- Score calculation follows AUDIT-C methodology (sum of three questions, each 0-4 points)
- Total score range is correctly bounded (0-12)

**Additional Considerations:**
- Test should accommodate different implementation approaches (client-side calculation, server-side calculation, or hybrid approaches)
- Validation should focus on the presence and correctness of calculation specification rather than runtime execution
- Consider testing with both pre-populated QuestionnaireResponse resources and questionnaire definition analysis

---

<a id='req-311'></a>

### REQ-311: The system SHALL support the representation of personal characteristics in a QuestionnaireResponse.

**Text**: 

**Context**: 

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-311

## 1. Requirement ID
**REQ-311**: The system SHALL support the representation of personal characteristics in a QuestionnaireResponse.

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated testing by examining QuestionnaireResponse resources for the presence and proper representation of personal characteristics data elements.

### Complexity
**Simple** - The requirement focuses on a single capability: ensuring QuestionnaireResponse resources can represent personal characteristics. While the data content may vary, the structural validation is straightforward.

### Prerequisites
- System must support QuestionnaireResponse resources
- System must have existing QuestionnaireResponse data that includes personal characteristics
- Test data should include QuestionnaireResponse resources based on standardized questionnaires (e.g., PRAPARE) that capture personal characteristics
- System must support FHIR R4 specification

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Existing QuestionnaireResponse resources in the system that contain personal characteristics data
- **Test Data Requirements**: QuestionnaireResponse instances that include personal characteristics such as:
  - Demographics (age, race, ethnicity, gender identity)
  - Social determinants (housing, employment, education, income)
  - Health behaviors and lifestyle factors
  - Family and social support structures

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported:
- **GET /QuestionnaireResponse/[id]** - Retrieve specific QuestionnaireResponse resources
- **GET /QuestionnaireResponse?_id=[id1,id2,...]** - Retrieve multiple QuestionnaireResponse resources
- **GET /QuestionnaireResponse?patient=[patient-id]** - Search for QuestionnaireResponse by patient (if supported by implementation)

### Validation Criteria

#### Primary Validation Checks:
1. **Resource Structure Validation**
   - Verify QuestionnaireResponse resources conform to FHIR R4 specification
   - Validate that `meta.profile` includes appropriate US Core or implementation-specific profiles when present
   - Confirm required elements are present (status, authored, item array)

2. **Personal Characteristics Representation**
   - Verify that personal characteristics are captured in the `item` array of QuestionnaireResponse
   - Validate that each personal characteristic item includes:
     - `linkId` referencing the corresponding Questionnaire item
     - Appropriate `answer` elements with correct data types
     - Answer values that align with expected value sets for personal characteristics

3. **Data Element Coverage**
   - Confirm representation of key personal characteristic categories:
     - Demographic information
     - Social determinants of health
     - Behavioral and lifestyle factors
     - Environmental factors
   - Validate that complex personal characteristics are properly structured using nested items when applicable

4. **Value Validation**
   - Verify that coded answers use appropriate terminologies (SNOMED CT, ICD-10, LOINC, etc.)
   - Confirm that text answers are properly formatted
   - Validate that numeric answers include appropriate units when applicable

#### Success Criteria:
- **Pass**: All retrieved QuestionnaireResponse resources containing personal characteristics demonstrate proper FHIR-compliant representation with complete and valid data elements
- **Fail**: Any QuestionnaireResponse resource fails structural validation, contains malformed personal characteristics data, or lacks expected personal characteristics elements

#### Test Execution Steps:
1. Retrieve available QuestionnaireResponse resources from the system
2. Filter for resources that contain personal characteristics data
3. Validate each resource against FHIR R4 specification
4. Verify personal characteristics are properly represented in the item structure
5. Confirm data completeness and accuracy for personal characteristics elements
6. Generate test report with pass/fail status and detailed findings

---

<a id='req-312'></a>

### REQ-312: The system SHALL capture family and home information in a QuestionnaireResponse.

**Text**: 

**Context**: 

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-312

## 1. Requirement ID
**REQ-312**: The system SHALL capture family and home information in a QuestionnaireResponse.

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated inspection of QuestionnaireResponse resources to confirm the presence and proper structure of family and home information fields.

### Complexity
**Moderate** - The test requires understanding of PRAPARE questionnaire structure, QuestionnaireResponse validation, and identification of specific family and home information elements within the response data.

### Prerequisites
- System must support QuestionnaireResponse resource creation and storage
- System must implement PRAPARE or similar social determinants questionnaire
- Test data must include QuestionnaireResponse instances with family and home information
- Access to system's FHIR endpoint with appropriate authentication/authorization

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- `QuestionnaireResponse` resources containing PRAPARE or equivalent social determinants data
- Associated `Questionnaire` resource (referenced by QuestionnaireResponse.questionnaire)
- `Patient` resource (referenced by QuestionnaireResponse.subject)

**Expected Outputs:**
- QuestionnaireResponse resources with populated family and home information fields
- Validation confirmation that required family/home elements are present and properly structured

### Required FHIR Operations
Based on the US Core Server Capability Statement, the following operations are supported:

1. **GET /QuestionnaireResponse/{id}** - Retrieve specific QuestionnaireResponse instances
2. **GET /QuestionnaireResponse?subject={patient_id}** - Search for QuestionnaireResponse by patient
3. **GET /QuestionnaireResponse?questionnaire={questionnaire_id}** - Search for responses to specific questionnaires
4. **GET /Questionnaire/{id}** - Retrieve the source questionnaire to understand expected structure

### Validation Criteria

**Primary Assertions:**
1. **Resource Presence**: QuestionnaireResponse resources exist and are accessible via FHIR API
2. **Family Information Capture**: 
   - Verify presence of family-related question responses (e.g., household size, family composition, dependents)
   - Validate that family information fields contain non-null, meaningful values
   - Confirm data types match questionnaire item expectations
3. **Home Information Capture**:
   - Verify presence of housing-related question responses (e.g., housing situation, housing stability, utilities)
   - Validate that home information fields contain non-null, meaningful values
   - Confirm data types match questionnaire item expectations
4. **Structural Validity**:
   - QuestionnaireResponse.status is 'completed' or 'amended'
   - QuestionnaireResponse.questionnaire references valid Questionnaire resource
   - QuestionnaireResponse.subject references valid Patient resource
   - Response items align with source questionnaire structure

**Test Cases:**

**Test Case 1: Family Information Validation**
- **Action**: Retrieve QuestionnaireResponse instances and examine item responses
- **Assertion**: Identify and validate family-related responses (household composition, family size, relationship status, etc.)
- **Pass Criteria**: Family information items are present with valid, non-empty values

**Test Case 2: Home Information Validation**
- **Action**: Retrieve QuestionnaireResponse instances and examine item responses  
- **Assertion**: Identify and validate housing-related responses (housing status, housing stability, neighborhood, utilities access, etc.)
- **Pass Criteria**: Home information items are present with valid, non-empty values

**Test Case 3: Data Completeness Check**
- **Action**: Cross-reference QuestionnaireResponse items against source Questionnaire
- **Assertion**: Verify that family and home information sections from the questionnaire have corresponding responses
- **Pass Criteria**: All mandatory family and home information items from the questionnaire have responses in the QuestionnaireResponse

**Test Case 4: Resource Linkage Validation**
- **Action**: Validate references between QuestionnaireResponse, Questionnaire, and Patient resources
- **Assertion**: Confirm proper FHIR resource relationships and referential integrity
- **Pass Criteria**: All resource references are valid and resolvable

**Failure Conditions:**
- QuestionnaireResponse resources lack family or home information responses
- Family/home information fields contain only null or empty values
- Data types in responses don't match questionnaire item expectations
- Required family or home information items are missing from responses
- Resource references are invalid or unresolvable

---

<a id='req-313'></a>

### REQ-313: The system SHALL record money and resources information in a QuestionnaireResponse.

**Text**: 

**Context**: 

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-313

## 1. Requirement ID
REQ-313

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified by examining QuestionnaireResponse resources to confirm they contain money and resources information in appropriate data elements.

### Complexity
**Simple** - The requirement involves validating the presence and proper formatting of specific data types (money/resources) within QuestionnaireResponse resources.

### Prerequisites
- System must support QuestionnaireResponse resource creation and retrieval
- Test data must include QuestionnaireResponse resources that should contain money and resources information
- Access to FHIR server supporting US Core Server capabilities
- Understanding of PRAPARE questionnaire structure and expected money/resources questions

## 3. Test Implementation Strategy

### Required Inputs
**Required FHIR Resources:**
- QuestionnaireResponse resources that are expected to contain money and resources information
- Associated Questionnaire resources (optional, for context validation)

**Expected Outputs:**
- QuestionnaireResponse resources with properly recorded money and resources data
- Validation that money values use appropriate FHIR data types (decimal, Quantity, Money)
- Confirmation that resources information is captured in structured format

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations should be supported:

1. **GET** `/QuestionnaireResponse/{id}` - Retrieve specific QuestionnaireResponse resources
2. **GET** `/QuestionnaireResponse` - Search for QuestionnaireResponse resources using search parameters
3. **Potential search parameters:**
   - `_id` - to retrieve specific resources
   - `patient` - to find responses for specific patients
   - `questionnaire` - to find responses for specific questionnaires

### Validation Criteria

**Primary Assertions:**
1. **Money Information Validation:**
   - Verify that QuestionnaireResponse.item elements contain money-related answers
   - Confirm money values are recorded using appropriate FHIR data types:
     - `valueDecimal` for simple monetary amounts
     - `valueQuantity` with currency units where applicable
     - Proper use of `valueMoney` type if supported
   - Validate that monetary values are non-negative where contextually appropriate

2. **Resources Information Validation:**
   - Verify that QuestionnaireResponse.item elements contain resources-related answers
   - Confirm resources information is captured in structured format using:
     - `valueString` for textual resource descriptions
     - `valueCoding` for coded resource types
     - `valueReference` for references to other FHIR resources where applicable

3. **Data Structure Validation:**
   - Verify QuestionnaireResponse resources are valid according to FHIR R4 specification
   - Confirm proper linkage between questions and answers through `item.linkId`
   - Validate that money and resources items have appropriate question context

4. **Completeness Validation:**
   - Ensure that expected money and resources questions from PRAPARE questionnaire are answered when applicable
   - Verify that mandatory money/resources fields are populated when the questionnaire requires them

**Test Pass Criteria:**
- All retrieved QuestionnaireResponse resources that should contain money and resources information have these elements properly recorded
- Money values use appropriate FHIR data types and formatting
- Resources information is captured in a structured, interoperable format
- No validation errors when processing the QuestionnaireResponse resources
- Data conforms to US Core QuestionnaireResponse profile requirements if applicable

**Test Failure Scenarios:**
- QuestionnaireResponse resources missing expected money or resources information
- Money values recorded in non-standard formats or inappropriate data types
- Resources information captured only as free text without structured elements
- FHIR validation errors in QuestionnaireResponse resources
- Inconsistent data representation across multiple QuestionnaireResponse instances

---

<a id='req-314'></a>

### REQ-314: The system SHALL include social and emotional health data in a QuestionnaireResponse.

**Text**: 

**Context**: 

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-314

## 1. Requirement ID
REQ-314

## 2. Requirement Analysis

### Testability Assessment
**Classification: Automatically Testable**

This requirement is automatically testable as it involves verifying the presence and structure of specific data elements within a QuestionnaireResponse resource. The requirement can be validated through automated inspection of QuestionnaireResponse instances to confirm they contain social and emotional health data elements.

### Complexity
**Simple**

The requirement has straightforward validation criteria focused on data presence verification within a standard FHIR resource structure.

### Prerequisites
- System must support QuestionnaireResponse resources as indicated in the Capability Statement
- System must have access to social and emotional health assessment questionnaires (e.g., PRAPARE or similar instruments)
- Test data should include completed QuestionnaireResponse instances with social and emotional health components

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- `QuestionnaireResponse` resources that should contain social and emotional health data
- Associated `Questionnaire` resources (referenced by QuestionnaireResponse.questionnaire) to understand the context of responses
- `Patient` resources (referenced by QuestionnaireResponse.subject) for context validation

**Expected Outputs:**
- Validation results confirming presence of social and emotional health data elements
- Identification of specific social/emotional health question-answer pairs within the response structure

### Required FHIR Operations
Based on the Capability Statement, the following supported operations will be used:

1. **QuestionnaireResponse Search Operations:**
   - `GET /QuestionnaireResponse?patient=[id]` - Retrieve QuestionnaireResponse resources for a specific patient
   - `GET /QuestionnaireResponse?_id=[id]` - Retrieve specific QuestionnaireResponse by ID
   - `GET /QuestionnaireResponse?questionnaire=[reference]` - Retrieve responses to specific questionnaires

2. **Resource Retrieval:**
   - `GET /QuestionnaireResponse/[id]` - Direct resource retrieval for detailed inspection
   - `GET /Questionnaire/[id]` - Retrieve referenced questionnaire for context validation

### Validation Criteria

The test SHALL verify the following assertions to indicate conformance:

#### Primary Assertions:
1. **Resource Structure Validation:**
   - QuestionnaireResponse resources are properly structured and valid according to the US Core QuestionnaireResponse Profile
   - Required elements (status, subject, questionnaire) are present and valid

2. **Social and Emotional Health Data Presence:**
   - QuestionnaireResponse.item array contains items that represent social and emotional health domains
   - Social health domains may include: housing stability, food security, transportation, social connections, community safety
   - Emotional health domains may include: stress levels, depression screening, anxiety assessment, social support systems

3. **Data Completeness:**
   - Social and emotional health items have associated answers (QuestionnaireResponse.item.answer is populated)
   - Answer values are appropriate for the question type (boolean, coding, string, integer, etc.)

#### Secondary Assertions:
1. **Reference Integrity:**
   - QuestionnaireResponse.questionnaire references a valid Questionnaire resource
   - QuestionnaireResponse.subject references a valid Patient resource

2. **Content Validation:**
   - Items with social/emotional health content have meaningful linkId values that can be traced to the source questionnaire
   - Answer formats align with the expected value types defined in the referenced questionnaire

#### Test Pass Criteria:
- **PASS:** QuestionnaireResponse contains at least one item addressing social health aspects AND at least one item addressing emotional health aspects, with populated answers
- **FAIL:** QuestionnaireResponse lacks social and emotional health data elements, or contains only one domain (social OR emotional but not both), or relevant items lack answer values

#### Implementation Notes:
- Tests should accommodate various social and emotional health assessment instruments (PRAPARE, PHQ-9, GAD-7, social determinants screening tools)
- Validation should be flexible enough to work with different questionnaire structures while ensuring core social and emotional health domains are represented
- Consider both coded answers (using standard terminologies) and free-text responses as valid data representations

---

<a id='req-315'></a>

### REQ-315: The system SHALL support optional additional questions in a QuestionnaireResponse.

**Text**: 

**Context**: 

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-315

## 1. Requirement ID
REQ-315

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated analysis of QuestionnaireResponse resources to detect the presence of additional questions beyond those defined in the source Questionnaire.

### Complexity
**Simple** - The test involves straightforward comparison between Questionnaire items and QuestionnaireResponse answers to identify additional questions.

### Prerequisites
- System must support QuestionnaireResponse resource operations
- Test data should include:
  - At least one Questionnaire resource with defined items
  - Corresponding QuestionnaireResponse resources, some containing additional questions not present in the original Questionnaire
  - QuestionnaireResponse resources that reference the Questionnaire via the `questionnaire` element

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- `Questionnaire` resources that define the base set of questions
- `QuestionnaireResponse` resources that may contain additional questions beyond those in the referenced Questionnaire

**Expected Outputs:**
- Successful processing and storage of QuestionnaireResponse resources containing additional questions
- System should accept and retain all question-answer pairs, including those not defined in the source Questionnaire

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are supported:
- `GET` operations to retrieve Questionnaire and QuestionnaireResponse resources
- `POST` operations to create QuestionnaireResponse resources with additional questions (if server supports create operations)
- JSON format support (required by US Core)

### Validation Criteria

**Test Case 1: Retrieve and Analyze Existing QuestionnaireResponse**
1. **Setup**: Identify QuestionnaireResponse resources in the system
2. **Execution**: 
   - Retrieve QuestionnaireResponse resources using `GET /QuestionnaireResponse`
   - For each QuestionnaireResponse with a `questionnaire` reference, retrieve the referenced Questionnaire
3. **Validation**:
   - Compare the `item.linkId` values in the QuestionnaireResponse against the `item.linkId` values in the referenced Questionnaire
   - **Pass Criteria**: System successfully returns QuestionnaireResponse resources that contain `item` elements with `linkId` values not present in the source Questionnaire
   - Verify that additional questions are properly structured with valid `linkId`, `text`, and `answer` elements

**Test Case 2: Create QuestionnaireResponse with Additional Questions (if supported)**
1. **Setup**: Identify a valid Questionnaire resource in the system
2. **Execution**:
   - Create a QuestionnaireResponse that references the Questionnaire
   - Include all required answers from the original Questionnaire
   - Add additional question-answer pairs with unique `linkId` values not present in the source Questionnaire
   - Submit via `POST /QuestionnaireResponse`
3. **Validation**:
   - **Pass Criteria**: System accepts the QuestionnaireResponse without errors (returns HTTP 200/201)
   - Retrieved QuestionnaireResponse contains all submitted items, including additional questions
   - Additional questions maintain their structure and content

**Test Case 3: Data Integrity Verification**
1. **Execution**: For QuestionnaireResponse resources containing additional questions
2. **Validation**:
   - Verify that additional questions follow proper FHIR QuestionnaireResponse.item structure
   - Confirm `linkId` uniqueness within the QuestionnaireResponse
   - Validate that additional questions have appropriate `answer` elements when answers are provided
   - **Pass Criteria**: All additional questions conform to FHIR QuestionnaireResponse specifications

**Assertion Logic:**
- The system SHALL demonstrate ability to handle QuestionnaireResponse resources containing questions (items) beyond those defined in the referenced Questionnaire
- Additional questions must be properly formatted and accessible through standard FHIR operations
- No data loss or corruption should occur when processing additional questions
- System should maintain referential integrity between Questionnaire and QuestionnaireResponse while allowing extensibility

**Success Metrics:**
- At least one QuestionnaireResponse demonstrates additional questions beyond its referenced Questionnaire
- All additional questions maintain proper FHIR structure and are retrievable
- System processes and stores additional questions without generating errors or warnings related to the additional content

---

<a id='req-529'></a>

### REQ-529: US Core Client SHALL fetch QuestionnaireResponse resources.

**Text**: 

**Context**: US Core Client read interaction for QuestionnaireResponse by id

**Actor**: US Core Client

**Conformance**: SHALL

# Test Specification for REQ-529

## 1. Requirement ID
**REQ-529**: US Core Client SHALL fetch QuestionnaireResponse resources

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Automatically testable

This requirement can be automatically tested by verifying that a US Core Client can successfully execute read operations to fetch QuestionnaireResponse resources by their resource ID. The requirement specifies a concrete FHIR interaction (read by ID) with measurable success criteria.

### Complexity
**Complexity Level**: Simple

This is a straightforward FHIR read operation test that requires minimal setup and has clear pass/fail criteria based on HTTP response codes and resource validation.

### Prerequisites
- US Core Server with QuestionnaireResponse resources available for testing
- Valid QuestionnaireResponse resource IDs for testing
- US Core Client capable of making FHIR RESTful API calls
- Network connectivity between client and server
- Appropriate authentication/authorization credentials if required by the server

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources Required**:
- One or more QuestionnaireResponse resources must exist on the test server with known resource IDs
- Resources should conform to US Core QuestionnaireResponse profile requirements

**Expected Outputs**:
- HTTP 200 OK response with valid QuestionnaireResponse resource in response body
- Response must be in JSON format (as required by US Core Server capabilities)
- Returned resource must have matching resource ID
- Response may optionally include XML format if server supports it

### Required FHIR Operations
**Primary Operation**:
- `GET [base]/QuestionnaireResponse/[id]` - Read QuestionnaireResponse by ID

**Supporting Operations** (for test setup/verification):
- `GET [base]/QuestionnaireResponse` - Search to identify available QuestionnaireResponse resource IDs for testing

### Validation Criteria

#### Primary Success Criteria
1. **HTTP Response Validation**:
   - Response status code must be 200 (OK)
   - Response must include appropriate FHIR content-type headers (`application/fhir+json`)

2. **Resource Structure Validation**:
   - Response body must contain a valid FHIR QuestionnaireResponse resource
   - Resource ID in response must match the requested ID
   - Resource must pass FHIR R4 structural validation

3. **US Core Profile Conformance**:
   - Returned QuestionnaireResponse should conform to US Core QuestionnaireResponse profile
   - Must Support elements should be populated when data is available
   - Resource should include `meta.profile` indicating US Core profile conformance (SHOULD requirement)

#### Error Handling Validation
4. **Invalid ID Handling**:
   - Request for non-existent QuestionnaireResponse ID should return HTTP 404
   - Error response should include appropriate OperationOutcome resource

5. **Authorization Handling**:
   - Unauthorized requests should return HTTP 401, 403, or 404 as specified in capability statement
   - Error responses should be properly formatted FHIR responses

#### Format Support Validation
6. **Content Format Support**:
   - JSON format response is mandatory (SHALL requirement from capability statement)
   - XML format response is optional (SHOULD requirement from capability statement)
   - Client should be able to process both formats if server provides them

#### Performance and Reliability
7. **Basic Performance**:
   - Response should be returned within reasonable timeframe
   - Multiple consecutive requests should produce consistent results

### Test Cases

#### Test Case 1: Successful QuestionnaireResponse Retrieval
- **Action**: Execute GET request for valid QuestionnaireResponse ID
- **Expected**: HTTP 200 with valid QuestionnaireResponse resource matching requested ID

#### Test Case 2: Non-existent Resource Handling  
- **Action**: Execute GET request for non-existent QuestionnaireResponse ID
- **Expected**: HTTP 404 with appropriate OperationOutcome

#### Test Case 3: Content Format Negotiation
- **Action**: Execute GET request with Accept header for JSON format
- **Expected**: HTTP 200 with JSON-formatted QuestionnaireResponse resource

#### Test Case 4: Optional XML Format Support
- **Action**: Execute GET request with Accept header for XML format (if server supports)
- **Expected**: HTTP 200 with XML-formatted QuestionnaireResponse resource OR appropriate error if not supported

---

<a id='req-546'></a>

### REQ-546: Nested items in QuestionnaireResponse

**Text**: 

**Context**: QuestionnaireResponse.item nesting rules; invariant qrs-1

**Actor**: System processing the QuestionnaireResponse

**Conformance**: SHALL

# Test Specification for REQ-546

## 1. Requirement ID
**REQ-546**: Nested items in QuestionnaireResponse

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Automatically testable

The requirement references FHIR invariant `qrs-1` which is a structural validation rule that can be automatically verified through parsing and validation of QuestionnaireResponse resources. This is a well-defined, testable constraint that can be programmatically evaluated.

### Complexity
**Level**: Moderate

While the invariant itself is straightforward to validate, testing requires:
- Understanding of QuestionnaireResponse structure and nesting rules
- Validation of hierarchical item relationships
- Testing both valid and invalid nesting scenarios
- Coordination with referenced Questionnaire structures

### Prerequisites
- System must support QuestionnaireResponse resource operations as defined in the US Core Server Capability Statement
- Access to QuestionnaireResponse resources with nested items
- Understanding of the specific qrs-1 invariant rules from FHIR specification Section 26

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- QuestionnaireResponse resources containing nested `item` elements
- Associated Questionnaire resources (if available) to validate structural alignment
- Test data should include various nesting scenarios:
  - Valid nested item structures
  - Invalid nesting patterns that should trigger qrs-1 violation
  - Edge cases with multiple nesting levels

**Expected Outputs:**
- Validation results indicating conformance to qrs-1 invariant
- Error messages for non-conformant nested structures
- Successful processing of conformant nested items

### Required FHIR Operations
Based on the US Core Server Capability Statement, the following supported operations will be used:

**QuestionnaireResponse Operations:**
- `GET /QuestionnaireResponse/{id}` - Retrieve specific QuestionnaireResponse resources for validation
- `GET /QuestionnaireResponse?patient={patient_id}` - Search for QuestionnaireResponse resources by patient
- `GET /QuestionnaireResponse?_id={id}` - Search by ID parameter
- `GET /QuestionnaireResponse?questionnaire={questionnaire_id}` - Search by associated questionnaire

**Questionnaire Operations (if needed for context):**
- `GET /Questionnaire/{id}` - Retrieve referenced questionnaire for structural validation

### Validation Criteria

**Primary Assertions:**
1. **Invariant qrs-1 Compliance**: All QuestionnaireResponse resources must satisfy the qrs-1 invariant rules for nested items
2. **Structural Integrity**: Nested item structures must be logically consistent and properly hierarchical
3. **Processing Capability**: System must successfully process and return QuestionnaireResponse resources with valid nested structures

**Specific Validation Checks:**

**Pass Criteria:**
- QuestionnaireResponse resources with properly nested items are accepted and processed without errors
- Nested item structures conform to FHIR specification requirements
- System correctly validates the hierarchical relationships between parent and child items
- qrs-1 invariant validation passes for all conformant resources

**Fail Criteria:**
- Resources violating qrs-1 invariant are rejected or flagged with appropriate error messages
- System accepts malformed nested item structures
- Inconsistent validation of nesting rules across different resources
- Failure to properly process valid nested structures

**Test Scenarios:**
1. **Valid Nesting**: Test with QuestionnaireResponse containing properly structured nested items
2. **Invalid Nesting**: Test with resources that intentionally violate qrs-1 to ensure proper rejection
3. **Multi-level Nesting**: Validate handling of multiple levels of item nesting
4. **Edge Cases**: Test boundary conditions and complex nesting patterns

**Success Metrics:**
- 100% compliance with qrs-1 invariant validation
- Consistent processing of nested item structures
- Appropriate error handling for non-conformant resources
- Successful retrieval and processing of conformant QuestionnaireResponse resources through supported search operations

---



<a id='relatedperson'></a>

## RelatedPerson

<a id='req-530'></a>

### REQ-530: US Core Client SHALL fetch RelatedPerson resources.

**Text**: 

**Context**: US Core Client read interaction for RelatedPerson by id

**Actor**: US Core Client

**Conformance**: SHALL

# Test Specification for REQ-530

## 1. Requirement ID
**REQ-530**: US Core Client SHALL fetch RelatedPerson resources

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be directly tested by executing FHIR read operations and validating the responses.

### Complexity
**Simple** - This is a straightforward FHIR read interaction test that verifies basic REST API functionality.

### Prerequisites
- US Core Server implementation with RelatedPerson resources available
- Test client capable of making FHIR REST API calls
- Valid RelatedPerson resource IDs existing in the test system
- Proper authentication/authorization credentials configured
- Network connectivity between client and server

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Server Base URL**: The endpoint URL for the US Core Server
- **RelatedPerson Resource IDs**: One or more valid RelatedPerson resource identifiers that exist in the test system
- **Authentication Credentials**: Valid credentials for accessing the FHIR server (if required)
- **Expected Data**: Knowledge of what RelatedPerson resources should be retrievable

### Required FHIR Operations
- **GET [base]/RelatedPerson/[id]** - FHIR read interaction for RelatedPerson resources by ID

### Validation Criteria

#### Test Case 1: Successful RelatedPerson Resource Retrieval
**Objective**: Verify client can successfully fetch RelatedPerson resources by ID

**Test Steps**:
1. Execute GET request to `[base]/RelatedPerson/[valid-id]` for each available RelatedPerson ID
2. Verify HTTP response status code is 200 (OK)
3. Verify response contains valid FHIR RelatedPerson resource
4. Verify response Content-Type header includes `application/fhir+json` or `application/json`
5. Verify returned resource has correct resource type ("RelatedPerson")
6. Verify returned resource ID matches the requested ID

**Pass Criteria**:
- HTTP status code = 200
- Valid JSON structure returned
- Resource.resourceType = "RelatedPerson"
- Resource.id matches requested ID
- Response follows FHIR R4 RelatedPerson resource structure

#### Test Case 2: Handle Non-Existent RelatedPerson Resource
**Objective**: Verify client properly handles requests for non-existent RelatedPerson resources

**Test Steps**:
1. Execute GET request to `[base]/RelatedPerson/[non-existent-id]`
2. Verify appropriate HTTP error response is returned
3. Verify response includes OperationOutcome resource (if applicable)

**Pass Criteria**:
- HTTP status code = 404 (Not Found)
- Response may contain FHIR OperationOutcome resource describing the error
- Client handles the error response appropriately

#### Test Case 3: Authentication/Authorization Handling
**Objective**: Verify client properly handles authentication and authorization scenarios

**Test Steps**:
1. Execute GET request without proper authentication credentials (if auth is required)
2. Verify appropriate HTTP error response is returned
3. Execute GET request with valid credentials
4. Verify successful response is returned

**Pass Criteria**:
- Without auth: HTTP status code = 401 (Unauthorized) or 403 (Forbidden)
- With valid auth: HTTP status code = 200 and valid RelatedPerson resource returned
- Client properly manages authentication workflows

#### Test Case 4: JSON Format Support
**Objective**: Verify client supports required JSON format as specified in capability statement

**Test Steps**:
1. Execute GET request with Accept header set to `application/fhir+json`
2. Verify response is returned in JSON format
3. Verify JSON structure is valid FHIR format

**Pass Criteria**:
- Response Content-Type indicates JSON format
- Response body contains valid JSON
- JSON structure conforms to FHIR R4 RelatedPerson resource specification

#### Overall Test Success Criteria
- Client successfully retrieves at least one RelatedPerson resource by ID
- Client properly handles HTTP response codes (200, 404, 401/403)
- Client processes JSON-formatted FHIR resources correctly
- All returned RelatedPerson resources conform to FHIR R4 specification
- Client demonstrates proper error handling for invalid requests

**Note**: Tests should be executed using the "bring your own data" approach, utilizing RelatedPerson resources that exist in the testing environment rather than requiring specific test fixtures.

---



<a id='security'></a>

## Security

<a id='req-511'></a>

### REQ-511: Servers SHALL support the registration and authorization of patient-facing apps with specific SMART scopes.

**Text**: 

**Context**: SMART on FHIR – patient-facing app create scope for vital signs Observations

**Actor**: Server

**Conformance**: SHALL

# Test Specification for REQ-511

## 1. Requirement ID
REQ-511

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be tested through automated SMART App Launch authorization flows and FHIR API interactions to verify proper registration, authorization, and scope enforcement for patient-facing apps with vital signs observation create capabilities.

### Complexity
**Complex** - The requirement involves multiple components:
- SMART on FHIR authorization flows
- OAuth 2.0 client registration and authorization
- FHIR resource creation capabilities
- Scope validation and enforcement
- Integration between authorization server and FHIR server

### Prerequisites
- Server must implement SMART App Launch version 2.0.0 or later (as indicated in Capability Statement)
- Authorization server must be configured to support patient-facing app registration
- FHIR server must support Observation resource creation (US Core Server capability)
- Test client must be capable of performing SMART App Launch flows
- Valid patient context for testing patient-facing app scenarios
- Test environment must support OAuth 2.0 flows

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources:**
  - Patient resource(s) for establishing patient context
  - Any existing Observation resources for baseline testing
- **SMART App Configuration:**
  - Test patient-facing app client credentials
  - Redirect URIs for OAuth flow
  - Required SMART scopes including vital signs observation create scope
- **Authorization Parameters:**
  - Patient credentials or context for patient-facing authorization
  - Valid authorization endpoints from server's well-known configuration

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations must be supported:
- **GET** `/.well-known/smart-configuration` - Retrieve SMART configuration
- **POST** `/auth/register` - Client registration (if dynamic registration supported)
- **GET** `/auth/authorize` - Authorization endpoint
- **POST** `/auth/token` - Token endpoint
- **POST** `/Observation` - Create vital signs Observation resources
- **GET** `/Patient/{id}` - Retrieve patient context (supported by US Core Server)

### Validation Criteria

#### Test Case 1: SMART Configuration Discovery
**Objective:** Verify server advertises SMART App Launch capabilities
- **Assertion 1:** Server returns valid SMART configuration at `/.well-known/smart-configuration`
- **Assertion 2:** Configuration includes required endpoints (`authorization_endpoint`, `token_endpoint`)
- **Assertion 3:** Configuration includes support for patient-facing app scopes
- **Assertion 4:** Configuration indicates support for vital signs observation create scopes

#### Test Case 2: Patient-Facing App Registration
**Objective:** Verify server supports registration of patient-facing applications
- **Assertion 1:** Server accepts client registration for patient-facing app
- **Assertion 2:** Registered client can request vital signs observation create scopes
- **Assertion 3:** Registration response includes valid `client_id`
- **Assertion 4:** Server properly categorizes app as patient-facing based on registration parameters

#### Test Case 3: Patient Authorization Flow
**Objective:** Verify patient can authorize app with vital signs create scopes
- **Assertion 1:** Authorization endpoint accepts patient-facing app authorization request
- **Assertion 2:** Patient can successfully authenticate and authorize the application
- **Assertion 3:** Authorization includes vital signs observation create scopes in the request
- **Assertion 4:** Authorization code is successfully returned to the app

#### Test Case 4: Token Exchange and Scope Validation
**Objective:** Verify proper token issuance with requested scopes
- **Assertion 1:** Token endpoint accepts valid authorization code exchange
- **Assertion 2:** Access token is issued with appropriate vital signs create scopes
- **Assertion 3:** Token response includes patient context information
- **Assertion 4:** Scope parameter in token response matches or is subset of requested scopes

#### Test Case 5: Observation Create with Valid Scope
**Objective:** Verify authorized app can create vital signs observations
- **Assertion 1:** POST to `/Observation` succeeds with valid access token
- **Assertion 2:** Server accepts vital signs Observation resource creation
- **Assertion 3:** Created Observation resource includes proper patient reference
- **Assertion 4:** Server validates that Observation category matches authorized vital signs scope

#### Test Case 6: Scope Enforcement
**Objective:** Verify server enforces scope limitations appropriately
- **Assertion 1:** App cannot create non-vital signs Observations without appropriate scopes
- **Assertion 2:** App cannot access other patients' data outside authorized context
- **Assertion 3:** Server returns appropriate HTTP 403/401 errors for unauthorized operations
- **Assertion 4:** Error responses include proper OAuth error codes and descriptions

#### Test Case 7: Token Validation and Refresh
**Objective:** Verify ongoing authorization management
- **Assertion 1:** Server validates access tokens on each API request
- **Assertion 2:** Expired tokens are properly rejected with appropriate error responses
- **Assertion 3:** Refresh token functionality works correctly (if supported)
- **Assertion 4:** Scope validation occurs on each API call, not just during authorization

#### Overall Conformance Validation
**Pass Criteria:** All test cases must pass to demonstrate conformance with REQ-511
- Server successfully supports registration and authorization of patient-facing apps
- SMART scopes for vital signs observations are properly implemented and enforced
- Integration between authorization server and FHIR server functions correctly
- Patient context and authorization boundaries are properly maintained

---

<a id='req-512'></a>

### REQ-512: Servers SHOULD support the registration and authorization of patient-facing apps with update capabilities.

**Text**: 

**Context**: SMART on FHIR – patient-facing app update scope for vital signs Observations

**Actor**: Server

**Conformance**: SHOULD

# Test Specification for REQ-512

## 1. Requirement ID
REQ-512

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Attestation with some automated components

**Rationale**: 
- The requirement involves SMART on FHIR app registration and authorization processes, which are typically configured at the server/system level
- While we can test that appropriate SMART scopes are supported and that update operations work with proper authorization, the actual "registration" process varies significantly between implementations
- The core functionality (update capabilities for patient-facing apps) can be tested programmatically once proper authorization is established

### Complexity
**Complex**

**Justification**:
- Requires SMART on FHIR authorization flow implementation
- Involves OAuth 2.0/OpenID Connect protocols
- Requires coordination between authorization server and FHIR server
- Patient-facing app context adds complexity around consent and authorization scopes

### Prerequisites
**Required System Configurations**:
- SMART on FHIR authorization server configured and operational
- Server supports SMART scopes including patient-specific update scopes (e.g., `patient/Observation.write`)
- Test patient accounts available for authorization testing
- Patient-facing app registration capability available

**Required Data**:
- Valid patient records in the system
- Existing Observation resources (preferably vital signs) that can be updated
- Test patient credentials for authorization flow

**Required Setup**:
- OAuth 2.0 client registration for testing
- SSL/TLS certificates for secure communications
- Network access to both authorization and FHIR endpoints

## 3. Test Implementation Strategy

### Required Inputs

**FHIR Resources Needed**:
- Patient resources (for context of patient-facing app)
- Observation resources with vital signs data (blood pressure, heart rate, temperature, etc.)
- Any existing Observation resources that can be safely modified for testing

**Configuration Requirements**:
- SMART authorization server endpoint URLs
- Client credentials for test application
- Patient credentials for authorization testing
- FHIR server base URL

### Required FHIR Operations

**Primary Operations** (supported per Capability Statement):
1. **OAuth 2.0 Authorization Flow**:
   - GET to authorization endpoint for patient consent
   - POST to token endpoint for access token retrieval

2. **FHIR RESTful Operations**:
   - `GET [base]/Observation?patient=[patient-id]` - Read existing observations
   - `PUT [base]/Observation/[id]` - Update existing observation
   - `POST [base]/Observation` - Create new observation (if supported)
   - `GET [base]/metadata` - Verify SMART capability declaration

**Authorization Scopes to Test**:
- `patient/Observation.read`
- `patient/Observation.write`
- `patient/*.read` (if broader access needed)

### Validation Criteria

#### Test Case 1: SMART Capability Declaration
**Objective**: Verify server declares SMART on FHIR support for patient-facing apps

**Test Steps**:
1. GET `[base]/metadata`
2. Verify CapabilityStatement contains SMART extension
3. Verify authorization and token endpoint URLs are present
4. Verify supported scopes include patient-facing scopes

**Pass Criteria**:
- CapabilityStatement includes `http://fhir-registry.smarthealthit.org/StructureDefinition/capabilities` extension
- Authorization endpoints are properly declared
- Patient-level scopes are listed in supported scopes

#### Test Case 2: Patient Authorization Flow
**Objective**: Verify patient-facing app can complete authorization flow

**Test Steps**:
1. Initiate OAuth 2.0 authorization code flow with patient-level scopes
2. Complete patient authentication and consent
3. Exchange authorization code for access token
4. Verify token contains appropriate scopes

**Pass Criteria**:
- Authorization flow completes successfully
- Access token is issued
- Token includes requested patient-level scopes
- Token is valid for FHIR API access

#### Test Case 3: Update Capability Verification
**Objective**: Verify patient-facing app can update vital signs observations

**Test Steps**:
1. Use patient-scoped access token from Test Case 2
2. GET existing Observation resources for the authorized patient
3. Select a vital signs Observation for update
4. PUT modified Observation back to server
5. GET the updated resource to verify changes

**Pass Criteria**:
- GET request returns patient's Observation resources (Status 200)
- PUT request with patient-scoped token succeeds (Status 200)
- Updated resource reflects the modifications
- No unauthorized access to other patients' data

#### Test Case 4: Scope Enforcement
**Objective**: Verify proper scope enforcement for update operations

**Test Steps**:
1. Attempt update operation without appropriate write scope
2. Attempt update operation on different patient's data
3. Verify appropriate error responses

**Pass Criteria**:
- Operations without write scope return HTTP 403 (Forbidden)
- Attempts to access other patients' data return HTTP 403 or 404
- Error responses include appropriate FHIR OperationOutcome

#### Test Case 5: App Registration Process (Attestation)
**Objective**: Verify server provides mechanism for patient-facing app registration

**Test Steps**:
1. Document the app registration process
2. Verify patient-facing apps can be registered with update capabilities
3. Confirm appropriate scopes can be requested during registration

**Pass Criteria**:
- Registration process supports patient-facing app classification
- Update scopes can be requested and granted
- Documentation or interface exists for app registration
- Process follows SMART App Launch implementation guide

### Additional Validation Points

**Security Validation**:
- Verify HTTPS is enforced for all authorization flows
- Confirm access tokens have appropriate expiration times
- Validate that refresh tokens work correctly (if supported)

**Error Handling**:
- Appropriate HTTP status codes per US Core requirements (400, 401, 403, 404)
- FHIR OperationOutcome resources returned for errors
- Consistent error messaging format

**Interoperability**:
- JSON format support (required per Capability Statement)
- XML format support (recommended per Capability Statement)
- Proper FHIR meta.profile declarations (recommended)

### Notes for Testers

1. **Bring Your Own Data Approach**: Tests should work with any valid patient data and vital signs observations present in the system
2. **Patient Consent**: Ensure test patients have appropriate permissions for app access testing
3. **Scope Variations**: Test with minimal required scopes and broader scopes to verify proper enforcement
4. **Multiple Vital Signs**: Test updates across different types of vital signs (blood pressure, heart rate, temperature, etc.) if available
5. **Documentation**: Maintain detailed logs of authorization flows and API interactions for compliance verification

---



<a id='servicerequest'></a>

## ServiceRequest

<a id='req-531'></a>

### REQ-531: US Core Client SHALL fetch ServiceRequest resources.

**Text**: 

**Context**: US Core Client read interaction for ServiceRequest by id

**Actor**: US Core Client

**Conformance**: SHALL

# Test Specification for REQ-531

## 1. Requirement ID
REQ-531

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be directly tested through automated FHIR API interactions to verify the client's ability to fetch ServiceRequest resources by ID.

### Complexity
**Simple** - This is a straightforward read operation test requiring a single FHIR interaction.

### Prerequisites
- US Core Server with ServiceRequest resources available
- Valid ServiceRequest resource IDs for testing
- Client system capable of making FHIR REST API calls
- Proper authentication/authorization credentials configured
- Network connectivity between client and server

## 3. Test Implementation Strategy

### Required Inputs
- **Test ServiceRequest ID**: A valid ServiceRequest resource identifier that exists on the target server
- **Server Base URL**: The FHIR server endpoint URL
- **Authentication credentials**: As required by the server's security implementation

### Expected Outputs
- **Successful Response**: HTTP 200 status with a valid ServiceRequest resource in JSON format
- **Resource Validation**: Returned resource must be a valid FHIR ServiceRequest resource
- **Profile Conformance**: Resource should conform to US Core ServiceRequest profile requirements

### Required FHIR Operations
- **read**: `GET [base]/ServiceRequest/[id]`
  - This operation is supported as part of the US Core Server capability requirements for resource interactions

### Validation Criteria

#### Primary Success Criteria
1. **HTTP Response Validation**:
   - Response status code is 200 (OK)
   - Response contains proper FHIR-compliant headers (Content-Type: application/fhir+json)

2. **Resource Structure Validation**:
   - Response body contains a valid FHIR ServiceRequest resource
   - Resource has correct resourceType of "ServiceRequest"
   - Resource contains required elements as defined by FHIR R4 specification

3. **Content Format Validation**:
   - Response is in JSON format (required per capability statement)
   - JSON structure follows FHIR specification

4. **US Core Profile Conformance**:
   - If meta.profile is present, it should reference the US Core ServiceRequest profile
   - Resource should conform to US Core ServiceRequest profile requirements including Must Support elements

#### Error Handling Validation
The client should appropriately handle standard error responses:

1. **404 Not Found**: When ServiceRequest ID does not exist
   - Client should handle gracefully without crashing
   
2. **401 Unauthorized**: When authentication fails
   - Client should handle authentication errors appropriately
   
3. **403 Forbidden**: When client lacks sufficient permissions
   - Client should respect access control restrictions

4. **400 Bad Request**: When request format is invalid
   - Client should handle malformed request errors

#### Test Cases

**Test Case 1: Successful ServiceRequest Fetch**
- Execute: `GET [base]/ServiceRequest/[valid-id]`
- Verify: HTTP 200 response with valid ServiceRequest resource

**Test Case 2: Non-existent ServiceRequest Handling**
- Execute: `GET [base]/ServiceRequest/[non-existent-id]`
- Verify: Client handles 404 response appropriately

**Test Case 3: Authentication Error Handling**
- Execute: `GET [base]/ServiceRequest/[valid-id]` with invalid credentials
- Verify: Client handles 401/403 responses appropriately

### Pass/Fail Criteria
- **PASS**: Client successfully fetches ServiceRequest resources by ID, receives valid FHIR-compliant responses, and handles error conditions gracefully
- **FAIL**: Client cannot fetch ServiceRequest resources, receives malformed responses, or fails to handle standard HTTP error responses properly

### Notes
- Test should work with any valid ServiceRequest data present in the test system
- Client must demonstrate capability to parse and handle the returned ServiceRequest resource appropriately
- Testing should verify the client's conformance to US Core requirements, not the server's data quality

---



<a id='specimen'></a>

## Specimen

<a id='req-230'></a>

### REQ-230: The USCoreSpecimenProfile SHALL map the identifier to RIM Mapping.

**Text**: 

**Context**: 

**Actor**: USCoreSpecimenProfile

**Conformance**: SHALL

# Test Specification for REQ-230

## 1. Requirement ID
**REQ-230**: The USCoreSpecimenProfile SHALL map the identifier to RIM Mapping.

## 2. Requirement Analysis

### Testability Assessment: 
**Not Testable** - This requirement is too vague and appears to be covered by FHIR validation tools. The requirement refers to "RIM Mapping" which is a structural mapping concept rather than a functional interoperability requirement that can be tested through API interactions.

### Complexity: 
**Not Applicable** - The requirement cannot be meaningfully tested as it stands.

### Prerequisites:
**Not Applicable** - No test prerequisites can be defined for an untestable requirement.

## 3. Test Implementation Strategy

### Analysis of Testability Issues:

1. **Vague Specification**: The requirement states "SHALL map the identifier to RIM Mapping" but provides no specific criteria for what constitutes proper mapping or how to verify it.

2. **Structural vs. Functional**: RIM (Reference Information Model) mappings are structural annotations in FHIR profiles that document how FHIR elements relate to HL7 v3 RIM concepts. These mappings are:
   - Static metadata embedded in the profile definition
   - Not exposed through FHIR API operations
   - Not testable through interoperability testing

3. **Validation Tool Coverage**: RIM mapping correctness would be verified by:
   - FHIR profile validation tools
   - Implementation Guide publishing tools
   - Static analysis of the profile definition

### Recommendation:

This requirement should be:
- **Reclassified** as a profile design requirement rather than an interoperability testing requirement
- **Verified** through static analysis of the USCoreSpecimenProfile definition
- **Validated** using FHIR profile validation tools during implementation guide development

### Alternative Testable Requirements:

If the intent is to test Specimen resource conformance, more appropriate testable requirements would be:

1. "US Core Specimen resources SHALL include at least one identifier when available"
2. "US Core Specimen identifier elements SHALL conform to the Identifier datatype requirements"
3. "Systems SHALL support retrieval of Specimen resources with valid identifier values"

These alternatives would be testable through standard FHIR API operations and resource validation, which are supported by the referenced Capability Statement's general US Core Server requirements.

---

<a id='req-231'></a>

### REQ-231: The USCoreSpecimenProfile SHALL map the accessionIdentifier to RIM Mapping.

**Text**: 

**Context**: 

**Actor**: USCoreSpecimenProfile

**Conformance**: SHALL

# Test Specification for REQ-231

## Requirement ID
REQ-231

## Requirement Analysis

### Testability Assessment
**Classification**: Not testable due to being too vague

**Rationale**: This requirement is fundamentally not testable as written because:
- RIM (Reference Information Model) mappings are informative metadata used for understanding relationships between FHIR and HL7 v3 models
- RIM mappings are not transmitted in FHIR instances and have no runtime behavior
- The requirement lacks specificity about what "mapping the accessionIdentifier to RIM Mapping" actually means in terms of observable behavior
- There is no clear success/failure criteria that can be programmatically verified
- FHIR validators do not validate RIM mappings as they are documentation artifacts

### Complexity
**N/A** - Requirement is not testable in its current form

### Prerequisites
**N/A** - No test implementation possible

## Test Implementation Strategy

### Assessment
This requirement cannot be implemented as a conformance test because:

1. **RIM mappings are documentation only**: RIM mappings in FHIR profiles serve as informative content to help implementers understand the relationship between FHIR elements and HL7 v3 RIM classes. They are not part of the runtime specification.

2. **No observable behavior**: Unlike must-support requirements, cardinality constraints, or value set bindings, RIM mappings do not affect how FHIR resources are structured, validated, or processed.

3. **Lack of testable criteria**: The requirement does not specify what constitutes successful "mapping" or what would constitute a failure.

### Recommended Action
This requirement should be either:
- **Removed** if it refers only to documentation/informative mapping
- **Clarified** if there is an intended behavioral requirement related to the accessionIdentifier element
- **Rewritten** to specify testable conformance criteria such as:
  - Cardinality requirements for Specimen.accessionIdentifier
  - Data type constraints
  - Must Support obligations
  - Terminology binding requirements

### Alternative Testable Requirements
If the intent is to test Specimen.accessionIdentifier functionality, consider these testable alternatives:

1. "The USCoreSpecimenProfile SHALL support Specimen.accessionIdentifier as a Must Support element"
2. "The USCoreSpecimenProfile SHALL require Specimen.accessionIdentifier to be present when available"
3. "The USCoreSpecimenProfile SHALL bind Specimen.accessionIdentifier.type to [specific value set]"

### Required FHIR Operations
**N/A** - No operations can be defined for non-testable requirement

### Validation Criteria
**N/A** - No validation criteria can be established for non-testable requirement

---

**Note**: This requirement appears to be a documentation artifact that was incorrectly categorized as requiring a test. RIM mappings in FHIR Implementation Guides are informative and do not represent testable conformance requirements.

---

<a id='req-232'></a>

### REQ-232: The USCoreSpecimenProfile SHALL map the status to RIM Mapping.

**Text**: 

**Context**: 

**Actor**: USCoreSpecimenProfile

**Conformance**: SHALL

# Test Specification for REQ-232

## 1. Requirement ID
REQ-232

## 2. Requirement Analysis

### Testability Assessment
**Classification: Not testable due to being too vague**

This requirement is not testable as specified because:
- The requirement states "SHALL map the status to RIM Mapping" but does not specify what the actual mapping should be
- RIM (Reference Information Model) mappings are typically metadata annotations within FHIR profiles, not runtime behaviors
- The requirement lacks specific criteria for what constitutes a valid mapping
- RIM mappings are generally validated at the profile definition level, not during implementation testing

### Complexity
**Not Applicable** - The requirement cannot be meaningfully tested in its current form.

### Prerequisites
- Access to US Core Specimen Profile definition
- Understanding of FHIR RIM mapping specifications
- Access to profile metadata and mapping definitions

## 3. Test Implementation Strategy

### Required Inputs
This requirement cannot be tested with runtime data as it pertains to profile metadata rather than instance data validation.

### Required FHIR Operations
None - RIM mappings are not validated through FHIR API operations but through profile definition review.

### Validation Criteria
**Cannot be established** - The requirement lacks sufficient specificity to create meaningful test criteria.

---

## Recommendations for Requirement Clarification

To make this requirement testable, it should be clarified to specify:

1. **What specific RIM mapping is expected** for the Specimen.status element
2. **Where the mapping should be documented** (in the profile definition, capability statement, etc.)
3. **What constitutes compliance** - is this about:
   - Having the mapping documented in the profile?
   - Ensuring semantic equivalence between FHIR and RIM concepts?
   - Supporting specific transformation rules?

### Alternative Testable Approach

If the intent is to verify that US Core Specimen instances conform to expected status value mappings, the requirement could be rewritten as:

*"US Core Specimen instances SHALL use status values that are semantically equivalent to [specific RIM status concepts], as documented in the profile mapping tables."*

This would enable testing by:
1. Retrieving Specimen resources from the server
2. Validating that status values conform to the specified semantic mappings
3. Verifying consistency with documented RIM equivalences

**Note**: As currently written, this requirement appears to be more appropriate for profile validation during development rather than interoperability testing during implementation.

---

<a id='req-233'></a>

### REQ-233: The USCoreSpecimenProfile SHALL map the type to RIM Mapping.

**Text**: 

**Context**: 

**Actor**: USCoreSpecimenProfile

**Conformance**: SHALL

# Test Specification for REQ-233

## 1. Requirement ID
**REQ-233**: USCoreSpecimenProfile SHALL map the type to RIM Mapping

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Not testable due to being too vague and covered by validator

**Rationale**: 
- This requirement appears to reference RIM (Reference Information Model) mapping metadata within the FHIR profile definition itself
- RIM mappings are structural metadata that define how FHIR elements correspond to HL7 V3 RIM classes and attributes
- These mappings are embedded in the StructureDefinition and are validated during profile conformance validation
- The requirement lacks specificity about what constitutes "proper" mapping or what should be tested beyond structural conformance
- FHIR validators automatically check that resources conform to their declared profiles, including any mapping constraints

### Complexity
**Simple** - if this were testable, it would involve basic metadata verification

### Prerequisites
- Access to US Core Specimen Profile StructureDefinition
- FHIR validator capable of profile validation
- Specimen resources claiming conformance to US Core Specimen Profile

## 3. Test Implementation Strategy

### Required Inputs
**Note**: This requirement is not practically testable as an interoperability conformance test, as RIM mappings are structural metadata embedded in profile definitions rather than runtime behavior that can be tested through API interactions.

If this requirement were interpreted as testing profile conformance generally:

**Input Resources**:
- Specimen resources that claim conformance to US Core Specimen Profile (via `meta.profile`)
- Access to the US Core Specimen Profile StructureDefinition

**Expected Outputs**:
- Profile validation results indicating conformance

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for Specimen:
- `GET /Specimen/{id}` - Read specimen resources
- `GET /Specimen?_id={id}&patient={patient}` - Search for specimens

**Note**: The Capability Statement shows limited search capabilities for Specimen (only `_id` and `patient` parameters).

### Validation Criteria

**Primary Validation** (handled by FHIR validator):
1. Specimen resources SHALL validate successfully against the US Core Specimen Profile
2. The US Core Specimen Profile StructureDefinition SHALL contain proper RIM mapping metadata for the `type` element

**Secondary Validation** (if attempting to test interoperability aspects):
1. Retrieved Specimen resources SHALL include `meta.profile` indicating US Core Specimen Profile conformance
2. Specimen resources SHALL pass profile validation when validated against the declared profile

### Recommended Approach

Given that this requirement addresses structural profile metadata rather than runtime interoperability behavior, the recommended approach is:

1. **Profile Structure Verification**: Verify that the US Core Specimen Profile StructureDefinition includes appropriate RIM mapping metadata for the type element
2. **Instance Conformance**: Ensure that Specimen instances validate against the profile using standard FHIR validation tools
3. **Documentation Review**: Confirm that RIM mappings are properly documented in the implementation guide

This requirement is best addressed through:
- Static analysis of the profile definition
- Standard FHIR validation processes
- Implementation guide documentation review

Rather than creating a specific interoperability test, this requirement should be considered satisfied when Specimen resources successfully validate against the US Core Specimen Profile using standard FHIR validation tools.

---

<a id='req-234'></a>

### REQ-234: The USCoreSpecimenProfile SHALL map the subject to RIM Mapping.

**Text**: 

**Context**: 

**Actor**: USCoreSpecimenProfile

**Conformance**: SHALL

# Test Specification for REQ-234

## 1. Requirement ID
REQ-234

## 2. Requirement Analysis

### Testability Assessment
**Not testable** - This requirement is too vague and appears to be covered by the FHIR validator. The requirement states that "USCoreSpecimenProfile SHALL map the subject to RIM Mapping" but provides insufficient detail about:
- What specific RIM mapping is expected
- What constitutes successful mapping
- How to verify the mapping implementation

RIM (Reference Information Model) mappings are typically structural annotations in FHIR profiles that indicate how FHIR elements correspond to HL7 v3 RIM concepts. These mappings are:
1. Defined at the profile level, not runtime behavior
2. Validated through profile conformance checking
3. Not operationally testable through FHIR API interactions

### Complexity
**Simple** - If this were testable, it would be a straightforward profile validation check.

### Prerequisites
- US Core Specimen Profile implementation
- FHIR validator with US Core profiles
- Understanding of RIM mapping requirements (currently undefined in the requirement)

## 3. Test Implementation Strategy

### Required Inputs
Since this requirement is not testable through operational FHIR API calls, no specific test inputs can be defined. If this requirement were to be made testable, it would need:
- Clarification of the specific RIM mapping requirements for the subject element
- Definition of validation criteria for the mapping
- Specification of how the mapping should be verified

### Required FHIR Operations
**None** - RIM mappings are structural profile features, not operational behaviors that can be tested through FHIR API operations supported by the Capability Statement.

### Validation Criteria
**Cannot be defined** due to insufficient requirement specification. 

## Recommendations for Requirement Refinement

To make this requirement testable, it should be refined to specify:

1. **Specific RIM mapping details**: What RIM class/attribute should the subject element map to?
2. **Validation method**: Should this be verified through:
   - Profile metadata inspection?
   - Specific mapping annotations?
   - Behavioral testing of subject handling?
3. **Success criteria**: What constitutes a successful mapping implementation?
4. **Failure conditions**: What would indicate non-conformance?

**Alternative approach**: If the intent is to ensure that US Core Specimen resources have valid subject references, this should be rewritten as a profile conformance requirement that can be validated through:
- FHIR resource validation against the US Core Specimen profile
- Verification that subject references resolve to valid US Core Patient resources
- Testing subject element population and reference integrity

---

<a id='req-235'></a>

### REQ-235: The USCoreSpecimenProfile SHALL map the receivedTime to RIM Mapping.

**Text**: 

**Context**: 

**Actor**: USCoreSpecimenProfile

**Conformance**: SHALL

# Test Specification for REQ-235

## 1. Requirement ID
**REQ-235**: USCoreSpecimenProfile SHALL map the receivedTime to RIM Mapping

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Not testable via automated testing - this is a **validator-covered requirement**.

**Rationale**: This requirement mandates that the USCoreSpecimenProfile must map the `receivedTime` element to the Reference Information Model (RIM). RIM mappings are structural metadata that define how FHIR elements correspond to HL7 v3 RIM entities. These mappings are:
- Embedded in the profile definition itself as metadata
- Validated by FHIR validators during profile validation
- Not observable through runtime API interactions
- Static implementation guide conformance rather than dynamic system behavior

### Complexity
**Simple** - The requirement is straightforward but relates to profile definition rather than system behavior.

### Prerequisites
- Access to the USCoreSpecimenProfile definition
- FHIR validator capable of profile validation
- Understanding that this is a profile conformance requirement, not a runtime system requirement

## 3. Test Implementation Strategy

### Required Inputs
**Note**: This requirement cannot be tested through API interactions as it pertains to profile metadata.

**For Profile Validation Approach**:
- USCoreSpecimenProfile definition (StructureDefinition resource)
- FHIR validator tool
- Any Specimen resource instances claiming conformance to USCoreSpecimenProfile

### Required FHIR Operations
**None** - This requirement does not involve API operations as it relates to profile definition metadata rather than system behavior.

**Rationale**: The US Core Server CapabilityStatement focuses on RESTful operations and resource interactions, but RIM mappings are structural metadata within profile definitions that are not exposed through API operations.

### Validation Criteria

Since this requirement cannot be tested through automated system testing, the following validation approach is recommended:

#### Profile Definition Validation
1. **RIM Mapping Presence Check**: Verify that the USCoreSpecimenProfile StructureDefinition includes RIM mapping metadata for the `receivedTime` element
2. **Mapping Completeness**: Confirm that the RIM mapping is properly defined and references appropriate RIM entities
3. **Profile Validator Check**: Use FHIR validators to ensure the profile definition is valid and includes required mappings

#### Alternative Validation Approach
**Attestation-Based Verification**: 
- Implementation teams should attest that their USCoreSpecimenProfile implementation includes proper RIM mappings for `receivedTime`
- Profile definitions should be reviewed during implementation guide compliance reviews
- Documentation review to confirm RIM mappings are properly documented in the profile

### Recommendation
This requirement should be:
1. **Validated during profile development** rather than system testing
2. **Verified through implementation guide compliance reviews**
3. **Confirmed via FHIR validator tools** that check profile definitions
4. **Documented as an attestation requirement** for implementations claiming US Core conformance

The requirement ensures proper semantic mapping between FHIR and HL7 v3 RIM but does not impact runtime system behavior or API interactions covered by the US Core Server CapabilityStatement.

---

<a id='req-236'></a>

### REQ-236: The USCoreSpecimenProfile SHALL map the request to RIM Mapping.

**Text**: 

**Context**: 

**Actor**: USCoreSpecimenProfile

**Conformance**: SHALL

# Test Specification for REQ-236

## 1. Requirement ID
REQ-236

## 2. Requirement Analysis

### Testability Assessment
**Not Testable** - This requirement is covered by the FHIR validator and is too vague for specific interoperability testing.

### Complexity
**Simple** - The requirement relates to structural mapping definition rather than operational behavior.

### Prerequisites
- US Core Server implementing USCoreSpecimenProfile
- FHIR validation tools capable of checking RIM mappings
- Access to the US Core Implementation Guide specification documents

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Any valid Specimen resources conforming to USCoreSpecimenProfile
- **Expected Outputs**: Validation confirmation that RIM mappings are properly defined and accessible

### Required FHIR Operations
Based on the Capability Statement, the following operations are relevant:
- **GET** operations to retrieve Specimen resources (if supported by the server)
- **Metadata retrieval** to verify profile declarations in `meta.profile` attributes

### Validation Criteria

This requirement cannot be meaningfully tested through operational FHIR API testing because:

1. **Structural Validation Scope**: RIM mapping verification is a structural validation concern handled by FHIR validators, not an interoperability test case.

2. **Implementation Guide Compliance**: The mapping requirements are satisfied by the Implementation Guide authors during profile development, not by implementers during runtime.

3. **No Observable Behavior**: There are no specific API behaviors, response formats, or data transformations that can be tested to verify RIM mapping compliance.

### Recommended Alternative Approach

Instead of operational testing, this requirement should be addressed through:

1. **Static Analysis**: Verify that the USCoreSpecimenProfile definition includes proper RIM mapping elements in the StructureDefinition
2. **Documentation Review**: Confirm that RIM mappings are documented in the Implementation Guide
3. **Validator Testing**: Use FHIR validation tools to ensure Specimen instances validate against the profile with proper mapping awareness

### Test Case Attestation

Given the nature of this requirement, implementers should provide **attestation** that:
- Their Specimen resources conform to the USCoreSpecimenProfile
- They understand the RIM mapping implications as documented in the US Core IG
- Their FHIR validation processes include profile conformance checking

**Note**: This requirement does not translate to executable interoperability test cases but rather represents a profile design constraint that is verified through specification compliance and validation tooling.

---

<a id='req-237'></a>

### REQ-237: The USCoreSpecimenProfile SHALL map the collection to RIM Mapping.

**Text**: 

**Context**: 

**Actor**: USCoreSpecimenProfile

**Conformance**: SHALL

# Test Specification for REQ-237

## 1. Requirement ID
**REQ-237**: The USCoreSpecimenProfile SHALL map the collection to RIM Mapping

## 2. Requirement Analysis

### Testability Assessment: 
**Not Testable** - This requirement is covered by the FHIR validator and structural definition validation. RIM (Reference Information Model) mappings are metadata annotations in the FHIR profile definition that describe how FHIR elements conceptually map to HL7 v3 RIM classes and attributes. These mappings are:
- Declarative metadata embedded in the StructureDefinition
- Validated automatically by FHIR validation tools
- Not runtime-testable through API interactions
- Used for semantic understanding and implementation guidance rather than operational conformance

### Complexity: 
**Simple** - The mapping verification is a structural validation task

### Prerequisites:
- Access to the US Core Specimen Profile StructureDefinition
- FHIR validation tools capable of validating profile conformance
- Understanding that this is a profile definition requirement, not a runtime API requirement

## 3. Test Implementation Strategy

### Required Inputs:
- US Core Specimen Profile StructureDefinition (StructureDefinition-us-core-specimen.html)
- FHIR validation tools or capabilities

### Required FHIR Operations:
**None** - This requirement does not involve API operations. Based on the Capability Statement, the Specimen resource supports:
- GET operations by `_id` and `patient` search parameters
- However, the RIM mapping requirement is about the profile definition itself, not runtime behavior

### Validation Criteria:

**Primary Validation:**
This requirement should be verified through **structural validation of the profile definition** rather than runtime testing:

1. **Profile Definition Validation:**
   - Verify that the US Core Specimen Profile StructureDefinition contains appropriate RIM mappings for the `collection` element
   - Confirm that the mapping annotations are present and correctly formatted in the profile definition
   - Validate that the mappings align with HL7 v3 RIM specifications

**Alternative Validation Approach:**
If runtime validation is required, the test should focus on **profile conformance validation**:

1. **Instance Validation:**
   - Retrieve or create Specimen instances that claim conformance to US Core Specimen Profile
   - Validate these instances against the US Core Specimen Profile using a FHIR validator
   - Confirm that instances with `collection` elements are successfully validated
   - Verify that the validator processes the RIM mapping metadata without errors

**Test Assertion:**
- **PASS**: The US Core Specimen Profile StructureDefinition contains valid RIM mappings for the collection element, and FHIR validation tools can successfully process these mappings when validating Specimen instances
- **FAIL**: RIM mappings are missing, malformed, or cause validation errors

**Note:** This requirement is primarily a **profile definition conformance requirement** rather than an **API interoperability requirement**. The actual testing should focus on validating that the profile definition correctly includes the required RIM mappings, which is typically handled by FHIR profile validation tools rather than API-level testing.

---

<a id='req-238'></a>

### REQ-238: The USCoreSpecimenProfile SHALL map the collector to RIM Mapping.

**Text**: 

**Context**: 

**Actor**: USCoreSpecimenProfile

**Conformance**: SHALL

# Test Specification for REQ-238

## 1. Requirement ID
REQ-238

## 2. Requirement Analysis

### Testability Assessment
**Not Testable** - This requirement is too vague and lacks sufficient technical detail to create a meaningful automated test. The requirement states that the USCoreSpecimenProfile "SHALL map the collector to RIM Mapping" but provides no specific details about:
- What specific RIM mapping elements are required
- What the expected mapping structure should be
- How to verify the mapping exists or is correct
- What constitutes conformance to this mapping requirement

This type of structural mapping requirement is typically validated by the FHIR validator during profile validation rather than through interoperability testing.

### Complexity
**Simple** - While not testable as an interoperability requirement, the underlying concept is straightforward - it relates to ensuring proper RIM mapping metadata exists in the profile definition.

### Prerequisites
- Access to US Core Specimen Profile definition
- FHIR validator capable of profile validation
- Understanding of HL7 RIM mapping requirements

## 3. Test Implementation Strategy

### Required Inputs
This requirement cannot be meaningfully tested through interoperability testing as it relates to profile design and mapping metadata rather than runtime behavior.

### Required FHIR Operations
None - This requirement pertains to profile metadata rather than API operations.

### Validation Criteria
**Alternative Validation Approach:**
Since this requirement cannot be tested through interoperability testing, validation should instead focus on:

1. **Profile Validation**: Verify that US Core Specimen Profile instances validate successfully against the profile using a FHIR validator
2. **Mapping Documentation Review**: Manual review of the profile definition to ensure RIM mapping elements are properly documented for the collector field
3. **Structural Validation**: Ensure that any Specimen resources claiming conformance to the US Core Specimen Profile include the `meta.profile` declaration as recommended in the Capability Statement

**Recommended Test Alternative:**
Instead of testing the mapping requirement directly, implement a test that validates:
- Specimen resources can be successfully created and retrieved using the supported search parameters (`_id`, `patient`) as defined in the Capability Statement
- Specimen resources properly validate against the US Core Specimen Profile
- The collector field, when present, conforms to the expected data types and cardinality defined in the profile

**Note:** This requirement appears to be more appropriate for profile design validation rather than interoperability conformance testing. The actual mapping to RIM elements is handled at the profile definition level and validated by FHIR validators, not through API testing.

---

<a id='req-239'></a>

### REQ-239: The USCoreSpecimenProfile SHALL map the collected[x] to RIM Mapping.

**Text**: 

**Context**: 

**Actor**: USCoreSpecimenProfile

**Conformance**: SHALL

# Test Specification for REQ-239

## 1. Requirement ID
REQ-239

## 2. Requirement Analysis

### Testability Assessment
**Not Testable** - This requirement is too vague and lacks specific implementation details. The requirement states that "The USCoreSpecimenProfile SHALL map the collected[x] to RIM Mapping" but does not specify:
- What specific RIM mapping is expected
- How the mapping should be implemented or validated
- What constitutes conformant mapping behavior
- What observable behavior can be tested

RIM (Reference Information Model) mappings are typically metadata annotations in FHIR profiles that provide conceptual mappings to HL7 v3 RIM classes and are not directly testable through FHIR API interactions.

### Complexity
**Not Applicable** - Due to lack of testability

### Prerequisites
**Not Applicable** - Due to lack of testability

## 3. Test Implementation Strategy

### Required Inputs
**Not Applicable** - This requirement cannot be effectively tested as specified.

### Required FHIR Operations
**Not Applicable** - RIM mappings are not validated through FHIR operations.

### Validation Criteria
**Not Applicable** - No specific validation criteria can be established without clearer requirements.

## Recommendations

1. **Clarify Requirement Scope**: The requirement should specify what aspect of RIM mapping needs to be validated. For example:
   - Should the Specimen profile include specific RIM mapping annotations in the StructureDefinition?
   - Should the server respond with specific metadata that demonstrates RIM mapping compliance?
   - Are there specific data transformation rules based on RIM mappings that should be tested?

2. **Alternative Testable Requirements**: Consider replacing this requirement with more specific, testable requirements such as:
   - Validation that Specimen resources conform to the US Core Specimen Profile structure
   - Testing that the `collection.collected[x]` element is properly populated according to US Core requirements
   - Verification that Specimen resources can be successfully created, read, and searched using supported operations

3. **Reference Capability Statement**: The Capability Statement shows that Specimen resources support:
   - Search by `_id` and `patient` parameters
   - US Core Specimen Profile conformance
   - These capabilities could form the basis for more concrete, testable requirements

**Note**: If RIM mapping validation is truly required, the requirement needs significant clarification to specify what observable, testable behavior demonstrates conformant RIM mapping implementation.

---

<a id='req-240'></a>

### REQ-240: The USCoreSpecimenProfile SHALL map the quantity to RIM Mapping.

**Text**: 

**Context**: 

**Actor**: USCoreSpecimenProfile

**Conformance**: SHALL

# Test Specification for REQ-240

## 1. Requirement ID
REQ-240

## 2. Requirement Analysis

### Testability Assessment
**Classification: Not testable due to being too vague**

**Rationale:**
- The requirement states that "USCoreSpecimenProfile SHALL map the quantity to RIM Mapping" but lacks sufficient detail to create meaningful test cases
- No specific quantity field is identified within the US Core Specimen profile
- The expected RIM mapping target or validation criteria are not specified
- RIM (Reference Information Model) mappings are typically structural/conceptual mappings rather than runtime behaviors that can be tested through FHIR API interactions
- This appears to be a documentation/modeling requirement rather than an implementable conformance requirement

### Complexity
**Not Applicable** - Cannot be tested as specified

### Prerequisites
**Not Applicable** - Cannot be tested as specified

## 3. Test Implementation Strategy

### Required Inputs
**Not Applicable** - This requirement cannot be implemented as a practical test case due to insufficient specification.

### Required FHIR Operations
**Not Applicable** - No testable FHIR operations can be derived from this requirement.

### Validation Criteria
**Not Applicable** - No specific validation criteria can be established.

## Recommendations for Requirement Clarification

To make this requirement testable, the following clarifications would be needed:

1. **Specify the quantity field**: Which specific quantity element in the US Core Specimen profile needs RIM mapping validation?

2. **Define the expected mapping**: What is the specific RIM element or structure that the quantity should map to?

3. **Clarify the validation approach**: 
   - Should this be validated through profile metadata?
   - Should this be tested through specific API responses?
   - Is this a structural validation that should be handled by FHIR validators?

4. **Provide concrete acceptance criteria**: What observable behavior or response would indicate successful mapping compliance?

Without these clarifications, this requirement falls into the category of structural/documentation requirements that are typically validated through FHIR profile validators rather than through interoperability testing scenarios.

---

<a id='req-241'></a>

### REQ-241: The USCoreSpecimenProfile SHALL map the method to RIM Mapping.

**Text**: 

**Context**: 

**Actor**: USCoreSpecimenProfile

**Conformance**: SHALL

# Test Specification for REQ-241

## 1. Requirement ID
REQ-241

## 2. Requirement Analysis

### Testability Assessment
**Not testable due to being too vague**

The requirement "The USCoreSpecimenProfile SHALL map the method to RIM Mapping" lacks sufficient technical detail to create executable conformance tests. Key issues:
- Does not specify which "method" field is being referenced
- Does not define what constitutes proper "RIM Mapping"
- Does not provide testable criteria or expected mapping outcomes
- RIM mappings are typically structural/semantic annotations rather than runtime behaviors

### Complexity
**Simple** (if made testable)

If clarified, this would likely involve validating that specimen method elements contain appropriate RIM mapping annotations in the profile definition.

### Prerequisites
- Access to the USCoreSpecimenProfile definition
- Understanding of FHIR RIM mapping conventions
- Clarification of the specific mapping requirements

## 3. Test Implementation Strategy

### Required Inputs
**Cannot be determined** - The requirement lacks sufficient specification to identify:
- Which specimen method elements require RIM mapping
- What the expected RIM mapping values should be
- How to validate mapping correctness

### Required FHIR Operations
**None required** - RIM mappings are typically profile-level metadata, not runtime API operations. Based on the provided Capability Statement, no specific specimen-related operations are detailed.

### Validation Criteria
**Cannot be established** without requirement clarification. Potential criteria if clarified might include:
- Verify USCoreSpecimenProfile contains RIM mapping annotations for method elements
- Validate mapping syntax follows FHIR RIM mapping conventions
- Confirm mappings reference appropriate RIM classes/attributes

## Recommendation

This requirement needs significant clarification before it can be tested. Suggest requesting:

1. **Specific method identification**: Which Specimen.method field(s) require RIM mapping?
2. **Expected mapping values**: What RIM elements should be mapped to?
3. **Validation approach**: How should conformance be verified - profile inspection, instance validation, or runtime behavior?
4. **Success criteria**: What constitutes a "proper" RIM mapping?

Without these details, this requirement cannot be translated into executable conformance tests for healthcare interoperability validation.

---

<a id='req-242'></a>

### REQ-242: The USCoreSpecimenProfile SHALL map the bodySite to RIM Mapping.

**Text**: 

**Context**: 

**Actor**: USCoreSpecimenProfile

**Conformance**: SHALL

# Test Specification for REQ-242

## 1. Requirement ID
REQ-242

## 2. Requirement Analysis

### Testability Assessment
**Not testable** - This requirement is too vague and implementation-specific. The requirement states that "The USCoreSpecimenProfile SHALL map the bodySite to RIM Mapping" but does not specify:
- What specific RIM mapping is expected
- How the mapping should be validated
- What constitutes a conformant mapping
- Whether this is a structural mapping in the profile definition or a runtime mapping requirement

This appears to be a profile design requirement rather than an implementable system behavior that can be tested through FHIR operations.

### Complexity
**Not Applicable** - Cannot be tested as specified

### Prerequisites
**Not Applicable** - Requirement cannot be implemented as a test

## 3. Test Implementation Strategy

### Required Inputs
**Not Applicable** - This requirement cannot be translated into a testable specification without significant clarification.

### Required FHIR Operations
**Not Applicable** - No FHIR operations can be identified for testing this requirement.

### Validation Criteria
**Not Applicable** - No validation criteria can be established without clearer requirement definition.

## Recommendations

This requirement should be:

1. **Clarified** to specify exactly what RIM mapping is expected and how it should be validated
2. **Refined** to indicate whether this is:
   - A profile structure requirement (testable via FHIR validator)
   - A terminology mapping requirement (testable via specific value mappings)
   - A documentation requirement (attestation-based)
3. **Supplemented** with specific acceptance criteria that define what constitutes conformant behavior

**Alternative Interpretation**: If this requirement is intended to verify that Specimen resources conform to the US Core Specimen profile including proper use of the bodySite element, then the test would be:

### Alternative Test Strategy (If Requirement is Profile Conformance)

**Required Inputs**: 
- Specimen resources with bodySite elements populated

**Required FHIR Operations**:
- `GET /Specimen` or `GET /Specimen/{id}` (supported per US Core Server capabilities)

**Validation Criteria**:
- Specimen resources validate against US Core Specimen profile
- bodySite elements conform to expected value sets and cardinality constraints as defined in the profile

However, this interpretation would make the requirement redundant with general profile validation requirements.

---

<a id='req-243'></a>

### REQ-243: The USCoreSpecimenProfile SHALL map the processing to RIM Mapping.

**Text**: 

**Context**: 

**Actor**: USCoreSpecimenProfile

**Conformance**: SHALL

# Test Specification for REQ-243

## 1. Requirement ID
REQ-243: USCoreSpecimenProfile SHALL map the processing to RIM Mapping

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Not testable due to being too vague and covered by the validator

**Rationale**: This requirement refers to RIM (Reference Information Model) mapping, which is a structural mapping between FHIR elements and HL7 v3 RIM components. RIM mappings are definitional metadata included in FHIR profiles and are validated by FHIR validators during profile validation. The requirement lacks specific testable criteria for what constitutes proper "processing" mapping or how to verify the mapping programmatically through interoperability testing.

### Complexity
**Classification**: Not Applicable (N/A)

RIM mappings are structural metadata that exist at the profile definition level, not at the runtime interoperability level.

### Prerequisites
- N/A - This requirement cannot be tested through interoperability testing

## 3. Test Implementation Strategy

### Required Inputs
**Not applicable** - This requirement cannot be implemented as an interoperability test.

### Required FHIR Operations
**Not applicable** - No FHIR operations can test RIM mapping conformance.

### Validation Criteria
**Not applicable** - RIM mapping validation is handled by:
1. FHIR profile validators during development
2. Static analysis of the USCoreSpecimenProfile definition
3. Verification that the profile includes appropriate RIM mapping annotations

## Alternative Verification Approach

Since this requirement cannot be tested through interoperability testing, conformance should be verified through:

1. **Static Profile Analysis**: Review the USCoreSpecimenProfile definition to ensure RIM mapping elements are present for the processing field
2. **FHIR Validator**: Use official FHIR validators to validate that Specimen instances conform to the USCoreSpecimenProfile, which inherently includes RIM mapping validation
3. **Documentation Review**: Verify that implementation documentation references the appropriate RIM mappings for Specimen processing elements

## Recommendation

This requirement should be reclassified as a **design-time validation** rather than a runtime interoperability test. The actual interoperability testing should focus on functional requirements such as:
- Successful creation and retrieval of Specimen resources conforming to USCoreSpecimenProfile
- Proper handling of Must Support elements in Specimen resources
- Appropriate error handling for invalid Specimen data

---

<a id='req-244'></a>

### REQ-244: The USCoreSpecimenProfile SHALL map the description to RIM Mapping.

**Text**: 

**Context**: 

**Actor**: USCoreSpecimenProfile

**Conformance**: SHALL

# Test Specification for REQ-244

## 1. Requirement ID
**REQ-244**: USCoreSpecimenProfile SHALL map the description to RIM Mapping

## 2. Requirement Analysis

### Testability Assessment
**Not testable** - This requirement is covered by the FHIR validator and structural definition validation. RIM (Reference Information Model) mappings are metadata annotations within the FHIR StructureDefinition that define how FHIR elements map to the underlying HL7 RIM model. These mappings are:
- Defined at the profile specification level, not at runtime
- Validated through structural conformance checking
- Not something that can be tested through API interactions or data exchange

### Complexity
**N/A** - Requirement is not testable through interoperability testing

### Prerequisites
**N/A** - Requirement is not testable through interoperability testing

## 3. Test Implementation Strategy

### Required Inputs
**N/A** - This requirement cannot be tested through interoperability testing as RIM mappings are structural metadata within the profile definition itself, not runtime data elements.

### Required FHIR Operations
**N/A** - No FHIR operations can validate RIM mappings during runtime interactions.

### Validation Criteria
**N/A** - RIM mapping validation is performed by:
1. **FHIR Validator**: Structural validation tools that check profile definitions against FHIR specification requirements
2. **Profile Definition Review**: Manual or automated review of the US Core Specimen Profile StructureDefinition to verify that appropriate RIM mappings are present in the profile metadata

### Recommendation
This requirement should be validated through:
1. **Static Analysis**: Review the US Core Specimen Profile StructureDefinition JSON/XML to verify RIM mapping elements are present
2. **FHIR Validator**: Use official FHIR validation tools to ensure the profile conforms to FHIR specification requirements for RIM mappings
3. **Implementation Guide Validation**: Verify the published Implementation Guide includes proper RIM mapping documentation

**Note**: This requirement is a structural/definitional conformance requirement rather than an interoperability testing requirement. It should be addressed during profile development and validation phases, not during system-to-system interoperability testing.

---

<a id='req-245'></a>

### REQ-245: The USCoreSpecimenProfile SHALL map the procedure to RIM Mapping.

**Text**: 

**Context**: 

**Actor**: USCoreSpecimenProfile

**Conformance**: SHALL

# Test Specification for REQ-245

## 1. Requirement ID
**REQ-245**: USCoreSpecimenProfile SHALL map the procedure to RIM Mapping

## 2. Requirement Analysis

### Testability Assessment
**Not testable** - This requirement is too vague and implementation-internal to be meaningfully tested for interoperability conformance. The requirement refers to RIM (Reference Information Model) mapping, which is:
- An internal implementation detail of how FHIR resources are conceptually mapped to the HL7 v3 RIM
- Not exposed through FHIR API interactions
- Not verifiable through standard FHIR operations
- Primarily a specification design concern rather than an interoperability requirement

### Complexity
**Not Applicable** - Cannot be tested as specified

### Prerequisites
**Not Applicable** - Cannot be tested as specified

## 3. Test Implementation Strategy

### Required Inputs
**Not Applicable** - This requirement cannot be tested through standard FHIR interoperability testing methods.

### Required FHIR Operations
**Not Applicable** - RIM mappings are not exposed through FHIR RESTful operations.

### Validation Criteria
**Not Applicable** - No testable validation criteria can be established for internal RIM mappings.

---

## Recommendation

This requirement should be:

1. **Reclassified as a design/specification requirement** rather than a testable implementation requirement
2. **Marked as "Not Testable"** in the context of interoperability conformance testing
3. **Reviewed for clarity** - if there are specific interoperability behaviors expected from the USCoreSpecimenProfile related to procedure handling, those should be explicitly stated as separate, testable requirements

If the intent is to test that the USCoreSpecimenProfile properly handles procedure-related data elements, the requirement should be rewritten to specify:
- Which specific data elements must be supported
- How procedure information should be represented in the Specimen resource
- What validation rules apply to procedure-related fields
- Expected behavior when retrieving or searching Specimen resources with procedure information

---

<a id='req-246'></a>

### REQ-246: The USCoreSpecimenProfile SHALL map the additive to RIM Mapping.

**Text**: 

**Context**: 

**Actor**: USCoreSpecimenProfile

**Conformance**: SHALL

# Test Specification for REQ-246

## Requirement ID
REQ-246

## Requirement Analysis

### Testability Assessment
**Not Testable** - This requirement is too vague and lacks sufficient technical detail for implementation. The requirement states that "The USCoreSpecimenProfile SHALL map the additive to RIM Mapping" but does not specify:
- What specific mapping elements are required
- The expected RIM mapping format or structure
- How to verify the mapping exists or is correct
- What constitutes compliance with this mapping requirement

This appears to be a documentation/specification requirement rather than an implementable interoperability requirement that can be tested through FHIR API interactions.

### Complexity
**Not Applicable** - Cannot assess complexity due to insufficient requirement definition.

### Prerequisites
**Not Applicable** - Cannot determine prerequisites due to vague requirement specification.

## Test Implementation Strategy

### Required Inputs
**Not Applicable** - This requirement cannot be tested as specified due to lack of clear, actionable criteria.

### Required FHIR Operations
**Not Applicable** - No specific FHIR operations can be identified from this requirement.

### Validation Criteria
**Not Applicable** - Cannot establish validation criteria without clear requirement specifications.

## Recommendations for Requirement Clarification

To make this requirement testable, the following clarifications would be needed:

1. **Specific Mapping Requirements**: Define exactly what elements in the US Core Specimen Profile must be mapped to RIM and how
2. **Validation Method**: Specify how the mapping can be verified (e.g., through profile definition inspection, resource instance validation, etc.)
3. **Success Criteria**: Define what constitutes a successful mapping implementation
4. **Technical Details**: Provide the expected RIM mapping structure or reference standard

## Alternative Testing Approach

If this requirement is intended to ensure that US Core Specimen Profile instances conform to expected RIM mappings, a more testable approach would be:

1. **Profile Validation**: Verify that Specimen resources conform to the US Core Specimen Profile structure
2. **Element Presence**: Confirm that required additive-related elements are present and properly formatted
3. **Data Type Compliance**: Validate that additive elements use appropriate FHIR data types as specified in the profile

However, without clearer requirement definition, no specific test implementation can be provided.

---

<a id='req-247'></a>

### REQ-247: The USCoreSpecimenProfile SHALL map the time[x] to RIM Mapping.

**Text**: 

**Context**: 

**Actor**: USCoreSpecimenProfile

**Conformance**: SHALL

# Test Specification for REQ-247

## 1. Requirement ID
**REQ-247**: USCoreSpecimenProfile SHALL map the time[x] to RIM Mapping

## 2. Requirement Analysis

### Testability Assessment
**Not Testable** - This requirement is covered by the FHIR validator and does not require interoperability testing.

**Rationale**: 
- RIM (Reference Information Model) mappings are structural metadata annotations within FHIR profiles that define how FHIR elements correspond to HL7 RIM concepts
- These mappings are declarative metadata included in the StructureDefinition and are validated by FHIR validation tools
- RIM mappings do not affect runtime behavior, data exchange, or API interactions
- The presence and correctness of RIM mappings in the USCoreSpecimenProfile would be verified during profile validation, not during interoperability testing

### Complexity
**N/A** - Not applicable for interoperability testing

### Prerequisites
**N/A** - Not applicable for interoperability testing

## 3. Test Implementation Strategy

### Required Inputs
**N/A** - This requirement does not require interoperability testing as it pertains to profile metadata that is validated by FHIR validation tools.

### Required FHIR Operations
**N/A** - No API operations are needed to test RIM mapping compliance.

### Validation Criteria
**N/A** - RIM mapping validation is handled by:
- FHIR StructureDefinition validation tools
- Profile compliance validators
- Implementation Guide publishing tools

## Summary

This requirement addresses structural metadata within the FHIR profile definition rather than runtime interoperability behavior. The RIM mapping for the `time[x]` element in the USCoreSpecimenProfile is a declarative annotation that:

1. Documents the conceptual relationship between FHIR elements and HL7 RIM concepts
2. Is included in the profile's StructureDefinition
3. Is validated during profile development and validation processes
4. Does not impact data exchange or API behavior

**Recommendation**: This requirement should be verified through profile validation tools during the implementation guide development process rather than through interoperability testing scenarios.

---

<a id='req-248'></a>

### REQ-248: The USCoreSpecimenProfile SHALL map the container to RIM Mapping.

**Text**: 

**Context**: 

**Actor**: USCoreSpecimenProfile

**Conformance**: SHALL

# Test Specification for REQ-248

## 1. Requirement ID
REQ-248

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Not testable due to being too vague

**Rationale**: 
- The requirement states that "USCoreSpecimenProfile SHALL map the container to RIM Mapping" but provides no specific text, context, or detailed requirements
- RIM (Reference Information Model) mappings are typically structural metadata annotations within FHIR profiles that map FHIR elements to HL7 v3 RIM classes and attributes
- These mappings are design-time artifacts embedded in the StructureDefinition and are not runtime behaviors that can be tested through FHIR API interactions
- Without specific mapping requirements or expected RIM class/attribute targets, there are no concrete validation criteria to test against

### Complexity
**Not Applicable** - Requirement cannot be meaningfully tested in its current form

### Prerequisites
**Not Applicable** - No testable implementation requirements can be derived

## 3. Test Implementation Strategy

### Required Inputs
**Not Applicable** - This requirement cannot be translated into executable test cases

### Required FHIR Operations
**Not Applicable** - RIM mappings are not validated through FHIR API operations

### Validation Criteria
**Not Applicable** - No specific validation criteria can be established

## Recommendation

This requirement needs clarification and additional detail to become testable. Consider the following approaches:

1. **If this is about profile compliance**: The requirement should specify which elements of the US Core Specimen Profile's container field should have RIM mappings and what those mappings should be. This would then be validated by examining the StructureDefinition metadata rather than through API testing.

2. **If this is about data transformation**: The requirement should specify how specimen container data should be transformed or represented according to RIM principles, with concrete examples of input/output formats.

3. **If this is about semantic interoperability**: The requirement should specify the expected terminologies, value sets, or coding systems that should be used for container-related elements to ensure RIM-compliant semantic mapping.

**Current Status**: This requirement should be returned to the specification authors for clarification before test implementation can proceed.

---

<a id='req-249'></a>

### REQ-249: The USCoreSpecimenProfile SHALL map the container identifier to RIM Mapping.

**Text**: 

**Context**: 

**Actor**: USCoreSpecimenProfile

**Conformance**: SHALL

# Test Specification for REQ-249

## 1. Requirement ID
REQ-249

## 2. Requirement Analysis

### Testability Assessment
**Not testable** - This requirement is too vague and lacks specific implementation details. The requirement states that "USCoreSpecimenProfile SHALL map the container identifier to RIM Mapping" but does not specify:
- Which specific container identifier field(s) need mapping
- What the expected RIM mapping should be
- How to verify the mapping exists or is correct
- What constitutes conformance to this mapping requirement

RIM (Reference Information Model) mappings are typically documentation artifacts that describe how FHIR elements conceptually relate to HL7 v3 RIM classes and attributes. These mappings are usually present in the StructureDefinition metadata and are not runtime-testable behaviors.

### Complexity
**N/A** - Cannot be tested as written

### Prerequisites
- Access to US Core Specimen Profile StructureDefinition
- Understanding of HL7 RIM mapping conventions
- Specimen resources that include container information

## 3. Test Implementation Strategy

### Required Inputs
This requirement cannot be tested with the current specification because:

1. **Ambiguous Mapping Target**: The requirement doesn't specify which container identifier element(s) in the US Core Specimen Profile need RIM mapping
2. **Undefined Success Criteria**: No criteria provided for what constitutes a valid or correct RIM mapping
3. **Documentation vs. Runtime**: RIM mappings are typically design-time documentation, not runtime-testable behaviors

### Required FHIR Operations
**None** - This requirement appears to be about profile documentation rather than API behavior

### Validation Criteria
**Cannot be defined** - The requirement lacks sufficient detail to create meaningful validation criteria

## Recommendation for Requirement Clarification

To make this requirement testable, it should be refined to specify:

1. **Specific Element**: Which container identifier field (e.g., `Specimen.container.identifier`, `Specimen.container.type`, etc.)
2. **Expected Mapping**: What RIM class/attribute the element should map to
3. **Verification Method**: How conformance should be validated (e.g., presence in StructureDefinition, specific mapping values)

### Example of Testable Alternative
"The US Core Specimen Profile SHALL include RIM mapping metadata for the `Specimen.container.identifier` element that maps to the RIM Entity.id attribute, and this mapping SHALL be present in the profile's StructureDefinition.snapshot.element[].mapping array."

This would allow testing by:
1. Retrieving the US Core Specimen Profile StructureDefinition
2. Locating the `Specimen.container.identifier` element definition
3. Verifying the presence of appropriate RIM mapping metadata
4. Confirming the mapping target matches the specified RIM attribute

**Current Status**: This requirement should be marked as **NON-TESTABLE** until further clarification is provided.

---

<a id='req-250'></a>

### REQ-250: The USCoreSpecimenProfile SHALL map the container description to RIM Mapping.

**Text**: 

**Context**: 

**Actor**: USCoreSpecimenProfile

**Conformance**: SHALL

# Test Specification for REQ-250

## 1. Requirement ID
REQ-250

## 2. Requirement Analysis

### Testability Assessment
**Not testable** - This requirement is too vague and lacks sufficient detail for implementation. The requirement states that "The USCoreSpecimenProfile SHALL map the container description to RIM Mapping" but does not specify:
- Which specific container description elements need mapping
- What the expected RIM mapping should be
- How to verify the mapping exists or is correct
- What constitutes conformance to this requirement

### Complexity
**Simple** - If properly specified, this would likely be a simple structural validation

### Prerequisites
- US Core Specimen Profile implementation
- Understanding of RIM (Reference Information Model) mappings
- Specimen resources with container information

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: Specimen resources conforming to the US Core Specimen Profile that contain container information
- **Expected Outputs**: Documentation or metadata showing RIM mappings for container description elements

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for Specimen resources:
- `GET /Specimen/{id}` - Read specimen resource
- `GET /Specimen?patient={patient-id}` - Search specimens by patient
- `GET /Specimen?_id={id}` - Search specimen by ID

### Validation Criteria
**This requirement cannot be properly tested without clarification of the following:**

1. **Specific Mapping Requirements**: What exact container description elements must be mapped to RIM?
2. **Mapping Location**: Where should the RIM mapping information be documented or accessible?
3. **Validation Method**: How can a test verify that the mapping exists and is correct?
4. **Success Criteria**: What constitutes a passing test for this requirement?

### Recommended Actions
1. **Requirement Clarification Needed**: Request specification of:
   - Specific container description fields requiring RIM mapping
   - Expected RIM mapping format or location
   - Testable success criteria

2. **Alternative Testing Approach**: If RIM mappings are embedded in the profile definition:
   - Validate that US Core Specimen Profile includes appropriate RIM mapping annotations
   - Verify specimen instances conform to the profile structure
   - Check that container-related elements are properly structured according to profile constraints

### Implementation Note
This requirement appears to be more about profile design and documentation rather than runtime behavior testing. It may be better addressed through:
- Static analysis of the US Core Specimen Profile definition
- Documentation review of RIM mappings
- Profile validation rather than instance testing

**Status**: Requires requirement clarification before test implementation can proceed.

---

<a id='req-251'></a>

### REQ-251: The USCoreSpecimenProfile SHALL map the container type to RIM Mapping.

**Text**: 

**Context**: 

**Actor**: USCoreSpecimenProfile

**Conformance**: SHALL

# Test Specification for REQ-251

## Requirement ID
REQ-251

## Requirement Analysis

### Testability Assessment
**Not Testable** - This requirement is too vague and lacks specific implementation details. The requirement mentions "SHALL map the container type to RIM Mapping" but does not specify:
- What specific container type elements need to be mapped
- What the expected RIM mapping should be
- How to verify that the mapping is correctly implemented
- What constitutes a valid or invalid mapping

This appears to be a documentation or design requirement rather than a testable interoperability requirement. RIM mappings are typically informational metadata included in FHIR profiles for implementer guidance and are not enforced by FHIR validators or testable through API interactions.

### Complexity
**Not Applicable** - Due to lack of testable criteria

### Prerequisites
**Not Applicable** - Due to lack of testable criteria

## Test Implementation Strategy

### Assessment
This requirement cannot be meaningfully tested for the following reasons:

1. **Ambiguous Scope**: The requirement does not specify which container type elements in the USCoreSpecimenProfile need RIM mapping verification.

2. **Missing Success Criteria**: There are no defined criteria for what constitutes a correct or incorrect RIM mapping.

3. **No Interoperability Impact**: RIM mappings are informational annotations that do not affect FHIR resource validation, API behavior, or system interoperability.

4. **Capability Statement Gap**: The Specimen resource is listed in the capability statement with minimal search parameters (`_id`, `patient`) but no operations or requirements that would relate to RIM mapping validation.

### Recommended Actions

1. **Requirement Clarification**: Request clarification from the Implementation Guide authors on:
   - Specific container type elements that require RIM mapping
   - Expected RIM mapping values or patterns
   - Testable criteria for validation

2. **Alternative Verification**: If RIM mapping is critical, consider:
   - Static analysis of the StructureDefinition for presence of mapping elements
   - Documentation review rather than runtime testing
   - Profile validation using FHIR validation tools

3. **Focus on Testable Requirements**: Prioritize testing other USCoreSpecimenProfile requirements that have clear validation criteria and interoperability impact.

### Required FHIR Operations
**None** - No testable operations can be defined without clearer requirements.

### Validation Criteria
**None** - No validation criteria can be established without specific mapping requirements and success criteria.

---

**Note**: This requirement should be reviewed and refined by the Implementation Guide authors to provide specific, testable criteria if RIM mapping validation is truly necessary for conformance testing.

---

<a id='req-252'></a>

### REQ-252: The USCoreSpecimenProfile SHALL map the container capacity to RIM Mapping.

**Text**: 

**Context**: 

**Actor**: USCoreSpecimenProfile

**Conformance**: SHALL

# Test Specification for REQ-252

## 1. Requirement ID
REQ-252

## 2. Requirement Analysis

### Testability Assessment
**Not testable due to being too vague**

The requirement as stated is extremely vague and lacks sufficient detail for implementation:
- "SHALL map the container capacity to RIM Mapping" does not specify what constitutes proper mapping
- No definition of what "RIM Mapping" means in this context
- No specification of expected mapping format, structure, or validation criteria
- The requirement text field is empty, providing no additional clarification
- No clear success/failure criteria can be derived from the requirement statement

### Complexity
**Not Applicable** - Cannot assess complexity due to insufficient requirement specification

### Prerequisites
**Cannot be determined** - Prerequisites cannot be established without clear requirement definition

## 3. Test Implementation Strategy

### Required Inputs
**Cannot be specified** - Due to the vague nature of the requirement, specific inputs cannot be determined

### Required FHIR Operations
**Cannot be determined** - The requirement does not specify any testable FHIR operations or interactions

### Validation Criteria
**Cannot be established** - No measurable validation criteria can be derived from the current requirement statement

## Recommendations for Requirement Clarification

To make this requirement testable, the following information would need to be provided:

1. **Clear Definition**: What specifically constitutes "mapping the container capacity to RIM Mapping"?
2. **Mapping Specification**: What is the expected format, structure, or standard for this mapping?
3. **Validation Criteria**: How can conformance to this mapping requirement be verified?
4. **Context**: What FHIR elements, profiles, or resources are involved in this mapping?
5. **Success Criteria**: What specific conditions must be met for a system to pass this requirement?

## Conclusion

This requirement cannot be tested in its current form due to insufficient specification. It would require significant clarification and refinement before a meaningful test specification could be developed.

---

<a id='req-253'></a>

### REQ-253: The USCoreSpecimenProfile SHALL map the specimenQuantity to RIM Mapping.

**Text**: 

**Context**: 

**Actor**: USCoreSpecimenProfile

**Conformance**: SHALL

# Test Specification for REQ-253

## 1. Requirement ID
REQ-253

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Not testable due to being too vague

**Rationale**: This requirement is fundamentally untestable as written because:
- RIM (Reference Information Model) mappings are conceptual mappings used for documentation and semantic understanding, not runtime behavior
- There is no operational FHIR endpoint or interaction that can verify RIM mapping correctness
- The requirement lacks specific criteria for what constitutes proper "mapping" to RIM
- RIM mappings are typically validated through profile validation tools rather than runtime testing
- The specimenQuantity field mapping to RIM is a design-time consideration, not a runtime testable behavior

### Complexity
**Not Applicable** - Cannot be tested through automated means

### Prerequisites
**Not Applicable** - No testable implementation exists

## 3. Test Implementation Strategy

### Required Inputs
**Not Applicable** - This requirement cannot be implemented as an automated test

### Required FHIR Operations
**Not Applicable** - No FHIR operations can validate RIM mappings

### Validation Criteria
**Not Applicable** - No runtime validation criteria exist for RIM mappings

## Alternative Recommendations

Since this requirement cannot be tested through automated means, the following alternatives are recommended:

1. **Profile Validation**: Use FHIR validation tools to ensure US Core Specimen profiles are structurally correct and include proper RIM mapping annotations in the profile definition

2. **Documentation Review**: Manually verify that the US Core Specimen profile documentation includes appropriate RIM mapping information for the specimenQuantity element

3. **Requirement Clarification**: Consider revising this requirement to focus on testable behaviors such as:
   - Proper population of specimenQuantity fields in Specimen resources
   - Correct data type usage for quantity values
   - Adherence to US Core Specimen profile constraints

4. **Static Analysis**: Implement tooling to verify that profile definitions contain required RIM mapping metadata, though this would be a build-time rather than runtime test

**Conclusion**: This requirement should be reclassified as a design-time documentation requirement rather than a runtime conformance test, as RIM mappings are not operationally testable through FHIR API interactions.

---

<a id='req-254'></a>

### REQ-254: The USCoreSpecimenProfile SHALL map the additive[x] to RIM Mapping.

**Text**: 

**Context**: 

**Actor**: USCoreSpecimenProfile

**Conformance**: SHALL

# Test Specification for REQ-254

## 1. Requirement ID
REQ-254

## 2. Requirement Analysis

### Testability Assessment
**Not testable due to being too vague**

This requirement is not practically testable for the following reasons:
- The requirement references "RIM Mapping" but does not specify what the expected mapping should be
- No concrete mapping rules or expected values are provided
- RIM mappings are typically informational annotations in FHIR profiles rather than runtime behaviors
- The requirement lacks specific criteria for what constitutes a successful mapping

### Complexity
**Simple** (if testable criteria were provided)

### Prerequisites
- US Core Specimen Profile implementation
- Access to Specimen resources with additive[x] elements populated
- Understanding of the intended RIM mapping specification (not provided in requirement)

## 3. Test Implementation Strategy

### Required Inputs
**Note: This test cannot be implemented as specified due to insufficient requirement details. The following describes what would be needed if proper mapping criteria were provided.**

- **FHIR Resources**: Specimen resources conforming to US Core Specimen Profile
- **Data Requirements**: Specimen instances with various additive[x] element values populated
- **Configuration**: Access to the formal RIM mapping specification (not provided)

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported for Specimen resources:
- `GET /Specimen/{id}` - Retrieve specific specimen instances
- `GET /Specimen?patient={patient-id}` - Search specimens by patient
- `GET /Specimen?_id={specimen-id}` - Search specimens by ID

### Validation Criteria

**Current Status: Cannot be validated due to incomplete requirement specification**

If proper RIM mapping criteria were provided, validation would include:

1. **Profile Conformance**: Verify Specimen resources conform to US Core Specimen Profile
2. **Additive Element Presence**: Confirm additive[x] elements are populated when expected
3. **Mapping Validation**: Compare actual additive[x] values against expected RIM mapping rules (specification needed)

### Recommended Actions

To make this requirement testable, the following information must be provided:

1. **Specific RIM Mapping Rules**: Define exactly how additive[x] elements should map to RIM concepts
2. **Expected Values**: Provide examples of correct mappings
3. **Validation Criteria**: Specify how to determine if mapping is correct
4. **Scope Definition**: Clarify whether this is a structural profile requirement or a runtime behavior requirement

### Alternative Test Approach

If the intent is to verify that RIM mappings are properly documented in the profile:

1. **Static Analysis**: Review the US Core Specimen Profile StructureDefinition
2. **Mapping Verification**: Confirm that additive[x] elements include appropriate RIM mapping annotations
3. **Documentation Review**: Validate that mapping information is accessible to implementers

**Conclusion**: This requirement cannot be meaningfully tested in its current form and requires significant clarification before a practical test implementation can be developed.

---

<a id='req-255'></a>

### REQ-255: The USCoreSpecimenProfile SHALL map the note to RIM Mapping.

**Text**: 

**Context**: 

**Actor**: USCoreSpecimenProfile

**Conformance**: SHALL

# Test Specification for REQ-255

## 1. Requirement ID
REQ-255

## 2. Requirement Analysis

### Testability Assessment
**Not Testable** - This requirement is too vague and lacks sufficient detail to create a meaningful test. The requirement states that "USCoreSpecimenProfile SHALL map the note to RIM Mapping" but:
- Does not specify what "note" element needs to be mapped
- Does not provide the actual RIM mapping details
- Does not define what constitutes successful mapping
- RIM mappings are typically informational metadata in FHIR profiles, not functional requirements

### Complexity
**Not Applicable** - Due to insufficient specification detail

### Prerequisites
**Not Applicable** - Cannot determine prerequisites due to vague requirement

## 3. Test Implementation Strategy

### Required Inputs
**Cannot be determined** - The requirement lacks sufficient detail to specify test inputs

### Required FHIR Operations
**Cannot be determined** - The requirement does not specify functional behavior that can be tested through FHIR operations

### Validation Criteria
**Cannot be established** - The requirement is too vague to define specific validation criteria

## Recommendation

This requirement should be **clarified or removed** from the test suite because:

1. **Lacks Specificity**: The requirement does not identify which specific element in the US Core Specimen Profile needs RIM mapping validation
2. **Missing Implementation Details**: No information about what the RIM mapping should contain or how it should be structured
3. **Not Functionally Testable**: RIM mappings are typically informational annotations in FHIR profiles, not runtime behaviors that can be tested through API interactions
4. **Incomplete Source Information**: The source "Mappings for RIM Mapping" does not provide actionable testing criteria

### Suggested Actions:
1. **Clarify the requirement** to specify exactly which element(s) in the US Core Specimen Profile need RIM mapping
2. **Provide the expected RIM mapping content** that should be present
3. **Define success criteria** for what constitutes proper RIM mapping
4. **Consider if this is actually a profile validation concern** rather than an interoperability test requirement

If this requirement is intended to verify that the US Core Specimen Profile contains appropriate RIM mapping annotations, it would be better handled through static profile validation rather than dynamic testing.

---

<a id='req-326'></a>

### REQ-326: Import codes from specified value sets

**Text**: 

**Context**: ValueSet Logical Definition (CLD) for Specimen Condition

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-326

## 1. Requirement ID
REQ-326

## 2. Requirement Analysis

### Testability Assessment
**Not testable** - This requirement is too vague and lacks sufficient technical specificity for automated testing. The requirement states "Import codes from specified value sets" but:
- Does not specify which value sets should be supported
- Does not define what "import codes" means operationally
- Does not specify the mechanism for code importation
- Lacks clear success criteria for verification

### Complexity
**Not Applicable** - Cannot be classified due to insufficient requirement definition.

### Prerequisites
**Not Applicable** - Cannot be determined due to vague requirement specification.

## 3. Test Implementation Strategy

### Assessment
This requirement cannot be implemented as a practical test specification because:

1. **Lack of Technical Context**: The requirement mentions "ValueSet Logical Definition (CLD) for Specimen Condition" but provides no technical details about:
   - Which specific value sets are required
   - The expected format or structure of imported codes
   - The system behavior that should be tested

2. **Missing Operational Definition**: "Import codes from specified value sets" could mean:
   - Supporting ValueSet $expand operations
   - Pre-loading codes into a local terminology server
   - Supporting external value set references
   - Implementing specific code validation mechanisms

3. **No Clear Success Criteria**: Without knowing what constitutes successful "importation," no meaningful assertions can be defined.

### Recommended Actions
To make this requirement testable, the following clarifications are needed:

1. **Specify Target Value Sets**: Identify the exact value sets that must be supported for Specimen Condition
2. **Define Import Mechanism**: Specify whether this refers to:
   - ValueSet $expand operation support
   - Terminology service capabilities  
   - Code validation functionality
3. **Establish Verification Criteria**: Define measurable outcomes that indicate successful code importation
4. **Align with Capability Statement**: The current capability statement focuses on clinical data exchange but doesn't specify terminology service requirements that would support this use case

### Required Inputs
Cannot be determined without requirement clarification.

### Required FHIR Operations
Cannot be determined without requirement clarification.

### Validation Criteria
Cannot be established without clearer requirement definition.

**Note**: This requirement should be refined with specific technical details and aligned with the US Core Server Capability Statement before test implementation can proceed.

---

<a id='req-327'></a>

### REQ-327: Exclusion of specific codes

**Text**: 

**Context**: ValueSet Logical Definition (CLD) exclusion for Specimen Condition

**Actor**: System

**Conformance**: SHALL NOT

# Test Specification for REQ-327

## 1. Requirement ID
**REQ-327**: Exclusion of specific codes

## 2. Requirement Analysis

### Testability Assessment
**Not testable** - This requirement is too vague and lacks sufficient detail for implementation. The requirement mentions "Exclusion of specific codes" for "ValueSet Logical Definition (CLD) exclusion for Specimen Condition" but does not specify:
- Which specific codes should be excluded
- What ValueSet is being referenced
- What constitutes the "Specimen Condition" context
- What the expected behavior should be when excluded codes are encountered

### Complexity
**Cannot be determined** - Due to insufficient requirement specification

### Prerequisites
**Cannot be determined** - The requirement lacks enough detail to identify necessary system configurations, data, or setup requirements

## 3. Test Implementation Strategy

### Required Inputs
**Cannot be specified** - The requirement does not provide enough information to determine:
- Which FHIR resources are involved
- What specific ValueSet should be tested
- What codes should be excluded
- What the expected system behavior should be

### Required FHIR Operations
**Cannot be determined** - Without knowing the specific ValueSet or context, it's impossible to determine which FHIR operations would be needed to test this requirement.

### Validation Criteria
**Cannot be established** - The requirement lacks sufficient detail to define:
- What constitutes a passing test
- What specific assertions should be made
- What the expected vs. actual behavior comparison should be

## Recommendation

This requirement needs significant clarification before it can be tested. The requirement should be updated to include:

1. **Specific ValueSet identification**: Which ValueSet contains the codes that should be excluded?
2. **Code specification**: What are the specific codes that SHALL NOT be used?
3. **Context definition**: What is meant by "Specimen Condition" in this context?
4. **Expected behavior**: What should the system do when these excluded codes are encountered?
5. **FHIR resource context**: Which FHIR resources (likely Specimen) should be validated for this exclusion?

Without this information, this requirement cannot be transformed into an actionable test specification that would verify interoperability conformance.

---

<a id='req-532'></a>

### REQ-532: US Core Client SHALL fetch Specimen resources.

**Text**: 

**Context**: US Core Client read interaction for Specimen by id

**Actor**: US Core Client

**Conformance**: SHALL

# Test Specification for REQ-532

## 1. Requirement ID
**REQ-532**: US Core Client SHALL fetch Specimen resources

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be tested through automated FHIR REST API interactions to verify that a US Core Client can successfully perform read operations on Specimen resources.

### Complexity
**Simple** - This is a straightforward FHIR read interaction that requires basic REST API capability testing.

### Prerequisites
- US Core Server with Specimen resources available for testing
- Valid Specimen resource IDs for read operations
- Authentication credentials and appropriate scopes for accessing Specimen resources
- Client system configured to perform FHIR REST operations
- Network connectivity between client and server

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- At least one valid Specimen resource ID that exists on the target US Core Server
- Authentication token/credentials with appropriate read permissions

**Expected Outputs:**
- HTTP 200 OK response with valid Specimen resource in JSON format
- Specimen resource conforming to US Core Specimen profile requirements
- Appropriate HTTP headers including Content-Type: application/fhir+json

### Required FHIR Operations
Based on the Capability Statement analysis, the following operation is required:
- **GET [base]/Specimen/[id]** - Individual Specimen resource read operation

*Note: The Capability Statement confirms that US Core Servers SHALL support JSON format and individual resource read operations.*

### Validation Criteria

**Primary Success Criteria:**
1. **HTTP Response Validation:**
   - HTTP status code 200 (OK) for successful reads
   - Content-Type header indicates JSON format (application/fhir+json or application/json)
   - Valid JSON structure in response body

2. **FHIR Resource Validation:**
   - Response contains a valid Specimen resource
   - Resource has correct resourceType of "Specimen"
   - Resource ID matches the requested ID
   - Resource structure conforms to FHIR R4 Specimen resource definition

3. **US Core Profile Conformance:**
   - Specimen resource should conform to US Core Specimen profile requirements
   - Required elements per US Core Specimen profile are present
   - Data types and value sets align with US Core specifications

**Error Handling Validation:**
Based on the Capability Statement requirements, verify appropriate error responses:
- **HTTP 401**: Unauthorized request (invalid/missing authentication)
- **HTTP 403**: Insufficient scopes/forbidden access
- **HTTP 404**: Unknown/non-existent Specimen resource ID
- **HTTP 400**: Invalid parameter format

**Additional Conformance Checks:**
1. **Security Compliance:**
   - Verify that unauthorized requests are properly rejected
   - Confirm appropriate authentication mechanisms are enforced

2. **Format Support:**
   - JSON format support is mandatory (SHALL requirement)
   - XML format support is optional (SHOULD requirement)

**Test Cases to Implement:**

1. **Valid Read Test:**
   - Execute GET request for existing Specimen resource
   - Verify successful response and resource conformance

2. **Authentication Test:**
   - Execute GET request without proper authentication
   - Verify appropriate 401/403 error response

3. **Not Found Test:**
   - Execute GET request for non-existent Specimen ID
   - Verify HTTP 404 response

4. **Invalid Parameter Test:**
   - Execute GET request with malformed Specimen ID
   - Verify HTTP 400 response

**Success Indicators:**
- Client successfully retrieves Specimen resources when valid IDs are provided
- Client handles error scenarios appropriately per FHIR and US Core specifications
- All responses conform to expected HTTP status codes and content formats
- Retrieved Specimen resources validate against US Core Specimen profile requirements

---



<a id='subscription'></a>

## Subscription

<a id='req-485'></a>

### REQ-485: Servers must allow clients to create Subscriptions with filter criteria.

**Text**: 

**Context**: Subscriptions Backport IG – subscription creation and filter-criteria extension support

**Actor**: Server

**Conformance**: SHALL

# Test Specification for REQ-485

## 1. Requirement ID
**REQ-485**: Servers must allow clients to create Subscriptions with filter criteria.

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be tested through automated API interactions to verify that a server accepts Subscription creation requests with filter criteria and handles them appropriately.

### Complexity
**Moderate** - While the basic concept is straightforward, testing requires understanding of Subscription resources, filter criteria syntax, and validation of proper server behavior including error handling.

### Prerequisites
- Server must support the Subscription resource type with create operation
- Server must implement the Subscriptions Backport IG filter-criteria extension
- Test client must have appropriate authorization to create Subscription resources
- Server must have at least one supported resource type that can be filtered (based on the Capability Statement, this would include resources like Patient, Observation, Condition, etc.)
- Server must support webhook, REST-hook, or other subscription delivery mechanisms

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources Needed**: 
  - Valid Subscription resource instances with various filter criteria configurations
  - Target resources for subscription filtering (e.g., Patient, Observation resources based on server capabilities)
- **Test Data Requirements**:
  - Authentication credentials with Subscription create permissions
  - Valid webhook/callback URLs for subscription delivery
  - Filter criteria expressions appropriate for server-supported resources

### Required FHIR Operations
Based on the Capability Statement analysis, the following operations are required:

1. **POST [base]/Subscription** - Create subscription with filter criteria
2. **GET [base]/Subscription/[id]** - Read created subscription to verify filter criteria persistence
3. **Supporting resource operations** as needed:
   - Patient search operations (SHALL support search-type)
   - Observation search operations (SHALL support search-type)
   - Other resource searches based on filter targets

### Validation Criteria

#### Test Case 1: Basic Filter Criteria Creation
**Objective**: Verify server accepts Subscription with simple filter criteria

**Test Steps**:
1. Create a Subscription resource with:
   - Valid channel configuration (webhook/REST-hook)
   - Filter criteria targeting a server-supported resource (e.g., Patient)
   - Simple filter expression (e.g., `Patient?active=true`)
2. Submit POST request to create Subscription
3. Verify server responds with HTTP 201 Created
4. Read back created Subscription
5. Verify filter criteria are preserved in the stored resource

**Pass Criteria**:
- HTTP 201 response on creation
- Subscription ID returned in response
- Filter criteria correctly stored and retrievable
- No validation errors in response

#### Test Case 2: Multiple Filter Criteria
**Objective**: Verify server handles Subscriptions with multiple filter expressions

**Test Steps**:
1. Create Subscription with multiple filter criteria expressions
2. Use different supported resource types if available
3. Verify creation succeeds
4. Verify all filter criteria are preserved

**Pass Criteria**:
- Successful creation with HTTP 201
- All filter expressions preserved in stored resource
- Server accepts complex filter combinations

#### Test Case 3: Invalid Filter Criteria Handling
**Objective**: Verify server properly validates filter criteria syntax

**Test Steps**:
1. Attempt to create Subscriptions with invalid filter syntax
2. Use unsupported resource types in filters
3. Use invalid search parameters in filter expressions
4. Verify appropriate error responses

**Pass Criteria**:
- HTTP 400 Bad Request for invalid syntax
- Appropriate error messages indicating validation failure
- No Subscription created for invalid requests

#### Test Case 4: Filter Criteria Extension Support
**Objective**: Verify server supports the Subscriptions Backport IG filter-criteria extension

**Test Steps**:
1. Create Subscription using the filter-criteria extension structure
2. Verify extension is accepted and stored
3. Test with various extension configurations per IG requirements

**Pass Criteria**:
- Server accepts filter-criteria extension
- Extension data preserved in stored resource
- Compliance with Subscriptions Backport IG extension requirements

#### Test Case 5: Resource Type Compatibility
**Objective**: Verify filter criteria work with server's supported resource types

**Test Steps**:
1. For each SHALL support resource from Capability Statement:
   - Create Subscription with filter targeting that resource type
   - Use supported search parameters from Capability Statement
   - Verify successful creation
2. Test combinations of supported search parameters in filters

**Pass Criteria**:
- Subscriptions created successfully for all SHALL support resources
- Filter criteria utilize supported search parameters correctly
- Server validates filter compatibility with resource capabilities

#### Test Case 6: Subscription Status and Lifecycle
**Objective**: Verify created Subscriptions with filters maintain proper status

**Test Steps**:
1. Create Subscription with filter criteria
2. Verify initial status is appropriate (requested/active)
3. Check that server maintains Subscription in operational state
4. Verify filter criteria remain active in the subscription lifecycle

**Pass Criteria**:
- Subscription status indicates successful activation
- Filter criteria remain enforceable throughout lifecycle
- Server maintains subscription for filtering operations

### Error Handling Validation
- Server returns appropriate HTTP status codes for various scenarios
- Error messages provide sufficient detail for debugging filter criteria issues
- Server gracefully handles malformed filter expressions
- Validation errors reference specific filter criteria problems

### Conformance Validation
- Created Subscriptions conform to Subscriptions Backport IG requirements
- Filter criteria syntax follows FHIR search parameter conventions
- Extension usage aligns with IG specifications
- Server behavior matches SHALL requirements for Subscription support

---

<a id='req-486'></a>

### REQ-486: Servers must process all filter-criteria extensions provided by the client.

**Text**: 

**Context**: Subscriptions Backport IG – processing multiple filter-criteria extensions

**Actor**: Server

**Conformance**: SHALL

# Test Specification for REQ-486

## Requirement ID
REQ-486

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated testing by examining server behavior when processing multiple filter-criteria extensions in subscription requests.

### Complexity
**Complex** - This requirement involves:
- Understanding the Subscriptions Backport IG extension mechanism
- Testing multiple filter-criteria combinations
- Verifying proper processing of all provided extensions
- Ensuring no extensions are ignored or improperly handled

### Prerequisites
- Server must support FHIR R4 Subscriptions Backport IG
- Server must support Subscription resource creation and management
- Test client must be able to create subscriptions with filter-criteria extensions
- Server must have appropriate test data for the subscription topics being filtered

## Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: 
  - Subscription resources with multiple filter-criteria extensions
  - Underlying resources that match/don't match the filter criteria (e.g., Patient, Observation, etc.)
- **Test Data**: Resources that will trigger subscription notifications based on the filter criteria
- **Filter Criteria**: Various combinations of filter-criteria extensions with different parameters

### Required FHIR Operations
Based on the Capability Statement analysis, the following operations are supported and required for testing:

1. **POST /Subscription** - Create subscriptions with multiple filter-criteria extensions
2. **GET /Subscription/[id]** - Retrieve subscription to verify filter criteria were stored
3. **PUT /Subscription/[id]** - Update subscriptions (if testing modification scenarios)
4. **Resource operations on filtered resources** - Operations on resources that should trigger notifications based on filter criteria

### Validation Criteria

#### Test Case 1: Multiple Filter Criteria Processing
**Objective**: Verify server processes all filter-criteria extensions when multiple are provided

**Test Steps**:
1. Create a Subscription resource with 2-3 different filter-criteria extensions
   - Example: Filter by patient reference, status, and category
2. Submit the subscription to the server via POST
3. Retrieve the created subscription via GET
4. Perform operations that should trigger notifications based on each filter criterion
5. Verify subscription notifications are generated correctly

**Assertions**:
- Subscription creation succeeds (HTTP 201)
- Retrieved subscription contains all provided filter-criteria extensions
- Server generates notifications only for resources matching ALL filter criteria (AND logic)
- No filter-criteria extensions are ignored or dropped

#### Test Case 2: Complex Filter Combinations
**Objective**: Verify server handles complex combinations of filter-criteria extensions

**Test Steps**:
1. Create subscriptions with various filter-criteria combinations:
   - Date range filters + resource type filters
   - Reference filters + token filters
   - Multiple token filters with different search parameters
2. Create test resources that match some but not all criteria
3. Create test resources that match all criteria
4. Verify notification behavior

**Assertions**:
- Only resources matching all filter criteria generate notifications
- Partial matches do not trigger notifications
- Server processes all filter extensions without errors

#### Test Case 3: Filter Criteria Edge Cases
**Objective**: Verify server handles edge cases in filter-criteria processing

**Test Steps**:
1. Create subscription with maximum reasonable number of filter-criteria extensions
2. Create subscription with duplicate filter-criteria extensions (same parameter)
3. Create subscription with conflicting filter criteria
4. Test server response and behavior

**Assertions**:
- Server handles large numbers of filter criteria without performance degradation
- Server appropriately handles duplicate or conflicting criteria
- Error responses (if any) are appropriate and informative

#### Test Case 4: Filter Criteria Modification
**Objective**: Verify server processes updated filter-criteria extensions

**Test Steps**:
1. Create subscription with initial set of filter-criteria extensions
2. Update subscription to add additional filter-criteria extensions
3. Update subscription to modify existing filter-criteria extensions
4. Test notification behavior after modifications

**Assertions**:
- Updated filter criteria are properly processed
- Notifications reflect the updated filter criteria
- All new and modified filter-criteria extensions are active

#### Test Case 5: Cross-Resource Filter Processing
**Objective**: Verify server processes filter-criteria across different resource types

**Test Steps**:
1. Create subscriptions for different resource types (Patient, Observation, Condition) with multiple filter-criteria each
2. Perform operations on various resource types
3. Verify proper filtering and notification generation

**Assertions**:
- Each subscription processes its specific filter-criteria extensions correctly
- Cross-resource operations don't interfere with filter processing
- Resource-specific filters work independently

### Success Criteria
- **Pass**: Server successfully processes all provided filter-criteria extensions without ignoring any, and subscription notifications are generated according to the complete set of filter criteria
- **Fail**: Server ignores one or more filter-criteria extensions, fails to process multiple extensions correctly, or generates incorrect notifications

### Error Handling Validation
- Server should return appropriate error responses if filter-criteria extensions are malformed
- Server should handle unsupported filter parameters gracefully
- Error messages should be informative about which filter-criteria caused issues

### Performance Considerations
- Test with reasonable numbers of filter-criteria extensions (e.g., 5-10)
- Verify server performance doesn't degrade significantly with multiple filter criteria
- Ensure notification processing remains timely with complex filter combinations

---

<a id='req-487'></a>

### REQ-487: Clients must not include filters for different patients in the same Subscription.

**Text**: 

**Context**: Subscriptions Backport IG – patient scoping constraints

**Actor**: Client

**Conformance**: SHALL

# Test Specification for REQ-487

## 1. Requirement ID
**REQ-487**

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated by examining the filter criteria in Subscription resources to ensure all patient-scoping filters reference the same patient.

### Complexity
**Moderate** - The test requires parsing and analyzing multiple filter criteria within a single Subscription resource to identify patient references and verify they all point to the same patient.

### Prerequisites
- Client system capable of creating Subscription resources
- Test environment with multiple Patient resources available for testing
- Understanding of FHIR Subscription resource structure and filter syntax
- Knowledge of patient-scoping search parameters from the Capability Statement (patient parameters for AllergyIntolerance, CarePlan, CareTeam, Condition, Coverage, Device, DiagnosticReport, DocumentReference, Encounter, Goal, Immunization, MedicationDispense, MedicationRequest, Observation, Procedure, QuestionnaireResponse, RelatedPerson, ServiceRequest, and Specimen)

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- Multiple Patient resources with different IDs (e.g., Patient/patient1, Patient/patient2, Patient/patient3)
- Subscription resources created by the client under test that contain multiple filter criteria with patient-scoping parameters

**Test Data Requirements:**
- At least 2 different patient identifiers available in the test environment
- Subscription resources that include filters for patient-scoped resources (as identified in the Capability Statement)

### Required FHIR Operations
Based on the Capability Statement, the following operations may be used to validate subscription behavior:
- **POST /Subscription** - Create subscription resources for testing
- **GET /Subscription/[id]** - Retrieve created subscriptions for analysis
- **GET /Patient/[id]** - Verify patient resources exist for testing

### Validation Criteria

#### Test Case 1: Valid Single Patient Subscription
**Objective:** Verify that subscriptions with multiple filters referencing the same patient are accepted

**Test Steps:**
1. Create a Subscription resource with multiple filter criteria that all reference the same patient
   - Example filters might include:
     - `Observation?patient=Patient/patient1`
     - `Condition?patient=Patient/patient1`
     - `MedicationRequest?patient=Patient/patient1`
2. Submit the subscription to the server
3. Verify the subscription is accepted (HTTP 201 Created or equivalent success response)

**Pass Criteria:**
- Subscription is successfully created
- All filter criteria reference the same patient identifier

#### Test Case 2: Invalid Multi-Patient Subscription
**Objective:** Verify that subscriptions with filters referencing different patients are rejected

**Test Steps:**
1. Attempt to create a Subscription resource with filter criteria referencing different patients
   - Example invalid filters:
     - `Observation?patient=Patient/patient1`
     - `Condition?patient=Patient/patient2`
     - `MedicationRequest?patient=Patient/patient1`
2. Submit the subscription to the server
3. Verify the subscription is rejected

**Pass Criteria:**
- Subscription creation fails with appropriate error response
- Error message indicates violation of patient scoping constraint
- HTTP status code indicates client error (4xx range)

#### Test Case 3: Complex Filter Analysis
**Objective:** Verify patient constraint checking works with various filter syntaxes

**Test Steps:**
1. Create subscriptions with different patient reference formats:
   - Direct patient ID: `patient=patient1`
   - Full resource reference: `patient=Patient/patient1`
   - Multiple patient parameters in different criteria
2. Test both valid (same patient) and invalid (different patients) scenarios
3. Verify consistent behavior across different filter syntax variations

**Pass Criteria:**
- Same patient referenced in different formats is accepted
- Different patients referenced in any format combination is rejected
- Consistent validation behavior regardless of reference format

#### Test Case 4: Edge Case Validation
**Objective:** Verify handling of edge cases in patient filtering

**Test Steps:**
1. Test subscriptions with:
   - Single filter with patient parameter (should pass)
   - No patient-scoped filters (should pass - not applicable to constraint)
   - Mix of patient-scoped and non-patient-scoped filters with consistent patient references (should pass)
   - Mix of patient-scoped and non-patient-scoped filters with inconsistent patient references (should fail)

**Pass Criteria:**
- Single patient filter subscriptions are accepted
- Non-patient-scoped only subscriptions are accepted
- Mixed filters with consistent patient references are accepted
- Mixed filters with inconsistent patient references are rejected

### Validation Assertions
1. **Patient Reference Extraction:** Successfully identify all patient-scoping filters in subscription criteria
2. **Patient Identity Comparison:** Correctly compare patient references across different syntax formats
3. **Constraint Enforcement:** Reject subscriptions that violate the single-patient constraint
4. **Error Response Quality:** Provide meaningful error messages when constraint is violated
5. **Consistent Behavior:** Apply the same validation logic regardless of filter complexity or syntax variation

### Success Metrics
- 100% of single-patient subscriptions are accepted
- 100% of multi-patient subscriptions are rejected
- Error responses provide actionable feedback for constraint violations
- Validation works consistently across different patient reference formats

---

<a id='req-490'></a>

### REQ-490: Servers must persist adjusted Subscription resources with status "error".

**Text**: 

**Context**: Subscriptions Backport IG – behavior when filters are adjusted

**Actor**: Server

**Conformance**: SHALL

# Test Specification for REQ-490

## Requirement ID
REQ-490

## Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated testing by creating Subscription resources with adjusted filters, triggering error conditions, and verifying the server persists them with "error" status.

### Complexity
**Moderate** - The test requires understanding of the Subscriptions Backport IG behavior, creating Subscription resources with filters that will be adjusted by the server, triggering error conditions, and verifying persistence with correct status.

### Prerequisites
- Server must support Subscription resources according to the Subscriptions Backport IG
- Server must implement filter adjustment behavior for Subscription resources
- Test system must have capability to create Subscription resources and trigger error conditions
- Server must support read operations for Subscription resources to verify persistence

## Test Implementation Strategy

### Required Inputs
- **FHIR Resources**:
  - Valid Subscription resource with filters that the server will need to adjust
  - Patient resources or other resources referenced in subscription criteria (using tester's existing data)
  - Capability Statement indicating server's Subscription support

### Required FHIR Operations
- `POST [base]/Subscription` - Create subscription with filters that will be adjusted
- `GET [base]/Subscription/[id]` - Read the adjusted subscription to verify status and persistence
- `PUT [base]/Subscription/[id]` or `POST [base]/Subscription` - Operations that may trigger filter adjustments and error states

### Validation Criteria

#### Test Case 1: Subscription Filter Adjustment Leading to Error Status
1. **Setup**: Create a Subscription resource with filters that the server will need to adjust (e.g., filters that are too broad, use unsupported parameters, or reference non-existent resources)

2. **Action**: Submit the Subscription resource to the server

3. **Verification**:
   - Server SHOULD adjust the filters as per Subscriptions Backport IG requirements
   - If the adjustment process results in an error condition, verify:
     - The Subscription resource is persisted on the server
     - The Subscription.status is set to "error"
     - The resource remains accessible via GET operation
     - The Subscription.error field contains appropriate error information (if supported)

#### Test Case 2: Multiple Filter Adjustments Resulting in Error
1. **Setup**: Create a Subscription resource with multiple filters that require adjustment and will result in error state

2. **Action**: Submit the Subscription with multiple problematic filters

3. **Verification**:
   - Server processes multiple filter adjustments
   - When error condition is reached, verify:
     - Subscription is persisted with status "error"
     - All attempted filter adjustments are reflected in the persisted resource
     - Resource can be retrieved and contains error status

#### Test Case 3: Persistence Verification After Error Status
1. **Setup**: Use a Subscription that has been adjusted and resulted in error status from previous test cases

2. **Action**: 
   - Perform GET operation on the Subscription resource
   - Verify the resource remains accessible over time

3. **Verification**:
   - Subscription resource with "error" status remains persisted
   - Resource can be consistently retrieved
   - Status remains "error" and is not automatically changed
   - Resource metadata indicates persistence (meta.lastUpdated, etc.)

### Success Criteria
- Server successfully persists Subscription resources that have undergone filter adjustments and resulted in error conditions
- Persisted Subscription resources maintain "error" status appropriately
- Error status Subscriptions remain accessible through standard FHIR read operations
- Server demonstrates compliance with Subscriptions Backport IG behavior for error handling

### Failure Conditions
- Server fails to persist Subscription resources with adjusted filters when they result in error status
- Server sets incorrect status (not "error") for Subscriptions with adjustment errors
- Subscription resources with error status are not accessible via GET operations
- Server automatically removes or modifies error status Subscriptions without appropriate triggers

---

<a id='req-491'></a>

### REQ-491: Clients must review persisted Subscription resources for status and filters.

**Text**: 

**Context**: Subscriptions Backport IG – client responsibility after subscription creation

**Actor**: Client

**Conformance**: SHALL

# Test Specification for REQ-491

## 1. Requirement ID
**REQ-491**: Clients must review persisted Subscription resources for status and filters.

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be validated through programmatic testing by verifying that clients can read and process Subscription resources from the server.

### Complexity
**Moderate** - Requires testing subscription resource retrieval and validation of client's ability to process status and filters, but the testing approach is straightforward.

### Prerequisites
- A FHIR server with US Core capability that supports Subscription resources
- At least one persisted Subscription resource on the server
- Client system capable of making FHIR API calls
- Test data should include Subscription resources with various status values and filter configurations

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: 
  - Subscription resources with different status values (e.g., active, error, off)
  - Subscription resources with different filter criteria
  - Patient resources (since most US Core subscriptions will likely be patient-related)
- **Test Data Requirements**:
  - Subscription resources with `status` element populated
  - Subscription resources with `criteria` element containing filters
  - Subscription resources in various states to test comprehensive client review capabilities

### Required FHIR Operations
Based on the Capability Statement analysis, the following operations are supported and required for testing:

1. **Search for Subscription resources**:
   ```
   GET [base]/Subscription?[search-parameters]
   ```

2. **Read specific Subscription resources**:
   ```
   GET [base]/Subscription/[id]
   ```

3. **Read referenced resources** (if needed based on subscription criteria):
   - Patient resources: `GET [base]/Patient/[id]`
   - Other US Core resources as referenced in subscription filters

### Validation Criteria

#### Test Case 1: Client Reviews Subscription Status
**Objective**: Verify client can retrieve and process Subscription resource status information

**Test Steps**:
1. Client performs search for Subscription resources: `GET [base]/Subscription`
2. Client retrieves individual Subscription resources by ID
3. Client processes the `Subscription.status` field for each resource

**Success Criteria**:
- Client successfully retrieves Subscription resources
- Client demonstrates ability to read and interpret `Subscription.status` values
- Client can identify different status states (active, error, off, requested, etc.)
- No HTTP errors (4xx/5xx) during retrieval operations
- Client handles different status values appropriately according to FHIR Subscription specification

#### Test Case 2: Client Reviews Subscription Filters
**Objective**: Verify client can retrieve and process Subscription resource filter criteria

**Test Steps**:
1. Client retrieves Subscription resources with populated `criteria` elements
2. Client processes the `Subscription.criteria` field containing filter information
3. Client demonstrates understanding of the filter syntax and parameters

**Success Criteria**:
- Client successfully retrieves Subscription resources with criteria
- Client can parse and interpret the `Subscription.criteria` field
- Client demonstrates ability to understand filter parameters and values
- Client can identify the resource type and search parameters specified in the criteria
- Client properly handles different filter formats and complexities

#### Test Case 3: Comprehensive Subscription Review
**Objective**: Verify client can perform comprehensive review of multiple Subscription resources

**Test Steps**:
1. Client retrieves all available Subscription resources
2. Client processes both status and filter information for each subscription
3. Client demonstrates systematic review capability

**Success Criteria**:
- Client retrieves multiple Subscription resources in a single operation
- Client processes both `status` and `criteria` elements for each resource
- Client demonstrates ability to correlate subscription information with referenced resources
- Client shows evidence of systematic review process (e.g., logging, reporting, or decision-making based on subscription data)
- Client handles edge cases such as missing or malformed criteria gracefully

#### Additional Validation Points
- **Error Handling**: Client appropriately handles HTTP error responses (401, 403, 404, 500)
- **Resource Validation**: Client validates that retrieved resources conform to FHIR Subscription resource structure
- **Security Compliance**: Client includes appropriate authorization headers and follows security requirements
- **Data Processing**: Client demonstrates actual processing of the retrieved subscription data, not just successful API calls

#### Performance Considerations
- Client should efficiently handle multiple subscription resources
- Client should demonstrate appropriate use of search parameters to limit results when necessary
- Client should handle pagination if server returns large result sets

This test specification ensures that clients fulfill their responsibility to review persisted Subscription resources for both status and filters as required by the Subscriptions Backport IG, while accommodating a "bring your own data" testing approach.

---



<a id='subscriptions'></a>

## Subscriptions

<a id='req-497'></a>

### REQ-497: Clients must review server documentation for `feed-event` notifications.

**Text**: 

**Context**: Subscriptions Backport IG – client awareness of feed-event semantics

**Actor**: Client

**Conformance**: SHALL

# Test Specification for REQ-497

## 1. Requirement ID
REQ-497

## 2. Requirement Analysis

### Testability Assessment
**Attestation** - This requirement mandates that clients must review server documentation for `feed-event` notifications, which is a documentation review activity that cannot be automatically tested through API interactions. This requires manual verification of client behavior and documentation compliance.

### Complexity
**Simple** - The requirement is straightforward in scope, requiring verification that clients have reviewed and understood server documentation regarding `feed-event` notification semantics.

### Prerequisites
- Server must provide accessible documentation describing `feed-event` notification semantics and behavior
- Client system must be implementing or planning to implement subscription functionality
- Documentation should be available through standard channels (API documentation, implementation guides, etc.)

## 3. Test Implementation Strategy

### Required Inputs
- **Server Documentation**: Access to the server's technical documentation, API documentation, or implementation guide that describes `feed-event` notification behavior
- **Client Implementation Team**: Access to client development team or implementation documentation showing awareness of feed-event semantics
- **Subscription Implementation Evidence**: Documentation or code showing client's subscription handling capabilities

### Required FHIR Operations
This test does not require specific FHIR API operations as it focuses on documentation review rather than runtime behavior. However, the following operations may be relevant for context:

- `GET [base]/metadata` - To retrieve server's CapabilityStatement which may reference subscription capabilities
- Subscription-related operations (if implemented) - To provide context for the documentation review

Note: The provided Capability Statement does not explicitly mention Subscription resources, which suggests this requirement may apply to systems implementing the Subscriptions Backport IG as an additional capability.

### Validation Criteria

#### Primary Validation
1. **Documentation Availability Check**:
   - Verify that server provides accessible documentation describing `feed-event` notification semantics
   - Confirm documentation includes details about feed-event behavior, payload structure, and client expectations

2. **Client Awareness Verification**:
   - Attestation from client implementation team confirming review of server's `feed-event` documentation
   - Evidence of client implementation considerations based on server's documented `feed-event` behavior

3. **Implementation Alignment**:
   - Verify client's subscription handling implementation aligns with server's documented `feed-event` semantics
   - Confirm client code or configuration accounts for server-specific `feed-event` behaviors

#### Test Passing Criteria
- [ ] Server documentation for `feed-event` notifications is accessible and comprehensive
- [ ] Client team provides attestation of documentation review
- [ ] Client implementation demonstrates understanding of server's `feed-event` semantics through code, configuration, or implementation documentation
- [ ] No conflicts exist between client's expected behavior and server's documented `feed-event` semantics

#### Test Failure Indicators
- Server documentation for `feed-event` notifications is missing, incomplete, or inaccessible
- Client team cannot provide evidence of documentation review
- Client implementation shows misunderstanding of server's `feed-event` behavior
- Documented client expectations conflict with server's `feed-event` implementation

### Test Execution Notes
1. This test requires coordination between testing personnel and client implementation teams
2. The test should be conducted during the implementation phase when subscription capabilities are being developed
3. Documentation review should be thorough and include all aspects of `feed-event` handling specific to the server implementation
4. Results should be documented with evidence of the review process and any implementation adjustments made based on the documentation

---



<a id='subscriptions/notifications'></a>

## Subscriptions/Notifications

<a id='req-495'></a>

### REQ-495: Servers must support `empty` and `id-only` payload types.

**Text**: 

**Context**: Subscriptions Backport IG – supported notification payloads

**Actor**: Server

**Conformance**: SHALL

# Test Specification for REQ-495

## 1. Requirement ID
**REQ-495**: Servers must support `empty` and `id-only` payload types.

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be verified through programmatic testing by creating subscriptions with different payload types and verifying server behavior.

### Complexity
**Moderate** - Requires subscription setup, testing multiple payload configurations, and verification of notification delivery formats.

### Prerequisites
- Server must support FHIR Subscriptions (Backport IG)
- Test client must have appropriate permissions to create and manage subscriptions
- Server must have subscription endpoint configured for notifications
- Test data containing resources that can trigger subscription notifications

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: 
  - Subscription resources with different payload configurations
  - Test resources that match subscription criteria (e.g., Patient, Observation, etc.)
- **Test Configuration**:
  - Notification endpoint URL for receiving subscription notifications
  - Valid subscription criteria matching existing server data

### Required FHIR Operations
Based on the Capability Statement, the following operations are supported and will be used:

1. **POST /Subscription** (create subscription with empty payload)
2. **POST /Subscription** (create subscription with id-only payload) 
3. **GET /[ResourceType]/[id]** (trigger subscription notifications)
4. **PUT /[ResourceType]/[id]** (trigger subscription notifications)
5. **POST /[ResourceType]** (trigger subscription notifications)

### Validation Criteria

#### Test Case 1: Empty Payload Support
**Objective**: Verify server supports subscriptions with empty payload type

**Steps**:
1. Create a subscription resource with:
   - `channel.type` = "rest-hook"
   - `channel.payload` = "empty" 
   - Valid criteria matching server resources
   - Valid notification endpoint
2. Trigger a notification by creating/updating a resource matching subscription criteria
3. Verify notification is received at the endpoint
4. Verify notification payload contains minimal content (no resource data)

**Expected Results**:
- Subscription creation returns HTTP 201 Created
- Subscription status becomes "active"
- Notifications are delivered with empty/minimal payload
- Notification contains notification type but no resource content

#### Test Case 2: ID-Only Payload Support  
**Objective**: Verify server supports subscriptions with id-only payload type

**Steps**:
1. Create a subscription resource with:
   - `channel.type` = "rest-hook" 
   - `channel.payload` = "id-only"
   - Valid criteria matching server resources
   - Valid notification endpoint
2. Trigger a notification by creating/updating a resource matching subscription criteria
3. Verify notification is received at the endpoint
4. Verify notification payload contains only resource identifiers

**Expected Results**:
- Subscription creation returns HTTP 201 Created
- Subscription status becomes "active" 
- Notifications are delivered with id-only payload
- Notification contains resource IDs but no full resource content

#### Test Case 3: Payload Type Validation
**Objective**: Verify server properly validates supported payload types

**Steps**:
1. Attempt to create subscriptions with various payload configurations
2. Verify server accepts "empty" and "id-only" values
3. Test server behavior with invalid payload types (if applicable)

**Expected Results**:
- Server accepts subscriptions with "empty" payload type
- Server accepts subscriptions with "id-only" payload type  
- Server provides appropriate validation responses for supported payload types

#### Assertions for Pass Criteria
- ✅ Server successfully creates subscriptions with `channel.payload` = "empty"
- ✅ Server successfully creates subscriptions with `channel.payload` = "id-only"
- ✅ Empty payload notifications contain no resource data in the notification body
- ✅ ID-only payload notifications contain only resource identifiers (not full resources)
- ✅ Both payload types result in successful notification delivery
- ✅ Subscription status shows "active" for both payload configurations

#### Failure Indicators
- ❌ Server rejects subscription creation for either payload type
- ❌ Notifications are not delivered for either payload configuration
- ❌ Empty payload notifications contain full resource data
- ❌ ID-only payload notifications contain full resource content instead of just IDs
- ❌ Server returns errors indicating unsupported payload types

---



<a id='terminology/valueset'></a>

## Terminology/ValueSet

<a id='req-322'></a>

### REQ-322: Include all codes from US Core Category CodeSystem

**Text**: 

**Context**: Applies to the ValueSet logical definition; the ValueSet composition SHALL include all codes from the specified CodeSystem.

**Actor**: Implementer

**Conformance**: SHALL

# Test Specification for REQ-322

## 1. Requirement ID
**REQ-322**: Include all codes from US Core Category CodeSystem

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be programmatically verified by expanding the ValueSet and comparing the returned codes against the complete set of codes from the referenced US Core Category CodeSystem.

### Complexity
**Moderate** - The test requires:
- Understanding of FHIR terminology operations
- Ability to expand ValueSets
- Knowledge of CodeSystem structure and content
- Comparison logic between two code collections

### Prerequisites
- FHIR terminology server with US Core ValueSets and CodeSystems
- Access to the specific US Core Category CodeSystem being referenced
- System supporting the `$expand` operation on ValueSet resources
- Knowledge of which specific US Core Category CodeSystem is being tested

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources:**
- The ValueSet resource under test that references the US Core Category CodeSystem
- The US Core Category CodeSystem resource being referenced
- Access to a terminology server supporting ValueSet expansion

**Expected Outputs:**
- Expanded ValueSet containing all codes from the referenced CodeSystem
- Confirmation that no codes from the source CodeSystem are missing
- Verification that the expansion is complete and accurate

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are required:

1. **ValueSet Read Operation**
   - `GET [base]/ValueSet/[id]` - Retrieve the ValueSet logical definition
   - Verify the ValueSet references the US Core Category CodeSystem

2. **ValueSet Expand Operation**
   - `GET [base]/ValueSet/[id]/$expand` or `POST [base]/ValueSet/$expand`
   - Expand the complete ValueSet to retrieve all included codes

3. **CodeSystem Read Operation**
   - `GET [base]/CodeSystem/[id]` - Retrieve the referenced US Core Category CodeSystem
   - Extract the complete list of codes from the CodeSystem

### Validation Criteria

**Primary Assertions:**

1. **ValueSet Reference Validation**
   - The ValueSet composition SHALL include a reference to the US Core Category CodeSystem
   - The include statement SHALL specify the correct CodeSystem URL

2. **Expansion Completeness Check**
   - Expand the ValueSet using the `$expand` operation
   - Retrieve all codes from the referenced US Core Category CodeSystem
   - Verify that every code from the CodeSystem appears in the ValueSet expansion
   - Ensure no codes from the source CodeSystem are missing

3. **Code Integrity Validation**
   - Each code from the CodeSystem SHALL be present in the expansion with:
     - Correct code value
     - Correct display text (if specified in the CodeSystem)
     - Correct system reference

**Test Pass Criteria:**
- The ValueSet expansion contains 100% of the codes from the referenced US Core Category CodeSystem
- All code properties (code, display, system) match between the CodeSystem and ValueSet expansion
- No additional filtering or exclusion rules remove codes from the US Core Category CodeSystem

**Test Fail Criteria:**
- Any code from the US Core Category CodeSystem is missing from the ValueSet expansion
- Code properties don't match between the source CodeSystem and the expansion
- The ValueSet includes codes from sources other than the specified US Core Category CodeSystem when it should only include that CodeSystem

**Implementation Notes:**
- The test should accommodate different ValueSet compositions (e.g., multiple include statements) as long as the US Core Category CodeSystem is completely included
- Consider testing with different expansion parameters to ensure consistency
- Validate that the expansion is stable across multiple requests
- Account for potential CodeSystem versioning by ensuring the correct version is referenced and expanded

---

<a id='req-323'></a>

### REQ-323: Include specific SNOMED CT codes

**Text**: 

**Context**: Applies to the ValueSet logical definition; the ValueSet composition SHALL include the listed SNOMED CT codes.

**Actor**: Implementer

**Conformance**: SHALL

# Test Specification for REQ-323

## 1. Requirement ID
**REQ-323**: Include specific SNOMED CT codes

## 2. Requirement Analysis

### Testability Assessment
**Automatically Testable** - This requirement can be validated programmatically through FHIR terminology operations to expand the ValueSet and verify the presence of specified SNOMED CT codes.

### Complexity
**Simple** - The test involves a straightforward ValueSet expansion operation and code verification against a defined list.

### Prerequisites
- FHIR server with terminology services capability supporting ValueSet expansion
- Access to the ValueSet resource containing the logical definition
- Knowledge of the specific SNOMED CT codes that SHALL be included (this information should be provided in the ValueSet's logical definition)
- SNOMED CT terminology service availability (either local or remote)

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources:**
  - ValueSet resource with logical definition specifying SNOMED CT codes to be included
  - Access to SNOMED CT CodeSystem resource or terminology service

- **Expected Outputs:**
  - Expanded ValueSet containing all specified SNOMED CT codes
  - HTTP 200 response for successful expansion
  - ValueSet.expansion.contains elements for each required SNOMED CT code

### Required FHIR Operations

Based on the US Core Server CapabilityStatement, the following operations are required:

1. **ValueSet/$expand Operation**
   - `GET [base]/ValueSet/[id]/$expand`
   - This operation expands the ValueSet according to its logical definition
   - Supported by FHIR terminology services as part of standard capabilities

2. **ValueSet Read Operation** (if needed)
   - `GET [base]/ValueSet/[id]`
   - To retrieve the ValueSet resource and examine its logical definition

### Validation Criteria

The test SHALL verify the following assertions to indicate conformance:

1. **Successful Expansion**
   - ValueSet expansion operation returns HTTP 200 status
   - Response contains a valid ValueSet resource with populated expansion element

2. **Code Presence Verification**
   - For each SNOMED CT code specified in the logical definition:
     - Verify the code exists in `ValueSet.expansion.contains[]`
     - Confirm `ValueSet.expansion.contains[].system` equals "http://snomed.info/sct"
     - Confirm `ValueSet.expansion.contains[].code` matches the required SNOMED CT code
     - Optionally verify `ValueSet.expansion.contains[].display` contains appropriate display text

3. **Logical Definition Consistency**
   - The expanded ValueSet SHALL contain all codes specified in the ValueSet's logical definition
   - No required SNOMED CT codes are missing from the expansion

### Test Steps

1. **Identify Target ValueSet**
   - Locate the ValueSet resource under test
   - Extract the list of SNOMED CT codes that SHALL be included from the logical definition

2. **Execute ValueSet Expansion**
   - Perform `GET [base]/ValueSet/[id]/$expand` operation
   - Capture the response for analysis

3. **Validate Expansion Results**
   - Verify successful HTTP response (200 OK)
   - Confirm response is a valid ValueSet resource with expansion
   - Check that `ValueSet.expansion.contains` is populated

4. **Verify Required Codes**
   - Iterate through each SNOMED CT code specified in the requirement
   - Search for each code in the `ValueSet.expansion.contains[]` array
   - Confirm system URI and code value match exactly

5. **Document Results**
   - Record which codes were found/missing
   - Note any discrepancies in display text or other attributes
   - Report PASS if all required codes are present, FAIL otherwise

### Pass/Fail Criteria

**PASS**: All specified SNOMED CT codes from the logical definition are present in the expanded ValueSet with correct system URI ("http://snomed.info/sct")

**FAIL**: Any of the following conditions:
- ValueSet expansion operation fails
- One or more required SNOMED CT codes are missing from the expansion
- Required codes are present but with incorrect system URI
- ValueSet expansion is empty or malformed

---



<a id='valueset'></a>

## ValueSet

<a id='req-258'></a>

### REQ-258: Inclusion of specific LOINC codes in the value set

**Text**: 

**Context**: 

**Actor**: Implementers of systems using the US Core Clinical Note Type Value Set

**Conformance**: SHALL

# Test Specification for REQ-258

## 1. Requirement ID
**REQ-258**: Inclusion of specific LOINC codes in the value set

## 2. Requirement Analysis

### Testability Assessment
**Classification**: Automatically testable

**Rationale**: This requirement can be automatically validated by:
- Retrieving the US Core Clinical Note Type Value Set
- Programmatically checking for the presence of required LOINC codes
- Verifying the codes match the specified requirements in the Implementation Guide

### Complexity
**Level**: Simple

**Rationale**: The test involves straightforward value set validation - checking that specific LOINC codes are present in a defined value set. This is a static validation that doesn't require complex interactions or data manipulation.

### Prerequisites
- Access to a FHIR server implementing US Core Server capabilities
- The server must support ValueSet resources and operations
- The US Core Clinical Note Type Value Set must be available on the server
- Network connectivity to retrieve the value set

## 3. Test Implementation Strategy

### Required Inputs
**FHIR Resources**:
- ValueSet resource: US Core Clinical Note Type Value Set
- The canonical URL for the value set (as specified in the US Core IG)

**Expected Outputs**:
- ValueSet resource containing the expansion or compose elements
- Confirmation that all required LOINC codes are present in the value set

### Required FHIR Operations
Based on the US Core Server CapabilityStatement, the following operations are needed:

1. **GET /ValueSet/[id]** - Retrieve the US Core Clinical Note Type Value Set
   - This operation is supported as part of standard FHIR RESTful capabilities
   - Alternative: **GET /ValueSet?url=[canonical-url]** to find the value set by its canonical URL

2. **GET /ValueSet/[id]/$expand** (if expansion is needed)
   - To retrieve the expanded form of the value set if not already expanded
   - This operation MAY be supported by the server

### Validation Criteria

The test SHALL verify the following assertions to determine conformance:

**Primary Assertions**:
1. **Value Set Retrieval**: The US Core Clinical Note Type Value Set can be successfully retrieved from the server
   - Expected HTTP response: 200 OK
   - Response contains a valid ValueSet resource

2. **LOINC Code Presence**: All LOINC codes specified in the US Core Implementation Guide for clinical note types are present in the value set
   - Check the `ValueSet.compose.include` elements for systems with "http://loinc.org"
   - Verify each required LOINC code is listed in the `concept` array
   - If the value set is expanded, check the `ValueSet.expansion.contains` elements

3. **Code System Verification**: The codes reference the correct LOINC system URI
   - Verify system URI is "http://loinc.org"
   - Ensure no incorrect system URIs are used for LOINC codes

**Supporting Assertions**:
1. **Resource Validation**: The retrieved ValueSet resource is valid according to FHIR R4 specification
   - Resource passes basic FHIR validation
   - Required elements are present (id, url, status, etc.)

2. **US Core Profile Conformance**: The ValueSet conforms to any US Core ValueSet profile requirements
   - Check meta.profile if present
   - Validate against US Core-specific constraints

**Test Pass Criteria**:
- All required LOINC codes are present in the value set
- Codes reference the correct LOINC system URI
- ValueSet resource is valid and retrievable
- No HTTP errors (4xx, 5xx) during value set retrieval

**Test Fail Criteria**:
- Any required LOINC code is missing from the value set
- Incorrect system URI used for LOINC codes
- ValueSet resource cannot be retrieved (HTTP 404 or other errors)
- ValueSet resource is invalid or malformed

### Implementation Notes
- The test should be data-agnostic and work with any compliant US Core server
- If the server uses a different mechanism for value set storage or retrieval, the test should adapt accordingly
- The test should handle both expanded and non-expanded value sets
- Error handling should distinguish between server issues and conformance failures

---

<a id='req-325'></a>

### REQ-325: Import codes from specified value sets

**Text**: 

**Context**: ValueSet Logical Definition (CLD) for Specimen Condition

**Actor**: System

**Conformance**: SHALL

# Test Specification for REQ-325

## 1. Requirement ID
REQ-325

## 2. Requirement Analysis

### Testability Assessment
**Attestation** - This requirement involves validating that a system can import codes from specified value sets for Specimen Condition, which requires manual verification of the system's configuration and data import capabilities rather than automated API testing.

### Complexity
**Simple** - The requirement is straightforward but requires verification of value set implementation and code importation capabilities.

### Prerequisites
- System must support the US Core Specimen Profile
- System must have access to the Specimen Condition value set as defined in the Logical Definition (CLD)
- Test data should include specimens with various condition codes from the specified value set
- System must be configured to support value set expansion operations (recommended based on Capability Statement)

## 3. Test Implementation Strategy

### Required Inputs
- **FHIR Resources**: 
  - Specimen resources conforming to US Core Specimen Profile
  - ValueSet resource containing Specimen Condition codes
  - Test specimens with various condition codes from the value set
- **Test Data Requirements**:
  - Multiple Specimen resources with different condition values
  - Specimens that reference condition codes from the specified value set
  - Expected value set definition or expansion for comparison

### Required FHIR Operations
Based on the Capability Statement analysis:

1. **Specimen Resource Operations**:
   - `GET [base]/Specimen/[id]` - Read individual specimen resources
   - Search operations as supported: `GET [base]/Specimen?_id=[id]` and `GET [base]/Specimen?patient=[patient-id]`

2. **ValueSet Operations** (if supported):
   - `GET [base]/ValueSet/$expand` - Expand the Specimen Condition value set to retrieve all available codes
   - `GET [base]/ValueSet/[id]` - Read the value set definition

### Validation Criteria

#### Primary Conformance Checks:
1. **Value Set Code Validation**:
   - Verify that Specimen resources contain condition codes that are present in the specified Specimen Condition value set
   - Confirm that all condition codes used in specimen data are valid members of the value set
   - Validate that the system can properly interpret and store codes from the value set

2. **Code System Compliance**:
   - Ensure condition codes include both system URI and code value where applicable
   - Verify that imported codes maintain proper code system references
   - Confirm codes are represented consistently across specimen resources

#### Implementation Verification:
1. **Data Consistency Check**:
   - All specimen condition codes SHALL be sourced from the specified value set
   - No specimen resources should contain condition codes outside the defined value set
   - System should handle both coded values and text representations appropriately

2. **System Configuration Attestation**:
   - Verify that the system has been configured to import codes from the Specimen Condition value set
   - Confirm that the system maintains current versions of the value set
   - Validate that code updates are properly reflected in specimen data

#### Success Criteria:
- **Pass**: All specimen condition codes found in test data are valid members of the specified Specimen Condition value set, and the system demonstrates proper import and utilization of value set codes
- **Fail**: Any specimen condition codes are found that are not members of the specified value set, or the system cannot demonstrate proper value set code importation

#### Test Execution Notes:
- This test requires coordination between automated validation of specimen data and manual attestation of system configuration
- Testers should verify both the technical implementation (correct codes in resources) and the administrative process (value set import procedures)
- Consider testing with both current specimen data and newly created specimens to verify ongoing compliance

---



<a id='valueset/terminology'></a>

## ValueSet/Terminology

<a id='req-324'></a>

### REQ-324: Import all codes from Service Request Category Codes ValueSet

**Text**: 

**Context**: Applies to the ValueSet logical definition; the ValueSet composition SHALL include all codes from the referenced ValueSet.

**Actor**: Implementer

**Conformance**: SHALL

# Test Specification for REQ-324

## 1. Requirement ID
**REQ-324**: Import all codes from Service Request Category Codes ValueSet

## 2. Requirement Analysis

### Testability Assessment
**Automatically testable** - This requirement can be verified through automated testing by expanding the ValueSet and comparing the results against the referenced ValueSet expansion.

### Complexity
**Simple** - The test involves a straightforward ValueSet expansion operation and comparison of code lists.

### Prerequisites
- FHIR server with terminology capabilities supporting ValueSet expansion
- Access to the Service Request Category Codes ValueSet referenced in the implementation guide
- Access to the referenced ValueSet that contains the codes to be imported
- Server must support the `$expand` operation on ValueSet resources (as confirmed in the Capability Statement)

## 3. Test Implementation Strategy

### Required Inputs
- **Target ValueSet**: The Service Request Category Codes ValueSet that should contain all imported codes
- **Reference ValueSet**: The source ValueSet from which all codes should be imported
- **FHIR Server Endpoint**: Server implementing the US Core specification with terminology capabilities

### Expected Outputs
- Expanded ValueSet containing all codes from both the target and reference ValueSets
- Confirmation that all codes from the reference ValueSet are present in the target ValueSet expansion

### Required FHIR Operations
1. **ValueSet $expand operation** (supported per Capability Statement):
   - `GET [base]/ValueSet/[service-request-category-codes-id]/$expand`
   - `GET [base]/ValueSet/[referenced-valueset-id]/$expand`

### Validation Criteria

#### Test Steps:
1. **Expand the Target ValueSet**
   - Execute `$expand` operation on the Service Request Category Codes ValueSet
   - Verify the operation returns HTTP 200 status
   - Verify the response contains a ValueSet resource with an expansion element

2. **Expand the Referenced ValueSet**
   - Execute `$expand` operation on the referenced ValueSet
   - Verify the operation returns HTTP 200 status
   - Verify the response contains a ValueSet resource with an expansion element

3. **Compare Code Collections**
   - Extract all codes from the reference ValueSet expansion
   - Extract all codes from the target ValueSet expansion
   - Verify that every code from the reference ValueSet is present in the target ValueSet

#### Passing Criteria:
- **Code Completeness**: All codes (system + code pairs) present in the referenced ValueSet expansion MUST be present in the Service Request Category Codes ValueSet expansion
- **Response Validity**: Both ValueSet expansions return valid FHIR ValueSet resources with populated expansion elements
- **Operation Success**: Both `$expand` operations complete successfully without errors

#### Specific Assertions:
1. `response.status == 200` for both expand operations
2. `response.resource.resourceType == "ValueSet"` for both responses
3. `response.resource.expansion` exists and is populated for both ValueSets
4. For each `concept` in reference ValueSet expansion:
   - Corresponding `concept` with matching `system` and `code` exists in target ValueSet expansion
5. `target_expansion.total >= reference_expansion.total` (target may contain additional codes beyond the imported ones)

#### Error Conditions to Handle:
- ValueSet not found (404 error)
- Expansion operation not supported or fails
- Empty or invalid expansion results
- Network connectivity issues

This test specification ensures that implementers properly import all required codes from the referenced ValueSet into their Service Request Category Codes ValueSet, maintaining interoperability and completeness of the terminology system.

---



